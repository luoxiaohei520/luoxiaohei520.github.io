<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Miaow.Y.Hu的博客🥝</title>
  
  
  <link href="https://www.blog.909111.xyz/atom.xml" rel="self"/>
  
  <link href="https://www.blog.909111.xyz/"/>
  <updated>2024-04-19T18:00:00.000Z</updated>
  <id>https://www.blog.909111.xyz/</id>
  
  <author>
    <name>Miaow.Y.Hu🥝</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>音乐</title>
    <link href="https://www.blog.909111.xyz/posts/b7fb4495.html"/>
    <id>https://www.blog.909111.xyz/posts/b7fb4495.html</id>
    <published>2024-04-19T18:00:00.000Z</published>
    <updated>2024-04-19T18:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="music"><a href="#music" class="headerlink" title="music"></a>music</h1><div class="audio"><audio controls preload><source src='https://github.com/volantis-x/volantis-docs/releases/download/assets/Lumia1020.mp3' type='audio/mp3'>Your browser does not support the audio tag.</audio></div><div class="audio"><audio controls preload><source src='https://cdn.jsdelivr.net/gh/luoxiaohei520/MyPics@img/img/202404221626482.mp3' type='audio/mp3'>Your browser does not support the audio tag.</audio></div>]]></content>
    
    
    <summary type="html">🥧想要听歌吗?,本页面将集成部分在线音乐供你倾听。</summary>
    
    
    
    <category term="music" scheme="https://www.blog.909111.xyz/categories/music/"/>
    
    
    <category term="music" scheme="https://www.blog.909111.xyz/tags/music/"/>
    
  </entry>
  
  <entry>
    <title>IDEA全家桶激活激活码</title>
    <link href="https://www.blog.909111.xyz/posts/fd5ae9cb.html"/>
    <id>https://www.blog.909111.xyz/posts/fd5ae9cb.html</id>
    <published>2024-04-02T09:00:00.000Z</published>
    <updated>2024-04-02T09:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="IDEA激活方式"><a href="#IDEA激活方式" class="headerlink" title="IDEA激活方式"></a>IDEA激活方式</h1><ol><li>先从官网[<a href="https://www.jetbrains.com/]下载2022.1的IDEA系列安装包。">https://www.jetbrains.com/]下载2022.1的IDEA系列安装包。</a></li><li>下载相关破解包破解工具<ol><li>补丁：<a href="https://pan.baidu.com/s/1KK7351Xjagc09klN-BaGYw">https://pan.baidu.com/s/1KK7351Xjagc09klN-BaGYw</a>  提取码: 6t6t  </li><li>无限速蓝奏云网盘链接：<a href="https://wwe.lanzoul.com/ikV6Szw3mre">https://wwe.lanzoul.com/ikV6Szw3mre</a> </li><li>注意这个激活包是全家桶激活</li><li>安装相关软件，选择不要立即启动，之后解压补丁文件，推荐解压到非中文文件目录下，注意这个文件不要删除，因为idea激活全靠这个文件。</li><li>进入<code>ja-netfilter-all\scripts</code>选择<code>install-current-user.vbs</code>运行，点击确认窗口，然后等待done</li><li>出现done窗口后，进入软件，输入激活码，一般到这部就激活成功了。</li><li>参考页面：<a href="http://www.itmind.net/14363.html">http://www.itmind.net/14363.html</a></li><li>参考页面：<a href="http://www.itmind.net/14605.html">http://www.itmind.net/14605.html</a></li></ol></li></ol><ol><li><p>IDEA-py激活码</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">IHMWLMSEAL-eyJsaWNlbnNlSWQiOiJJSE1XTE1TRUFMIiwibGljZW5zZWVOYW1lIjoidHJlbmRzIHJhYmJpcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IlBDIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjpmYWxzZX0seyJjb2RlIjoiUFBDIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMi0wOCIsInBhaWRVcFRvIjoiMjAyMy0wMi0wOCIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQV1MiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBTSSIsImZhbGxiYWNrRGF0ZSI6IjIwMjMtMDItMDgiLCJwYWlkVXBUbyI6IjIwMjMtMDItMDgiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUENXTVAiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAyLTA4IiwicGFpZFVwVG8iOiIyMDIzLTAyLTA4IiwiZXh0ZW5kZWQiOnRydWV9XSwibWV0YWRhdGEiOiIwMTIwMjIwMjA4UFNBTjAwMDAwNSIsImhhc2giOiJUUklBTDozMzQzMzQ3ODMiLCJncmFjZVBlcmlvZERheXMiOjcsImF1dG9Qcm9sb25nYXRlZCI6ZmFsc2UsImlzQXV0b1Byb2xvbmdhdGVkIjpmYWxzZX0</span>=<span class="string">-TT/mvlYqIE07j8qgnrhSSVpMtD4buKsRuntPuB17Zb8KodU2SUcb8byLpLG1pU+xEIIyG3Scu/ypjXmQ9w4iyvOT+NYGmeeHFMHnknQVEhhUvDZjTMNXPct03KeHcjxJX8jMSsuRkTooePx1beXjHTuxcyiO8qJcNOOl/97pT45kGTqSJohat0Xe7oiwrE6u3JZhfSdmYV9iJxz6XGNeoPMPnXbH17yoP75eXUqQJzUGxqdeHyKVHSUUJTGfO3IHgjN9y2TwYET5oFjRy1qSMRf4vXpPCK7tnfqhCGISQiDCm+ETB133CcmArxlRVlKdbAIM/7W++eOn5AfW/CNvgg==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBAB2J1ysRudbkqmkUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD</span></span><br></pre></td></tr></table></figure></li><li><p>IDEA-java激活码</p></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">4W9NP3KV9E-eyJsaWNlbnNlSWQiOiI0VzlOUDNLVjlFIiwibGljZW5zZWVOYW1lIjoic2NyaXAgd2FuZSIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IklJIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMS0yNCIsInBhaWRVcFRvIjoiMjAyMy0wMS0yNCIsImV4dGVuZGVkIjpmYWxzZX0seyJjb2RlIjoiUERCIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMS0yNCIsInBhaWRVcFRvIjoiMjAyMy0wMS0yNCIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQV1MiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAxLTI0IiwicGFpZFVwVG8iOiIyMDIzLTAxLTI0IiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBHTyIsImZhbGxiYWNrRGF0ZSI6IjIwMjMtMDEtMjQiLCJwYWlkVXBUbyI6IjIwMjMtMDEtMjQiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUFBTIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMS0yNCIsInBhaWRVcFRvIjoiMjAyMy0wMS0yNCIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQUEMiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAxLTI0IiwicGFpZFVwVG8iOiIyMDIzLTAxLTI0IiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBSQiIsImZhbGxiYWNrRGF0ZSI6IjIwMjMtMDEtMjQiLCJwYWlkVXBUbyI6IjIwMjMtMDEtMjQiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUFNXIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMS0yNCIsInBhaWRVcFRvIjoiMjAyMy0wMS0yNCIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQU0kiLCJmYWxsYmFja0RhdGUiOiIyMDIzLTAxLTI0IiwicGFpZFVwVG8iOiIyMDIzLTAxLTI0IiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBDV01QIiwiZmFsbGJhY2tEYXRlIjoiMjAyMy0wMS0yNCIsInBhaWRVcFRvIjoiMjAyMy0wMS0yNCIsImV4dGVuZGVkIjp0cnVlfV0sIm1ldGFkYXRhIjoiMDEyMDIyMDEyMVBTQU4wMDAwMDUiLCJoYXNoIjoiVFJJQUw6LTYyNTA2MDI4NyIsImdyYWNlUGVyaW9kRGF5cyI6NywiYXV0b1Byb2xvbmdhdGVkIjpmYWxzZSwiaXNBdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlfQ</span>=<span class="string">=-WlwI3NBiapY7em4MmP7qdZcTK2wvAt5f7FNwaH65H6SBvWnFGpe8M2VrSWCEBIGFQpv+VFJLghJKLjaRUcVOY6ttC6G4uKTpuPzELgcckez+/9DPrYj+alvLYFpS6UWy4uqzsjC/sHgcbNiCQjZQMVhj8Wflv9ts8SfWUqTwtciG8eBrzbyipXOVrRn5Wpk3l6ifL71HZsMy3bDLU8Lkt3UQBNVFZhXWBcNyY/WB9CQGX+6aXtbFA9p/hjbTZL050UoeM30rz0UkzPmfiIupbb3KNPKPArQkU8gw6pF7AcRSLuU3HNqq8RDbrXDYSXY9vtoD3Oi18ijlagVANrhjpQ==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBAB2J1ysRudbkqmkUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD</span></span><br></pre></td></tr></table></figure><p>其他软件：</p><p><a href="http://www.itmind.net/collect">http://www.itmind.net/collect</a></p>]]></content>
    
    
    <summary type="html">本文将重点介绍IDEA全家桶激活方式和相关的全家桶激活码，本系列全部使用的是2022.1月份的激活码</summary>
    
    
    
    <category term="编程工具" scheme="https://www.blog.909111.xyz/categories/%E7%BC%96%E7%A8%8B%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="IDEA" scheme="https://www.blog.909111.xyz/tags/IDEA/"/>
    
  </entry>
  
  <entry>
    <title>Mybatis框架学习</title>
    <link href="https://www.blog.909111.xyz/posts/afe2faba.html"/>
    <id>https://www.blog.909111.xyz/posts/afe2faba.html</id>
    <published>2024-04-02T09:00:00.000Z</published>
    <updated>2024-04-02T09:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h1><p>比传统的方式更加方便，但是技术没有高低之分;</p><p>mybatis是一个版Orm的框架，他内部封装了JDBC；</p><p>开发时候只需要关注sql语句本身,不需要花费精力去加载驱动，创建链接，创建statement等繁琐过程。</p><p><strong>优点</strong>：</p><ol><li>基于sql编程，灵活，不会对应用程序或者数据库的现有设计造成任何影响，SQL写在xml中。解除了代码和sql语句的耦合度，便于统一管理，提供xml标签，支持编写动态sql语句，可以重用高。</li><li>与jdbc比，减少了50%的代码量，消除了大量的JDBC大量沉余的代码，不需要手动开关链接。</li><li>与数据库具有很好的兼容性</li><li>能和spring很好的集成</li><li>提供映射标签，支持与数据库的orm字段关系映射；提供对象关系映射标签，支持对象关系组件维护。</li></ol><p>缺点：</p><ol><li>注重于sql本身，当子段多，关联表多时，对开发人员编写sql语句有一定功底。</li><li>sql语句依赖于数据库，导致数据库移植性差，不能随意更改数据库。</li></ol><p>mybatis框架适合场景：</p><ol><li><p>适合于dao层</p><p>​    如果安装标准来的话 那么 </p><p>​    bin  —&gt; binImpl   </p><pre><code> dao --&gt; daoImpl  mybatis中将dao  改成**mapper.java</code></pre></li></ol><ol><li>对性能要求比较高的话，或者需求比较多且改动较多的情况之下适用mybatis</li></ol><h2 id="简单介绍完了，开始重头戏"><a href="#简单介绍完了，开始重头戏" class="headerlink" title="简单介绍完了，开始重头戏"></a>简单介绍完了，开始重头戏</h2><h3 id="第一步，先拿到数据库，这里提供一个实例数据库："><a href="#第一步，先拿到数据库，这里提供一个实例数据库：" class="headerlink" title="第一步，先拿到数据库，这里提供一个实例数据库："></a>第一步，先拿到数据库，这里提供一个实例数据库：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database if <span class="keyword">not</span> <span class="keyword">exists</span> MyBatis_stu <span class="keyword">default</span> <span class="type">character</span> <span class="keyword">set</span> utf8 <span class="keyword">collate</span> utf8_bin; </span><br><span class="line"></span><br><span class="line">use MyBatis_stu ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> classinfo(</span><br><span class="line">  cid <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">  cname <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">unique</span> comment <span class="string">&#x27;班级编号&#x27;</span> </span><br><span class="line">)ENGINE<span class="operator">=</span>InnoDB auto_increment<span class="operator">=</span><span class="number">101</span> <span class="keyword">default</span> charset<span class="operator">=</span>utf8 <span class="keyword">collate</span><span class="operator">=</span>utf8_bin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> stuinfo (</span><br><span class="line">   sid <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">   sname <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">not</span> <span class="keyword">null</span> comment <span class="string">&#x27;学生姓名&#x27;</span>,</span><br><span class="line">   cid <span class="type">int</span> comment <span class="string">&#x27;所在班级编号&#x27;</span>,</span><br><span class="line">   tel <span class="type">varchar</span>(<span class="number">15</span>) <span class="keyword">unique</span> comment <span class="string">&#x27;联系方式&#x27;</span>,</span><br><span class="line">   addr <span class="type">varchar</span>(<span class="number">100</span>) comment <span class="string">&#x27;家庭住址&#x27;</span>,</span><br><span class="line">   <span class="keyword">constraint</span> FK_stuinfo_cid <span class="keyword">foreign</span> key(cid) <span class="keyword">references</span> classinfo(cid)</span><br><span class="line">)ENGINE<span class="operator">=</span>InnoDB auto_increment<span class="operator">=</span><span class="number">101</span> <span class="keyword">default</span> charset<span class="operator">=</span>utf8 <span class="keyword">collate</span><span class="operator">=</span>utf8_bin;</span><br></pre></td></tr></table></figure><p>这一步，我觉得不要多说了，毕竟你学java到现在，这一步还是没看懂的话，我觉得你可以准备考虑考虑其他路了。</p><p>==第二步前台条件，你要创建好一个maven项目，并导入相关依赖，别告诉我你忘记了maven工程如何创建了？==</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xh<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Maven<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>Maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!--导入maven链接，让maven去下载</span></span><br><span class="line"><span class="comment">   https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.28<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-slf4j-impl --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-slf4j-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.17.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="第二步，根据我们的数据库创建Bean类，什么？你告诉我你不知道什么事Bean类？额，你该恶补一下java了。"><a href="#第二步，根据我们的数据库创建Bean类，什么？你告诉我你不知道什么事Bean类？额，你该恶补一下java了。" class="headerlink" title="第二步，根据我们的数据库创建Bean类，什么？你告诉我你不知道什么事Bean类？额，你该恶补一下java了。"></a>第二步，根据我们的数据库创建Bean类，什么？你告诉我你不知道什么事Bean类？额，你该恶补一下java了。</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassInfo</span> &#123;</span><br><span class="line"><span class="keyword">private</span> Integer cid;</span><br><span class="line"><span class="keyword">private</span> String cname;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">getCid</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> cid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCid</span><span class="params">(Integer cid)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.cid = cid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getCname</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> cname;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCname</span><span class="params">(String cname)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.cname = cname;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">final</span> <span class="type">int</span> <span class="variable">prime</span> <span class="operator">=</span> <span class="number">31</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">result = prime * result + ((cid == <span class="literal">null</span>) ? <span class="number">0</span> : cid.hashCode());</span><br><span class="line">result = prime * result + ((cname == <span class="literal">null</span>) ? <span class="number">0</span> : cname.hashCode());</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span> == obj)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">if</span> (obj == <span class="literal">null</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (getClass() != obj.getClass())</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="type">ClassInfo</span> <span class="variable">other</span> <span class="operator">=</span> (ClassInfo) obj;</span><br><span class="line"><span class="keyword">if</span> (cid == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (other.cid != <span class="literal">null</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!cid.equals(other.cid))</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (cname == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (other.cname != <span class="literal">null</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!cname.equals(other.cname))</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;ClassInfo [cid=&quot;</span> + cid + <span class="string">&quot;, cname=&quot;</span> + cname + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//记得这里我的需要创建的构造方法，你可以选择跟我也可以选择不跟</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ClassInfo</span><span class="params">( String cname)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.cname = cname;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ClassInfo</span><span class="params">(Integer cid, String cname)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line"><span class="built_in">this</span>.cid = cid;</span><br><span class="line"><span class="built_in">this</span>.cname = cname;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ClassInfo</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>==注意，这个类，我实际上在本篇没用上，我会在下篇才用到，你可以自行选择创建或者不创建==</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentInfo</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Integer sid;<span class="comment">//学生id</span></span><br><span class="line"><span class="keyword">private</span> String sname;<span class="comment">//学生姓名</span></span><br><span class="line"><span class="keyword">private</span> Integer cid; <span class="comment">//外键管理，类id</span></span><br><span class="line"><span class="keyword">private</span> String tel; <span class="comment">//电话号码</span></span><br><span class="line"><span class="keyword">private</span> String addr;<span class="comment">//地址</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">getSid</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> sid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSid</span><span class="params">(Integer sid)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.sid = sid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getSname</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> sname;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSname</span><span class="params">(String sname)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.sname = sname;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">getCid</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> cid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCid</span><span class="params">(Integer cid)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.cid = cid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getTel</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> tel;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTel</span><span class="params">(String tel)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.tel = tel;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getAddr</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> addr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddr</span><span class="params">(String addr)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.addr = addr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">final</span> <span class="type">int</span> <span class="variable">prime</span> <span class="operator">=</span> <span class="number">31</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">result = prime * result + ((addr == <span class="literal">null</span>) ? <span class="number">0</span> : addr.hashCode());</span><br><span class="line">result = prime * result + ((cid == <span class="literal">null</span>) ? <span class="number">0</span> : cid.hashCode());</span><br><span class="line">result = prime * result + ((sid == <span class="literal">null</span>) ? <span class="number">0</span> : sid.hashCode());</span><br><span class="line">result = prime * result + ((sname == <span class="literal">null</span>) ? <span class="number">0</span> : sname.hashCode());</span><br><span class="line">result = prime * result + ((tel == <span class="literal">null</span>) ? <span class="number">0</span> : tel.hashCode());</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span> == obj)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">if</span> (obj == <span class="literal">null</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (getClass() != obj.getClass())</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="type">StudentInfo</span> <span class="variable">other</span> <span class="operator">=</span> (StudentInfo) obj;</span><br><span class="line"><span class="keyword">if</span> (addr == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (other.addr != <span class="literal">null</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!addr.equals(other.addr))</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (cid == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (other.cid != <span class="literal">null</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!cid.equals(other.cid))</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (sid == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (other.sid != <span class="literal">null</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!sid.equals(other.sid))</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (sname == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (other.sname != <span class="literal">null</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!sname.equals(other.sname))</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (tel == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (other.tel != <span class="literal">null</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!tel.equals(other.tel))</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;StudentInfo [sid=&quot;</span> + sid + <span class="string">&quot;, sname=&quot;</span> + sname + <span class="string">&quot;, cid=&quot;</span> + cid + <span class="string">&quot;, tel=&quot;</span> + tel + <span class="string">&quot;, addr=&quot;</span> + addr</span><br><span class="line">+ <span class="string">&quot;]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">StudentInfo</span><span class="params">(Integer sid, String sname, Integer cid, String tel, String addr)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line"><span class="built_in">this</span>.sid = sid;</span><br><span class="line"><span class="built_in">this</span>.sname = sname;</span><br><span class="line"><span class="built_in">this</span>.cid = cid;</span><br><span class="line"><span class="built_in">this</span>.tel = tel;</span><br><span class="line"><span class="built_in">this</span>.addr = addr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">StudentInfo</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="第三步，我们要准备数据库配置文件"><a href="#第三步，我们要准备数据库配置文件" class="headerlink" title="第三步，我们要准备数据库配置文件"></a>第三步，我们要准备数据库配置文件</h3><p>这个自行确定，账号密码请你更改为自己安装数据库的账号密码，我给出我的实例==db.properties==</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/mybatis_stu?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=GMT%2B8&amp;useOldAliasMetadataBehavior=true</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure><h3 id="第四步，创建mybatis配置文件"><a href="#第四步，创建mybatis配置文件" class="headerlink" title="第四步，创建mybatis配置文件"></a>第四步，创建mybatis配置文件</h3><p>有了上边三步的基础之后，我们需要配置<code>mybatis-config.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"> <span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span> </span></span><br><span class="line"><span class="meta"> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入配置文件 请好好的看我  我是db.properties --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;db.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置环境变量 development :开发环境 work :工作环境 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 事务管理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置数据库连接信息 POOLED UNPOOLED --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 加载mapper指向位置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mapper/ClassInfoMapper.xml&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mapper/StudentInfoMapper.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>至此，第四步就完成。</p><h3 id="第五步-配置映射"><a href="#第五步-配置映射" class="headerlink" title="第五步,配置映射"></a>第五步,配置映射</h3><p>我想说的这上面的每一步都很重要，但是这一步也很重要，我们将相关SQL语句全部写在这里，这一步，我们其实可以说是直接对数据库进行操作,我的理解是这样的，但是不同的人有不同的理解，我也不能去把我的思想强加给别人，对吧？</p><p>==对了，如果你是初学者，我推荐你了解一下我在本项目的注释==<br>==ClassInfoMapper.xml==</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"> <span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">  <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> </span></span><br><span class="line"><span class="meta">  <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- namespace :命名空间 ，就是用来避免命名冲突的，同一个命名空间下面都不能出现相同的id</span></span><br><span class="line"><span class="comment">时间上这个就是指向 &quot;ClassInfo.findAll&quot; 测试类的这个属性的ClassInfo代表命名空间，findAll代表id</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;ClassInfo&quot;</span>&gt;</span>  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 写insert delete update select 语句 每一个语句都有一个id,到时候通过命名空间.id 来获取对应的sql语句执行 </span></span><br><span class="line"><span class="comment">通过paramenterType 属性来指定这个sql执行语句的参数 通过resultType属性指定这个sql语句后返回值的类型，是每条结果对应的类型 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.xh.mybatis.bean.ClassInfo&quot;</span>&gt;</span></span><br><span class="line">select cid,cname from classinfo;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 假设我们要查询某单一的字段，我们需要的操作是如下 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;find&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.xh.mybatis.bean.ClassInfo&quot;</span>&gt;</span></span><br><span class="line">select cid,cname from classinfo</span><br><span class="line">where cname=#&#123;cname&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;add&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xh.mybatis.bean.ClassInfo&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--#&#123;&#125; 采用预编译的方式 $&#123;&#125; 采用字符串拼接的方法 --&gt;</span></span><br><span class="line">insert into classinfo values(0,#&#123;cname&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 模糊查询 vague &#x27;%$&#123;parameters&#125;%&#x27; %#&#123;parameters&#125;%此时这个语句是有问题的，不能这么写 应该是 &#x27;%#&#123;parameters&#125;%&#x27; </span></span><br><span class="line"><span class="comment">_$&#123;parameters&#125;这种模糊查询也是可以的，但是没有%那么灵活，不过你觉得你使用哪个舒服就使用哪个 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByVague&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">resultType</span>=<span class="string">&quot;com.xh.mybatis.bean.ClassInfo&quot;</span>&gt;</span></span><br><span class="line">select cid,cname from classinfo where cname like</span><br><span class="line">&#x27;_$&#123;parameters&#125;&#x27;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--更新表中的数据 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">parameterType</span>=<span class="string">&quot;com.xh.mybatis.bean.ClassInfo&quot;</span>&gt;</span></span><br><span class="line">update classinfo set cname = #&#123;cname&#125; where cid =</span><br><span class="line">#&#123;cid&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 删除表中的数据 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;delete&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">parameterType</span>=<span class="string">&quot;com.xh.mybatis.bean.ClassInfo&quot;</span>&gt;</span></span><br><span class="line">delete from classinfo where cid = #&#123;cid&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>另一个文件StudentInfoMapper.xml我不会在本篇使用，故而我不在本篇展示，如果你感兴趣的话，请查看下篇。</p><h3 id="第六步，测试类的编写"><a href="#第六步，测试类的编写" class="headerlink" title="第六步，测试类的编写"></a>第六步，测试类的编写</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xh.mybatis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xh.mybatis.bean.ClassInfo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * classinfo中的所有的值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">reader</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>)</span><br><span class="line">)&#123;</span><br><span class="line"><span class="comment">//创建sqlSession工厂</span></span><br><span class="line"></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(reader);</span><br><span class="line">System.out.println(<span class="string">&quot;-----------&quot;</span>);</span><br><span class="line"><span class="comment">//从sqlsession工厂中获取一个sql会话</span></span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过这个回话执行与sql语句 </span></span><br><span class="line"><span class="comment">//将从表中查询的多条数据以作为对象的方式添加到list中</span></span><br><span class="line">List&lt;ClassInfo&gt; cls = sqlSession.selectList(<span class="string">&quot;ClassInfo.findAll&quot;</span>);</span><br><span class="line"><span class="comment">//遍历list中的所有的值</span></span><br><span class="line">cls.forEach(System.out::println);</span><br><span class="line">sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在classinfo表中添加值 ，非动态添加</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">reader</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>))&#123;</span><br><span class="line"><span class="comment">//创建sqlSession工厂</span></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(reader);</span><br><span class="line"></span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过这个回话执行与sql语句，      </span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这里的new ClassInfo对象是由于我们创建的表是主键存在主键自增，故而在构造方法中不需要添加cid</span></span><br><span class="line"><span class="comment"> * 我们可以选择几种方式，这边我们对构造方法可以进行多种构造，让构造方法去选择添加，也可以直接用全部构造</span></span><br><span class="line"><span class="comment"> * 不够就是我们需要对构造方法进行置空处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> sqlSession.insert(<span class="string">&quot;ClassInfo.add&quot;</span>,<span class="keyword">new</span> <span class="title class_">ClassInfo</span>(<span class="string">&quot;相关&quot;</span>));</span><br><span class="line">System.out.println(result);</span><br><span class="line">sqlSession.commit();</span><br><span class="line">sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ClassInfo表中</span></span><br><span class="line"><span class="comment"> * mybatis查询某数据库中某个值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="type">InputStream</span> <span class="variable">reader</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"><span class="comment">//创建SqlSession工厂</span></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(reader);</span><br><span class="line"></span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line"><span class="comment">//我们可以查看到当前查到的对象可以被查出来</span></span><br><span class="line"><span class="comment">//ClassInfo obj = sqlSession.selectOne(&quot;ClassInfo.find&quot;,new ClassInfo(&quot;四班&quot;));</span></span><br><span class="line"><span class="comment">//ClassInfo.find表示调用Mybatis中的com.xh.bean.ClassInfo下的id=find的sql语句</span></span><br><span class="line"><span class="comment">//如果我们使用的是MVC架构进行开发，这个语句应该是属于serviceImpl层调用dao接口的时候</span></span><br><span class="line"><span class="type">ClassInfo</span> <span class="variable">obj</span> <span class="operator">=</span> sqlSession.selectOne(<span class="string">&quot;ClassInfo.find&quot;</span>,<span class="string">&quot;四班&quot;</span>);</span><br><span class="line"><span class="comment">//查找单个</span></span><br><span class="line"><span class="comment">//int result = sqlSession.selectOne(&quot;Classinfo.find&quot;,&quot;四班&quot;);</span></span><br><span class="line">System.out.println(obj);</span><br><span class="line">sqlSession.commit();</span><br><span class="line">sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用模糊查询classInfo中的数据</span></span><br><span class="line"><span class="comment"> * 没做动态查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="type">InputStream</span> <span class="variable">reader</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"><span class="comment">//创建sqlSession工厂</span></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(reader);</span><br><span class="line">System.out.println(<span class="string">&quot;-----------&quot;</span>);</span><br><span class="line"><span class="comment">//从sqlsession工厂中获取一个sql会话</span></span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过这个回话执行与sql语句 </span></span><br><span class="line"><span class="comment">//将从表中查询的多条数据以作为对象的方式添加到list中</span></span><br><span class="line">List&lt;ClassInfo&gt; cls = sqlSession.selectList(<span class="string">&quot;ClassInfo.findByVague&quot;</span>,<span class="string">&quot;班&quot;</span>);</span><br><span class="line"><span class="comment">//遍历list中的所有的值</span></span><br><span class="line">cls.forEach(System.out::println);</span><br><span class="line">sqlSession.commit();</span><br><span class="line">sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新表中数据，先从简单的开始，ClassInfo表中的数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test5</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="type">InputStream</span> <span class="variable">reader</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"><span class="comment">//创建sqlSession工厂</span></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(reader);</span><br><span class="line">System.out.println(<span class="string">&quot;-----------&quot;</span>);</span><br><span class="line"><span class="comment">//从sqlsession工厂中获取一个sql会话</span></span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过这个回话执行与sql语句 </span></span><br><span class="line"><span class="comment">//将从表中查询的多条数据以作为对象的方式添加到list中</span></span><br><span class="line"><span class="type">ClassInfo</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassInfo</span>();</span><br><span class="line"></span><br><span class="line">obj.setCid(<span class="number">1</span>);</span><br><span class="line">obj.setCname(<span class="string">&quot;一班&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> sqlSession.update(<span class="string">&quot;ClassInfo.update&quot;</span>,obj);</span><br><span class="line"><span class="keyword">if</span>(result &gt; <span class="number">0</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;更新成功&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;更新失败&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">List&lt;ClassInfo&gt; cls = sqlSession.selectList(<span class="string">&quot;ClassInfo.findAll&quot;</span>);</span><br><span class="line"><span class="comment">//遍历list中的所有的值</span></span><br><span class="line">cls.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line"><span class="comment">//注意在开启事务的情况下，你不提交数据库是查不到值的</span></span><br><span class="line">sqlSession.commit();</span><br><span class="line"></span><br><span class="line">sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test6</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line"><span class="type">InputStream</span> <span class="variable">reader</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"><span class="comment">//创建sqlSession工厂</span></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(reader);</span><br><span class="line"></span><br><span class="line"><span class="comment">//从sqlsession工厂中获取一个sql会话</span></span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">List&lt;ClassInfo&gt; cls = sqlSession.selectList(<span class="string">&quot;ClassInfo.findAll&quot;</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;删除之前的数据&quot;</span>);</span><br><span class="line">cls.forEach(System.out::println);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * ClassInfo obj = new ClassInfo(); obj.setCid(7);</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> sqlSession.delete(<span class="string">&quot;ClassInfo.delete&quot;</span>,<span class="number">8</span>);</span><br><span class="line"><span class="keyword">if</span>(result &gt; <span class="number">0</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;删除失败&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//注意在开启事务的情况下，你不提交数据库是查不到值的</span></span><br><span class="line">sqlSession.commit();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;删除之后的数据&quot;</span>);</span><br><span class="line">List&lt;ClassInfo&gt; cls1 = sqlSession.selectList(<span class="string">&quot;ClassInfo.findAll&quot;</span>);</span><br><span class="line"><span class="comment">//遍历list中的所有的值</span></span><br><span class="line">cls1.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">sqlSession.close();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//至此，上边对mybatis的简单操作到此结束</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="mybatis-注意事项："><a href="#mybatis-注意事项：" class="headerlink" title="mybatis 注意事项："></a>mybatis 注意事项：</h3><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">### #&#123;&#125; 和 $&#123;&#125; 的区别</span><br></pre></td></tr></table></figure><p> 注意：#{}是预编译处理，${}是字符替换</p><p>注意：#{}会在mybatis运行的过程中替换为？，调用PreparedStatement的set方法来赋值。</p><p>mybatis 在处理$()会将他替换为变量的值。</p><p>多使用#{}可以防止sql注入，提高系统安全性。</p><p>mybatis 推荐还是使用分页插件</p><p>一般mybatis是使用RowBounds对象进行分页，他是针对ResultSet结果集执行的内存分页，而非物理分页，可以在sql内直接书写带有物理分页的参数来完成物理分页功能，也可以使用分页插件来完成物理分页。</p><p>分页插件的原理是，在mybatis提供的接口，实现自定义插件，在将插件的拦截方法内拦截执行的sql，然后重写sql，根据dialect方言，添加对应的物理分页语句和物理分页查询。</p><p>如果使用mysql的limit的话会可能会出现数据丢失，索引失效等错误。</p><h2 id="动态查询和动态添加以及动态修改"><a href="#动态查询和动态添加以及动态修改" class="headerlink" title="动态查询和动态添加以及动态修改"></a>动态查询和动态添加以及动态修改</h2><p>接上一节，注意本博客所有的代码都是建立在上一讲之上的，如果你没有上一讲的配置，这一讲代码我推荐你还是看看，直接搭建环境需要你有上一讲配置完毕，否则会出现许多错误，另外本篇并没有完成Mybatis动态SQL拼接的全部，只是举例一部分进行说明，我们在工作上或者实际生活中使用Mybatis，也是给我自己记录笔记，将来可以进行重构，然后慢慢完善。</p><p>废话不多说，我们开始：</p><p>第一步，完善上一篇没完善的代码。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentInfo</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Integer sid;<span class="comment">//学生id</span></span><br><span class="line"><span class="keyword">private</span> String sname;<span class="comment">//学生姓名</span></span><br><span class="line"><span class="keyword">private</span> Integer cid; <span class="comment">//外键管理，类id</span></span><br><span class="line"><span class="keyword">private</span> String tel; <span class="comment">//电话号码</span></span><br><span class="line"><span class="keyword">private</span> String addr;<span class="comment">//地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//添加一个多值传入的方法 在实体类中创建一个List用于存放要删除的sid</span></span><br><span class="line"><span class="keyword">private</span> List&lt;Integer&gt; sidList;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">getSidList</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> sidList;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSidList</span><span class="params">(List&lt;Integer&gt; sidList)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.sidList = sidList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">StudentInfo</span><span class="params">(List&lt;Integer&gt; sidList)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line"><span class="built_in">this</span>.sidList = sidList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">getSid</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> sid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSid</span><span class="params">(Integer sid)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.sid = sid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getSname</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> sname;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSname</span><span class="params">(String sname)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.sname = sname;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">getCid</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> cid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCid</span><span class="params">(Integer cid)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.cid = cid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getTel</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> tel;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTel</span><span class="params">(String tel)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.tel = tel;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getAddr</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> addr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddr</span><span class="params">(String addr)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.addr = addr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">final</span> <span class="type">int</span> <span class="variable">prime</span> <span class="operator">=</span> <span class="number">31</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">result = prime * result + ((addr == <span class="literal">null</span>) ? <span class="number">0</span> : addr.hashCode());</span><br><span class="line">result = prime * result + ((cid == <span class="literal">null</span>) ? <span class="number">0</span> : cid.hashCode());</span><br><span class="line">result = prime * result + ((sid == <span class="literal">null</span>) ? <span class="number">0</span> : sid.hashCode());</span><br><span class="line">result = prime * result + ((sname == <span class="literal">null</span>) ? <span class="number">0</span> : sname.hashCode());</span><br><span class="line">result = prime * result + ((tel == <span class="literal">null</span>) ? <span class="number">0</span> : tel.hashCode());</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span> == obj)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">if</span> (obj == <span class="literal">null</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (getClass() != obj.getClass())</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="type">StudentInfo</span> <span class="variable">other</span> <span class="operator">=</span> (StudentInfo) obj;</span><br><span class="line"><span class="keyword">if</span> (addr == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (other.addr != <span class="literal">null</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!addr.equals(other.addr))</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (cid == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (other.cid != <span class="literal">null</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!cid.equals(other.cid))</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (sid == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (other.sid != <span class="literal">null</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!sid.equals(other.sid))</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (sname == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (other.sname != <span class="literal">null</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!sname.equals(other.sname))</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span> (tel == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (other.tel != <span class="literal">null</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!tel.equals(other.tel))</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;StudentInfo [sid=&quot;</span> + sid + <span class="string">&quot;, sname=&quot;</span> + sname + <span class="string">&quot;, cid=&quot;</span> + cid + <span class="string">&quot;, tel=&quot;</span> + tel + <span class="string">&quot;, addr=&quot;</span> + addr</span><br><span class="line">+ <span class="string">&quot;]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">StudentInfo</span><span class="params">(Integer sid, String sname, Integer cid, String tel, String addr)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line"><span class="built_in">this</span>.sid = sid;</span><br><span class="line"><span class="built_in">this</span>.sname = sname;</span><br><span class="line"><span class="built_in">this</span>.cid = cid;</span><br><span class="line"><span class="built_in">this</span>.tel = tel;</span><br><span class="line"><span class="built_in">this</span>.addr = addr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">StudentInfo</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实体bean类，作为我们mybatis的映射文件，==注意，本篇和上篇都是简单的进行Mybatis的理解，在正式生产环境会有所差别==，本文档并没有十分规范的按照MVC模式进行，故而请各位体谅。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"> <span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">  <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> </span></span><br><span class="line"><span class="meta">  <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- namespace :命名空间 ，就是用来避免命名冲突的，同一个命名空间下面都不能出现相同的id --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;StudentInfo&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- mybatis-config.xml 中 &lt;typeAlias type=&quot;com.someapp.model.User&quot; alias=&quot;User&quot;/&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 写insert delete update select 语句 每一个语句都有一个id,到时候通过命名空间.id 来获取对应的sql语句执行 </span></span><br><span class="line"><span class="comment">通过paramenterType 属性来指定这个sql执行语句的参数 通过resultType属性指定这个sql语句后返回值的类型，是每条结果对应的类型 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">resultType</span>=<span class="string">&quot;com.xh.mybatis.bean.StudentInfo&quot;</span>&gt;</span></span><br><span class="line">select sid,sname,cname,tel,addr from classinfo c, stuinfo s</span><br><span class="line">where c.cid = s.cid order by sid asc;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 让我们对具体多个值进行查找 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByValue&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">resultType</span>=<span class="string">&quot;com.xh.mybatis.bean.StudentInfo&quot;</span>&gt;</span></span><br><span class="line">select sid,sname,tel,addr from stuinfo</span><br><span class="line"><span class="comment">&lt;!-- 动态SQL之前，我们先把最艰简单的sql语句添加上来 注意，在条件语句上，我们必须来一个一定成立的条件，方便我们对数据进行读取和判断，或者你确定了用户一定会输入值，否则不要轻易在这里留坑 --&gt;</span></span><br><span class="line"></span><br><span class="line">where sid != 0</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sname != null&quot;</span>&gt;</span></span><br><span class="line">and sname = #&#123;sname&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 注意，我这边缺一点东西，就是判断的时候，我们会有一个判断是否存在,的语句，如果存在多余的我还要将其分离出来 注意正确的sql语句书写 </span></span><br><span class="line"><span class="comment">and tel = #&#123;tel&#125; , addr = #&#123;addr&#125;是错误的写法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;tel != null and addr != null&quot;</span>&gt;</span></span><br><span class="line">and tel = #&#123;tel&#125; and addr = #&#123;addr&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">order by sid asc;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 我觉得动态添加其实没必要，虽然我寻思也有，但是我还是觉得，动态添加真的没必要，毕竟这特么有点反人类，我寻思，让你添加数据，你特么 老老实实给我把数据填写完毕不就行了吗？ </span></span><br><span class="line"><span class="comment">还有就是，我们可以在业务层直接处理，在前端传数据过来，我们就可以判断然后将没传的值置空处理 如果你非要做，我给你这个参考一下 数据库支持多行插入 </span></span><br><span class="line"><span class="comment">&lt;insert id=&quot;insertTable&quot; useGeneratedKeys=&quot;true&quot; keyProperty=&quot;id&quot; parameterType </span></span><br><span class="line"><span class="comment">= &quot;com.***&quot;&gt; </span></span><br><span class="line"><span class="comment">insert into table (username, password, email, bio) values </span></span><br><span class="line"><span class="comment">&lt;foreach item=&quot;item&quot; collection=&quot;list&quot; separator=&quot;,&quot;&gt;</span></span><br><span class="line"><span class="comment"> (#&#123;item.username&#125;, #&#123;item.password&#125;, </span></span><br><span class="line"><span class="comment">#&#123;item.email&#125;, #&#123;item.bio&#125;) </span></span><br><span class="line"><span class="comment">&lt;/foreach&gt; </span></span><br><span class="line"><span class="comment">&lt;/insert&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;add&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xh.mybatis.bean.StudentInfo&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--#&#123;&#125; 采用预编译的方式 $&#123;&#125; 采用字符串拼接的方法 --&gt;</span></span><br><span class="line">insert into stuinfo values(0,#&#123;sname&#125;,#&#123;cid&#125;,#&#123;tel&#125;,#&#123;addr&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--接下来就是我们的删除操作了，这个就很简单了，动态删除？ 得了吧，我这边给个思路，但是我不做，也就是一次传多个值，然后删除多个值，</span></span><br><span class="line"><span class="comment">1 delete from table where sid in( $&#123;sid&#125; ) 这也是一种方式</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> &lt;select id=&quot;deleteByIds&quot; parameterType=&quot;Integer&quot;&gt; </span></span><br><span class="line"><span class="comment">delete from accounts where id in </span></span><br><span class="line"><span class="comment">&lt;foreach collection=&quot;ids&quot; open=&quot;(&quot; close=&quot;)&quot; </span></span><br><span class="line"><span class="comment">separator=&quot;,&quot; item=&quot;id&quot;&gt; #&#123;id&#125; </span></span><br><span class="line"><span class="comment">&lt;/foreach&gt; </span></span><br><span class="line"><span class="comment">&lt;/select&gt; </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;delete id=&quot;deleteValue&quot; </span></span><br><span class="line"><span class="comment">parameterType=&quot;com.xh.mybatis.bean.StudentInfo&quot;&gt; delete from stuinfo where </span></span><br><span class="line"><span class="comment">sid != 0 and sid = #&#123;sid&#125;; </span></span><br><span class="line"><span class="comment">&lt;/delete&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteValue&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">parameterType</span>=<span class="string">&quot;com.xh.mybatis.bean.StudentInfo&quot;</span>&gt;</span></span><br><span class="line">delete from stuinfo where cid != 0 and sid = #&#123;sid&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 重头戏来了，我们有些时候会涉及到改操作，但是改操作只对用户的某一个数据进行更改 也可能对多个数据进行更改，故而我们需要判断用户传过来的数据，这个时候就很重要了 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">parameterType</span>=<span class="string">&quot;com.xh.mybatis.bean.StudentInfo&quot;</span>&gt;</span></span><br><span class="line">update stuinfo set</span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sname != null&quot;</span>&gt;</span></span><br><span class="line">sname = #&#123;sname&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;cid != null&quot;</span>&gt;</span></span><br><span class="line">, cid = #&#123;cid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;tel != null&quot;</span>&gt;</span></span><br><span class="line">, tel = #&#123;tel&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;addr != null&quot;</span>&gt;</span></span><br><span class="line">, addr = #&#123;addr&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">where sid = #&#123;sid&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line">     </span><br></pre></td></tr></table></figure><p>这里我们主要使用if语句来判断用户是否传值，如果传值，我们采用mybatis判断进行动态拼接。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StuTest</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询表中所有数据，studentInfo，先从一个简单的表开始吧，然后逐层加难</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">//加载mybatis-config.xml配置文件</span></span><br><span class="line">   <span class="type">InputStream</span> <span class="variable">reader</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"><span class="comment">//创建sqlSession工厂</span></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(reader);</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">List&lt;StudentInfo&gt; cls = sqlSession.selectList(<span class="string">&quot;StudentInfo.findAll&quot;</span>);</span><br><span class="line"><span class="comment">//遍历list中的所有的值</span></span><br><span class="line">cls.forEach(System.out::println);</span><br><span class="line">sqlSession.commit();</span><br><span class="line">sqlSession.close();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 多值查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">//加载mybatis-config.xml配置文件</span></span><br><span class="line">   <span class="type">InputStream</span> <span class="variable">reader</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"><span class="comment">//创建sqlSession工厂</span></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(reader);</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"><span class="comment">//多值查询，为了避免我使用new StudentInfo(****)</span></span><br><span class="line"><span class="type">StudentInfo</span> <span class="variable">stu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StudentInfo</span>();</span><br><span class="line"><span class="comment">//注意，这里我就开始使用动态sql进行判断了</span></span><br><span class="line">stu.setSname(<span class="string">&quot;王老五&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//stu.setTel(&quot;15973121101&quot;);</span></span><br><span class="line"><span class="comment">//stu.setAddr(&quot;湖南衡阳&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//我们查询的时候可以是一个值，也可以是多个值，故而我们通常将查到的值存到集合中，至于是哪种集合，你选择</span></span><br><span class="line">List&lt;StudentInfo&gt; cls = sqlSession.selectList(<span class="string">&quot;StudentInfo.findByValue&quot;</span>, stu);</span><br><span class="line"></span><br><span class="line"><span class="comment">//遍历list中的所有的值</span></span><br><span class="line">cls.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">sqlSession.commit();</span><br><span class="line">sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 多值添加</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">//加载mybatis-config.xml配置文件</span></span><br><span class="line">   <span class="type">InputStream</span> <span class="variable">reader</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"><span class="comment">//创建sqlSession工厂</span></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(reader);</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"><span class="comment">//先查询所有数据</span></span><br><span class="line">List&lt;StudentInfo&gt; cls = sqlSession.selectList(<span class="string">&quot;StudentInfo.findAll&quot;</span>);</span><br><span class="line">cls.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line"><span class="type">StudentInfo</span> <span class="variable">stu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StudentInfo</span>();</span><br><span class="line"></span><br><span class="line">stu.setSname(<span class="string">&quot;王老五&quot;</span>);</span><br><span class="line">stu.setCid(<span class="number">1</span>);</span><br><span class="line">stu.setTel(<span class="string">&quot;16682187574&quot;</span>);</span><br><span class="line">stu.setAddr(<span class="string">&quot;湖南长沙&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> sqlSession.insert(<span class="string">&quot;StudentInfo.add&quot;</span>,stu);</span><br><span class="line"><span class="keyword">if</span>(result &gt; <span class="number">0</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;添加成功&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;添加失败&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//遍历list中的所有的值</span></span><br><span class="line">sqlSession.commit();</span><br><span class="line"></span><br><span class="line"><span class="comment">//插入后提交成功之后再次查询</span></span><br><span class="line">List&lt;StudentInfo&gt; cls1 = sqlSession.selectList(<span class="string">&quot;StudentInfo.findAll&quot;</span>);</span><br><span class="line">cls1.forEach(System.out::println);</span><br><span class="line">sqlSession.close();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">//加载mybatis-config.xml配置文件</span></span><br><span class="line">   <span class="type">InputStream</span> <span class="variable">reader</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"><span class="comment">//创建sqlSession工厂</span></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(reader);</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"><span class="comment">//在删除之前，我们先查询表中数据</span></span><br><span class="line">List&lt;StudentInfo&gt; cls = sqlSession.selectList(<span class="string">&quot;StudentInfo.findAll&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//遍历list中的所有的值</span></span><br><span class="line">cls.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line"><span class="type">StudentInfo</span> <span class="variable">stu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StudentInfo</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//System.out.println(sidList);</span></span><br><span class="line"><span class="comment">//System.out.println(stu.getSidList());</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//你要删除的id号</span></span><br><span class="line">stu.setSid(<span class="number">8</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> sqlSession.delete(<span class="string">&quot;StudentInfo.deleteValue&quot;</span>,stu);</span><br><span class="line"><span class="keyword">if</span>(result &gt; <span class="number">0</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;删除失败&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sqlSession.commit();</span><br><span class="line"></span><br><span class="line">List&lt;StudentInfo&gt; cls1 = sqlSession.selectList(<span class="string">&quot;StudentInfo.findAll&quot;</span>);</span><br><span class="line"><span class="comment">//遍历list中的所有的值</span></span><br><span class="line">cls1.forEach(System.out::println);</span><br><span class="line">sqlSession.close();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test5</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">//加载mybatis-config.xml配置文件</span></span><br><span class="line">   <span class="type">InputStream</span> <span class="variable">reader</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"><span class="comment">//创建sqlSession工厂</span></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(reader);</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"><span class="comment">//多值查询，为了避免我使用new StudentInfo(****)</span></span><br><span class="line"><span class="type">StudentInfo</span> <span class="variable">stu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StudentInfo</span>();</span><br><span class="line"><span class="comment">//注意，这里我就开始使用动态sql进行判断了</span></span><br><span class="line"><span class="comment">//cid为空只是因为我没查，不要误会。</span></span><br><span class="line">stu.setSname(<span class="string">&quot;王老六&quot;</span>);  <span class="comment">//StudentInfo [sid=9, sname=王老六, cid=null, tel=16682187574, addr=湖南长沙]</span></span><br><span class="line">stu.setCid(<span class="number">2</span>);  <span class="comment">//更改班级编号，前台条件班级必须存在</span></span><br><span class="line">stu.setSid(<span class="number">9</span>);  <span class="comment">//更新语句的条件</span></span><br><span class="line"></span><br><span class="line">stu.setTel(<span class="string">&quot;15973121103&quot;</span>);</span><br><span class="line">stu.setAddr(<span class="string">&quot;湖南衡阳&quot;</span>);</span><br><span class="line"><span class="comment">// 更新后的数据 StudentInfo [sid=9, sname=王老六, cid=null, tel=15973121103, addr=湖南衡阳]</span></span><br><span class="line"><span class="comment">//我们查询的时候可以是一个值，也可以是多个值，故而我们通常将查到的值存到集合中，至于是哪种集合，你选择</span></span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> sqlSession.update(<span class="string">&quot;StudentInfo.update&quot;</span>,stu);</span><br><span class="line"><span class="keyword">if</span>(result &gt; <span class="number">0</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;更新成功&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;更新失败&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">List&lt;StudentInfo&gt; cls = sqlSession.selectList(<span class="string">&quot;StudentInfo.findByValue&quot;</span>, stu);</span><br><span class="line"></span><br><span class="line">cls.forEach(System.out::println);</span><br><span class="line">sqlSession.commit();</span><br><span class="line">sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="mybatis-Spring框架"><a href="#mybatis-Spring框架" class="headerlink" title="mybatis + Spring框架"></a>mybatis + Spring框架</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建一个简单的数据库</span></span><br><span class="line"><span class="keyword">create</span> database mybatis if <span class="keyword">not</span> <span class="keyword">exists</span> ;</span><br><span class="line">use mybatis;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(</span><br><span class="line">id <span class="type">int</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">primary</span> key ,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">default</span> <span class="keyword">null</span>,</span><br><span class="line">    pwd <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">default</span> <span class="keyword">null</span></span><br><span class="line">)engine<span class="operator">=</span>innoDB <span class="keyword">default</span> charset<span class="operator">=</span>utf8;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>安装mybatis</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>快速上手</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactory</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">SqlSessionFactoryBean</span> <span class="variable">factoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">    factoryBean.setDataSource(dataSource());</span><br><span class="line">    <span class="keyword">return</span> factoryBean.getObject();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：<code>SqlSessionFactory</code> 需要一个 <code>DataSource</code>（数据源）。这可以是任意的 <code>DataSource</code>，只需要和配置其它 Spring 数据库连接一样配置它就可以了。 </p><p>假设你定义了一个如下的 mapper 接口： </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">  <span class="meta">@Select(&quot;SELECT * FROM users WHERE id = #&#123;userId&#125;&quot;)</span></span><br><span class="line">  User <span class="title function_">getUser</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span> String userId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那么可以通过 <code>MapperFactoryBean</code> 将接口加入到 Spring 中: </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userMapper&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperFactoryBean&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperInterface&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.mybatis.spring.sample.mapper.UserMapper&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>需要注意的是：所指定的映射器类<strong>必须</strong>是一个接口，而不是具体的实现类。在这个示例中，通过注解来指定 SQL 语句，但是也可以使用 MyBatis 映射器的 XML 配置文件。</p><p>配置好之后，你就可以像 Spring 中普通的 bean 注入方法那样，将映射器注入到你的业务或服务对象中。<code>MapperFactoryBean</code> 将会负责 <code>SqlSession</code> 的创建和关闭。 如果使用了 Spring 的事务功能，那么当事务完成时，session 将会被提交或回滚。最终任何异常都会被转换成 Spring 的 <code>DataAccessException</code> 异常。</p><p>使用 Java 代码来配置的方式如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="keyword">public</span> UserMapper <span class="title function_">userMapper</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">SqlSessionTemplate</span> <span class="variable">sqlSessionTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionTemplate</span>(sqlSessionFactory());</span><br><span class="line">    <span class="keyword">return</span> sqlSessionTemplate.getMapper(UserMapper.class);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>要调用 MyBatis 的数据方法，只需一行代码： </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FooServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">FooService</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">FooServiceImpl</span><span class="params">(UserMapper userMapper)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.userMapper = userMapper;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> User <span class="title function_">doSomeBusinessStuff</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.userMapper.getUser(userId);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Mybatis-Spring"><a href="#Mybatis-Spring" class="headerlink" title="Mybatis-Spring"></a>Mybatis-Spring</h3><p>MyBatis-Spring 会帮助你将 MyBatis 代码无缝地整合到 Spring 中。它将允许 MyBatis 参与到 Spring 的事务管理之中，创建映射器 mapper 和 <code>SqlSession</code> 并注入到 bean 中，以及将 Mybatis 的异常转换为 Spring 的 <code>DataAccessException</code>。 最终，可以做到应用代码不依赖于 MyBatis，Spring 或 MyBatis-Spring。 </p><div class="table-container"><table><thead><tr><th>MyBatis-Spring</th><th>MyBatis</th><th>Spring Framework</th><th>Spring Batch</th><th>Java</th></tr></thead><tbody><tr><td><strong>2.0</strong></td><td>3.5+</td><td>5.0+</td><td>4.0+</td><td>Java 8+</td></tr><tr><td><strong>1.3</strong></td><td>3.4+</td><td>3.2.2+</td><td>2.1+</td><td>Java 6+</td></tr></tbody></table></div><p>初始配置文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta"> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>枚举类型配置案例</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">    <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">    <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;org.apache.ibatis.submitted.rounding.Mapper&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;org.apache.ibatis.submitted.rounding.User&quot;</span> <span class="attr">id</span>=<span class="string">&quot;usermap&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;funkyNumber&quot;</span> <span class="attr">property</span>=<span class="string">&quot;funkyNumber&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;roundingMode&quot;</span> <span class="attr">property</span>=<span class="string">&quot;roundingMode&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUser&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;usermap&quot;</span>&gt;</span></span><br><span class="line">select * from users</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span>&gt;</span></span><br><span class="line">    insert into users (id, name, funkyNumber, roundingMode) values (</span><br><span class="line">    #&#123;id&#125;, #&#123;name&#125;, #&#123;funkyNumber&#125;, #&#123;roundingMode&#125;</span><br><span class="line">    )</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;org.apache.ibatis.submitted.rounding.User&quot;</span> <span class="attr">id</span>=<span class="string">&quot;usermap2&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;funkyNumber&quot;</span> <span class="attr">property</span>=<span class="string">&quot;funkyNumber&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;roundingMode&quot;</span> <span class="attr">property</span>=<span class="string">&quot;roundingMode&quot;</span> <span class="attr">typeHandler</span>=<span class="string">&quot;org.apache.ibatis.type.EnumTypeHandler&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUser2&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;usermap2&quot;</span>&gt;</span></span><br><span class="line">select * from users2</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert2&quot;</span>&gt;</span></span><br><span class="line">    insert into users2 (id, name, funkyNumber, roundingMode) values (</span><br><span class="line">    #&#123;id&#125;, #&#123;name&#125;, #&#123;funkyNumber&#125;, #&#123;roundingMode, typeHandler=org.apache.ibatis.type.EnumTypeHandler&#125;</span><br><span class="line">    )</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>mybatis链接数据库的xml书写</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--这是一种写法可以将驱动写在类里边，然后通过将依赖注入值@Value--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/example/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><p>链接mysql链接依赖url</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis?useSSL=true<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8&quot;</span>/&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">本文将从0到1搭建Mybatis项目，并实现使用mybatis完成简单的对数据库的增删改查操作</summary>
    
    
    
    <category term="框架学习" scheme="https://www.blog.909111.xyz/categories/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="java" scheme="https://www.blog.909111.xyz/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>Git实现文件上传到github或者gitee</title>
    <link href="https://www.blog.909111.xyz/posts/8d32597a.html"/>
    <id>https://www.blog.909111.xyz/posts/8d32597a.html</id>
    <published>2024-04-02T09:00:00.000Z</published>
    <updated>2024-04-22T08:14:16.144Z</updated>
    
    <content type="html"><![CDATA[<ol><li>在本地项目目录创建本地仓库</li></ol><p>​      <code>git init</code></p><p>​        输入完命令后项目目录会有一个隐藏的.git文件夹</p><ol><li>上传所有代码到本地仓库</li></ol><p>​       <code>git add .</code> (注:后面点不能少)</p><ol><li>代码上传到本地仓库后执行提交命令</li></ol><p>​      <code>git commit -m &quot;项目名称&quot;</code></p><ol><li><p>在GitHub上新建一个repository （步骤1）</p></li><li><p>关联本地仓库并上传代码</p></li></ol><p>​      <code>git remote add origin [https://github.com/xxx.git(新建repository后会有一个地址)]</code></p><ol><li>最后执行上传推送命令</li></ol><p>​     <code>git push origin master</code></p><p>完成代码的上传</p><p>二，更新修改代码</p><p>1，先进入到项目根目录下:cd xx:\ 查看是否有冲突：<br>　　　<code>git status</code></p><p>2、将当前工作目录中更改或者新增的文件加入到Git的索引中，加入到Git的索引中就表示记入了版本历史中<br>　　　<code>git add .</code><br>3、添加注释（必填）：<br>　　　<code>git commit -m “注释内容”</code><br>4、提交本次修改到远程仓库</p><p>　　　<code>git push https://github.com/vofill/test.git</code></p><p>三、从GitHub上通过命令down代码</p><p>　　1、打开git，进入要存放项目代码的git目录</p><p>　　2、使用命令</p><p>　　　　<code>git clone git://github.com/xxx.git</code></p><p>　　　　或者<code>git clone https://github.com/xxx.git</code></p><p>四、从GitHub上通过命令update代码</p><p>　　1、打开git，进入要存放项目代码的git目录</p><p>　　2、使用命令    <code>git pull</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br><span class="line"></span><br><span class="line">hexo clean &amp;&amp; hexo generate &amp;&amp; hexo deploy  // Git BASH终端</span><br><span class="line">hexo clean; hexo generate; hexo deploy  // VSCODE终端</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">Git实现文件上传到github或者gitee</summary>
    
    
    
    <category term="操作" scheme="https://www.blog.909111.xyz/categories/%E6%93%8D%E4%BD%9C/"/>
    
    
    <category term="Git" scheme="https://www.blog.909111.xyz/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>java多线程面试题</title>
    <link href="https://www.blog.909111.xyz/posts/42904f32.html"/>
    <id>https://www.blog.909111.xyz/posts/42904f32.html</id>
    <published>2024-04-02T09:00:00.000Z</published>
    <updated>2024-04-02T09:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="java多线程面试题"><a href="#java多线程面试题" class="headerlink" title="java多线程面试题"></a>java多线程面试题</h1><h3 id="java中守护线程和本地线程的区别？"><a href="#java中守护线程和本地线程的区别？" class="headerlink" title="java中守护线程和本地线程的区别？"></a>java中守护线程和本地线程的区别？</h3><p>java守护线程（Daemon）也称作精灵线程，本地线程也叫做用户线程（user）</p><p>,任何线程都可以被设置为守护线程，反之全为用户线程，</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Thread.setDeamon(<span class="literal">true</span>);<span class="comment">//设置为精灵西线程</span></span><br></pre></td></tr></table></figure><p>必须在Thread.start()之前调用，否则运行会抛出异常，二者唯一的区别是，判断jvm何时离开，Daemon为其他线程服务，当全部的用户线程全部撤离，那么Daemon没有可以服务的线程，jvm就可以撤离。</p><p>比如Jvm中的垃圾回收线程是一个守护线程，当所有的线程已经撤销，不在生成垃圾，那么守护线程没事情可干，当你垃圾回收线程是java虚拟机上仅存的线程时候，java虚拟机会自动离开。</p><h3 id="线程与进程的区别"><a href="#线程与进程的区别" class="headerlink" title="线程与进程的区别"></a>线程与进程的区别</h3><p>进程是操作系统分配资源的最小单元，线程是操作系统调度的最小单元。</p><p>一个程序至少有一个进程，一个进程至少一个线程。</p><h3 id="什么是多线程的上下文切换"><a href="#什么是多线程的上下文切换" class="headerlink" title="什么是多线程的上下文切换"></a>什么是多线程的上下文切换</h3><p>多线程会共同使用一组计算机的CPU，而线程数大于给程序分配的CPU数量，为了让各个线程都有执行的机会，就需要轮转使用cpu,不同的线程切换使用cpu发生的切换数据等就是上下文切换。</p><h3 id="死锁和活锁的区别，死锁和饥饿的区别"><a href="#死锁和活锁的区别，死锁和饥饿的区别" class="headerlink" title="死锁和活锁的区别，死锁和饥饿的区别"></a>死锁和活锁的区别，死锁和饥饿的区别</h3><p>死锁：指两个或两个以上的进程在执行过程中争抢资源造成的一种互相等待的情况，若无外力作用，他们将会无法推进下去。</p><p><strong>产生死锁的必要条件：</strong></p><ol><li>互斥条件：所谓互斥，进程在某一时间内独占资源。</li><li>请求和保持条件： 一个进程因请求资源而阻塞时，对已获得的资源保持不放。</li><li>不剥夺条件：进程已获得资源，在未使用完之前，不能强行剥夺。</li><li>循环等待条件：若干进程之间形成一种头尾相连的循环等待资源关系。</li></ol><p><strong>活锁：</strong> 任务或者执行者没有被阻塞，由于某些条件没有满足，导致一种重复尝试，失败，尝试，失败。</p><p>活锁和死锁的区别在于：处于活锁的实体是在不断改变状态，所谓活，而处于死锁的实体表现为等待；活锁有可能自行解开，死锁不能。</p><p><strong>饥饿：</strong> 一个或者多个线程因为种种原因无法获得所需要的资源，导致一直无法执行的状态。</p><p><strong>java导致饥饿的原因：</strong></p><ol><li>高优先级吞噬所有的低优先级线程CPU时间。</li><li>线程被永久堵塞在一个等待进入同步块的状态，因为其它的线程总是能在他之前持续地对该同步块进行访问。</li><li>线程在等待一个本身也处于永久等待完成的对象（比如调用这个对象的wait方法），因为其它线程总是被持续的获得唤醒。</li></ol><h3 id="java中线程调度的算法是什么："><a href="#java中线程调度的算法是什么：" class="headerlink" title="java中线程调度的算法是什么："></a>java中线程调度的算法是什么：</h3><p>采用时间片轮转的方式，可以设置线程的优先级，会映射到下层的系统上面的优先级，如非特别需要，尽量不要使用。可能会造成线程饥饿。</p><h3 id="什么是线程组，为什么在java不推荐使用"><a href="#什么是线程组，为什么在java不推荐使用" class="headerlink" title="什么是线程组，为什么在java不推荐使用"></a>什么是线程组，为什么在java不推荐使用</h3><p>ThreadGroup类，可以把线程归属到某一个线程组中，线程组可以有线程对象也可以有线程组，组中还可以有线程，这样的组织结构有点类似于树的形式。</p><p>为什么不推荐？</p><ol><li>线程组ThreadGroup现象中比较常用的方法stop,resume,suspend等方法，由于这几个方法会导致线程安全问题，故而被官方废弃掉了，所以线程本身的应用价值就大打折扣了。</li><li>其不是线程安全，这在使用的过程中获取的信息不是全部及时有效的，这样就降低了其统计价值。</li></ol><h3 id="什么是-Executors-框架？"><a href="#什么是-Executors-框架？" class="headerlink" title="什么是 Executors 框架？"></a>什么是 Executors 框架？</h3><p>Executor 框架是一个根据一组执行策略调用，调度，执行和控制的异步任务的框 </p><p>架。 </p><p>无限制的创建线程会引起应用程序内存溢出。所以创建一个线程池是个更好的的 </p><p>解决方案，因为可以限制线程的数量并且可以回收再利用这些线程。利用 </p><p>Executors 框架可以非常方便的创建一个线程池。</p><h3 id="为什么使用Executor框架"><a href="#为什么使用Executor框架" class="headerlink" title="为什么使用Executor框架"></a>为什么使用Executor框架</h3><p>每次执行任务线程，new Thread(）比较消耗性能，创建一个线程是比较耗时的，耗资源的。</p><p>调用new Thread()创建的线程缺乏管理，被称为野线程，而且可以无限制创建，线程与线程之间的相互竞争也会导致占用过多系统资源而导致系统瘫痪，而且线程之间的频繁交替也会消耗很多的系统资源。</p><p>而且使用 new Thread()启动的线程不利于拓展，比如定时执行，定期执行，定时定期执行，线程中断都不便实现。</p><h3 id="java中Executor和Executors的区别"><a href="#java中Executor和Executors的区别" class="headerlink" title="java中Executor和Executors的区别"></a>java中Executor和Executors的区别</h3><p>Executor 工具类的不同方法按照我们的需求去创建不同的线程池，来满足业务的需求，</p><p>Executor接口对象能执行我们的线程任务</p><p>ExecutorService接口继承Executor接口并进行拓展，提供了更多的方法，我们能获得任务执行的状态，并且可以获得任务的返回值。</p><p>使用ThreadPoolExecutor可以创建自定义线程池。</p><p>Euture 表示异步计算的结果，他提供了检查计算是否完成的方法，以等待计算的完成，并可以get()方法或的计算的结果。</p><h3 id="什么是原子操作？java中Concurrency-API中有哪些原子类"><a href="#什么是原子操作？java中Concurrency-API中有哪些原子类" class="headerlink" title="什么是原子操作？java中Concurrency API中有哪些原子类"></a>什么是原子操作？java中Concurrency API中有哪些原子类</h3><p>原子操作：不可中断的一个或一系列操作</p><p>处理器使用基于缓存加锁或总线加锁的方式来实现多处理器之间的原子操作</p><p>java中可以通过锁和循环CAS的方式来实现原子操作，CAS操作 — Compare &amp; Set ，或是</p><p>Compare &amp; Swap,现在几乎所有的CPU指令都支持CAS的原子操作。</p><p>原子操作时是一个不受其他操作影响的任务单元，原子操作是在多线程下避免数据不一致的手段。</p><p>int ++ 并不是一个原子操作，所以当一个线程读到他的值并加一的时候，另一个线程可能读到之前的值，这就会导致引发错误。</p><p>为了解决这个问题，jdk1.5之前使用同步技术来解决这一点，到JDK1.5出现了java.util.concurrent.atomic包提供了int和long类型的原子包装。它可以自动的保证对于他们的操作时原子的并且不需要同步。</p><p>java.util.concurrent 这个包里边提供了一组的原子类，基本特性是多线程下，有多个线程同时置信你个这些类的实例包含的反复，具有排他性，当某个线程进入方法，执行其中的指令，不会被其他的线程打断，而别的线程就像自旋锁一样，一直等待该方法的执行完成，才由JVM从等待队列中选择一个另一个线程进入。</p><p>原子类：AtomicBoolean，AtomicInteger，AtomicLong，AtomicReference </p><p>原子数组：AtomicIntegerArray，AtomicLongArray，AtomicReferenceArray </p><p>原子属性更新器：：AtomicLongFieldUpdater，AtomicIntegerFieldUpdater， </p><p>AtomicReferenceFieldUpdater</p><p>解决ABA问题的原子类：AtomicMarkableReference（通过引入一个 boolean </p><p>来反映中间有没有变过），AtomicStampedReference（通过引入一个 int 来累 </p><p>加来反映中间有没有变过）</p><h3 id="并发编程的三要素"><a href="#并发编程的三要素" class="headerlink" title="并发编程的三要素"></a>并发编程的三要素</h3><ol><li>原子性</li></ol><p>指一·个或多个操作，要么全部执行要么全部不执行</p><ol><li>可见性</li></ol><p>可见性指多个线程操作一个共享变量时，其中一个线程对变量进行修改后，其他线程可以立即看到修改的结果</p><ol><li>有序性</li></ol><p>即程序的执行顺序按照代码的先后顺序来执行</p><h3 id="创建线程的方式三种："><a href="#创建线程的方式三种：" class="headerlink" title="创建线程的方式三种："></a>创建线程的方式三种：</h3><p>一般上线程是三种</p><ol><li><p>继承Thread类</p><p>简单使用方便</p></li><li><p>实现runnable方法</p><p>线程类实现了Runnable接口，Callable接口，还可以继承其他类</p><p>在这种方式之下，多个线程可以共享同一个target对象，故而适合多个相同线程来处理同一份资源的情况，从而可以将CPU和代码和数据分开。形成清晰的模型，较好的体现了面向对象的思想。</p></li><li><p>通过Callable和Future创建线程一般使用Callable将会带返回值，如果你希望有返回值的那就使用Callable</p><p>Callable重写的是call()方法，Runable重写的是run方法</p></li><li><p>通过线程池创建</p></li></ol>]]></content>
    
    
    <summary type="html">🥧本文主要介绍对多线程面试题的总结</summary>
    
    
    
    <category term="面试题" scheme="https://www.blog.909111.xyz/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    
    
    <category term="java面试题" scheme="https://www.blog.909111.xyz/tags/java%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>线程池学习</title>
    <link href="https://www.blog.909111.xyz/posts/ac133265.html"/>
    <id>https://www.blog.909111.xyz/posts/ac133265.html</id>
    <published>2024-04-02T09:00:00.000Z</published>
    <updated>2024-04-02T09:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>涉及到线程池之前，我们需要知道创建线程的几种方式，在线程的基础之上，我们进一步学习线程池。</p><h2 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h2><h4 id="线程池是什么？"><a href="#线程池是什么？" class="headerlink" title="线程池是什么？"></a>线程池是什么？</h4><p>线程池是一种池化技术，使用池化技术管理和使用线程的一种机制。</p><p>池化技术：在利用资源之前，我们需要提前准备一些资源，在需要时候重复使用提前准备的资源。</p><p>池化技术（Pooling）是一种常用的优化技术，它的目的是通过<strong>重复使用已经创建的对象或者资源，来避免频繁的创建和销毁对象或者资源所带来的开销</strong>。通过池化技术，可以减少创建和销毁对象的开销，从而提高程序的性能和稳定性。在计算机领域中，池化技术通常用于以下几个方面：</p><ol><li><p>数据库连接池：<strong>通过重复使用已经创建的数据库连接</strong>，避免频繁地创建和销毁数据库连接所带来的开销。</p></li><li><p>线程池：<strong>通过重复使用已经创建的线程</strong>，避免频繁地创建和销毁线程所带来的开销。</p></li><li><p>对象池：<strong>通过重复使用已经创建的对象</strong>，避免频繁地创建和销毁对象所带来的开销。</p></li><li><p>内存池：<strong>通过重复使用已经分配的内存</strong>，避免频繁地分配和释放内存所带来的开销。</p></li></ol><p>在实际应用中，池化技术可以帮助我们提高程序的性能和稳定性，因此在设计和开发程序时，可以考虑采用池化技术来优化程序的性能。</p><h4 id="线程池的使用方式"><a href="#线程池的使用方式" class="headerlink" title="线程池的使用方式"></a>线程池的使用方式</h4><ul><li>通过ThreadPoolExecutor创建的线程池；</li><li>通过Executors创建的线程池。</li></ul><p><strong>线程池的创建方式总共包含以下7种（其中6种是通过Executors 创建的，1种是通过<a href="https://so.csdn.net/so/search?q=ThreadPoolExecutor&amp;spm=1001.2101.3001.7020">ThreadPoolExecutor</a>创建的）：</strong></p><ul><li>Executors.<strong>newFixedThreadPool</strong>：创建一个<strong>固定大小</strong>的线程池，可以控制并发的线程数，超出的线程会在队列中等待；</li><li>Executors.<strong>newCachedThreadPool</strong>：创建一个<strong>可缓存</strong>的线程池，若线程超过处理所需，缓存一段时间后会回收，若线程数不够，则新建线程；</li><li>Executors.<strong>newScheduledThreadPool</strong>：创建一个可以<strong>执行延迟任务</strong>的线程池；</li><li>Executors.<strong>newSingleThreadExecutor</strong>：创建<strong>单个线程</strong>的线程池，它可以保证先进先出的执行顺序</li><li>Executors.<strong>newSingleThreadScheduledExecutor</strong>：创建一个<strong>可以执行延迟任务</strong>的单个线程的线程池；</li><li>Executors.<strong>newWorkStealingPool</strong>：创建一个<strong>抢占式执行</strong>的线程池；</li><li>ThreadPoolExecutor：<strong>手动创建线程池</strong> 的方式，它最多包含了7个参数可供设置，最少可设置5个参数。</li></ul><h3 id="Executors"><a href="#Executors" class="headerlink" title="Executors"></a>Executors</h3><h4 id="创建固定数量的线程池"><a href="#创建固定数量的线程池" class="headerlink" title="创建固定数量的线程池"></a>创建固定数量的线程池</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//创建一个包含5个线程的线程池</span></span><br><span class="line"><span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line"><span class="comment">//给予10个资源分配给5个线程去分</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; <span class="number">10</span> ; i ++) &#123;</span><br><span class="line">threadPool.execute(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;线程名称:&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//执行完毕后记得关闭。预防占用资源</span></span><br><span class="line">threadPool.shutdown();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo2</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException &#123;</span><br><span class="line"><span class="comment">//创建5个线程</span></span><br><span class="line"><span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line"><span class="comment">//使用线程池执行任务，也给线程池添加任务</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span> ; i ++) &#123;</span><br><span class="line"><span class="comment">//使用Callable据接口来创建线程</span></span><br><span class="line">Future&lt;Integer&gt; result = threadPool.submit(<span class="keyword">new</span> <span class="title class_">Callable</span>&lt;Integer&gt;() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">9</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;随机数：&quot;</span> + num);</span><br><span class="line"><span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">System.out.println(<span class="string">&quot;线程池的返回结果：&quot;</span> + result.get());</span><br><span class="line">&#125;</span><br><span class="line">        <span class="comment">//执行完毕后记得关闭。预防占用资源</span></span><br><span class="line">threadPool.shutdown();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过上述两种方式，我发现向线程池中添加任务的方式有两种：</p><ul><li>execute : 只执行不带返回值的任务</li><li>submit：可以执行又返回值的任务或者没有返回值的任务。</li></ul><h4 id="线程池工厂"><a href="#线程池工厂" class="headerlink" title="线程池工厂"></a>线程池工厂</h4><p>在上面的执行过程中，可以看到没有设置线程名称时候，他就会是一个默认名，线程工厂可以让我们自定义线程名称或者优先级。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="comment">//1.创建线程工厂</span></span><br><span class="line">        ThreadFactory threadFactory=<span class="keyword">new</span> <span class="title class_">ThreadFactory</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Thread <span class="title function_">newThread</span><span class="params">(Runnable r)</span> &#123;</span><br><span class="line">                Thread thread=<span class="keyword">new</span> <span class="title class_">Thread</span>(r);</span><br><span class="line">                <span class="comment">//设置线程命名规则</span></span><br><span class="line">                thread.setName(<span class="string">&quot;我的线程-&quot;</span>+r.hashCode());</span><br><span class="line">                <span class="comment">//设置线程优先级</span></span><br><span class="line">                thread.setPriority(Thread.MAX_PRIORITY);</span><br><span class="line">                <span class="keyword">return</span> thread;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>, threadFactory);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">            threadPool.submit(()-&gt;&#123;</span><br><span class="line">                <span class="comment">//任务</span></span><br><span class="line">                <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">                System.out.println(<span class="string">&quot;线程池开始执行了：&quot;</span>+thread.getName()+<span class="string">&quot; &quot;</span>+thread.getPriority());</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//当程序执行完毕后记得关闭线程池</span></span><br><span class="line">        threadPool.shutdown();</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>线程池开始执行了：我的线程-1826771953 10<br>线程池开始执行了：我的线程-455659002 10<br>线程池开始执行了：我的线程-245257410 10<br>线程池开始执行了：我的线程-1705736037 10<br>线程池开始执行了：我的线程-1406718218 10</p></blockquote><h4 id="带缓存的线程池"><a href="#带缓存的线程池" class="headerlink" title="带缓存的线程池"></a>带缓存的线程池</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo4</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">1000</span>; i++)&#123;</span><br><span class="line">            <span class="type">int</span> finalI=i;</span><br><span class="line">            threadPool.submit(()-&gt;&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;i:&quot;</span>+finalI+<span class="string">&quot;|线程名称：&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//当程序执行完毕后记得关闭线程池</span></span><br><span class="line">        threadPool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在此我们发现，我们给线程一千个任务的时候，他并不会创建1000个线程，我们通过执行发现最多会创建100多个线程，然后会进行复用。</p><p>故此我们在这里总结一下：</p><p>线程池中的线程也不能无限制地被创建。线程池中的线程数量应该根据实际情况进行适当的设置，以便充分利用系统资源，提高系统的性能和稳定性。如果线程池中的线程数量过多，会导致系统资源的耗尽，从而导致系统的性能下降或崩溃。另外，线程的创建和销毁也会带来一定的开销，如果线程池中的线程数量过多，会增加线程的创建和销毁开销，从而降低系统的性能和稳定性。</p><p>因此，在实际应用中，需要根据实际情况来设置线程池的大小，以满足应用的需要，并保证系统的性能和稳定性。一般来说，线程池中的线程数量应该根据系统的 CPU 核心数、内存大小、任务类型和系统负载等因素来进行设置，以达到最优的效果。</p><h4 id="执行定时任务的线程池"><a href="#执行定时任务的线程池" class="headerlink" title="执行定时任务的线程池"></a>执行定时任务的线程池</h4><p>延迟执行一次：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo5</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ScheduledExecutorService</span> <span class="variable">service</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">5</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;添加任务的时间：&quot;</span>+ LocalDate.now());</span><br><span class="line">        scheduleTest(service);<span class="comment">//只执行一次的定时任务</span></span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 只执行一次的定时任务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> service</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">scheduleTest</span><span class="params">(ScheduledExecutorService service)</span> &#123;</span><br><span class="line">        <span class="comment">//执行定时任务(延迟3秒执行)</span></span><br><span class="line">        service.schedule(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;执行了任务：&quot;</span>+LocalDateTime.now());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="number">3</span>, TimeUnit.SECONDS);</span><br><span class="line">        <span class="comment">//当循环执行完毕后记得关闭线程池</span></span><br><span class="line">        service.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>本延迟执行任务，只能执行一次。</p><p>创建这个线程池有3个参数</p><ul><li>执行任务</li><li>延迟n秒执行</li><li>配合执行的时间单位</li></ul><p><strong>固定频率执行</strong></p><p>我们可以让线程以以固定频率间隔n秒执行，创建这个线程池有四个参数：</p><ol><li>执行任务</li><li>延迟n秒执行</li><li>执行定时任务的频率</li><li>配合3执行的时间单位</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo6</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ScheduledExecutorService</span> <span class="variable">service</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">5</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;添加任务的时间：&quot;</span>+ LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2S之后开始执行定时任务，定时任务每4s执行一次</span></span><br><span class="line">        service.scheduleAtFixedRate(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;执行任务：&quot;</span>+LocalDateTime.now());</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="number">2</span>,<span class="number">4</span>,TimeUnit.SECONDS);</span><br><span class="line">        <span class="comment">//由于是定时任务，故而不能够让他关闭，我们需要通过循环来控制关闭，这里我们就不在描述</span></span><br><span class="line">        <span class="comment">// service.shutdown();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo7</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String [] args)</span> &#123;</span><br><span class="line"><span class="type">ScheduledExecutorService</span> <span class="variable">service</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">5</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;添加任务的时间：&quot;</span>+ LocalDateTime.now());</span><br><span class="line"><span class="comment">//    //2S之后开始执行定时任务，定时任务每4s执行一次</span></span><br><span class="line"><span class="comment">//    service.scheduleAtFixedRate(new Runnable() &#123;</span></span><br><span class="line"><span class="comment">//        @Override</span></span><br><span class="line"><span class="comment">//        public void run() &#123;</span></span><br><span class="line"><span class="comment">//            System.out.println(&quot;执行任务：&quot;+LocalDateTime.now());</span></span><br><span class="line"><span class="comment">//            try &#123;</span></span><br><span class="line"><span class="comment">//                Thread.sleep(1000);</span></span><br><span class="line"><span class="comment">//            &#125; catch (InterruptedException e) &#123;</span></span><br><span class="line"><span class="comment">//                e.printStackTrace();</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//    &#125;,2,4,TimeUnit.SECONDS);</span></span><br><span class="line">    <span class="comment">//2s之后开始执行，每次执行间隔4s</span></span><br><span class="line">    service.scheduleWithFixedDelay(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;执行任务：&quot;</span>+LocalDateTime.now());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,<span class="number">2</span>,<span class="number">4</span>,TimeUnit.SECONDS);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 Java 中，Timer 类提供了两个方法用于定时执行任务，分别是 <strong>scheduleAtFixedRate() 和 scheduleWithFixedDelay()</strong>。这两个方法都可以实现定时执行任务的功能，但它们的执行方式略有不同，具体区别如下：</p><ol><li><p>scheduleAtFixedRate() 方法：该方法是按照固定的时间间隔执行任务，它会按照指定的时间间隔不断地执行任务，无论上一次任务是否执行完成，也不考虑任务的执行时间，即使任务的执行时间超过了时间间隔，也会按照指定的时间间隔再次执行任务。</p></li><li><p>scheduleWithFixedDelay() 方法：该方法是在任务执行完成后，等待指定的时间间隔再次执行任务，它会在任务执行完成后，等待指定的时间间隔，然后再次执行任务，考虑了任务的执行时间。也就是说，该方法会在上一次任务执行完成后，等待指定的时间间隔，然后再次执行任务。</p></li></ol><p>因此，如果需要按照固定的时间间隔执行任务，无论任务是否执行完成，都需要按照指定的时间间隔再次执行任务，可以使用 scheduleAtFixedRate() 方法；如果需要在任务执行完成后，等待指定的时间间隔再次执行任务，可以使用 scheduleWithFixedDelay() 方法。</p><h4 id="单线程的线程池"><a href="#单线程的线程池" class="headerlink" title="单线程的线程池"></a>单线程的线程池</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo8</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line"><span class="type">int</span> finalI=i;</span><br><span class="line">executorService.submit(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;任务名：&quot;</span>+finalI+<span class="string">&quot;线程名：&quot;</span>+Thread.currentThread().getName());</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//老样子执行完毕后记得关闭</span></span><br><span class="line">executorService.shutdown();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>单线程的线程池和单线程有什么区别？以及其各自的作用？</p><p>单线程的线程池和单线程之间有以下几点区别：</p><ol><li><p>线程池是一种可以管理和调度多个线程的机制，可以重复利用线程，从而避免频繁创建和销毁线程的开销，提高程序的性能和稳定性。而单线程则只能执行一个任务，无法进行任务的并行处理。</p></li><li><p>线程池中的线程数量可以根据实际需求进行动态调整，可以增加或减少线程的数量，以适应不同的负载和任务类型。而单线程则只能处理一个任务，无法进行线程数量的动态调整。</p></li><li>线程池可以管理和调度多个任务。</li></ol><h4 id="定时任务的单线程线程池"><a href="#定时任务的单线程线程池" class="headerlink" title="定时任务的单线程线程池"></a>定时任务的单线程线程池</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo9</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">ScheduledExecutorService</span> <span class="variable">service</span> <span class="operator">=</span> Executors.newSingleThreadScheduledExecutor();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;执行任务的时间：&quot;</span> + LocalDateTime.now());</span><br><span class="line">service.schedule(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;执行任务：&quot;</span> + LocalDateTime.now());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 执行任务 2秒后执行 ，单位 TimeUnit.Seconds秒</span></span><br><span class="line">&#125;, <span class="number">2</span>, TimeUnit.SECONDS);</span><br><span class="line"><span class="comment">//当定时任务执行完毕后记得关闭</span></span><br><span class="line">service.shutdown();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="根据当前CPU生成线程池"><a href="#根据当前CPU生成线程池" class="headerlink" title="根据当前CPU生成线程池"></a>根据当前CPU生成线程池</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo10</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//根据当前电脑的CPU来创建线程池</span></span><br><span class="line"><span class="type">ExecutorService</span> <span class="variable">service</span> <span class="operator">=</span> Executors.newWorkStealingPool();</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; <span class="number">100</span>; i ++ ) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">finaIi</span>  <span class="operator">=</span> i ;</span><br><span class="line">service.submit(()-&gt;&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;任务：&quot;</span> + finaIi + <span class="string">&quot;线程名：&quot;</span> + Thread.currentThread());</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//判断线程是否</span></span><br><span class="line"><span class="keyword">while</span>(!service.isTerminated()) &#123;</span><br><span class="line"><span class="comment">//执行完毕后记得关闭线程池</span></span><br><span class="line">service.shutdown();</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ThreadPoolExecutor"><a href="#ThreadPoolExecutor" class="headerlink" title="ThreadPoolExecutor"></a>ThreadPoolExecutor</h3><h4 id="ThreadPoolExecutor和Executors比较"><a href="#ThreadPoolExecutor和Executors比较" class="headerlink" title="ThreadPoolExecutor和Executors比较"></a><strong>ThreadPoolExecutor和Executors</strong>比较</h4><p>都是Java中用于生成线程池的类，它们有以下几个区别：</p><ol><li><p>ThreadPoolExecutor是一个<strong>更底层的类</strong>，它提供了更多的配置选项，如线程池的核心线程数、最大线程数、任务队列等，可以更加灵活地控制线程池的行为。<strong>而Executors则是在ThreadPoolExecutor基础上进行了封装</strong>，<strong>提供了一些预定义的线程池配置选项，如newFixedThreadPool、newCachedThreadPool等</strong>，方便用户快速创建线程池。</p></li><li><p>ThreadPoolExecutor可以通过<strong>自定义RejectedExecutionHandler来处理任务被拒绝执行的情况</strong>，而<strong>Executors只提供了一些简单的拒绝策略</strong>，如抛出异常、丢弃任务等。</p></li><li><p><strong>Executors生成的线程池通常是无界队列的</strong>，如果任务数量过多，可能会导致内存溢出等问题。而<strong>ThreadPoolExecutor则可以通过配置有界队列或者拒绝</strong>策略来避免这种情况。</p></li><li><p>在Java 8之前，Executors生成的线程池中的工作线程都是<strong>非守护线程</strong>，即使主线程结束，工作线程也会继续执行。而ThreadPoolExecutor则可以通过设置工作线程为守护线程来避免这种情况。</p></li></ol><p>ThreadPoolExecutor和Executors各自可以解决的问题也有所差异。ThreadPoolExecutor适合于需要更精细的线程池配置、需要自定义拒绝策略、需要有界队列等情况。而Executors则适合于快速创建线程池，且任务数量不会过多的情况。需要根据具体场景选择合适的类来生成线程池。</p><h4 id="Executors存在的问题"><a href="#Executors存在的问题" class="headerlink" title="Executors存在的问题"></a>Executors存在的问题</h4><p>虽然Executors可以快速创建线程池，但在一些情况下可能会存在问题，如下：</p><ol><li><p><strong>FixedThreadPool</strong>和<strong>SingleThreadExecutor</strong>的线程数是固定的，如果任务数量过多，会导致队列中的任务堆积，从而占用大量内存，甚至导致OOM异常。</p></li><li><p>CachedThreadPool的最大线程数是<strong>Integer.MAX_VALUE</strong>，如果<strong>任务数量过多，会创建大量线程，占用大量系统资源，导致系统崩溃</strong>。</p></li><li><p>Executors生成的线程池中的工作线程都是<strong>非守护线程</strong>，即使<strong>主线程结束，工作线程也会继续执行。如果应用程序没有显式地终止线程池，会导致应用程序无法正常退出，从而导致内存泄漏等问题。</strong></p></li><li><p>Executors提供的拒绝策略有一些局限性，<strong>例如在任务被拒绝后，无法重新提交任务等</strong>。</p></li></ol><p>因此，对于不同的应用场景，应该选择合适的线程池类型或者直接使用ThreadPoolExecutor来手动创建线程池，以避免出现上述问题。</p><h4 id="ThreadPoolExecutor的介绍"><a href="#ThreadPoolExecutor的介绍" class="headerlink" title="ThreadPoolExecutor的介绍"></a>ThreadPoolExecutor的介绍</h4><p>ThreadPoolExecutor是Java中用于创建线程池的类，它有以下几个参数：</p><ol><li><p><strong>corePoolSize</strong>：线程池的核心线程数，即线程池中始终存在的线程数。如果线程池中的线程数小于corePoolSize，则会创建新的线程来执行任务，直到线程数等于corePoolSize。</p></li><li><p><strong>maximumPoolSize</strong>：线程池的最大线程数，即线程池中最多能存在的线程数。如果任务数量超过了线程池的容量，则会根据拒绝策略处理这些任务。</p></li><li><p><strong>keepAliveTime</strong>：线程池中非核心线程的空闲存活时间。如果线程池中的线程数大于corePoolSize，并且某个线程空闲的时间超过了keepAliveTime，则该线程会被销毁直到线程池中的线程数等于corePoolSize。</p></li><li><p><strong>TimeUnit</strong>：keepAliveTime的时间单位，例如TimeUnit.SECONDS。</p></li><li><p><strong>workQueue</strong>：线程池中的任务队列，用于存储等待执行的任务。可以选择不同类型的队列，如有界队列和无界队列。</p></li><li><p><strong>threadFactory</strong>：线程工厂，用于创建新的线程。可以自定义线程的名称、优先级等属性。</p></li><li><p><strong>handler</strong>：拒绝策略，用于处理无法执行的任务。可以选择不同的策略，如抛出异常、丢弃任务、等待一段时间再重试等。</p></li></ol><p>这些参数的具体作用如下：</p><blockquote><ol><li>通过corePoolSize和maximumPoolSize来控制线程池中的工作线程数量，以达到最优的性能和资源利用效率。</li><li>通过keepAliveTime和workQueue来控制线程池中线程的存活时间和任务的排队策略，以避免任务堆积和资源浪费。</li><li>通过threadFactory可以自定义线程的属性，如线程名称等。</li></ol></blockquote><p>当我们使用ThreaPoolExecutor创建线程池的时候，默认最少使用5个参数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue)</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">ThreadFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadFactory</span>() &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Thread <span class="title function_">newThread</span><span class="params">(Runnable r)</span> &#123;</span><br><span class="line"><span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(r);</span><br><span class="line"><span class="keyword">return</span> thread;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">ThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line"><span class="number">2</span>,</span><br><span class="line"><span class="number">5</span>,</span><br><span class="line"><span class="number">10</span>,</span><br><span class="line">TimeUnit.SECONDS,</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">LinkedBlockingDeque</span>&lt;Runnable&gt;(<span class="number">2</span>),</span><br><span class="line">factory,</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.DiscardPolicy());</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span> ; i &lt; <span class="number">6</span> ; i ++) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">finaIi</span> <span class="operator">=</span> i ;</span><br><span class="line">executor.submit(()-&gt;&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Thread.sleep(<span class="number">10</span> * finaIi);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;任务：&quot;</span> + finaIi);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line">        <span class="comment">//执行循环完毕后关闭线程池</span></span><br><span class="line">executor.shutdown();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="线程池的执行流程"><a href="#线程池的执行流程" class="headerlink" title="线程池的执行流程"></a>线程池的执行流程</h4><p>线程池的执行流程如下：</p><ol><li><p>首先，线程池会创建一些初始的核心线程，并将它们放入工作队列中。</p></li><li><p>当有任务进来时，线程池会从工作队列中选取一个线程来执行任务。</p></li><li><p>如果此时线程池中的线程数小于核心线程数(corePoolSize)且有空闲线程，则会立即创建新的线程来执行任务。</p></li><li><p>如果此时线程池中的线程数已经达到了核心线程数，且工作队列已满，则会将任务提交到线程池的任务队列中。</p></li><li><p>如果此时任务队列已满，且线程池中的线程数小于最大线程数(maximumPoolSize)，则会创建新的线程来执行任务。</p></li><li><p>如果此时线程池中的线程数已经达到了最大线程数，且任务队列已满，则会按照拒绝策略(RejectedExecutionHandler)来处理任务。常见的拒绝策略有：抛出异常、丢弃任务、等待一段时间再重试等。</p></li><li><p>当某个线程执行完任务后，会从任务队列中取出下一个任务继续执行，直到线程池关闭或者出现异常。</p></li></ol><p>需要注意的是，线程池的执行流程是异步的，任务的执行顺序是不确定的。线程池在执行任务时，会根据任务的优先级、执行时间等因素来选择执行顺序，具体的执行流程会根据不同的线程池实现而有所差异。</p><h4 id="拒绝策略"><a href="#拒绝策略" class="headerlink" title="拒绝策略"></a>拒绝策略</h4><p>目前线程池的拒绝策略共计有5种，其中有四种JDK提供的和一种自定义拒绝策略。</p><p>线程池的拒绝策略指的是当线程池中的线程已经全部被占用，队列也已满，无法继续接受新的任务时，应该如何处理这些被拒绝的任务。常见的线程池拒绝策略包括：</p><ol><li><strong>AbortPolicy（默认策略）</strong>：直接抛出RejectedExecutionException异常，表示拒绝执行该任务。</li><li><strong>CallerRunsPolicy</strong>：由调用线程处理该任务，即在提交任务的线程中直接执行该任务。这种策略可能会降低整个系统的吞吐量，因为提交任务的线程可能不是专门用来处理任务的线程，而是业务线程。</li><li><strong>DiscardPolicy</strong>：直接丢弃该任务，不做任何处理。</li><li><strong>DiscardOldestPolicy</strong>：抛弃最早加入队列的任务，并尝试再次提交当前任务。</li><li><strong>自定义拒绝策略</strong>：用户可以根据业务场景，自定义拒绝策略，例如将任务记录到日志中、将任务放到消息队列中等等。</li></ol><p>选择合适的线程池拒绝策略，可以更好地保障系统的稳定性和可靠性。</p><p>第一种<strong>AbortPolicy</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo2</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">ThreadFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadFactory</span>() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Thread <span class="title function_">newThread</span><span class="params">(Runnable r)</span> &#123;</span><br><span class="line"><span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(r);</span><br><span class="line"><span class="keyword">return</span> thread;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">ThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line"><span class="number">2</span>,</span><br><span class="line"><span class="number">2</span>,</span><br><span class="line"><span class="number">10</span>,</span><br><span class="line">TimeUnit.SECONDS,</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">LinkedBlockingDeque</span>&lt;&gt;(<span class="number">2</span>),</span><br><span class="line">factory,</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.AbortPolicy() <span class="comment">//拒绝策略</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">finaIi</span> <span class="operator">=</span> i;</span><br><span class="line">executor.submit(()-&gt;&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Thread.sleep(<span class="number">10</span>*finaIi);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;任务：&quot;</span> + finaIi);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line">        <span class="comment">//执行循环完毕后关闭线程池</span></span><br><span class="line">executor.shutdown();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第二种<strong>CallerRunsPolicy()</strong> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 手动方式创建线程池</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ThreadFactory factory=<span class="keyword">new</span> <span class="title class_">ThreadFactory</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Thread <span class="title function_">newThread</span><span class="params">(Runnable r)</span> &#123;</span><br><span class="line">                Thread thread=<span class="keyword">new</span> <span class="title class_">Thread</span>(r);</span><br><span class="line">                <span class="keyword">return</span> thread;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        ThreadPoolExecutor executor=<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">            <span class="number">2</span>,</span><br><span class="line">            <span class="number">2</span>,</span><br><span class="line">            <span class="number">10</span>,</span><br><span class="line">            TimeUnit.SECONDS,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">LinkedBlockingDeque</span>&lt;&gt;(<span class="number">2</span>),</span><br><span class="line">            factory,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy());  <span class="comment">//拒绝策略</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> finalI=i;</span><br><span class="line">            executor.submit(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">10</span>*finalI);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">&quot;任务：&quot;</span>+finalI);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//执行循环完毕后关闭线程池</span></span><br><span class="line">executor.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第三种：<strong>DiscardPolicy</strong> ()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo4</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ThreadFactory factory=<span class="keyword">new</span> <span class="title class_">ThreadFactory</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Thread <span class="title function_">newThread</span><span class="params">(Runnable r)</span> &#123;</span><br><span class="line">                Thread thread=<span class="keyword">new</span> <span class="title class_">Thread</span>(r);</span><br><span class="line">                <span class="keyword">return</span> thread;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        ThreadPoolExecutor executor=<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">        <span class="number">2</span>,</span><br><span class="line">        <span class="number">2</span>,</span><br><span class="line">        <span class="number">10</span>,</span><br><span class="line">                TimeUnit.SECONDS,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">LinkedBlockingDeque</span>&lt;&gt;(<span class="number">2</span>),</span><br><span class="line">                factory,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.DiscardPolicy()</span><br><span class="line">                );</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> finalI=i;</span><br><span class="line">            executor.submit(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">10</span>*finalI);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">&quot;任务：&quot;</span>+finalI);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//执行循环完毕后关闭线程池</span></span><br><span class="line">executor.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第四种：<strong>DiscardOldestPolicy()</strong> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo5</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ThreadFactory factory=<span class="keyword">new</span> <span class="title class_">ThreadFactory</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Thread <span class="title function_">newThread</span><span class="params">(Runnable r)</span> &#123;</span><br><span class="line">                Thread thread=<span class="keyword">new</span> <span class="title class_">Thread</span>(r);</span><br><span class="line">                <span class="keyword">return</span> thread;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        ThreadPoolExecutor executor=<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">        <span class="number">2</span>,</span><br><span class="line">        <span class="number">2</span>,</span><br><span class="line">        <span class="number">10</span>,</span><br><span class="line">                TimeUnit.SECONDS,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">LinkedBlockingDeque</span>&lt;&gt;(<span class="number">2</span>),</span><br><span class="line">                factory,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.DiscardOldestPolicy() <span class="comment">//拒绝策略</span></span><br><span class="line">                );</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> finalI=i;</span><br><span class="line">            executor.submit(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">10</span>*finalI);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">&quot;任务：&quot;</span>+finalI);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//执行循环完毕后关闭线程池</span></span><br><span class="line">executor.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第五种：自定义拒绝策略</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo6</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ThreadFactory factory=<span class="keyword">new</span> <span class="title class_">ThreadFactory</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Thread <span class="title function_">newThread</span><span class="params">(Runnable r)</span> &#123;</span><br><span class="line">                Thread thread=<span class="keyword">new</span> <span class="title class_">Thread</span>(r);</span><br><span class="line">                <span class="keyword">return</span> thread;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        ThreadPoolExecutor executor=<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">        <span class="number">2</span>,</span><br><span class="line">        <span class="number">2</span>,</span><br><span class="line">        <span class="number">10</span>,</span><br><span class="line">                TimeUnit.SECONDS,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">LinkedBlockingDeque</span>&lt;&gt;(<span class="number">2</span>),</span><br><span class="line">                factory,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">RejectedExecutionHandler</span>() &#123;  <span class="comment">//自定义拒绝策略</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rejectedExecution</span><span class="params">(Runnable r, ThreadPoolExecutor executor)</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;我执行了自定义拒绝策略&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> finalI=i;</span><br><span class="line">            executor.submit(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">10</span>*finalI);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">&quot;任务：&quot;</span>+finalI);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//执行循环完毕后关闭线程池</span></span><br><span class="line">executor.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="线程池的状态"><a href="#线程池的状态" class="headerlink" title="线程池的状态"></a>线程池的状态</h3><p>线程池的状态通常包括以下几种：</p><ol><li><p><strong>RUNNING</strong>：线程池处于运行状态，可以接受新任务并处理已有的任务。</p></li><li><p><strong>SHUTDOWN</strong>：线程池处于关闭状态，不再接受新任务，但会处理已有的任务。</p></li><li><p><strong>STOP</strong>：线程池处于停止状态，不再接受新任务，也不会处理已有的任务，会中断正在执行的任务。</p></li><li><p><strong>TIDYING</strong>：线程池正在整理线程池中的线程，例如删除已经停止的线程。</p></li><li><p><strong>TERMINATED</strong>：线程池已经终止，不再接受任何任务。</p></li></ol><p>线程池的状态可以通过ThreadPoolExecutor类的getState()方法获取，返回一个枚举类型的值，表示当前线程池的状态。在使用线程池的过程中，需要根据当前线程池的状态，避免不必要的操作，保证线程池的稳定性和可靠性</p><ol><li><p>RUNNING状态的例子：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">5</span>, <span class="number">10</span>, <span class="number">60</span>, TimeUnit.SECONDS, <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());</span><br><span class="line">executor.execute(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Task executed.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">System.out.println(<span class="string">&quot;Current thread pool state: &quot;</span> + executor.getState());</span><br><span class="line"><span class="comment">// 输出：Current thread pool state: RUNNING</span></span><br></pre></td></tr></table></figure><p>这个例子中，线程池处于RUNNING状态，因为线程池已经创建成功，可以接受新任务并处理已有的任务。</p></li><li><p>SHUTDOWN状态的例子：</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">5</span>, <span class="number">10</span>, <span class="number">60</span>, TimeUnit.SECONDS, <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());</span><br><span class="line">executor.shutdown();</span><br><span class="line">System.out.println(<span class="string">&quot;Current thread pool state: &quot;</span> + executor.getState());</span><br><span class="line"><span class="comment">// 输出：Current thread pool state: SHUTDOWN</span></span><br></pre></td></tr></table></figure><p>这个例子中，线程池处于SHUTDOWN状态，因为调用了executor.shutdown()方法，线程池不再接受新任务，但会处理已有的任务。</p><ol><li><p>STOP状态的例子：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">5</span>, <span class="number">10</span>, <span class="number">60</span>, TimeUnit.SECONDS, <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());</span><br><span class="line">executor.execute(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Task executed.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">executor.shutdown();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    executor.awaitTermination(<span class="number">1</span>, TimeUnit.SECONDS);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;Current thread pool state: &quot;</span> + executor.getState());</span><br><span class="line"><span class="comment">// 输出：Current thread pool state: STOP</span></span><br></pre></td></tr></table></figure><p>这个例子中，线程池处于STOP状态，因为调用了executor.shutdown()方法后，线程池不再接受新任务，并且中断正在执行的任务。</p></li><li><p>TIDYING状态的例子：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">5</span>, <span class="number">10</span>, <span class="number">60</span>, TimeUnit.SECONDS, <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());</span><br><span class="line">executor.shutdown();</span><br><span class="line"><span class="keyword">while</span> (!executor.isTerminated()) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Current thread pool state: &quot;</span> + executor.getState());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出：</span></span><br><span class="line"><span class="comment">// Current thread pool state: TIDYING</span></span><br><span class="line"><span class="comment">// Current thread pool state: TERMINATED</span></span><br></pre></td></tr></table></figure><p>这个例子中，线程池处于TIDYING状态，因为调用了executor.shutdown()方法后，线程池正在整理线程池中的线程，例如删除已经停止的线程。</p></li><li><p>TERMINATED状态的例子：</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">5</span>, <span class="number">10</span>, <span class="number">60</span>, TimeUnit.SECONDS, <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());</span><br><span class="line">executor.shutdown();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    executor.awaitTermination(<span class="number">1</span>, TimeUnit.SECONDS);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;Current thread pool state: &quot;</span> + executor.getState());</span><br><span class="line"><span class="comment">// 输出：Current thread pool state: TERMINATED</span></span><br></pre></td></tr></table></figure><p>这个例子中，线程池处于TERMINATED状态，因为线程池已经终止，不再接受任何任务。在调用executor.shutdown()方法后，等待所有任务执行完毕并且所有线程都被回收后，线程池进入TERMINATED状态。</p><h4 id="关闭线程池的方法"><a href="#关闭线程池的方法" class="headerlink" title="关闭线程池的方法"></a>关闭线程池的方法</h4><p>ThreadPoolExecutor类提供了两种关闭线程池的方法，分别是shutdown()和shutdownNow()。这两种方法的区别如下：</p><ol><li><p>shutdown()方法：调用该方法后，线程池会拒绝新的任务提交，但会继续处理已经提交的任务，直到所有任务都被完成。在所有任务完成后，线程池才会真正关闭，并释放所有资源。如果在调用shutdown()方法之后，继续提交新的任务，这些任务会被拒绝并抛出RejectedExecutionException异常。</p></li><li><p>shutdownNow()方法：调用该方法后，线程池会拒绝新的任务提交，并尝试中断正在执行的任务。在中断任务的过程中，如果任务响应中断，则任务会被成功中断并从任务队列中移除。如果任务无法响应中断，则任务会继续执行。在所有任务都被中断或已经完成后，线程池会真正关闭，并释放所有资源。如果在调用shutdownNow()方法之后，继续提交新的任务，这些任务会被拒绝并抛出RejectedExecutionException异常。</p></li></ol><p>因此，shutdown()方法是<strong>优雅地关闭线程池，等待所有任务都被完成后再关闭线程</strong>池，而shutdownNow()方法是<strong>强制关闭线程池</strong>，立即停止所有任务的执行，并尝试中断正在执行的任务。选择哪个方法取决于业务需求，如果需要优雅地关闭线程池，可以使用shutdown()方法，如果需要立即停止所有任务的执行，可以使用shutdownNow()方法。</p>]]></content>
    
    
    <summary type="html">🥧本文将重点从线程池进行讲解，以及如何实现线程池，并且线程池的实现方式，以及线程池的一些相关问题的讲解</summary>
    
    
    
    <category term="java学习" scheme="https://www.blog.909111.xyz/categories/java%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="java学习" scheme="https://www.blog.909111.xyz/tags/java%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>pdf阅读器</title>
    <link href="https://www.blog.909111.xyz/posts/0.html"/>
    <id>https://www.blog.909111.xyz/posts/0.html</id>
    <published>2023-11-09T02:50:23.344Z</published>
    <updated>2023-11-09T02:50:23.344Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-本地文件-在md文件路径下创建一个同名文件夹，其内放pdf文件名为xxx-pdf的文件"><a href="#1-本地文件-在md文件路径下创建一个同名文件夹，其内放pdf文件名为xxx-pdf的文件" class="headerlink" title="1.本地文件:在md文件路径下创建一个同名文件夹，其内放pdf文件名为xxx.pdf的文件"></a>1.本地文件:在md文件路径下创建一个同名文件夹，其内放pdf文件名为xxx.pdf的文件</h1><div class="row">    <embed src="xxx.pdf" width="100%" height="550" type="application/pdf"></div><h1 id="2-在线链接"><a href="#2-在线链接" class="headerlink" title="2.在线链接"></a>2.在线链接</h1><div class="row">    <embed src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/pdf/小作文讲义.pdf" width="100%" height="550" type="application/pdf"></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-本地文件-在md文件路径下创建一个同名文件夹，其内放pdf文件名为xxx-pdf的文件&quot;&gt;&lt;a href=&quot;#1-本地文件-在md文件路径下创建一个同名文件夹，其内放pdf文件名为xxx-pdf的文件&quot; class=&quot;headerlink&quot; title=&quot;1.</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>数据结构与算法2</title>
    <link href="https://www.blog.909111.xyz/posts/ba945d0d.html"/>
    <id>https://www.blog.909111.xyz/posts/ba945d0d.html</id>
    <published>2023-11-09T02:50:23.344Z</published>
    <updated>2023-11-09T02:50:23.344Z</updated>
    
    <content type="html"><![CDATA[<p>由于上个文件字数到达2w以上，本软件加载比较麻烦，故而新建一个文件用来记录。</p><h1 id="数据结构与算法"><a href="#数据结构与算法" class="headerlink" title="数据结构与算法"></a>数据结构与算法</h1><h2 id="9-哈希表"><a href="#9-哈希表" class="headerlink" title="9 哈希表"></a>9 哈希表</h2><p>一种数据结构</p><p>一般有hashMap,hashtable</p><p>哈希表，是一种数据结构，主要是key 与value的关系，了解hash表之前，我们需要了解的是哈希表，需要知道哈希函数，在jdk1.8之后，采用的红黑树进行一定的存储，其是根据关键码值而进行访问的数据结构，也就是说，<strong>其通过把关键码映射到表中的一个位置来访问记录，以加快查找的速度，这个映射函数我们称之为散列函数，存放记录的数组叫做散列表。</strong></p><p>hashtable来存储雇员信息。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashtableDemo</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">hashTable</span> <span class="variable">hashtab</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">hashTable</span>(<span class="number">8</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">10</span>,<span class="string">&quot;社会虎&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">18</span>,<span class="string">&quot;废物刀&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">26</span>,<span class="string">&quot;黑牛&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">3</span>,<span class="string">&quot;白牛&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">193</span>,<span class="string">&quot;小亮&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp6</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">231</span>,<span class="string">&quot;唐老鸭&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp7</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">12</span>,<span class="string">&quot;百特曼&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp8</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">1</span>,<span class="string">&quot;独爱小尹&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp9</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">123</span>,<span class="string">&quot;丽丽&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp10</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">126</span>,<span class="string">&quot;带篮子&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp11</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">29</span>,<span class="string">&quot;刘墉&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp12</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">86</span>,<span class="string">&quot;丁真&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp13</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">800</span>,<span class="string">&quot;王冰冰&quot;</span>);<span class="comment">//定义数据</span></span><br><span class="line"></span><br><span class="line">        hashtab.add(Emp1);</span><br><span class="line">        hashtab.add(Emp2);</span><br><span class="line">        hashtab.add(Emp3);</span><br><span class="line">        hashtab.add(Emp4);</span><br><span class="line">        hashtab.add(Emp5);</span><br><span class="line">        hashtab.add(Emp6);</span><br><span class="line">        hashtab.add(Emp7);</span><br><span class="line">        hashtab.add(Emp8);</span><br><span class="line">        hashtab.add(Emp9);</span><br><span class="line">        hashtab.add(Emp10);</span><br><span class="line">        hashtab.add(Emp11);</span><br><span class="line">        hashtab.add(Emp12);</span><br><span class="line">        hashtab.add(Emp13);<span class="comment">//插入数据</span></span><br><span class="line">        </span><br><span class="line">        hashtab.list();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建hashtable</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">hashTable</span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line"><span class="keyword">private</span> EmpLinkedList[] empLinkedLists;</span><br><span class="line"><span class="comment">//创建一个构造器</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">hashTable</span><span class="params">(<span class="type">int</span> size)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.size = size;</span><br><span class="line"><span class="comment">//初始化empLinkedListArray</span></span><br><span class="line">empLinkedLists = <span class="keyword">new</span> <span class="title class_">EmpLinkedList</span>[size];</span><br><span class="line"><span class="comment">//细节，引用类型的变量在声明后如果不初始化那么默认值就是null</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; size; i++) &#123;</span><br><span class="line"><span class="comment">//这个循环体就是在初始化</span></span><br><span class="line">empLinkedLists[i] = <span class="keyword">new</span> <span class="title class_">EmpLinkedList</span>();<span class="comment">//在这里必须要逐一为每个元素实例化</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> id % size;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//添加雇员</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Emp emp)</span>&#123;</span><br><span class="line"><span class="comment">//根据员工的id得到该员工应该加入</span></span><br><span class="line"><span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> hash(emp.id);</span><br><span class="line">empLinkedLists[num].add(emp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; size ; i ++ ) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;第&quot;</span>+i+<span class="string">&quot;个链表状况&quot;</span>);</span><br><span class="line">empLinkedLists[i].list();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//表是</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Emp</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> id;</span><br><span class="line"><span class="keyword">public</span> String name;</span><br><span class="line"><span class="keyword">public</span> Emp next;  <span class="comment">//next 默认为空</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Emp</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Emp</span><span class="params">(<span class="type">int</span> id, String name)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line"><span class="built_in">this</span>.id = id;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.id = id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> Emp <span class="title function_">getNext</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNext</span><span class="params">(Emp next)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.next = next;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建一个EmpLinkList,表示链表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmpLinkedList</span>&#123;</span><br><span class="line"><span class="comment">//投指针，执行第一个Emp,因此我们这个链表的head是直接指向第一个Emp</span></span><br><span class="line"><span class="keyword">private</span> Emp head; <span class="comment">//默认为空</span></span><br><span class="line"><span class="comment">//添加雇员到链表</span></span><br><span class="line"><span class="comment">//说明</span></span><br><span class="line"><span class="comment">//假定，当添加雇员时候，id是自增长，即id的分配总数从小到大的</span></span><br><span class="line"><span class="comment">//因此我们将该雇员直接加入到本链表的最后即可</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Emp emp)</span> &#123;</span><br><span class="line"><span class="comment">//如果是第一个雇员</span></span><br><span class="line"><span class="keyword">if</span>(head == <span class="literal">null</span> ) &#123;</span><br><span class="line">head = emp;</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//如果不是第一个雇员，则使用一个辅助的指针，帮助定位到最后</span></span><br><span class="line"><span class="type">Emp</span> <span class="variable">curEmp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(curEmp.next == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">curEmp = curEmp.next; <span class="comment">//后移</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//退出时直接将emp加入链表</span></span><br><span class="line">curEmp.next = emp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//遍历链表的雇员信息</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(head == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="comment">//如果链表为空</span></span><br><span class="line">System.out.println(<span class="string">&quot;当前链表为空&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;当前链表的信息为：&quot;</span>);</span><br><span class="line"><span class="type">Emp</span> <span class="variable">cuEmp</span> <span class="operator">=</span> head ; <span class="comment">//辅助指针</span></span><br><span class="line"><span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;id = %d name = %s\n&quot;</span>,cuEmp.id,cuEmp.name);</span><br><span class="line">count ++;</span><br><span class="line"><span class="keyword">if</span>(cuEmp.next == <span class="literal">null</span> ) &#123;</span><br><span class="line"><span class="comment">//说明cuEmp已经是最后的节点</span></span><br><span class="line">System.out.println(<span class="string">&quot;共计有&quot;</span>+ count+ <span class="string">&quot;个&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">cuEmp = cuEmp.next;<span class="comment">//后移，遍历</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10-数据结构的存储方式"><a href="#10-数据结构的存储方式" class="headerlink" title="10.数据结构的存储方式"></a>10.数据结构的存储方式</h2><h3 id="10-1二叉树"><a href="#10-1二叉树" class="headerlink" title="10.1二叉树"></a>10.1二叉树</h3><ol><li><p>数组的存储方式的分析<br><strong>优点：</strong>通过下标方式访问元素，速度快。对于有序数组，还可以使用二分查找提高检索速度。</p><p><strong>缺点：</strong>如果要检索具体某个值，或者插入值（按照一定顺序）会整体移动，效率较低。</p></li></ol><ol><li><p>链式存储方式的分析</p><p><strong>优点：</strong>在一定程度上对数组的存储方式有优化（比如：插入一个数值节点，只需要将插入节点，链接到链表中即可，删除效率也很好）</p><p><strong>缺点：</strong>在进行<strong>检索</strong>时，效率仍然比较低，比如（检索某个值，需要从头结点开始遍历）</p></li><li><p>树存储方式的分析</p><p><strong>优点：</strong>可以提高数据存储，读取的效率，比如利用二叉排序树，既可以保证数据的检索速度，同时也可以保证数据的插入，删除，修改的速度。</p><p><strong>缺点：</strong>顺序存储可能会浪费空间（在非完全二叉树的时候，但是读取某个特定的节点的时候效率比较高O(0)）;链式存储相对于二叉树，浪费空间较少，但是读取某个结点时效率偏低O(nlogn)。</p></li></ol><h3 id="10-2-二叉树的概率和常用术语"><a href="#10-2-二叉树的概率和常用术语" class="headerlink" title="10.2 二叉树的概率和常用术语"></a>10.2 二叉树的概率和常用术语</h3><p><strong>满二叉树：</strong>在一个二叉树中，如果所有分支节点都有左孩子节点和右孩子节点，并且叶节点都集中在二叉树中的最下一层，这样的二叉树被称为满二叉树。</p><p><strong>完全二叉树：</strong>若二叉树中最多只有最下面两层的结点的度数可以小于2，并且最下面一层的叶子节点，都依次排列在该层最左边的位置上，这样的二叉树称为完全二叉树。</p><h4 id="遍历和节点删除"><a href="#遍历和节点删除" class="headerlink" title="遍历和节点删除"></a>遍历和节点删除</h4><p>二叉树是一种非常重要的数据结构，非常多的数据结构都是基于二叉树的基础演变而来的。对于二叉树有深度遍历和广度遍历，深度遍历有前序、中序以及后序三种遍历方法，广度遍历即我们寻常所说的层次遍历。由于树的定义本身就是递归定义，因此采用递归的方法实现树的三种遍历。 </p><ul><li>前序遍历：根结点 —&gt;左子树—&gt;右子树；</li><li>中序遍历：左子树 —&gt;根结点—&gt;右子树；</li><li>后续遍历：左子树 —&gt;右子树—&gt;根结点；</li><li>层次遍历：仅仅需按成次遍历即可；</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BinaryTreeDemo</span> &#123;</span><br><span class="line"><span class="comment">//定义一个自定义二叉树</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//创建一个二叉树</span></span><br><span class="line"><span class="comment">//创建一个二叉树</span></span><br><span class="line">        <span class="type">BinaryTree</span> <span class="variable">binaryTree</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BinaryTree</span>();</span><br><span class="line">        <span class="comment">//创建结点</span></span><br><span class="line">        <span class="type">HeroNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">1</span>, <span class="string">&quot;宋江&quot;</span>);</span><br><span class="line">        <span class="type">HeroNode</span> <span class="variable">node2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">2</span>, <span class="string">&quot;卢俊义&quot;</span>);</span><br><span class="line">        <span class="type">HeroNode</span> <span class="variable">node3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">3</span>, <span class="string">&quot;吴用&quot;</span>);</span><br><span class="line">        <span class="type">HeroNode</span> <span class="variable">node4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">4</span>, <span class="string">&quot;公孙胜&quot;</span>);</span><br><span class="line">        <span class="type">HeroNode</span> <span class="variable">node5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">5</span>, <span class="string">&quot;关胜&quot;</span>);</span><br><span class="line">        root.setLeft(node2);</span><br><span class="line">        root.setRight(node3);</span><br><span class="line">        node3.setLeft(node4);</span><br><span class="line">        node3.setRight(node5);</span><br><span class="line">        binaryTree.setRoot(root);</span><br><span class="line">        System.out.println(<span class="string">&quot;前序遍历&quot;</span>);</span><br><span class="line">        binaryTree.preOrder();</span><br><span class="line">        System.out.println(<span class="string">&quot;中序遍历&quot;</span>);</span><br><span class="line">        binaryTree.midOrder();</span><br><span class="line">        System.out.println(<span class="string">&quot;后序遍历&quot;</span>);</span><br><span class="line">        binaryTree.postOrder();</span><br><span class="line">        binaryTree.delNode(<span class="number">3</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;删除结点3，前序遍历&quot;</span>);</span><br><span class="line">        binaryTree.preOrder();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义BinaryTree 二叉树</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BinaryTree</span> &#123;</span><br><span class="line"><span class="keyword">private</span> HeroNode root;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> HeroNode <span class="title function_">getRoot</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRoot</span><span class="params">(HeroNode root)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.root = root;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//前序遍历</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">preOrder</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.root != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.root.preOrder();</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;二叉树为空，不能遍历&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//中序遍历</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">midOrder</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.root != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.root.midOrder();</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;二叉树为空，无法遍历&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//后序遍历</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postOrder</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.root != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.root.postOrder();</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;二叉树为空，无法遍历&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除结点</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delNode</span><span class="params">(<span class="type">int</span> no)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(root != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="comment">//如果只有一个root结点, 这里立即判断root是不是就是要删除结点</span></span><br><span class="line"><span class="keyword">if</span>(root.getNo() == no) &#123;</span><br><span class="line">root = <span class="literal">null</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//递归删除</span></span><br><span class="line">root.delNode(no);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;空树，不能删除~&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//先创建HeroNode 结点</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeroNode</span> &#123;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> no;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> HeroNode left; <span class="comment">//默认null</span></span><br><span class="line"><span class="keyword">private</span> HeroNode right; <span class="comment">//默认null</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode</span><span class="params">(<span class="type">int</span> no, String name)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.no = no;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNo</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> no;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNo</span><span class="params">(<span class="type">int</span> no)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.no = no;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> HeroNode <span class="title function_">getLeft</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLeft</span><span class="params">(HeroNode left)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.left = left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> HeroNode <span class="title function_">getRight</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRight</span><span class="params">(HeroNode right)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.right = right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;HeroNode [no=&quot;</span> + no + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//前序遍历</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">preOrder</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(<span class="built_in">this</span>);<span class="comment">//先输出父节点</span></span><br><span class="line"><span class="comment">//递归向左子树前序遍历</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.left != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.left.preOrder();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//递归向右子树前序遍历</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.right != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.right.preOrder();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//中序遍历</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">midOrder</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//递归向左子树中序遍历</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.left != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.left.midOrder();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="built_in">this</span>);<span class="comment">//输出父节点</span></span><br><span class="line"><span class="comment">//递归向右子树前序遍历</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.right != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.right.midOrder();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//后序遍历</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postOrder</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//递归向左子树后序遍历</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.left != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.left.postOrder();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//递归向右子树前序遍历</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.right != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.right.postOrder();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="built_in">this</span>);<span class="comment">//输出父节点</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//递归删除结点</span></span><br><span class="line"><span class="comment">//1.如果删除的节点是叶子节点，则删除该节点</span></span><br><span class="line"><span class="comment">//2.如果删除的节点是非叶子节点，则删除该子树</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delNode</span><span class="params">(<span class="type">int</span> no)</span> &#123;</span><br><span class="line"><span class="comment">//思路</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 1. 因为我们的二叉树是单向的，所以我们是判断当前结点的子结点是否需要删除结点，而不能去判断当前这个结点是不是需要删除结点.</span></span><br><span class="line"><span class="comment">2. 如果当前结点的左子结点不为空，并且左子结点 就是要删除结点，就将this.left = null; 并且就返回(结束递归删除)</span></span><br><span class="line"><span class="comment">3. 如果当前结点的右子结点不为空，并且右子结点 就是要删除结点，就将this.right= null ;并且就返回(结束递归删除)</span></span><br><span class="line"><span class="comment">4. 如果第2和第3步没有删除结点，那么我们就需要向左子树进行递归删除</span></span><br><span class="line"><span class="comment">5.  如果第4步也没有删除结点，则应当向右子树进行递归删除.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//2. 如果当前结点的左子结点不为空，并且左子结点 就是要删除结点，就将this.left = null; 并且就返回(结束递归删除)</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.left != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.left.no == no) &#123;</span><br><span class="line"><span class="built_in">this</span>.left = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.如果当前结点的右子结点不为空，并且右子结点 就是要删除结点，就将this.right= null ;并且就返回(结束递归删除)</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.right != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.right.no == no) &#123;</span><br><span class="line"><span class="built_in">this</span>.right = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//4.我们就需要向左子树进行递归删除</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.left != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.left.delNode(no);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//5.则应当向右子树进行递归删除</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.right != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.right.delNode(no);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-3链式存储"><a href="#10-3链式存储" class="headerlink" title="10.3链式存储"></a>10.3链式存储</h3><p><strong>查找节点</strong>：先对树进行一次遍历，然后找出要找的那个数；因为有三种排序方法，所以查找节点也分为先序查找，中序查找，后序查找；</p><p><strong>删除节点</strong>：由于链式存储，不能找到要删的数直接删除，需要找到他的父节点，然后将指向该数设置为null；所以需要一个变量来指向父节点，找到数后，再断开连接。</p><p>树：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BinaryTree</span> &#123;</span><br><span class="line"></span><br><span class="line">    TreeNode root;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置根节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRoot</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.root = root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取根节点</span></span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">getRoot</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//先序遍历</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">frontShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">            root.frontShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//中序遍历</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">middleShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">            root.middleShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//后序遍历</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">            root.afterShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//先序查找</span></span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">frontSearch</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> root.frontSearch(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除一个子树</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root.value == i) &#123;</span><br><span class="line">            root = <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            root.delete(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>节点类</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line">    <span class="comment">//节点的权</span></span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">    <span class="comment">//左儿子</span></span><br><span class="line">    TreeNode leftNode;</span><br><span class="line">    <span class="comment">//右儿子</span></span><br><span class="line">    TreeNode rightNode;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TreeNode</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置左儿子</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLeftNode</span><span class="params">(TreeNode leftNode)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.leftNode = leftNode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置右儿子</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRightNode</span><span class="params">(TreeNode rightNode)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.rightNode = rightNode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//先序遍历</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">frontShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//先遍历当前节点的值</span></span><br><span class="line">        System.out.print(value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="comment">//左节点</span></span><br><span class="line">        <span class="keyword">if</span> (leftNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            leftNode.frontShow(); <span class="comment">//递归思想</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//右节点</span></span><br><span class="line">        <span class="keyword">if</span> (rightNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            rightNode.frontShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//中序遍历</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">middleShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//左节点</span></span><br><span class="line">        <span class="keyword">if</span> (leftNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            leftNode.middleShow(); <span class="comment">//递归思想</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//先遍历当前节点的值</span></span><br><span class="line">        System.out.print(value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="comment">//右节点</span></span><br><span class="line">        <span class="keyword">if</span> (rightNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            rightNode.middleShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//后续遍历</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//左节点</span></span><br><span class="line">        <span class="keyword">if</span> (leftNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            leftNode.afterShow(); <span class="comment">//递归思想</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//右节点</span></span><br><span class="line">        <span class="keyword">if</span> (rightNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            rightNode.afterShow();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//先遍历当前节点的值</span></span><br><span class="line">        System.out.print(value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//先序查找</span></span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">frontSearch</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">target</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//对比当前节点的值</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.value == i) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">            <span class="comment">//当前节点不是要查找的节点</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//查找左儿子</span></span><br><span class="line">            <span class="keyword">if</span> (leftNode != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//查找的话t赋值给target，查不到target还是null</span></span><br><span class="line">                target = leftNode.frontSearch(i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果target不为空，说明在左儿子中已经找到</span></span><br><span class="line">            <span class="keyword">if</span> (target != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> target;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果左儿子没有查到，再查找右儿子</span></span><br><span class="line">            <span class="keyword">if</span> (rightNode != <span class="literal">null</span>) &#123;</span><br><span class="line">                target = rightNode.frontSearch(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除一个子树</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">parent</span> <span class="operator">=</span> <span class="built_in">this</span>;</span><br><span class="line">        <span class="comment">//判断左儿子</span></span><br><span class="line">        <span class="keyword">if</span> (parent.leftNode != <span class="literal">null</span> &amp;&amp; parent.leftNode.value == i) &#123;</span><br><span class="line">            parent.leftNode = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//判断右儿子</span></span><br><span class="line">        <span class="keyword">if</span> (parent.rightNode != <span class="literal">null</span> &amp;&amp; parent.rightNode.value == i) &#123;</span><br><span class="line">            parent.rightNode = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果都不是，递归检查并删除左儿子</span></span><br><span class="line">        parent = leftNode;</span><br><span class="line">        <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">            parent.delete(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//递归检查并删除右儿子</span></span><br><span class="line">        parent = rightNode;</span><br><span class="line">        <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">            parent.delete(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建一棵树</span></span><br><span class="line">        <span class="type">BinaryTree</span> <span class="variable">binaryTree</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BinaryTree</span>();</span><br><span class="line">        <span class="comment">//创建一个根节点</span></span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//把根节点赋给树</span></span><br><span class="line">        binaryTree.setRoot(root);</span><br><span class="line">        <span class="comment">//创建左,右节点</span></span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">rootLeft</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">rootRight</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//把新建的节点设置为根节点的子节点</span></span><br><span class="line">        root.setLeftNode(rootLeft);</span><br><span class="line">        root.setRightNode(rootRight);</span><br><span class="line">        <span class="comment">//为第二层的左节点创建两个子节点</span></span><br><span class="line">        rootLeft.setLeftNode(<span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">4</span>));</span><br><span class="line">        rootLeft.setRightNode(<span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">5</span>));</span><br><span class="line">        <span class="comment">//为第二层的右节点创建两个子节点</span></span><br><span class="line">        rootRight.setLeftNode(<span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">6</span>));</span><br><span class="line">        rootRight.setRightNode(<span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">7</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//先序遍历</span></span><br><span class="line">        binaryTree.frontShow(); <span class="comment">//1 2 4 5 3 6 7</span></span><br><span class="line">        System.out.println();</span><br><span class="line">        <span class="comment">//中序遍历</span></span><br><span class="line">        binaryTree.middleShow(); <span class="comment">//4 2 5 1 6 3 7</span></span><br><span class="line">        System.out.println();</span><br><span class="line">        <span class="comment">//后序遍历</span></span><br><span class="line">        binaryTree.afterShow(); <span class="comment">//4 5 2 6 7 3 1</span></span><br><span class="line">        System.out.println();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//先序查找</span></span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">result</span> <span class="operator">=</span> binaryTree.frontSearch(<span class="number">5</span>);</span><br><span class="line">        System.out.println(result); <span class="comment">//binarytree.TreeNode@1b6d3586</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//删除一个子树</span></span><br><span class="line">        binaryTree.delete(<span class="number">2</span>);</span><br><span class="line">        binaryTree.frontShow(); <span class="comment">//1 3 6 7 ，2和他的子节点被删除了</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="10-4顺序存储的二叉树"><a href="#10-4顺序存储的二叉树" class="headerlink" title="10.4顺序存储的二叉树"></a>10.4顺序存储的二叉树</h3><p><strong>概述</strong>：顺序存储使用数组的形式实现；由于非完全二叉树会导致数组中出现空缺，有的位置不能填上数字，所以顺序存储二叉树通常情况下只考虑<strong>完全二叉树</strong></p><p><strong>原理</strong>： 顺序存储在数组中是按照第一层第二层一次往下存储的，遍历方式也有先序遍历、中序遍历、后续遍历</p><p><strong>性质</strong>：</p><ul><li>第n个元素的左子节点是：2*n+1；</li><li>第n个元素的右子节点是：2*n+2；</li><li>第n个元素的父节点是：（n-1)/2</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayBinaryTree</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">int</span>[] data = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>&#125;;</span><br><span class="line"><span class="type">ArrayBinaryTree</span> <span class="variable">tree</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayBinaryTree</span>(data);</span><br><span class="line"><span class="comment">//先序遍历</span></span><br><span class="line">tree.frontShow(); <span class="comment">//1 2 4 5 3 6 7</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span>[] data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayBinaryTree</span><span class="params">(<span class="type">int</span>[] data)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.data = data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//重载先序遍历方法，不用每次传参数了,保证每次从头开始</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">frontShow</span><span class="params">()</span> &#123;</span><br><span class="line">frontShow(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//先序遍历</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">frontShow</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (data == <span class="literal">null</span> || data.length == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//先遍历当前节点的内容</span></span><br><span class="line">System.out.print(data[index] + <span class="string">&quot; &quot;</span>);</span><br><span class="line"><span class="comment">//处理左子树：2*index+1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="number">2</span> * index + <span class="number">1</span> &lt; data.length) &#123;</span><br><span class="line">frontShow(<span class="number">2</span> * index + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//处理右子树：2*index+2</span></span><br><span class="line"><span class="keyword">if</span> (<span class="number">2</span> * index + <span class="number">2</span> &lt; data.length) &#123;</span><br><span class="line">frontShow(<span class="number">2</span> * index + <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="10-5线索二叉树"><a href="#10-5线索二叉树" class="headerlink" title="10.5线索二叉树"></a>10.5线索二叉树</h3><p><strong>为什么使用线索二叉树？</strong></p><p>当用二叉链表作为二叉树的存储结构时，可以很方便的找到某个结点的左右孩子；但一般情况下，无法直接找到该结点在某种遍历序列中的前驱和后继结点</p><p><strong>原理</strong>：n个结点的二叉链表中含有n+1(2n-(n-1)=n+1个空指针域。利用二叉链表中的空指针域，存放指向结点在某种遍历次序下的前驱和后继结点的指针。</p><p><strong>例如</strong>：某个结点的左孩子为空，则将空的左孩子指针域改为指向其前驱；如果某个结点的右孩子为空，则将空的右孩子指针域改为指向其后继（这种附加的指针称为”线索”）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadedBinaryTree</span> &#123;</span><br><span class="line"></span><br><span class="line">    ThreadedNode root;</span><br><span class="line">    <span class="comment">//用于临时存储前驱节点</span></span><br><span class="line">    <span class="type">ThreadedNode</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//设置根节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRoot</span><span class="params">(ThreadedNode root)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.root = root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//中序线索化二叉树</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">threadNodes</span><span class="params">()</span> &#123;</span><br><span class="line">        threadNodes(root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">threadNodes</span><span class="params">(ThreadedNode node)</span> &#123;</span><br><span class="line">        <span class="comment">//当前节点如果为null，直接返回</span></span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//处理左子树</span></span><br><span class="line">        threadNodes(node.leftNode);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//处理前驱节点</span></span><br><span class="line">        <span class="keyword">if</span> (node.leftNode == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//让当前节点的左指针指向前驱节点</span></span><br><span class="line">            node.leftNode = pre;</span><br><span class="line">            <span class="comment">//改变当前节点左指针类型</span></span><br><span class="line">            node.leftType = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//处理前驱的右指针，如果前驱节点的右指针是null（没有右子树）</span></span><br><span class="line">        <span class="keyword">if</span> (pre != <span class="literal">null</span> &amp;&amp; pre.rightNode == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//让前驱节点的右指针指向当前节点</span></span><br><span class="line">            pre.rightNode = node;</span><br><span class="line">            <span class="comment">//改变前驱节点的右指针类型</span></span><br><span class="line">            pre.rightType = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//每处理一个节点，当前节点是下一个节点的前驱节点</span></span><br><span class="line">        pre = node;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//处理右子树</span></span><br><span class="line">        threadNodes(node.rightNode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//遍历线索二叉树</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">threadIterate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//用于临时存储当前遍历节点</span></span><br><span class="line">        <span class="type">ThreadedNode</span> <span class="variable">node</span> <span class="operator">=</span> root;</span><br><span class="line">        <span class="keyword">while</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//循环找到最开始的节点</span></span><br><span class="line">            <span class="keyword">while</span> (node.leftType == <span class="number">0</span>) &#123;</span><br><span class="line">                node = node.leftNode;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//打印当前节点的值</span></span><br><span class="line">            System.out.print(node.value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">            <span class="comment">//如果当前节点的右指针指向的是后继节点，可能后继节点还有后继节点</span></span><br><span class="line">            <span class="keyword">while</span> (node.rightType == <span class="number">1</span>) &#123;</span><br><span class="line">                node = node.rightNode;</span><br><span class="line">                System.out.print(node.value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//替换遍历的节点</span></span><br><span class="line">            node = node.rightNode;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取根节点</span></span><br><span class="line">    <span class="keyword">public</span> ThreadedNode <span class="title function_">getRoot</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//先序遍历</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">frontShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">            root.frontShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//中序遍历</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">middleShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">            root.middleShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//后序遍历</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">            root.afterShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//先序查找</span></span><br><span class="line">    <span class="keyword">public</span> ThreadedNode <span class="title function_">frontSearch</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> root.frontSearch(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除一个子树</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root.value == i) &#123;</span><br><span class="line">            root = <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            root.delete(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadedNode</span> &#123;</span><br><span class="line">    <span class="comment">//节点的权</span></span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">    <span class="comment">//左儿子</span></span><br><span class="line">    ThreadedNode leftNode;</span><br><span class="line">    <span class="comment">//右儿子</span></span><br><span class="line">    ThreadedNode rightNode;</span><br><span class="line">    <span class="comment">//标识指针类型,1表示指向上一个节点，0</span></span><br><span class="line">    <span class="type">int</span> leftType;</span><br><span class="line">    <span class="type">int</span> rightType;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ThreadedNode</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置左儿子</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLeftNode</span><span class="params">(ThreadedNode leftNode)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.leftNode = leftNode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置右儿子</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRightNode</span><span class="params">(ThreadedNode rightNode)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.rightNode = rightNode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//先序遍历</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">frontShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//先遍历当前节点的值</span></span><br><span class="line">        System.out.print(value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="comment">//左节点</span></span><br><span class="line">        <span class="keyword">if</span> (leftNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            leftNode.frontShow(); <span class="comment">//递归思想</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//右节点</span></span><br><span class="line">        <span class="keyword">if</span> (rightNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            rightNode.frontShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//中序遍历</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">middleShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//左节点</span></span><br><span class="line">        <span class="keyword">if</span> (leftNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            leftNode.middleShow(); <span class="comment">//递归思想</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//先遍历当前节点的值</span></span><br><span class="line">        System.out.print(value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="comment">//右节点</span></span><br><span class="line">        <span class="keyword">if</span> (rightNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            rightNode.middleShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//后续遍历</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//左节点</span></span><br><span class="line">        <span class="keyword">if</span> (leftNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            leftNode.afterShow(); <span class="comment">//递归思想</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//右节点</span></span><br><span class="line">        <span class="keyword">if</span> (rightNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            rightNode.afterShow();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//先遍历当前节点的值</span></span><br><span class="line">        System.out.print(value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//先序查找</span></span><br><span class="line">    <span class="keyword">public</span> ThreadedNode <span class="title function_">frontSearch</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="type">ThreadedNode</span> <span class="variable">target</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//对比当前节点的值</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.value == i) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">            <span class="comment">//当前节点不是要查找的节点</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//查找左儿子</span></span><br><span class="line">            <span class="keyword">if</span> (leftNode != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//查找的话t赋值给target，查不到target还是null</span></span><br><span class="line">                target = leftNode.frontSearch(i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果target不为空，说明在左儿子中已经找到</span></span><br><span class="line">            <span class="keyword">if</span> (target != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> target;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果左儿子没有查到，再查找右儿子</span></span><br><span class="line">            <span class="keyword">if</span> (rightNode != <span class="literal">null</span>) &#123;</span><br><span class="line">                target = rightNode.frontSearch(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除一个子树</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="type">ThreadedNode</span> <span class="variable">parent</span> <span class="operator">=</span> <span class="built_in">this</span>;</span><br><span class="line">        <span class="comment">//判断左儿子</span></span><br><span class="line">        <span class="keyword">if</span> (parent.leftNode != <span class="literal">null</span> &amp;&amp; parent.leftNode.value == i) &#123;</span><br><span class="line">            parent.leftNode = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//判断右儿子</span></span><br><span class="line">        <span class="keyword">if</span> (parent.rightNode != <span class="literal">null</span> &amp;&amp; parent.rightNode.value == i) &#123;</span><br><span class="line">            parent.rightNode = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果都不是，递归检查并删除左儿子</span></span><br><span class="line">        parent = leftNode;</span><br><span class="line">        <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">            parent.delete(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//递归检查并删除右儿子</span></span><br><span class="line">        parent = rightNode;</span><br><span class="line">        <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">            parent.delete(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建一棵树</span></span><br><span class="line">        <span class="type">ThreadedBinaryTree</span> <span class="variable">binaryTree</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadedBinaryTree</span>();</span><br><span class="line">        <span class="comment">//创建一个根节点</span></span><br><span class="line">        <span class="type">ThreadedNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadedNode</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//把根节点赋给树</span></span><br><span class="line">        binaryTree.setRoot(root);</span><br><span class="line">        <span class="comment">//创建左,右节点</span></span><br><span class="line">        <span class="type">ThreadedNode</span> <span class="variable">rootLeft</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadedNode</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="type">ThreadedNode</span> <span class="variable">rootRight</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadedNode</span>(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//把新建的节点设置为根节点的子节点</span></span><br><span class="line">        root.setLeftNode(rootLeft);</span><br><span class="line">        root.setRightNode(rootRight);</span><br><span class="line">        <span class="comment">//为第二层的左节点创建两个子节点</span></span><br><span class="line">        rootLeft.setLeftNode(<span class="keyword">new</span> <span class="title class_">ThreadedNode</span>(<span class="number">4</span>));</span><br><span class="line">        <span class="type">ThreadedNode</span> <span class="variable">fiveNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadedNode</span>(<span class="number">5</span>);</span><br><span class="line">        rootLeft.setRightNode(fiveNode);</span><br><span class="line">        <span class="comment">//为第二层的右节点创建两个子节点</span></span><br><span class="line">        rootRight.setLeftNode(<span class="keyword">new</span> <span class="title class_">ThreadedNode</span>(<span class="number">6</span>));</span><br><span class="line">        rootRight.setRightNode(<span class="keyword">new</span> <span class="title class_">ThreadedNode</span>(<span class="number">7</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//中序遍历</span></span><br><span class="line">        binaryTree.middleShow(); <span class="comment">//4 2 5 1 6 3 7</span></span><br><span class="line">        System.out.println();</span><br><span class="line">        <span class="comment">//中序线索化二叉树</span></span><br><span class="line">        binaryTree.threadNodes();</span><br><span class="line"><span class="comment">//        //获取5的后继节点</span></span><br><span class="line"><span class="comment">//        ThreadedNode afterFive = fiveNode.rightNode;</span></span><br><span class="line"><span class="comment">//        System.out.println(afterFive.value); //1</span></span><br><span class="line">        binaryTree.threadIterate(); <span class="comment">//4 2 5 1 6 3 7</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-6二叉排序树"><a href="#10-6二叉排序树" class="headerlink" title="10.6二叉排序树"></a>10.6二叉排序树</h3><p><strong>概述</strong>：二叉排序树（Binary Sort Tree）也叫二叉查找树或者是一颗空树，对于二叉树中的任何一个非叶子节点，要求左子节点比当前节点值小，右子节点比当前节点值大</p><p><strong>特点</strong>：</p><ul><li>查找性能与插入删除性能都适中还不错</li><li>中序遍历的结果刚好是从大到小</li></ul><p><strong>创建二叉排序树原理</strong>：其实就是不断地插入节点，然后进行比较。</p><p><strong>删除节点</strong></p><ul><li>删除叶子节点，只需要找到父节点，将父节点与他的连接断开即可</li><li>删除有一个子节点的就需要将他的子节点换到他现在的位置</li><li>删除有两个子节点的节点，需要使用他的前驱节点或者后继节点进行替换，就是左子树最右下方的数（最大的那个）或右子树最左边的树（最小的数）；即离节点值最接近的值；（还要注解要去判断这个值有没有右节点，有就要将右节点移上来）</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BinarySortTree</span> &#123;</span><br><span class="line">    Node root;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        <span class="comment">//如果是一颗空树</span></span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            root = node;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            root.add(node);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//中序遍历</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">middleShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">            root.middleShow(root);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查找节点</span></span><br><span class="line">    <span class="keyword">public</span> Node <span class="title function_">search</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root.search(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查找父节点</span></span><br><span class="line">    <span class="keyword">public</span> Node <span class="title function_">searchParent</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root.searchParent(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//找到这个节点</span></span><br><span class="line">            <span class="type">Node</span> <span class="variable">target</span> <span class="operator">=</span> search(value);</span><br><span class="line">            <span class="comment">//如果没有这个节点</span></span><br><span class="line">            <span class="keyword">if</span> (target == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//找到他的父节点</span></span><br><span class="line">            <span class="type">Node</span> <span class="variable">parent</span> <span class="operator">=</span> searchParent(value);</span><br><span class="line">            <span class="comment">//要删除的节点是叶子节点</span></span><br><span class="line">            <span class="keyword">if</span> (target.left == <span class="literal">null</span> &amp;&amp; target.left == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//要删除的节点是父节点的左子节点</span></span><br><span class="line">                <span class="keyword">if</span> (parent.left.value == value) &#123;</span><br><span class="line">                    parent.left = <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//要删除的节点是父节点的右子节点</span></span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    parent.right = <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//要删除的节点有两个子节点的情况</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (target.left != <span class="literal">null</span> &amp;&amp; target.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//删除右子树中值最小的节点，并且获取到值</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> deletMin(target.right);</span><br><span class="line">                <span class="comment">//替换目标节点中的值</span></span><br><span class="line">                target.value = min;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//要删除的节点有一个左子节点或右子节点</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//有左子节点</span></span><br><span class="line">                <span class="keyword">if</span> (target.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//要删除的节点是父节点的左子节点</span></span><br><span class="line">                    <span class="keyword">if</span> (parent.left.value == value) &#123;</span><br><span class="line">                        parent.left = target.left;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//要删除的节点是父节点的右子节点</span></span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        parent.right = target.left;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//有右子节点</span></span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//要删除的节点是父节点的左子节点</span></span><br><span class="line">                    <span class="keyword">if</span> (parent.left.value == value) &#123;</span><br><span class="line">                        parent.left = target.right;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//要删除的节点是父节点的右子节点</span></span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        parent.right = target.right;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除一棵树中最小的节点</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">deletMin</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">target</span> <span class="operator">=</span> node;</span><br><span class="line">        <span class="comment">//递归向左找最小值</span></span><br><span class="line">        <span class="keyword">while</span> (target.left != <span class="literal">null</span>) &#123;</span><br><span class="line">            target = target.left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//删除最小的节点</span></span><br><span class="line">        delete(target.value);</span><br><span class="line">        <span class="keyword">return</span> target.value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">    Node left;</span><br><span class="line">    Node right;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//向子树中添加节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*判断传入的节点的值比当前紫薯的根节点的值大还是小*/</span></span><br><span class="line">        <span class="comment">//添加的节点比当前节点更小(传给左节点）</span></span><br><span class="line">        <span class="keyword">if</span> (node.value &lt; <span class="built_in">this</span>.value) &#123;</span><br><span class="line">            <span class="comment">//如果左节点为空</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.left == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.left = node;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果不为空</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.left.add(node);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//添加的节点比当前节点更大(传给右节点）</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.right == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.right = node;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.right.add(node);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//中序遍历二叉排序树，结果刚好是从小到大</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">middleShow</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        middleShow(node.left);</span><br><span class="line">        System.out.print(node.value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        middleShow(node.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查找节点</span></span><br><span class="line">    <span class="keyword">public</span> Node <span class="title function_">search</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.value == value) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value &lt; <span class="built_in">this</span>.value) &#123;</span><br><span class="line">            <span class="keyword">if</span> (left == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> left.search(value);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (right == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> right.search(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查找父节点</span></span><br><span class="line">    <span class="keyword">public</span> Node <span class="title function_">searchParent</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="built_in">this</span>.left != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.left.value == value) || (<span class="built_in">this</span>.right != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.right.value == value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.value &gt; value &amp;&amp; <span class="built_in">this</span>.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.left.searchParent(value);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.value &lt; value &amp;&amp; <span class="built_in">this</span>.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.right.searchParent(value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] arr = &#123;<span class="number">8</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">13</span>&#125;;</span><br><span class="line">        <span class="comment">//创建一颗二叉排序树</span></span><br><span class="line">        <span class="type">BinarySortTree</span> <span class="variable">bst</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BinarySortTree</span>();</span><br><span class="line">        <span class="comment">//循环添加</span></span><br><span class="line"><span class="comment">/*        for(int i=0;i&lt; arr.length;i++) &#123;</span></span><br><span class="line"><span class="comment">            bst.add(new Node(arr[i]));</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i : arr) &#123;</span><br><span class="line">            bst.add(<span class="keyword">new</span> <span class="title class_">Node</span>(i));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//中序遍历</span></span><br><span class="line">        bst.middleShow(); <span class="comment">//1 3 4 6 7 8 10 13 14</span></span><br><span class="line">        System.out.println();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查找节点</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> bst.search(<span class="number">10</span>);</span><br><span class="line">        System.out.println(node.value);<span class="comment">//10</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Node</span> <span class="variable">node2</span> <span class="operator">=</span> bst.search(<span class="number">20</span>);</span><br><span class="line">        System.out.println(node2); <span class="comment">//null</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//查找父节点</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">node3</span> <span class="operator">=</span> bst.searchParent(<span class="number">1</span>);</span><br><span class="line">        <span class="type">Node</span> <span class="variable">node4</span> <span class="operator">=</span> bst.searchParent(<span class="number">14</span>);</span><br><span class="line">        System.out.println(node3.value); <span class="comment">//3</span></span><br><span class="line">        System.out.println(node4.value); <span class="comment">//10</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//删除叶子节点</span></span><br><span class="line"><span class="comment">//        bst.delete(13);</span></span><br><span class="line"><span class="comment">//        bst.middleShow(); //1 3 4 6 7 8 10 14</span></span><br><span class="line"><span class="comment">//        System.out.println();</span></span><br><span class="line"><span class="comment">//        //删除只有一个子节点的节点</span></span><br><span class="line"><span class="comment">//        bst.delete(10);</span></span><br><span class="line"><span class="comment">//        bst.middleShow(); //1 3 4 6 7 8 ；10和14都没了</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//删除有两个子节点的节点</span></span><br><span class="line">        bst.delete(<span class="number">3</span>);</span><br><span class="line">        bst.middleShow(); <span class="comment">//1 4 6 7 8 10 13 14</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="10-7平衡二叉树"><a href="#10-7平衡二叉树" class="headerlink" title="10.7平衡二叉树"></a>10.7平衡二叉树</h3><p>平衡二叉树（Balanced Binary Tree）又被称为AVL树，且具有以下性质：它是一棵空树或它的左右两个子树的高度差的绝对值不超过1，并且左右两个子树都是一棵平衡二叉树。这个方案很好的解决了二叉查找树退化成链表的问题，把插入，查找，删除的时间复杂度最好情况和最坏情况都维持在<code>O(logN)</code>。但是频繁旋转会使插入和删除牺牲掉<code>O(logN)</code>左右的时间，不过相对二叉查找树来说，时间上稳定了很多。 </p><p><strong>平衡因子 BF</strong></p><ul><li>定义：左子树和右子树高度差</li><li>计算：<code>左子树高度 - 右子树高度的值</code></li><li>别名：简称 BF（Balance Factor）</li><li>一般来说 BF 的绝对值大于 1，,平衡树二叉树就失衡，需要旋转纠正</li></ul><p><strong>最小不平衡子树</strong></p><ul><li>距离插入节点最近的，并且 BF 的绝对值大于 1 的节点为根节点的子树。</li><li>旋转纠正只需要纠正最小不平衡子树即可</li></ul><h4 id="旋转方式"><a href="#旋转方式" class="headerlink" title="旋转方式"></a>旋转方式</h4><p><strong>2 种旋转方式</strong>:</p><p>左旋 :</p><ul><li>旧根节点为新根节点的左子树</li><li>新根节点的左子树（如果存在）为旧根节点的右子树</li></ul><p>右旋：</p><ul><li>旧根节点为新根节点的右子树</li><li>新根节点的右子树（如果存在）为旧根节点的左子树</li></ul><p><strong>4 种旋转纠正类型</strong>：</p><ul><li>左左型：插入左孩子的左子树，右旋</li><li>右右型：插入右孩子的右子树，左旋</li><li>左右型：插入左孩子的右子树，先左旋，再右旋</li><li>右左型：插入右孩子的左子树，先右旋，再左旋</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">    Node left;</span><br><span class="line">    Node right;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取当前节点高度</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">height</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Math.max(left == <span class="literal">null</span> ? <span class="number">0</span> : left.height(), right == <span class="literal">null</span> ? <span class="number">0</span> : right.height()) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取左子树高度</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">leftHeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (left == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left.height();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取右子树高度</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">rightHeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (right == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> right.height();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//向子树中添加节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*判断传入的节点的值比当前紫薯的根节点的值大还是小*/</span></span><br><span class="line">        <span class="comment">//添加的节点比当前节点更小(传给左节点）</span></span><br><span class="line">        <span class="keyword">if</span> (node.value &lt; <span class="built_in">this</span>.value) &#123;</span><br><span class="line">            <span class="comment">//如果左节点为空</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.left == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.left = node;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果不为空</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.left.add(node);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//添加的节点比当前节点更大(传给右节点）</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.right == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.right = node;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.right.add(node);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//查询是否平衡</span></span><br><span class="line">        <span class="comment">//右旋转</span></span><br><span class="line">        <span class="keyword">if</span> (leftHeight() - rightHeight() &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="comment">//双旋转，当左子树左边高度小于左子树右边高度时</span></span><br><span class="line">            <span class="keyword">if</span> (left != <span class="literal">null</span> &amp;&amp; left.leftHeight() &lt; left.rightHeight()) &#123;</span><br><span class="line">                <span class="comment">//左子树先进行左旋转</span></span><br><span class="line">                left.leftRotate();</span><br><span class="line">                <span class="comment">//整体进行右旋转</span></span><br><span class="line">                rightRotate();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//单旋转</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                rightRotate();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//左旋转</span></span><br><span class="line">        <span class="keyword">if</span> (leftHeight() - rightHeight() &lt;= -<span class="number">2</span>) &#123;</span><br><span class="line">            <span class="comment">//双旋转</span></span><br><span class="line">            <span class="keyword">if</span> (right != <span class="literal">null</span> &amp;&amp; right.rightHeight() &lt; right.leftHeight()) &#123;</span><br><span class="line">                right.rightRotate();</span><br><span class="line">                leftRotate();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//单旋转</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                leftRotate();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//右旋转</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">rightRotate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//创建一个新的节点，值等于当前节点的值</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">newRight</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(value);</span><br><span class="line">        <span class="comment">//把新节点的右子树设置为当前节点的右子树</span></span><br><span class="line">        newRight.right = right;</span><br><span class="line">        <span class="comment">//把新节点的左子树设置为当前节点的左子树的右子树</span></span><br><span class="line">        newRight.left = left.right;</span><br><span class="line">        <span class="comment">//把当前节点的值换位左子节点的值</span></span><br><span class="line">        value = left.value;</span><br><span class="line">        <span class="comment">//把当前节点的左子树设置为左子树的左子树</span></span><br><span class="line">        left = left.left;</span><br><span class="line">        <span class="comment">//把当前节点设置为新节点</span></span><br><span class="line">        right = newRight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//左旋转</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">leftRotate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//创建一个新的节点，值等于当前节点的值</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">newLeft</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(value);</span><br><span class="line">        <span class="comment">//把新节点的左子树设置为当前节点的左子树</span></span><br><span class="line">        newLeft.left = left;</span><br><span class="line">        <span class="comment">//把新节点的右子树设置为当前节点的右子树的左子树</span></span><br><span class="line">        newLeft.right = right.left;</span><br><span class="line">        <span class="comment">//把当前节点的值换位右子节点的值</span></span><br><span class="line">        value = right.value;</span><br><span class="line">        <span class="comment">//把当前节点的右子树设置为右子树的右子树</span></span><br><span class="line">        right = right.right;</span><br><span class="line">        <span class="comment">//把当前节点设置为新节点</span></span><br><span class="line">        left = newLeft;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//中序遍历二叉排序树，结果刚好是从小到大</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">middleShow</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        middleShow(node.left);</span><br><span class="line">        System.out.print(node.value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        middleShow(node.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查找节点</span></span><br><span class="line">    <span class="keyword">public</span> Node <span class="title function_">search</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.value == value) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value &lt; <span class="built_in">this</span>.value) &#123;</span><br><span class="line">            <span class="keyword">if</span> (left == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> left.search(value);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (right == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> right.search(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查找父节点</span></span><br><span class="line">    <span class="keyword">public</span> Node <span class="title function_">searchParent</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="built_in">this</span>.left != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.left.value == value) || (<span class="built_in">this</span>.right != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.right.value == value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.value &gt; value &amp;&amp; <span class="built_in">this</span>.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.left.searchParent(value);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.value &lt; value &amp;&amp; <span class="built_in">this</span>.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.right.searchParent(value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] arr = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;;</span><br><span class="line">        <span class="comment">//创建一颗二叉排序树</span></span><br><span class="line">        <span class="type">BinarySortTree</span> <span class="variable">bst</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BinarySortTree</span>();</span><br><span class="line">        <span class="comment">//循环添加</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i : arr) &#123;</span><br><span class="line">            bst.add(<span class="keyword">new</span> <span class="title class_">Node</span>(i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//查看高度</span></span><br><span class="line">        System.out.println(bst.root.height()); <span class="comment">//3</span></span><br><span class="line">        <span class="comment">//查看节点值</span></span><br><span class="line">        System.out.println(bst.root.value); <span class="comment">//根节点为4</span></span><br><span class="line">        System.out.println(bst.root.left.value); <span class="comment">//左子节点为2</span></span><br><span class="line">        System.out.println(bst.root.right.value); <span class="comment">//右子节点为5</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">本文主要是笔者在学习java数据结构和算法的笔记</summary>
    
    
    
    <category term="java学习" scheme="https://www.blog.909111.xyz/categories/java%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="java学习" scheme="https://www.blog.909111.xyz/tags/java%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>系统架构师上午题知识点</title>
    <link href="https://www.blog.909111.xyz/posts/7593676.html"/>
    <id>https://www.blog.909111.xyz/posts/7593676.html</id>
    <published>2023-11-09T02:50:23.344Z</published>
    <updated>2023-11-09T02:50:23.344Z</updated>
    
    <content type="html"><![CDATA[<h1 id="系统架构师"><a href="#系统架构师" class="headerlink" title="系统架构师"></a>系统架构师</h1><h2 id="计算机组成与体系结构"><a href="#计算机组成与体系结构" class="headerlink" title="计算机组成与体系结构"></a>计算机组成与体系结构</h2><h3 id="计算机系统组成"><a href="#计算机系统组成" class="headerlink" title="计算机系统组成"></a>计算机系统组成</h3><ul><li><p>计算机硬件组成</p><ul><li><p>控制器</p><ul><li>计算机的指挥中心，负责决定执行程序的顺序，给出执行指令时机器各部分所需要的操作控制命令</li><li>程序计数器、指令寄存器、指令译码器、时序产生器、操作控制器</li></ul></li><li><p>运算器</p><ul><li>最少包括3个寄存器和1个算术逻辑单元</li></ul></li><li><p>主存储器</p><ul><li>内存</li></ul></li><li><p>辅助存储器</p><ul><li>硬盘</li></ul></li><li><p>输入设备</p><ul><li>键盘、鼠标、触摸板等</li></ul></li><li><p>输出设备</p><ul><li>显示器、指示灯等</li></ul></li></ul></li><li><p>计算机体系结构分类</p><ul><li><p>冯诺依曼</p><ul><li>指令地址和数据地址在一起</li></ul></li><li><p>哈佛结构</p><ul><li>指令地址和数据地址分开</li></ul></li><li><p>Flynn分类法</p><ul><li>单指令单数据流 SISD</li><li>单指令多数据流 SIMD</li><li>多指令单数据流 MISD</li><li>多指令多数据流 MIMD</li></ul></li></ul></li><li><p>复杂指令集系统与精简指令集系统</p><ul><li><p>CICS复杂指令系统</p><ul><li>指令数据众多</li><li>指令使用频率相差悬殊</li><li>支持多种寻址方式</li><li>变长指令</li><li>指令可以对主存储单元中的数据直接处理</li><li>以微程序控制为主</li></ul></li><li><p>RICS精简指令系统</p><ul><li>指令数量少</li><li>指令寻址方式少，指令格式种类少</li><li>指令长度固定</li><li>以硬布线控制逻辑为主</li><li>单周期指令执行，采用流水线技术</li><li>优化的编译器</li><li>CPU中通用的寄存器数量多，一般32个多则上千个</li></ul></li></ul></li><li><p>总线</p><ul><li>地址总线</li><li>数据总线</li><li>控制总线</li></ul></li></ul><h3 id="存储器系统"><a href="#存储器系统" class="headerlink" title="存储器系统"></a>存储器系统</h3><ul><li><p>主存储器</p><ul><li>RAM随机存储器</li><li>ROM只读存储器</li></ul></li><li><p>辅存储器</p><ul><li>硬盘</li></ul></li><li><p>cache存储器</p></li></ul><h3 id="流水线"><a href="#流水线" class="headerlink" title="流水线"></a>流水线</h3><ul><li><p>流水线周期</p><ul><li>将流水线分割成N段，最耗时的那一段即为流水线的生命周期</li></ul></li><li><p>流水线执行时间计算</p><ul><li>流水线周期T，花费时间最长的步骤</li><li><p>执行100条指令</p><ul><li>100T+其他步骤的1次时间</li></ul></li></ul></li><li><p>流水线吞吐量</p><ul><li>单位时间内流水线完成的任务量或者数据的结果量</li></ul></li><li><p>流水线加速比</p><ul><li>不使用流水线执行时间 / 使用流水线的执行时间</li></ul></li></ul><h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><h3 id="操作系统的类型与结构"><a href="#操作系统的类型与结构" class="headerlink" title="操作系统的类型与结构"></a>操作系统的类型与结构</h3><ul><li><p>操作系统的定义</p><ul><li>管理计算机硬件和软件资源的系统软件，是计算机的内核和基石</li></ul></li><li><p>操作系统的分类</p><ul><li>批处理操作系统</li><li>分时操作系统</li><li>实时操作系统</li><li>网络操作系统</li><li>分布式操作系统</li></ul></li></ul><h3 id="操作系统的基本原理"><a href="#操作系统的基本原理" class="headerlink" title="操作系统的基本原理"></a>操作系统的基本原理</h3><ul><li>进程管理</li><li>存储管理</li><li>设备管理</li><li>文件管理</li><li>作业管理</li></ul><h2 id="数据库系统"><a href="#数据库系统" class="headerlink" title="数据库系统"></a>数据库系统</h2><h3 id="数据库管理系统的类型"><a href="#数据库管理系统的类型" class="headerlink" title="数据库管理系统的类型"></a>数据库管理系统的类型</h3><h3 id="数据库的模式与范式"><a href="#数据库的模式与范式" class="headerlink" title="数据库的模式与范式"></a>数据库的模式与范式</h3><ul><li><p>数据库的结构与模式</p><ul><li><p>外模式/用户模式</p><ul><li>用户与数据库之间的接口，对用户使用数据的表示，类如数据库的表</li></ul></li><li><p>概念模式</p><ul><li>概念模式反映了数据库系统的整体观</li></ul></li><li><p>内模式</p><ul><li>数据库中全体数据的内部表示或底层描述</li></ul></li></ul></li><li><p>数据模型</p><ul><li><p>概念数据模型</p><ul><li>按照用户的观点对数据和信息进行建模，主要用书数据库设计</li></ul></li><li><p>基本数据模型</p><ul><li><p>层次模型</p><ul><li>优点：查询效率高 1：n</li><li>缺点：对 n:n需要辅助实现，且逻辑复杂</li></ul></li><li><p>网状模型</p><ul><li>优点：m：n查询效率高</li><li>缺点：编写应用程序过于复杂</li></ul></li><li><p>关系模型</p></li><li><p>NoSQL</p><ul><li>Not only SQL</li></ul></li></ul></li></ul></li><li><p>关系代数</p><ul><li><p>并</p><ul><li>相当于SQL中的union，A∪B</li></ul></li><li><p>交</p><ul><li>相当于SQL中的intersect，A∩B</li></ul></li><li><p>差</p><ul><li>相当于SQL中的except，A-B</li></ul></li><li><p>投影</p><ul><li>相当于SQL中的select</li></ul></li><li><p>笛卡尔乘积</p><ul><li>等价于SQL中两个表进行笛卡尔积全匹配得到的结果AXB</li></ul></li><li><p>自然连接</p><ul><li>相当于SQL语句中的natural join，A⋈B</li></ul></li><li><p>除</p></li></ul></li><li><p>数据的规范化</p><ul><li><p>第一范式</p><ul><li>属性具有原子性，不可再分</li></ul></li><li><p>第二范式</p><ul><li>记录的唯一性，消除非主键依赖</li></ul></li><li><p>第三范式</p><ul><li>字段的冗余，消除传递依赖</li></ul></li><li><p>BCNF</p><ul><li>鲍尔斯-科得范式</li></ul></li></ul></li><li><p>反范式化</p><ul><li>没有冗余的数据库未必是最好的数据库，增加冗余，以空间换时间</li><li>增加冗余列</li><li>增加派生列</li><li>重新主表</li></ul></li></ul><h3 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h3><ul><li><p>数据库设计方式</p><ul><li><p>直观设计法</p><ul><li>又称单步逻辑设计法，依赖于设计者的知识、经验和技巧</li></ul></li><li><p>规范设计法</p><ul><li>数据库设计规范，把数据设计分为需求分析，概念结构设计，逻辑结构设计和物理设计4个阶段</li></ul></li><li><p>自动化设计法</p></li></ul></li><li><p>数据设计的基本步骤</p><ul><li><p>需求分析</p><ul><li>收集和分析用户对系统的信息需求和处理需求，需求说明文档</li><li><p>数据字典</p><ul><li>数据项</li><li>数据结构</li><li>数据流</li><li>数据存储</li><li>处理过程</li></ul></li></ul></li><li><p>概念结构设计</p><ul><li>对需求说明书提供的所有数据和处理要求进行抽象与综合处理。E-R模型，与DBMS无关</li></ul></li><li><p>逻辑结构设计</p><ul><li>将概念数据模型转换成DBMS支持的数据模型，E-R图向关系模型转换</li></ul></li><li><p>物理结构设计</p><ul><li>逻辑模型在物理上实现</li></ul></li></ul></li></ul><h3 id="事物管理"><a href="#事物管理" class="headerlink" title="事物管理"></a>事物管理</h3><ul><li>并发控制</li><li>故障与恢复</li></ul><h3 id="备份与恢复"><a href="#备份与恢复" class="headerlink" title="备份与恢复"></a>备份与恢复</h3><ul><li>事物故障</li><li>系统故障</li><li>介质故障</li><li>计算机病毒</li></ul><h3 id="分布式数据库系统"><a href="#分布式数据库系统" class="headerlink" title="分布式数据库系统"></a>分布式数据库系统</h3><ul><li><p>分布式数据库的概念</p><ul><li>分散的多个数据库单元连接起来组成的一个逻辑上统一的数据库</li></ul></li><li><p>分布式数据的架构</p></li></ul><h3 id="数据仓库"><a href="#数据仓库" class="headerlink" title="数据仓库"></a>数据仓库</h3><ul><li><p>数据仓库的概念</p><ul><li>主要用于数据分析</li></ul></li><li><p>数据仓库的步骤</p><ul><li>抽取</li><li><p>转换</p><ul><li>切片、切块</li><li>旋转</li><li>上卷和下钻</li></ul></li><li><p>加载</p></li></ul></li><li><p>数据仓库的实现方法</p><ul><li>MOLAP</li><li>ROLAP</li><li>HOLAP</li></ul></li></ul><h3 id="数据挖掘"><a href="#数据挖掘" class="headerlink" title="数据挖掘"></a>数据挖掘</h3><ul><li><p>数据挖掘的概念</p><ul><li>从大量的数据中，挖掘出未知的且具有价值的信息和知识的过程</li></ul></li><li><p>数据挖掘的功能</p></li><li><p>数据挖掘的常用技术</p><ul><li>关联分析</li><li>序列分析</li><li>分类</li><li>预测</li><li>聚类分析</li><li>时间序列分析</li></ul></li><li><p>数据挖掘的流程</p><ul><li>问题定义</li><li>建立数据挖掘库</li><li>调整数据</li><li>模型化</li><li>评价和解析</li></ul></li></ul><h3 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL"></a>NoSQL</h3><ul><li>Not only SQL，泛指非关系型数据库</li><li>解决大规模数据集合多重数据种类带来的挑战，尤其是大数据应用难题</li></ul><h3 id="大数据"><a href="#大数据" class="headerlink" title="大数据"></a>大数据</h3><ul><li>无法在一定时间内用常规软件工具对其内容进行抓取、管理和处理的数据集合</li></ul><h2 id="计算机网络"><a href="#计算机网络" class="headerlink" title="计算机网络"></a>计算机网络</h2><h3 id="网络架构与协议"><a href="#网络架构与协议" class="headerlink" title="网络架构与协议"></a>网络架构与协议</h3><ul><li><p>网络互联模型</p><ul><li><p>OSI/RM模型</p><ul><li>应用层</li><li>表示层</li><li>会话层</li><li>传输层 - 数据段</li><li>网络层 - 分组数据包</li><li>数据链路层 - 数据帧(Frame)</li><li>物理层 - 比特(bit)</li></ul></li><li><p>TCP/IP结构模型</p><ul><li>应用层</li><li>传输层</li><li>网络互联层</li><li>网络接口层</li></ul></li></ul></li><li><p>常见的网络协议</p><ul><li><p>应用层协议</p><ul><li>HTTP、FTP、TELNET、SMTP</li><li>DNS、RIP、DHCP</li></ul></li><li><p>传输层协议</p><ul><li>TCP、UDP</li></ul></li><li><p>网络层协议</p><ul><li>IP、ARP</li></ul></li></ul></li><li><p>IPV6</p><ul><li>128位，分为8组，每组4位，2001:0DB8:02de:0000:0000:0000:0000:0e13</li><li>每组的前导0，可以省略。2001:DB8:2de:0:0:0:0:e130:0e13 -&gt; 2001:DB8:2de::e13</li></ul></li></ul><h3 id="局域网与广域网"><a href="#局域网与广域网" class="headerlink" title="局域网与广域网"></a>局域网与广域网</h3><ul><li>局域网基础知识</li><li>无线局域网LAN</li><li>广域网技术WAN</li><li><p>网络接入技术</p><ul><li>PSTN接入</li><li>ISDN接入</li><li>ADSL接入</li><li>FTTx+LAN接入</li><li>同轴电缆</li><li><p>光纤接入</p><ul><li>多模光纤</li><li>单模光纤，大容量长距离</li></ul></li></ul></li></ul><h3 id="网络互连与常用设备"><a href="#网络互连与常用设备" class="headerlink" title="网络互连与常用设备"></a>网络互连与常用设备</h3><h3 id="网络工程"><a href="#网络工程" class="headerlink" title="网络工程"></a>网络工程</h3><ul><li>网络规划</li><li>网络设计</li><li>网络实施</li></ul><h3 id="网络存储技术"><a href="#网络存储技术" class="headerlink" title="网络存储技术"></a>网络存储技术</h3><ul><li><p>直连式存储 DAS</p><ul><li>直接与主机系统相连的存储设备</li></ul></li><li><p>网络存储设备 NAS</p><ul><li>采用直接与网络介质相连的特殊设备实现数据存储机制。跨平台的文件共享功能</li></ul></li><li><p>存储区域网 SAN</p><ul><li>通过专用高速网将一个或多个网络存储设备(如磁盘阵列RAID)和服务器连接起来的专用存储系统</li></ul></li></ul><h3 id="综合布线"><a href="#综合布线" class="headerlink" title="综合布线"></a>综合布线</h3><ul><li>工作区</li><li>配线子系统</li><li>干线系统</li><li>建筑群子系统</li><li>设备间</li><li>管理</li></ul><h2 id="系统性能与评价"><a href="#系统性能与评价" class="headerlink" title="系统性能与评价"></a>系统性能与评价</h2><h3 id="性能指标"><a href="#性能指标" class="headerlink" title="性能指标"></a>性能指标</h3><ul><li><p>计算机</p><ul><li>时钟频率</li><li>高速缓存</li><li>运算速度</li><li>运算精度</li><li>内存的存储容量</li><li>存储器的存取周期</li><li>数据处理速率</li><li>响应时间</li><li>RASIS特性</li><li>平均故障响应时间</li><li>兼容性</li></ul></li><li><p>网络</p><ul><li>设备级性能指标</li><li>网络级性能指标</li><li>应用级性能指标</li><li>用户级性能指标</li><li>吞吐量</li></ul></li><li><p>操作系统</p><ul><li>系统的可靠性</li><li>系统的吞吐量</li><li>系统的相应时间</li><li>系统的资源利用率</li><li>可移植性</li></ul></li><li><p>数据管理系统</p></li><li>web服务器</li></ul><h3 id="性能计算"><a href="#性能计算" class="headerlink" title="性能计算"></a>性能计算</h3><h3 id="性能设计"><a href="#性能设计" class="headerlink" title="性能设计"></a>性能设计</h3><ul><li><p>阿木达尔定律</p><ul><li>在并行计算中用多处理器的应用加速受限于程序所需的串行时间百分比</li></ul></li><li><p>负载均衡</p></li></ul><h3 id="性能评估"><a href="#性能评估" class="headerlink" title="性能评估"></a>性能评估</h3><ul><li>web服务器性能评估</li><li><p>基准测试程序</p><ul><li>把应用程序中用得最多、最频繁的核心程序作为评价计算机性能的标准程序。</li></ul></li><li><p>系统监视</p></li></ul><h2 id="开发方法"><a href="#开发方法" class="headerlink" title="开发方法"></a>开发方法</h2><h3 id="软件的生命周期"><a href="#软件的生命周期" class="headerlink" title="软件的生命周期"></a>软件的生命周期</h3><ul><li>软件生命周期分为八个阶段：可行性研究与计划、需求分析、概要设计、详细设计、实现、集成测试、确认测试、使用和维护</li></ul><h3 id="软件开发方法"><a href="#软件开发方法" class="headerlink" title="软件开发方法"></a>软件开发方法</h3><ul><li><p>结构化方法SP</p><ul><li><p>介绍</p><ul><li>结构化方法是一种传统的软件开发方法，它是由结构化分析、结构化设计和结构化程序设计三部分有机结合而成。</li><li>自顶向下、逐步求精、采用模块化技术和功能抽象将系统按功能分解为若干模块</li></ul></li><li><p>结构化分析</p><ul><li>着眼于数据流，自顶向下，逐层分解，建立系统的处理流程，以数据流图和数据字典为主要工具，建立系统的逻辑模型</li><li><ol><li>分析当前情况，制作反应当前物理模型的数据流图DFD(dataflow diagram)</li></ol></li><li>2.推到出等价的逻辑模型DFD</li><li><ol><li>设计新的逻辑系统、生成数据字典和基元描述</li></ol></li><li><ol><li>建立人机接口，提供可供选择的目标系统的物理DFD</li></ol></li><li><ol><li>建立各种方案的成本和风险等级，并据此分析</li></ol></li><li><ol><li>选择一种方案</li></ol></li><li><ol><li>建立完成的需求规约</li></ol></li></ul></li><li><p>结构化设计</p><ul><li><p>SD方法步骤</p><ul><li><ol><li>评审和细化数据流图</li></ol></li><li><ol><li>确定数据流图的类型</li></ol></li><li><ol><li>数据流图映射到软件模块结构，设计模块结构的上层</li></ol></li><li><ol><li>基于数据流图逐步分析高层模块，设计中下层模块</li></ol></li><li><ol><li>对模块结构进行优化，得到更合理的软件结构</li></ol></li></ul></li><li><p>SD方法设计原则</p><ul><li><ol><li>每个模块执行一个功能</li></ol></li><li><ol><li>模块使用过程语句或函数方式调用其他模块</li></ol></li><li><ol><li>模块间传送参数作为数据使用</li></ol></li><li>4.尽量减少模块间共用信息</li></ul></li></ul></li><li><p>缺点</p><ul><li><ol><li>开发周期长</li></ol></li><li><ol><li>早期结构化方法注重系统功能，对数据结构兼顾较少</li></ol></li><li><ol><li>结构化程度较低的系统，在开发初期难于锁定功能要求</li></ol></li></ul></li></ul></li><li><p>面向对象方法</p><ul><li><p>Coad/Yourdon方法（Object-Oriented Analysis and Disign）</p><ul><li>Coad/Yourdon的方法是建立在信息模型化、面向对象的程序设计和知识库系统基础之上的。</li><li><p>面向对象的分析(OOA)</p><ul><li>顶层架构图、用例和用例图、领域概念模型图构成</li><li>确定类与对象</li><li>标识结构</li><li>定义主题</li><li>定义属性</li><li>定义服务</li></ul></li><li><p>面向对象的设计(OOD)</p><ul><li>设计问题域（细化分析结果）</li><li>设计人机交互部分（设计用户界面）</li><li>设计任务管理部分（确定系统资源的分配）</li><li>设计数据管理部分（确定持久对象的存储）</li></ul></li></ul></li><li><p>Booch方法（Object Oriented Design）</p><ul><li>面向对象的设计中主要强调多次重复和开发者的创造性。方法本身是一组启发性的过程式建议</li><li>在一定抽象层次上表示类与对象</li><li>表示类与对象的语义</li><li>表示类与对象之间的关系(继承、实例化、使用等)</li><li>实现类与对象</li></ul></li><li><p>OMT方法-对象建模技术（Object Modeling Technique）</p><ul><li>4个活动：分析、系统设计、对象设计和实现</li></ul></li><li><p>OOSE-面向对象的软件工程（Object-Oriented Software Engineering）</p><ul><li>使用事例驱动的面向对象开发方法。OOSE方法采用5类模型来建立目标系统</li><li><ol><li><p>需求模型</p><ul><li>领域对象模型和界面描述支持</li></ul></li></ol></li><li><ol><li><p>分析模型</p><ul><li>在需求模型基础上建立的，建立在系统生命期中可维护、有逻辑、健壮的结构</li></ul></li></ol></li><li><ol><li><p>设计模型</p><ul><li>精化分析模型并考虑当前的实现环境</li></ul></li></ol></li><li><ol><li><p>实现模型</p><ul><li>实现块的代码</li></ul></li></ol></li><li><ol><li><p>测试模型</p><ul><li>从底层的单元测试延申到高层的系统测试</li></ul></li></ol></li></ul></li></ul></li><li><p>原型方法</p><ul><li>明确并完善需求、探索设计选择方案、发展为最终的产品</li></ul></li><li><p>逆向工程</p><ul><li><p>逆向工程：</p><ul><li>分析程序，力图在比源代码更高的抽象层次上建立程序的表示过程</li><li><p>实现级</p><ul><li>程序的抽象语法树、符号表等信息</li></ul></li><li><p>结构级</p><ul><li>程序间的关系，调用图、结构图、视图等</li></ul></li><li><p>功能级</p><ul><li>功能及程序段之间关系的信息</li></ul></li><li><p>领域级</p><ul><li>实体与应用领域概念之间关系</li></ul></li></ul></li><li><p>再工程</p><ul><li>修复和改造工程</li></ul></li><li><p>软件重构</p><ul><li>不改变软件的功能和外部可见性的情况下，改善软件的结构，提高软件的清晰性、可拓展性和可重用性</li></ul></li></ul></li></ul><h3 id="软件开发模型"><a href="#软件开发模型" class="headerlink" title="软件开发模型"></a>软件开发模型</h3><ul><li><p>瀑布模型</p><ul><li>从一个特定阶段流向下一个阶段</li><li>适合于需求明确的项目</li><li><p>缺点：</p><ul><li><ol><li>上一个阶段的错误会流转到下一个阶段，放大错误</li></ol></li><li><ol><li>难以适应变化</li></ol></li><li><ol><li>结果需要等所有阶段完成后才知道</li></ol></li></ul></li></ul></li><li><p>演化模型</p><ul><li>演化模型可以看做若干个瀑布模型的迭代</li></ul></li><li><p>螺旋模型</p><ul><li>螺旋模型分为四个阶段：需求定义，风险分析，功能实现和评审</li><li>适合用于庞大而复杂、具有高风险的系统</li><li><p>缺点</p><ul><li><ol><li>需要具有想当丰富的风险评估经验和专业知识</li></ol></li><li><ol><li>过多的迭代次数会增加开发成本，延时交付时间</li></ol></li></ul></li></ul></li><li><p>增量模型</p><ul><li><p>适用</p><ul><li>在系统架构成熟，风险较低的适合，可以用增量的方式进行系统开发。</li></ul></li><li><p>介绍</p><ul><li>增量开发模型开发中，每一个版本都是一个完整的版本，版本的时间增量要均匀</li></ul></li></ul></li><li><p>原型法</p><ul><li><p>适用</p><ul><li>用户需求不明确或者技术架构中存在很多不可知因素的适合</li></ul></li><li><p>介绍</p><ul><li>每一个迭代都是一个完整的生命周期</li></ul></li></ul></li><li><p>构件组装模型</p><ul><li>适用</li><li><p>介绍</p><ul><li><p>构件的开发过程</p><ul><li>需求分析和定义</li><li>体系结构设计</li><li>构件库建立</li><li>应用软件构建</li><li>测试和发布</li></ul></li></ul></li><li><p>优点</p><ul><li>构件让系统的拓展变得更加容易；设计良好的构件容易被重用，降低软件开发成本</li></ul></li><li><p>缺点</p><ul><li>对构件的设计需要经验丰富的架构师；考虑软件重用时往往在其他方面做出让步，如性能。</li></ul></li></ul></li></ul><h3 id="统一过程UP"><a href="#统一过程UP" class="headerlink" title="统一过程UP"></a>统一过程UP</h3><ul><li><p>UP二维模型</p><ul><li>4个阶段，初始、细化、构建、交付</li></ul></li><li><p>UP生命周期</p><ul><li>4个里程碑：目标里程碑、架构里程碑、能力里程碑、发布里程碑</li></ul></li><li><p>UP的 特点</p><ul><li><ol><li>UP时一个迭代的二维模型，在生命周期的每一个阶段都可以进行需求、设计等活动</li></ol></li><li><ol><li>可以采用演化模型或者增量模型</li></ol></li><li><ol><li>UP的迭代容易控制开发风险</li></ol></li><li><ol><li>虽然UP时一个迭代开发模型，但是本身不属于敏捷开发</li></ol></li><li><ol><li>在实践应用中可以根据具体问题对UP进行裁剪，从而适应各种软件规模和开发团队</li></ol></li><li>最核心：用例驱动，以架构为中心，迭代和增量</li></ul></li></ul><h3 id="敏捷开发"><a href="#敏捷开发" class="headerlink" title="敏捷开发"></a>敏捷开发</h3><ul><li><p>极限编程</p><ul><li>价值观：沟通、简单、反馈、勇气</li></ul></li><li><p>水晶方法Crystal</p><ul><li>强调不同的项目，采用不同的策略</li></ul></li><li><p>Scrum并列争球</p><ul><li>迭代，30天一个迭代周期，按需求优先级实现</li><li>产品代办事项列表梳理，Sprint计划会议、每日scrum会议、Srpint评审会议、Sprint回顾会议</li></ul></li><li><p>功能驱动开发FDD</p><ul><li>将开发人员分类</li></ul></li></ul><h3 id="软件重用"><a href="#软件重用" class="headerlink" title="软件重用"></a>软件重用</h3><ul><li><p>横向重用</p><ul><li><p>不同应用领域中的软件元素</p><ul><li>标准函数库</li></ul></li></ul></li><li><p>纵向重用</p><ul><li>共性应用领域间的软部分</li></ul></li></ul><h3 id="基于架构的软件设计ABSD"><a href="#基于架构的软件设计ABSD" class="headerlink" title="基于架构的软件设计ABSD"></a>基于架构的软件设计ABSD</h3><ul><li><p>ABSD（Architecture-Based Software Design）方法</p><ul><li>强调由商业、质量和功能需求的组合驱动软件架构设计</li><li>ABSD自顶向下、递归细化的软件开发方法，以软件系统功能的分解为基础，通过选择架构风格实现质量和商业需求，并强调在架构设计过程中使用软件架构模板</li></ul></li><li><p>基于架构的软件开发模型</p><ul><li><p>架构需求</p><ul><li>明确用户对目标软件系统在功能、行为、性能、设计约束等方面的期望</li><li><ol><li>需求获取</li></ol></li><li><ol><li>标识构件活动，获得系统基本结构，分组，打包成构件</li></ol></li><li><ol><li>架构需求评审</li></ol></li></ul></li><li><p>架构设计</p><ul><li>迭代的过程，利用架构需求生成并调整架构策略</li><li><ol><li>提出架构模型</li></ol></li><li><ol><li>将已标识的构件映射到架构中</li></ol></li><li><ol><li>分析构件之间的相互作用</li></ol></li><li><ol><li>产生系统架构</li></ol></li><li><ol><li>设计评审</li></ol></li></ul></li><li><p>架构文档化</p><ul><li>架构规格说明书</li><li>测试架构需求的质量设计说明书</li></ul></li><li><p>架构复审</p><ul><li>评价架构是否能够满足需求、质量属性需求是否在架构中得以体现，层次是否清晰，构件划分是否合理等。（客户代表和领域专家）</li></ul></li><li><p>架构实现</p><ul><li>架构分析和设计</li><li>构件实现</li><li>构件组装</li><li>系统测试</li></ul></li><li><p>演化</p><ul><li>解决用户在系统开发过程中发生的需求变更问题</li><li><ol><li>架构演化计划</li></ol></li><li><ol><li>构件变动</li></ol></li><li><ol><li>更新构件的相互作用</li></ol></li><li><ol><li>构件的组装与测试和技术评审</li></ol></li></ul></li></ul></li></ul><h3 id="形式化方法"><a href="#形式化方法" class="headerlink" title="形式化方法"></a>形式化方法</h3><ul><li>形式化方法式借助数据的方法来解决软件工程领域问题，主要包括建立精确的数学模型以及对模型的分析活动。</li><li><ol><li>基础概念</li></ol></li><li><ol><li>形式化方法与面向对象方的结合</li></ol></li><li><ol><li>工具开发</li></ol></li></ul><h2 id="系统规划"><a href="#系统规划" class="headerlink" title="系统规划"></a>系统规划</h2><h3 id="项目的提出与选择"><a href="#项目的提出与选择" class="headerlink" title="项目的提出与选择"></a>项目的提出与选择</h3><ul><li><p>项目的立项目标和动机</p><ul><li><ol><li>基础研究并获取技术</li></ol></li><li><ol><li>进行应用研发并获取产品</li></ol></li><li><ol><li>提供技术服务</li></ol></li><li><ol><li>信息技术产品的使用者</li></ol></li></ul></li><li><p>项目的选择和确定</p></li><li>项目的提出和选择结果</li></ul><h3 id="可行性研究和效益分析"><a href="#可行性研究和效益分析" class="headerlink" title="可行性研究和效益分析"></a>可行性研究和效益分析</h3><ul><li><p>可行性研究内容</p><ul><li>经济可行性</li><li>技术可行性</li><li>法律可行性</li><li>执行可行性</li><li>方案选择</li></ul></li><li><p>成本效益分析</p></li><li>可行性分析报告</li></ul><h3 id="方案的制定和改进"><a href="#方案的制定和改进" class="headerlink" title="方案的制定和改进"></a>方案的制定和改进</h3><h3 id="新旧继续的分析和比较"><a href="#新旧继续的分析和比较" class="headerlink" title="新旧继续的分析和比较"></a>新旧继续的分析和比较</h3><ul><li><p>遗留系统的评价方法</p><ul><li>商业价值评价</li><li>外部环境评价</li><li>应用软件评价</li></ul></li><li><p>遗留系统的演化策略</p><ul><li><ol><li>淘汰策略 - 低水平低价值</li></ol></li><li><ol><li>继承策略 - 低水平高价值</li></ol></li><li><ol><li>改造策略 - 高水平高价值</li></ol></li><li><ol><li>集成策略 - 高水平低价值</li></ol></li></ul></li></ul><h2 id="系统分析与设计方法"><a href="#系统分析与设计方法" class="headerlink" title="系统分析与设计方法"></a>系统分析与设计方法</h2><h3 id="定义问题与归结模型"><a href="#定义问题与归结模型" class="headerlink" title="定义问题与归结模型"></a>定义问题与归结模型</h3><ul><li><p>问题分析</p><ul><li>目标是在开发之前对要解决的问题有一个更透彻的理解</li><li><p>在问题定义上达成共识</p><ul><li><ol><li>问题概述</li></ol></li><li><ol><li>问题影响</li></ol></li><li><ol><li>问题结果</li></ol></li><li><ol><li>问题优点</li></ol></li></ul></li><li><p>理解问题本质</p><ul><li>鱼骨图</li><li>帕累托图分析问题的本质</li></ul></li><li><p>确定项目干系人和用户</p></li><li><p>定义系统的边界</p><ul><li>系统的边界指解决方案系统和现实世界之间的边界</li><li><ol><li><p>上下文范围图</p><ul><li>数据流图中的顶层图，反应领域信息模型，能够让读者宏观的了解系统</li></ul></li></ol></li><li><ol><li>用例模型</li></ol></li></ul></li><li><p>确定系统实现的约束</p></li></ul></li><li><p>问题定义</p><ul><li><p>目标</p><ul><li>目标是构建系统的原因，他是最高层的用户需求，是业务上的需要</li></ul></li><li><p>功能需求</p><ul><li>指明系统必须要做的事情，只有这些行为的存在，才有系统的存在的价值</li></ul></li><li><p>非功能需求</p><ul><li>指观感需求、易用性需求、性能需求、可操作性需求、可维护性和可移植性需求、安全性需求、文化和正常需求、法律需求</li></ul></li></ul></li></ul><h3 id="需求分析与软件设计"><a href="#需求分析与软件设计" class="headerlink" title="需求分析与软件设计"></a>需求分析与软件设计</h3><ul><li><p>需求分析的任务与过程</p><ul><li><p>问题识别</p><ul><li>发现需求、描述需求</li></ul></li><li><p>分析与综合</p><ul><li>对问题今昔分析，然后在此基础上整合出解决方案</li></ul></li><li><p>编制需求分析文档</p><ul><li>需求规格说明书：对已确定的需求进行稳定化描述</li></ul></li><li><p>需求分析评审</p><ul><li>对功能的正确性、完整性和清晰性，以及其他需求进行评价</li></ul></li></ul></li><li><p>需求获取方法</p><ul><li>用户访谈</li><li>用户调查</li><li>现场观摩</li><li>阅读历史文档</li><li>联合讨论会</li></ul></li><li><p>需求定义</p><ul><li>严格定义方法</li><li><p>原型方法</p><ul><li>先实现一个满足用户基本需求的原型，再由用户在开发过程中提出更好的需求，根据用户要求不断对系统进行改进。这里面有迭代的思想</li></ul></li><li><p>编写软件需求说明书SRS</p></li></ul></li><li><p>如何进行系统设计</p><ul><li>组件的独立性：例外的识别和处理；防错和容错</li></ul></li><li><p>软件设计的任务与活动</p><ul><li>概要设计、详细设计</li></ul></li></ul><h3 id="常用的分析方法"><a href="#常用的分析方法" class="headerlink" title="常用的分析方法"></a>常用的分析方法</h3><ul><li><p>面向数据流 - 结构化分析与设计</p><ul><li>一种面向数据流的需求分析和设计方法，适用于分析和设计大型数据处理系统，是一种简单的方法</li><li><p>结构化分析</p><ul><li>基本思想是自顶向下逐层分解</li></ul></li><li><p>结构化设计</p><ul><li>架构设计</li><li>接口设计</li><li>数据设计</li><li>过程设计</li></ul></li><li><p>模块设计</p><ul><li>模块独立化原则</li><li>信息隐藏原则</li></ul></li></ul></li><li><p>面向对象 - 面向对象的分析与设计</p><ul><li><p>面向对象的基本概念</p><ul><li><p>对象和类</p><ul><li>实体类：映射需求中的每个实体</li><li>边界类：用于封装用例内、外的信息或数据流</li><li>控制类：用于控制用例工作的类</li></ul></li><li><p>继承和范化</p></li><li>多态</li><li><p>模板类</p><ul><li>类属类，用来实现参数多态机制</li></ul></li><li><p>消息和消息通信</p><ul><li>消息：向对象发出的服务请求</li></ul></li></ul></li><li><p>面向对象分析</p><ul><li><p>介绍</p><ul><li>面向对象分析的目标是开发一系列模型，这些模型描述计算机软件，当它工作时以满足一组客户定义的需求</li></ul></li><li><p>OOA/OOD方法</p></li><li>Booch方法</li><li>OMT方法</li><li>OOSE方法</li></ul></li><li><p>统一建模语言UML</p><ul><li><p>用例图</p><ul><li>从用户角度描述了系统的功能，并指出各个功能的执行者</li></ul></li><li><p>类图</p><ul><li>用例图抽象成类，描述类的内部结构和类与类之间的关系</li><li>泛化：继承关系</li><li>实现：类与接口</li><li>关联：拥有关系</li><li>聚合：整体与部分，部分离开整体而单独存在</li><li>组合：整体与部分，部分不能离开整体</li><li>依赖</li></ul></li><li><p>对象图</p><ul><li>各个对象在交互过程中某一时刻的状态</li></ul></li><li><p>序列图</p><ul><li>交互图的一种，对象之间消息发送的先后顺序</li></ul></li><li><p>协作图</p><ul><li>交互图的一种，收发消息的对象的组织关系</li></ul></li><li><p>状态图</p><ul><li>一种由状态、变迁、事件和活动组成的状态机</li></ul></li><li><p>活动图</p><ul><li>状态图的一种特殊情况</li></ul></li><li><p>构件图</p><ul><li>系统中构件与构件之间，类或接口与构件之间的关系图</li></ul></li><li><p>部署图</p><ul><li>物理设备以及之间的连接关系</li></ul></li></ul></li></ul></li><li><p>面向数据结构 - jackson方法</p></li><li>结构化数据系统开发 - DSSD方法 </li></ul><h3 id="用户界面设计"><a href="#用户界面设计" class="headerlink" title="用户界面设计"></a>用户界面设计</h3><ul><li>用户界面设计原则</li><li>用户界面设计过程</li></ul><h3 id="工作流设计"><a href="#工作流设计" class="headerlink" title="工作流设计"></a>工作流设计</h3><ul><li><p>工作流设计概念</p><ul><li>工作流是一类能够完全或者部分自动执行的过程，根据一系列过程规则、文档、信息或任务在不同的执行者之间传递、执行</li></ul></li><li><p>工作流管理系统 WFMC</p><ul><li>在工作流形式化表示的驱动下，通过软件的执行而完成工作流定义、管理及执行的系统，其主要目标是对业务过程中各活动发生的先后次序及与活动相关的相应人力或信息资源的调用进行管理，而实现业务过程的自动化</li></ul></li></ul><h3 id="简单分布式计算机应用系统设计"><a href="#简单分布式计算机应用系统设计" class="headerlink" title="简单分布式计算机应用系统设计"></a>简单分布式计算机应用系统设计</h3><h3 id="系统运行环境的集成与设计"><a href="#系统运行环境的集成与设计" class="headerlink" title="系统运行环境的集成与设计"></a>系统运行环境的集成与设计</h3><ul><li><p>集中式系统</p><ul><li>所有的操作都集中于一台主机中，而操作员必须在主机的附近操作，结果也在附近给出</li></ul></li><li><p>分布式系统</p></li><li>C/S结构</li><li>多层结构</li></ul><h3 id="系统过渡计划"><a href="#系统过渡计划" class="headerlink" title="系统过渡计划"></a>系统过渡计划</h3><ul><li>直接过渡</li><li>并行过渡</li><li>阶段过渡</li></ul><h2 id="软件架构设计"><a href="#软件架构设计" class="headerlink" title="软件架构设计"></a>软件架构设计</h2><h3 id="软件架构概述"><a href="#软件架构概述" class="headerlink" title="软件架构概述"></a>软件架构概述</h3><ul><li><p>软件架构的定义</p><ul><li>软件架构是指一个系统的基础组织，它具体体现在：系统的构件，构件之间、构件与环境之间的关系，以及指导其设计和演化的原则</li></ul></li><li><p>软件架构的重要性</p><ul><li><ol><li>项目关系人之间的交流平台</li></ol></li><li><ol><li>早期设计决策</li></ol></li><li><ol><li>在较高层面实现软件复用</li></ol></li><li><ol><li>架构对开发的指导与规范意义</li></ol></li></ul></li><li><p>架构的模型</p><ul><li><p>结构模型</p><ul><li>这种方法以架构的构件、连接件和其他概念来刻画结构，并力图通过结构来反映系统的重要语义内容，包括系统的配置、约束、隐含的假设条件、风格、性质</li></ul></li><li><p>框架模型</p><ul><li>框架模型与结构模型类似，但它不太侧重描述结构的细节而更侧重于整体的结构</li></ul></li><li><p>动态模型</p><ul><li>动态模型是对结构或框架模型的补充，研究系统”大颗粒“的行为性质</li></ul></li><li><p>过程模型</p><ul><li>过程模型研究构造系统的步骤和过程</li></ul></li><li><p>功能模型</p><ul><li>功能模型：架构由一组功能构件按层次组成，且下层向上层提供服务</li></ul></li><li><p>4+1视图模型</p><ul><li><p>场景视图</p><ul><li>从用户角度、识别业务需求，描述业务场景，是架构设计的起点和终点</li></ul></li><li><p>逻辑视图</p><ul><li>从对象角度，构建对象模型，用以确立逻辑分层、模块划分、模块功能、模块间依赖关系等</li></ul></li><li><p>开发/实现视图</p><ul><li>从开发角度，描述软件在开发环境下的静态组织(程序包、应用的统一框架，引用的类库、SDK和中间件等)，并规范和约束开发环境的结构</li></ul></li><li><p>过程/进程视图</p><ul><li>从进程角度，描述系统的并发和同步设计。旨在解决进程、线程、并发、同步、通信等方面的问题</li></ul></li><li><p>物理视图</p><ul><li>从部署的角度，描述软硬件的映射关系，以及系统在分布/部署上的设计</li></ul></li></ul></li></ul></li></ul><h3 id="架构需求与软件质量属性"><a href="#架构需求与软件质量属性" class="headerlink" title="架构需求与软件质量属性"></a>架构需求与软件质量属性</h3><ul><li>软件质量属性</li><li><p>6个质量属性及实现</p><ul><li><p>可用性</p><ul><li>错误检测：命令/响应；心跳；异常</li><li>错误恢复：表决；主动冗余</li><li>错误预防：从服务中删除；事务；进程监视</li></ul></li><li><p>可修改性</p><ul><li>局部化修改</li><li>防止连锁反应；信息隐藏、限制通信路径；仲裁者使用</li></ul></li><li><p>性能</p><ul><li>资源需求：控制资源使用</li><li>资源管理：引入并发，增加可用资源</li><li>资源仲裁：固定优先级资源调度、动态优化级调度</li></ul></li><li><p>安全性</p><ul><li>抵抗攻击：对用户身份验证、对用户进行授权、维护数据的机密性、维护完整性。</li><li>检测攻击</li><li>从攻击中恢复</li></ul></li><li><p>可测试性</p></li><li>易用性</li></ul></li></ul><h3 id="软件架构风格"><a href="#软件架构风格" class="headerlink" title="软件架构风格"></a>软件架构风格</h3><ul><li>软件架构风格分类</li><li><p>数据流风格</p><ul><li><p>批处理风格</p><ul><li>批处理风格，每一步都是独立的，且每一步都是顺序执行的。例如BAT程序</li></ul></li><li><p>管道-过滤器风格</p><ul><li>UNIX Sheel程序</li></ul></li></ul></li><li><p>调用返回风格</p><ul><li>主程序-子程序</li><li>面向对象风格</li><li>层次结构风格</li></ul></li><li><p>独立构件风格</p><ul><li><p>进程通信</p><ul><li>构件是独立的，连接件传递消息</li></ul></li><li><p>事件驱动</p><ul><li>构件不直接调用一个过程，而是触发或者广播一个或多个事件驱动</li></ul></li></ul></li><li><p>虚拟机风格</p><ul><li><p>解释器</p><ul><li>通常包括解析工作的解析引擎，一个包含被解析的代码存储区，一个记录解析引擎当前工作状态和数据结构，以及记录源代码被解析执行的进度的数据结构</li></ul></li><li><p>基于规则</p></li></ul></li><li><p>仓库风格</p><ul><li><p>数据库系统</p><ul><li><ol><li>重要数据共享，保存当前系统的数据状态</li></ol></li><li><ol><li>多个独立处理元素，处理元素对数据进行操作</li></ol></li></ul></li><li><p>超文本系统</p></li><li><p>黑板风格</p><ul><li>主要应用与信号处理领域或者松耦合代理数据共享存取</li></ul></li></ul></li></ul><h3 id="层次系统架构风格"><a href="#层次系统架构风格" class="headerlink" title="层次系统架构风格"></a>层次系统架构风格</h3><ul><li>二层及三层C/S架构风格</li><li>B/S架构风格</li><li><p>MVC架构风格</p><ul><li><p>Model</p><ul><li>应用状态和业务功能的封装，可以裂解为同时包含数据和行为的领域模型</li></ul></li><li><p>View</p><ul><li>实现可视化界面的呈现，并捕捉最终用户的交互逻辑</li></ul></li><li><p>Controller</p><ul><li>完成响应的UI逻辑，设计业务功能的调用，调用对应的Model</li></ul></li></ul></li></ul><h3 id="面向服务的架构"><a href="#面向服务的架构" class="headerlink" title="面向服务的架构"></a>面向服务的架构</h3><ul><li><p>SOA(Service Oriented Architecture)概述</p><ul><li>所有的功能都定义成了独立的服务。所有的服务通过服务总线或者流程管理器来连接。SOA是一种架构设计模式</li><li><p>设计原则</p><ul><li><ol><li>明确定义的接口</li></ol></li><li><ol><li>模块化</li></ol></li><li>3.. 粗粒度</li><li><ol><li>松耦合</li></ol></li><li><ol><li>互操作性，兼容和策略声明</li></ol></li></ul></li></ul></li><li><p>SOA关键技术</p><ul><li><p>UDDI</p><ul><li><p>UDDI(Universal Description and Integration)统一描述、发现和集成。</p><ul><li>注册和查找服务</li></ul></li></ul></li><li><p>WSDL</p><ul><li><p>Web服务描述语言</p><ul><li>WSDL是一个XML文档，用于说明一组SOAP消息以及如何交换这些消息</li></ul></li></ul></li><li><p>SOAP</p><ul><li><p>简单对象访问协议(http+xml)</p><ul><li>SOAP是Web service的通信协议，用于在网络应用程序之间进行结构化数据交换</li></ul></li></ul></li><li><p>REST</p><ul><li>http+json：表示状态转移；是一种用http和xml进行基于web通信的技术，降低开发的复杂性、提供可伸缩性。</li></ul></li></ul></li><li><p>SOA的实现方法</p><ul><li>Web Service</li><li>企业服务总线ESB</li><li>服务注册表</li></ul></li><li><p>微服务</p><ul><li>微服务架构是一种架构模式或者说是一种架构风格，它提倡将单一应用程序划分成一组小的服务，每个服务运行独立的自己的进程中，服务之间互相协调、互相配合，为用户提供最终价值</li></ul></li></ul><h3 id="架构设计"><a href="#架构设计" class="headerlink" title="架构设计"></a>架构设计</h3><h3 id="软件架构文档化"><a href="#软件架构文档化" class="headerlink" title="软件架构文档化"></a>软件架构文档化</h3><ul><li>记录软件架构的活动，架构编档的过程</li></ul><h3 id="软件架构评估"><a href="#软件架构评估" class="headerlink" title="软件架构评估"></a>软件架构评估</h3><ul><li><p>简介</p><ul><li>对架构分析、评估的技术，对架构策略的选取和决策</li></ul></li><li><p>架构评估的方法</p><ul><li>基于调查列表</li><li>基于场景的方式</li><li>基于度量的方式</li></ul></li><li><p>架构的权衡分析法ATAM</p><ul><li><p>3个概念</p><ul><li><ol><li><p>软件质量属性</p><ul><li>性能</li><li>可靠性</li><li>可用性</li><li>安全性</li><li>可修改性</li></ul></li></ol></li><li><ol><li>敏感点和权衡点</li></ol></li><li><ol><li>风险承担者</li></ol></li></ul></li><li><p>步骤</p><ul><li><ol><li>描述ATAM方法</li></ol></li><li><ol><li>描述商业动机</li></ol></li><li><ol><li>描述架构体系结构</li></ol></li><li><ol><li>确定架构体系结构方法</li></ol></li><li><ol><li>生成质量属性效用树</li></ol></li><li><ol><li><p>分析架构方法</p><ul><li>确定架构上的有风险决策，无风险决策、敏感点和权衡点</li></ul></li></ol></li><li><ol><li>集体讨论，确定场景优先级</li></ol></li><li><ol><li>分析架构方法，重复6</li></ol></li><li><ol><li>结果描述</li></ol></li></ul></li></ul></li><li><p>成本效益分析法</p></li></ul><h3 id="构件及复用"><a href="#构件及复用" class="headerlink" title="构件及复用"></a>构件及复用</h3><ul><li><p>商用构件标准化规范</p><ul><li>三大主流中间件技术平台</li><li>CORBA</li><li>J2EE</li><li>DNA</li></ul></li><li><p>应用系统簇与构件系统</p></li><li>基于复用开发的组织结构</li></ul><h3 id="产品线及系统演化"><a href="#产品线及系统演化" class="headerlink" title="产品线及系统演化"></a>产品线及系统演化</h3><ul><li>复用与产品线</li><li>基础产品线的架构</li><li>产品线的开发模型</li><li><p>特定领域的软件架构DSSA</p><ul><li><p>领域分析</p><ul><li>获得领域模型</li></ul></li><li><p>领域设计</p><ul><li>获得DSSA</li></ul></li><li><p>领域实现</p><ul><li>依据领域模型和DSSA开发于组织可复用信息</li></ul></li></ul></li><li><p>软件及系统的演化</p><ul><li><ol><li>需求变动归类</li></ol></li><li>2.制定架构演化计划</li><li><ol><li>修改、增加或删除构件</li></ol></li><li><ol><li>更新构件的相互作用</li></ol></li><li><ol><li>构件组装与测试</li></ol></li><li><ol><li>技术评审</li></ol></li><li><ol><li>产生演化后的架构</li></ol></li></ul></li></ul><h3 id="软件架构视图"><a href="#软件架构视图" class="headerlink" title="软件架构视图"></a>软件架构视图</h3><ul><li>软件视图的分类</li><li>模块视图类型</li><li>C&amp;S视图及其风格</li><li>分配视图类及其风格</li><li>各视图类型间的映射关系</li></ul><h2 id="设计模式23种"><a href="#设计模式23种" class="headerlink" title="设计模式23种"></a>设计模式23种</h2><h3 id="创建型"><a href="#创建型" class="headerlink" title="创建型"></a>创建型</h3><ul><li><p>工厂方法 Factroy</p><ul><li>动态生产对象</li></ul></li><li><p>抽象工厂 Abstract Factory</p><ul><li>生产成系列对象</li></ul></li><li><p>构建器/生成器 Builder</p><ul><li>复杂对象构造</li></ul></li><li><p>原型模式 Prototype</p><ul><li>克隆对象</li></ul></li><li><p>单例模式 Singleton</p><ul><li>单实例</li></ul></li></ul><h3 id="结构型"><a href="#结构型" class="headerlink" title="结构型"></a>结构型</h3><ul><li><p>适配器 Adapter</p><ul><li>转换接口</li></ul></li><li><p>桥接模式 Bridge</p><ul><li>将抽象部分和它的实现部分分离</li></ul></li><li><p>组合模式 Composite</p><ul><li>表示“整体-部分”的层次结构</li></ul></li><li><p>装饰器 Decorator</p><ul><li>动态附加职责</li></ul></li><li><p>外观模式 Facade</p><ul><li>对外统一接口</li></ul></li><li><p>享元模式 Flyweight</p><ul><li>提供大量细粒度对象共享的方式</li></ul></li><li><p>代理模式 Proxy</p><ul><li>快捷方式</li></ul></li></ul><h3 id="行为型"><a href="#行为型" class="headerlink" title="行为型"></a>行为型</h3><ul><li><p>责任链 Chain of Responsibility</p><ul><li>传递职责</li></ul></li><li><p>命令模式 Command</p><ul><li>请求封装成对象，日志记录</li></ul></li><li><p>解释器 Interpreter</p><ul><li>虚拟机机制，根据文法表示来解释语言中句子</li></ul></li><li><p>迭代器 Iterator</p><ul><li>顺序访问一个聚合对象中的各个元素</li></ul></li><li><p>中介者 Mediator</p><ul><li>用一个中介对象来封装一系列的对象交互</li></ul></li><li><p>备忘录Memento</p><ul><li>在不破坏封装性的前提下，捕获一个对象的内部状态，游戏存档</li></ul></li><li><p>观察者 Observer</p><ul><li>当一个对象的状态发生改变，所有依赖它的对象都得到通知并自动更新</li></ul></li><li><p>状态模式 State</p><ul><li>允许一个对象在其内部状态改变时改变它的行为</li></ul></li><li><p>策略模式 Strategy</p><ul><li>多方案切换</li></ul></li><li><p>模板方法 Template</p><ul><li>子类不改变算法结构，即可重新定义</li></ul></li><li><p>访问者 Visitor</p><ul><li>数据与操作分离，使得在不改变个元素的类的前提下定义作用于这些元素的新操作</li></ul></li></ul><h2 id="测试评审方法"><a href="#测试评审方法" class="headerlink" title="测试评审方法"></a>测试评审方法</h2><h3 id="完全评审"><a href="#完全评审" class="headerlink" title="完全评审"></a>完全评审</h3><ul><li>对整个项目中的所有测试用例进行评审</li></ul><h3 id="有选择性的评审"><a href="#有选择性的评审" class="headerlink" title="有选择性的评审"></a>有选择性的评审</h3><ul><li>只对部分测试用例进行评审</li></ul><h3 id="指标评审法"><a href="#指标评审法" class="headerlink" title="指标评审法"></a>指标评审法</h3><ul><li>测试用例的评审覆盖率达到多少</li></ul><h2 id="嵌入式系统设计"><a href="#嵌入式系统设计" class="headerlink" title="嵌入式系统设计"></a>嵌入式系统设计</h2><h2 id="开发管理"><a href="#开发管理" class="headerlink" title="开发管理"></a>开发管理</h2><h3 id="项目管理"><a href="#项目管理" class="headerlink" title="项目管理"></a>项目管理</h3><ul><li>概念阶段</li><li>开发阶段</li><li>实施阶段</li><li>结束阶段</li></ul><h3 id="范围管理"><a href="#范围管理" class="headerlink" title="范围管理"></a>范围管理</h3><ul><li><p>创建工作分解结构(WBS)</p><ul><li>管理层</li><li>技术层</li></ul></li></ul><h3 id="成本管理"><a href="#成本管理" class="headerlink" title="成本管理"></a>成本管理</h3><ul><li><p>成本估算</p><ul><li>自顶向下的估算法</li><li>自底向上的估算法</li><li>差别估算法</li></ul></li><li><p>成本预算</p></li><li>净值分析</li></ul><h3 id="时间管理"><a href="#时间管理" class="headerlink" title="时间管理"></a>时间管理</h3><ul><li>活动排序</li><li><p>活动历时估算</p><ul><li>软件项目的工作量</li><li>德尔菲法</li><li>类比估算法</li><li>功能点估算法</li></ul></li><li><p>关键路径法</p></li><li>计划评审技术</li><li>甘特图和时间网络图</li><li>进度控制</li></ul><h3 id="配置管理"><a href="#配置管理" class="headerlink" title="配置管理"></a>配置管理</h3><h3 id="质量管理"><a href="#质量管理" class="headerlink" title="质量管理"></a>质量管理</h3><h3 id="风险管理"><a href="#风险管理" class="headerlink" title="风险管理"></a>风险管理</h3><h3 id="软件运行与评价"><a href="#软件运行与评价" class="headerlink" title="软件运行与评价"></a>软件运行与评价</h3><h3 id="软件过程改进"><a href="#软件过程改进" class="headerlink" title="软件过程改进"></a>软件过程改进</h3><ul><li><p>CMM-软件过程能力成熟模型</p><ul><li><p>初始级</p><ul><li>软件工程管理制度缺乏，过程缺乏定义、混论无序</li></ul></li><li><p>可重复级</p><ul><li>基于类似的项目经验，建立了基本的项目管理制度，采取了一定的资源控制手段</li></ul></li><li><p>已定义级</p><ul><li>软件过程文档化、标准化、可按照需求改进开发过程，采用评审方法保证软件质量</li></ul></li><li><p>已管理级</p><ul><li>所有过程建立相应的度量方式和明确的度量指标，度量式详尽且可用于理解和控制软件过程的</li></ul></li><li><p>优化级</p><ul><li>可根据执行过程的反馈来改善下一步的执行过程，优化执行步骤，指令和效率稳步提升和改进</li></ul></li></ul></li><li><p>CMMI-能力成熟模型集成</p></li></ul><h2 id="信息系统的基础知识"><a href="#信息系统的基础知识" class="headerlink" title="信息系统的基础知识"></a>信息系统的基础知识</h2><h2 id="基于中间件的开发"><a href="#基于中间件的开发" class="headerlink" title="基于中间件的开发"></a>基于中间件的开发</h2><h3 id="中间件是基础软件的一大类，属于可复用软件的范畴。操作系统-网络-数据-gt-中间件-gt-应用程序"><a href="#中间件是基础软件的一大类，属于可复用软件的范畴。操作系统-网络-数据-gt-中间件-gt-应用程序" class="headerlink" title="中间件是基础软件的一大类，属于可复用软件的范畴。操作系统/网络/数据 -&gt; 中间件 -&gt; 应用程序"></a>中间件是基础软件的一大类，属于可复用软件的范畴。操作系统/网络/数据 -&gt; 中间件 -&gt; 应用程序</h3><h3 id="RPC-远程调用过程"><a href="#RPC-远程调用过程" class="headerlink" title="RPC-远程调用过程"></a>RPC-远程调用过程</h3><ul><li>使应用程序中的过程，调用远程应用程序的过程，就像本地调用一样</li></ul><h3 id="MOM-面向消息的中间件"><a href="#MOM-面向消息的中间件" class="headerlink" title="MOM-面向消息的中间件"></a>MOM-面向消息的中间件</h3><ul><li>使分布式应用程序可以通过发送和接收消息来进行通信和交换数据</li></ul><h3 id="ORB-对象请求代理"><a href="#ORB-对象请求代理" class="headerlink" title="ORB-对象请求代理"></a>ORB-对象请求代理</h3><ul><li>使应用程序的对象能够在异类网络之间分布和共享</li></ul><h2 id="安全性和保密性设计"><a href="#安全性和保密性设计" class="headerlink" title="安全性和保密性设计"></a>安全性和保密性设计</h2><h3 id="信息系统安全体系"><a href="#信息系统安全体系" class="headerlink" title="信息系统安全体系"></a>信息系统安全体系</h3><ul><li><p>安全系统架构</p><ul><li><p>安全服务</p><ul><li>认证</li><li>访问控制</li><li>数据机密性</li><li>数据完整性</li><li>不可否认服务</li></ul></li><li><p>特定的安全机制</p><ul><li>机密机制</li><li>数字签名</li><li>访问控制机制</li><li>数据完整性</li><li>认证交换机制</li><li>流量填充机制</li><li>路由控制机制</li><li>公证机制</li></ul></li><li><p>普遍性的安全机制</p><ul><li>可信功能度</li><li>安全标记</li><li>事件检测</li><li>安全审计跟踪</li><li>安全恢复</li></ul></li></ul></li><li><p>安全保护等级</p><ul><li>用户自主保护级</li><li>系统审计保护级</li><li>安全标记保护级</li><li>结构化保护级</li><li>访问验证保护级</li></ul></li><li><p>信息安全保障系统</p><ul><li>MIS+S系统</li><li>S-MIS系统</li><li>S2-MIS系统</li></ul></li><li><p>可信计算机系统</p><ul><li><p>D类</p><ul><li>最小保护</li></ul></li><li><p>C类</p><ul><li>自主保护，自主访问控制和审计跟踪</li></ul></li><li><p>B类</p><ul><li>强制安全保护</li></ul></li><li><p>A类</p><ul><li>验证设计</li></ul></li></ul></li></ul><h3 id="数据安全与保密"><a href="#数据安全与保密" class="headerlink" title="数据安全与保密"></a>数据安全与保密</h3><ul><li><p>加密体制</p><ul><li><p>对称加密</p><ul><li>FEAL、IDEA、DES</li></ul></li><li><p>非对称加密</p><ul><li>RSA</li></ul></li></ul></li><li><p>PKI与数字签名</p></li><li>数字信封</li><li>PGP</li><li>数字水印</li></ul><h3 id="计算机网络安全"><a href="#计算机网络安全" class="headerlink" title="计算机网络安全"></a>计算机网络安全</h3><ul><li><p>网络安全设计</p><ul><li>木桶原则</li><li>整体性安全</li><li>安全性评价与平衡原则</li><li>标准化与一致性原则</li><li>技术与管理相结合原则</li><li>筹划规划</li><li>等级性原则</li><li>动态发展原则</li><li>易操作性原则</li></ul></li><li><p>单点登录技术</p></li><li>无线设备安全性</li><li><p>防火墙</p><ul><li>网络级防火墙</li><li>应用级防火墙</li></ul></li><li><p>入侵检测</p></li><li><p>虚拟专用网(VPN)</p><ul><li>安全隧道技术</li><li>加解密技术</li><li>密钥管理技术</li><li>身份认证技术</li><li>访问控制技术</li></ul></li></ul><h3 id="电子商务安全"><a href="#电子商务安全" class="headerlink" title="电子商务安全"></a>电子商务安全</h3><ul><li>SSL-传输层安全协议</li><li>SET-安全电子交易协议</li></ul><h3 id="安全管理"><a href="#安全管理" class="headerlink" title="安全管理"></a>安全管理</h3><ul><li>安全策略</li><li><p>安全体系</p><ul><li>病毒与木马扫描</li><li>安全扫描</li><li>日志审计系统</li><li>安全审计</li><li>个人信息控制</li><li>安全管理制度</li></ul></li></ul><h3 id="计算机操作安全"><a href="#计算机操作安全" class="headerlink" title="计算机操作安全"></a>计算机操作安全</h3><h3 id="系统备份与恢复"><a href="#系统备份与恢复" class="headerlink" title="系统备份与恢复"></a>系统备份与恢复</h3><ul><li><p>业务持续规划</p><ul><li>灾难恢复规划</li><li>业务恢复规划</li><li>危机管理规划</li></ul></li></ul><h2 id="系统可靠性分析与设计"><a href="#系统可靠性分析与设计" class="headerlink" title="系统可靠性分析与设计"></a>系统可靠性分析与设计</h2><h3 id="可靠性定义"><a href="#可靠性定义" class="headerlink" title="可靠性定义"></a>可靠性定义</h3><ul><li>系统在规定的时间及规定的环境条件下，完成规定功能的能力，也就是系统无故障运行的概率</li></ul><h3 id="可靠性指标"><a href="#可靠性指标" class="headerlink" title="可靠性指标"></a>可靠性指标</h3><ul><li>平均无故障时间(MTTF)</li><li>平均故障修复时间(MTTR)</li><li>平均故障间隔时间(MTBF)</li><li>系统可用性</li></ul><h3 id="可靠性计算"><a href="#可靠性计算" class="headerlink" title="可靠性计算"></a>可靠性计算</h3><ul><li><p>串联系统</p><ul><li>R1xR2XR3</li></ul></li><li><p>并联系统</p><ul><li>1-(1-R1)(1-R2)</li></ul></li></ul><h3 id="可靠性设计"><a href="#可靠性设计" class="headerlink" title="可靠性设计"></a>可靠性设计</h3><ul><li><p>冗余设计</p><ul><li><p>结构冗余</p><ul><li><p>静态冗余</p><ul><li>表决和比较来屏蔽系统中出现的错误</li></ul></li><li><p>动态冗余</p><ul><li>多模块待机储备，检查到工作模块出问题，就备用模块来顶替</li></ul></li><li><p>混合冗余</p></li></ul></li><li><p>信息冗余</p><ul><li>除正常功能所需信息外，添加一些信息保证信息完整性</li></ul></li><li><p>时间冗余</p><ul><li>重复执行指令或程序</li></ul></li></ul></li><li><p>软件容错</p><ul><li><p>恢复块方法</p><ul><li>一种动态的故障屏蔽技术，采用后向恢复策略</li></ul></li><li><p>N版本程序设计</p><ul><li>一种静态的故障屏蔽技术，采用向前恢复测率（表决）</li></ul></li><li><p>防卫式程序设计</p><ul><li>程序中包含错误检查代码和错误恢复代码</li></ul></li></ul></li><li><p>集群技术</p><ul><li>两台以上的节点机(服务器)构成的一种松散耦合的计算节点集合</li></ul></li></ul><h2 id="软件知识产权与法律法规"><a href="#软件知识产权与法律法规" class="headerlink" title="软件知识产权与法律法规"></a>软件知识产权与法律法规</h2><h3 id="著作权法"><a href="#著作权法" class="headerlink" title="著作权法"></a>著作权法</h3><h3 id="计算机软件保护条例"><a href="#计算机软件保护条例" class="headerlink" title="计算机软件保护条例"></a>计算机软件保护条例</h3><h3 id="招投标法"><a href="#招投标法" class="headerlink" title="招投标法"></a>招投标法</h3><h3 id="专利权"><a href="#专利权" class="headerlink" title="专利权"></a>专利权</h3><h3 id="不正当竞争"><a href="#不正当竞争" class="headerlink" title="不正当竞争"></a>不正当竞争</h3><h3 id="商标法"><a href="#商标法" class="headerlink" title="商标法"></a>商标法</h3><h2 id="标准化知识"><a href="#标准化知识" class="headerlink" title="标准化知识"></a>标准化知识</h2><h3 id="国际标准IEC、ISO"><a href="#国际标准IEC、ISO" class="headerlink" title="国际标准IEC、ISO"></a>国际标准IEC、ISO</h3><h3 id="国家标准GB"><a href="#国家标准GB" class="headerlink" title="国家标准GB"></a>国家标准GB</h3><h3 id="行业标准（NY农业，JC建材）"><a href="#行业标准（NY农业，JC建材）" class="headerlink" title="行业标准（NY农业，JC建材）"></a>行业标准（NY农业，JC建材）</h3><h3 id="地方标准"><a href="#地方标准" class="headerlink" title="地方标准"></a>地方标准</h3><h3 id="企业标准-Q"><a href="#企业标准-Q" class="headerlink" title="企业标准 Q"></a>企业标准 Q</h3><h2 id="应用数学"><a href="#应用数学" class="headerlink" title="应用数学"></a>应用数学</h2><h3 id="图论"><a href="#图论" class="headerlink" title="图论"></a>图论</h3><ul><li><p>最小生成树</p><ul><li>普利姆算法</li><li>克鲁斯卡尔算法</li></ul></li><li><p>最短路径</p></li><li>关键路径</li></ul><h3 id="运筹学"><a href="#运筹学" class="headerlink" title="运筹学"></a>运筹学</h3><ul><li>线性规划</li><li>对策论(竞赛论/博弈论)</li><li>决策论</li></ul><h2 id="虚拟化、云计算、物联网"><a href="#虚拟化、云计算、物联网" class="headerlink" title="虚拟化、云计算、物联网"></a>虚拟化、云计算、物联网</h2>]]></content>
    
    
    <summary type="html">本文将围绕软考架构师上午题的相关知识点进行讲解和统计</summary>
    
    
    
    <category term="架构师" scheme="https://www.blog.909111.xyz/categories/%E6%9E%B6%E6%9E%84%E5%B8%88/"/>
    
    
    <category term="架构师" scheme="https://www.blog.909111.xyz/tags/%E6%9E%B6%E6%9E%84%E5%B8%88/"/>
    
  </entry>
  
  <entry>
    <title>数据结构与算法</title>
    <link href="https://www.blog.909111.xyz/posts/4b0178e0.html"/>
    <id>https://www.blog.909111.xyz/posts/4b0178e0.html</id>
    <published>2023-11-09T02:50:23.343Z</published>
    <updated>2023-11-09T02:50:23.343Z</updated>
    
    <content type="html"><![CDATA[<h1 id="数据结构与算法"><a href="#数据结构与算法" class="headerlink" title="数据结构与算法"></a>数据结构与算法</h1><h2 id="1-线性存储与非线性存储"><a href="#1-线性存储与非线性存储" class="headerlink" title="1 线性存储与非线性存储"></a>1 线性存储与非线性存储</h2><h3 id="1-1-线性结构"><a href="#1-1-线性结构" class="headerlink" title="1.1 线性结构"></a>1.1 线性结构</h3><ol><li><strong>线性结构</strong>：特点数据元素直接存在一对一的线性关系</li><li>线性结构有两种不同的存储结构，顺序存储（数组）和链式存储结构（链表）。顺序存储的线性表称为顺序表，顺序表中的存储元素是连续的。</li><li>链式存储的线性表称为链表，链表中的存储元素不一定是连续的，元素节点中存方的数据元素以及相邻元素的地址信息。</li><li>线性结构常见的有：数组，队列，链表和栈。</li></ol><h3 id="1-2-非线性结构"><a href="#1-2-非线性结构" class="headerlink" title="1.2 非线性结构"></a>1.2 非线性结构</h3><p>非线性结构：二维数组，多维数组，广义表，树结构，图结构。</p><h2 id="2-数组"><a href="#2-数组" class="headerlink" title="2 数组"></a>2 数组</h2><h3 id="2-1-稀疏数组"><a href="#2-1-稀疏数组" class="headerlink" title="2.1 稀疏数组"></a>2.1 稀疏数组</h3><p>当一个数组中大部分元素为0的时候，或者为同一个值的数组时，可以使用稀疏数组来保存该数组。</p><p>稀疏数组处理的方式：</p><ol><li>记录数组一共有<strong>几行几列，有多少个不同</strong>的值。</li><li>把具有不同的元素的行列及值记录在一个小规模数组中，从而缩小程序的规模。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> class 稀疏数组 &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//创建一个原始的二维数组</span></span><br><span class="line"><span class="comment">//0 ：表示没有棋子，1表示黑子，2表示白字</span></span><br><span class="line"><span class="type">int</span> chessArr1[][] = <span class="keyword">new</span> <span class="title class_">int</span> [<span class="number">11</span>][<span class="number">11</span>];</span><br><span class="line">chessArr1[<span class="number">1</span>][<span class="number">2</span>] =<span class="number">1</span>;</span><br><span class="line">chessArr1[<span class="number">2</span>][<span class="number">3</span>] = <span class="number">2</span>;</span><br><span class="line"><span class="comment">//输出原始数组</span></span><br><span class="line">System.out.println(<span class="string">&quot;原始的二维为：&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> [] row : chessArr1) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> data: row) &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;%d   &quot;</span>,data);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将二维数组转稀疏数组</span></span><br><span class="line"><span class="comment">// 1先遍历二维数组得到0数据的个数</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">11</span> ; i++) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">11</span> ; j++) &#123;</span><br><span class="line"><span class="keyword">if</span>(chessArr1[i][j] != <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">sum ++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建对应的稀疏数组</span></span><br><span class="line"><span class="type">int</span> sparseArr[][] = <span class="keyword">new</span> <span class="title class_">int</span> [sum +<span class="number">1</span>][<span class="number">3</span>];</span><br><span class="line"><span class="comment">//给稀疏数组赋值</span></span><br><span class="line">sparseArr[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">11</span>;</span><br><span class="line">sparseArr[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">11</span>;</span><br><span class="line">sparseArr[<span class="number">0</span>][<span class="number">2</span>] = sum;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">//遍历二维数组，将非0的值存放到sparseArr中</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">11</span>; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">11</span>; j++) &#123;</span><br><span class="line"><span class="keyword">if</span>(chessArr1[i][j] != <span class="number">0</span>) &#123;</span><br><span class="line">count ++;</span><br><span class="line">sparseArr[count][<span class="number">0</span>] = i; </span><br><span class="line">sparseArr[count][<span class="number">1</span>] = j;</span><br><span class="line">sparseArr[count][<span class="number">2</span>] = chessArr1[i][j];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出稀疏数组的形式</span></span><br><span class="line">System.out.println();</span><br><span class="line">System.out.println(<span class="string">&quot;得到的稀疏数组&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; sparseArr.length ; i++) &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;%d\t%d\t%d\t\n&quot;</span>,sparseArr[i][<span class="number">0</span>],sparseArr[i][<span class="number">1</span>],sparseArr[i][<span class="number">2</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//将稀疏数组回复为原来的数组</span></span><br><span class="line"><span class="comment">//第一步，先读取稀疏数组的第一行，根据第一行的数据创建原始的二维数组</span></span><br><span class="line"><span class="type">int</span> chessArr2[][] = <span class="keyword">new</span> <span class="title class_">int</span> [sparseArr[<span class="number">0</span>][<span class="number">0</span>]][sparseArr[<span class="number">0</span>][<span class="number">1</span>]];</span><br><span class="line"><span class="comment">//第二部，在稀疏数组后的几行的数据从第二行开始，并赋值给原始的二维数组</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">1</span>; i &lt; sparseArr.length; i++) &#123;</span><br><span class="line"> chessArr2[sparseArr[i][<span class="number">0</span>]][sparseArr[i][<span class="number">1</span>]] = sparseArr[i][<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//输出恢复后的二维数组</span></span><br><span class="line">System.out.println();</span><br><span class="line">System.out.println(<span class="string">&quot;恢复后的二维数组&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> [] row : chessArr2) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> data: row) &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;%d   &quot;</span>,data);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-队列"><a href="#3-队列" class="headerlink" title="3 队列"></a>3 队列</h2><h3 id="3-1-队列"><a href="#3-1-队列" class="headerlink" title="3.1 队列"></a>3.1 队列</h3><ol><li><p>队列是一有序列表，可以使用数组或者是链表来实现.</p></li><li><p>遵循先入先从的原则。</p><p>==一般我们采用rear 指针和front指针进行操作。==</p></li></ol><h3 id="3-2队列的模拟"><a href="#3-2队列的模拟" class="headerlink" title="3.2队列的模拟"></a>3.2队列的模拟</h3><p>队列是有序列表，使用数组结构来存储队列的数据。</p><p>队列的入队一般使用addQueue,addQueue的处理需要两个步骤。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayQueueDemo</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//创建一个对象</span></span><br><span class="line">ArrayQueue  aq=<span class="keyword">new</span> <span class="title class_">ArrayQueue</span>(<span class="number">3</span>);</span><br><span class="line"><span class="type">char</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&#x27; &#x27;</span>;<span class="comment">//用于接收用户数据</span></span><br><span class="line"><span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"><span class="type">boolean</span> <span class="variable">loop</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"><span class="comment">//输出一个菜单</span></span><br><span class="line"><span class="keyword">while</span>(loop) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;s(show):显示队列&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;e(exit):退出队列&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;a(add):添加数据到队列&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;g(get):从队列取出数据&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;h(head):查看队列头的数据&quot;</span>);</span><br><span class="line">key = sc.next().charAt(<span class="number">0</span>);<span class="comment">//接去第一个字符</span></span><br><span class="line"><span class="keyword">switch</span>(key) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:  <span class="comment">//展示队列数据</span></span><br><span class="line">aq.showQueue();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;a&#x27;</span>: <span class="comment">//向队列添加数据</span></span><br><span class="line">System.out.println(<span class="string">&quot;请输入一个数&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> sc.nextInt();</span><br><span class="line">aq.addQueue(value);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;g&#x27;</span>: <span class="comment">//获得队列的数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> aq.getQueue();</span><br><span class="line">System.out.printf(<span class="string">&quot;取出的数据实%d\n&quot;</span>,res);</span><br><span class="line">aq.getQueue();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">System.out.println(e.getMessage());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;h&#x27;</span>: <span class="comment">//查看队列头的数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> aq.headQueue();</span><br><span class="line">System.out.printf(<span class="string">&quot;取出的数据实%d\n&quot;</span>,res);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">System.out.println(e.getMessage());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;e&#x27;</span>: <span class="comment">//代表要退出</span></span><br><span class="line">sc.close();</span><br><span class="line">loop = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;程序退出&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用数组模拟队列，编写一个ArrayQueue类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ArrayQueue</span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> maxSize;<span class="comment">//设置数组的最大容量</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> front;<span class="comment">//队列头</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> rear;<span class="comment">//队列尾部</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> [] arr;<span class="comment">//该数据用于存放数据，模拟队列</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建队列的构造器</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayQueue</span><span class="params">(<span class="type">int</span> arrMaxSize)</span> &#123;</span><br><span class="line">maxSize = arrMaxSize;</span><br><span class="line">arr = <span class="keyword">new</span> <span class="title class_">int</span> [maxSize];</span><br><span class="line">front  = -<span class="number">1</span>;  <span class="comment">//指向队列头部，指向队列头的前一个位置</span></span><br><span class="line">rear = -<span class="number">1</span>; <span class="comment">//指向队列尾部，队列尾部包含对象最后一个数据，通俗的讲就是队列最后一个位置</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断队列是否满</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> rear == maxSize - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断队列是否为空</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isNull</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> rear == front;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//数据是否添加到队列</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addQueue</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="comment">//判读队列是否满</span></span><br><span class="line"><span class="keyword">if</span>(isFull()) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;队列满，不能加入数据&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">rear ++ ; <span class="comment">//让rear 后移动</span></span><br><span class="line">arr[rear] = n;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//判读队列的数据，出队列</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getQueue</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//判读队列是否为空</span></span><br><span class="line"><span class="keyword">if</span>(isNull()) &#123;</span><br><span class="line"><span class="comment">//抛出异常</span></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;队列为空，不能获取数据&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">front ++;</span><br><span class="line"><span class="keyword">return</span> arr[front];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//显示队列所有数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showQueue</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//将数组数据遍历</span></span><br><span class="line"><span class="keyword">if</span>(isNull()) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;队列为空，没有数据&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++ ) &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;arr[%d]=%d\n&quot;</span>,i,arr[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//显示队列的头数据，注意不是取出数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">headQueue</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//判断</span></span><br><span class="line"><span class="keyword">if</span>(isNull()) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;队列空，没有数据&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> arr[front + <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此处存在一个问题，就是我们只能使用一次，无法对队列进行多次使用。</p><p>将这个数组使用算法改变成为一个环形队列 方式，采用取模的方式。</p><h3 id="3-3-判断队列为空队列为满"><a href="#3-3-判断队列为空队列为满" class="headerlink" title="3.3 判断队列为空队列为满"></a>3.3 判断队列为空队列为满</h3><p>==front == rear 代表队列为空。==</p><p>当指针rear 小于队列的最大下标maxSize - 1,则将数据存入rear锁指向的数组元素中，否则无法存入数据</p><p>==rear == maxSize -1 代表队列已满==</p><h3 id="3-4-使用数组模拟环形队列"><a href="#3-4-使用数组模拟环形队列" class="headerlink" title="3.4 使用数组模拟环形队列"></a>3.4 使用数组模拟环形队列</h3><p>思路：</p><ol><li><p>front 变量的含义做一个调整：front就指向队列的第一个元素，也就是说arr[front]就是队列的第一个元素。</p><p>front的初始值为0；</p></li><li><p>rear变量的含义做一个调整：rear指向队列的最后一个元素的后一个位置，因为希望空出一个空间作为约定。rear 的初始值为0；</p></li><li><p>当队列满时，条件是<code>(rear + 1)%maxSize == front</code> 此时满。</p></li><li><p>当队列为空的条件，rear == front 空</p></li><li><p>当这样分析后，此时队列中有效的数据的个数是 <code>(rear + maxSize - front)%maxSize //rear=1 front=0</code></p></li><li><p>以上我们就可以按照我们的思路对原来的代码进行修改。</p></li></ol><h2 id="4-链表"><a href="#4-链表" class="headerlink" title="4. 链表"></a>4. 链表</h2><p>链表是有序的列表：</p><ol><li>链表是以<strong>节点</strong>的方式来存储的，是一<strong>种链式存储的</strong>方法存储。</li><li>每个节点包<strong>含data域，next域</strong>，指向下一个节点。</li><li>链表的<strong>各个节点不一定是连续存储</strong></li><li>链表分<strong>带头节点的链表和不带头结点</strong>的链表，根据实际的需求来确定。</li></ol><h3 id="4-1-单向链表"><a href="#4-1-单向链表" class="headerlink" title="4.1 单向链表"></a>4.1 单向链表</h3><p>head 节点</p><h5 id="单向链表的实现"><a href="#单向链表的实现" class="headerlink" title="单向链表的实现"></a>单向链表的实现</h5><ol><li>不存放具体的数据</li><li>作用就是表示单链表头next</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingleLinkedListDemo</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//测试</span></span><br><span class="line"><span class="comment">//创建节点</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">1</span>,<span class="string">&quot;松江&quot;</span>,<span class="string">&quot;及时雨&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">2</span>,<span class="string">&quot;卢俊义&quot;</span>,<span class="string">&quot;玉麒麟&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">3</span>,<span class="string">&quot;吴用&quot;</span>,<span class="string">&quot;智多星&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">4</span>,<span class="string">&quot;林冲&quot;</span>,<span class="string">&quot;豹子头&quot;</span>);</span><br><span class="line"><span class="comment">//创建链表</span></span><br><span class="line"><span class="type">SingleLinkedList</span> <span class="variable">singleLinkedList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleLinkedList</span>();</span><br><span class="line">singleLinkedList.add(hero1);</span><br><span class="line">singleLinkedList.add(hero2);</span><br><span class="line">singleLinkedList.add(hero3);</span><br><span class="line">singleLinkedList.add(hero4);</span><br><span class="line"></span><br><span class="line"><span class="comment">//显示链表</span></span><br><span class="line">singleLinkedList.list();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个SingleLinkedList来管理我们的英雄</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingleLinkedList</span>&#123;</span><br><span class="line"><span class="comment">//先初始化一个头结点，一般上头结点不要动</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">HeroNode</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">0</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加节点到单向链表</span></span><br><span class="line"><span class="comment">//思路，当不考虑编号顺序时</span></span><br><span class="line"><span class="comment">//1 找到当前链表的最后节点</span></span><br><span class="line"><span class="comment">//2,将最后这个节点的nex指向新节点</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(HeroNode heroNode)</span> &#123;</span><br><span class="line"><span class="comment">//因为head节点不能动，因此我们需要一个辅助遍历temo</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="comment">//遍历链表，找到最后</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//找到链表的最后</span></span><br><span class="line"><span class="keyword">if</span>(temp.next == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//如果没有找到最后，将temp后移</span></span><br><span class="line">temp = temp.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当退出while循环后，temp就指向链表的最后</span></span><br><span class="line"><span class="comment">//将最后这个节点的next指向新的节点</span></span><br><span class="line">temp.next = heroNode;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//显示链表【遍历】</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//判读是否为空</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;链表为空&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//因为头结点，不能动，因此我们需要一个辅助变量来遍历</span></span><br><span class="line"><span class="type">HeroNode</span>  <span class="variable">temp</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//判断是否是否链表最后</span></span><br><span class="line"><span class="keyword">if</span>(temp == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出节点的信息</span></span><br><span class="line">System.out.println(temp);</span><br><span class="line"><span class="comment">//将next后移,如果不后移将进入死循环</span></span><br><span class="line">temp = temp.next ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个heroNode ,每个HeroNode对象就是一个节点</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeroNode</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> no;</span><br><span class="line"><span class="keyword">public</span> String name;</span><br><span class="line"><span class="keyword">public</span> String nickName;</span><br><span class="line"><span class="keyword">public</span> HeroNode next;<span class="comment">//指向下一个节点</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//构造器</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode</span><span class="params">(<span class="type">int</span> no, String name, String nickName)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line"><span class="built_in">this</span>.no = no;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line"><span class="built_in">this</span>.nickName = nickName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;HeroNode [no=&quot;</span> + no + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;, nickName=&quot;</span> + nickName + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>目前，我们需要添加相关节点的进行有序添加。</p><h5 id="有序添加"><a href="#有序添加" class="headerlink" title="有序添加"></a>有序添加</h5><p>需要按照编号的顺序添加：</p><ol><li>首先找到新天节点的节点的位置，是通过辅助变量(指针)，通过遍历来搞定</li><li>新的节点 <code>next=temp.next</code></li><li>将<code>temp.next=新节点</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingleLinkedListDemo</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//测试</span></span><br><span class="line"><span class="comment">//创建节点</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">1</span>,<span class="string">&quot;松江&quot;</span>,<span class="string">&quot;及时雨&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">2</span>,<span class="string">&quot;卢俊义&quot;</span>,<span class="string">&quot;玉麒麟&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">3</span>,<span class="string">&quot;吴用&quot;</span>,<span class="string">&quot;智多星&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">4</span>,<span class="string">&quot;林冲&quot;</span>,<span class="string">&quot;豹子头&quot;</span>);</span><br><span class="line"><span class="comment">//创建链表</span></span><br><span class="line"><span class="type">SingleLinkedList</span> <span class="variable">singleLinkedList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleLinkedList</span>();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero1);</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero2);</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero3);</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero4);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">singleLinkedList.addByOrder(hero3);</span><br><span class="line">singleLinkedList.addByOrder(hero1);</span><br><span class="line">singleLinkedList.addByOrder(hero4);</span><br><span class="line">singleLinkedList.addByOrder(hero2);</span><br><span class="line">singleLinkedList.addByOrder(hero2);</span><br><span class="line"></span><br><span class="line"><span class="comment">//显示链表</span></span><br><span class="line">singleLinkedList.list();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个SingleLinkedList来管理我们的英雄</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingleLinkedList</span>&#123;</span><br><span class="line"><span class="comment">//先初始化一个头结点，一般上头结点不要动</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">HeroNode</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">0</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加节点到单向链表</span></span><br><span class="line"><span class="comment">//思路，当不考虑编号顺序时</span></span><br><span class="line"><span class="comment">//1 找到当前链表的最后节点</span></span><br><span class="line"><span class="comment">//2,将最后这个节点的nex指向新节点</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(HeroNode heroNode)</span> &#123;</span><br><span class="line"><span class="comment">//因为head节点不能动，因此我们需要一个辅助遍历temo</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="comment">//遍历链表，找到最后</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//找到链表的最后</span></span><br><span class="line"><span class="keyword">if</span>(temp.next == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//如果没有找到最后，将temp后移</span></span><br><span class="line">temp = temp.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当退出while循环后，temp就指向链表的最后</span></span><br><span class="line"><span class="comment">//将最后这个节点的next指向新的节点</span></span><br><span class="line">temp.next = heroNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//第二种方式添加英雄时，根据排名将英雄插入到指定位置</span></span><br><span class="line"><span class="comment">//如果有这个排名，则添加失败，并给出提示</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addByOrder</span><span class="params">(HeroNode heroNode)</span> &#123;</span><br><span class="line"><span class="comment">//因为头结点不能动，因此我们仍然通过一个辅助指针（变量）来帮助找到添加的位置</span></span><br><span class="line"><span class="comment">//因为单链表，因为我们找的temp是位于添加位置的前一个节点，否则插入不了</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;  <span class="comment">//false标记添加的编号是否存在，默认为false</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(temp.next == <span class="literal">null</span>) &#123; <span class="comment">//说明此时temp处于链表的最后</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(temp.next.no &gt; heroNode.no) &#123;</span><br><span class="line"><span class="comment">//此时位置找到，就在temp的后边插入</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(temp.next.no == heroNode.no) </span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//说明希望添加的heroNode的编号已然存在</span></span><br><span class="line">flag = <span class="literal">true</span>;  <span class="comment">//说明编号存在</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">temp = temp.next;  <span class="comment">//后移，变量当前链表</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//判断flag的值</span></span><br><span class="line"><span class="keyword">if</span>(flag) &#123;<span class="comment">//不能添加，说明编号存在</span></span><br><span class="line">System.out.printf(<span class="string">&quot;准备插入的英雄的编号%d，已经存在,无法添加\n&quot;</span>,heroNode.no);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//插入到链表中，temp后边</span></span><br><span class="line">heroNode.next = temp.next;</span><br><span class="line">temp.next = heroNode;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//显示链表【遍历】</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//判读是否为空</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;链表为空&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//因为头结点，不能动，因此我们需要一个辅助变量来遍历</span></span><br><span class="line"><span class="type">HeroNode</span>  <span class="variable">temp</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//判断是否是否链表最后</span></span><br><span class="line"><span class="keyword">if</span>(temp == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出节点的信息</span></span><br><span class="line">System.out.println(temp);</span><br><span class="line"><span class="comment">//将next后移,如果不后移将进入死循环</span></span><br><span class="line">temp = temp.next ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个heroNode ,每个HeroNode对象就是一个节点</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeroNode</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> no;</span><br><span class="line"><span class="keyword">public</span> String name;</span><br><span class="line"><span class="keyword">public</span> String nickName;</span><br><span class="line"><span class="keyword">public</span> HeroNode next;<span class="comment">//指向下一个节点</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//构造器</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode</span><span class="params">(<span class="type">int</span> no, String name, String nickName)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line"><span class="built_in">this</span>.no = no;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line"><span class="built_in">this</span>.nickName = nickName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;HeroNode [no=&quot;</span> + no + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;, nickName=&quot;</span> + nickName + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="修改链表中的参数"><a href="#修改链表中的参数" class="headerlink" title="修改链表中的参数"></a>修改链表中的参数</h5><ol><li>先找到该节点，通过遍历。</li><li><code>temp.name = newHeroNode.name;temp.nickName=newHeroNode.nickName;</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingleLinkedListDemo</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//测试</span></span><br><span class="line"><span class="comment">//创建节点</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">1</span>,<span class="string">&quot;松江&quot;</span>,<span class="string">&quot;及时雨&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">2</span>,<span class="string">&quot;卢俊义&quot;</span>,<span class="string">&quot;玉麒麟&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">3</span>,<span class="string">&quot;吴用&quot;</span>,<span class="string">&quot;智多星&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">4</span>,<span class="string">&quot;林冲&quot;</span>,<span class="string">&quot;豹子头&quot;</span>);</span><br><span class="line"><span class="comment">//创建链表</span></span><br><span class="line"><span class="type">SingleLinkedList</span> <span class="variable">singleLinkedList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleLinkedList</span>();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero1);</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero2);</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero3);</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero4);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">singleLinkedList.addByOrder(hero3);</span><br><span class="line">singleLinkedList.addByOrder(hero1);</span><br><span class="line">singleLinkedList.addByOrder(hero4);</span><br><span class="line">singleLinkedList.addByOrder(hero2);</span><br><span class="line">singleLinkedList.addByOrder(hero2);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;修改之前的&quot;</span>);</span><br><span class="line">singleLinkedList.list();</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试修改节点的代码</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">newHeroNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">2</span>,<span class="string">&quot;小卢&quot;</span>,<span class="string">&quot;玉麒麟···&quot;</span>);</span><br><span class="line">singleLinkedList.update(newHeroNode);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;修改之后的的链表情况&quot;</span>);</span><br><span class="line"><span class="comment">//显示链表</span></span><br><span class="line">singleLinkedList.list();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个SingleLinkedList来管理我们的英雄</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingleLinkedList</span>&#123;</span><br><span class="line"><span class="comment">//先初始化一个头结点，一般上头结点不要动</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">HeroNode</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">0</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加节点到单向链表</span></span><br><span class="line"><span class="comment">//思路，当不考虑编号顺序时</span></span><br><span class="line"><span class="comment">//1 找到当前链表的最后节点</span></span><br><span class="line"><span class="comment">//2,将最后这个节点的nex指向新节点</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(HeroNode heroNode)</span> &#123;</span><br><span class="line"><span class="comment">//因为head节点不能动，因此我们需要一个辅助遍历temo</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="comment">//遍历链表，找到最后</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//找到链表的最后</span></span><br><span class="line"><span class="keyword">if</span>(temp.next == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//如果没有找到最后，将temp后移</span></span><br><span class="line">temp = temp.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当退出while循环后，temp就指向链表的最后</span></span><br><span class="line"><span class="comment">//将最后这个节点的next指向新的节点</span></span><br><span class="line">temp.next = heroNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//第二种方式添加英雄时，根据排名将英雄插入到指定位置</span></span><br><span class="line"><span class="comment">//如果有这个排名，则添加失败，并给出提示</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addByOrder</span><span class="params">(HeroNode heroNode)</span> &#123;</span><br><span class="line"><span class="comment">//因为头结点不能动，因此我们仍然通过一个辅助指针（变量）来帮助找到添加的位置</span></span><br><span class="line"><span class="comment">//因为单链表，因为我们找的temp是位于添加位置的前一个节点，否则插入不了</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;  <span class="comment">//false标记添加的编号是否存在，默认为false</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(temp.next == <span class="literal">null</span>) &#123; <span class="comment">//说明此时temp处于链表的最后</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(temp.next.no &gt; heroNode.no) &#123;</span><br><span class="line"><span class="comment">//此时位置找到，就在temp的后边插入</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(temp.next.no == heroNode.no) </span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//说明希望添加的heroNode的编号已然存在</span></span><br><span class="line">flag = <span class="literal">true</span>;  <span class="comment">//说明编号存在</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">temp = temp.next;  <span class="comment">//后移，变量当前链表</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//判断flag的值</span></span><br><span class="line"><span class="keyword">if</span>(flag) &#123;<span class="comment">//不能添加，说明编号存在</span></span><br><span class="line">System.out.printf(<span class="string">&quot;准备插入的英雄的编号%d，已经存在,无法添加\n&quot;</span>,heroNode.no);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//插入到链表中，temp后边</span></span><br><span class="line">heroNode.next = temp.next;</span><br><span class="line">temp.next = heroNode;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//修该节点的信息，根据no编号来修改，即no编号不能更改</span></span><br><span class="line"><span class="comment">//说明</span></span><br><span class="line"><span class="comment">//1 根据newHeroNode的no来修改便可</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(HeroNode newHeroNode)</span> &#123;</span><br><span class="line"><span class="comment">//判断是否为空</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;链表为空。。。&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//找到需要修改的节点，根据no编号</span></span><br><span class="line"><span class="comment">//定义一个辅助变量</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;<span class="comment">//表示是否找到该节点</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(temp == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;<span class="comment">//已经变量完链表</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(temp.no == newHeroNode.no) &#123;</span><br><span class="line"><span class="comment">//找到了</span></span><br><span class="line">flag = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">temp = temp.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//根据flag判断是否找到要修改的节点</span></span><br><span class="line"><span class="keyword">if</span>(flag) &#123;</span><br><span class="line">temp.name = newHeroNode.name;</span><br><span class="line">temp.nickName = newHeroNode.nickName;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//没有找到</span></span><br><span class="line">System.out.printf(<span class="string">&quot;没有找到编号%d的节点，不能修改\n&quot;</span>,newHeroNode.no);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//显示链表【遍历】</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//判读是否为空</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;链表为空&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//因为头结点，不能动，因此我们需要一个辅助变量来遍历</span></span><br><span class="line"><span class="type">HeroNode</span>  <span class="variable">temp</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//判断是否是否链表最后</span></span><br><span class="line"><span class="keyword">if</span>(temp == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出节点的信息</span></span><br><span class="line">System.out.println(temp);</span><br><span class="line"><span class="comment">//将next后移,如果不后移将进入死循环</span></span><br><span class="line">temp = temp.next ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个heroNode ,每个HeroNode对象就是一个节点</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeroNode</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> no;</span><br><span class="line"><span class="keyword">public</span> String name;</span><br><span class="line"><span class="keyword">public</span> String nickName;</span><br><span class="line"><span class="keyword">public</span> HeroNode next;<span class="comment">//指向下一个节点</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//构造器</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode</span><span class="params">(<span class="type">int</span> no, String name, String nickName)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line"><span class="built_in">this</span>.no = no;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line"><span class="built_in">this</span>.nickName = nickName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;HeroNode [no=&quot;</span> + no + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;, nickName=&quot;</span> + nickName + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="删除节点"><a href="#删除节点" class="headerlink" title="删除节点"></a>删除节点</h5><p>从单链表中删除一个节点的思路</p><ol><li>删除节点之前，我们需要将有关节点先找到需要删除的这个节点的前一个节点temp</li><li><code>temp.next = temp.next.next;</code></li><li>被删除的节点将不会有其他的指向，会被JVM垃圾回收机制回收。</li></ol><p>代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingleLinkedListDemo</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//测试</span></span><br><span class="line"><span class="comment">//创建节点</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">1</span>,<span class="string">&quot;松江&quot;</span>,<span class="string">&quot;及时雨&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">2</span>,<span class="string">&quot;卢俊义&quot;</span>,<span class="string">&quot;玉麒麟&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">3</span>,<span class="string">&quot;吴用&quot;</span>,<span class="string">&quot;智多星&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">4</span>,<span class="string">&quot;林冲&quot;</span>,<span class="string">&quot;豹子头&quot;</span>);</span><br><span class="line"><span class="comment">//创建链表</span></span><br><span class="line"><span class="type">SingleLinkedList</span> <span class="variable">singleLinkedList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleLinkedList</span>();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero1);</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero2);</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero3);</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero4);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">singleLinkedList.addByOrder(hero3);</span><br><span class="line">singleLinkedList.addByOrder(hero1);</span><br><span class="line">singleLinkedList.addByOrder(hero4);</span><br><span class="line">singleLinkedList.addByOrder(hero2);</span><br><span class="line">singleLinkedList.addByOrder(hero2);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;修改之前的&quot;</span>);</span><br><span class="line">singleLinkedList.list();</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试修改节点的代码</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">newHeroNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">2</span>,<span class="string">&quot;小卢&quot;</span>,<span class="string">&quot;玉麒麟···&quot;</span>);</span><br><span class="line">singleLinkedList.update(newHeroNode);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;修改之后的的链表情况&quot;</span>);</span><br><span class="line"><span class="comment">//显示链表</span></span><br><span class="line">singleLinkedList.list();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//删除一个节点</span></span><br><span class="line">singleLinkedList.del(<span class="number">4</span>);</span><br><span class="line">singleLinkedList.del(<span class="number">1</span>);</span><br><span class="line">singleLinkedList.del(<span class="number">1</span>);</span><br><span class="line"><span class="comment">//删除后的链表情况</span></span><br><span class="line">System.out.println(<span class="string">&quot;删除后的链表情况。。。&quot;</span>);</span><br><span class="line">singleLinkedList.list();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个SingleLinkedList来管理我们的英雄</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingleLinkedList</span>&#123;</span><br><span class="line"><span class="comment">//先初始化一个头结点，一般上头结点不要动</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">HeroNode</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">0</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加节点到单向链表</span></span><br><span class="line"><span class="comment">//思路，当不考虑编号顺序时</span></span><br><span class="line"><span class="comment">//1 找到当前链表的最后节点</span></span><br><span class="line"><span class="comment">//2,将最后这个节点的nex指向新节点</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(HeroNode heroNode)</span> &#123;</span><br><span class="line"><span class="comment">//因为head节点不能动，因此我们需要一个辅助遍历temo</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="comment">//遍历链表，找到最后</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//找到链表的最后</span></span><br><span class="line"><span class="keyword">if</span>(temp.next == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//如果没有找到最后，将temp后移</span></span><br><span class="line">temp = temp.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当退出while循环后，temp就指向链表的最后</span></span><br><span class="line"><span class="comment">//将最后这个节点的next指向新的节点</span></span><br><span class="line">temp.next = heroNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//第二种方式添加英雄时，根据排名将英雄插入到指定位置</span></span><br><span class="line"><span class="comment">//如果有这个排名，则添加失败，并给出提示</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addByOrder</span><span class="params">(HeroNode heroNode)</span> &#123;</span><br><span class="line"><span class="comment">//因为头结点不能动，因此我们仍然通过一个辅助指针（变量）来帮助找到添加的位置</span></span><br><span class="line"><span class="comment">//因为单链表，因为我们找的temp是位于添加位置的前一个节点，否则插入不了</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;  <span class="comment">//false标记添加的编号是否存在，默认为false</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(temp.next == <span class="literal">null</span>) &#123; <span class="comment">//说明此时temp处于链表的最后</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(temp.next.no &gt; heroNode.no) &#123;</span><br><span class="line"><span class="comment">//此时位置找到，就在temp的后边插入</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(temp.next.no == heroNode.no) </span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//说明希望添加的heroNode的编号已然存在</span></span><br><span class="line">flag = <span class="literal">true</span>;  <span class="comment">//说明编号存在</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">temp = temp.next;  <span class="comment">//后移，变量当前链表</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//判断flag的值</span></span><br><span class="line"><span class="keyword">if</span>(flag) &#123;<span class="comment">//不能添加，说明编号存在</span></span><br><span class="line">System.out.printf(<span class="string">&quot;准备插入的英雄的编号%d，已经存在,无法添加\n&quot;</span>,heroNode.no);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//插入到链表中，temp后边</span></span><br><span class="line">heroNode.next = temp.next;</span><br><span class="line">temp.next = heroNode;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//修该节点的信息，根据no编号来修改，即no编号不能更改</span></span><br><span class="line"><span class="comment">//说明</span></span><br><span class="line"><span class="comment">//1 根据newHeroNode的no来修改便可</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(HeroNode newHeroNode)</span> &#123;</span><br><span class="line"><span class="comment">//判断是否为空</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;链表为空。。。&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//找到需要修改的节点，根据no编号</span></span><br><span class="line"><span class="comment">//定义一个辅助变量</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;<span class="comment">//表示是否找到该节点</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(temp == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;<span class="comment">//已经变量完链表</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(temp.no == newHeroNode.no) &#123;</span><br><span class="line"><span class="comment">//找到了</span></span><br><span class="line">flag = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">temp = temp.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//根据flag判断是否找到要修改的节点</span></span><br><span class="line"><span class="keyword">if</span>(flag) &#123;</span><br><span class="line">temp.name = newHeroNode.name;</span><br><span class="line">temp.nickName = newHeroNode.nickName;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//没有找到</span></span><br><span class="line">System.out.printf(<span class="string">&quot;没有找到编号%d的节点，不能修改\n&quot;</span>,newHeroNode.no);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除节点</span></span><br><span class="line"><span class="comment">//TODO 思路</span></span><br><span class="line"><span class="comment">//1. head不动，故而我们需要一个temp辅助节点找到等待删除节点的前一个节点</span></span><br><span class="line"><span class="comment">//2.我们在比较的时候，是temp.next.no和需要删除的节点的no比较</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">del</span><span class="params">(<span class="type">int</span> no)</span> &#123;</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;<span class="comment">//标志是否找到待删除节点的</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(temp.next == <span class="literal">null</span>) &#123;<span class="comment">//已经到链表的最后</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(temp.next.no == no) &#123;</span><br><span class="line"><span class="comment">//找到待删除节点的前一个节点temp</span></span><br><span class="line">flag = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">temp = temp.next;<span class="comment">//temp后移，遍历</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//判断flag</span></span><br><span class="line"><span class="keyword">if</span>(flag) &#123;<span class="comment">//找到</span></span><br><span class="line"><span class="comment">//可以删除</span></span><br><span class="line">temp.next = temp.next.next;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;要删除的节点%d不存在\n&quot;</span>,no);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//显示链表【遍历】</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//判读是否为空</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;链表为空&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//因为头结点，不能动，因此我们需要一个辅助变量来遍历</span></span><br><span class="line"><span class="type">HeroNode</span>  <span class="variable">temp</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//判断是否是否链表最后</span></span><br><span class="line"><span class="keyword">if</span>(temp == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出节点的信息</span></span><br><span class="line">System.out.println(temp);</span><br><span class="line"><span class="comment">//将next后移,如果不后移将进入死循环</span></span><br><span class="line">temp = temp.next ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个heroNode ,每个HeroNode对象就是一个节点</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeroNode</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> no;</span><br><span class="line"><span class="keyword">public</span> String name;</span><br><span class="line"><span class="keyword">public</span> String nickName;</span><br><span class="line"><span class="keyword">public</span> HeroNode next;<span class="comment">//指向下一个节点</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//构造器</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode</span><span class="params">(<span class="type">int</span> no, String name, String nickName)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line"><span class="built_in">this</span>.no = no;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line"><span class="built_in">this</span>.nickName = nickName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;HeroNode [no=&quot;</span> + no + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;, nickName=&quot;</span> + nickName + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="链表面试题："><a href="#链表面试题：" class="headerlink" title="链表面试题："></a>链表面试题：</h5><p>面试题，获取单链表的节点个数(如果是带头结点的链表，需求不统计头结点)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> head 链表的头节点</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 返回的就是有效节点的个数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getLength</span><span class="params">(HeroNode head)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123; <span class="comment">//空链表</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">//定义一个辅助的变量,这里我们没有统计头结点</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">cur</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="keyword">while</span>(cur != <span class="literal">null</span>) &#123;</span><br><span class="line">length ++ ;</span><br><span class="line">cur = cur.next; <span class="comment">//遍历</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> length;</span><br><span class="line">&#125;</span><br><span class="line">main:</span><br><span class="line"><span class="comment">//测试一下头节点的个数</span></span><br><span class="line">System.out.println(<span class="string">&quot;有效的节点个数为： &quot;</span>+getLength(singleLinkedList.getHead()));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>查找单链表中的倒数第k个节点【新浪面试题】</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//思路：</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编写一个方法，接受head节点，同时接受一个index</span></span><br><span class="line"><span class="comment"> * index表示倒数第index个节点</span></span><br><span class="line"><span class="comment"> * 先将链表从头到尾遍历，得到链表的总的长度getLength</span></span><br><span class="line"><span class="comment"> * 得到size后，我们从链表的第一个开始遍历（size-index）个，就可以得到</span></span><br><span class="line"><span class="comment"> * 如果找到了，则返回该节点，否则返回null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> HeroNode <span class="title function_">findLastIndexNode</span><span class="params">(HeroNode head,<span class="type">int</span> index)</span> </span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//判断如果链表为空，则返回null</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//第一个遍历得到的链表的长度的个数(节点个数)</span></span><br><span class="line"><span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> getLength(head);</span><br><span class="line"><span class="comment">//第二次遍历size-index位置，就是我们倒数的第k个节点</span></span><br><span class="line"><span class="comment">//先做一个index的校验</span></span><br><span class="line"><span class="keyword">if</span>(index &lt;= <span class="number">0</span> || index &gt; size) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义给辅助变量 for循环定位倒数的index</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">cur</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size - index; i++) &#123;</span><br><span class="line">cur = cur.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> cur;</span><br><span class="line">&#125;</span><br><span class="line">main:</span><br><span class="line"><span class="comment">//测试一些看是否得到倒数第k个节点</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">res</span> <span class="operator">=</span> findLastIndexNode(singleLinkedList.getHead(), <span class="number">1</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;res=&quot;</span> + res);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>单链表的反转【腾讯面试，难度适中】</p><ol><li>先定义一个节点<code>reverseHead = new HeroNodeHead</code>的最前端。</li><li>从头到尾便利原来的指针，每遍历一个节点，就将其取出，并放在新的链表reverseHead的最前端。</li><li>原来的链表<code>head.next = reverseHead.next</code>。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将单链表反转</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">reverseList</span><span class="params">(HeroNode head)</span> &#123;</span><br><span class="line"><span class="comment">//如果当前链表为空，或者只有一个节点，无需反转，直接返回就行。</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span> || head.next.next == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义一个辅助的指针(变量)，帮助我们遍历原来的链表</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">cur</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">next</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">//指向当前节点[cur]的下一节点</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">reverseHead</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">0</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="comment">//遍历原来的链表，每遍历一个节点，就将其取出，并在新的链表reverseHead的最前端</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//TODO 思考</span></span><br><span class="line"><span class="keyword">while</span>(cur != <span class="literal">null</span>) &#123;</span><br><span class="line">next = cur.next; <span class="comment">//先暂时保存当前节点的下一节点，因为后面需要使用</span></span><br><span class="line">cur.next = reverseHead.next; <span class="comment">//将cur的下一个节点指向新的链表的最前端</span></span><br><span class="line">reverseHead.next = cur; <span class="comment">//将cur链接到新的链表上</span></span><br><span class="line">cur = next; <span class="comment">//让cur后移</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//将head.next指向reverseHead.next，此时就实现单链表的反转</span></span><br><span class="line">head.next = reverseHead.next;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main:</span><br><span class="line"><span class="comment">//测试一下单链表的反转功能</span></span><br><span class="line">System.out.println(<span class="string">&quot;此时这个时候是原先链表&quot;</span>);</span><br><span class="line">singleLinkedList.list();</span><br><span class="line"></span><br><span class="line"><span class="comment">//反转链表</span></span><br><span class="line">System.out.println(<span class="string">&quot;反转后的单链表&quot;</span>);</span><br><span class="line">reverseList(singleLinkedList.getHead());</span><br><span class="line">singleLinkedList.list();</span><br></pre></td></tr></table></figure><p>从尾到头打印单链表 【方式1，反向遍历，方式2：stack栈】</p><p>思路：</p><ol><li><p>上面的题要求就是逆序打印单链表。</p></li><li><p>方式1：先将单链表进行反转，然后在遍历就行，但是这样会破坏原来的单链表的结构，<strong>不可取</strong>。</p></li><li><p>方式2：可以利用栈这个数据结构，将各个节点压入栈中，然后利用栈的<strong>先进后出</strong>的特点，实现逆序打印的效果。此方式不会影响链表的结构。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从尾到头打印单链表</span></span><br><span class="line"><span class="comment">//使用方式2：也就是将链表中所有元素添加到栈中，然后通过栈将所有元素反转，利用栈的特点，实现逆序打印</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">reversePrint</span><span class="params">(HeroNode head)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> ; <span class="comment">//空链表，不能打印</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建要给的一个栈，将各个节点压入栈便可。</span></span><br><span class="line">Stack&lt;HeroNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;HeroNode&gt;();</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">cur</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="comment">//将链表的所有节点压入栈中</span></span><br><span class="line"><span class="keyword">while</span>(cur != <span class="literal">null</span>) &#123;</span><br><span class="line">stack.push(cur);</span><br><span class="line">cur = cur.next; <span class="comment">// cur后移，这样就可以压入下一个节点</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//将栈中的节点进行打印，pop 出栈</span></span><br><span class="line"><span class="keyword">while</span>(stack.size() &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">System.out.println(stack.pop());  <span class="comment">//stack的特点是先进后出的特点</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main:</span><br><span class="line">System.out.println(<span class="string">&quot;逆序打印单链表,此时没有改变链表的结构。。。&quot;</span>);</span><br><span class="line">reversePrint(singleLinkedList.getHead());</span><br></pre></td></tr></table></figure></li></ol><p>合并两个有序的单链表，合并之后的链表仍然井然有序【习题】</p><p>单链表存在的问题：</p><ol><li>单链表不能实现自我删除，其查找的方向只能是一个方向而双向链表可以向前或者向后查找</li><li>单向链表不能自我删除，需要靠辅助节点，而双向链表，可以自我删除，所以前面我们单链表删除时节点，总是找到temp的下一个节点来删除。</li></ol><h3 id="4-2-双向链表"><a href="#4-2-双向链表" class="headerlink" title="4.2 双向链表"></a>4.2 双向链表</h3><p>双向链表：</p><p>所谓双向链表</p><p>通俗的讲就是可以从两端进行查找。</p><p>分析双向链表的遍历，添加，修改，删除的操作思路</p><ol><li>遍历的方式和单链表一样，只是可以向前查找，也可以向后查找。</li><li>添加（默认添加搭配双向链表的最后）<ol><li>先找到双向链表的最后这个节点</li><li><code>temp.next = newHeroNode</code></li><li><code>newHeroNode.pre = temp;</code></li></ol></li><li>修改的思路和原理的单向链表一样</li><li>删除<ol><li>因为是双向链表，因此我们可以实现自我删除某个节点</li><li>直接找到要删除的这个节点，比如temp</li><li><code>temp.pre.next = temp.next;</code></li><li><code>temp.next.pre = temp.pre;</code></li></ol></li></ol><p>代码实现：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DoubleLinkListDemo</span> &#123;</span><br><span class="line"><span class="comment">//双向链表的测试</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;双向链表的测试：&quot;</span>);</span><br><span class="line"><span class="comment">//先创建节点</span></span><br><span class="line"><span class="type">HeroNode2</span> <span class="variable">hero1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode2</span>(<span class="number">1</span>,<span class="string">&quot;张三&quot;</span>,<span class="string">&quot;黑脸麻瓜&quot;</span>);</span><br><span class="line"><span class="type">HeroNode2</span> <span class="variable">hero2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode2</span>(<span class="number">2</span>,<span class="string">&quot;李四&quot;</span>,<span class="string">&quot;红脸堇瓜&quot;</span>);</span><br><span class="line"><span class="type">HeroNode2</span> <span class="variable">hero3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode2</span>(<span class="number">3</span>,<span class="string">&quot;王五&quot;</span>,<span class="string">&quot;白脸冬瓜&quot;</span>);</span><br><span class="line"><span class="type">HeroNode2</span> <span class="variable">hero4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode2</span>(<span class="number">4</span>,<span class="string">&quot;赵六&quot;</span>,<span class="string">&quot;绿脸西瓜&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">DoubleLinkList</span> <span class="variable">doubleLinkList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DoubleLinkList</span>();</span><br><span class="line">doubleLinkList.add(hero1);</span><br><span class="line">doubleLinkList.add(hero2);</span><br><span class="line">doubleLinkList.add(hero3);</span><br><span class="line">doubleLinkList.add(hero4);</span><br><span class="line"></span><br><span class="line"><span class="comment">//遍历</span></span><br><span class="line">doubleLinkList.list();</span><br><span class="line"><span class="comment">//修改</span></span><br><span class="line"><span class="type">HeroNode2</span> <span class="variable">newHeroNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode2</span>(<span class="number">2</span>,<span class="string">&quot;得力&quot;</span>,<span class="string">&quot;自研菲亚&quot;</span>);</span><br><span class="line">doubleLinkList.update(newHeroNode);</span><br><span class="line">System.out.println(<span class="string">&quot;修改后的结果：&quot;</span>);</span><br><span class="line">doubleLinkList.list();</span><br><span class="line"><span class="comment">//删除</span></span><br><span class="line">doubleLinkList.del(<span class="number">2</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;删除后的结果：&quot;</span>);</span><br><span class="line">doubleLinkList.list();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建一个双向链表的类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DoubleLinkList</span>&#123;</span><br><span class="line"><span class="comment">//通单向链表一样,创建一个头节点，头结点不要动，不存放具体数据</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">HeroNode2</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode2</span>(<span class="number">0</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> HeroNode2 <span class="title function_">getHead</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//遍历双向链表的方法和单向链表一样。</span></span><br><span class="line"><span class="comment">//显示链表【遍历】</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//判读是否为空</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;链表为空&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//因为头结点，不能动，因此我们需要一个辅助变量来遍历</span></span><br><span class="line"><span class="type">HeroNode2</span>  <span class="variable">temp</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//判断是否是否链表最后</span></span><br><span class="line"><span class="keyword">if</span>(temp == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出节点的信息</span></span><br><span class="line">System.out.println(temp);</span><br><span class="line"><span class="comment">//将next后移,如果不后移将进入死循环</span></span><br><span class="line">temp = temp.next ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加一个节点到双向链表的最后</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(HeroNode2 heroNode)</span> &#123;</span><br><span class="line"><span class="comment">//因为head节点不能动，因此我们需要一个辅助遍历temo</span></span><br><span class="line"><span class="type">HeroNode2</span> <span class="variable">temp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="comment">//遍历链表，找到最后</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//找到链表的最后</span></span><br><span class="line"><span class="keyword">if</span>(temp.next == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//如果没有找到最后，将temp后移</span></span><br><span class="line">temp = temp.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当退出while循环后，temp就指向链表的最后</span></span><br><span class="line"><span class="comment">//此时形成一个双向链表</span></span><br><span class="line">temp.next = heroNode;</span><br><span class="line">heroNode.pre = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改一个节点的内容</span></span><br><span class="line"><span class="comment">//双向链表的节点内容修改和单向链表几乎一样</span></span><br><span class="line"><span class="comment">//只是节点的类型改成了HeroNode2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(HeroNode2 newHeroNode)</span> &#123;</span><br><span class="line"><span class="comment">//判断是否为空</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;链表为空。。。&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//找到需要修改的节点，根据no编号</span></span><br><span class="line"><span class="comment">//定义一个辅助变量</span></span><br><span class="line"><span class="type">HeroNode2</span> <span class="variable">temp</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;<span class="comment">//表示是否找到该节点</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(temp == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;<span class="comment">//已经变量完链表</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(temp.no == newHeroNode.no) &#123;</span><br><span class="line"><span class="comment">//找到了</span></span><br><span class="line">flag = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">temp = temp.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//根据flag判断是否找到要修改的节点</span></span><br><span class="line"><span class="keyword">if</span>(flag) &#123;</span><br><span class="line">temp.name = newHeroNode.name;</span><br><span class="line">temp.nickName = newHeroNode.nickName;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//没有找到</span></span><br><span class="line">System.out.printf(<span class="string">&quot;没有找到编号%d的节点，不能修改\n&quot;</span>,newHeroNode.no);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//从双向链表中删除一个节点</span></span><br><span class="line"><span class="comment">//说明</span></span><br><span class="line"><span class="comment">//1 对于双向链表，我们可以直接找到要删除的这个节点</span></span><br><span class="line"><span class="comment">//2 找到后，自我删除即可</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">del</span><span class="params">(<span class="type">int</span> no)</span> &#123;</span><br><span class="line"><span class="comment">//判断当前链表是否为空</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;链表为空，无法删除&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">HeroNode2</span> <span class="variable">temp</span> <span class="operator">=</span> head.next; <span class="comment">//辅助变量(指针)</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;<span class="comment">//标志是否找到待删除节点的</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(temp == <span class="literal">null</span>) &#123;<span class="comment">//已经到链表的最后</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(temp.no == no) &#123;</span><br><span class="line"><span class="comment">//找到待删除节点的前一个节点temp</span></span><br><span class="line">flag = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">temp = temp.next;<span class="comment">//temp后移，遍历</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//判断flag</span></span><br><span class="line"><span class="keyword">if</span>(flag) &#123;<span class="comment">//找到</span></span><br><span class="line"><span class="comment">//可以删除</span></span><br><span class="line"><span class="comment">//temp.next = temp.next.next; 【单向链表的删除方式】</span></span><br><span class="line">temp.pre.next = temp.next;</span><br><span class="line"><span class="comment">//此时以下代码存在问题，如果是下一个节点，就不需要执行下边语句，否则将会产生空指针问题。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(temp.next != <span class="literal">null</span>) &#123;</span><br><span class="line">temp.next.pre = temp.pre;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;要删除的节点%d不存在\n&quot;</span>,no);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeroNode2</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> no;</span><br><span class="line"><span class="keyword">public</span> String name;</span><br><span class="line"><span class="keyword">public</span> String nickName;</span><br><span class="line"><span class="keyword">public</span> HeroNode2 next; <span class="comment">//指向后一个节点，默认为null</span></span><br><span class="line"><span class="keyword">public</span> HeroNode2 pre; <span class="comment">//指向前一个节点,默认为null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode2</span><span class="params">(<span class="type">int</span> no, String name, String nickName)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line"><span class="built_in">this</span>.no = no;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line"><span class="built_in">this</span>.nickName = nickName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode2</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;HeroNode2 [no=&quot;</span> + no + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;, nickName=&quot;</span> + nickName </span><br><span class="line">+ <span class="string">&quot;]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>习题：</p><p>双向链表的第二种添加方式，按照编号顺序（提示，按照单链表的顺序进行添加即可，稍作修改）;</p><h3 id="4-3-单向环形链表："><a href="#4-3-单向环形链表：" class="headerlink" title="4.3 单向环形链表："></a>4.3 单向环形链表：</h3><p>约瑟夫问题：设编号为1,2,….n,的n个人围坐在一圈，约定编号为k(1&lt;= k &lt;=m)的人从1开始报数，数到从1开始报数，数到m的那个人出列，他的下一位又从1开始报数，数到m的那个人又出列，依次类推，直到所有人出列为止，由此产生一个出队编号的序列。</p><blockquote><p>n = 5,即有5个人</p><p>k =1，从第一个人开始报数</p><p>m=2,数2下。</p></blockquote><p>思路：</p><ol><li>先创建第一个节点，让first指向该节点，并形成环形</li><li>后面当我们没创建一个新的节点，就将该节点加入到已有的环形链表即可。</li></ol><p>遍历环形链表：</p><ol><li><p>先让一个辅助指针（变量） curBoy，指向first节点</p></li><li><p>然后通过一个while循环该环形链表即可，<code>curBoy.next == first;</code></p></li><li><p>根据用户的输入，生成一个小孩出圈的顺序，事先应该指向环形链表的最后这个节点。</p><p>​    补充：小孩报数之前，先让first和helper移动 k -1 次</p></li><li><p>当小孩报数时，让first和helper指针同时移动m -1次</p></li><li><p>这个时候就可以将first指向的小孩节点出圈；</p><ol><li>first = first.next</li><li>helper.next =first;</li></ol><p>原来first指向的节点就没有任何引用，就会被垃圾回收机制回收</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Josepfu</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//测试看构建环形队列和遍历是否正确</span></span><br><span class="line"><span class="type">CircleSinglelinkedList</span> <span class="variable">circleSinglelinkedList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CircleSinglelinkedList</span>();</span><br><span class="line">circleSinglelinkedList.addBoy(<span class="number">10</span>); <span class="comment">//加入5个小孩节点</span></span><br><span class="line">circleSinglelinkedList.showBoy();</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试小孩出圈是否正确</span></span><br><span class="line">circleSinglelinkedList.countBoy(<span class="number">1</span>, <span class="number">2</span>, <span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个环形的单向链表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CircleSinglelinkedList</span>&#123;</span><br><span class="line"><span class="comment">//创建一个first节点，当前没有编号</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">Boy</span> <span class="variable">first</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Boy</span>(-<span class="number">1</span>);</span><br><span class="line"><span class="comment">//添加小孩节点，构建一个环形的链表</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addBoy</span><span class="params">(<span class="type">int</span> nums)</span> &#123;</span><br><span class="line"><span class="comment">//nums 做一个数据校验</span></span><br><span class="line"><span class="keyword">if</span>(nums &lt; <span class="number">1</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;nums的值不正确&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">Boy</span> <span class="variable">curBoy</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">// 辅助指针，帮助构建环形链表</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用for来创建我们的环形链表</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= nums; i++) &#123;</span><br><span class="line"><span class="comment">//根据编号创建小孩节点</span></span><br><span class="line"><span class="type">Boy</span> <span class="variable">boy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Boy</span>(i);</span><br><span class="line"><span class="comment">//如果是第一个小孩</span></span><br><span class="line"><span class="keyword">if</span>(i == <span class="number">1</span>) &#123;</span><br><span class="line">first = boy;</span><br><span class="line">first.setNext(first); <span class="comment">//构成循环</span></span><br><span class="line">curBoy = first; <span class="comment">// 让curBoy指向第一个小孩</span></span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">curBoy.setNext(boy);<span class="comment">//</span></span><br><span class="line">boy.setNext(first);</span><br><span class="line">curBoy = boy;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//遍历当前环境</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showBoy</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//判断链表是否为空</span></span><br><span class="line"><span class="keyword">if</span>(first == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;没有任何小孩...&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//因为first不能动，因此我们仍然使用一个辅助指针完成遍历</span></span><br><span class="line"><span class="type">Boy</span> <span class="variable">curBoy</span> <span class="operator">=</span> first;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;小孩的编号 %d \n&quot;</span>,curBoy.getNo());</span><br><span class="line"><span class="keyword">if</span>(curBoy.getNext() == first) &#123; <span class="comment">//说明已经遍历完成</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">curBoy = curBoy.getNext(); <span class="comment">//将curBoy后移</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据用户的输入，计算出小孩出圈的顺序</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> startNo 表示第几个小孩开始计数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> countNum 表示数多少下</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> nums 表示最初有多少个小孩子在圈中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">countBoy</span><span class="params">(<span class="type">int</span> startNo,<span class="type">int</span> countNum, <span class="type">int</span> nums)</span> &#123;</span><br><span class="line"><span class="comment">//先对数据进行校验</span></span><br><span class="line"><span class="keyword">if</span>(first == <span class="literal">null</span> || startNo &lt; <span class="number">1</span> || startNo &gt; nums) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;参数输入错误，请重写输入：&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建要给辅助指针，帮助完成小孩出圈</span></span><br><span class="line"><span class="type">Boy</span> <span class="variable">helper</span> <span class="operator">=</span> first;</span><br><span class="line"><span class="comment">//需求创建一个辅助指针(变量) helper，事先应该指向环形链表的最后这个节点</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(helper.getNext() == first) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">helper = helper.getNext();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//小孩报数前，先让first和helper移动 k - 1次</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; startNo - <span class="number">1</span>; j++) &#123;</span><br><span class="line">first = first.getNext();</span><br><span class="line">helper = helper.getNext();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当小孩报数的时候，让first和helper指针同时移动 m - 1次，然后出圈</span></span><br><span class="line"><span class="comment">//这里是一个循环操作，知道圈中只有一个节点</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(helper == first) &#123;</span><br><span class="line"><span class="comment">//说明圈中只有一个节点</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//让first和helper指针同时移动countNum - 1;</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; countNum -<span class="number">1</span>; j++ ) &#123;</span><br><span class="line">first = first.getNext();</span><br><span class="line">helper = helper.getNext();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//这时first指向的节点，就是要出圈的小孩节点</span></span><br><span class="line">System.out.printf(<span class="string">&quot;小孩%d出圈\n&quot;</span>,first.getNo());</span><br><span class="line"><span class="comment">//此时将first指向的小孩节点出圈</span></span><br><span class="line">first = first.getNext();</span><br><span class="line">helper.setNext(first); <span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line">System.out.printf(<span class="string">&quot;最后留在圈中的小孩编号%d\n&quot;</span>,first.getNo());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Boy</span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> no;<span class="comment">//编号</span></span><br><span class="line"><span class="keyword">private</span> Boy next; <span class="comment">//指向下一个节点，默认为null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Boy</span><span class="params">(<span class="type">int</span> no)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line"><span class="built_in">this</span>.no = no;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNo</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> no;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNo</span><span class="params">(<span class="type">int</span> no)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.no = no;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> Boy <span class="title function_">getNext</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNext</span><span class="params">(Boy next)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.next = next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;Boy [no=&quot;</span> + no + <span class="string">&quot;, next=&quot;</span> + next + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-栈"><a href="#5-栈" class="headerlink" title="5.栈"></a>5.栈</h2><ol><li>栈的英文Stack</li><li>栈是一种<strong>先入后出</strong>(FILO - First in Last Out)的有序列表</li><li>栈是限制线性表中元素的插入和删除<strong>只能在线性表的同一端</strong>进行特殊线性表。允许插入和删除的一端，为变化的一端称为<strong>栈顶</strong>（Top）,另一端为固定的一端，称为<strong>栈底</strong>（Bottom）;</li><li>根据栈的定义可知，最先放入栈中元素在栈底，最后放入的元素在栈顶，而删除元素刚好相反，最后放入的元素最先删除，最后放入的元素最后删除。</li><li><p>入栈<strong>push</strong>,出栈<strong>pop</strong>。</p><ol><li>子程序的调用：在跳往子程序前，会先加个下一个指令的地址存放到堆栈中，直到子程序执行完后再将地址取出，以回到原来的程序中。</li><li>处理递归调用，所谓递归，就是方法自己调用自己本身。与子程序的调用类似，只是除了存储下一个指令的地址外，也将参数，区域变量等数据存入堆栈中。</li><li>表达式的转换[中缀表达式转后缀表达式]与求值。</li><li>二叉树的变量</li><li>图形的深度优先(depth-first)搜索法。</li></ol></li></ol><h3 id="5-1-栈的模拟实现"><a href="#5-1-栈的模拟实现" class="headerlink" title="5.1 栈的模拟实现"></a>5.1 栈的模拟实现</h3><p>实现栈的思路：</p><ol><li>使用数组来模拟栈</li><li>定义一个top来模拟栈顶，初始化为 -1；</li><li>入栈的操作，当有数据加入栈时，<code>top++ ; stack[top] = data;</code></li><li>出栈的操作，<code>int value = stack[top]; top -- ;return value;</code></li></ol><p>反正有错误，bug一直都有。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayStackDemo</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//测试一下ArrayStack是否正确</span></span><br><span class="line"><span class="comment">//先创建一个ArrayStack对象，表示栈</span></span><br><span class="line"><span class="type">ArrayStack</span> <span class="variable">stack</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayStack</span>(<span class="number">4</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">loop</span> <span class="operator">=</span> <span class="literal">true</span>; <span class="comment">//控制是否退出菜单</span></span><br><span class="line"><span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"><span class="keyword">while</span>(loop) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;show：表示展示栈&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;exit：表示退出栈&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;push：表示添加数据到栈&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;pop：表示从栈取出数据&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;请输入你的操作&quot;</span>);</span><br><span class="line">key = sc.next();</span><br><span class="line"><span class="keyword">switch</span>(key) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;show&quot;</span>:</span><br><span class="line">stack.list();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;push&quot;</span>:</span><br><span class="line">System.out.println(<span class="string">&quot;请输入一个数&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> sc.nextInt();</span><br><span class="line">stack.push(value);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;pop&quot;</span>:</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">System.out.printf(<span class="string">&quot;出栈的数据是%d\n&quot;</span>,res);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">System.out.println(e.getMessage());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;exit&quot;</span>:</span><br><span class="line">sc.close();</span><br><span class="line">loop = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;程序退出了&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个ArrayStack表示栈</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ArrayStack</span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> maxSize;<span class="comment">//栈的大小</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span>[] stack;<span class="comment">//数组，数组模拟栈，数据就房子该数组</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">top</span> <span class="operator">=</span>-<span class="number">1</span>; <span class="comment">//top表示栈顶，初始化为-1;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//构造器</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayStack</span><span class="params">(<span class="type">int</span> maxSize)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.maxSize = maxSize;</span><br><span class="line">stack = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="built_in">this</span>.maxSize];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//堆满</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> top == maxSize -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//栈空</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> top == -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//入栈-push</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line"><span class="comment">//先判断栈是否满</span></span><br><span class="line"><span class="keyword">if</span>(isFull()) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;栈满&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line">top ++;</span><br><span class="line">stack[top] = value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//出栈-pop,将栈顶的数据进行返回</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//先判断是否为空</span></span><br><span class="line"><span class="keyword">if</span>(isEmpty()) &#123;</span><br><span class="line"><span class="comment">//抛出异常</span></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;栈空，没有数据···&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> stack[top];</span><br><span class="line">top --;</span><br><span class="line"><span class="keyword">return</span> value;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//显示栈的情况【遍历栈】，遍历是需要从栈顶开始显示数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(isEmpty()) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;栈空，没有数据···&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//需要从栈顶开始显示数据</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> top; i &gt;= <span class="number">0</span> ; i--) &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;stack[%d]=%d\n&quot;</span>,i,stack[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-使用栈实现计算机"><a href="#5-2-使用栈实现计算机" class="headerlink" title="5.2 使用栈实现计算机"></a>5.2 使用栈实现计算机</h3><p>试题： 使用栈完成表达式7 <em> 2 </em> 2 - 5  + 1 - 5 + 3 - 4 =？</p><p> 思路：</p><ol><li>通过一个index值(索引).来变量我们的表达式</li><li>如果我们发现是一个数字就直接入栈</li><li>如果发现扫描到的是一个符号，就分如下情况进行分析<ol><li>如果发现当前符号为空，则直接入栈</li><li>如果符号栈有操作符，就进行比较，如果当前的操作符的优先级小于或者等于栈中的操作符。这个时候就需要从数栈中pop出两个数，在从符号栈中pop出一个符号，进行运算，将得到结果，入数栈，然后将当前的操作符插入符号栈</li><li>如果当前符号栈中有操作符，就进行比较，如果当前操作符的优先级小于或者等于栈中的操作符，就需要从数栈中pop出两个数，在从符号栈中pop一个符号，进行运算，将得到结果，入数栈，然后将当前的操作符入符号栈，如果当前的操作符的优先级大于栈中的操作符，就直接入符号栈。</li></ol></li><li>当表达式扫描完毕，就顺序的从数栈和符号栈中pop出相应的数和符号，并运行。</li><li>最后在数栈只有一个数子，就是表达式的结果。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Calculator1</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//根据前面老师思路，完成表达式的运算</span></span><br><span class="line"><span class="type">String</span> <span class="variable">expression</span> <span class="operator">=</span> <span class="string">&quot;3-2*1+1&quot;</span>; <span class="comment">// //如何处理多位数的问题？</span></span><br><span class="line"><span class="comment">//创建两个栈，数栈，一个符号栈</span></span><br><span class="line"><span class="type">ArrayStack2</span> <span class="variable">numStack</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayStack2</span>(<span class="number">10</span>);</span><br><span class="line"><span class="type">ArrayStack2</span> <span class="variable">operStack</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayStack2</span>(<span class="number">10</span>);</span><br><span class="line"><span class="comment">//定义需要的相关变量</span></span><br><span class="line"><span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;<span class="comment">//用于扫描</span></span><br><span class="line"><span class="type">int</span> <span class="variable">num1</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">num2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">oper</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">char</span> <span class="variable">ch</span> <span class="operator">=</span> <span class="string">&#x27; &#x27;</span>; <span class="comment">//将每次扫描得到char保存到ch</span></span><br><span class="line"><span class="type">String</span> <span class="variable">keepNum</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>; <span class="comment">//用于拼接 多位数</span></span><br><span class="line"><span class="comment">//开始while循环的扫描expression</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//依次得到expression 的每一个字符</span></span><br><span class="line">ch = expression.substring(index, index+<span class="number">1</span>).charAt(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//判断ch是什么，然后做相应的处理</span></span><br><span class="line"><span class="keyword">if</span>(operStack.isOper(ch)) &#123;<span class="comment">//如果是运算符</span></span><br><span class="line"><span class="comment">//判断当前的符号栈是否为空</span></span><br><span class="line"><span class="keyword">if</span>(!operStack.isEmpty()) &#123;</span><br><span class="line"><span class="comment">//如果符号栈有操作符，就进行比较,如果当前的操作符的优先级小于或者等于栈中的操作符,就需要从数栈中pop出两个数,</span></span><br><span class="line"><span class="comment">//在从符号栈中pop出一个符号，进行运算，将得到结果，入数栈，然后将当前的操作符入符号栈</span></span><br><span class="line"><span class="keyword">if</span>(operStack.priority(ch) &lt;= operStack.priority(operStack.peek())) &#123;</span><br><span class="line">num1 = numStack.pop();</span><br><span class="line">num2 = numStack.pop();</span><br><span class="line">oper = operStack.pop();</span><br><span class="line">res = numStack.cal(num1, num2, oper);</span><br><span class="line"><span class="comment">//把运算的结果如数栈</span></span><br><span class="line">numStack.push(res);</span><br><span class="line"><span class="comment">//然后将当前的操作符入符号栈</span></span><br><span class="line">operStack.push(ch);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//如果当前的操作符的优先级大于栈中的操作符， 就直接入符号栈.</span></span><br><span class="line">operStack.push(ch);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//如果为空直接入符号栈..</span></span><br><span class="line">operStack.push(ch); <span class="comment">// 1 + 3</span></span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123; <span class="comment">//如果是数，则直接入数栈</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//numStack.push(ch - 48); //? &quot;1+3&quot; &#x27;1&#x27; =&gt; 1</span></span><br><span class="line"><span class="comment">//分析思路</span></span><br><span class="line"><span class="comment">//1. 当处理多位数时，不能发现是一个数就立即入栈，因为他可能是多位数</span></span><br><span class="line"><span class="comment">//2. 在处理数，需要向expression的表达式的index 后再看一位,如果是数就进行扫描，如果是符号才入栈</span></span><br><span class="line"><span class="comment">//3. 因此我们需要定义一个变量 字符串，用于拼接</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//处理多位数</span></span><br><span class="line">keepNum += ch;</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果ch已经是expression的最后一位，就直接入栈</span></span><br><span class="line"><span class="keyword">if</span> (index == expression.length() - <span class="number">1</span>) &#123;</span><br><span class="line">numStack.push(Integer.parseInt(keepNum));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">//判断下一个字符是不是数字，如果是数字，就继续扫描，如果是运算符，则入栈</span></span><br><span class="line"><span class="comment">//注意是看后一位，不是index++</span></span><br><span class="line"><span class="keyword">if</span> (operStack.isOper(expression.substring(index+<span class="number">1</span>,index+<span class="number">2</span>).charAt(<span class="number">0</span>))) &#123;</span><br><span class="line"><span class="comment">//如果后一位是运算符，则入栈 keepNum = &quot;1&quot; 或者 &quot;123&quot;</span></span><br><span class="line">numStack.push(Integer.parseInt(keepNum));</span><br><span class="line"><span class="comment">//重要的!!!!!!, keepNum清空</span></span><br><span class="line">keepNum = <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//让index + 1, 并判断是否扫描到expression最后.</span></span><br><span class="line">index++;</span><br><span class="line"><span class="keyword">if</span> (index &gt;= expression.length()) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当表达式扫描完毕，就顺序的从 数栈和符号栈中pop出相应的数和符号，并运行.</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//如果符号栈为空，则计算到最后的结果, 数栈中只有一个数字【结果】</span></span><br><span class="line"><span class="keyword">if</span>(operStack.isEmpty()) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">num1 = numStack.pop();</span><br><span class="line">num2 = numStack.pop();</span><br><span class="line">oper = operStack.pop();</span><br><span class="line">res = numStack.cal(num1, num2, oper);</span><br><span class="line">numStack.push(res);<span class="comment">//入栈</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//将数栈的最后数，pop出，就是结果</span></span><br><span class="line"><span class="type">int</span> <span class="variable">res2</span> <span class="operator">=</span> numStack.pop();</span><br><span class="line">System.out.printf(<span class="string">&quot;表达式 %s = %d&quot;</span>, expression, res2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//先创建一个栈,直接使用前面创建好</span></span><br><span class="line"><span class="comment">//定义一个 ArrayStack2 表示栈, 需要扩展功能</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ArrayStack3</span> &#123;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> maxSize; <span class="comment">// 栈的大小</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span>[] stack; <span class="comment">// 数组，数组模拟栈，数据就放在该数组</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">top</span> <span class="operator">=</span> -<span class="number">1</span>;<span class="comment">// top表示栈顶，初始化为-1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//构造器</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayStack3</span><span class="params">(<span class="type">int</span> maxSize)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.maxSize = maxSize;</span><br><span class="line">stack = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="built_in">this</span>.maxSize];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//增加一个方法，可以返回当前栈顶的值, 但是不是真正的pop</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> stack[top];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//栈满</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> top == maxSize - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//栈空</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> top == -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//入栈-push</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line"><span class="comment">//先判断栈是否满</span></span><br><span class="line"><span class="keyword">if</span>(isFull()) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;栈满&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">top++;</span><br><span class="line">stack[top] = value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//出栈-pop, 将栈顶的数据返回</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//先判断栈是否空</span></span><br><span class="line"><span class="keyword">if</span>(isEmpty()) &#123;</span><br><span class="line"><span class="comment">//抛出异常</span></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;栈空，没有数据~&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> stack[top];</span><br><span class="line">top--;</span><br><span class="line"><span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//显示栈的情况[遍历栈]， 遍历时，需要从栈顶开始显示数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(isEmpty()) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;栈空，没有数据~~&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//需要从栈顶开始显示数据</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> top; i &gt;= <span class="number">0</span> ; i--) &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;stack[%d]=%d\n&quot;</span>, i, stack[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//返回运算符的优先级，优先级是程序员来确定, 优先级使用数字表示</span></span><br><span class="line"><span class="comment">//数字越大，则优先级就越高.</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">priority</span><span class="params">(<span class="type">int</span> oper)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(oper == <span class="string">&#x27;*&#x27;</span> || oper == <span class="string">&#x27;/&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (oper == <span class="string">&#x27;+&#x27;</span> || oper == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> -<span class="number">1</span>; <span class="comment">// 假定目前的表达式只有 +, - , * , /</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//判断是不是一个运算符</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isOper</span><span class="params">(<span class="type">char</span> val)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> val == <span class="string">&#x27;+&#x27;</span> || val == <span class="string">&#x27;-&#x27;</span> || val == <span class="string">&#x27;*&#x27;</span> || val == <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//计算方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">cal</span><span class="params">(<span class="type">int</span> num1, <span class="type">int</span> num2, <span class="type">int</span> oper)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// res 用于存放计算的结果</span></span><br><span class="line"><span class="keyword">switch</span> (oper) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">res = num1 + num2;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">res = num2 - num1;<span class="comment">// 注意顺序</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">res = num1 * num2;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">res = num2 / num1;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-3-前缀、中缀、后缀表达式（逆波兰表达式）"><a href="#5-3-前缀、中缀、后缀表达式（逆波兰表达式）" class="headerlink" title="5.3 前缀、中缀、后缀表达式（逆波兰表达式）"></a>5.3 前缀、中缀、后缀表达式（逆波兰表达式）</h3><p>从右往左扫描表达式，遇到数子时，将数字压入栈中，遇到运算符时，弹出栈顶的两个数，用运算符对他们做相应的计算。一般情况中缀表达式是我们人为确定的表达式，但是计算机无法识别，故而我们需要将中缀表达式调整为后缀表达式。</p><p>从左到右表达式最右端，最后运算得出的值即为表达式的结果。</p><blockquote><p>​     * 思路：</p><pre><code> * 1.从左到右扫描，将3和4压入栈中 * 2.遇到 + 运算符，因此弹出4和3(4为栈顶元素，3为次顶元素)，计算出3+4的值，得到7，在将7压入栈中 * 3.将5入栈 * 4.接下来是*运算符，因此弹出5和7，计算7*5=35，将35入栈。 * 5.将6入栈 * 6.最后是 - 运算符，计算出35 -6 的值，即29，由此得出最终结果</code></pre></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> class 逆波兰表达式 &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//先定义给逆波兰表达式</span></span><br><span class="line"><span class="comment">//(3+4)*5-6 =&gt; 3 4 + 5 * 6 -</span></span><br><span class="line"><span class="comment">//说明为了方便，逆波兰表达式的数字和符号使用空格隔开</span></span><br><span class="line"><span class="type">String</span> <span class="variable">suffixExpression</span> <span class="operator">=</span> <span class="string">&quot;15 4 + 5 * 6 -&quot;</span>;</span><br><span class="line"><span class="comment">//思路</span></span><br><span class="line"><span class="comment">// 1. 先将 3 4 + 5 * 6 -  =&gt; 放到ArrayList中</span></span><br><span class="line"><span class="comment">// 2 将 ArrayList 传递给一个方法，遍历ArrayList 配合栈完成计算</span></span><br><span class="line">List&lt;String&gt; rpnList = getListString(suffixExpression);</span><br><span class="line">System.out.println(<span class="string">&quot;逆波兰表达式：&quot;</span> + rpnList);</span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> calculate(rpnList);</span><br><span class="line">System.out.println(<span class="string">&quot;计算的结果为：&quot;</span> + res);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//将一个逆波兰表达式，依次将数据和运算符放到ArrayList中</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">getListString</span><span class="params">(String suffixExpression)</span>&#123;</span><br><span class="line"><span class="comment">//将suffixExpression 分割</span></span><br><span class="line">String [] split = suffixExpression.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line"><span class="keyword">for</span>(String ele : split) &#123;</span><br><span class="line">list.add(ele);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//完成对逆波兰表达式的运算。</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 思路：</span></span><br><span class="line"><span class="comment"> * 1.从左到右扫描，将3和4压入栈中</span></span><br><span class="line"><span class="comment"> * 2.遇到 + 运算符，因此弹出4和3(4为栈顶元素，3为次顶元素)，计算出3+4的值，得到7，在将7压入栈中</span></span><br><span class="line"><span class="comment"> * 3.将5入栈</span></span><br><span class="line"><span class="comment"> * 4.接下来是*运算符，因此弹出5和7，计算7*5=35，将35入栈。</span></span><br><span class="line"><span class="comment"> * 5.将6入栈</span></span><br><span class="line"><span class="comment"> * 6.最后是 - 运算符，计算出35 -6 的值，即29，由此得出最终结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">calculate</span><span class="params">(List&lt;String&gt; ls)</span> &#123;</span><br><span class="line"><span class="comment">//创建给栈，只需要一个栈即可</span></span><br><span class="line">Stack&lt;String&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line"><span class="comment">//遍历 ls</span></span><br><span class="line"><span class="keyword">for</span>(String item : ls) &#123;</span><br><span class="line"><span class="comment">//这里使用正则表达式来读取数</span></span><br><span class="line"><span class="keyword">if</span>(item.matches(<span class="string">&quot;\\d+&quot;</span>)) &#123; <span class="comment">//匹配的是多位数</span></span><br><span class="line"><span class="comment">//入栈</span></span><br><span class="line">stack.push(item);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//pop出两位数，并运算，再入栈</span></span><br><span class="line"><span class="type">int</span> <span class="variable">num2</span> <span class="operator">=</span> Integer.parseInt(stack.pop());</span><br><span class="line"><span class="type">int</span> <span class="variable">num1</span> <span class="operator">=</span> Integer.parseInt(stack.pop());</span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(item.equals(<span class="string">&quot;+&quot;</span>)) &#123;</span><br><span class="line">res = num1 + num2;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.equals(<span class="string">&quot;-&quot;</span>)) &#123;</span><br><span class="line">res = num1 - num2;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.equals(<span class="string">&quot;*&quot;</span>)) &#123;</span><br><span class="line">res = num1 * num2;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.equals(<span class="string">&quot;/&quot;</span>)) &#123;</span><br><span class="line">res = num1 / num2;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;运算符有误&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//把res入栈</span></span><br><span class="line">stack.push(<span class="string">&quot;&quot;</span> + res);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//最后留在stack中的数据是运算结果</span></span><br><span class="line"><span class="keyword">return</span> Integer.parseInt(stack.pop());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5-4-中缀表达式转换为后缀表达式"><a href="#5-4-中缀表达式转换为后缀表达式" class="headerlink" title="5.4 中缀表达式转换为后缀表达式"></a>5.4 中缀表达式转换为后缀表达式</h3><p>实际开发中，我们需要将中缀表达式转换为后缀表达式</p><p>中缀表达式转后缀表达式的思路步骤</p><ol><li>初始化两个栈，运算符s1和存储中间结果的栈s2</li><li>从左到右扫描中缀表达式；</li><li>遇到操作运算符时，将其压s2;</li><li>遇到运算符时，比较其与s1栈顶运算符的优先级<ol><li>如果s1为空，或栈顶运算符为左括号“(”，则直接将次运算符入栈；</li><li>否则，若优先级比栈顶运算符的高，也将运算符压入s1</li><li>否则将s1栈顶的运算符弹出并压入到s2中，再次转到（4-1）与s1中新的栈顶运算符相比较；</li></ol></li><li>遇到括号<ol><li>如果是左括号“（”,则直接压入s1</li><li>如果是右括号“）”,则依次弹出s1栈顶的运算符，并压入s2，直到遇到左括号为止，此时将这一对括号丢弃。</li></ol></li><li>重复步骤2至5，直到表达式的最右边</li><li>将s1中剩余的运算符依次弹出并压入s2</li><li>依次弹出s2中元素并输出，结果的逆序即为中缀表达式对应的后缀表达式。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> class 逆波兰表达式 &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//先定义给逆波兰表达式</span></span><br><span class="line"><span class="comment">//(3+4)*5-6 =&gt; 3 4 + 5 * 6 -</span></span><br><span class="line"><span class="comment">//说明为了方便，逆波兰表达式的数字和符号使用空格隔开</span></span><br><span class="line"><span class="type">String</span> <span class="variable">suffixExpression</span> <span class="operator">=</span> <span class="string">&quot;15 4 + 5 * 6 -&quot;</span>;</span><br><span class="line"><span class="comment">//思路</span></span><br><span class="line"><span class="comment">// 1. 先将 3 4 + 5 * 6 -  =&gt; 放到ArrayList中</span></span><br><span class="line"><span class="comment">// 2 将 ArrayList 传递给一个方法，遍历ArrayList 配合栈完成计算</span></span><br><span class="line"></span><br><span class="line">List&lt;String&gt; rpnList = getListString(suffixExpression);</span><br><span class="line">System.out.println(<span class="string">&quot;逆波兰表达式：&quot;</span> + rpnList);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> calculate(rpnList);</span><br><span class="line">System.out.println(<span class="string">&quot;计算的结果为：&quot;</span> + res);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;=========================以上是中缀表达式====================&quot;</span>);</span><br><span class="line"><span class="comment">//此时我们完成一个中缀表达式转成后缀表达式的功能</span></span><br><span class="line"><span class="comment">//说明</span></span><br><span class="line"><span class="comment">//1.  1+((2+3)*4)-5 =&gt; 1 2 3 + 4 * + 5 -</span></span><br><span class="line"><span class="comment">//2 因为直接对str进行操作，不方便，因此将1+((2+3)*4)-5 中缀表达式转换为对应的List</span></span><br><span class="line"><span class="comment">// 即&quot;1+((2+3)*4)-5&quot; =&gt; ArrayList[1,+,(,(,2,+,3),*,4),-,5]</span></span><br><span class="line"><span class="comment">//3 将 得到的中缀表达式对应的List =&gt;后缀表达式对应的List</span></span><br><span class="line"><span class="comment">//即ArrayList[1, +, (, (, 2, +, 3, ), *, 4, ), -, 5]=&gt;ArrayList[1,2,3,+,4,*,+,5,-]</span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">experssion</span> <span class="operator">=</span> <span class="string">&quot;1+((2+3)*4)-5&quot;</span>;</span><br><span class="line">List&lt;String&gt; infixExpressionList = toInfixExpressionList(experssion);</span><br><span class="line">System.out.println(<span class="string">&quot;中缀表达式对应的List &quot;</span> + infixExpressionList);</span><br><span class="line">List&lt;String&gt; parseSuffixExpressionList = parseSuffixExpressionList(infixExpressionList);</span><br><span class="line">System.out.println(<span class="string">&quot;后缀表达式对应的List&quot;</span> + parseSuffixExpressionList);</span><br><span class="line"></span><br><span class="line">System.out.printf(<span class="string">&quot;expression=%d&quot;</span>,calculate(parseSuffixExpressionList));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 将 得到的中缀表达式对应的List =&gt;后缀表达式对应的List</span></span><br><span class="line"><span class="comment">//即ArrayList[1, +, (, (, 2, +, 3, ), *, 4, ), -, 5]=&gt;ArrayList[1,2,3,+,4,*,+,5,-]</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">parseSuffixExpressionList</span><span class="params">(List&lt;String&gt; ls)</span>&#123;</span><br><span class="line"><span class="comment">//定义两个栈</span></span><br><span class="line">Stack&lt;String&gt; s1 = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;String&gt;(); <span class="comment">//符号栈</span></span><br><span class="line"><span class="comment">//说明：因为s2这个栈，在整个转换过程中，没有pop()操作，后面我们还需要逆序排序</span></span><br><span class="line"><span class="comment">//因此这样比较麻烦，此时我们就不同Stack&lt;String&gt; 直接使用List&lt;String&gt; s2</span></span><br><span class="line"><span class="comment">//Stack&lt;String&gt; s2  = new Stack&lt;String&gt;();//存储中间结果的栈S2</span></span><br><span class="line">List&lt;String&gt; s2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();<span class="comment">//存储中间结果的List2</span></span><br><span class="line"><span class="comment">//遍历ls</span></span><br><span class="line"><span class="keyword">for</span>(String item : ls) &#123;</span><br><span class="line"><span class="comment">//如果是一个数，加入s2</span></span><br><span class="line"><span class="keyword">if</span>(item.matches(<span class="string">&quot;\\d+&quot;</span>)) &#123;</span><br><span class="line">s2.add(item);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.equals(<span class="string">&quot;(&quot;</span>)) &#123;</span><br><span class="line">s1.push(item);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.equals(<span class="string">&quot;)&quot;</span>)) &#123;</span><br><span class="line"><span class="comment">//如果是右括号&quot;)&quot;，则依次弹出s1栈顶的运算符，并压入s2,直到遇到左括号为止，此时将这一对括号丢弃</span></span><br><span class="line"><span class="keyword">while</span>(!s1.peek().equals(<span class="string">&quot;(&quot;</span>)) &#123;</span><br><span class="line">s2.add(s1.pop());</span><br><span class="line">&#125;</span><br><span class="line">s1.pop();  <span class="comment">//将（弹出s1栈，消除小括号</span></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//当item的优先级小于栈顶运算符，将s1栈顶的运算符弹出并加入到s2中，再次转到（4.1）与s1中新的栈顶运算符相比较</span></span><br><span class="line"><span class="keyword">while</span>(s1.size() != <span class="number">0</span> &amp;&amp; Operation.getValue(s1.peek()) &gt;= Operation.getValue(item)) &#123;</span><br><span class="line">s2.add(s1.pop());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//还需要将item压入栈</span></span><br><span class="line">s1.push(item);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//将s1中剩余的运算符依次弹出并加入s2</span></span><br><span class="line"><span class="keyword">while</span>(s1.size() != <span class="number">0</span>) &#123;</span><br><span class="line">s2.add(s1.pop());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s2;  <span class="comment">//注意是因为存放到List，因此按顺序输出</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//方法：将中缀表达式转换为对应的List</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> s</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">toInfixExpressionList</span><span class="params">(String s)</span>&#123;</span><br><span class="line"><span class="comment">//定义一个List,存放中缀表达式 对应的内容</span></span><br><span class="line">List&lt;String&gt; ls = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//这个是个指针，用于遍历中缀表达式字符串</span></span><br><span class="line">String str;<span class="comment">//对多位数的拼接到一个字符，就放入到c</span></span><br><span class="line"><span class="type">char</span> c; <span class="comment">//每遍历到一个字符，就放入到c</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line"><span class="comment">//如果c是一个非数字，则需要加入的ls中</span></span><br><span class="line"><span class="keyword">if</span>((c=s.charAt(i)) &lt; <span class="number">48</span> || (c=s.charAt(i))&gt; <span class="number">57</span>)&#123;</span><br><span class="line">ls.add(<span class="string">&quot;&quot;</span>+c );</span><br><span class="line">i++;<span class="comment">//i需要后移</span></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//如果是一个数，需要考虑多位数问题</span></span><br><span class="line">str = <span class="string">&quot;&quot;</span>;<span class="comment">//先将str置成&quot;&quot; &#x27;0&#x27;[48]-&gt; &#x27;9&#x27;[57]</span></span><br><span class="line"><span class="keyword">while</span>(i &lt; s.length() &amp;&amp; (c=s.charAt(i)) &gt;= <span class="number">48</span> &amp;&amp; (c=s.charAt(i)) &lt;= <span class="number">57</span>) &#123;</span><br><span class="line">str += c; <span class="comment">//拼接</span></span><br><span class="line">i++;</span><br><span class="line">&#125;</span><br><span class="line">ls.add(str);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">while</span>(i &lt; s.length());</span><br><span class="line"><span class="keyword">return</span> ls;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将一个逆波兰表达式，依次将数据和运算符放到ArrayList中</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">getListString</span><span class="params">(String suffixExpression)</span>&#123;</span><br><span class="line"><span class="comment">//将suffixExpression 分割</span></span><br><span class="line">String [] split = suffixExpression.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line"><span class="keyword">for</span>(String ele : split) &#123;</span><br><span class="line">list.add(ele);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//完成对逆波兰表达式的运算。</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 思路：</span></span><br><span class="line"><span class="comment"> * 1.从左到右扫描，将3和4压入栈中</span></span><br><span class="line"><span class="comment"> * 2.遇到 + 运算符，因此弹出4和3(4为栈顶元素，3为次顶元素)，计算出3+4的值，得到7，在将7压入栈中</span></span><br><span class="line"><span class="comment"> * 3.将5入栈</span></span><br><span class="line"><span class="comment"> * 4.接下来是*运算符，因此弹出5和7，计算7*5=35，将35入栈。</span></span><br><span class="line"><span class="comment"> * 5.将6入栈</span></span><br><span class="line"><span class="comment"> * 6.最后是 - 运算符，计算出35 -6 的值，即29，由此得出最终结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">calculate</span><span class="params">(List&lt;String&gt; ls)</span> &#123;</span><br><span class="line"><span class="comment">//创建给栈，只需要一个栈即可</span></span><br><span class="line">Stack&lt;String&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line"><span class="comment">//遍历 ls</span></span><br><span class="line"><span class="keyword">for</span>(String item : ls) &#123;</span><br><span class="line"><span class="comment">//这里使用正则表达式来读取数</span></span><br><span class="line"><span class="keyword">if</span>(item.matches(<span class="string">&quot;\\d+&quot;</span>)) &#123; <span class="comment">//匹配的是多位数</span></span><br><span class="line"><span class="comment">//入栈</span></span><br><span class="line">stack.push(item);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//pop出两位数，并运算，再入栈</span></span><br><span class="line"><span class="type">int</span> <span class="variable">num2</span> <span class="operator">=</span> Integer.parseInt(stack.pop());</span><br><span class="line"><span class="type">int</span> <span class="variable">num1</span> <span class="operator">=</span> Integer.parseInt(stack.pop());</span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(item.equals(<span class="string">&quot;+&quot;</span>)) &#123;</span><br><span class="line">res = num1 + num2;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.equals(<span class="string">&quot;-&quot;</span>)) &#123;</span><br><span class="line">res = num1 - num2;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.equals(<span class="string">&quot;*&quot;</span>)) &#123;</span><br><span class="line">res = num1 * num2;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.equals(<span class="string">&quot;/&quot;</span>)) &#123;</span><br><span class="line">res = num1 / num2;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;运算符有误&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//把res入栈</span></span><br><span class="line">stack.push(<span class="string">&quot;&quot;</span> + res);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//最后留在stack中的数据是运算结果</span></span><br><span class="line"><span class="keyword">return</span> Integer.parseInt(stack.pop());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//编写一个类来返回一个运算符对应的优先级</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Operation</span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">ADD</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">SUB</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MUL</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">DIV</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//写一个方法，返回对应的优先级数字</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">(String operation)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span>  <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span>(operation) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;+&quot;</span>:</span><br><span class="line">result = ADD;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;-&quot;</span>:</span><br><span class="line">result = SUB;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;*&quot;</span>:</span><br><span class="line">result = MUL;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;/&quot;</span>:</span><br><span class="line">result = DIV;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">System.out.println(<span class="string">&quot;不存在该运算符&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-递归"><a href="#6-递归" class="headerlink" title="6.递归"></a>6.递归</h2><ol><li>递归就是方法自己调用自己</li><li><p>递归调用规则：</p><ol><li>当程序执行到一个方法时，就会开辟一个独立的空间（栈）</li><li>方法的局部变量是独立的，不会相互影响，比如n变量</li><li>如果方法中使用的是引用类型变量(比如说数组)，就会共享该引用类型的数据</li><li>递归必须向退出递归的条件逼近，否则就是无限递归，出现栈溢出也就是<code>StackOverFlowError</code>。</li><li>当一个方法执行完毕，或者遇到return,就会返回，遵循谁调用，就将结果返回给谁，同时当方法执行完毕后返回时，该方法也就执行完毕。</li></ol></li></ol><h3 id="6-1-使用递归解决迷宫问题："><a href="#6-1-使用递归解决迷宫问题：" class="headerlink" title="6.1 使用递归解决迷宫问题："></a>6.1 使用递归解决迷宫问题：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MiGong</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//创建一个二维数组模拟迷宫</span></span><br><span class="line"><span class="comment">//地图</span></span><br><span class="line"><span class="type">int</span> [][] map = <span class="keyword">new</span> <span class="title class_">int</span> [<span class="number">8</span>][<span class="number">7</span>];</span><br><span class="line"><span class="comment">//使用1表示墙</span></span><br><span class="line"><span class="comment">//上下全是墙壁</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">7</span>; i++) &#123;</span><br><span class="line">map[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">map[<span class="number">7</span>][i] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//左右全是墙壁</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">8</span>; i++ ) &#123;</span><br><span class="line">map[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">map[i][<span class="number">6</span>] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">map[<span class="number">3</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">map[<span class="number">3</span>][<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出地图</span></span><br><span class="line">System.out.println(<span class="string">&quot;当前地图为：&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">8</span> ; i ++) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span> ;j &lt; <span class="number">7</span>; j++) &#123;</span><br><span class="line">System.out.print(map[i][j] + <span class="string">&quot; &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">//使用递归回溯给小球找路</span></span><br><span class="line"><span class="comment">setWay(map, 1, 1);</span></span><br><span class="line"><span class="comment">//输出地图</span></span><br><span class="line"><span class="comment">System.out.println(&quot;小球走过，并标识：&quot;);</span></span><br><span class="line"><span class="comment">//输出新的地图，小球走过，并标识</span></span><br><span class="line"><span class="comment">for(int i = 0; i &lt; 8 ; i ++) &#123;</span></span><br><span class="line"><span class="comment">for(int j = 0 ;j &lt; 7; j++) &#123;</span></span><br><span class="line"><span class="comment">System.out.print(map[i][j] + &quot; &quot;);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println();</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用递归回溯给小球找路</span></span><br><span class="line">setWay1(map, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="comment">//输出地图</span></span><br><span class="line">System.out.println(<span class="string">&quot;小球改变方式，并标识：&quot;</span>);</span><br><span class="line"><span class="comment">//输出新的地图，小球走过，并标识</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">8</span> ; i ++) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span> ;j &lt; <span class="number">7</span>; j++) &#123;</span><br><span class="line">System.out.print(map[i][j] + <span class="string">&quot; &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用递归回溯来给小球找路</span></span><br><span class="line"><span class="comment">//说明：</span></span><br><span class="line"><span class="comment">//1.如果小球能到map[6][5]的位置说明通路找到了。</span></span><br><span class="line"><span class="comment">//当map[i][j]为0说明该点没有走过   当为1，表示墙;2 表示通路可以走，3表示该位置以及走过，但是走不通</span></span><br><span class="line"><span class="comment">//在走迷宫的时候，需要确定一个策略(方法)下 -&gt;右 -&gt;上-&gt;左边，如果改点走不通，在回溯</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> map 表示传如的地图</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> i 表示从哪个位置开始找，表示横坐标</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> j 表示坐标，表示纵坐标</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 如果找到通路，就返回为true，否则返回false</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">setWay</span><span class="params">(<span class="type">int</span> [][] map,<span class="type">int</span> i , <span class="type">int</span> j)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(map[<span class="number">6</span>][<span class="number">5</span>] == <span class="number">2</span>) &#123; <span class="comment">//通路已经找到</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(map[i][j] == <span class="number">0</span>) &#123;  <span class="comment">//如果当前这个点还没有走过</span></span><br><span class="line"><span class="comment">//按照策略 下 -&gt; 右 -&gt;上-&gt;左走</span></span><br><span class="line">map[i][j] = <span class="number">2</span>;<span class="comment">//假定该点是可以走通</span></span><br><span class="line"><span class="keyword">if</span>(setWay(map,i+<span class="number">1</span>,j)) &#123; <span class="comment">//往下走</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(setWay(map, i, j + <span class="number">1</span>)) &#123;<span class="comment">//向右</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(setWay(map, i - <span class="number">1</span>, j)) &#123;<span class="comment">//向上</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(setWay(map, i, j -<span class="number">1</span>)) &#123;  <span class="comment">//向左走</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//说明该点走不通</span></span><br><span class="line">map[i][j] = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//如果map[i][j] != 0,可能是 1,2,3</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用递归回溯来给小球找路</span></span><br><span class="line"><span class="comment">//说明：</span></span><br><span class="line"><span class="comment">//1.如果小球能到map[6][5]的位置说明通路找到了。</span></span><br><span class="line"><span class="comment">//当map[i][j]为0说明该点没有走过   当为1，表示墙;2 表示通路可以走，3表示该位置以及走过，但是走不通</span></span><br><span class="line"><span class="comment">//在走迷宫的时候，需要确定一个策略(方法)上 -&gt;右 -&gt;下-&gt;左边，如果改点走不通，在回溯</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> map 表示传如的地图</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> i 表示从哪个位置开始找，表示横坐标</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> j 表示坐标，表示纵坐标</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 如果找到通路，就返回为true，否则返回false</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">setWay1</span><span class="params">(<span class="type">int</span> [][] map,<span class="type">int</span> i , <span class="type">int</span> j)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(map[<span class="number">6</span>][<span class="number">5</span>] == <span class="number">2</span>) &#123; <span class="comment">//通路已经找到</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(map[i][j] == <span class="number">0</span>) &#123;  <span class="comment">//如果当前这个点还没有走过</span></span><br><span class="line"><span class="comment">//按照策略 上 -&gt; 右 -&gt;下-&gt;左走</span></span><br><span class="line">map[i][j] = <span class="number">2</span>;<span class="comment">//假定该点是可以走通</span></span><br><span class="line"><span class="keyword">if</span>(setWay1(map, i - <span class="number">1</span>,j)) &#123; <span class="comment">//往上走</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(setWay1(map, i, j + <span class="number">1</span>)) &#123;<span class="comment">//向右</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(setWay1(map, i + <span class="number">1</span>, j)) &#123;<span class="comment">//向下</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(setWay1(map, i, j -<span class="number">1</span>)) &#123;  <span class="comment">//向左走</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//说明该点走不通</span></span><br><span class="line">map[i][j] = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//如果map[i][j] != 0,可能是 1,2,3</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-八皇后问题递归思路和实现"><a href="#6-2-八皇后问题递归思路和实现" class="headerlink" title="6.2 八皇后问题递归思路和实现"></a>6.2 八皇后问题递归思路和实现</h3><p>八皇后问题算法思路分析：</p><p>1）第一个皇后先放第一行第一列</p><p>2）第二个皇后放在第二行第一列、然后判断是否OK，如果不OK，继续放在第二列、第三列、依次把所有列都放完，找到一个合适</p><p>3）继续第三个皇后，还是第一列、第二列…….直到第8个皇后也能放在一个不冲突的位置，算是找到了一个正确解</p><p>4）当得到一个正确解时，在栈回退到上一个栈时，就会开始回溯，即将第一个皇后，放到第一列的所有正确解，全部得到.</p><p>5）然后回头继续第一个皇后放第二列，后面继续循环执行1，2，3，4的步骤</p><p>说明：理论上应该创建一个二维数组来表示棋盘，但是实际上可以通过算法，用一个一维数组即可解决问题.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 八皇后问题</span></span><br><span class="line"><span class="comment"> * 描述，要求每个皇后不在同一行，同一列，并且不在同一斜线上</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 老胡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023年4月8日</span></span><br><span class="line"><span class="comment"> * Company 暂无</span></span><br><span class="line"><span class="comment"> * Email 2844135670@qq.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EightQueenQuestions</span> &#123;</span><br><span class="line"><span class="comment">//定义一个max表示有多少个皇后</span></span><br><span class="line"><span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line"><span class="comment">//定义数组array,保存皇后位置放置的结果，比如arr=&#123;0,4,7,5,2,6,1,3&#125;</span></span><br><span class="line"><span class="type">int</span> [] array = <span class="keyword">new</span> <span class="title class_">int</span>[max];</span><br><span class="line"><span class="comment">//定义一共有多少种解法</span></span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span> ; </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//测试一把，8皇后是否正确</span></span><br><span class="line"><span class="type">EightQueenQuestions</span> <span class="variable">queue8</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EightQueenQuestions</span>();</span><br><span class="line">System.out.println(<span class="string">&quot;哪行哪列代表数字,&quot;</span></span><br><span class="line">+ <span class="string">&quot;比如0 4 7 5 2 6 1 3，&quot;</span></span><br><span class="line">+ <span class="string">&quot;0表示第0行0列，&quot;</span></span><br><span class="line">+<span class="string">&quot;4表示第1行4列，&quot;</span></span><br><span class="line">+<span class="string">&quot;5表示第2行6列，&quot;</span></span><br><span class="line">+<span class="string">&quot;以此类推。&quot;</span>);</span><br><span class="line">queue8.check(<span class="number">0</span>);</span><br><span class="line">System.out.printf(<span class="string">&quot;共计有%d种解法&quot;</span>,count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//编写一个方法，放置第n个皇后</span></span><br><span class="line"><span class="comment">//注意到：check是每一次递归时，进入check中都有for(int i = 0; i &lt; max ; i ++)，因此会有回溯</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">check</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(n == max ) &#123;</span><br><span class="line"><span class="comment">//n = 8 ，其实是8个皇后就放好了</span></span><br><span class="line">print();</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//依次放入皇后，并判断是否冲突</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; max; i ++) &#123;<span class="comment">//不冲突</span></span><br><span class="line"><span class="comment">//先把当前这个皇后n,放到该行的第1列</span></span><br><span class="line">array[n] = i;</span><br><span class="line"><span class="keyword">if</span>(judge(n)) &#123;</span><br><span class="line"><span class="comment">//接着放置n + 1皇后，即开始递归</span></span><br><span class="line">check(n+<span class="number">1</span>); <span class="comment">//如果有8个皇后，我们将调用8次</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//如果是冲突就继续执行array[n] = i; 即将第n个皇后放置在本行的后移一个位置</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查看当我们放置第n个皇后，就去检测该皇后是否和前面已经摆放的皇后冲突</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> n 表示第n个皇后</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">judge</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; n ; i ++) &#123;</span><br><span class="line"><span class="comment">//说明一下</span></span><br><span class="line"><span class="comment">//array[i] == array[n] 表示判断第n个皇后是否和前面的n-1个皇后在同一列</span></span><br><span class="line"><span class="comment">//Math.abs(n-i) == Math.abs(array[n] -  array[i]) 表示判断第n个皇后时候和第i个皇后是否在同一斜线</span></span><br><span class="line"><span class="comment">// n = 1 放置第2列 n = 1 array[1] = 1</span></span><br><span class="line"><span class="comment">//Math.abs(1 - 0)  == 1 Math.abs(array[n] - array[i]) = Math.abs(1-0) = 1;</span></span><br><span class="line"><span class="comment">//判断是否在同一行，其实没有必要，因为每次都在递增</span></span><br><span class="line"><span class="keyword">if</span>(array[i] == array[n] || Math.abs(n-i) == Math.abs(array[n] -  array[i])) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//写一个方法，可以将皇后摆放的位置输出</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">count ++;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; array.length; i++) &#123;</span><br><span class="line">System.out.print(array[i] + <span class="string">&quot; &quot;</span> );</span><br><span class="line">&#125;</span><br><span class="line">System.out.println();</span><br><span class="line">System.out.println(<span class="string">&quot;===============&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="7-排序"><a href="#7-排序" class="headerlink" title="7. 排序"></a>7. 排序</h2><h3 id="7-1-8种基本排序"><a href="#7-1-8种基本排序" class="headerlink" title="7.1 8种基本排序"></a>7.1 8种基本排序</h3><ol><li>排序也称为排序算法，排序是一组数据，按照指定的顺序进行排列的过程。</li><li>排序的分类：<ol><li>内部排序：将需要处理的所有数据都加载到内部存储器中进行排序</li><li>外部排序：数据量过大，无法全部加载到内存中，需要借助外部存储进行排序</li></ol></li><li>常见的排序算法的分类：<ol><li>内部排序：<ol><li>插入排序：<ol><li>直接插入排序</li><li>希尔排序</li></ol></li><li>选择排序<ol><li>简单选择排序</li><li>堆排序</li></ol></li><li>交换排序<ol><li>冒泡排序</li><li>快速排序</li></ol></li><li>归并排序</li><li>基数排序</li></ol></li><li>外部排序：内存和外存排序</li></ol></li></ol><h3 id="7-2时间复杂度"><a href="#7-2时间复杂度" class="headerlink" title="7.2时间复杂度"></a>7.2时间复杂度</h3><p>算法的时间复杂度</p><p>一般我们度量一个程序执行时间的两种方法</p><ol><li><p>事后统计：这种方法可行，但是存在两个问题，一是想要对设计的算法的运行性能进行评测，需要实际运行该程序，二是所得时间的统计量依赖于计算机的硬件，软件等环境因素，这种方式要求在同一台计算机的相同状态下运行，才能比较那个算法速度更快。</p></li><li><p>事前估算法：通过分析某个算法的时间复杂度来判断哪个算法更优。</p></li></ol><p>1）一般情况下，算法中的基本操作语句的重复执行次数是问题规模n的某个函数，用f(n）表示，若有某个辅助函数f(n），便得当n趋近于无穷大时，T(n)/f(n)的极限值为不等于零的常数，则称f（n）是T（n）的同数量级函数。记作T（n）=O(f(n))，称O(f(n))为算法的渐进间复杂度，简称时间复杂度。</p><p>2）T（n）不同，但时间复杂度可能相同。如：T（n）=n^2+7n+6与T（n）=3n^2+2n+2它们的（n）不同，但时间复杂度相同，都为O(n^2)。</p><p>3）计算时间复杂度的方法：</p><ul><li><p>用常数1代替运行时间中的所有加法常数 T(n) = n^2 + 7n + 6; =&gt;T(n) = n^2 + 7n + 1</p></li><li><p>修改后的运行次数函数中，只保留最高阶项</p><p>T(n) = n^2 + 7n + 1 =&gt; T(n) = n^2</p></li><li><p>去除最高阶项的系数T(n) =3n^2 =&gt;O(n^2)</p></li></ul><ol><li><p>常数阶O(1)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">++ i;</span><br><span class="line">j++ ;</span><br><span class="line"><span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> i + j;</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>对数阶O(log2n)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">i</span>  <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(i&lt;n)&#123;</span><br><span class="line">    i=i*<span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>线性阶O(n)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n ; ++ i)&#123;</span><br><span class="line">    j = i;</span><br><span class="line">    j ++;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></li></ol><ol><li><p>线性对数阶O(nlog2n)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; m &lt; n; m++ )&#123;</span><br><span class="line">    i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(i &lt; n)&#123;</span><br><span class="line">        i *= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>平方阶O(n^2)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>( <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i&lt;= n; i ++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span> ; j &lt;= n; j++)&#123;</span><br><span class="line">        j = i;</span><br><span class="line">        j ++ ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>立方阶O(n^3)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>()&#123;</span><br><span class="line">    <span class="keyword">for</span>()&#123;</span><br><span class="line">        <span class="keyword">for</span>()&#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>k次方阶O(n^k)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">n层<span class="keyword">for</span>()&#123;</span><br><span class="line">    <span class="keyword">for</span>()&#123;</span><br><span class="line">        <span class="keyword">for</span>()&#123;</span><br><span class="line">            ......</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol><li>指数阶O(2^n)</li></ol><p>依次往下时间复杂度增长</p><div class="table-container"><table><thead><tr><th>排序法</th><th>平均时间</th><th>最差情况</th><th>稳定度</th><th>空间复杂度</th><th>备注</th></tr></thead><tbody><tr><td>冒泡</td><td>O(n^2)</td><td>O(n^2)</td><td>稳定</td><td>1</td><td>n小比较好</td></tr><tr><td>交换</td><td>O(n^2)</td><td>O(n^2)</td><td>不稳定</td><td>1</td><td>n小比较好</td></tr><tr><td>选择</td><td>O(n^2)</td><td>O(n^2)</td><td>不稳定</td><td>1</td><td>n小比较好</td></tr><tr><td>插入</td><td>O(n^2)</td><td>O(n^2)</td><td>稳定</td><td>1</td><td>大部分已排序的较好</td></tr><tr><td>基数</td><td>O(logRB)</td><td>O(logRB)</td><td>稳定</td><td>1</td><td>B是真数(0-9),R是基数（个十百）</td></tr><tr><td>shell</td><td>O(nlogn)</td><td>O(n^s)  1&lt;s&lt;2</td><td>不稳定</td><td>1</td><td>s是所选分组</td></tr><tr><td>快速</td><td>O(nlogn)</td><td>O(n^2)</td><td>不稳定</td><td>O(nlogn)</td><td>n大时较好</td></tr><tr><td>归并</td><td>O(nlogn)</td><td>O(nlogn)</td><td>稳定</td><td>O(1)</td><td>n大时较好</td></tr><tr><td>堆</td><td>O(nlogn)</td><td>O(nlogn)</td><td>不稳定</td><td>O(1)</td><td>n大时候较好</td></tr></tbody></table></div><h3 id="7-3-排序算法的实现与设计"><a href="#7-3-排序算法的实现与设计" class="headerlink" title="7.3 排序算法的实现与设计"></a>7.3 排序算法的实现与设计</h3><h4 id="7-3-1-冒泡排序"><a href="#7-3-1-冒泡排序" class="headerlink" title="7.3.1 冒泡排序"></a>7.3.1 冒泡排序</h4><p>思想：</p><p>冒泡排序通过对排序序列从前往后(从下标较小的元素开始)，依次比较相邻元素的值，若发现逆序则交换，使值较大大元素慢慢从前往后移，就像水底气泡一样慢慢往上冒。</p><p>优化：</p><p>因为排序的过程中，各元素不断接近自己的位置，如果一趟比较下来没有进行过交换，就说明序列有序，因此要在排序过程中设置一个标志flag判断元素是否进行过交换。从而减少不必要的比较。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BubbleSort</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">int</span> arr[] = &#123;<span class="number">3</span>,<span class="number">9</span>,-<span class="number">1</span>,<span class="number">10</span>,-<span class="number">2</span>&#125;;</span><br><span class="line"><span class="comment">//冒泡排序的过程</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//第一趟排序，就是将最大的数排在最后</span></span><br><span class="line"><span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//临时变量</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; arr.length -<span class="number">1</span> ; i ++ ) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span> ; j &lt; arr.length -<span class="number">1</span> -i; j ++) &#123;</span><br><span class="line"><span class="comment">//如果前面这个数比后面的数更大，则交换</span></span><br><span class="line"><span class="keyword">if</span>(arr[j]&gt;arr[j+<span class="number">1</span>]) &#123;</span><br><span class="line">temp = arr[j];</span><br><span class="line">arr[j] = arr[j+<span class="number">1</span>];</span><br><span class="line">arr[j+<span class="number">1</span>] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br><span class="line"><span class="comment">/*System.out.println(&quot;第一回排序后的数组&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//第二会排序，就是将第二大的数排在倒数第二位</span></span><br><span class="line"><span class="comment">for(int j = 0 ; j &lt; arr.length -1 - 1; j ++ ) &#123;</span></span><br><span class="line"><span class="comment">//如果前面这个数比后面的数更大，则交换</span></span><br><span class="line"><span class="comment">if(arr[j]&gt;arr[j+1]) &#123;</span></span><br><span class="line"><span class="comment">temp = arr[j];</span></span><br><span class="line"><span class="comment">arr[j] = arr[j+1];</span></span><br><span class="line"><span class="comment">arr[j+1] = temp;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;第二回排序后的数组&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//第三会排序，就是将第三大的数排在倒数第三位</span></span><br><span class="line"><span class="comment">for(int j = 0 ; j &lt; arr.length -1 - 2; j ++ ) &#123;</span></span><br><span class="line"><span class="comment">//如果前面这个数比后面的数更大，则交换</span></span><br><span class="line"><span class="comment">if(arr[j]&gt;arr[j+1]) &#123;</span></span><br><span class="line"><span class="comment">temp = arr[j];</span></span><br><span class="line"><span class="comment">arr[j] = arr[j+1];</span></span><br><span class="line"><span class="comment">arr[j+1] = temp;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;第三回排序后的数组&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment">//第四会排序，就是将第四大的数排在倒数第四位</span></span><br><span class="line"><span class="comment">for(int j = 0 ; j &lt; arr.length -1 - 3; j ++ ) &#123;</span></span><br><span class="line"><span class="comment">//如果前面这个数比后面的数更大，则交换</span></span><br><span class="line"><span class="comment">if(arr[j]&gt;arr[j+1]) &#123;</span></span><br><span class="line"><span class="comment">temp = arr[j];</span></span><br><span class="line"><span class="comment">arr[j] = arr[j+1];</span></span><br><span class="line"><span class="comment">arr[j+1] = temp;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;第四回排序后的数组&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>冒泡排序的优化：</p><p>因为在排序过程中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BubbleSortOptimize</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">int arr[] = &#123;3,9,-1,10,-2&#125;;</span></span><br><span class="line"><span class="comment">//冒泡排序的过程</span></span><br><span class="line"><span class="comment">System.out.println(&quot;排序前的数组：&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment">System.out.println(&quot;=============================&quot;);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//测试一下冒泡排序的速度O(n^2),给8万个数据，测试</span></span><br><span class="line"><span class="comment">//创建要给80000个数据</span></span><br><span class="line"><span class="type">int</span> [] arr = <span class="keyword">new</span> <span class="title class_">int</span> [<span class="number">80000</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; <span class="number">80000</span> ; i ++) &#123;</span><br><span class="line">arr[i] = (<span class="type">int</span>)(Math.random() * <span class="number">80000</span>); <span class="comment">//生成一个[0,80000)的随机数</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">Date</span> <span class="variable">date1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="comment">//输出一个日期格式</span></span><br><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">dateStr</span> <span class="operator">=</span> simpleDateFormat.format(date1);</span><br><span class="line">System.out.println(<span class="string">&quot;排序前的时间为=&quot;</span> + dateStr);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//测试冒泡排序</span></span><br><span class="line">bubbleSort(arr);</span><br><span class="line"><span class="type">Date</span> <span class="variable">date2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="type">String</span> <span class="variable">dateStr2</span> <span class="operator">=</span> simpleDateFormat.format(date2);</span><br><span class="line">System.out.println(<span class="string">&quot;输出排序后的时间&quot;</span> + dateStr2);</span><br><span class="line"><span class="comment">//System.out.println(Arrays.toString(arr));</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将前面冒泡排序算法封装成一个方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">bubbleSort</span><span class="params">(<span class="type">int</span> [] arr)</span> &#123;</span><br><span class="line"><span class="comment">//第一趟排序，就是将最大的数排在最后</span></span><br><span class="line"><span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//临时变量</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>; <span class="comment">//定义一个标识符</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; arr.length -<span class="number">1</span> ; i ++ ) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span> ; j &lt; arr.length -<span class="number">1</span> -i; j ++) &#123;</span><br><span class="line"><span class="comment">//如果前面这个数比后面的数更大，则交换</span></span><br><span class="line"><span class="keyword">if</span>(arr[j]&gt;arr[j+<span class="number">1</span>]) &#123;</span><br><span class="line">flag = <span class="literal">true</span>;</span><br><span class="line">temp = arr[j];</span><br><span class="line">arr[j] = arr[j+<span class="number">1</span>];</span><br><span class="line">arr[j+<span class="number">1</span>] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//System.out.println(&quot;第&quot;+(i+1)+&quot;躺排序后的数组&quot;);</span></span><br><span class="line"><span class="comment">//System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="keyword">if</span>(flag == <span class="literal">false</span>) &#123; <span class="comment">//在一趟排序中一次交换都没发生过</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">flag = <span class="literal">false</span>; <span class="comment">//重置flag！！！，进行下次判断</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>核心代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//临时变量</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; arr.length -<span class="number">1</span> ; i ++ ) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span> ; j &lt; arr.length -<span class="number">1</span> -i; j ++) &#123;</span><br><span class="line"><span class="comment">//如果前面这个数比后面的数更大，则交换</span></span><br><span class="line"><span class="keyword">if</span>(arr[j]&gt;arr[j+<span class="number">1</span>]) &#123;</span><br><span class="line">temp = arr[j];</span><br><span class="line">arr[j] = arr[j+<span class="number">1</span>];</span><br><span class="line">arr[j+<span class="number">1</span>] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br></pre></td></tr></table></figure><h4 id="7-3-2-选择排序"><a href="#7-3-2-选择排序" class="headerlink" title="7.3.2 选择排序"></a>7.3.2 选择排序</h4><p>选择排序也是一种简单的排序方式，其基本思想在于：第一次从数组(arr[0]-arr[n-1])中选择最小的值，然后与数组第一个元素(arr[0])进行交换，第二次从<code>arr[1]-arr[n-1</code>]中选取最小值，与arr[1]交换,……,知道将数组排序好，总共通过<code>n-1</code>次，得到一个按照排序码从小到大的有序序列。</p><p>思路：</p><p>原始数组 ： 101,34,119,1；</p><p>第一轮排序：1,34,119,101；</p><p>第二轮排序：1,34,119,101；</p><p>第三轮排序：1,34,101,119;</p><ol><li>选则排序一共有数组大小-1轮排序</li><li>每1轮排序，又是一个循环，循环的规则。<ol><li>假定当前这个数是最小数</li><li>然后和后面的每个数进行比较，如果发现有比当前数更小的数，就重新确定最小数，并得到下标</li><li>当遍历到数组的最后，就得到本轮最小数和下标</li><li>交换数组的位置</li></ol></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SelectSort</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//int [] arr =  &#123;101,34,119,1&#125;;</span></span><br><span class="line"><span class="comment">//创建要给80000个数据</span></span><br><span class="line"><span class="type">int</span> [] arr = <span class="keyword">new</span> <span class="title class_">int</span> [<span class="number">80000</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; <span class="number">80000</span> ; i ++) &#123;</span><br><span class="line">arr[i] = (<span class="type">int</span>)(Math.random() * <span class="number">80000</span>); <span class="comment">//生成一个[0,80000)的随机数</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">Date</span> <span class="variable">date1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="comment">//输出一个日期格式</span></span><br><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">dateStr</span> <span class="operator">=</span> simpleDateFormat.format(date1);</span><br><span class="line">System.out.println(<span class="string">&quot;排序前的时间为=&quot;</span> + dateStr);</span><br><span class="line">selectSort(arr);</span><br><span class="line"><span class="comment">//测试冒泡排序</span></span><br><span class="line"><span class="type">Date</span> <span class="variable">date2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="type">String</span> <span class="variable">dateStr2</span> <span class="operator">=</span> simpleDateFormat.format(date2);</span><br><span class="line">System.out.println(<span class="string">&quot;输出排序后的时间&quot;</span> + dateStr2);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">System.out.println(&quot;排序前：&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment">selectSort(arr);</span></span><br><span class="line"><span class="comment">System.out.println(&quot;排序后&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//选择排序</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">selectSort</span><span class="params">(<span class="type">int</span> [] arr)</span> &#123;</span><br><span class="line"><span class="comment">//在推到的过程中，我们发现规律，因此可以使用for来解决</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; arr.length ; i ++ ) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">minIndex</span> <span class="operator">=</span> i;</span><br><span class="line"><span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> arr[i];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i +<span class="number">1</span> ; j &lt; arr.length ; j++) &#123;</span><br><span class="line"><span class="keyword">if</span>(min &gt; arr[j]) &#123; <span class="comment">//说明假定的最小值，并非最小</span></span><br><span class="line">min = arr[j]; <span class="comment">//重置min</span></span><br><span class="line">minIndex = j ;  <span class="comment">//重置minInde</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(minIndex != i) &#123;</span><br><span class="line">arr[minIndex] = arr[i];</span><br><span class="line">arr[i] = min;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * System.out.println(&quot;第&quot;+(i+1)+&quot;轮后~~&quot;);</span></span><br><span class="line"><span class="comment"> * System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用逐步推导，进行选择排序y</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 原始的数组： 101,34,119,1</span></span><br><span class="line"><span class="comment"> * 第一轮排序：1,34,119,101；</span></span><br><span class="line"><span class="comment">      第二轮排序：1,34,119,101；</span></span><br><span class="line"><span class="comment">      第三轮排序：1,34,101,119;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">int minIndex = 0;</span></span><br><span class="line"><span class="comment">int min = arr[0];</span></span><br><span class="line"><span class="comment">for(int j = 0 +1 ; j &lt; arr.length ; j++) &#123;</span></span><br><span class="line"><span class="comment">if(min &gt; arr[j]) &#123; //说明假定的最小值，并非最小</span></span><br><span class="line"><span class="comment">min = arr[j]; //重置min</span></span><br><span class="line"><span class="comment">minIndex = j ;  //重置minInde</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">//此时将最小值，放在arr[0]中，此时就是交换</span></span><br><span class="line"><span class="comment">if(minIndex != 0) &#123;</span></span><br><span class="line"><span class="comment">arr[minIndex] = arr[0];</span></span><br><span class="line"><span class="comment">arr[0] = min;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;第一轮后~~&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment">//第二轮</span></span><br><span class="line"><span class="comment">minIndex = 1;</span></span><br><span class="line"><span class="comment">min = arr[1];</span></span><br><span class="line"><span class="comment">for(int j = 0 +1 ; j &lt; arr.length ; j++) &#123;</span></span><br><span class="line"><span class="comment">if(min &gt; arr[j]) &#123; //说明假定的最小值，并非最小</span></span><br><span class="line"><span class="comment">min = arr[j]; //重置min</span></span><br><span class="line"><span class="comment">minIndex = j ;  //重置minInde</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">//此时将最小值，放在arr[0]中，此时就是交换</span></span><br><span class="line"><span class="comment">if(minIndex != 1) &#123;</span></span><br><span class="line"><span class="comment">arr[minIndex] = arr[1];</span></span><br><span class="line"><span class="comment">arr[1] = min;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;第二轮后~~&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment">//第三轮</span></span><br><span class="line"><span class="comment">minIndex = 2;</span></span><br><span class="line"><span class="comment">min = arr[2];</span></span><br><span class="line"><span class="comment">for(int j = 0 +1 ; j &lt; arr.length ; j++) &#123;</span></span><br><span class="line"><span class="comment">if(min &gt; arr[j]) &#123; //说明假定的最小值，并非最小</span></span><br><span class="line"><span class="comment">min = arr[j]; //重置min</span></span><br><span class="line"><span class="comment">minIndex = j ;  //重置minInde</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">//此时将最小值，放在arr[0]中，此时就是交换</span></span><br><span class="line"><span class="comment">if(minIndex != 2) &#123;</span></span><br><span class="line"><span class="comment">arr[minIndex] = arr[2];</span></span><br><span class="line"><span class="comment">arr[2] = min;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;第三轮后~~&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对比冒泡排序发现，选择排序速度比冒泡排序快。</p><p>核心代码层：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//选择排序</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">selectSort</span><span class="params">(<span class="type">int</span> [] arr)</span> &#123;</span><br><span class="line"><span class="comment">//在推到的过程中，我们发现规律，因此可以使用for来解决</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; arr.length ; i ++ ) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">minIndex</span> <span class="operator">=</span> i;</span><br><span class="line"><span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> arr[i];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i +<span class="number">1</span> ; j &lt; arr.length ; j++) &#123;</span><br><span class="line"><span class="keyword">if</span>(min &gt; arr[j]) &#123; <span class="comment">//说明假定的最小值，并非最小</span></span><br><span class="line">min = arr[j]; <span class="comment">//重置min</span></span><br><span class="line">minIndex = j ;  <span class="comment">//重置minInde</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(minIndex != i) &#123;</span><br><span class="line">arr[minIndex] = arr[i];</span><br><span class="line">arr[i] = min;</span><br><span class="line">&#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h4 id="7-3-3-插入排序"><a href="#7-3-3-插入排序" class="headerlink" title="7.3.3 插入排序"></a>7.3.3 插入排序</h4><p>插入排序的基本思想： 把n个待排序的元素看成一个有序表和一个无序表，开始时，有序表只包含一个元素，无序表中包含有n-1个元素，排序过程中每次从无序表中取出第一个元素，把他的排序码依次与有序元素的排序码进行比较，将他插入到有序表中的适当位置，使之成为新的有序表。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InsertSort</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">int</span> arr [] = &#123;<span class="number">101</span>,<span class="number">34</span>,-<span class="number">1</span>,<span class="number">119</span>,<span class="number">1</span>,<span class="number">89</span>&#125;;</span><br><span class="line">insertSort(arr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//插入排序</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">insertSort</span><span class="params">(<span class="type">int</span> [] arr)</span> &#123;</span><br><span class="line"><span class="comment">//使用for循环来将代码简化</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span> ; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="comment">//使用逐步推到的方式来</span></span><br><span class="line"><span class="comment">//定义待插入的数据</span></span><br><span class="line"><span class="type">int</span> <span class="variable">insertVal</span> <span class="operator">=</span> arr[i];</span><br><span class="line"><span class="type">int</span> <span class="variable">insertIndex</span> <span class="operator">=</span> i - <span class="number">1</span>; <span class="comment">//也就是arr[1]的前面这个数的下标</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//给insertVal找到插入的位置</span></span><br><span class="line"><span class="comment">//说明 insertIndex &gt;= 0 保证在给insertVal 找插入位置，不越界</span></span><br><span class="line"><span class="comment">//insertVal &lt; arr[insertIndex]待插入的数，还没有找到插入位置</span></span><br><span class="line"><span class="comment">//需要将arr[insertIndex]</span></span><br><span class="line"><span class="keyword">while</span>(insertIndex &gt;= <span class="number">0</span> &amp;&amp; insertVal &lt; arr[insertIndex]) &#123;</span><br><span class="line">arr[insertIndex +  <span class="number">1</span>] = arr[insertIndex];</span><br><span class="line">insertIndex -- ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当退出while循环时候，说明插入的位置找到，insertIndex + 1;</span></span><br><span class="line">arr[insertIndex + <span class="number">1</span>] = insertVal;</span><br><span class="line">System.out.println(<span class="string">&quot;第&quot;</span>+i+<span class="string">&quot;轮&quot;</span>);</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">//使用逐步推到的方式来</span></span><br><span class="line"><span class="comment">//定义待插入的数据</span></span><br><span class="line"><span class="comment">int insertVal = arr[1];</span></span><br><span class="line"><span class="comment">int insertIndex = 1 - 1; //也就是arr[1]的前面这个数的下标</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//给insertVal找到插入的位置</span></span><br><span class="line"><span class="comment">//说明 insertIndex &gt;= 0 保证在给insertVal 找插入位置，不越界</span></span><br><span class="line"><span class="comment">//insertVal &lt; arr[insertIndex]待插入的数，还没有找到插入位置</span></span><br><span class="line"><span class="comment">//需要将arr[insertIndex]</span></span><br><span class="line"><span class="comment">while(insertIndex &gt;= 0 &amp;&amp; insertVal &lt; arr[insertIndex]) &#123;</span></span><br><span class="line"><span class="comment">arr[insertIndex +  1] = arr[insertIndex];</span></span><br><span class="line"><span class="comment">insertIndex -- ;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">//当退出while循环时候，说明插入的位置找到，insertIndex + 1;</span></span><br><span class="line"><span class="comment">arr[insertIndex + 1] = insertVal;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;第一轮&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//第二轮</span></span><br><span class="line"><span class="comment">insertVal = arr[2];</span></span><br><span class="line"><span class="comment">insertIndex = 2 -1;</span></span><br><span class="line"><span class="comment">while(insertIndex &gt;= 0 &amp;&amp; insertVal &lt; arr[insertIndex]) &#123;</span></span><br><span class="line"><span class="comment">arr[insertIndex +  1] = arr[insertIndex];</span></span><br><span class="line"><span class="comment">insertIndex -- ;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">arr[insertIndex + 1] = insertVal;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;第二轮&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//第二轮</span></span><br><span class="line"><span class="comment">insertVal = arr[3];</span></span><br><span class="line"><span class="comment">insertIndex = 3 -1;</span></span><br><span class="line"><span class="comment">while(insertIndex &gt;= 0 &amp;&amp; insertVal &lt; arr[insertIndex]) &#123;</span></span><br><span class="line"><span class="comment">arr[insertIndex +  1] = arr[insertIndex];</span></span><br><span class="line"><span class="comment">insertIndex -- ;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">arr[insertIndex + 1] = insertVal;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;第三轮&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>核心代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用for循环来将代码简化</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span> ; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="comment">//使用逐步推到的方式来</span></span><br><span class="line"><span class="comment">//定义待插入的数据</span></span><br><span class="line"><span class="type">int</span> <span class="variable">insertVal</span> <span class="operator">=</span> arr[i];</span><br><span class="line"><span class="type">int</span> <span class="variable">insertIndex</span> <span class="operator">=</span> i - <span class="number">1</span>; <span class="comment">//也就是arr[1]的前面这个数的下标</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//给insertVal找到插入的位置</span></span><br><span class="line"><span class="comment">//说明 insertIndex &gt;= 0 保证在给insertVal 找插入位置，不越界</span></span><br><span class="line"><span class="comment">//insertVal &lt; arr[insertIndex]待插入的数，还没有找到插入位置</span></span><br><span class="line"><span class="comment">//需要将arr[insertIndex]</span></span><br><span class="line"><span class="keyword">while</span>(insertIndex &gt;= <span class="number">0</span> &amp;&amp; insertVal &lt; arr[insertIndex]) &#123;</span><br><span class="line">arr[insertIndex +  <span class="number">1</span>] = arr[insertIndex];</span><br><span class="line">insertIndex -- ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当退出while循环时候，说明插入的位置找到，insertIndex + 1;</span></span><br><span class="line"><span class="keyword">if</span>(insertIndex + <span class="number">1</span> != i) &#123;</span><br><span class="line">arr[insertIndex + <span class="number">1</span>] = insertVal;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//System.out.println(&quot;第&quot;+i+&quot;轮&quot;);</span></span><br><span class="line"><span class="comment">//System.out.println(Arrays.toString(arr));</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过时间比较，我们发现插入排序比选择排序时间更短，也就是说插入排序的效率高于选择排序。</p><p>缺点： 当插入的数是最小的数时，后移的次数明显增多，对效率有影响。</p><h4 id="7-3-4-希尔排序"><a href="#7-3-4-希尔排序" class="headerlink" title="7.3.4 希尔排序"></a>7.3.4 希尔排序</h4><p>也是一种插入排序，其是在插入排序的一种优化。希尔排序是在插入排序上的缺点的一种解决办法，其完美解决了插入排序的缺点。</p><p>基本思想是对数组进行分组，按照分组排序后再排序</p><p>第一种思路：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShellSort</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//希尔排序，对有序序列在插入时采用交换法，并测试排序速度</span></span><br><span class="line"><span class="comment">//对有序序列在插入式采用移动法，并测试排序速度</span></span><br><span class="line"><span class="type">int</span> []arr = &#123;<span class="number">8</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">0</span>&#125;;</span><br><span class="line">shellSort(arr);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建一个算法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">shellSort</span><span class="params">(<span class="type">int</span> [] arr)</span> &#123;</span><br><span class="line"><span class="comment">//使用for循环简化代码</span></span><br><span class="line"><span class="comment">//希尔排序的第一轮排序</span></span><br><span class="line"><span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">gap</span> <span class="operator">=</span> arr.length / <span class="number">2</span>; gap &gt; <span class="number">0</span> ;gap /=<span class="number">2</span> ) &#123;</span><br><span class="line"><span class="comment">//因为是第一轮排序，将n个数据分成gap组</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> gap; i &lt; arr.length ; i++) &#123;</span><br><span class="line"><span class="comment">//遍历各组中所有的元素（共计gap组，每组n/gap个元素）步长为gap</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i -gap ; j &gt;= <span class="number">0</span>; j -= gap) &#123;</span><br><span class="line"><span class="comment">//如果当前元素大于加上步长后的那个元素，说明要交换</span></span><br><span class="line"><span class="keyword">if</span>(arr[j] &gt; arr[j + gap]) &#123;</span><br><span class="line">temp = arr[j];</span><br><span class="line">arr[j] = arr[j + gap];</span><br><span class="line">arr[j + gap] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;希尔排序后的第&quot;</span>+(++count)+<span class="string">&quot;轮结果为：&quot;</span> + Arrays.toString(arr));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">//希尔排序的第一轮排序</span></span><br><span class="line"><span class="comment">int temp;</span></span><br><span class="line"><span class="comment">//因为是第一轮排序，将10个数据分成5组</span></span><br><span class="line"><span class="comment">for(int i = 5; i &lt; arr.length ; i++) &#123;</span></span><br><span class="line"><span class="comment">//遍历各组中所有的元素（共计5组，每组2个元素）步长为5</span></span><br><span class="line"><span class="comment">for(int j = i -5 ; j &gt;= 0; j -= 5) &#123;</span></span><br><span class="line"><span class="comment">//如果当前元素大于加上步长后的那个元素，说明要交换</span></span><br><span class="line"><span class="comment">if(arr[j] &gt; arr[j + 5]) &#123;</span></span><br><span class="line"><span class="comment">temp = arr[j];</span></span><br><span class="line"><span class="comment">arr[j] = arr[j + 5];</span></span><br><span class="line"><span class="comment">arr[j + 5] = temp;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;希尔排序后的第一轮结果为：&quot; + Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//因为是第二轮排序，将10个数据分成5/2 = 2组</span></span><br><span class="line"><span class="comment">for(int i = 2; i &lt; arr.length ; i++) &#123;</span></span><br><span class="line"><span class="comment">//遍历各组中所有的元素（共计5组，每组2个元素）步长为5</span></span><br><span class="line"><span class="comment">for(int j = i -2 ; j &gt;= 0; j -= 2) &#123;</span></span><br><span class="line"><span class="comment">//如果当前元素大于加上步长后的那个元素，说明要交换</span></span><br><span class="line"><span class="comment">if(arr[j] &gt; arr[j + 2]) &#123;</span></span><br><span class="line"><span class="comment">temp = arr[j];</span></span><br><span class="line"><span class="comment">arr[j] = arr[j + 2];</span></span><br><span class="line"><span class="comment">arr[j + 2] = temp;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;希尔排序后的第2轮结果为：&quot; + Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//因为是第三轮排序，将10个数据分成5/2/2 = 1组</span></span><br><span class="line"><span class="comment">for(int i = 1; i &lt; arr.length ; i++) &#123;</span></span><br><span class="line"><span class="comment">//遍历各组中所有的元素（共计5组，每组2个元素）步长为5</span></span><br><span class="line"><span class="comment">for(int j = i -1 ; j &gt;= 0; j -= 1) &#123;</span></span><br><span class="line"><span class="comment">//如果当前元素大于加上步长后的那个元素，说明要交换</span></span><br><span class="line"><span class="comment">if(arr[j] &gt; arr[j + 1]) &#123;</span></span><br><span class="line"><span class="comment">temp = arr[j];</span></span><br><span class="line"><span class="comment">arr[j] = arr[j + 1];</span></span><br><span class="line"><span class="comment">arr[j + 1] = temp;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;希尔排序后的第3轮结果为：&quot; + Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>第二种方式移位法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对希尔排序进行优化，我们使用位移法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">shellSort2</span><span class="params">(<span class="type">int</span> [] arr)</span> &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">gap</span> <span class="operator">=</span> arr.length / <span class="number">2</span> ; gap &gt; <span class="number">0</span> ; gap /= <span class="number">2</span>) &#123;</span><br><span class="line"><span class="comment">//从第gap个元素，逐个对其所在的组进行直接插入排序</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> gap ; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i;</span><br><span class="line"><span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr[j];</span><br><span class="line"><span class="keyword">if</span>(arr[j] &lt; arr[j - gap]) &#123;</span><br><span class="line"><span class="keyword">while</span>(j - gap &gt;= <span class="number">0</span> &amp;&amp; temp &lt; arr[j - gap]) &#123;</span><br><span class="line"><span class="comment">//移动</span></span><br><span class="line">arr[j] = arr[j-gap];</span><br><span class="line">j -= gap;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当退出while后，就给temp找到插入的位置</span></span><br><span class="line">arr[j] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//System.out.println(Arrays.toString(arr));</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用移位法后，我们发现时间快了很多倍。</p><h4 id="7-3-5-快速排序"><a href="#7-3-5-快速排序" class="headerlink" title="7.3.5 快速排序"></a>7.3.5 快速排序</h4><p>快速排序是对冒泡排序的一种改进，其<strong>基本思想设计</strong>:通过一趟排序将要排序的数据分割成独立的两部分，其中一部分的所有数据都比另一部分的所有数据都要小，然后按照次方法对这两部分数据分别进行快速排序，整个排序过程都可以递归进行，依此达到整个数据变成有序序列。</p><ol><li>快速排序，在序列中找一个基准数，然后将所有比基数小的放到基数的左边，所有比基数大的数放到基准数的右边。然后再对左右两个子序列重复这个过程，知道序列中所有的数都排序好。</li><li>我的理解，找到一个中位数，比中位数小的放左边，比中位数大的放右边，直到所有的数都排好序为止。</li></ol><p>快速排序的思路：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuickSort</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//int [] arr = &#123;-9,78,0,23,-567,70&#125;;</span></span><br><span class="line"><span class="type">int</span> [] arr = <span class="keyword">new</span> <span class="title class_">int</span> [<span class="number">80000</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; <span class="number">80000</span> ; i ++) &#123;</span><br><span class="line">arr[i] = (<span class="type">int</span>)(Math.random() * <span class="number">80000</span>); <span class="comment">//生成一个[0,80000)的随机数</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">Date</span> <span class="variable">date1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="comment">//输出一个日期格式</span></span><br><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">dateStr</span> <span class="operator">=</span> simpleDateFormat.format(date1);</span><br><span class="line">System.out.println(<span class="string">&quot;排序前的时间为=&quot;</span> + dateStr);</span><br><span class="line"></span><br><span class="line">quickSort(arr, <span class="number">0</span>,arr.length - <span class="number">1</span>);</span><br><span class="line"><span class="comment">//shellSort(arr);</span></span><br><span class="line"><span class="comment">//测试冒泡排序</span></span><br><span class="line"><span class="type">Date</span> <span class="variable">date2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="type">String</span> <span class="variable">dateStr2</span> <span class="operator">=</span> simpleDateFormat.format(date2);</span><br><span class="line">System.out.println(<span class="string">&quot;输出排序后的时间&quot;</span> + dateStr2);</span><br><span class="line"><span class="comment">//System.out.println(&quot;arr:&quot; + Arrays.toString(arr));</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//快速排序总代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">quickSort</span><span class="params">(<span class="type">int</span> [] arr ,<span class="type">int</span> left,<span class="type">int</span> right)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> left;<span class="comment">//左下标</span></span><br><span class="line"><span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> right ;<span class="comment">// 右下标</span></span><br><span class="line"><span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">// pivot 中值</span></span><br><span class="line"><span class="type">int</span> <span class="variable">pivot</span> <span class="operator">=</span> arr[(left + right) /<span class="number">2</span> ];</span><br><span class="line"><span class="comment">//while循环的目的是让pivot值小放到右边</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(l &lt; r) &#123;</span><br><span class="line"><span class="keyword">while</span>(arr[l] &lt; pivot) &#123;</span><br><span class="line">l += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//在pivot的右边一直找，找到小于等于pivot值，才退出</span></span><br><span class="line"><span class="keyword">while</span>(arr[r] &gt; pivot) &#123;</span><br><span class="line">r -= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果 l &gt;= r 说明pivot的左右两边的值,已经按照左边全部是</span></span><br><span class="line"><span class="comment">//小于等于pivot值，右边全部是大于等于pivot的值</span></span><br><span class="line"><span class="keyword">if</span>( l &gt;= r) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//交换</span></span><br><span class="line">temp = arr[l];</span><br><span class="line">arr[l] = arr[r];</span><br><span class="line">arr[r] = temp;</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果交换完后，发现这个arr[l] == pivot值相等 -- ，前移</span></span><br><span class="line"><span class="keyword">if</span>(arr[l] == pivot) &#123;</span><br><span class="line">r -= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//如果交换完后，发现这个arr[r] == pivot值相等 l ++ ,后移</span></span><br><span class="line"><span class="keyword">if</span>(arr[r] == pivot) &#123;</span><br><span class="line">l += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果l == r,必须l++,r-- ,否则出现栈溢出</span></span><br><span class="line"><span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">l += <span class="number">1</span>;</span><br><span class="line">r -= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//向左递归</span></span><br><span class="line"><span class="keyword">if</span>(left &lt; r) &#123;</span><br><span class="line">quickSort(arr, left, r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//向右递归</span></span><br><span class="line"><span class="keyword">if</span>(right &gt; l) &#123;</span><br><span class="line">quickSort(arr, l, right);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="7-3-6-归并排序"><a href="#7-3-6-归并排序" class="headerlink" title="7.3.6 归并排序"></a>7.3.6 归并排序</h4><p>归并排序是一种分治算法。</p><p>它的基本思想是将两个已经排序的序列合并成一个序列。具体来说，<strong>就是将一个序列分成两个子序列，然后对这两个子序列分别进行排序，最后将排好序的两个子序列合并成一个有序序列。</strong> </p><p>归并排序的过程可以分为两个步骤：<strong>分解和合并</strong>。</p><p>在分解步骤中，我们将序列不断分解成更小的子序列，直到每个子序列只包含一个元素。这时，每个子序列都是有序的。</p><p>在合并步骤中，<strong>我们将两个有序的子序列合并成一个有序的序列</strong>。具体来说，我们从两个子序列的开头开始比较它们的元素，每次取出较小的元素放入结果序列中，并将指向该元素的指针后移一位。重复这个过程，直到其中一个子序列为空。然后再将另一个子序列中剩余的元素全部放入结果序列中。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MergetSort</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">System.out.println();</span><br><span class="line"><span class="type">int</span> arr [] = &#123;<span class="number">8</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">2</span>&#125;;</span><br><span class="line"><span class="type">int</span> temp [] = <span class="keyword">new</span> <span class="title class_">int</span> [arr.length] ;<span class="comment">//归并排序需要一个额外空间</span></span><br><span class="line">mergeSort(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>, temp);</span><br><span class="line">System.out.println(<span class="string">&quot;归并排序后 = &quot;</span> + Arrays.toString(arr));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//分+和的方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">mergeSort</span><span class="params">(<span class="type">int</span> [] arr,<span class="type">int</span> left, <span class="type">int</span> right, <span class="type">int</span> [] temp)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(left &lt; right) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (left + right) /<span class="number">2</span> ;<span class="comment">//中间索引</span></span><br><span class="line"><span class="comment">//向左递归进行分解</span></span><br><span class="line">mergeSort(arr, left, mid, temp);</span><br><span class="line"><span class="comment">//向右递归进行分解</span></span><br><span class="line">mergeSort(arr, mid+<span class="number">1</span>, right, temp);</span><br><span class="line"></span><br><span class="line"><span class="comment">//到合并</span></span><br><span class="line">merget(arr, left, mid, right, temp);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//合并的方法</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> arr 排序的原始数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> left 左边有序序列的初始索引</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> mid 中间索引</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> right 右边索引</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> temp 做中转的数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">merget</span><span class="params">(<span class="type">int</span> [] arr, <span class="type">int</span> left , <span class="type">int</span> mid, <span class="type">int</span> right, <span class="type">int</span> [] temp)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> left; <span class="comment">//初始化i,左边有序序列的初始索引</span></span><br><span class="line"><span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> mid + <span class="number">1</span>;  <span class="comment">//初始化j,右边有序序列的初始索引</span></span><br><span class="line"><span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//指向temp数组的当前索引</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//（1）</span></span><br><span class="line"><span class="comment">//先把左右两边的(有序)的数据按照规则填充到temp数组</span></span><br><span class="line"><span class="comment">//直到左右两边的有序序列，有一边处理完毕为止</span></span><br><span class="line"><span class="keyword">while</span>(i &lt;= mid &amp;&amp; j &lt;= right) &#123;  <span class="comment">//继续</span></span><br><span class="line"><span class="comment">//如果左边的有序序列的当前元素，小于等于右边有序序列的当前元素</span></span><br><span class="line"><span class="comment">//即将左边的当前元素，拷贝到temp数组</span></span><br><span class="line"><span class="comment">//然后</span></span><br><span class="line"><span class="keyword">if</span>(arr[i] &lt;= arr[j]) &#123;</span><br><span class="line">temp [t] = arr[i];</span><br><span class="line">t += <span class="number">1</span>;</span><br><span class="line">i += <span class="number">1</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//反之，将右边的有序序列的当前元素，填充到temp数组</span></span><br><span class="line">temp[t] = arr[j];</span><br><span class="line">t += <span class="number">1</span>;</span><br><span class="line">j += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//(2) 把有剩余数据的一边的数据依次全部填充到temp</span></span><br><span class="line"><span class="keyword">while</span>(i &lt;= mid) &#123; <span class="comment">//左边的有序序列还有剩余的元素，就全部填充到temp</span></span><br><span class="line">temp[t]  = arr[i];</span><br><span class="line">t += <span class="number">1</span>;</span><br><span class="line">i += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(j &lt;= right) &#123; <span class="comment">//右边的有序序列还有剩余的元素，就全部填充到temp中</span></span><br><span class="line">temp[t] = arr[j];</span><br><span class="line">t += <span class="number">1</span>;</span><br><span class="line">j += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//(3)将temp数组的元素拷贝到arr</span></span><br><span class="line"><span class="comment">//注意，并非每次都拷贝所有</span></span><br><span class="line"> t = <span class="number">0</span>;</span><br><span class="line"> <span class="type">int</span> <span class="variable">tempLeft</span> <span class="operator">=</span> left;</span><br><span class="line"> System.out.println(<span class="string">&quot;tempLeft=&quot;</span> + tempLeft + <span class="string">&quot;,right=&quot;</span> + right);</span><br><span class="line"> <span class="keyword">while</span>(tempLeft &lt;= right) &#123;  </span><br><span class="line"> <span class="comment">////第一次合并tempLeft = 0,right = 1// tempLeft = 2  right = 3;// tL = 0,right = 3</span></span><br><span class="line"> <span class="comment">//最后一次，tL = 0,right = 7;</span></span><br><span class="line"> arr[tempLeft] = temp[t];</span><br><span class="line"> t += <span class="number">1</span>;</span><br><span class="line"> tempLeft += <span class="number">1</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在经过时间测试我们发现其速度很快。</p><h4 id="7-3-7-基数排序"><a href="#7-3-7-基数排序" class="headerlink" title="7.3.7 基数排序"></a>7.3.7 基数排序</h4><ol><li>基数排序属于一种分配式排序，又称为桶子法，bin sort ，顾名思意，是通过键值的各个位的值，将要排序的元素分配到某些桶中，达到排序的作用。</li><li>基数排序是一种稳定的排序，基数排序法的是效率高的稳定性排序法</li><li>基数排序是桶排序的扩展</li><li>基数排序起源于1887年赫尔曼.何乐礼发明的，将整数按照位数切割成不同的数字，然后按每个位数分别比较。</li><li>所有待比较数值统一为同样的数位长度，<strong>数位较短的数前面补零</strong>。然后，<strong>从最低位开始</strong>，依次进行一次排序。这样从<strong>最低位排序一直到最高位排序完成以后</strong>, 数列就变成一个有序序列 </li></ol><p>思路：</p><ol><li>使用基数排序，进行升序排序</li><li>将每个元素的各位数取出，然后看这个数应该放在哪个对应的桶</li><li>按照这个桶的顺序(一维数组的下标取出数据，放入原来数组）</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RadixSort</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">int</span>[] arr=&#123;<span class="number">53</span>, <span class="number">3</span>, <span class="number">542</span>, <span class="number">748</span>, <span class="number">14</span>, <span class="number">214</span>&#125;;</span><br><span class="line">bucketSort(arr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">bucketSort</span><span class="params">(<span class="type">int</span>[] arr)</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个一维数组，得到每个下标下的个数</span></span><br><span class="line"><span class="type">int</span>[] bucketRecord=<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>];</span><br><span class="line"><span class="comment">//定义桶空间，初始化二维数组</span></span><br><span class="line"><span class="type">int</span>[][] bucket=<span class="keyword">new</span> <span class="title class_">int</span>[arr.length][<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="comment">//个位数的下标</span></span><br><span class="line"><span class="type">int</span> sub=arr[i]/<span class="number">1</span>%<span class="number">10</span>;</span><br><span class="line"><span class="comment">//给桶里面赋值</span></span><br><span class="line">bucket[bucketRecord[sub]][sub]=arr[i];</span><br><span class="line"><span class="comment">//并且记录当前桶里面元素个数，加1</span></span><br><span class="line">bucketRecord[sub]= bucketRecord[sub]+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//排列各个桶，从第一列开始</span></span><br><span class="line"><span class="comment">//第1轮</span></span><br><span class="line"><span class="type">int</span> index=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; bucketRecord.length; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (bucketRecord[i]&gt;<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; bucketRecord[i]; j++) &#123;</span><br><span class="line">arr[index++]=bucket[j][i];</span><br><span class="line">bucket[j][i]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">bucketRecord[i]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">index=<span class="number">0</span>;</span><br><span class="line">System.out.println(<span class="string">&quot;第1次排序后得到的结果：&quot;</span>+ Arrays.toString(arr));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//第2轮</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="comment">//十位数的下标</span></span><br><span class="line"><span class="type">int</span> sub=arr[i]/<span class="number">10</span>%<span class="number">10</span>;</span><br><span class="line"><span class="comment">//给桶里面赋值</span></span><br><span class="line">bucket[bucketRecord[sub]][sub]=arr[i];</span><br><span class="line"><span class="comment">//并且记录当前桶里面元素个数，加1</span></span><br><span class="line">bucketRecord[sub]= bucketRecord[sub]+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//排列各个桶，从第一列开始</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; bucketRecord.length; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (bucketRecord[i]&gt;<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; bucketRecord[i]; j++) &#123;</span><br><span class="line">arr[index++]=bucket[j][i];</span><br><span class="line">bucket[j][i]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">bucketRecord[i]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">index=<span class="number">0</span>;</span><br><span class="line">System.out.println(<span class="string">&quot;第2次排序后得到的结果：&quot;</span>+ Arrays.toString(arr));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//第3轮</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="comment">//百位数的下标</span></span><br><span class="line"><span class="type">int</span> sub=arr[i]/<span class="number">100</span>%<span class="number">10</span>;</span><br><span class="line"><span class="comment">//给桶里面赋值</span></span><br><span class="line">bucket[bucketRecord[sub]][sub]=arr[i];</span><br><span class="line"><span class="comment">//并且记录当前桶里面元素个数，加1</span></span><br><span class="line">bucketRecord[sub]= bucketRecord[sub]+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//排列各个桶，从第一列开始</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; bucketRecord.length; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (bucketRecord[i]&gt;<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; bucketRecord[i]; j++) &#123;</span><br><span class="line">arr[index++]=bucket[j][i];</span><br><span class="line">bucket[j][i]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">bucketRecord[i]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">index=<span class="number">0</span>;</span><br><span class="line">System.out.println(<span class="string">&quot;第3次排序后得到的结果：&quot;</span>+ Arrays.toString(arr));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用for循环：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RadixSort2</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">int</span>[] arr=&#123;<span class="number">53</span>, <span class="number">3</span>, <span class="number">542</span>, <span class="number">78</span>, <span class="number">14</span>, <span class="number">214</span>,<span class="number">12</span>,<span class="number">24</span>,<span class="number">56</span>,<span class="number">66</span>,<span class="number">70</span>&#125;;</span><br><span class="line">bucket(arr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">maxLength</span><span class="params">(<span class="type">int</span>[] arr)</span>&#123;</span><br><span class="line"><span class="type">int</span> max=arr[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (max&lt;arr[i])&#123;</span><br><span class="line">max=arr[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> length=(max+<span class="string">&quot;&quot;</span>).length();</span><br><span class="line"><span class="keyword">return</span> length;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">bucket</span><span class="params">(<span class="type">int</span>[] arr)</span>&#123;</span><br><span class="line"><span class="comment">//定义一个二维数组作为桶</span></span><br><span class="line"><span class="type">int</span>[][] bucket=<span class="keyword">new</span> <span class="title class_">int</span>[arr.length][<span class="number">10</span>];</span><br><span class="line"><span class="comment">//每一个桶里面有几个元素</span></span><br><span class="line"><span class="type">int</span>[] bucketRecord=<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>];</span><br><span class="line"><span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> maxLength(arr);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">z</span> <span class="operator">=</span> <span class="number">0</span>, n=<span class="number">1</span>; z &lt; length; n=n*<span class="number">10</span>,z++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="comment">//个位数的下标</span></span><br><span class="line"><span class="type">int</span> sub=arr[i]/n%<span class="number">10</span>;</span><br><span class="line"><span class="comment">//给桶里面赋值</span></span><br><span class="line">bucket[bucketRecord[sub]][sub]=arr[i];</span><br><span class="line"><span class="comment">//并且记录当前桶里面元素个数，加1</span></span><br><span class="line">bucketRecord[sub]= bucketRecord[sub]+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//排列各个桶，从第一列开始</span></span><br><span class="line"><span class="type">int</span> index=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; bucketRecord.length; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (bucketRecord[i]&gt;<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; bucketRecord[i]; j++) &#123;</span><br><span class="line">arr[index++]=bucket[j][i];</span><br><span class="line">bucket[j][i]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">bucketRecord[i]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;第&quot;</span>+z+<span class="string">&quot;次排序后得到的结果：&quot;</span>+Arrays.toString(arr));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>基数排序是对传统桶排序的扩展，<strong>速度很快</strong>.</p><p> 基数排序是经典的空间换时间的方式，<strong>占用内存很大</strong>, 当对海量数据排序时，容易造<strong>OutOfMemoryError</strong> 基数排序<strong>时稳定的</strong>。</p><p>[注:假定在待排序的记录序列中，存在多个具有相同的关键字的记录，若经过排序，这些记录的相对次序保持不变，即在原序列中，r[i]=r[j]，且r[i]在r[j]之前，而在排序后的序列中，r[i]仍在r[j]之前，则称这种排序算法是稳定的；否则称为不稳定的] 有负数的数组 </p><h4 id="7-3-8-堆排序"><a href="#7-3-8-堆排序" class="headerlink" title="7.3.8 堆排序"></a>7.3.8 堆排序</h4><h2 id="8-查找"><a href="#8-查找" class="headerlink" title="8. 查找"></a>8. 查找</h2><h3 id="8-1-线性查找"><a href="#8-1-线性查找" class="headerlink" title="8. 1 线性查找"></a>8. 1 线性查找</h3><p>很简单的查找方式,通过逐一比对，得到目标值，然后呢返回下标</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SeqSearch</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String [] args)</span>&#123;</span><br><span class="line">        <span class="type">int</span> [] arr = &#123;<span class="number">7</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">11</span>,<span class="number">434</span>,<span class="number">55</span>,<span class="number">0</span>,<span class="number">23</span>&#125;;</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> seqSearch(arr,<span class="number">55</span>);</span><br><span class="line">        <span class="keyword">if</span>(index == -<span class="number">1</span>)&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;没有查找到&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;找到了，下标为：&quot;</span> + index);</span><br><span class="line">System.out.println(<span class="string">&quot;此时输出的结果为：&quot;</span> + arr[index]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">seqSearch</span><span class="params">(<span class="type">int</span> [] arr ,<span class="type">int</span> value)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; arr.length ; i ++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(value == arr[i])&#123;</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-2-二分查找"><a href="#8-2-二分查找" class="headerlink" title="8.2 二分查找"></a>8.2 二分查找</h3><ol><li>确定数中间的下标 mid = (right + left) / 2;</li><li>然后让需要查找的数findValue和arr[mid] 比较<ol><li>findVal &gt; arr[mid]，说明你要查找的数，在mid的右边，因此需要递归的向右查找</li><li>如果findVal &lt; arr[mid],说明你要查找的数在mid的左边，因此需要递归的向左边查找</li><li>findVal == arr[mid] 说明找到，就返回</li></ol></li><li>什么时候我们需要结束递归<ol><li>找到就结束递归</li><li>递归完整整个数组，仍然没有找到findVal，也需要结束递归，当left &gt; right就需要退出</li></ol></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BinarySearch</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">int</span> [] arr = &#123;<span class="number">1</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">24</span>,<span class="number">56</span>,<span class="number">78</span>&#125;;</span><br><span class="line"><span class="type">int</span> <span class="variable">resIndex</span> <span class="operator">=</span> binarySearch(arr, <span class="number">0</span>, arr.length -<span class="number">1</span>, <span class="number">78</span>);</span><br><span class="line"><span class="keyword">if</span>(resIndex == -<span class="number">1</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;此时没找到&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;找到了，其下标为：&quot;</span> + resIndex);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//二分查找算法</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> arr 数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> left  左边的索引</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> right 右边的索引</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> findVal 要查询的值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 如果杂找到就返回下标，如果没找到就返回-1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearch</span><span class="params">(<span class="type">int</span> [] arr ,<span class="type">int</span> left,<span class="type">int</span> right,<span class="type">int</span> findVal)</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这里有个bug ，如果找不到值，那么递归就不会种植导致异常</span></span><br><span class="line"><span class="keyword">if</span>(left &gt; right) &#123;</span><br><span class="line"><span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (left + right) / <span class="number">2</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">midVal</span> <span class="operator">=</span> arr[mid];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(findVal &gt; midVal) &#123;  <span class="comment">//向右递归</span></span><br><span class="line"><span class="keyword">return</span> binarySearch(arr, mid +<span class="number">1</span>, right, findVal);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(findVal &lt; midVal)&#123; <span class="comment">//向左递归</span></span><br><span class="line"><span class="keyword">return</span> binarySearch(arr, left, mid - <span class="number">1</span>, findVal);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> mid;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>例题：</p><p>当一个有序数组中，有多个相同的数据时，如果将所有的数值都查找到，比如这里的1000</p><p>arr={12,23,34,44,45,46,46,46,47,48};</p><ol><li>在找到mid索引值，不要马上返回</li><li>向mid索引值的左边扫描，将所有满足46的元素的下标，加入到arrayList</li><li>向mid索引值的右边扫描，将所有满足46的元素的下标，加入到arrayList</li><li>将ArrayList返回</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BinarySearch</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">int</span> [] arr = &#123;<span class="number">1</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">12</span>,<span class="number">24</span>,<span class="number">56</span>,<span class="number">78</span>&#125;;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">int resIndex = binarySearch(arr, 0, arr.length -1, 12);</span></span><br><span class="line"><span class="comment">if(resIndex == -1) &#123;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;此时没找到&quot;);</span></span><br><span class="line"><span class="comment">&#125;else &#123;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;找到了，其下标为：&quot; + resIndex);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">BinarySearch2(arr, <span class="number">0</span>, arr.length -<span class="number">1</span>, <span class="number">12</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//二分查找算法</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> arr 数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> left  左边的索引</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> right 右边的索引</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> findVal 要查询的值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 如果杂找到就返回下标，如果没找到就返回-1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearch</span><span class="params">(<span class="type">int</span> [] arr ,<span class="type">int</span> left,<span class="type">int</span> right,<span class="type">int</span> findVal)</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这里有个bug ，如果找不到值，那么递归就不会种植导致异常</span></span><br><span class="line"><span class="keyword">if</span>(left &gt; right) &#123;</span><br><span class="line"><span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (left + right) / <span class="number">2</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">midVal</span> <span class="operator">=</span> arr[mid];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(findVal &gt; midVal) &#123;  <span class="comment">//向右递归</span></span><br><span class="line"><span class="keyword">return</span> binarySearch(arr, mid +<span class="number">1</span>, right, findVal);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(findVal &lt; midVal)&#123; <span class="comment">//向左递归</span></span><br><span class="line"><span class="keyword">return</span> binarySearch(arr, left, mid - <span class="number">1</span>, findVal);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> mid;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查找有多个相同数值的全部返回</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">BinarySearch2</span><span class="params">(<span class="type">int</span>[] array,<span class="type">int</span> left,<span class="type">int</span> right, <span class="type">int</span> value)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (left + right)/<span class="number">2</span>;</span><br><span class="line">ArrayList&lt;Integer&gt; resIndexlist = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(value &lt; array[mid]) &#123;</span><br><span class="line">BinarySearch2(array,left,mid-<span class="number">1</span>,value);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(value &gt; array[mid]) &#123;</span><br><span class="line">BinarySearch2(array,mid+<span class="number">1</span>,right,value);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(mid);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> mid -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(temp &lt; <span class="number">0</span> ||array[temp]!= value) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">resIndexlist.add(temp);</span><br><span class="line">temp--;</span><br><span class="line">&#125;</span><br><span class="line">resIndexlist.add(mid);</span><br><span class="line"></span><br><span class="line">temp = mid + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(array[temp]!= value || temp &gt; array.length-<span class="number">1</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">resIndexlist.add(temp);</span><br><span class="line">temp++;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">System.out.println(resIndexlist.toString());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//return resIndexlist.toString();</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="8-3-差值查找"><a href="#8-3-差值查找" class="headerlink" title="8.3  差值查找"></a>8.3  差值查找</h3><p>差值查找算法是在二分查找算法的基础上进行进一步进行的，其是在二分查找的基础上做了一点小小的优化，其基本思路是将原先公式1的方式变成公式2的方式，由于其取中点值的方式不同，造成其效率也不同，</p><script type="math/tex; mode=display">公式1 ： mid = (low+hight)/2 = low + (hight - low)/2</script><script type="math/tex; mode=display">公式2： mid = low + (high - low)*( (key - a[low]))/(a[hight] - a[low])</script><p>由于二分查找需要的条件将数组进行有序排列，故而再在此low代表左边，hight代表右边。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InterpolationSearch</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;======== 差值查找分布略微不均匀数组 ===========&quot;</span>);</span><br><span class="line"><span class="type">int</span> arr[] = &#123;<span class="number">1</span> ,<span class="number">4</span>, <span class="number">9</span>, <span class="number">15</span>, <span class="number">27</span>, <span class="number">49</span>, <span class="number">128</span>, <span class="number">157</span>&#125;;</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> interpolationSearch(arr, <span class="number">9</span>, <span class="number">0</span>, arr.length - <span class="number">1</span>);</span><br><span class="line">System.out.println(result==-<span class="number">1</span>?<span class="string">&quot;未找到元素！&quot;</span>:<span class="string">&quot;查找成功！&quot;</span> + <span class="number">9</span> + <span class="string">&quot;对应下标： &quot;</span> + result);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;======== 差值查找分布均匀数组 ===========&quot;</span>);</span><br><span class="line"><span class="type">int</span> arr1[] = &#123;<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">18</span> ,<span class="number">20</span>&#125;;</span><br><span class="line"><span class="type">int</span> <span class="variable">target</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">result1</span> <span class="operator">=</span> interpolationSearch(arr1, target, <span class="number">0</span>, arr1.length - <span class="number">1</span>);</span><br><span class="line">System.out.println(result1==-<span class="number">1</span>?<span class="string">&quot;未找到元素！&quot;</span>:<span class="string">&quot;查找成功！&quot;</span> + target + <span class="string">&quot;对应下标： &quot;</span> + result1);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;======== 差值查找分布极其不均匀数组 ===========&quot;</span>);</span><br><span class="line"><span class="type">int</span> arr2[] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>,<span class="number">99999</span>&#125;;</span><br><span class="line"><span class="type">int</span> <span class="variable">target2</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">result2</span> <span class="operator">=</span> interpolationSearch(arr2, target2, <span class="number">0</span>, arr2.length - <span class="number">1</span>);</span><br><span class="line">System.out.println(result2==-<span class="number">1</span>?<span class="string">&quot;未找到元素！&quot;</span>:<span class="string">&quot;查找成功！&quot;</span> + target2 + <span class="string">&quot;对应下标： &quot;</span> + result2);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">interpolationSearch</span><span class="params">(<span class="type">int</span> []arr, <span class="type">int</span> target ,<span class="type">int</span> left , <span class="type">int</span> right)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(target &lt; arr[left] || target &gt; arr[right] || left &gt; right) &#123;</span><br><span class="line"><span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">leftToTarget</span> <span class="operator">=</span> target - arr[left];</span><br><span class="line"><span class="type">int</span> <span class="variable">rightToLeft</span> <span class="operator">=</span> arr[right] - arr[left];</span><br><span class="line"><span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> right - left;</span><br><span class="line"><span class="comment">//中间的值的下标，注意此行与二分查找的区别</span></span><br><span class="line"><span class="type">int</span> <span class="variable">mid</span>  <span class="operator">=</span> left + (leftToTarget * num) /rightToLeft;</span><br><span class="line">System.out.println(<span class="string">&quot;找了一次，中间值为：&quot;</span> + mid);</span><br><span class="line"><span class="comment">//目标值小于中间值， 取得左侧</span></span><br><span class="line"><span class="keyword">if</span>(arr[mid] &gt; target &amp;&amp; left &lt;= right) &#123;</span><br><span class="line"><span class="comment">//递归左侧</span></span><br><span class="line"><span class="keyword">return</span> interpolationSearch(arr, target, left, mid - <span class="number">1</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(arr[mid] &lt; target &amp;&amp; left &lt;= right) &#123;</span><br><span class="line"><span class="comment">//目标值大于中间的值取得右侧，并且递归</span></span><br><span class="line"><span class="keyword">return</span> interpolationSearch(arr, target, mid + <span class="number">1</span>, right);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//不大于也不小于 则是等于</span></span><br><span class="line"><span class="keyword">return</span> mid;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-4-斐波那契查找"><a href="#8-4-斐波那契查找" class="headerlink" title="8.4 斐波那契查找"></a>8.4 斐波那契查找</h3><p>斐波那契查找算法，又被称为黄金分割法，是一种有序的查找算法。斐波那契数列被称为黄金分割数列，其数列如： 1,1,2,3,5,8,13,31…….。在数学上，其递归方法被定义为</p><script type="math/tex; mode=display">F(n) = F(n-1) + F(n - 2) (n>=2).</script><p>该数列越往后的两个数的比值趋向于黄金比例0.618</p><p><strong>斐波那契查找是在二分查找的基础上根据斐波那契数列进行分割</strong>。在斐波那契数列找一个等于大于查找表中元素个数的数F(n),将原查找表扩展为长度为F(n)(如果要补充元素，则补充重复最后一个元素，直到满足F(n)个元素)，完成后进行斐波那契分割，<strong>即F[n]个元素分割为前半部分F(n-1)个元素，后半部分F(n-2)个元素，找出要查找的元素在那一部分并递归</strong>，直到找到。<strong>斐波那契查找的时间复杂度是O(log2n)</strong>。 </p><blockquote><p>1）由斐波那契数列 F[k]=F[k-1]+F[k-2] 的性质，可以得到 （F[k]-1）=（F[k-1]-1）+（F[k-2]-1）+1 。该式说明：只要顺序表的长度为F[k]-1，则可以将该表分成长度为F[k-1]-1和F[k-2]-1的两段，即如上图所示。从而中间位置为mid=low+F(k-1)-1；</p><p>2）每一子段也可以用相同的方式分割； </p><p>3）若顺序表长度n不一定刚好等于F[k]-1，则需要将原来的顺序表长度n增加至F[k]-1。这里的k值只要能使得F[k]-1恰好大于或等于n即可。 </p></blockquote><p>例如：原数组为{1,5,6,33,55,233,455}，长度n为7，若 F[ k ] - 1等于9，则应该将原数组扩容到9，多出的位置使用high位置的455填充，即得到{1,5,6,33,55,233,455,455,455}。 </p><p>代码实现</p><blockquote><p>（1）我们需要先递归实现斐波拉契数列，然后根据原数组的大小计算斐波拉契数列的k值； </p><p>（2）数组扩容条件是：<strong>增大 k 值（索引从 0 开始），使得数组长度刚好大于或者等于斐波那契数列中的 F[k]-1 ，我们定义临时数组 temp ，temp 后面为 0 的元素都按照数组最大元素值填充</strong>；</p><p> （3）mid值的确定：<strong>mid = low + f[k - 1] - 1</strong> ，即用黄金分割点确定 mid 的值； </p><p>（4）<strong>value&lt;temp[mid]</strong> ：目标值在黄金分割点的左边，因为全部元素 = 前面的元素 + 后边元素即 f[k] = f[k-1] + f[k-2]，又前面有 f[k-1]个元素,所以可以继续拆分 f[k-1] = f[k-2] + f[k-3]，即下次循环有mid=low+f[k-1-1]+1，即需要<strong>k-=1</strong>； </p><p><strong>value&gt; temp[mid]</strong> ：目标值在黄金分割点的右边。因为全部元素 = 前面的元素 + 后边元素即 f[k] = f[k-1] + f[k-2]，又前面有 f[k-2]个元素,所以可以继续拆分 f[k-1] = f[k-3] + f[k-4]，即下次循环有mid=low+f[k-1-2]+1，即需要<strong>k-=2</strong>；</p><p> <strong>value== temp[mid] ：</strong>找到目标值，因为数组经历过扩容，后面的值其实有些是多余的，mid 可能会越界（相对于原数组来说）则有： 1）<strong>mid &lt;= high ：证明 mid 索引在原数组中，返回 mid</strong>； 2）<strong>mid &gt; high 时，证明 mid 索引已经越界（相对于原数组来说），返回 high</strong>； </p><p>（5）若没有找到则返回-1。 </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FibonacciSearch</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">int</span> arr[] = &#123;<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">33</span>,<span class="number">55</span>,<span class="number">233</span>,<span class="number">455</span>&#125;;</span><br><span class="line">Arrays.sort(arr); <span class="comment">//既然是二分查找衍生出来的，那么就需要先对数组排序，无论数组是否排好序，这样做总共是一种方式</span></span><br><span class="line"><span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">55</span>;<span class="comment">//要查找的值</span></span><br><span class="line"><span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> fibonacciSearch(arr, value);</span><br><span class="line">System.out.println(temp == -<span class="number">1</span> ? <span class="string">&quot;没找到你所要的值，可能你要查找的值并不在斐波那契数列之中,你要查找的值为:&quot;</span>+value :<span class="string">&quot;您查找的值为&quot;</span>+value+<span class="string">&quot;其下标为&quot;</span>+temp );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">maxSize</span> <span class="operator">=</span> <span class="number">20</span>; <span class="comment">//斐波那契数列的大小</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> [] fibonacci() &#123; <span class="comment">//构建一个斐波那契数列</span></span><br><span class="line"><span class="type">int</span>[] fib = <span class="keyword">new</span> <span class="title class_">int</span> [maxSize];</span><br><span class="line">fib[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">fib[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt; maxSize ; i++ ) &#123;</span><br><span class="line">fib[i] = fib[i - <span class="number">1</span>] + fib [i -<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> fib;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">fibonacciSearch</span><span class="params">(<span class="type">int</span> [] arr ,<span class="type">int</span> value )</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//指针low表示待查元素所在范围的下界，下界索引从0开始</span></span><br><span class="line"><span class="type">int</span> <span class="variable">high</span> <span class="operator">=</span> arr.length - <span class="number">1</span> ; <span class="comment">//指针high表示待查元素所在范围的上界</span></span><br><span class="line"><span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span> ;<span class="comment">// 表示斐波那契分割数值的下标</span></span><br><span class="line"><span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> fib[] = fibonacci(); <span class="comment">//获取到斐波那契数列</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(high &gt; fib[k] - <span class="number">1</span>) &#123;<span class="comment">//获取到斐波那契分割数值的下标</span></span><br><span class="line">k ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//因为f[k]值，可能大于a的长度，因此我们需要使用Arrays.copyOf方法，构造一个新的数组，并指向temp[]</span></span><br><span class="line"><span class="type">int</span> [] temp = Arrays.copyOf(arr, fib[k]);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> high + <span class="number">1</span>; i &lt; temp.length ; i++ ) &#123;</span><br><span class="line"><span class="comment">//使用arr数组最后的数填充temp</span></span><br><span class="line">temp[i] = arr[high];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(low &lt; high) &#123;</span><br><span class="line">mid = low + fib[k - <span class="number">1</span>] -<span class="number">1</span>; <span class="comment">//斐波那契中值公式</span></span><br><span class="line"><span class="keyword">if</span>(value &lt; temp[mid]) &#123;</span><br><span class="line"><span class="comment">//关键子值小于中间值，应该向左扫描即使high = mid - 1</span></span><br><span class="line">high = mid - <span class="number">1</span>;</span><br><span class="line">k -= <span class="number">1</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(value &gt; temp[mid]) &#123; <span class="comment">//关键字值大于中间值，应该向右扫描，即使low = mid + 1</span></span><br><span class="line">low = mid + <span class="number">1</span>;</span><br><span class="line">k -= <span class="number">2</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123; <span class="comment">//找到时需要返回哪个下标</span></span><br><span class="line"><span class="keyword">if</span>(mid &lt;= high) &#123; <span class="comment">//证明mid索引在原数组中，返回mid</span></span><br><span class="line"><span class="keyword">return</span> mid;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//证明mid索引已经越界（相对于原数组来说），返回high</span></span><br><span class="line"><span class="keyword">return</span> high;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> - <span class="number">1</span>; <span class="comment">//没有找到即返回 - 1</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">本文主要是笔者在学习java数据结构和算法的笔记</summary>
    
    
    
    <category term="java学习" scheme="https://www.blog.909111.xyz/categories/java%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="java学习" scheme="https://www.blog.909111.xyz/tags/java%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>安装纪录</title>
    <link href="https://www.blog.909111.xyz/posts/c0b97cce.html"/>
    <id>https://www.blog.909111.xyz/posts/c0b97cce.html</id>
    <published>2023-11-09T02:50:23.341Z</published>
    <updated>2023-11-09T02:50:23.341Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Vue安装和学习"><a href="#Vue安装和学习" class="headerlink" title="Vue安装和学习"></a>Vue安装和学习</h1><p><code>npm install</code></p><p><code>npm run  dev</code></p><h2 id="克隆项目"><a href="#克隆项目" class="headerlink" title="克隆项目"></a>克隆项目</h2><p>git clone <a href="https://github.com/daxiongYang/renren-fast-vue.git">https://github.com/daxiongYang/renren-fast-vue.git</a></p><h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><ol><li><p>npm install -g cnpm —registry=<a href="https://registry.npm.taobao.org">https://registry.npm.taobao.org</a></p></li><li><p>cnpm install</p></li></ol><h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><p>npm run dev</p><hr><p>项目配置  ：  1 链接数据库  开启虚拟机<br>               2 开启nocas<br>               3 开启 vue 后端管理界面 npm run dev<br>               4</p><p>vue 前端登录  admin admin </p><p>nacos  登录  nacos  nacos  </p><h2 id="Vue卸载"><a href="#Vue卸载" class="headerlink" title="Vue卸载"></a>Vue卸载</h2><blockquote><p>官方解释<br>关于旧版本</p><p>Vue CLI 的包名称由 vue-cli 改成了 @vue/cli。 如果你已经全局安装了旧版本的 vue-cli (1.x 或 2.x)，你需要先通过 npm uninstall vue-cli -g 或 yarn global remove vue-cli 卸载它。</p><p>这是vue-cli 3.0版本的卸载</p><p>小编之前没注意 每次卸载 不知道怎么回事老是卸载不了，因为小编一开始就安装的最新版本，几乎都是4.xx的</p><p>后来各种百度 终于知道了</p><p>//卸载3.0之前的版本<br><code>npm uninstall -g vue-cli</code><br><code>yarn global remove vue-cli</code></p><p>//卸载3.0之后的版本（可以统一使用此指令卸载）<br><code>npm uninstall -g @vue/cli</code><br><code>yarn global remove @vue/cli</code></p><p>安装<br>然后是安装，小编是看教程在学习 之前没注意版本号，各种对不上教程。终于注意到了 教程是3.3.0 也是各种百度 怎么都安装不上<br>之前百度到这个：</p><p>//安装2.9.6版本<br>npm install -g vue-cli@2.9.6<br>yarn global add vue-cli</p></blockquote><p>Vue模块化开发:</p><ol><li><p>```vue<br>npm install webpack -g</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    全局安装</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. ```</span><br><span class="line">   npm install -g @vue/cli-init</span><br></pre></td></tr></table></figure><p>全局安装vue脚手架</p></li><li><p>初始化vue项目</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue init webpack appname : <span class="type">vue</span> 脚手架使用webpack模块初始化一个appname(自己定义的)项目</span><br></pre></td></tr></table></figure></li><li><p><code>cd vue-demo</code></p></li><li><p><code>npm run dev</code></p></li></ol><h2 id="vue引入Element-ui获取最新版本的资源，在页面上引入js和css文件即可开始使用"><a href="#vue引入Element-ui获取最新版本的资源，在页面上引入js和css文件即可开始使用" class="headerlink" title="vue引入Element-ui获取最新版本的资源，在页面上引入js和css文件即可开始使用"></a>vue引入Element-ui获取最新版本的资源，在页面上引入js和css文件即可开始使用</h2><blockquote><p>npm  i element-ui -s</p></blockquote><p>然后main.js导入</p><p><code>import ElementUI from &#39;element-ui&#39;</code>   //导入vue前端Element框架</p><p><code>import &#39;element-ui/lib/theme-chalk/index.css&#39;;</code></p><p>Vue.use(ElementUI); </p><p><code>alt + shift + f自动对齐（VSCode）</code></p><h1 id="Docker安装和相关配置"><a href="#Docker安装和相关配置" class="headerlink" title="Docker安装和相关配置"></a>Docker安装和相关配置</h1><p>在安装docker之前我们需要准备yum工具</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils \</span><br><span class="line">           device-mapper-persistent-data \</span><br><span class="line">           lvm2 --skip-broken</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>更新本地镜像源</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置docker镜像源</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">    </span><br><span class="line">sed -i &#x27;s/download.docker.com/mirrors.aliyun.com\/docker-ce/g&#x27; /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"></span><br><span class="line">yum makecache fast</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>之后输入安装docker命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y docker-ce</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>关闭防火墙</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">关闭</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">禁止开机启动防火墙</span></span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure><p>通过命令启动docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker  # 启动docker服务</span><br><span class="line"></span><br><span class="line">systemctl stop docker  # 停止docker服务</span><br><span class="line"></span><br><span class="line">systemctl restart docker  # 重启docker服务</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="配置镜像加速"><a href="#配置镜像加速" class="headerlink" title="配置镜像加速"></a>配置镜像加速</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">您可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器</span><br><span class="line"></span><br><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://vwesipli.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>s</p><blockquote><p>docker -v  —查看docker版本<br>docker images —查看当前docker运行<br>sudo systemctl start docker —启动docker 在虚拟机里边<br>docker images  —有时候权限不足   我们变为  sudo  docker images 检查我们虚拟机里边有无下载镜像<br>sudo systemctl enable docker      —设置开机自启动<br>docker 配置镜像加速<br>1        sudo mkdir -p /etc/docker<br>2        sudo tee /etc/docker/daemon.json &lt;&lt;-‘EOF’<br>        {<br>        “registry-mirrors”: [“<a href="https://dcyzi7af.mirror.aliyuncs.com">https://dcyzi7af.mirror.aliyuncs.com</a>“]<br>        }<br>        EOF<br>3        sudo systemctl daemon-reload<br>4        sudo systemctl restart docker</p><p>docker指令安装mysql<br>1    sudo docker pull mysql  —安装最新的mysql<br>2    sudo docker pull mysql:版本号   我使用的是 mysql 8.0.2 —安装指定的版本号</p><h3 id="启动安装的镜像"><a href="#启动安装的镜像" class="headerlink" title="启动安装的镜像"></a>启动安装的镜像</h3><p>比如启动 mysql:<br>docker run -p 3306:3306 —name mysql \<br> -v /mydata/mysql/log:/var/log/mysql \<br> -v /mydata/mysql/data:/var/lib/mysql \<br> -v /mydata/mysql/conf:/etc/mysql \<br> -e MYSQL_ROOT_PASSWORD=a \<br> -d mysql:5.7</p></blockquote><p>运行mysql:</p><blockquote><p> docker run -p 3306:3306 —name mysql \</p><p>  -v /mydata/mysql/log:/var/log/mysql \<br>  -v /mydata/mysql/data:/var/lib/mysql \<br>  -v /mydata/mysql/conf:/etc/mysql \<br>  -e MYSQL_ROOT_PASSWORD=a \ </p><h2 id="d-mysql-5-7"><a href="#d-mysql-5-7" class="headerlink" title="  -d mysql:5.7"></a>  -d mysql:5.7</h2><pre><code>上边是mysql5.7的启动方式-d 代表以后台方式运行</code></pre><h2 id="p-3306-3306-将容器的3306端口映射到主机的3306"><a href="#p-3306-3306-将容器的3306端口映射到主机的3306" class="headerlink" title="-p 3306:3306 将容器的3306端口映射到主机的3306"></a>-p 3306:3306 将容器的3306端口映射到主机的3306</h2><pre><code>    -p 3306：3306； 将容器的3306端口映射到主机的3306端口    -v/mydata/mysgl/conf:/etc/mysgl  ：将配置文件夫挂载到主机    -v/mydata/mysgl/log:/var/log/mysgl  ：将日志文件夹挂载到主机    -w/mydata/mysgl/data:/var/lib/mysgl/  ，将配置文件夹挂载到主机    -e MYSQL_ROOT_PASSWORD=root           ：初始化root用户的密码</code></pre><hr><p> 有时候切换权限麻烦 所有我们切换到<br> su root   —权限最高<br> docker ps —查看当前docker正在运行中的程序</p><p> docker run -dit -p 3306:3306 mysql:8.0.2 bash  —启动mysql 8.0.2</p><p> service mysql status     —查看mysql的状态<br> service mysql start      —启动mys</p><p> docker exec -it mysql /bin/bash  —进入mysql内部</p><p> whereis mysql<br>        mysql: /usr/bin/mysql /usr/lib64/mysql /usr/share/mysql  /usr/share/man/man1/mysql.1.gz</p><hr></blockquote><p>docoker指令</p><blockquote><p>一、查看容器，复制容器id 即container id<br>docker ps -a<br>二、停止容器<br>docker stop 你的容器id<br>三、删除容器<br>docker rm 容器id<br>四、查看镜像，复制镜像id即images id<br>docker images<br>五。删除镜像</p><p>docker rmi 镜像id</p><p>这是我装的<br>Mysql8.0安装</p><p>1、拉取mysql镜像</p><p>docker pull mysql:8.0</p><p>2.docker run -p 3306:3306 —name mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql</p><p>docker run -p 3306:3306 —name mysql -e MYSQL_ROOT_PASSWORD=a -d mysql</p><p>3.docker exec -it mysql /bin/bash</p><p>4.mysql -uroot -p123456</p><p>5.use mysql;</p><p>6.ALTER USER ‘root’@’%’ IDENTIFIED BY ‘123456’ PASSWORD EXPIRE NEVER;</p><p>7.ALTER USER ‘root’@’%’ IDENTIFIED WITH mysql_native_password BY ‘123456’;</p><p>8.FLUSH PRIVILEGES;</p><p>9.修改密码<br>mysqladmin -uroot -p旧密码 password 新密码   —密码为 123456<br>注意一下我装的虚拟机端口号mysql为 3307</p><p>29adbe537c3e   mysql     “docker-entrypoint.s…”   52 minutes ago   Up 52 minutes   33060/tcp, 0.0.0.0:3307-&gt;3306/tcp, :::3307-&gt;3306/tcp   mysql</p><hr><p>首先进入</p><p>1、docker exec -it mysql bash      //mysql是mysql容器的别名</p><p>2、mysql -uroot -p</p><p>3、输入密码</p><p>4、进入mysql&gt;命令行界面</p><p>1,容器中登录mysql,查看mysql的版本</p><p>mysql&gt; status;</p><hr><p>mysql  Ver 8.0.11 for Linux on x86_64 (MySQL Community Server - GPL)</p><p>2,进行授权远程连接(注意mysql 8.0跟之前的授权方式不同)</p><p>授权</p><p>GRANT ALL ON <em>.</em> TO ‘root’@’%’;</p><p>刷新权限</p><p>flush privileges;</p><p>此时,还不能远程访问,因为Navicat只支持旧版本的加密,需要更改mysql的加密规则</p><p>3,更改加密规则</p><p>ALTER USER ‘root’@’localhost’ IDENTIFIED BY ‘a’ PASSWORD EXPIRE NEVER;</p><p>4,更新root用户密码</p><p>ALTER USER ‘root’@’%’ IDENTIFIED WITH mysql_native_password BY ‘a’;</p><p>刷新权限</p><p>flush privileges;</p><p>OK，设置完成，再次使用 Navicat 连接数据库</p></blockquote><h3 id="下载redis"><a href="#下载redis" class="headerlink" title="下载redis"></a>下载redis</h3><p><code>docker pull redis</code></p><p>创建实例并启动<br><code>mkdir -p /mydata/redis/conf</code> </p><p><code>touch redis.conf</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 6379:6379 --name redis -v /mydata/redis/data:/data \</span><br><span class="line"></span><br><span class="line">   -v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line"></span><br><span class="line">   -d redis redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure><p> ls   查看当前文件夹下的文件<br><code>cat redis.conf</code></p><p> 测试redis </p><p> <code>docker exec -it redis redis-cli</code></p><hr><p> 由于以前的数据全存在内存中，从而我们重复读取get a的时候会导致失败<br>[root@localhost conf]# <code>cat redis.conf</code><br>[root@localhost conf]# <code>docker exec -it redis redis-cli</code><br>127.0.0.1:6379&gt;<code>set a b</code><br>OK<br>127.0.0.1:6379&gt; <code>get a</code><br>“b”   //从而在一次上来的时候这块是null<br>127.0.0.1:6379&gt; exit</p><p>—让redis 持久化  —-&gt; pwd<br>127.0.0.1:6379&gt; exit<br>[root@localhost conf]# <code>pwd</code><br>/mydata/redis/conf<br>[root@localhost conf]# <code>ls</code><br>redis.conf<br>[root@localhost conf]# <code>vi redis.conf</code><br>按  <code>i</code><br>输入<code>appendonly yes</code><br>按<code>esc</code>  输入<code>:wq</code></p><p><code>docker restart redis  //重启redis</code><br>—设置开机自启动docker 里边容器<br><code>sudo docker update &lt;容器名&gt; --restart=always</code></p><h1 id="Linux指令"><a href="#Linux指令" class="headerlink" title="Linux指令"></a>Linux指令</h1><p>whoami  —谁的账号</p><p>ls /    ——查看的当前运行的</p><p>~ 当前用户目录   /根目录    . 当前目录   .. 上一级目录<br>$ 当前目录   # root  用户目录<br>创建目录 ： mkdir &lt;目录名&gt;<br>删除目录 ： rmdir &lt;目录名&gt;<br>删除 ： rm  -rf  &lt;目录或文件&gt;<br>移动 ： mv<br>创建文件：touch<br>打开文件： vi  进入文件编辑后 按ESC 然后输入：wq存并退出  ：q,不保存退出<br>查看文件内容 ： cat  </p><p>exit;   —- 退出</p><p> whoamis —当前是什么用户在使用</p><p> whereis mysql   —查看应用安装的目录 格式：  whereis 应用名 </p><p>权限  二进制<br> r(4 100)  w(2  010)  x(1 001) 读 写 执行<br>chmod 授权给  例如 chmod  775  software</p><p>//安装ssh<br>sudo apt-get install openssh-server  sudo spt-get install ssh</p><h1 id="我的Spring-Cloud的项目配置文件指令："><a href="#我的Spring-Cloud的项目配置文件指令：" class="headerlink" title="我的Spring Cloud的项目配置文件指令："></a>我的Spring Cloud的项目配置文件指令：</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-machine -s &quot;E:\SoftWaves\dicker&quot; create --engine-registry-mirror=https://dcyzi7af.mirror.aliyuncs.com -d virtualbox default</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 6379:6379 redis:latest</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --hostname navy-rabbit -p 5672:5672 -p 15672:15672 rabbitmq:3.8.8-management</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">浏览器输入ip地址，进入rabbit管理界面： 192.168.99.100:15672</span><br></pre></td></tr></table></figure><p>rabbit 账号密码： guest  guest</p>]]></content>
    
    
    <summary type="html">安装运行环境和软件的相关纪录</summary>
    
    
    
    <category term="错误记录" scheme="https://www.blog.909111.xyz/categories/%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="踩坑记录" scheme="https://www.blog.909111.xyz/tags/%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>Hexo的启动方式</title>
    <link href="https://www.blog.909111.xyz/posts/9b1154cd.html"/>
    <id>https://www.blog.909111.xyz/posts/9b1154cd.html</id>
    <published>2023-11-09T02:50:23.341Z</published>
    <updated>2023-11-09T02:50:23.341Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br><span class="line"></span><br><span class="line">hexo clean &amp;&amp; hexo generate &amp;&amp; hexo deploy  // Git BASH终端</span><br><span class="line">hexo clean; hexo generate; hexo deploy  // VSCODE终端</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">hexo的启动方式</summary>
    
    
    
    <category term="演示" scheme="https://www.blog.909111.xyz/categories/%E6%BC%94%E7%A4%BA/"/>
    
    
    <category term="演示" scheme="https://www.blog.909111.xyz/tags/%E6%BC%94%E7%A4%BA/"/>
    
  </entry>
  
  <entry>
    <title>java基础面试题</title>
    <link href="https://www.blog.909111.xyz/posts/df71ed7b.html"/>
    <id>https://www.blog.909111.xyz/posts/df71ed7b.html</id>
    <published>2023-11-09T02:50:23.341Z</published>
    <updated>2024-04-22T08:15:28.262Z</updated>
    
    <content type="html"><![CDATA[<h3 id="java语言有哪些特征："><a href="#java语言有哪些特征：" class="headerlink" title="java语言有哪些特征："></a>java语言有哪些特征：</h3><ol><li>简单易学，有丰富的类库</li><li>面向对象，高内聚低耦合</li><li>和平台无关性，可以做到一次编写永久使用（jvm则是java跨平台的根本）</li><li>安全可靠</li><li>支持多线程</li></ol><h3 id="面向对象和面向过程"><a href="#面向对象和面向过程" class="headerlink" title="面向对象和面向过程"></a>面向对象和面向过程</h3><p><strong>面向过程：</strong>分析解决问题的步骤，然后通过函数把这些步骤一步一步地实现，然后在使用的时候一一调用，性能搞，所有单片机，嵌入式开发一般采用面向过程开发。</p><p><strong>面向对象：</strong>世上的万事万物皆可看做对象，将构成问题的事务分解成为各个对象，而建立对象的目的也不是完成一个个步骤，而是描述某事物在解决整个问题过程中所发生的行为。面向对象有三大特征，封装，继承，多态。故而更加容易维护，容易复用，容易拓展。可以设计出低耦合的系统，但从性能上讲，比面向过程要低。</p><h3 id="java8种数据类型"><a href="#java8种数据类型" class="headerlink" title="java8种数据类型"></a>java8种数据类型</h3><hr><p>​            int         short         byte     long  </p><p>  字节                4                2                     1             8</p><p>  默认值             0               0                     0             0L</p><p>  封装类         Integer      Short           Byte     Long </p><hr><p>​            float             double</p><p>   字节               4                                 8</p><p>  默认值             0.0f                           0.0d  </p><p>  封装类            Float                           Double</p><hr><p>​              boolean</p><p>   字节            -</p><p>  默认值          false     </p><p>  封装类          Boolean  </p><hr><p>​                   char</p><p>   字节            2</p><p>  默认值                null</p><p>  封装类              Character</p><p><strong>注意：</strong></p><ol><li>int 是基本数据类型，Integer是int的封装类，是引用类型，int默认值是0，而Integer默认值是null,所以Integer能区分出0和null的情况，一旦java看到null，这个引用还么指向某个对象，在任何引用使用前，必须为其指定一个对象，否则报错</li><li>基本数据类型，在声明之前系统会自动给他分空间而引用类型声明时知识分配了引用空间，必须通过该实例化开辟对象之后才能赋值，数据对象也是一个引用对象，将一个数组赋值给另一个数组时只是复制了一个引用，所以通过某一个数组所做的修改在另一个数组中也看得见。</li><li>虽然定义了boolean这种数据类型，但是只对它提供了非常有限的支持。在Java虚拟机中没有 任何供boolean值专用的字节码指令，Java语言表达式所操作的boolean值，在编译之后都使用Java 虚拟机中的int数据类型来代替，而boolean数组将会被编码成Java虚拟机的byte数组，每个元素 boolean元素占8位。这样我们可以得出boolean类型占了单独使用是4个字节，在数组中又是1个字 节。使用int的原因是，对于当下32位的处理器（CPU）来说，一次处理数据是32位（这里不是指的 是32/64位系统，而是指CPU硬件层面），具有高效存取的特点。</li></ol><h3 id="instanceof关键字的作用"><a href="#instanceof关键字的作用" class="headerlink" title="instanceof关键字的作用"></a>instanceof关键字的作用</h3><p>用来测试一个对象是否为一个类的实例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> obj <span class="keyword">instanceof</span> Class;</span><br></pre></td></tr></table></figure><p>obj为对象，Class表示一个类或者接口。当obj为Class对象或者是其直接或间接子类，或者是其接口的实现类，结果都是result返回为true，否则false;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">System.out.println(i <span class="keyword">instanceof</span> Integer);<span class="comment">//编译不通过 i必须是引用类型，不能是基本类型</span></span><br><span class="line">System.out.println(i <span class="keyword">instanceof</span> Object);<span class="comment">//编译不通过</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">1</span>);</span><br><span class="line">System.out.println(integer <span class="keyword">instanceof</span> Integer);<span class="comment">//true</span></span><br><span class="line"><span class="comment">//false ,在 JavaSE规范 中对 instanceof 运算符的规定就是：如果 obj 为 null，那么将返回 false。</span></span><br><span class="line">System.out.println(<span class="literal">null</span> <span class="keyword">instanceof</span> Object);</span><br></pre></td></tr></table></figure><h3 id="java自动装箱与拆箱"><a href="#java自动装箱与拆箱" class="headerlink" title="java自动装箱与拆箱"></a>java自动装箱与拆箱</h3><p>装箱是自动将基本数据类型转换为包装类型（int -&gt; Integer ）;调用方法： Integer的valueOf(int)方法</p><p>拆箱就是自动将包装器数据类型转换为基本类型（Integer-&gt;int）。调用方法：Integer的intValue方法。</p><p>在javaSE5之前，如果要生成一个数值为10的Integer对象，必须要</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">i</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">10</span>);</span><br></pre></td></tr></table></figure><p>而在从java SE5开始就提供了自动装箱的特性，如果要生成一个数值为10的Integer对象，则</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i1</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i3</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i4</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line">sout(i1 == i2);<span class="comment">//true;</span></span><br><span class="line">sout(i3 == i4);<span class="comment">//true;</span></span><br></pre></td></tr></table></figure><p>归根结底</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title function_">valueOf</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line"> <span class="keyword">if</span>(i &gt;= -<span class="number">128</span> &amp;&amp; i &lt;= IntegerCache.high)</span><br><span class="line"> <span class="keyword">return</span> IntegerCache.cache[i + <span class="number">128</span>];</span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(i);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>IntegerCache</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">IntegerCache</span> &#123;</span><br><span class="line"> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> high;</span><br><span class="line"> <span class="keyword">static</span> <span class="keyword">final</span> Integer cache[];</span><br><span class="line"> <span class="keyword">static</span> &#123;</span><br><span class="line"> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> -<span class="number">128</span>;</span><br><span class="line"> <span class="comment">// high value may be configured by property</span></span><br><span class="line"> <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> <span class="number">127</span>;</span><br><span class="line"> <span class="keyword">if</span> (integerCacheHighPropValue != <span class="literal">null</span>) &#123;</span><br><span class="line"> <span class="comment">// Use Long.decode here to avoid invoking methods that</span></span><br><span class="line"> <span class="comment">// require Integer&#x27;s autoboxing cache to be initialized</span></span><br><span class="line"> <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> Long.decode(integerCacheHighPropValue).intValue();</span><br><span class="line"> i = Math.max(i, <span class="number">127</span>);</span><br><span class="line"> <span class="comment">// Maximum array size is Integer.MAX_VALUE</span></span><br><span class="line"> h = Math.min(i, Integer.MAX_VALUE - -low);</span><br><span class="line"> &#125;</span><br><span class="line"> high = h;</span><br><span class="line"> cache = <span class="keyword">new</span> <span class="title class_">Integer</span>[(high - low) + <span class="number">1</span>];</span><br><span class="line"> <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> low;</span><br><span class="line"> <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; cache.length; k++)</span><br><span class="line"> cache[k] = <span class="keyword">new</span> <span class="title class_">Integer</span>(j++);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">private</span> <span class="title function_">IntegerCache</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>从这两段代码上可以看出，在通过valueOf方法创建Integer对象的时候，如果数值在[-128,127],之间便返回指向Integer.cache中已经存在的对象的引用，否则创建一个新的Integer对象。</p><p>上边的代码中i1和i2的数值为100，因此会从cache中读取已经存在的对象。所有i1和i2指向的是同一个对象，而i3和i4，分别指向的是不同的对象。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line"><span class="type">Double</span> <span class="variable">i1</span> <span class="operator">=</span> <span class="number">100.0</span>；</span><br><span class="line"><span class="type">Double</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">100.0</span>；</span><br><span class="line"><span class="type">Double</span> <span class="variable">i3</span> <span class="operator">=</span> <span class="number">200.0</span>；</span><br><span class="line"><span class="type">Double</span> <span class="variable">i4</span> <span class="operator">=</span> <span class="number">200.0</span>；</span><br><span class="line">sout(i1 == i2);   <span class="comment">//false</span></span><br><span class="line">sout(i3 == i4);   <span class="comment">//false</span></span><br></pre></td></tr></table></figure><p>原因在于在某个范围内的整型数值的个数是有限的，而浮点数不是。</p><h3 id="重载和重写"><a href="#重载和重写" class="headerlink" title="重载和重写"></a>重载和重写</h3><p><strong>重写（Override）</strong>：顾名思义，重写就是重新写一遍的意思，其实急速在子类中把父类本身有的方法重写写一遍，子类继承了父类的原有的方法，单有时候子类并不想原封不动的继承父类的某个方法所以在方法名，参数列表，返回类型（除去子类中方法的返回值是父类中方法返回值的子类时）都在相同的情况下，对方法体进行修改或者重写，但是注意，子类函数的方法的访问修饰权限不能少于父类的。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Father</span>()&#123;</span><br><span class="line">    main:&#123;</span><br><span class="line">    <span class="type">Son</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Son</span>();</span><br><span class="line">    s.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">            sout(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Son</span> <span class="keyword">extends</span> <span class="title class_">Father</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">        sout(<span class="string">&quot;Hello --by&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>总之，重写   </p><ol><li>发生在父类和子类之间.</li><li>方法名，参数，返回类型（除去子类方法的返回类型是父类中返回类型的子类）必须相同</li><li>访问修饰符的限制一定要大于被重写方法的访问修饰符（public &gt; protected &gt; default &gt; private ）</li><li>重写方法一定不能抛出新的检查异常或者比被重写的方法申明更加宽泛的检查型异常。</li></ol><p><strong>重载（Overload）</strong> ：同一个类下，同名的方法如果有不同的参数类型列表<strong>（参数类型不同，参数个数不同甚至参数顺序不同）</strong>则视为重载，同时，重载对返回类型没有要求，可以相同也可以不同，<strong>但不能通过返回类型是否相同来判断重载</strong>。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Father</span> &#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"> <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line"> <span class="type">Father</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Father</span>();</span><br><span class="line"> s.sayHello();</span><br><span class="line"> s.sayHello(<span class="string">&quot;wintershii&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span> &#123;</span><br><span class="line"> System.out.println(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">(String name)</span> &#123;</span><br><span class="line"> System.out.println(<span class="string">&quot;Hello&quot;</span> + <span class="string">&quot; &quot;</span> + name);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>重载：</strong></p><ol><li>重载是一个类中多态性的一种表现</li><li>重载要去方法名相同参数列表不同（参数类型，参数个数，甚至参数顺序）</li><li>重载的时候，返回值类型可以相同也可以不同，无法以返回型作为重载函数的区分标准。</li></ol><h3 id="equals-与-的区别"><a href="#equals-与-的区别" class="headerlink" title="equals 与 == 的区别"></a>equals 与 == 的区别</h3><p><strong>==比较的是变量（栈）内存中存放对象的（堆）内存地址，用来判断两个对象的地址是否相同</strong>，也就是是否比较相同一个对象，比较的真正意义上的指针操作。</p><ol><li><p>比较的是操作符两端的操作数是否是同一个对象</p></li><li><p>两边的操作数必须是统一类型的（可以是父子类之间）才能编译通过。</p></li><li><p>比较的是地址，如果是具体的阿拉伯数字的比较，值相等就是true,如 int  a = 10 ,long b=10.0L ,double c = 10.0 都是相同的，因为他们都指向地址为10的堆；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Father</span> &#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"> <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"> <span class="type">long</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">10L</span>;</span><br><span class="line"> <span class="type">double</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">10.0</span>;</span><br><span class="line">System.out.println(a == b); <span class="comment">//true</span></span><br><span class="line"> System.out.println(b==c);   <span class="comment">//true</span></span><br><span class="line">  System.out.println(a==c);  <span class="comment">//true</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>equals</strong>:<strong>用来比较两个对象的内容是否相等</strong>，由于所有的类都是继承java.lang.Object类的，所以适用于所有对象，如果没有对该方法进行覆盖的话，调用的仍然是Object中的方法，而Object中的equals方法的返回确实==的判断。</p></li></ol><p><strong>总结</strong></p><p>所有的比较是否相等时，都是用equals并且对常量相比较时，把常量写在前面，因为使用object的equals object 可能为null则空指针。在阿里的代码规范中只使用equals ，阿里插件默认会识别，并可以快速修改，推荐安装阿里插件来 排查老代码使用“==”，替换成equals</p><h3 id="Hashcode的作用"><a href="#Hashcode的作用" class="headerlink" title="Hashcode的作用"></a>Hashcode的作用</h3><p>java集合有两个类，一类是List，一类是Set，前者有序可重复，后者无序不重复，当我们在set中插入的时候怎么判断是否已经存在该元素呢？可以通过equals方法，如果元素太多，这样的方法比较满。</p><p>于是有人发明了哈希算法来提高集合中查找元素的效率，这种方式将集合分成若干个存储区域，每个对象可以计算出一个哈希码，可以将哈希码分组，每组分别对应某个存储区域，根据一个对象的哈希码就可以确定该对象应该存储的那个区域。</p><p>hashCode方法可以这样理解，他返回的就是更加对象的内存地址换算出的一个值，这样一来，当集合要添加新的元素的时，先调用这个元素的hashCode方法，就一下能定位到他应该放置的物理位置，如果这个位置上没有元素，就直接存储在这个位置上，不需要在进行任何比较；如果这个位置上已经存在元素，就调用equals方法与新元素比较，相同就不存，不相同就散列到其他地址，这样一来实际调用equals方法的次数就大大降低了几乎只需要一两次。</p><h3 id="String-StringBuffer和StringBuilder的区别"><a href="#String-StringBuffer和StringBuilder的区别" class="headerlink" title="String,StringBuffer和StringBuilder的区别"></a>String,StringBuffer和StringBuilder的区别</h3><p>String 是只读字符串，由于被final修饰，故string不能被继承，他不是基本数据类型，而是一个对象，且底层源码是一个被final修饰的字符数组，所引用的字符串不能被改变，一经定义，无法再增删改，每次对string的操作都会造成一个新的string对象。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">string</span> <span class="variable">a</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line"><span class="type">string</span> <span class="variable">b</span> <span class="operator">=</span> <span class="string">&quot;b&quot;</span>;</span><br><span class="line"><span class="type">string</span> <span class="variable">c</span> <span class="operator">=</span> a + b;<span class="comment">//将会创建一个新的String c ,而String a,String b的值保持不变。</span></span><br></pre></td></tr></table></figure><p>每次+操作后：隐式在堆上new了一个跟原字符串相同的StringBuilder对象，在调用append方法拼接+后边的字符。</p><p>StringBuffer和StringBuilder他们两个都继承了AbstractStringBuilder对象。他们的底层都是可变的字符数组，另外StringBuffer对方法加了同步所或者对调用的方法加了同步锁，所以线程是安全的，StringBuilder并没有对方法进行同步锁，故而线程不安全的。</p><h3 id="ArrayList和LinkedList的区别"><a href="#ArrayList和LinkedList的区别" class="headerlink" title="ArrayList和LinkedList的区别"></a>ArrayList和LinkedList的区别</h3><p>Array(数组)是基于索引（index）的数据结构，它使用索引在数组中搜索和读取数据是很快的。</p><p>Array获<strong>取数据的时间复杂度是O(1),但是删除数据开销却很大</strong>，因为这需要重排数组中所有的数据，（因为删除数据以后，需要把后边的所有数据前移）</p><p><strong>缺点：数组初始化必须指定初始化长度，否则报错。</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] a = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">4</span>];<span class="comment">//推介使用int[] 这种方式初始化</span></span><br><span class="line"><span class="type">int</span> c[] = &#123;<span class="number">23</span>,<span class="number">43</span>,<span class="number">56</span>,<span class="number">78</span>&#125;;<span class="comment">//长度：4，索引范围：[0,3]</span></span><br></pre></td></tr></table></figure><p><strong>List是一个有序的集合</strong>，可以包含重复的元素，提供了按索引访问的方式，它继承Collection。 </p><blockquote><p>List有两个重要的实现类：<strong>ArrayList和LinkedList</strong> </p><p><strong>ArrayList: 可以看作是能够自动增长容量的数组</strong> </p><p><strong>ArrayList的toArray方法返回一个数组</strong> </p><p><strong>ArrayList的asList方法返回一个列表</strong></p><p><strong>ArrayList底层的实现是Array, 数组扩容实现</strong> </p></blockquote><p><strong>LinkList是一个双链表，在添加和删除元素时具有比ArrayList更好的性能，但在get和set方面弱于ArrayList.当然这些都是对比数据亮很大或者操作很频繁的情况下的。</strong></p><h3 id="String类常用对象方法有哪些？"><a href="#String类常用对象方法有哪些？" class="headerlink" title="String类常用对象方法有哪些？"></a>String类常用对象方法有哪些？</h3><blockquote><p>indexOf(): 返回指定字符的索引</p><p>charAt():返回指定索引处的字符</p><p>replace():字符串替换</p><p>trim():去除字符串端空白</p><p>split():分割字符串，返回一个分割后的字符串数组</p><p>getBytes():返回字符串的byte类型数组</p><p>length():返回字符串长度</p><p>toLowerCase(): 将字符串转成小写字母</p><p>toUpperCase():将字符串转成大写字母</p><p>substring():截取字符串</p><p>equals():字符串比较</p></blockquote>]]></content>
    
    
    <summary type="html">本文主要介绍对多java基础面试题的总结</summary>
    
    
    
    <category term="面试题" scheme="https://www.blog.909111.xyz/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    
    
    <category term="java面试题" scheme="https://www.blog.909111.xyz/tags/java%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>Vue3学习笔记和实例</title>
    <link href="https://www.blog.909111.xyz/posts/174c6ef5.html"/>
    <id>https://www.blog.909111.xyz/posts/174c6ef5.html</id>
    <published>2023-11-09T02:50:23.340Z</published>
    <updated>2023-11-09T02:50:23.340Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Vue3学习"><a href="#Vue3学习" class="headerlink" title="Vue3学习"></a>Vue3学习</h1><p>第一个vue 项目</p><p>首先，我们需要安装node.js自行选择自己需要的版本。推荐使用node.js 16.0</p><p>打开你的目标文件夹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init vue@latest  //或者指定版本号</span><br></pre></td></tr></table></figure><p>这一指令将会安装并执行 <a href="https://github.com/vuejs/create-vue">create-vue</a>，它是 Vue 官方的项目脚手架工具。你将会看到一些诸如 TypeScript 和测试支持之类的可选功能提示： </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">✔ Project name: … &lt;your-project-name&gt;</span><br><span class="line">✔ Add TypeScript? … No / Yes</span><br><span class="line">✔ Add JSX Support? … No / Yes</span><br><span class="line">✔ Add Vue Router for Single Page Application development? … No / Yes</span><br><span class="line">✔ Add Pinia for state management? … No / Yes</span><br><span class="line">✔ Add Vitest for Unit testing? … No / Yes</span><br><span class="line">✔ Add Cypress for both Unit and End-to-End testing? … No / Yes</span><br><span class="line">✔ Add ESLint for code quality? … No / Yes</span><br><span class="line">✔ Add Prettier for code formatting? … No / Yes</span><br><span class="line"></span><br><span class="line">Scaffolding project in ./&lt;your-project-name&gt;...</span><br><span class="line">Done.</span><br></pre></td></tr></table></figure><p>如果不确定是否要开启某个功能，你可以直接按下回车键选择 <code>No</code>。在项目被创建后，通过以下步骤安装依赖并启动开发服务器： </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">cd</span> &lt;your-project-name&gt;</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">npm install</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">npm run dev</span></span><br></pre></td></tr></table></figure><p>你现在应该已经运行起来了你的第一个 Vue 项目！请注意，生成的项目中的示例组件使用的是<a href="https://cn.vuejs.org/guide/introduction.html#composition-api">组合式 API</a> 和 <code>&lt;script setup&gt;</code>，而非<a href="https://cn.vuejs.org/guide/introduction.html#options-api">选项式 API</a>。下面是一些补充提示：</p><ul><li>推荐的 IDE 配置是 <a href="https://code.visualstudio.com/">Visual Studio Code</a> + <a href="https://marketplace.visualstudio.com/items?itemName=Vue.volar">Volar 扩展</a>。如果使用其他编辑器，参考 <a href="https://cn.vuejs.org/guide/scaling-up/tooling.html#ide-support">IDE 支持章节</a>。</li><li>更多工具细节，包括与后端框架的整合，我们会在<a href="https://cn.vuejs.org/guide/scaling-up/tooling.html">工具链指南</a>进行讨论。</li><li>要了解构建工具 Vite 更多背后的细节，请查看 <a href="https://cn.vitejs.dev/">Vite 文档</a>。</li><li>如果你选择使用 TypeScript，请阅读 <a href="https://cn.vuejs.org/guide/typescript/overview.html">TypeScript 使用指南</a>。</li></ul><p>当你准备将应用发布到生产环境时，请运行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">npm run build</span></span><br></pre></td></tr></table></figure><p>此命令会在 <code>./dist</code> 文件夹中为你的应用创建一个生产环境的构建版本。关于将应用上线生产环境的更多内容，请阅读<a href="https://cn.vuejs.org/guide/best-practices/production-deployment.html">生产环境部署指南</a>。 </p><h2 id="通过-CDN-使用-Vue"><a href="#通过-CDN-使用-Vue" class="headerlink" title="通过 CDN 使用 Vue"></a>通过 CDN 使用 Vue</h2><p>你可以借助 script 标签直接通过 CDN 来使用 Vue：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/vue@3/dist/vue.global.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里我们使用了 <a href="https://unpkg.com/">unpkg</a>，但你也可以使用任何提供 npm 包服务的 CDN，例如 <a href="https://www.jsdelivr.com/package/npm/vue">jsdelivr</a> 或 <a href="https://cdnjs.com/libraries/vue">cdnjs</a>。当然，你也可以下载此文件并自行提供服务。</p><p>通过 CDN 使用 Vue 时，不涉及“构建步骤”。这使得设置更加简单，并且可以用于增强静态的 HTML 或与后端框架集成。但是，你将无法使用单文件组件 (SFC) 语法。</p><h3 id="使用全局构建版本"><a href="#使用全局构建版本" class="headerlink" title="使用全局构建版本"></a>使用全局构建版本</h3><p>上面的例子使用了<em>全局构建版本</em>的 Vue，该版本的所有顶层 API 都以属性的形式暴露在了全局的 <code>Vue</code> 对象上。这里有一个使用全局构建版本的例子：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/vue@3/dist/vue.global.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> &#123; createApp &#125; = <span class="title class_">Vue</span></span></span><br><span class="line"><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">createApp</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">message</span>: <span class="string">&#x27;Hello Vue!&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="使用-ES-模块构建版本"><a href="#使用-ES-模块构建版本" class="headerlink" title="使用 ES 模块构建版本"></a>使用 ES 模块构建版本</h3><p>在本文档的其余部分我们使用的主要是 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules">ES 模块</a>语法。现代浏览器大多都已原生支持 ES 模块。因此我们可以像这样通过 CDN 以及原生 ES 模块使用 Vue： </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;https://unpkg.com/vue@3/dist/vue.esm-browser.js&#x27;</span></span></span><br><span class="line"><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">createApp</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">message</span>: <span class="string">&#x27;Hello Vue!&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>注意我们使用了 <code>&lt;script type=&quot;module&quot;&gt;</code>，且导入的 CDN URL 指向的是 Vue 的 <strong>ES 模块构建版本</strong>。 </p><h3 id="启用-Import-maps"><a href="#启用-Import-maps" class="headerlink" title="启用 Import maps"></a>启用 Import maps</h3><p>在上面的示例中，我们使用了完整的 CDN URL 来导入，但在文档的其余部分中，你将看到如下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br></pre></td></tr></table></figure><p>我们可以使用<a href="https://caniuse.com/import-maps">导入映射表 (Import Maps)</a> 来告诉浏览器如何定位到导入的 <code>vue</code>： </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;importmap&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="string">&quot;imports&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="string">&quot;vue&quot;</span>: <span class="string">&quot;https://unpkg.com/vue@3/dist/vue.esm-browser.js&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">createApp</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">message</span>: <span class="string">&#x27;Hello Vue!&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://jsfiddle.net/yyx990803/2ke1ab0z/">JSFiddle 中的示例</a></p><p>你也可以在映射表中添加其他的依赖——但请务必确保你使用的是该库的 ES 模块版本。</p><blockquote><p>导入映射表的浏览器支持情况</p><p>目前只有基于 Chromium 的浏览器支持导入映射表，所以我们推荐你在学习过程中使用 Chrome 或 Edge。</p><p>如果你使用的是 Firefox 浏览器，则该功能默认在 108+ 版本或通过启用 <code>about:config</code> 中的 <code>dom.importMaps.enabled</code> 选项支持。</p><p>如果你更喜欢那些还不支持导入映射表的浏览器，你可以使用 <a href="https://github.com/guybedford/es-module-shims">es-module-shims</a> 来进行 polyfill.</p><p>生产环境中的注意事项</p><p>到目前为止示例中使用的都是 Vue 的开发构建版本——如果你打算在生产中通过 CDN 使用 Vue，请务必查看<a href="https://cn.vuejs.org/guide/best-practices/production-deployment.html#without-build-tools">生产环境部署指南</a>。</p></blockquote><h3 id="拆分模块"><a href="#拆分模块" class="headerlink" title="拆分模块"></a>拆分模块</h3><p>随着对这份指南的逐步深入，我们可能需要将代码分割成单独的 JavaScript 文件，以便更容易管理。例如： </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> <span class="title class_">MyComponent</span> <span class="keyword">from</span> <span class="string">&#x27;./my-component.js&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">createApp</span>(<span class="title class_">MyComponent</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// my-component.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`&lt;div&gt;count is &#123;&#123; count &#125;&#125;&lt;/div&gt;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>如果直接在浏览器中打开了上面的 <code>index.html</code>，你会发现它抛出了一个错误，因为 ES 模块不能通过 <code>file://</code> 协议工作。为了使其工作，你需要使用本地 HTTP 服务器通过 <code>http://</code> 协议提供 <code>index.html</code>。</p><p>要启动一个本地的 HTTP 服务器，请先安装 <a href="https://nodejs.org/zh/">Node.js</a>，然后通过命令行在 HTML 文件所在文件夹下运行 <code>npx serve</code>。你也可以使用其他任何可以基于正确的 MIME 类型服务静态文件的 HTTP 服务器。</p><p>可能你也注意到了，这里导入的组件模板是内联的 JavaScript 字符串。如果你正在使用 VSCode，你可以安装 <a href="https://marketplace.visualstudio.com/items?itemName=Tobermory.es6-string-html">es6-string-html</a> 扩展，然后在字符串前加上一个前缀注释 <code>/*html*/</code> 以高亮语法。</p><h3 id="无需构建的组合式-API-用法"><a href="#无需构建的组合式-API-用法" class="headerlink" title="无需构建的组合式 API 用法"></a>无需构建的组合式 API 用法</h3><p>组合式 API 的许多示例将使用 <code>&lt;script setup&gt;</code> 语法。如果你想在无需构建的情况下使用组合式 API，请参阅 <a href="https://cn.vuejs.org/api/composition-api-setup.html"><code>setup()</code> 选项</a>。 </p><h2 id="进入vue启动页面"><a href="#进入vue启动页面" class="headerlink" title="进入vue启动页面"></a>进入vue启动页面</h2><p> <a href="http://127.0.0.1:端口号/">http://127.0.0.1:端口号/</a></p><p>router/index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HomeView</span> <span class="keyword">from</span> <span class="string">&#x27;../views/HomeView.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;  <span class="comment">//定义不可变的路由</span></span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">BASE_URL</span>),</span><br><span class="line"><span class="comment">//创建路由对象，json的形式</span></span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">HomeView</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;about&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/AboutView.vue&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/learn1&#x27;</span>,  <span class="comment">//url路径指向</span></span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;learn1&#x27;</span>,  </span><br><span class="line">      <span class="comment">//路由，指向目标页面</span></span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/Learn1.vue&#x27;</span>) </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="声明式渲染"><a href="#声明式渲染" class="headerlink" title="声明式渲染"></a>声明式渲染</h3><p>你在编辑器中看到的是一个 Vue 单文件组件 (Single-File Component，缩写为 SFC)。SFC 是一种可复用的代码组织形式，它将从属于同一个组件的 HTML、CSS 和 JavaScript 封装在使用 <code>.vue</code> 后缀的文件中。 </p><p>Vue 的核心功能是<strong>声明式渲染</strong>：通过扩展于标准 HTML 的模板语法，我们可以根据 JavaScript 的状态来描述 HTML 应该是什么样子的。当状态改变时，HTML 会自动更新。</p><p>能在改变时触发更新的状态被称作是<strong>响应式</strong>的。我们可以使用 Vue 的 <code>reactive()</code> API 来声明响应式状态。由 <code>reactive()</code> 创建的对象都是 JavaScript <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy</a>，其行为与普通对象一样：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactive &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const counter = reactive(&#123;</span><br><span class="line">  count: 0</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">console.log(counter.count) // 0</span><br><span class="line">counter.count++</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>reactive()</code> 只适用于对象 (包括数组和内置类型，如 <code>Map</code> 和 <code>Set</code>)。而另一个 API <code>ref()</code> 则可以接受任何值类型。<code>ref</code> 会返回一个包裹对象，并在 <code>.value</code> 属性下暴露内部值。 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const message = ref(&#x27;Hello World!&#x27;)</span><br><span class="line"></span><br><span class="line">console.log(message.value) // &quot;Hello World!&quot;</span><br><span class="line">message.value = &#x27;Changed&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>reactive()</code> 和 <code>ref()</code> 的细节在<a href="https://cn.vuejs.org/guide/essentials/reactivity-fundamentals.html">指南 - 响应式基础</a>一节中有进一步讨论。</p><p>在组件的 <code>&lt;script setup&gt;</code> 块中声明的响应式状态，可以直接在模板中使用。下面展示了我们如何使用双花括号语法，根据 <code>counter</code> 对象和 <code>message</code> ref 的值渲染动态文本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;&#123;&#123; message &#125;&#125;&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;count is: &#123;&#123; counter.count &#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure><p>注意我们在模板中访问的 <code>message</code> ref 时不需要使用 <code>.value</code>：它会被自动解包，让使用更简单。</p><p>在双花括号中的内容并不只限于标识符或路径——我们可以使用任何有效的 JavaScript 表达式。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;&#123;&#123; message.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;) &#125;&#125;&lt;/h1&gt;</span><br></pre></td></tr></table></figure><p>现在，试着自己创建一些响应式状态，用它来为模板中的 <code>&lt;h1&gt;</code> 渲染动态的文本内容。 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; reactive, ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const counter = reactive(&#123; count: 0 &#125;)</span><br><span class="line">const message = ref(&#x27;Hello World!&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h1&gt;&#123;&#123; message &#125;&#125;&lt;/h1&gt;</span><br><span class="line">  &lt;p&gt;Count is: &#123;&#123; counter.count &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>app.vue页面</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; RouterLink, RouterView &#125; from &#x27;vue-router&#x27;</span><br><span class="line">import HelloWorld from &#x27;./components/HelloWorld.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;header&gt;</span><br><span class="line">    &lt;img alt=&quot;Vue logo&quot; class=&quot;logo&quot; src=&quot;@/assets/logo.svg&quot; width=&quot;125&quot; height=&quot;125&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;wrapper&quot;&gt;</span><br><span class="line">      &lt;HelloWorld msg=&quot;You did it!&quot; /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;nav&gt;</span><br><span class="line">        &lt;RouterLink to=&quot;/&quot;&gt;Home&lt;/RouterLink&gt;</span><br><span class="line">        &lt;RouterLink to=&quot;/about&quot;&gt;About&lt;/RouterLink&gt;</span><br><span class="line">        &lt;RouterLink to=&quot;/learn1&quot;&gt;学习1&lt;/RouterLink&gt;</span><br><span class="line">      &lt;/nav&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/header&gt;</span><br><span class="line">  &lt;RouterView /&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>learn1.vue</p><h3 id="Attribute-绑定"><a href="#Attribute-绑定" class="headerlink" title="Attribute 绑定"></a>Attribute 绑定</h3><p>在 Vue 中，mustache 语法 (即双大括号) 只能用于文本插值。为了给 attribute 绑定一个动态值，需要使用 <code>v-bind</code> 指令：</p><p>实例</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div v-bind:id=&quot;dynamicId&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure><p><strong>指令</strong>是由 <code>v-</code> 开头的一种特殊 attribute。它们是 Vue 模板语法的一部分。和文本插值类似，指令的值是可以访问组件状态的 JavaScript 表达式。关于 <code>v-bind</code> 和指令语法的完整细节请详阅<a href="https://cn.vuejs.org/guide/essentials/template-syntax.html">指南 - 模板语法</a>。</p><p>冒号后面的部分 (<code>:id</code>) 是指令的“参数”。此处，元素的 <code>id</code> attribute 将与组件状态里的 <code>dynamicId</code> 属性保持同步。</p><p>由于 <code>v-bind</code> 使用地非常频繁，它有一个专门的简写语法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div :id=&quot;dynamicId&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>现在，试着把一个动态的 <code>class</code> 绑定添加到这个 <code>&lt;h1&gt;</code> 上，并使用 <code>titleClass</code> 的 ref 作为它的值。如果绑定正确，文字将会变为红色。 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; reactive, ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const counter = reactive(&#123; count: 0 &#125;)</span><br><span class="line">const message = ref(&#x27;Hello World!&#x27;)</span><br><span class="line"></span><br><span class="line">const titleClass = ref(&#x27;title&#x27;)  //定死titleClass 的 ref 作为它的值。如果绑定正确，文字将会变为红色。</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;learn1&quot;&gt;</span><br><span class="line">    &lt;h1&gt;你好世界&lt;/h1&gt;</span><br><span class="line">    &lt;h1&gt;&#123;&#123; message &#125;&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;p&gt;Count is: &#123;&#123; counter.count &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;h1 :class=&quot;titleClass&quot;&gt;让我变红&lt;/h1&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">@media (min-width: 1024px) &#123;</span><br><span class="line">  .learn &#123;</span><br><span class="line">    min-height: 100vh;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">.title&#123;</span><br><span class="line">  color: brown;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>实例二</p><h3 id="事件监听"><a href="#事件监听" class="headerlink" title="事件监听"></a>事件监听</h3><p>我们可以使用 <code>v-on</code> 指令监听 DOM 事件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button v-on:click=&quot;increment&quot;&gt;&#123;&#123; count &#125;&#125;&lt;/button&gt;</span><br></pre></td></tr></table></figure><p>因为其经常使用，<code>v-on</code> 也有一个简写语法： </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button @click=&quot;increment&quot;&gt;&#123;&#123; count &#125;&#125;&lt;/button&gt;</span><br></pre></td></tr></table></figure><p>此处，<code>increment</code> 引用了一个在 <code>&lt;script setup&gt;</code> 中声明的函数： </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const count = ref(0)</span><br><span class="line"></span><br><span class="line">function increment() &#123;</span><br><span class="line">  // 更新组件状态</span><br><span class="line">  count.value++</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在函数中，我们可以通过修改 ref 来更新组件状态。</p><p>事件处理函数也可以使用内置表达式，并且可以使用修饰符简化常见任务。这些细节包含在<a href="https://cn.vuejs.org/guide/essentials/event-handling.html">指南 - 事件处理</a>。</p><p>现在，尝试自行实现 <code>increment</code> 函数并通过使用 <code>v-on</code> 将其绑定到按钮上。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const count = ref(0)</span><br><span class="line"></span><br><span class="line">function increment()&#123;</span><br><span class="line">  count.value ++ ;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 使此按钮生效 --&gt;</span><br><span class="line">  &lt;button @click=&quot;increment()&quot;&gt;count is: &#123;&#123; count &#125;&#125;&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="表单绑定"><a href="#表单绑定" class="headerlink" title="表单绑定"></a>表单绑定</h3><p>我们可以同时使用 <code>v-bind</code> 和 <code>v-on</code> 来在表单的输入元素上创建双向绑定： </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input :value=&quot;text&quot; @input=&quot;onInput&quot;&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">onInput</span>(<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="comment">// v-on 处理函数会接收原生 DOM 事件</span></span><br><span class="line">  <span class="comment">// 作为其参数。</span></span><br><span class="line">  text.<span class="property">value</span> = e.<span class="property">target</span>.<span class="property">value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>试着在文本框里输入——你会看到 <code>&lt;p&gt;</code> 里的文本也随着你的输入更新了。</p><p>为了简化双向绑定，Vue 提供了一个 <code>v-model</code> 指令，它实际上是上述操作的语法糖：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input v-model=&quot;text&quot;&gt;</span><br></pre></td></tr></table></figure><p><code>v-model</code> 会将被绑定的值与 <code>&lt;input&gt;</code> 的值自动同步，这样我们就不必再使用事件处理函数了。</p><p><code>v-model</code> 不仅支持文本输入框，也支持诸如多选框、单选框、下拉框之类的输入类型。我们在<a href="https://cn.vuejs.org/guide/essentials/forms.html">指南 - 表单绑定</a>中讨论了更多的细节。</p><p>现在，试着用 <code>v-model</code> 把代码重构一下吧。</p><p>实例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const text = ref(&#x27;&#x27;)</span><br><span class="line">function onInput(e) &#123;</span><br><span class="line">  text.value = e.target.value</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;input :value=&quot;text&quot; @input=&quot;onInput&quot; placeholder=&quot;Type here&quot;&gt;</span><br><span class="line">  &lt;p&gt;&#123;&#123; text &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>变化为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const text = ref(&#x27;&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;input v-model=&quot;text&quot; placeholder=&quot;Type here&quot;&gt;</span><br><span class="line">  &lt;p&gt;&#123;&#123; text &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="条件渲染"><a href="#条件渲染" class="headerlink" title="条件渲染"></a>条件渲染</h3><p>我们可以使用 <code>v-if</code> 指令来有条件地渲染元素： </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1 v-if=&quot;awesome&quot;&gt;Vue is awesome!&lt;/h1&gt;</span><br></pre></td></tr></table></figure><p>这个 <code>&lt;h1&gt;</code> 标签只会在 <code>awesome</code> 的值为<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Truthy">真值 (Truthy)</a> 时渲染。若 <code>awesome</code> 更改为<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Falsy">假值 (Falsy)</a>，它将被从 DOM 中移除。 </p><p>我们也可以使用 <code>v-else</code> 和 <code>v-else-if</code> 来表示其他的条件分支： </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1 v-if=&quot;awesome&quot;&gt;Vue is awesome!&lt;/h1&gt;</span><br><span class="line">&lt;h1 v-else&gt;Oh no 😢&lt;/h1&gt;</span><br></pre></td></tr></table></figure><p>现在，示例程序同时展示了两个 <code>&lt;h1&gt;</code> 标签，并且按钮不执行任何操作。尝试给它们添加 <code>v-if</code> 和 <code>v-else</code> 指令，并实现 <code>toggle()</code> 方法，让我们可以使用按钮在它们之间切换。</p><p>更多细节请查阅 <code>v-if</code>：<a href="https://cn.vuejs.org/guide/essentials/conditional.html">指南 - 条件渲染</a></p><p>实例代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const awesome = ref(true)</span><br><span class="line">function toggle() &#123;</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button @click=&quot;toggle&quot;&gt;toggle&lt;/button&gt;</span><br><span class="line">  &lt;h1&gt;Vue is awesome!&lt;/h1&gt;</span><br><span class="line">  &lt;h1&gt;Oh no 😢&lt;/h1&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>答案：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const awesome = ref(true)</span><br><span class="line">function toggle() &#123;</span><br><span class="line">  awesome.value = !awesome.value;//如果点击通过触发函数改变值</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button @click=&quot;toggle&quot;&gt;toggle&lt;/button&gt;</span><br><span class="line">  &lt;h1 v-if=&quot;awesome&quot;&gt;Vue is awesome!&lt;/h1&gt; &lt;!-- 值之前那没有改变的值--&gt;</span><br><span class="line">  &lt;h1 v-else&gt;Oh no 😢&lt;/h1&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="列表渲染"><a href="#列表渲染" class="headerlink" title="列表渲染"></a>列表渲染</h3><p>我们可以使用 <code>v-for</code> 指令来渲染一个基于源数组的列表： </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">  &lt;li v-for=&quot;todo in todos&quot; :key=&quot;todo.id&quot;&gt;</span><br><span class="line">    &#123;&#123; todo.text &#125;&#125;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里的 <code>todo</code> 是一个局部变量，表示当前正在迭代的数组元素。它只能在 <code>v-for</code> 所绑定的元素上或是其内部访问，就像函数的作用域一样。</p><p>注意，我们还给每个 todo 对象设置了唯一的 <code>id</code>，并且将它作为<a href="https://cn.vuejs.org/api/built-in-special-attributes.html#key">特殊的 <code>key</code> attribute</a> 绑定到每个 <code>&lt;li&gt;</code>。<code>key</code> 使得 Vue 能够精确的移动每个 <code>&lt;li&gt;</code>，以匹配对应的对象在数组中的位置。</p><p>更新列表有两种方式：</p><ol><li><p>在源数组上调用<a href="https://stackoverflow.com/questions/9009879/which-javascript-array-functions-are-mutating">变更方法</a>：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">todos.<span class="property">value</span>.<span class="title function_">push</span>(newTodo)</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>使用新的数组替代原数组： </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">todos.<span class="property">value</span> = todos.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="comment">/* ... */</span>)</span><br></pre></td></tr></table></figure></li></ol><p>这里有一个简单的 todo 列表——试着实现一下 <code>addTodo()</code> 和 <code>removeTodo()</code> 这两个方法的逻辑，使列表能够正常工作！</p><p>关于 <code>v-for</code> 的更多细节：<a href="https://cn.vuejs.org/guide/essentials/list.html">指南 - 列表渲染</a></p><p>vue实例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">// 给每个 todo 对象一个唯一的 id</span><br><span class="line">let id = 0  //初始id为0</span><br><span class="line">const newTodo = ref(&#x27;&#x27;)</span><br><span class="line">const todos = ref([</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn HTML&#x27; &#125;,</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn JavaScript&#x27; &#125;,</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn Vue&#x27; &#125;</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">function addTodo() &#123;</span><br><span class="line">  // ...</span><br><span class="line">  newTodo.value = &#x27;&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function removeTodo(todo) &#123;</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;form @submit.prevent=&quot;addTodo&quot;&gt;</span><br><span class="line">    &lt;input v-model=&quot;newTodo&quot;&gt;</span><br><span class="line">    &lt;button&gt;Add Todo&lt;/button&gt;    </span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">      &lt;!--循环变量--&gt;</span><br><span class="line">    &lt;li v-for=&quot;todo in todos&quot; :key=&quot;todo.id&quot;&gt;</span><br><span class="line">      &#123;&#123; todo.text &#125;&#125;</span><br><span class="line">      &lt;button @click=&quot;removeTodo(todo)&quot;&gt;X&lt;/button&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>答案：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">// 给每个 todo 对象一个唯一的 id</span><br><span class="line">let id = 0</span><br><span class="line">//定义新的数组newTodo</span><br><span class="line">//这行代码使用了 Vue 3 中的响应式（reactive）功能，创建了一个名为 newTodo 的变量，并将其初始化为空字符串。其中 const 关键字表示这是一个常量，而 ref 则表示这个变量是可响应的（reactive）。</span><br><span class="line">const newTodo = ref(&#x27;&#x27;)</span><br><span class="line">//初始化todos的数据，作为数组</span><br><span class="line">const todos = ref([</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn HTML&#x27; &#125;,</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn JavaScript&#x27; &#125;,</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn Vue&#x27; &#125;</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">//选择添加新的数据进入数组</span><br><span class="line">function addTodo() &#123;</span><br><span class="line">  todos.value.push(&#123; id: id++, text: newTodo.value &#125;)</span><br><span class="line">  newTodo.value = &#x27;&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function removeTodo(todo) &#123;</span><br><span class="line">  todos.value = todos.value.filter((t) =&gt; t !== todo)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;form @submit.prevent=&quot;addTodo&quot;&gt;</span><br><span class="line">    &lt;input v-model=&quot;newTodo&quot;&gt;</span><br><span class="line">    &lt;button&gt;Add Todo&lt;/button&gt;    </span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &lt;li v-for=&quot;todo in todos&quot; :key=&quot;todo.id&quot;&gt;</span><br><span class="line">      &#123;&#123; todo.text &#125;&#125;</span><br><span class="line">      &lt;button @click=&quot;removeTodo(todo)&quot;&gt;X&lt;/button&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="计算属性"><a href="#计算属性" class="headerlink" title="计算属性"></a>计算属性</h3><p>让我们在上一步的 todo 列表基础上继续。现在，我们已经给每一个 todo 添加了切换功能。这是通过给每一个 todo 对象添加 <code>done</code> 属性来实现的，并且使用了 <code>v-model</code> 将其绑定到复选框上： </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;li v-for=&quot;todo in todos&quot;&gt;</span><br><span class="line">  &lt;input type=&quot;checkbox&quot; v-model=&quot;todo.done&quot;&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;/li&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>下一个可以添加的改进是隐藏已经完成的 todo。我们已经有了一个能够切换 <code>hideCompleted</code> 状态的按钮。但是应该如何基于状态渲染不同的列表项呢？</p><p>介绍一个新 API：<a href="https://cn.vuejs.org/guide/essentials/computed.html"><code>computed()</code></a>。它可以让我们创建一个计算属性 ref，这个 ref 会动态地根据其他响应式数据源来计算其 <code>.value</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ref, computed &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const hideCompleted = ref(false)</span><br><span class="line">const todos = ref([</span><br><span class="line">  /* ... */</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">const filteredTodos = computed(() =&gt; &#123;</span><br><span class="line">  // 根据 `todos.value` &amp; `hideCompleted.value`</span><br><span class="line">  // 返回过滤后的 todo 项目</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;todo in todos&quot;</span>&gt;</span></span><br><span class="line">+ <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;todo in filteredTodos&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>计算属性会自动跟踪其计算中所使用的到的其他响应式状态，并将它们收集为自己的依赖。计算结果会被缓存，并只有在其依赖发生改变时才会被自动更新。</p><p>现在，试着添加 <code>filteredTodos</code> 计算属性并实现计算逻辑！如果实现正确，在隐藏已完成项目的状态下勾选一个 todo，它也应当被立即隐藏。</p><p>实例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">let id = 0</span><br><span class="line">const newTodo = ref(&#x27;&#x27;)</span><br><span class="line">const hideCompleted = ref(false)</span><br><span class="line">const todos = ref([</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn HTML&#x27;, done: true &#125;,</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn JavaScript&#x27;, done: true &#125;,</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn Vue&#x27;, done: false &#125;</span><br><span class="line">])</span><br><span class="line">function addTodo() &#123;</span><br><span class="line">  todos.value.push(&#123; id: id++, text: newTodo.value, done: false &#125;)</span><br><span class="line">  newTodo.value = &#x27;&#x27;</span><br><span class="line">&#125;</span><br><span class="line">function removeTodo(todo) &#123;</span><br><span class="line">  todos.value = todos.value.filter((t) =&gt; t !== todo)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;form @submit.prevent=&quot;addTodo&quot;&gt;</span><br><span class="line">    &lt;input v-model=&quot;newTodo&quot;&gt;</span><br><span class="line">    &lt;button&gt;Add Todo&lt;/button&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &lt;li v-for=&quot;todo in todos&quot; :key=&quot;todo.id&quot;&gt;</span><br><span class="line">      &lt;input type=&quot;checkbox&quot; v-model=&quot;todo.done&quot;&gt;</span><br><span class="line">      &lt;span :class=&quot;&#123; done: todo.done &#125;&quot;&gt;&#123;&#123; todo.text &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;button @click=&quot;removeTodo(todo)&quot;&gt;X&lt;/button&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">  &lt;button @click=&quot;hideCompleted = !hideCompleted&quot;&gt;</span><br><span class="line">    &#123;&#123; hideCompleted ? &#x27;Show all&#x27; : &#x27;Hide completed&#x27; &#125;&#125;</span><br><span class="line">  &lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">.done &#123;</span><br><span class="line">  text-decoration: line-through;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>答案：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, computed &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">let id = 0</span><br><span class="line"></span><br><span class="line">const newTodo = ref(&#x27;&#x27;)</span><br><span class="line">//设置hideCompleyted为false</span><br><span class="line">const hideCompleted = ref(false)</span><br><span class="line">//仍旧是定义一个数组</span><br><span class="line">const todos = ref([</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn HTML&#x27;, done: true &#125;,</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn JavaScript&#x27;, done: true &#125;,</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn Vue&#x27;, done: false &#125;</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">const filteredTodos = computed(() =&gt; &#123;</span><br><span class="line">    //这段代码的作用是返回一个根据hideCompleted.value来筛选的todos数组。如果hideCompleted.value为true，则返回未完成的任务数组（即done属性为false），否则返回所有任务数组。</span><br><span class="line">  return hideCompleted.value</span><br><span class="line">    ? todos.value.filter((t) =&gt; !t.done)</span><br><span class="line">    : todos.value</span><br><span class="line">&#125;)</span><br><span class="line">function addTodo() &#123;</span><br><span class="line">  todos.value.push(&#123; id: id++, text: newTodo.value, done: false &#125;)</span><br><span class="line">  newTodo.value = &#x27;&#x27;</span><br><span class="line">&#125;</span><br><span class="line">function removeTodo(todo) &#123;</span><br><span class="line">  todos.value = todos.value.filter((t) =&gt; t !== todo)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;form @submit.prevent=&quot;addTodo&quot;&gt;</span><br><span class="line">    &lt;input v-model=&quot;newTodo&quot;&gt;</span><br><span class="line">    &lt;button&gt;Add Todo&lt;/button&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &lt;li v-for=&quot;todo in filteredTodos&quot; :key=&quot;todo.id&quot;&gt;</span><br><span class="line">      &lt;input type=&quot;checkbox&quot; v-model=&quot;todo.done&quot;&gt;</span><br><span class="line">      &lt;span :class=&quot;&#123; done: todo.done &#125;&quot;&gt;&#123;&#123; todo.text &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;button @click=&quot;removeTodo(todo)&quot;&gt;X&lt;/button&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">  &lt;button @click=&quot;hideCompleted = !hideCompleted&quot;&gt;</span><br><span class="line">    &#123;&#123; hideCompleted ? &#x27;Show all&#x27; : &#x27;Hide completed&#x27; &#125;&#125;</span><br><span class="line">  &lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.done &#123;</span><br><span class="line">  text-decoration: line-through;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="生命周期和模版引用"><a href="#生命周期和模版引用" class="headerlink" title="生命周期和模版引用"></a>生命周期和模版引用</h3><p>目前为止，Vue 为我们处理了所有的 DOM 更新，这要归功于响应性和声明式渲染。然而，有时我们也会不可避免地需要手动操作 DOM。</p><blockquote><p>“var”、”let”和”const”在JavaScript中是用于声明变量的关键字。”var”声明的变量是函数级作用域，它的作用范围在整个函数中；</p><p>而”let”和”const”声明的变量是块级作用域，它们的作用范围在声明的代码块内。</p><p><strong>不同之处在于</strong>，”let”声明的变量可以被重新赋值，而”const”声明的变量是常量，不能被更改。在面试中常常涉及到这些关键字的使用及其区别。 </p></blockquote><p>这时我们需要使用<strong>模板引用</strong>——也就是指向模板中一个 DOM 元素的 ref。我们需要通过<a href="https://cn.vuejs.org/api/built-in-special-attributes.html#ref">这个特殊的 <code>ref</code> attribute</a> 来实现模板引用：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p ref=&quot;p&quot;&gt;hello&lt;/p&gt;</span><br></pre></td></tr></table></figure><p>要访问该引用，我们需要声明一个同名的 ref： </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const p = ref(null)</span><br></pre></td></tr></table></figure><p>注意这个 ref 使用 <code>null</code> 值来初始化。这是因为当 <code>&lt;script setup&gt;</code> 执行时，DOM 元素还不存在。模板引用 ref 只能在组件<strong>挂载</strong>后访问。</p><p>要在挂载之后执行代码，我们可以使用 <code>onMounted()</code> 函数：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import &#123; onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  // 此时组件已经挂载。</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>这被称为<strong>生命周期钩子</strong>——它允许我们注册一个在组件的特定生命周期调用的回调函数。还有一些其他的钩子如 <code>onUpdated</code> 和 <code>onUnmounted</code>。更多细节请查阅<a href="https://cn.vuejs.org/guide/essentials/lifecycle.html#lifecycle-diagram">生命周期图示</a>。</p><p>现在，尝试添加一个 <code>onMounted</code> 钩子，然后通过 <code>p.value</code> 访问 <code>&lt;p&gt;</code>，并直接对其执行一些 DOM 操作。(例如修改它的 <code>textContent</code>)。</p><p>实例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const p = ref(null)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;p ref=&quot;p&quot;&gt;hello&lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>答案：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">const p = ref(null)</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  p.value.textContent = &#x27;mounted!&#x27;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;p ref=&quot;p&quot;&gt;hello&lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="侦听器"><a href="#侦听器" class="headerlink" title="侦听器"></a>侦听器</h3><p>有时我们需要响应性地执行一些“副作用”——例如，当一个数字改变时将其输出到控制台。我们可以通过侦听器来实现它： </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ref, watch &#125; from &#x27;vue&#x27;</span><br><span class="line">const count = ref(0)</span><br><span class="line">watch(count, (newCount) =&gt; &#123;</span><br><span class="line">  // 没错，console.log() 是一个副作用</span><br><span class="line">  console.log(`new count is: $&#123;newCount&#125;`)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>watch()</code> 可以直接侦听一个 ref，并且只要 <code>count</code> 的值改变就会触发回调。<code>watch()</code> 也可以侦听其他类型的数据源——更多详情请参阅<a href="https://cn.vuejs.org/guide/essentials/watchers.html">指南 - 侦听器</a>。 </p><p>一个比在控制台输出更加实际的例子是当 ID 改变时抓取新的数据。在右边的例子中就是这样一个组件。该组件被挂载时，会从模拟 API 中抓取 todo 数据，同时还有一个按钮可以改变要抓取的 todo 的 ID。现在，尝试实现一个侦听器，使得组件能够在按钮被点击时抓取新的 todo 项目。 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const todoId = ref(1)</span><br><span class="line">const todoData = ref(null)</span><br><span class="line"></span><br><span class="line">async function fetchData() &#123;</span><br><span class="line">  todoData.value = null</span><br><span class="line">  const res = await fetch(</span><br><span class="line">    `https://jsonplaceholder.typicode.com/todos/$&#123;todoId.value&#125;`</span><br><span class="line">  )</span><br><span class="line">  todoData.value = await res.json()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fetchData()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;p&gt;Todo id: &#123;&#123; todoId &#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;button @click=&quot;todoId++&quot;&gt;Fetch next todo&lt;/button&gt;</span><br><span class="line">  &lt;p v-if=&quot;!todoData&quot;&gt;Loading...&lt;/p&gt;</span><br><span class="line">  &lt;pre v-else&gt;&#123;&#123; todoData &#125;&#125;&lt;/pre&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>答案：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, watch &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const todoId = ref(1)</span><br><span class="line">const todoData = ref(null)</span><br><span class="line"></span><br><span class="line">async function fetchData() &#123;</span><br><span class="line">  todoData.value = null</span><br><span class="line">  const res = await fetch(</span><br><span class="line">    `https://jsonplaceholder.typicode.com/todos/$&#123;todoId.value&#125;`</span><br><span class="line">  )</span><br><span class="line">  todoData.value = await res.json()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fetchData()</span><br><span class="line"></span><br><span class="line">watch(todoId, fetchData)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;p&gt;Todo id: &#123;&#123; todoId &#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;button @click=&quot;todoId++&quot;&gt;Fetch next todo&lt;/button&gt;</span><br><span class="line">  &lt;p v-if=&quot;!todoData&quot;&gt;Loading...&lt;/p&gt;</span><br><span class="line">  &lt;pre v-else&gt;&#123;&#123; todoData &#125;&#125;&lt;/pre&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><p>目前为止，我们只使用了单个组件。真正的 Vue 应用往往是由嵌套组件创建的。</p><p>父组件可以在模板中渲染另一个组件作为子组件。要使用子组件，我们需要先导入它：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import ChildComp from &#x27;./ChildComp.vue&#x27;</span><br></pre></td></tr></table></figure><p>然后我们就可以在模板中使用组件，就像这样： </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;ChildComp /&gt;</span><br></pre></td></tr></table></figure><p>现在自己尝试一下——导入子组件并在模板中渲染它。 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import ChildComp from &#x27;./ChildComp.vue&#x27;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- render child component --&gt;</span><br><span class="line">&lt;ChildComp&gt;&lt;/ChildComp&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="Props"><a href="#Props" class="headerlink" title="Props"></a>Props</h3><p>子组件可以通过 <strong>props</strong> 从父组件接受动态数据。首先，需要声明它所接受的 props： </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- ChildComp.vue --&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  msg: String</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>注意 <code>defineProps()</code> 是一个编译时宏，并不需要导入。一旦声明，<code>msg</code> prop 就可以在子组件的模板中使用。它也可以通过 <code>defineProps()</code> 所返回的对象在 JavaScript 中访问。</p><p>父组件可以像声明 HTML attributes 一样传递 props。若要传递动态值，也可以使用 <code>v-bind</code> 语法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;ChildComp :msg=&quot;greeting&quot; /&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import ChildComp from &#x27;./ChildComp.vue&#x27;</span><br><span class="line"></span><br><span class="line">  const props = defineProps(&#123;</span><br><span class="line">    msg:String</span><br><span class="line">  &#125;)</span><br><span class="line">  //问候变量</span><br><span class="line">const greeting = ref(&#x27;Hello from parent&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">&lt;!--:msg导向--&gt;</span><br><span class="line">  &lt;ChildComp :msg=&quot;greeting&quot;/&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="Emits"><a href="#Emits" class="headerlink" title="Emits"></a>Emits</h3><p>除了接受props，子组件还可以向父组件触发事件： </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">// 声明触发的事件</span><br><span class="line">const emit = defineEmits([&#x27;response&#x27;])</span><br><span class="line"></span><br><span class="line">// 带参数触发</span><br><span class="line">emit(&#x27;response&#x27;, &#x27;hello from child&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>emit()</code> 的第一个参数是事件的名称。其他所有参数都将传递给事件监听器。</p><p>父组件可以使用 <code>v-on</code> 监听子组件触发的事件——这里的处理函数接收了子组件触发事件时的额外参数并将它赋值给了本地状态：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;ChildComp @response=&quot;(msg) =&gt; childMsg = msg&quot; /&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import ChildComp from &#x27;./ChildComp.vue&#x27;</span><br><span class="line">const childMsg = ref(&#x27;No child msg yet&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;ChildComp @response=&quot;(msg) =&gt; childMsg = msg&quot; /&gt;</span><br><span class="line">  &lt;p&gt;&#123;&#123; childMsg &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="插槽"><a href="#插槽" class="headerlink" title="插槽"></a>插槽</h3><p>除了通过 props 传递数据外，父组件还可以通过<strong>插槽</strong> (slots) 将模板片段传递给子组件： </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;ChildComp&gt;</span><br><span class="line">  This is some slot content!</span><br><span class="line">&lt;/ChildComp&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在子组件中，可以使用 <code>&lt;slot&gt;</code> 元素作为插槽出口 (slot outlet) 渲染父组件中的插槽内容 (slot content)： </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 在子组件的模板中 --&gt;</span><br><span class="line">&lt;slot/&gt;</span><br></pre></td></tr></table></figure><p><code>&lt;slot&gt;</code> 插口中的内容将被当作“默认”内容：它会在父组件没有传递任何插槽内容时显示： </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;slot&gt;Fallback content&lt;/slot&gt;</span><br></pre></td></tr></table></figure><p>现在我们没有给 <code>&lt;ChildComp&gt;</code> 传递任何插槽内容，所以你将看到默认内容。让我们利用父组件的 <code>msg</code> 状态为子组件提供一些插槽内容吧。 </p>]]></content>
    
    
    <summary type="html">本文主要记录前端vue学习的一些笔记，以及如何去快速搭建一个vue框架和启动vue实例。</summary>
    
    
    
    <category term="前端" scheme="https://www.blog.909111.xyz/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="vue3" scheme="https://www.blog.909111.xyz/tags/vue3/"/>
    
  </entry>
  
  <entry>
    <title>Spring</title>
    <link href="https://www.blog.909111.xyz/posts/6c92115f.html"/>
    <id>https://www.blog.909111.xyz/posts/6c92115f.html</id>
    <published>2023-11-09T02:50:23.339Z</published>
    <updated>2023-11-09T02:50:23.339Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-Spring"><a href="#1-Spring" class="headerlink" title="1.Spring"></a>1.Spring</h1><p>spring ： 春天给——》软件行业带来了春天。</p><p>开发目的： 解决企业级开发的复杂性。</p><p>使用javaBean 代替 EDG </p><p>官网： <a href="https://spring.io/">https://spring.io/</a></p><p>spring 理念： 使得现有的技术更加容易使用，本身就是一个大杂烩，整合了现有的技术框架</p><p>SSH ： Struct + Spring + Hibernate </p><p>SSM : Spring + SpringMVC + Maven</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- spring web mvc--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-JDBC<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="1-1-优点"><a href="#1-1-优点" class="headerlink" title="1.1  优点"></a>1.1  优点</h2><ul><li><h5 id="Spring-是一个轻量级免费的开源框架（容器）"><a href="#Spring-是一个轻量级免费的开源框架（容器）" class="headerlink" title="Spring 是一个轻量级免费的开源框架（容器）"></a>Spring 是一个轻量级免费的开源框架（容器）</h5></li><li><h5 id="Spring是一个轻量级的，非入侵式的框架！"><a href="#Spring是一个轻量级的，非入侵式的框架！" class="headerlink" title="Spring是一个轻量级的，非入侵式的框架！"></a>Spring是一个轻量级的，非入侵式的框架！</h5></li><li><h5 id="IOC-控制反转"><a href="#IOC-控制反转" class="headerlink" title="IOC:控制反转"></a>IOC:控制反转</h5></li><li><h5 id="AOP-面向切面编程"><a href="#AOP-面向切面编程" class="headerlink" title="AOP: 面向切面编程"></a>AOP: 面向切面编程</h5></li><li><h5 id="支持事务处理，对框架整合的支持"><a href="#支持事务处理，对框架整合的支持" class="headerlink" title="支持事务处理，对框架整合的支持"></a>支持事务处理，对框架整合的支持</h5><p><strong><em>一句话： Spring就是一个轻量级的控制反转（IOC）和面向切面编程（AOP）的容器</em></strong></p></li></ul><h3 id="1-1-1SpringBean的生命周期："><a href="#1-1-1SpringBean的生命周期：" class="headerlink" title="1.1.1SpringBean的生命周期："></a>1.1.1<strong>SpringBean的生命周期：</strong></h3><p>详细</p><ol><li><p>实例化bean对象：反射的方式生成对象</p></li><li><p>设置对象属性（填充bean的属性）：</p><ol><li>populateBean（）,循环依赖的问题</li></ol></li><li><p>检查Aware相关接口并设置相关依赖：</p><ol><li>invokeAwareMethod(完成BeanName,BeanFactory,BeanClassLoader对象的属性设置)</li></ol></li><li><p>beanPostProcessor前置处理：</p><ol><li>使用比较多的（ApplicationContextPostProcess，设置ApplicationContext等对象）</li></ol></li><li><p>检查是否initalizingBean以决定是否调用afterPropertiesSet方法</p></li><li><p>检查是否配置有自定义的init-method：判断是否实现initalizingbean接口，如果有，调用AfterPropertiesSet方法，没有就不调用</p></li><li><p>BeanPostProcessor后置处理对象：</p><ol><li>Spring的AOP就是在此处实现的，AbstractAutoProxyCreator注册Destuction相关的回调接口</li></ol></li><li><p>是否实现DisposableBean接口，调用DestoryMethod方法</p></li></ol><h2 id="1-2-组成"><a href="#1-2-组成" class="headerlink" title="1.2 组成"></a>1.2 组成</h2><div class="table-container"><table><thead><tr><th>AOP</th><th>ORM</th><th>Spring Web</th><th>Spring Web MVC</th></tr></thead><tbody><tr><td>AOP</td><td>DAO</td><td>Spring Context</td><td>Spring Web MVC</td></tr><tr><td>CORE</td><td>CORE</td><td>CORE</td><td>CORE</td></tr></tbody></table></div><p><strong>核心容器（Spring Core）</strong></p><p>　　核心容器提供Spring框架的基本功能。Spring以bean的方式组织和管理Java应用中的各个组件及其关系。Spring使用BeanFactory来产生和管理Bean，它是工厂模式的实现。BeanFactory使用控制反转(IoC)模式将应用的配置和依赖性规范与实际的应用程序代码分开。</p><p><strong>应用上下文（Spring Context）</strong></p><p>　　Spring上下文是一个配置文件，向Spring框架提供上下文信息。Spring上下文包括企业服务，如JNDI、EJB、电子邮件、国际化、校验和调度功能。</p><p><strong>Spring面向切面编程（Spring AOP）</strong></p><p>　　通过配置管理特性，Spring AOP 模块直接将面向方面的编程功能集成到了 Spring框架中。所以，可以很容易地使 Spring框架管理的任何对象支持 AOP。Spring AOP 模块为基于 Spring 的应用程序中的对象提供了事务管理服务。通过使用 Spring AOP，不用依赖 EJB 组件，就可以将声明性事务管理集成到应用程序中。</p><p><strong>JDBC和DAO模块（Spring DAO）</strong></p><p>　　JDBC、DAO的抽象层提供了有意义的异常层次结构，可用该结构来管理异常处理，和不同数据库供应商所抛出的错误信息。异常层次结构简化了错误处理，并且极大的降低了需要编写的代码数量，比如打开和关闭链接。</p><p><strong>对象实体映射（Spring ORM）</strong></p><p>　　Spring框架插入了若干个ORM框架，从而提供了ORM对象的关系工具，其中包括了Hibernate、JDO和 IBatis SQL Map等，所有这些都遵从Spring的通用事物和DAO异常层次结构。</p><p><strong>Web模块（Spring Web）</strong></p><p>　　Web上下文模块建立在应用程序上下文模块之上，为基于web的应用程序提供了上下文。所以Spring框架支持与Struts集成，web模块还简化了处理多部分请求以及将请求参数绑定到域对象的工作。</p><p><strong>MVC模块（Spring Web MVC）</strong></p><p>　　MVC框架是一个全功能的构建Web应用程序的MVC实现。通过策略接口，MVC框架变成为高度可配置的。MVC容纳了大量视图技术，其中包括JSP、POI等，模型来有JavaBean来构成，存放于m当中，而视图是一个街口，负责实现模型，控制器表示逻辑代码，由c的事情。Spring框架的功能可以用在任何J2EE服务器当中，大多数功能也适用于不受管理的环境。Spring的核心要点就是支持不绑定到特定J2EE服务的可重用业务和数据的访问的对象，毫无疑问这样的对象可以在不同的J2EE环境，独立应用程序和测试环境之间重用。</p><h1 id="2-IOC理论"><a href="#2-IOC理论" class="headerlink" title="2. IOC理论"></a>2. IOC理论</h1><ol><li><p>userDao</p></li><li><p>UserDaoImpl</p></li><li><p>UserService</p></li><li><p>UserServiceImpl</p><p>在我们之前的业务中，用户的需求可能会影响我们原来的代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserDao</span>  <span class="variable">userDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserDao</span> <span class="variable">userDao1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserMysqlDaoImpl</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserDao</span> <span class="variable">userDao2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserOracleDaoImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//当用户需求改变，我们将要每次都要改变代码，很麻烦，从而springIoc的简单就来了。</span></span><br><span class="line">        userDao1.getUser();<span class="comment">//这是新添加的需求，我要改源代码</span></span><br><span class="line">        userDao2.getUser();  <span class="comment">//这又是新添加的需求，我又要改。</span></span><br><span class="line">        userDao.getUser();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">        userService.getUser();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Hello world!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="2-1-IOC本质"><a href="#2-1-IOC本质" class="headerlink" title="2.1 IOC本质"></a>2.1 IOC本质</h2><p>控制反转IOC是一种编程思想，DI（依赖注入）实现IOC的一种方法，可以说Ioc是思想  DI则是实现方式。</p><p>IOC可以说是：<strong>把创建和查找依赖对象的控制权交给了容器，由容器进行注入组合对象，所以对象与对象之间是 松散耦合，这样也方便测试，利于功能复用，更重要的是使得程序的整个体系结构变得非常灵活。</strong> </p><p>采用XML的方式配置bean时候，bean的定义信息和实现分离的，而采用注解的方式可以把两者合为一体，bean的定义直接以注解的形式定义在实现类中，从而达到零配置的目的。</p><p>控制反转是一种通过描述（XML或注解）并通过第三方去生产或获取特定对象的方式，在spring中实现控制反转的是IOC容器，其实现实依赖注入（DI)。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;默认获取数据&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">getUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*    private UserDao  userDao = new UserDaoImpl();</span></span><br><span class="line"><span class="comment">    private UserDao userDao1 = new UserMysqlDaoImpl();</span></span><br><span class="line"><span class="comment">    private UserDao userDao2 = new UserOracleDaoImpl();*/</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//当用户需求改变，我们将要每次都要改变代码，很麻烦，从而springIoc的简单就来了。</span></span><br><span class="line">        <span class="comment">//userDao1.getUser();//这是新添加的需求，我要改源代码</span></span><br><span class="line">       <span class="comment">// userDao2.getUser();  //这又是新添加的需求，我又要改。</span></span><br><span class="line">        userDao.getUser();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;mysqlImpl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.dao.impl.UserMysqlDaoImpl&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;oracleImpl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.dao.impl.UserOracleDaoImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;UserServiceImpl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">             ref： 引用spring容器中创建好的对象</span></span><br><span class="line"><span class="comment">             value： 具体的值，基本数据类型</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;mysqlImpl&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--   我来捋一捋</span></span><br><span class="line"><span class="comment">    UserDao作为接口，有一个方法  UserDaoImpl 实现该方法</span></span><br><span class="line"><span class="comment">    然后UserService接口类方法同名 UserServiceImpl实现改方法</span></span><br><span class="line"><span class="comment">    id    = oracle 也就是context.getBean(&quot;oracle&quot;); 标识符</span></span><br><span class="line"><span class="comment">     UserServiceImpl userService1 = (UserServiceImpl) context.getBean(&quot;oracle&quot;);</span></span><br><span class="line"><span class="comment">      &lt;property name=&quot;userDao&quot; ref=&quot;oracleImpl&quot; /&gt;</span></span><br><span class="line"><span class="comment">      userDao 也就是 set方法的名字</span></span><br><span class="line"><span class="comment">      ref 指向  oracleImpl也就是下边这条语句</span></span><br><span class="line"><span class="comment">          &lt;bean id=&quot;oracleImpl&quot; class=&quot;com.xh.dao.impl.UserOracleDaoImpl&quot;&gt;</span></span><br><span class="line"><span class="comment">    &lt;/bean&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;oracle&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">             ref： 引用spring容器中创建好的对象</span></span><br><span class="line"><span class="comment">             value： 具体的值，基本数据类型</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;oracleImpl&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-2-IOC创建对象的方式"><a href="#2-2-IOC创建对象的方式" class="headerlink" title="2.2 IOC创建对象的方式"></a>2.2 IOC创建对象的方式</h2><ol><li><p>使用无参构造创建对象，没有无参构造将会报错，默认</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  无参构造</span></span><br><span class="line"><span class="comment">  &lt;bean id=&quot;main&quot; class=&quot;com.xh.Main&quot;&gt;</span></span><br><span class="line"><span class="comment">       &lt;property name=&quot;user&quot; value=&quot;作者&quot;/&gt;</span></span><br><span class="line"><span class="comment">   &lt;/bean&gt;--&gt;</span></span><br></pre></td></tr></table></figure></li></ol><ol><li>假设我们要使用有参构造。</li></ol>   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Main&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;user=&#x27;&quot;</span> + user + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*  public Main() &#123;</span></span><br><span class="line"><span class="comment">        System.out.println(&quot;无参构造&quot;);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Main</span><span class="params">(String user)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUser</span><span class="params">(String user)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span>  <span class="title function_">show</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user:&quot;</span>+user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-----------------------------------------------------</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//spring相当于婚介网站</span></span><br><span class="line">        ApplicationContext context=  <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Main</span> <span class="variable">main</span> <span class="operator">=</span> (Main) context.getBean(<span class="string">&quot;main&quot;</span>);</span><br><span class="line">        main.show();</span><br><span class="line">      <span class="comment">//  Main main1 = (Main) context.getBean(&quot;main1&quot;);</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>   1. 下标赋值</code></pre>   <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Main&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">value</span>=<span class="string">&quot;小黑&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li><p>通过类型创建，不推荐使用</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--第二种</span></span><br><span class="line"><span class="comment">       通过类型创建，不推荐使用</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Main&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">value</span>=<span class="string">&quot;小黑&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>直接通过参数名</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Main&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;小黑&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><p>重点使用name有参构造好用，无参构造直接第一个配置</p><p>总结：在配置文件加载的时候，容器中的管理对象就已经初始化了</p><h1 id="3-Spring配置"><a href="#3-Spring配置" class="headerlink" title="3 Spring配置"></a>3 Spring配置</h1><h2 id="3-1-别名"><a href="#3-1-别名" class="headerlink" title="3.1 别名"></a>3.1 别名</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--参数名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Main&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;小黑&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- alias 起别名  name 是  Main main = (Main) context.getBean(&quot;main&quot;); --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">alias</span> <span class="attr">name</span>=<span class="string">&quot;main&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;yanliang&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Main</span> <span class="variable">main</span> <span class="operator">=</span> (Main) context.getBean(<span class="string">&quot;yanliang&quot;</span>);</span><br><span class="line"><span class="type">Main</span> <span class="variable">main1</span> <span class="operator">=</span> (Main) context.getBean(<span class="string">&quot;main&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="3-2-Bean配置"><a href="#3-2-Bean配置" class="headerlink" title="3.2 Bean配置"></a>3.2 Bean配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.UserT&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user2,u2 u3;u4&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;小黑&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--    // 别名可控制 UserT userT = (UserT) context.getBean(&quot;u2&quot;);--&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3-3-Import"><a href="#3-3-Import" class="headerlink" title="3.3 Import"></a>3.3 Import</h2><p>一般用于团队开发，将多个模块导程一个</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        ApplicationContext context=  new ClassPathXmlApplicationContext(&quot;application.xml&quot;);</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">application.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;bean.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;bean2.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;bean1.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>无需担心重名他会自己选择。</p><h1 id="4-依赖注入-DI"><a href="#4-依赖注入-DI" class="headerlink" title="4 依赖注入(DI)"></a>4 依赖注入(DI)</h1><h3 id="4-1-构造器注入"><a href="#4-1-构造器注入" class="headerlink" title="4.1 构造器注入"></a>4.1 构造器注入</h3><p>也就是我们常用的有参构造和无参构造</p><h3 id="4-2-Set方式注入【重点】"><a href="#4-2-Set方式注入【重点】" class="headerlink" title="4.2 Set方式注入【重点】"></a>4.2 Set方式注入【重点】</h3><p>依赖注入：set注入</p><p> 依赖: bean对象的创建依赖于容器</p><p>注入： bean对象中的所有属性由容器注入</p><p>环境搭建</p><ol><li><p>复杂类型</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>  String address;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAddress</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddress</span><span class="params">(String address)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ol><li>真实测试</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line">    <span class="keyword">private</span> String[] books;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; hobby;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,String&gt; card;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; games;</span><br><span class="line">    <span class="keyword">private</span> String wife;</span><br><span class="line">    <span class="keyword">private</span> Properties info;</span><br></pre></td></tr></table></figure><ol><li><p>Bean.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Student&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--第一种普通值注入 value--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;小黑&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li><p>Test</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> (Student) context.getBean(<span class="string">&quot;student&quot;</span>);</span><br><span class="line">        System.out.println(student.getName());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ol></li></ol><h3 id="4-3-拓展方式注入"><a href="#4-3-拓展方式注入" class="headerlink" title="4.3 拓展方式注入"></a>4.3 拓展方式注入</h3><p>我们可以通过p命名空间注入</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:c</span>=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--   p set 命名空间注入，可以简介注入 ： property--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.User&quot;</span> <span class="attr">p:uname</span>=<span class="string">&quot;小黑&quot;</span> <span class="attr">p:age</span>=<span class="string">&quot;18&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  C命名空间必须通过构造器注入才行 有参无参构造 construct-args 注入  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.User&quot;</span> <span class="attr">c:age</span>=<span class="string">&quot;18&quot;</span> <span class="attr">c:uname</span>=<span class="string">&quot;颜亮&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Test</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">P:   </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> (Student) context.getBean(<span class="string">&quot;student&quot;</span>);</span><br><span class="line">        <span class="comment">//System.out.println(student.getName());</span></span><br><span class="line">        System.out.println(student.toString());</span><br><span class="line">    </span><br><span class="line">C:</span><br><span class="line">      <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span></span><br><span class="line">                <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;userBean.xml&quot;</span>);</span><br><span class="line">       <span class="type">User</span>  <span class="variable">user</span> <span class="operator">=</span>  context.getBean(<span class="string">&quot;user2&quot;</span>, User.class);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>注意p:命名空间使用Set方式注入，而C:命名空间是使用构造器注入，有参构造，无参构造都要有，且p,c都需要导入依赖才能使用，不能直接使用</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">xmlns:c=&quot;http://www.springframework.org/schema/c&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-4-Bean作用域"><a href="#4-4-Bean作用域" class="headerlink" title="4.4 Bean作用域"></a>4.4 Bean作用域</h3><p>单例模式：（Spring默认机制）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user3&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.User&quot;</span> <span class="attr">c:age</span>=<span class="string">&quot;18&quot;</span> <span class="attr">c:uname</span>=<span class="string">&quot;颜亮&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span>/&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>原型模式：每次从容器中get的时候都会产生一个新对象</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user4&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.User&quot;</span> <span class="attr">c:age</span>=<span class="string">&quot;18&quot;</span> <span class="attr">c:uname</span>=<span class="string">&quot;颜亮&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>/&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>其余的request ,session,application这些只能在web开发中使用！</p><h1 id="5-bean的自动装配"><a href="#5-bean的自动装配" class="headerlink" title="5 bean的自动装配"></a>5 bean的自动装配</h1><p>自动装配是spring满足bean依赖的一种方式</p><p>spring 会在上下文自动寻找，并自动给bean装配属性</p><p>在spring中有三种装配方式：</p><ol><li>在xml中显示的配置</li><li>在java中显示的配置</li><li>隐式的自动装配bean【重要】</li></ol><h3 id="5-1测试"><a href="#5-1测试" class="headerlink" title="5.1测试"></a>5.1测试</h3><p>环境搭建一个人有两个宠物</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shout</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;苗&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shout</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;你的狗叫什么？&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">People</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>  Cat cat;</span><br><span class="line">    <span class="keyword">private</span>  Dog dog;</span><br><span class="line">    <span class="keyword">private</span>  String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;People&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;cat=&quot;</span> + cat +</span><br><span class="line">                <span class="string">&quot;, dog=&quot;</span> + dog +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Cat <span class="title function_">getCat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCat</span><span class="params">(Cat cat)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cat = cat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Dog <span class="title function_">getDog</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDog</span><span class="params">(Dog dog)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dog = dog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">    <span class="type">People</span> <span class="variable">people</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;people&quot;</span>,People.class);</span><br><span class="line">    people.getDog().shout();</span><br><span class="line">    people.getCat().shout();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Dog&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Cat&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;people&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.People&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;胡小黑&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cat&quot;</span>  <span class="attr">ref</span>=<span class="string">&quot;cat&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dog&quot;</span>  <span class="attr">ref</span>=<span class="string">&quot;dog&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="5-2-ByName自动装配"><a href="#5-2-ByName自动装配" class="headerlink" title="5.2 ByName自动装配"></a>5.2 ByName自动装配</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--   ByName:会自动 在容器上下文查找，和自己对象set方法后边对应的 bean id --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;people&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.People&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;是小胡呀&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Dog&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Cat&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCat</span><span class="params">(Cat cat)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.cat = cat;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDog</span><span class="params">(Dog dog)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.dog = dog;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-3-ByType"><a href="#5-3-ByType" class="headerlink" title="5.3 ByType"></a>5.3 ByType</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    ByType 不会根据id进行查找，和自己对象属性类型相同的bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;people&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.People&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;是小胡呀&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Dog&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;11cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Cat&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>小结：</p><p>byName的时候需要保证bean的id唯一，并且这个bean需要和自动注入的属性的set方法的值一致。</p><p>byType的时候需要保证bean的class唯一，并且这个bean需要和自动注入的属性的类型一致。</p><h3 id="5-4-注解实现自动配置"><a href="#5-4-注解实现自动配置" class="headerlink" title="5.4 注解实现自动配置"></a>5.4 注解实现自动配置</h3><p>JDk1.5以后支持注解，spring 2.5支持注解‘</p><p>使用注解需要注意的是：</p><ol><li><p>导入约束context约束</p></li><li><p>配置注解的支持  <context:annotation-config/></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;example.SimpleMovieCatalog&quot;</span> <span class="attr">primary</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;movieRecommender&quot;</span> <span class="attr">class</span>=<span class="string">&quot;example.MovieRecommender&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="5-4-1-Autowired"><a href="#5-4-1-Autowired" class="headerlink" title="5.4.1 @Autowired"></a>5.4.1 @Autowired</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--开启注解的支持--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Dog&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Cat&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;people&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.People&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;bean id=&quot;people&quot; class=&quot;com.xh.People&quot;&gt;</span></span><br><span class="line"><span class="comment">         &lt;property name=&quot;name&quot; value=&quot;胡小黑&quot;/&gt;</span></span><br><span class="line"><span class="comment">         &lt;property name=&quot;cat&quot;  ref=&quot;cat&quot;/&gt;</span></span><br><span class="line"><span class="comment">         &lt;property name=&quot;dog&quot;  ref=&quot;dog&quot;/&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     &lt;/bean&gt;</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--   ByName:会自动 在容器上下文查找，和自己对象set方法后边对应的 beanid--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    &lt;bean id=&quot;people&quot; class=&quot;com.xh.People&quot; autowire=&quot;byName&quot;&gt;</span></span><br><span class="line"><span class="comment">            &lt;property name=&quot;name&quot; value=&quot;是小胡呀&quot;/&gt;</span></span><br><span class="line"><span class="comment">        &lt;/bean&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--    ByType 不会根据id进行查找，和自己对象属性类型相同的bean--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;bean id=&quot;people&quot; class=&quot;com.xh.People&quot; autowire=&quot;byType&quot;&gt;</span></span><br><span class="line"><span class="comment">        &lt;property name=&quot;name&quot; value=&quot;是小胡呀&quot;/&gt;</span></span><br><span class="line"><span class="comment">    &lt;/bean&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xh;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">People</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span>  Cat cat;</span><br><span class="line">    <span class="meta">@Autowired</span>  <span class="comment">//使用之后get set方法都不需要了。</span></span><br><span class="line">    <span class="keyword">private</span>  Dog dog;</span><br><span class="line">    <span class="keyword">private</span>  String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;People&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;cat=&quot;</span> + cat +</span><br><span class="line">                <span class="string">&quot;, dog=&quot;</span> + dog +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Cat <span class="title function_">getCat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCat</span><span class="params">(Cat cat)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cat = cat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Dog <span class="title function_">getDog</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDog</span><span class="params">(Dog dog)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dog = dog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>直接在属性上使用，也可以在set方式上使用</p><p>使用Autowired我们连set方法都不需要使用了，前提条件是你这个自动装配的属性在IOC（Spring）容器中存在，且符合byName;</p><p>科普：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span> 字段标记了这个注解，说明字段可以为<span class="literal">null</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Autowired &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">required</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired(required = false)</span> <span class="comment">//如果显示的定义了Autowired的required为false标志这个值可以为空否则不允许为空</span></span><br><span class="line">   </span><br></pre></td></tr></table></figure><p>如果@Autowired自动装配环境比较复杂的时候自动装配无法通过一个注解@Autowired完成的时候，使用@Qualifier(value=”<em>*</em>“)去配置@Autowired的使用，指定一个唯一的bean对象注入</p><p>java自带@Resource</p><p>@Resource注解，首先去spring容器中查找id名字，找不到查找类型，在找不到报错。唯一，不能查找重复的.</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Autowired</span><span class="comment">//使用之后get set方法都不需要了。</span></span><br><span class="line"><span class="variable">@Qualifier</span>(value = <span class="string">&quot;dog&quot;</span>) <span class="comment">//如果存在多对相同的，需要精准查找到一个，就需要这个注解指定了</span></span><br><span class="line">private  Dog dog;</span><br></pre></td></tr></table></figure></li></ol><p>   @Resource</p>   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Resource(name=&quot;cat&quot;)</span></span><br><span class="line">    <span class="keyword">private</span>  Cat cat;</span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span>  Dog dog;</span><br></pre></td></tr></table></figure><p>   @Resource 和     @Autowired区别</p><ol><li>都是用来自动装配的，都可以放到属性字段上</li><li>@Autowired 通过byname的方式实现,而且必须要求这个对象存在，否则报错</li><li>@Resource首先去spring容器中查找id名字，找不到查找类型（ByType），在找不到报错。唯一，不能查找重复的.</li><li>执行顺序不同 @Autowired通过ByType的方式实现，@Resource默认通过byName的方式实现</li></ol><h1 id="6-使用注解开发"><a href="#6-使用注解开发" class="headerlink" title="6 使用注解开发"></a>6 使用注解开发</h1><p>在spring4以后，要使用注解开发，必须导入Aop依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--指定要扫描的包，这个包下面的注解就会生效--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.xh&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>&gt;</span><span class="tag">&lt;/<span class="name">context:annotation-config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;bean id=&quot;user&quot; class=&quot;com.xh.dao.User&quot;/&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li><p>bean注入</p></li><li><p>属性如何注入</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">// 组件 等价于&lt;bean id=&quot;user&quot; class=&quot;com.xh.dao.User&quot;/&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>  String name ; <span class="comment">//= &quot;小黑&quot;;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//相当于&lt;property name=&quot;name&quot; value=&quot;小黑&quot;&gt;</span></span><br><span class="line">    <span class="meta">@Value(&quot;小黑&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><ol><li><p>衍生的注解</p><p>@Component 有几个衍生注解，我们在web开发中，会按照mvc三层架构分层</p><p>dao 【@Repository】</p><p>bean 【@Service】</p><p>service 【@Controller】</p><p>这四个注解功能都是一样的，都是代表将某个类注册到spring中装配。</p></li><li><p>自动装配配置</p><p>@Autowired</p></li><li><p>作用域</p><p>@Scope(“”)  指定模式 单例或者原型模式</p></li><li><p>总结</p><p>xml与注解</p><ul><li><p>Xml更加万能，适用于任何场所！维护方便简单</p></li><li><p>注解 不是自己的类使用不了，维护相对复杂！</p></li></ul><p>Xml与注解最佳实践</p><ul><li><p>xml用来管理bean</p></li><li><p>注解只负责完成属性的注入</p></li><li><p>我们在使用的过程中只需要注意一个问题：只需要开启注解的支持。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.xh&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>&gt;</span><span class="tag">&lt;/<span class="name">context:annotation-config</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><h1 id="7-使用java方式配置spring"><a href="#7-使用java方式配置spring" class="headerlink" title="7 使用java方式配置spring"></a>7 使用java方式配置spring</h1><p>javaConfig</p><p>实体类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xh.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>  <span class="comment">//这里这个注解的意思说明这个类被注册到Spring中</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Value(&quot;罗小黑&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xh.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xh.bean.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">//这个也会被Spring容器托管，注册到容器中</span></span><br><span class="line"><span class="comment">//因为他@Configuration代表这个是一个配置类，就和我们之前看的bean.xml</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.xh&quot;)</span></span><br><span class="line"><span class="meta">@Import(UserConfig1.class)</span> <span class="comment">//导入另一个配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserConfig</span> &#123;</span><br><span class="line">   <span class="meta">@Bean</span>  <span class="comment">//注册一个bean就相当于一个Springxml的bean表情</span></span><br><span class="line">   <span class="comment">//这个名字的方法，就想当与</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span>  <span class="title class_">User</span>();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.xh.bean.User;</span><br><span class="line"><span class="keyword">import</span> com.xh.config.UserConfig;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span>  <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//如果完全使用了配置类的方式去做，我们就只能通过AnnotationConfig 上下文来获取容器</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(UserConfig.class);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;user&quot;</span>,User.class);</span><br><span class="line">        System.out.println(</span><br><span class="line">                user.getName()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这种纯java的配置在SringBoot随处可见。</p><h1 id="8-AOP-之前代理模式"><a href="#8-AOP-之前代理模式" class="headerlink" title="8 AOP 之前代理模式"></a>8 AOP 之前代理模式</h1><p>为什么要学习代理模式？</p><p>这就是SpringAop的底层 【Spring AOP 】 【Spring MVC】 </p><h3 id="8-1-静态代理模式-："><a href="#8-1-静态代理模式-：" class="headerlink" title="8.1 静态代理模式 ："></a>8.1 静态代理模式 ：</h3><ul><li><p>静态代理模式 ：</p><ul><li><p>抽象角色： 一般使用接口和抽象类来解决</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Rent</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li><p>真实角色： 被代理的角色 </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Host</span> <span class="keyword">implements</span> <span class="title class_">Rent</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;房东出租房子&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>代理角色： 代理真实角色，代理真实角色后，我们一般会做一些附属操作</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Proxy</span> <span class="keyword">implements</span> <span class="title class_">Rent</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Host host;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Proxy</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Proxy</span><span class="params">(Host host)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.host = host;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span> &#123;</span><br><span class="line">        host.rent();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//中介带你看房</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">seeHouse</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;中介带你看房&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//收取中介费用</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fare</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;收取中介费&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>客户:访问代理角色</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="comment">/* Host host = new Host();</span></span><br><span class="line"><span class="comment">        host.rent();*/</span></span><br><span class="line">        <span class="comment">//房东不在，找代理</span></span><br><span class="line">        <span class="type">Host</span> <span class="variable">host</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Host</span>();</span><br><span class="line">        <span class="comment">//代理 中介帮房东租房子，代理一般有附属条件</span></span><br><span class="line">        <span class="type">Proxy</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(host);</span><br><span class="line">        <span class="comment">//你不需要面对房东，直接可以租到房子</span></span><br><span class="line">        proxy.rent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>代理模式的好处</p><ul><li><p>可以使得真实角色的操作更加纯粹，不用去关注一些公共的业务</p></li><li><p>公共也就交给代理角色，实现了业务分工</p></li><li>公共业务发生拓展的时候，方便集中管理</li></ul><p>缺点</p><p>一个真实的角色会产生一个代理角色，代码量会翻倍，开发效率会变低。</p></li></ul><h3 id="8-2-再次理解"><a href="#8-2-再次理解" class="headerlink" title="8.2 再次理解"></a>8.2 再次理解</h3><p>对应demo02.</p><h3 id="8-3-动态代理"><a href="#8-3-动态代理" class="headerlink" title="8.3 动态代理"></a>8.3 动态代理</h3><ul><li><p>动态代理和静态代理一样</p></li><li><p>动态代理的代理是动态生成的，不是我们直接写好的</p></li><li><p>动态代理底层是反射</p></li><li><p>动态代理分为两大类： 基于接口的动态代理，基于类的动态代理</p><ul><li>基于接口 —- JDK实现动态代理</li><li>基于类： cglib</li><li>java字节码实现：javaist</li></ul><p>需要了解两个类Proxy，InvocationHandler</p><p>动态代理的好处：</p><ul><li><p>可以使得真实角色的操作更加纯粹，不用去关注一些公共的业务。</p></li><li><p>公共业绩交给了代理角色，实现了业务的分工</p></li><li><p>公共业务发生拓展的时候，方便集中管理</p></li><li><p>一个动态代理类代理的是一个接口，一般就是对应一类接口。</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//真实角色</span></span><br><span class="line">        <span class="type">Host</span> <span class="variable">host</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Host</span>();</span><br><span class="line">        <span class="comment">//代理角色：现在没有</span></span><br><span class="line">        <span class="type">ProxyInvocationHandler</span> <span class="variable">proxyInvocationHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProxyInvocationHandler</span>();</span><br><span class="line">        proxyInvocationHandler.setRent(host);</span><br><span class="line">        <span class="type">Rent</span> <span class="variable">proxy</span> <span class="operator">=</span> (Rent) proxyInvocationHandler.getProxy();</span><br><span class="line">        proxy.rent();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Host</span> <span class="keyword">implements</span> <span class="title class_">Rent</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;房东出租房子&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyInvocationHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="comment">//被代理的接口</span></span><br><span class="line">    <span class="keyword">private</span> Rent rent;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Rent <span class="title function_">getRent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> rent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRent</span><span class="params">(Rent rent)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.rent = rent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getProxy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span>  Proxy.newProxyInstance(<span class="built_in">this</span>.getClass().getClassLoader(),rent.getClass().getInterfaces(),<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//动态代理实例，并返回结果</span></span><br><span class="line">        seeHouse();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(rent,args);</span><br><span class="line">        face();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title function_">seeHouse</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;中介看房子&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title function_">face</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;收取中介费用&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Rent</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserServiceImpl</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">        <span class="comment">//代理角色不存在</span></span><br><span class="line">        <span class="type">ProxyInvocationHandler</span> <span class="variable">pih</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProxyInvocationHandler</span>();</span><br><span class="line">        pih.setTarget(userService);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">proxy</span> <span class="operator">=</span> (UserService) pih.getProxy();</span><br><span class="line">        proxy.delete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyInvocationHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="comment">//被代理的接口</span></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTarget</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getProxy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span>  Proxy.newProxyInstance(<span class="built_in">this</span>.getClass().getClassLoader(),target.getClass().getInterfaces(),<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//动态代理实例，并返回结果</span></span><br><span class="line">        log(method.getName());<span class="comment">//反射方法</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target,args);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行了&quot;</span>+ msg + <span class="string">&quot;方法&quot;</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>​    </p></li></ul><h1 id="9-spring-Aop-面向切面编程"><a href="#9-spring-Aop-面向切面编程" class="headerlink" title="9 spring Aop(面向切面编程)"></a>9 spring Aop(面向切面编程)</h1><h3 id="9-1什么是Aop"><a href="#9-1什么是Aop" class="headerlink" title="9.1什么是Aop"></a>9.1什么是Aop</h3><p>aop是面向切面编程，通过预编译方式和运行期动态实现程序功能的唯一维护的一种技术，Aop是OOP的延续，是软件开发中的一个热点，也是Spring框架中的一个重要内容，是函数式编程的一种衍生范式，利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各个部分之间的耦合度降低，提高程序的可重用性，同时提高开发的效率。</p><h3 id="9-2-Aop在spring的作用"><a href="#9-2-Aop在spring的作用" class="headerlink" title="9. 2 Aop在spring的作用"></a>9. 2 Aop在spring的作用</h3><p><strong>提供声明式事务；允许用户自定义切面</strong></p><ul><li>横切关注（ASPECT）:横切关注点，被模块化的特殊对象。（类）</li><li>切面（ASPECT）:切面必须要完成的工作。（类的方法）</li><li>目标（Advice）: 被通知对象。</li><li>代理（Proxy）:向目标对象应用通知之后创建的对象。</li><li>切入点（PointCut）:切面通知执行的“地点”的定义</li><li>连接点（joinPoint）: 与切入点匹配的执行点。</li></ul><p>Spring Aop中支持5种类型的Advice</p><p>前置通知： 方法前</p><p>后置通知： 方法后</p><p>环绕通知：方法前后</p><p>异常抛出通知： 方法抛出异常</p><p>引介通知：类中增加新的方法属性</p><h3 id="9-3-Spring中使用Aop"><a href="#9-3-Spring中使用Aop" class="headerlink" title="9.3 Spring中使用Aop"></a>9.3 Spring中使用Aop</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!--使用springApi必须必须导入的包--&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- an HTTP Session-scoped bean exposed as a proxy --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userPreferences&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.UserPreferences&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;session&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- instructs the container to proxy the surrounding bean --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:scoped-proxy</span>/&gt;</span> (1)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- a singleton-scoped bean injected with a proxy to the above bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.SimpleUserService&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- a reference to the proxied userPreferences bean --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userPreferences&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userPreferences&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>方式一：使用spring的API接口【主要SpringAPI接口实现】</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;add一个用户&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;delete一个用户&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;update一个用户&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">query</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;query一个用户&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">query</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Log</span> <span class="keyword">implements</span> <span class="title class_">MethodBeforeAdvice</span> &#123;</span><br><span class="line">   <span class="comment">//method:要执行的目标对象的方法</span></span><br><span class="line">    <span class="comment">//objects: 参数</span></span><br><span class="line">    <span class="comment">//target 目标对象</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(target.getClass().getName()+<span class="string">&quot;的&quot;</span>+method.getName()+<span class="string">&quot;被执行了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AfterLog</span> <span class="keyword">implements</span> <span class="title class_">AfterReturningAdvice</span> &#123;</span><br><span class="line">   <span class="comment">//returnValue:返回值</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">(Object returnValue, Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行了&quot;</span>+ method.getName()+ <span class="string">&quot;方法，返回结果为&quot;</span>+returnValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">     <span class="comment">//注意，动态代理，代理的是接口</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) context.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        userService.add();</span><br><span class="line">        userService.query();</span><br><span class="line">        userService.update();</span><br><span class="line">        userService.delete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--        注册bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.service.UserServiceImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;log&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.log.Log&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;afterLog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.log.AfterLog&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--   配置aop--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        切入点--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pointcut&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.xh.service.UserServiceImpl.*(..))&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--执行环绕增加--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;log&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointcut&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;afterLog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointcut&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>方式二：自定义来实现AOP【主要是切面定义】</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--        注册bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.service.UserServiceImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;log&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.log.Log&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;afterLog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.log.AfterLog&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 方式一：需要原生SpringAop接口</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      配置aop：需要导入AOp约束--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  &lt;aop:config&gt;</span></span><br><span class="line"><span class="comment">          &amp;lt;!&amp;ndash;切入点&amp;ndash;&amp;gt;</span></span><br><span class="line"><span class="comment">          &lt;aop:pointcut id=&quot;pointcut&quot; expression=&quot;execution(* com.xh.service.UserServiceImpl.*(..))&quot;/&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">          &amp;lt;!&amp;ndash;执行环绕增加&amp;ndash;&amp;gt;</span></span><br><span class="line"><span class="comment">          &lt;aop:advisor advice-ref=&quot;log&quot; pointcut-ref=&quot;pointcut&quot;/&gt;</span></span><br><span class="line"><span class="comment">          &lt;aop:advisor advice-ref=&quot;afterLog&quot; pointcut-ref=&quot;pointcut&quot;/&gt;</span></span><br><span class="line"><span class="comment">      &lt;/aop:config&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 方式二  自定义类 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;diy&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.diy.DiyPointCut&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--自定义切面 ref要引用的类--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;diy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--切入点--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;point&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.xh.service.UserServiceImpl.*(..))&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--  通知 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;before&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;point&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;after&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;point&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DiyPointCut</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法执行前&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;方法执行后&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">     <span class="comment">//注意，动态代理，代理的是接口</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) context.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        userService.add();</span><br><span class="line">        userService.query();</span><br><span class="line">        userService.update();</span><br><span class="line">        userService.delete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>方法三：使用注解</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">&lt;!--方式三--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;annotationPointCut&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.diy.AnnotationPointCut&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--   开启注解支持  JDK（默认 proxy-target-class=&quot;false&quot;） cglib(proxy-target-class=&quot;true&quot;)--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> /&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//方式三使用注解来实现</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//标注这个类是一个切面</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnnotationPointCut</span> &#123;</span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.xh.service.UserServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=====方法执行前======&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;execution(* com.xh.service.UserServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=====方法执行后======&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在环绕增强中，我们可以给定一个类，代表我们要处理切入的点</span></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.xh.service.UserServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">around</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//  Signature signature = proceedingJoinPoint.getSignature();//获得签名</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">//   System.out.println(&quot;signature:&quot; + signature);</span></span><br><span class="line">        <span class="comment">//执行方法</span></span><br><span class="line">        System.out.println(<span class="string">&quot;环绕前&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">proceed</span> <span class="operator">=</span>  proceedingJoinPoint.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;环绕后&quot;</span>);</span><br><span class="line">        System.out.println(proceed);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="10-spring整合Mybatis"><a href="#10-spring整合Mybatis" class="headerlink" title="10  spring整合Mybatis"></a>10  spring整合Mybatis</h1><p>回顾mybatis:</p><ol><li><p>编写实体类</p></li><li><p>编写核心配置文件</p></li><li><p>编写接口</p></li><li><p>编写mapper.xml</p></li><li><p>测试</p></li></ol><h1 id="11-Spring声明事务"><a href="#11-Spring声明事务" class="headerlink" title="11 .Spring声明事务"></a>11 .Spring声明事务</h1><p>把一组业务当成一个业务来做，要么成功要么失败</p><p>事务在项目中，十分重要，涉及到数据的一致性问题，不能马虎。</p><p>确保完整性和一致性</p><h4 id="ACID"><a href="#ACID" class="headerlink" title="ACID:"></a>ACID:</h4><p>原子性：要么执行要么都不执行</p><p>隔离性：多个业务可以操作同一个资源防止数据损坏</p><p>持久性： 事务一旦提交，无论系统发生什么问题，结果都不会再被影响，被持久化的写到存储器中。</p><p>一致性：</p><h4 id="Spring中事务的声明："><a href="#Spring中事务的声明：" class="headerlink" title="Spring中事务的声明："></a>Spring中事务的声明：</h4><p>AOP ： 声明式事务</p><p>编程式事务：需要在代码中进行事务的管理</p><h4 id="为什么要事务？"><a href="#为什么要事务？" class="headerlink" title="为什么要事务？"></a>为什么要事务？</h4><blockquote><p>如果没有事务，可能存在数据提交不一致。</p><p>如果我们不在Spring中去配置声明式事务，我们就需要在代码中手动设置事务。</p><p>事务在项目的开发中很重要，涉及到项目的完整性和一致性。</p><p>在spring中需要注意：在配置的过程中需要注意空格。</p><p>有空格和没有空格的区别是很大的。</p></blockquote>]]></content>
    
    
    <summary type="html">作为java框架界最受欢迎的框架之一，Spring的IOC和AOP两大思想及其重要，以至于之后衍生出来的Spring框架都使用了这一操作</summary>
    
    
    
    <category term="java学习" scheme="https://www.blog.909111.xyz/categories/java%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="Spring" scheme="https://www.blog.909111.xyz/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>Vue2学习笔记和实例</title>
    <link href="https://www.blog.909111.xyz/posts/640a35.html"/>
    <id>https://www.blog.909111.xyz/posts/640a35.html</id>
    <published>2023-11-09T02:50:23.339Z</published>
    <updated>2024-04-22T08:23:52.781Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Vue2"><a href="#Vue2" class="headerlink" title="Vue2"></a>Vue2</h1><h2 id="一-什么是Vue"><a href="#一-什么是Vue" class="headerlink" title="一.什么是Vue?"></a>一.什么是Vue?</h2><p>Vue (读音 /vjuː/，类似于 <strong>view</strong>) 是一套用于构建用户界面的<strong>渐进式框架</strong>。与其它大型框架不同的是，Vue 被设计为可以自底向上逐层应用。Vue 的核心库只关注视图层，不仅易于上手，还便于与第三方库或既有项目整合。另一方面，当与<a href="https://v2.cn.vuejs.org/v2/guide/single-file-components.html">现代化的工具链</a>以及各种<a href="https://github.com/vuejs/awesome-vue#libraries--plugins">支持类库</a>结合使用时，Vue 也完全能够为复杂的单页应用提供驱动。</p><h3 id="1-1-安装vue"><a href="#1-1-安装vue" class="headerlink" title="1.1 安装vue"></a>1.1 安装vue</h3><p>尝试 Vue.js 最简单的方法是使用 <a href="https://codesandbox.io/s/github/vuejs/v2.vuejs.org/tree/master/src/v2/examples/vue-20-hello-world">Hello World 例子</a>。你可以在浏览器新标签页中打开它，跟着例子学习一些基础用法。或者你也可以<a href="https://github.com/vuejs/v2.vuejs.org/blob/master/src/v2/examples/vue-20-hello-world/index.html">创建一个 <code>.html</code> 文件</a>，然后通过如下方式引入 Vue： </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开发环境版本，包含了有帮助的命令行警告 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>或者：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 生产环境版本，优化了尺寸和速度 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="1-2-声明式渲染"><a href="#1-2-声明式渲染" class="headerlink" title="1.2 声明式渲染"></a>1.2 声明式渲染</h3><p>实际上这个就是将数据可以动态采用简介的模版语法来声明式地将数据渲染进DOM系统中。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123; message &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>:&#123;</span><br><span class="line">        <span class="attr">message</span>:<span class="string">&quot;Miaow.Y.Hu!&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>至此，我们就完成了第一个vue应用，粗看就是渲染了一个字符串模版，但是其实vue在背后做了大量的工作。其所有的东西都是响应式的。我们通过确认的方法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vm.message;</span><br><span class="line">//或者</span><br><span class="line">vm.message = <span class="string">&quot;miao&quot;</span>;</span><br></pre></td></tr></table></figure><p>你就可以看到上例相应的进行更新。</p><p>注意我们不再和HTML进行交互处理了。一个vue应用将会挂载到一个DOM元素上，这个例子是<code>#app</code>然后对其进行完全控制。</p><p>除了文本插入值，还有：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app-2&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-bind:title</span>=<span class="string">&quot;message&quot;</span>&gt;</span></span><br><span class="line">    鼠标悬停几秒钟查看此处动态绑定的提示信息！</span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app2 = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app-2&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;页面加载于 &#x27;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toLocaleString</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>这里我们遇到了一点新东西。你看到的 <code>v-bind</code> attribute 被称为<strong>指令</strong>。指令带有前缀 <code>v-</code>，以表示它们是 Vue 提供的特殊 attribute。可能你已经猜到了，它们会在渲染的 DOM 上应用特殊的响应式行为。在这里，该指令的意思是：“将这个元素节点的 <code>title</code> attribute 和 Vue 实例的 <code>message</code> property 保持一致”。</p><p>如果你再次打开浏览器的 JavaScript 控制台，输入 <code>app2.message = &#39;新消息&#39;</code>，就会再一次看到这个绑定了 <code>title</code> attribute 的 HTML 已经进行了更新。</p><h3 id="1-3-条件与循环"><a href="#1-3-条件与循环" class="headerlink" title="1.3 条件与循环"></a>1.3 条件与循环</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app-3&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;seen&quot;</span>&gt;</span>现在你看到我了<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app3 = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app-3&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">seen</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>继续在控制台输入 <code>app3.seen = false</code>，你会发现之前显示的消息消失了。</p><p>这个例子演示了我们不仅可以把数据绑定到 DOM 文本或 attribute，还可以绑定到 DOM <strong>结构</strong>。此外，Vue 也提供一个强大的过渡效果系统，可以在 Vue 插入/更新/移除元素时自动应用<a href="https://v2.cn.vuejs.org/v2/guide/transitions.html">过渡效果</a>。</p><p>还有其它很多指令，每个都有特殊的功能。例如，<code>v-for</code> 指令可以绑定数组的数据来渲染一个项目列表：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app-4&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;todo in todos&quot;</span>&gt;</span></span><br><span class="line">      &#123;&#123; todo.text &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app4 = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app-4&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">todos</span>: [</span><br><span class="line">      &#123; <span class="attr">text</span>: <span class="string">&#x27;学习 JavaScript&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">text</span>: <span class="string">&#x27;学习 Vue&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">text</span>: <span class="string">&#x27;整个牛项目&#x27;</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>在控制台里，输入 <code>app4.todos.push(&#123; text: &#39;新项目&#39; &#125;)</code>，你会发现列表最后添加了一个新项目。 </p><h3 id="1-4-处理用输入"><a href="#1-4-处理用输入" class="headerlink" title="1.4 处理用输入"></a>1.4 处理用输入</h3><p>为了让用户和你的应用进行交互，我们可以用 <code>v-on</code> 指令添加一个事件监听器，通过它调用在 Vue 实例中定义的方法： </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app-5&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;reverseMessage&quot;</span>&gt;</span>反转消息<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app5 = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app-5&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;Hello Vue.js!&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="attr">reverseMessage</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">message</span> = <span class="variable language_">this</span>.<span class="property">message</span>.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>注意在 <code>reverseMessage</code> 方法中，我们更新了应用的状态，但没有触碰 DOM——所有的 DOM 操作都由 Vue 来处理，你编写的代码只需要关注逻辑层面即可。 </p><p>Vue 还提供了 <code>v-model</code> 指令，它能轻松实现表单输入和应用状态之间的双向绑定。 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app-6&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;message&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app6 = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app-6&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;Hello Vue!&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="1-5-组件化应用构建"><a href="#1-5-组件化应用构建" class="headerlink" title="1.5 组件化应用构建"></a>1.5 组件化应用构建</h3><p>组件系统是 Vue 的另一个重要概念，因为它是一种抽象，允许我们使用小型、独立和通常可复用的组件构建大型应用。仔细想想，几乎任意类型的应用界面都可以抽象为一个组件树： </p><p><img src="https://v2.cn.vuejs.org/images/components.png" alt="Component Tree"> </p><p>在 Vue 里，一个组件本质上是一个拥有预定义选项的一个 Vue 实例。在 Vue 中注册组件很简单： </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>罗小黑<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 创建一个todo-item组件的示例 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      现在我们为每个 todo-item 提供 todo 对象</span></span><br><span class="line"><span class="comment">      todo 对象是变量，即其内容可以是动态的。</span></span><br><span class="line"><span class="comment">      我们也需要为每个组件提供一个“key”，稍后再</span></span><br><span class="line"><span class="comment">      作详细解释。</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">todo-item</span></span></span><br><span class="line"><span class="tag"><span class="attr">v-for</span>=<span class="string">&quot;item in groceryList&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">v-bind:todo</span>=<span class="string">&quot;item&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">v-bind:key</span>=<span class="string">&quot;item.id&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">todo-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">todo-item</span></span></span><br><span class="line"><span class="tag"><span class="attr">v-for</span>=<span class="string">&quot;item in secondList&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">v-bind:todo</span>=<span class="string">&quot;item&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">v-bind:key</span>=<span class="string">&quot;item.id&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">todo-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入vue.js --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入element ui样式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../css/element/index.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/element/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> <span class="title class_">TodoItem</span>=&#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">props</span>:[<span class="string">&quot;todo&quot;</span>],</span></span><br><span class="line"><span class="language-javascript"><span class="attr">template</span>:<span class="string">&quot;&lt;li&gt;&#123;&#123;todo.text&#125;&#125;&lt;/li&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> secondItem=&#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">props</span>:[<span class="string">&quot;todo1&quot;</span>],</span></span><br><span class="line"><span class="language-javascript"><span class="attr">template</span>:<span class="string">&quot;&lt;li&gt;&#123;&#123;todo1.text&#125;&#125;&lt;/li&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 注意new 的Vue必须是大写字母开头的</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">components</span>:&#123;</span></span><br><span class="line"><span class="language-javascript"><span class="title class_">TodoItem</span>:<span class="title class_">TodoItem</span>,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">secondItem</span>:secondItem</span></span><br><span class="line"><span class="language-javascript">&#125;,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">groceryList</span>:[</span></span><br><span class="line"><span class="language-javascript">&#123;<span class="attr">id</span>:<span class="number">0</span>,<span class="attr">text</span>:<span class="string">&quot;蔬菜&quot;</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">&#123;<span class="attr">id</span>:<span class="number">1</span>,<span class="attr">text</span>:<span class="string">&quot;奶酪&quot;</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">&#123;<span class="attr">id</span>:<span class="number">2</span>,<span class="attr">text</span>:<span class="string">&quot;随便其他什么人吃的东西&quot;</span>&#125;</span></span><br><span class="line"><span class="language-javascript">],</span></span><br><span class="line"><span class="language-javascript"><span class="attr">secondList</span>:[</span></span><br><span class="line"><span class="language-javascript">&#123;<span class="attr">id</span>:<span class="number">0</span>,<span class="attr">text</span>:<span class="string">&quot;学习雷锋好榜样&quot;</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">&#123;<span class="attr">id</span>:<span class="number">1</span>,<span class="attr">text</span>:<span class="string">&quot;忠于革命忠于党&quot;</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">&#123;<span class="attr">id</span>:<span class="number">2</span>,<span class="attr">text</span>:<span class="string">&quot;天天向上&quot;</span>&#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">]</span></span><br><span class="line"><span class="language-javascript">&#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;);</span></span><br><span class="line"><span class="language-javascript"><span class="comment">// 这样的方式是不行的</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// Vue.component(&quot;todo-item&quot;,&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// //todo-item 组件现在接收一个</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// // &quot;prop&quot; , 类似于一个自定义attribute.</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// //这个prop名字叫做todo</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// props:[&quot;todo&quot;],</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// template:&quot;&lt;li&gt;这是个待办项&#123;&#123;todo.text&#125;&#125;&lt;/li&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// &#125;)</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-6-与自定义元素的关系"><a href="#1-6-与自定义元素的关系" class="headerlink" title="1.6 与自定义元素的关系"></a>1.6 与自定义元素的关系</h3><p>你可能已经注意到 Vue 组件非常类似于<strong>自定义元素</strong>——它是 <a href="https://www.w3.org/wiki/WebComponents/">Web 组件规范</a>的一部分，这是因为 Vue 的组件语法部分参考了该规范。例如 Vue 组件实现了 <a href="https://github.com/w3c/webcomponents/blob/gh-pages/proposals/Slots-Proposal.md">Slot API</a> 与 <code>is</code> attribute。但是，还是有几个关键差别：</p><ol><li>Web Components 规范已经完成并通过，但未被所有浏览器原生实现。目前 Safari 10.1+、Chrome 54+ 和 Firefox 63+ 原生支持 Web Components。相比之下，Vue 组件不需要任何 polyfill，并且在所有支持的浏览器 (IE9 及更高版本) 之下表现一致。必要时，Vue 组件也可以包装于原生自定义元素之内。</li><li>Vue 组件提供了纯自定义元素所不具备的一些重要功能，最突出的是跨组件数据流、自定义事件通信以及构建工具集成。</li></ol><p>虽然 Vue 内部没有使用自定义元素，不过在应用使用自定义元素、或以自定义元素形式发布时，<a href="https://custom-elements-everywhere.com/#vue">依然有很好的互操作性</a>。Vue CLI 也支持将 Vue 组件构建成为原生的自定义元素。</p><h2 id="二、Vue实例"><a href="#二、Vue实例" class="headerlink" title="二、Vue实例"></a>二、Vue实例</h2><h3 id="模版语法"><a href="#模版语法" class="headerlink" title="模版语法"></a>模版语法</h3><p>Vue.js 使用了基于 HTML 的模板语法，允许开发者声明式地将 DOM 绑定至底层 Vue 实例的数据。所有 Vue.js 的模板都是合法的 HTML，所以能被遵循规范的浏览器和 HTML 解析器解析。</p><p>在底层的实现上，Vue 将模板编译成虚拟 DOM 渲染函数。结合响应系统，Vue 能够智能地计算出最少需要重新渲染多少组件，并把 DOM 操作次数减到最少。</p><p>最常见的语法是</p><p><code>只要message的 property值改变，那么以上的message的值也会随之改变。</code></p><p>但是通过使用v-once指令，可以执行一次性地插值，当数据改变的时候，插值处的内容并不会更新</p><p><code>&lt;span v-once&gt;这个值不会被改变： &#123;&#123;message&#125;&#125; &lt;/span&gt;</code></p><p><strong>v-html与v-text有区别，v-html会渲染成我们的html代码，因为一般双大括号将数据解释为普通文本，并非HTML代码，为了成为HTML代码，我们将采用v-html;</strong></p><p>例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Using mustaches: &#123;&#123; rawHtml &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Using v-html directive: <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-html</span>=<span class="string">&quot;rawHtml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Mustache 语法不能作用在 HTML attribute 上，遇到这种情况应该使用 <a href="https://v2.cn.vuejs.org/v2/api/#v-bind"><code>v-bind</code> 指令</a>：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">div</span> v-bind:<span class="built_in">id</span>=<span class="string">&quot;dynamicId&quot;</span>&gt;&lt;/<span class="keyword">div</span>&gt;</span><br></pre></td></tr></table></figure><p>对于布尔 attribute (它们只要存在就意味着值为 <code>true</code>)，<code>v-bind</code> 工作起来略有不同，在这个例子中：</p><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">button</span> v-bind:disabled=<span class="string">&quot;isButtonDisabled&quot;</span>&gt;<span class="keyword">Button</span>&lt;/<span class="keyword">button</span>&gt;</span><br></pre></td></tr></table></figure><p>如果 <code>isButtonDisabled</code> 的值是 <code>null</code>、<code>undefined</code> 或 <code>false</code>，则 <code>disabled</code> attribute 甚至不会被包含在渲染出来的 <code>&lt;button&gt;</code> 元素中。</p><h4 id="使用-JavaScript-表达式"><a href="#使用-JavaScript-表达式" class="headerlink" title="使用 JavaScript 表达式"></a>使用 JavaScript 表达式</h4><p>迄今为止，在我们的模板中，我们一直都只绑定简单的 property 键值。但实际上，对于所有的数据绑定，Vue.js 都提供了完全的 JavaScript 表达式支持。 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; number + 1 &#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123; ok ? &#x27;YES&#x27; : &#x27;NO&#x27; &#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123; message.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;) &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:id</span>=<span class="string">&quot;&#x27;list-&#x27; + id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这些表达式会在所属 Vue 实例的数据作用域下作为 JavaScript 被解析。有个限制就是，每个绑定都只能包含<strong>单个表达式</strong>，所以下面的例子都<strong>不会</strong>生效。 </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这是语句，不是表达式 --&gt;</span></span><br><span class="line">&#123;&#123; var a = 1 &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 流控制也不会生效，请使用三元表达式 --&gt;</span></span><br><span class="line">&#123;&#123; if (ok) &#123; return message &#125; &#125;&#125;</span><br></pre></td></tr></table></figure><p>模板表达式都被放在沙盒中，只能访问<a href="https://github.com/vuejs/vue/blob/v2.6.10/src/core/instance/proxy.js#L9">全局变量的一个白名单</a>，如 <code>Math</code> 和 <code>Date</code> 。你不应该在模板表达式中试图访问用户定义的全局变量。</p><h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><p>一些指令能够接收一个“参数”，在指令名称之后以冒号表示。例如，<code>v-bind</code> 指令可以用于响应式地更新 HTML attribute：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:href</span>=<span class="string">&quot;url&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在这里 <code>href</code> 是参数，告知 <code>v-bind</code> 指令将该元素的 <code>href</code> attribute 与表达式 <code>url</code> 的值绑定。</p><p>另一个例子是 <code>v-on</code> 指令，它用于监听 DOM 事件：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-on:click</span>=<span class="string">&quot;doSomething&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="动态参数"><a href="#动态参数" class="headerlink" title="动态参数"></a>动态参数</h4><p>从 2.6.0 开始，可以用方括号括起来的 JavaScript 表达式作为一个指令的参数：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">注意，参数表达式的写法存在一些约束，如之后的“对动态参数表达式的约束”章节所述。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:</span>[<span class="attr">attributeName</span>]=<span class="string">&quot;url&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里的 <code>attributeName</code> 会被作为一个 JavaScript 表达式进行动态求值，求得的值将会作为最终的参数来使用。例如，如果你的 Vue 实例有一个 <code>data</code> property <code>attributeName</code>，其值为 <code>&quot;href&quot;</code>，那么这个绑定将等价于 <code>v-bind:href</code>。</p><p>同样地，你可以使用动态参数为一个动态的事件名绑定处理函数：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-on:</span>[<span class="attr">eventName</span>]=<span class="string">&quot;doSomething&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在这个示例中，当 <code>eventName</code> 的值为 <code>&quot;focus&quot;</code> 时，<code>v-on:[eventName]</code> 将等价于 <code>v-on:focus</code>。</p><h5 id="对动态参数的值的约束"><a href="#对动态参数的值的约束" class="headerlink" title="对动态参数的值的约束"></a>对动态参数的值的约束</h5><p>动态参数预期会求出一个字符串，异常情况下值为 <code>null</code>。这个特殊的 <code>null</code> 值可以被显性地用于移除绑定。任何其它非字符串类型的值都将会触发一个警告。</p><h5 id="对动态参数表达式的约束"><a href="#对动态参数表达式的约束" class="headerlink" title="对动态参数表达式的约束"></a>对动态参数表达式的约束</h5><p>动态参数表达式有一些语法约束，因为某些字符，如空格和引号，放在 HTML attribute 名里是无效的。例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这会触发一个编译警告 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:</span>[&#x27;<span class="attr">foo</span>&#x27; + <span class="attr">bar</span>]=<span class="string">&quot;value&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>变通的办法是使用没有空格或引号的表达式，或用计算属性替代这种复杂表达式。</p><p>在 DOM 中使用模板时 (直接在一个 HTML 文件里撰写模板)，还需要避免使用大写字符来命名键名，因为浏览器会把 attribute 名全部强制转为小写：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">在 DOM 中使用模板时这段代码会被转换为 `v-bind:[someattr]`。</span></span><br><span class="line"><span class="comment">除非在实例中有一个名为“someattr”的 property，否则代码不会工作。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:</span>[<span class="attr">someAttr</span>]=<span class="string">&quot;value&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h4><p>修饰符 (modifier) 是以半角句号 <code>.</code> 指明的特殊后缀，用于指出一个指令应该以特殊方式绑定。例如，<code>.prevent</code> 修饰符告诉 <code>v-on</code> 指令对于触发的事件调用 <code>event.preventDefault()</code>：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">v-on:submit.prevent</span>=<span class="string">&quot;onSubmit&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="缩写"><a href="#缩写" class="headerlink" title="缩写"></a>缩写</h4><p><code>v-</code> 前缀作为一种视觉提示，用来识别模板中 Vue 特定的 attribute。当你在使用 Vue.js 为现有标签添加动态行为 (dynamic behavior) 时，<code>v-</code> 前缀很有帮助，然而，对于一些频繁用到的指令来说，就会感到使用繁琐。同时，在构建由 Vue 管理所有模板的<a href="https://en.wikipedia.org/wiki/Single-page_application">单页面应用程序 (SPA - single page application)</a> 时，<code>v-</code> 前缀也变得没那么重要了。因此，Vue 为 <code>v-bind</code> 和 <code>v-on</code> 这两个最常用的指令，提供了特定简写： </p><h5 id="v-bind"><a href="#v-bind" class="headerlink" title="v-bind"></a>v-bind</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 完整语法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:href</span>=<span class="string">&quot;url&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 缩写 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">:href</span>=<span class="string">&quot;url&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 动态参数的缩写 (2.6.0+) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">:</span>[<span class="attr">key</span>]=<span class="string">&quot;url&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="v-on"><a href="#v-on" class="headerlink" title="v-on"></a>v-on</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 完整语法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-on:click</span>=<span class="string">&quot;doSomething&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 缩写 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">&quot;doSomething&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 动态参数的缩写 (2.6.0+) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> @[<span class="attr">event</span>]=<span class="string">&quot;doSomething&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>它们看起来可能与普通的 HTML 略有不同，但 <code>:</code> 与 <code>@</code> 对于 attribute 名来说都是合法字符，在所有支持 Vue 的浏览器都能被正确地解析。而且，它们不会出现在最终渲染的标记中。</p><h2 id="三、计算属性和侦听器"><a href="#三、计算属性和侦听器" class="headerlink" title="三、计算属性和侦听器"></a>三、计算属性和侦听器</h2><p>Vue脚手架创建项目的方式</p><p>这里提供几种方案：</p><ol><li>升级为vue 3.x版本<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall vue-cli -g</span><br><span class="line">npm install -g @vue/cli</span><br></pre></td></tr></table></figure>2.降级为vue2.x方法<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall @vue/cli -g</span><br><span class="line">npm install -g vue-cli</span><br></pre></td></tr></table></figure>3.vue2.x脚手架的安装和初始化项目<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建项目</span></span><br><span class="line">vue init webpack 项目名字</span><br></pre></td></tr></table></figure>4.vue3.x脚手架的安装和初始化项目<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建项目</span></span><br><span class="line">vue create 项目名字</span><br></pre></td></tr></table></figure></li></ol><p>如何让vue项目跑起来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install dependencies</span></span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line"><span class="comment"># serve with hot reload at localhost:8080</span></span><br><span class="line">npm run dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># build for production with minification</span></span><br><span class="line">npm run build</span><br><span class="line"></span><br><span class="line"><span class="comment"># build for production and view the bundle analyzer report</span></span><br><span class="line">npm run build --report</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">本文主要记录前端vue2学习的一些笔记</summary>
    
    
    
    <category term="前端" scheme="https://www.blog.909111.xyz/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="vue2" scheme="https://www.blog.909111.xyz/tags/vue2/"/>
    
  </entry>
  
  <entry>
    <title>Redis学习</title>
    <link href="https://www.blog.909111.xyz/posts/8434e219.html"/>
    <id>https://www.blog.909111.xyz/posts/8434e219.html</id>
    <published>2023-11-09T02:50:23.338Z</published>
    <updated>2024-04-22T08:23:23.411Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Redis学习"><a href="#Redis学习" class="headerlink" title="Redis学习"></a>Redis学习</h1><p>redis是一个NoSql的（远程字典服务的，key_value的数据库）</p><p><strong>redis 能干嘛</strong></p><ol><li>内存存储，持久化，内存中是断电就失去，所有说持久化很重要</li><li>效率高，可以用于高速缓存</li><li>发布订阅系统</li><li>地图信息统计</li><li>计时器，记数器</li><li>。。。。</li></ol><blockquote><p>特性</p></blockquote><ol><li>多样的数据类型（HashMap ,set ,String ,List ,Zset）</li><li>持久化</li><li>集群</li><li>事务</li><li>。。。。</li></ol><blockquote><p>如何去学习redis</p></blockquote><p>redis官网 ： <a href="https://www.redis.net.cn/">https://www.redis.net.cn/</a></p><p>安装Redis : 这里不写</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">下载redis </span><br><span class="line">docker pull redis</span><br><span class="line"></span><br><span class="line">创建实例并启动</span><br><span class="line">mkdir <span class="operator">-</span>p <span class="operator">/</span>mydata<span class="operator">/</span>redis<span class="operator">/</span>conf      </span><br><span class="line"></span><br><span class="line">touch redis.conf</span><br><span class="line"></span><br><span class="line">docker run <span class="operator">-</span>p <span class="number">6379</span>:<span class="number">6379</span> <span class="comment">--name redis -v /mydata/redis/data:/data \</span></span><br><span class="line">   <span class="operator">-</span>v <span class="operator">/</span>mydata<span class="operator">/</span>redis<span class="operator">/</span>conf<span class="operator">/</span>redis.conf:<span class="operator">/</span>etc<span class="operator">/</span>redis<span class="operator">/</span>redis.conf \</span><br><span class="line">   <span class="operator">-</span>d redis redis<span class="operator">-</span>server <span class="operator">/</span>etc<span class="operator">/</span>redis<span class="operator">/</span>redis.conf</span><br><span class="line"></span><br><span class="line"> ls   查看当前文件夹下的文件</span><br><span class="line"> cat redis.conf</span><br><span class="line"></span><br><span class="line"> 测试redis </span><br><span class="line">  </span><br><span class="line"> docker <span class="keyword">exec</span> <span class="operator">-</span>it redis redis<span class="operator">-</span>cli</span><br><span class="line"> </span><br><span class="line"> <span class="comment">---</span></span><br><span class="line"> 由于以前的数据全存在内存中，从而我们重复读取<span class="keyword">get</span> a的时候会导致失败</span><br><span class="line">[root<span class="variable">@localhost</span> conf]# cat redis.conf</span><br><span class="line">[root<span class="variable">@localhost</span> conf]# docker <span class="keyword">exec</span> <span class="operator">-</span>it redis redis<span class="operator">-</span>cli</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">set</span> a b</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">get</span> a</span><br><span class="line">&quot;b&quot;   <span class="operator">/</span><span class="operator">/</span>从而在一次上来的时候这块是<span class="keyword">null</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> exit</span><br><span class="line"></span><br><span class="line"><span class="comment">--让redis 持久化  ---&gt; pwd</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> exit</span><br><span class="line">[root<span class="variable">@localhost</span> conf]# pwd</span><br><span class="line"><span class="operator">/</span>mydata<span class="operator">/</span>redis<span class="operator">/</span>conf</span><br><span class="line">[root<span class="variable">@localhost</span> conf]# ls</span><br><span class="line">redis.conf</span><br><span class="line">[root<span class="variable">@localhost</span> conf]# vi redis.conf </span><br><span class="line">i</span><br><span class="line">appendonly yes</span><br><span class="line">esc  :wq</span><br><span class="line"> <span class="comment">--由于进入文档后我不知道如何保存，故此我不在继续持久化了 事实上最新的redis自带持久化了</span></span><br><span class="line"></span><br><span class="line">docker restart redis  <span class="operator">/</span><span class="operator">/</span>重启redis</span><br><span class="line"><span class="comment">--设置开机自启动docker 里边容器</span></span><br><span class="line">sudo docker <span class="keyword">update</span> <span class="operator">&lt;</span>容器名<span class="operator">&gt;</span> <span class="comment">--restart=always</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Redis的基础知识"><a href="#Redis的基础知识" class="headerlink" title="Redis的基础知识"></a>Redis的基础知识</h2><p><code>select</code> 选择数据库</p><p><code>keys *</code>  查看所有的key</p><p><code>exists</code> key  查看key是否存在</p><p><code>move  key  id</code> 根据id和key值移除</p><p><code>flushdb</code> 清除当前数据库</p><p><code>flushAll</code> 清除全部数据库中所有数据</p><p><code>set  key value</code> 设置Key和value</p><p><code>get key</code>  获得key的值</p><p><code>expire key 时间</code> 设置过期时间单位秒</p><p><code>ttl key</code> 查看过期时间</p><p><code>type key</code> 查看当前key存到value的数据类型</p><p>为什么redis端口号为6379。(作者使用一个明星的名字)</p><blockquote><p>redis是单线程的</p></blockquote><p>由于redis很快，官方认为，redis是基于内存操作，CPU并不是Redis的性能瓶颈，Redis的瓶颈是根据机械的内存和网络带宽，既然可以使用单线程来实现，那么就使用单线程了。</p><h3 id="Redis为啥使用单线程还是这么快？"><a href="#Redis为啥使用单线程还是这么快？" class="headerlink" title="Redis为啥使用单线程还是这么快？"></a>Redis为啥使用单线程还是这么快？</h3><ol><li><p>误区，高性能的服务器不一点全是多线程的。</p></li><li><p>误区2，多线程并不一定都比单线程效率高。</p><blockquote><p>redis是将数据存放在内存中的，故而使用单线程去操作就比较快，多线程会进行CPU上下文切换，耗时，对于内存系统来说，如果没有上下文切换效率就是最高的，多次读写都是在一个cpu上，在内存情况下，这个就是最佳方案。</p></blockquote></li></ol><h3 id="Redis指令大全"><a href="#Redis指令大全" class="headerlink" title="Redis指令大全"></a>Redis指令大全</h3><h4 id="Redis-Key"><a href="#Redis-Key" class="headerlink" title="Redis-Key"></a>Redis-Key</h4><p><code>select</code> 选择数据库</p><p><code>keys *</code>  查看所有的key</p><p><code>exists</code> key  查看key是否存在</p><p><code>move  key  id</code> 根据id和key值移除</p><p><code>flushdb</code> 清除当前数据库</p><p><code>flushAll</code> 清除全部数据库中所有数据</p><p><code>set  key value</code> 设置Key和value</p><p><code>get key</code>  获得key的值</p><p><code>expire key 时间</code> 设置过期时间单位秒</p><p><code>ttl key</code> 查看过期时间</p><p><code>type key</code> 查看当前key存到value的数据类型</p><p><code>incr  key</code>每次执行都进行加一操作</p><p><code>desc key</code> 每次执行都进行减一操作</p><p><code>getRange key 0 3</code> 截取字符串【0,3】</p><p><code>getRange key 0 -1</code> 截取全部的字符串和get key 是一样的</p><p><code>setrange key 1 xx</code>  替换指定位置开始的字符串</p><p><code>settex (set with expire)  key 过期时间 value</code> 设置过期时间且值为value</p><p><code>setnx (set if not expire)  key</code>   不存在的时候设置（在分布式中会经常使用）也就是说，不存在的时候会自动创建一个key,如果他存在的话，那么就会创建失败</p><p><code>mset key1 value1   key2 value2  ...</code> 可以创建多对key和value</p><p><code>mget  key1 key2 key3 ...</code>可以同时获取多个值</p><p><code>msetnx k1 v1 k2 v2 ...</code>是一个原子性操作，要么一起成功，要么一起失败。</p><h3 id="Redis的数据类型（String-hash-list-set-zset）"><a href="#Redis的数据类型（String-hash-list-set-zset）" class="headerlink" title="Redis的数据类型（String,hash,list,set,zset）"></a>Redis的数据类型（String,hash,list,set,zset）</h3><p>Redis是一个开源（BSD许可），内存存储的数据结构服务器，可用作数据库，高速缓存和消息队列代理。它支持<a href="https://www.redis.net.cn/tutorial/3508.html">字符串</a>、<a href="https://www.redis.net.cn/tutorial/3509.html">哈希表</a>、<a href="https://www.redis.net.cn/tutorial/3510.html">列表</a>、<a href="https://www.redis.net.cn/tutorial/3511.html">集合</a>、<a href="https://www.redis.net.cn/tutorial/3512.html">有序集合</a>，<a href="https://www.redis.net.cn/tutorial/3508.html">位图</a>，<a href="https://www.redis.net.cn/tutorial/3513.html">hyperloglogs</a>等数据类型。内置复制、<a href="https://www.redis.net.cn/tutorial/3516.html">Lua脚本</a>、LRU收回、<a href="https://www.redis.net.cn/tutorial/3515.html">事务</a>以及不同级别磁盘持久化功能，同时通过Redis Sentinel提供高可用，通过Redis Cluster提供自动<a href="https://www.redis.net.cn/tutorial/3524.html">分区</a>。 </p><h4 id="Redis-键-key-命令"><a href="#Redis-键-key-命令" class="headerlink" title="Redis 键(key) 命令"></a>Redis 键(key) 命令</h4><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>Type 命令</td><td>返回 key 所储存的值的类型。</td></tr><tr><td>PEXPIREAT</td><td>设置 key 的过期时间亿以毫秒计。</td></tr><tr><td>PEXPIREAT</td><td>设置 key 过期时间的时间戳(unix timestamp) 以毫秒计</td></tr><tr><td>Rename</td><td>修改 key 的名称</td></tr><tr><td>PERSIST</td><td>移除 key 的过期时间，key 将持久保持。</td></tr><tr><td>Move</td><td>将当前数据库的 key 移动到给定的数据库 db 当中。</td></tr><tr><td>RANDOMKEY</td><td>从当前数据库中随机返回一个 key 。</td></tr><tr><td>Dump</td><td>序列化给定 key ，并返回被序列化的值。</td></tr><tr><td>TTL</td><td>以秒为单位，返回给定 key 的剩余生存时间(TTL, time to live)。</td></tr><tr><td>Expire</td><td>seconds 为给定 key 设置过期时间。</td></tr><tr><td>DEL</td><td>该命令用于在 key 存在是删除 key。</td></tr><tr><td>Pttl</td><td>以毫秒为单位返回 key 的剩余的过期时间。</td></tr><tr><td>Renamenx</td><td>仅当 newkey 不存在时，将 key 改名为 newkey 。</td></tr><tr><td>EXISTS</td><td>检查给定 key 是否存在。</td></tr><tr><td>Expireat</td><td>EXPIREAT 的作用和 EXPIRE 类似，都用于为 key 设置过期时间。 不同在于 EXPIREAT 命令接受的时间参数是 UNIX 时间戳(unix timestamp)。</td></tr><tr><td>Keys</td><td>找所有符合给定模式( pattern)的 key 。</td></tr></tbody></table></div><h4 id="Redis-字符串-String-命令"><a href="#Redis-字符串-String-命令" class="headerlink" title="Redis 字符串(String) 命令"></a>Redis 字符串(String) 命令</h4><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>Setnx</td><td>只有在 key 不存在时设置 key 的值。</td></tr><tr><td>Getrange</td><td>返回 key 中字符串值的子字符</td></tr><tr><td>Mset</td><td>同时设置一个或多个 key-value 对。</td></tr><tr><td>Setex</td><td>将值 value 关联到 key ，并将 key 的过期时间设为 seconds (以秒为单位)。</td></tr><tr><td>SET</td><td>设置指定 key 的值</td></tr><tr><td>Get</td><td>获取指定 key 的值。</td></tr><tr><td>Getbit</td><td>对 key 所储存的字符串值，获取指定偏移量上的位(bit)。</td></tr><tr><td>Setbit</td><td>对 key 所储存的字符串值，设置或清除指定偏移量上的位(bit)。</td></tr><tr><td>Decr</td><td>将 key 中储存的数字值减一。</td></tr><tr><td>Decrby</td><td>key 所储存的值减去给定的减量值（decrement） 。</td></tr><tr><td>Strlen</td><td>返回 key 所储存的字符串值的长度。</td></tr><tr><td>Msetnx</td><td>同时设置一个或多个 key-value 对，当且仅当所有给定 key 都不存在。</td></tr><tr><td>Incrby</td><td>将 key 所储存的值加上给定的增量值（increment） 。</td></tr><tr><td>Incrbyfloat</td><td>将 key 所储存的值加上给定的浮点增量值（increment） 。</td></tr><tr><td>Setrange</td><td>用 value 参数覆写给定 key 所储存的字符串值，从偏移量 offset 开始。</td></tr><tr><td>Psetex</td><td>这个命令和 SETEX 命令相似，但它以毫秒为单位设置 key 的生存时间，而不是像 SETEX 命令那样，以秒为单位。</td></tr><tr><td>Append</td><td>如果 key 已经存在并且是一个字符串， APPEND 命令将 value 追加到 key 原来的值的末尾。</td></tr><tr><td>Getset</td><td>将给定 key 的值设为 value ，并返回 key 的旧值(old value)。</td></tr><tr><td>Mget</td><td>获取所有(一个或多个)给定 key 的值。</td></tr><tr><td>Incr</td><td>将 key 中储存的数字值增一。</td></tr></tbody></table></div><h4 id="Redis-哈希-Hash-命令"><a href="#Redis-哈希-Hash-命令" class="headerlink" title="Redis 哈希(Hash) 命令"></a>Redis 哈希(Hash) 命令</h4><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>Hmset</td><td>同时将多个 field-value (域-值)对设置到哈希表 key 中。</td></tr><tr><td>Hmget</td><td>获取所有给定字段的值</td></tr><tr><td>Hset</td><td>将哈希表 key 中的字段 field 的值设为 value 。</td></tr><tr><td>Hgetall</td><td>获取在哈希表中指定 key 的所有字段和值</td></tr><tr><td>Hget</td><td>获取存储在哈希表中指定字段的值/td&gt;</td></tr><tr><td>Hexists</td><td>查看哈希表 key 中，指定的字段是否存在。</td></tr><tr><td>Hincrby</td><td>为哈希表 key 中的指定字段的整数值加上增量 increment 。</td></tr><tr><td>Hlen</td><td>获取哈希表中字段的数量</td></tr><tr><td>Hdel</td><td>删除一个或多个哈希表字段</td></tr><tr><td>Hvals</td><td>获取哈希表中所有值</td></tr><tr><td>Hincrbyfloat</td><td>为哈希表 key 中的指定字段的浮点数值加上增量 increment 。</td></tr><tr><td>Hkeys</td><td>获取所有哈希表中的字段</td></tr><tr><td>Hsetnx</td><td>只有在字段 field 不存在时，设置哈希表字段的值。</td></tr></tbody></table></div><h4 id="Redis-列表-List-命令"><a href="#Redis-列表-List-命令" class="headerlink" title="Redis 列表(List) 命令"></a>Redis 列表(List) 命令</h4><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>Lindex</td><td>通过索引获取列表中的元素</td></tr><tr><td>Rpush</td><td>在列表中添加一个或多个值</td></tr><tr><td>Lrange</td><td>获取列表指定范围内的元素</td></tr><tr><td>Rpoplpush</td><td>移除列表的最后一个元素，并将该元素添加到另一个列表并返回</td></tr><tr><td>Blpop</td><td>移出并获取列表的第一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</td></tr><tr><td>Brpop</td><td>移出并获取列表的最后一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</td></tr><tr><td>Brpoplpush</td><td>从列表中弹出一个值，将弹出的元素插入到另外一个列表中并返回它； 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</td></tr><tr><td>Lrem</td><td>移除列表元素</td></tr><tr><td>Llen</td><td>获取列表长度</td></tr><tr><td>Ltrim</td><td>对一个列表进行修剪(trim)，就是说，让列表只保留指定区间内的元素，不在指定区间之内的元素都将被删除。</td></tr><tr><td>Lpop</td><td>出并获取列表的第一个元素</td></tr><tr><td>Lpushx</td><td>将一个或多个值插入到已存在的列表头部</td></tr><tr><td>Linsert</td><td>在列表的元素前或者后插入元素</td></tr><tr><td>Rpop</td><td>移除并获取列表最后一个元素</td></tr><tr><td>Lset</td><td>通过索引设置列表元素的值</td></tr><tr><td>Lpush</td><td>将一个或多个值插入到列表头部</td></tr><tr><td>Rpushx</td><td>为已存在的列表添加值</td></tr></tbody></table></div><h4 id="Redis-集合-Set-命令"><a href="#Redis-集合-Set-命令" class="headerlink" title="Redis 集合(Set) 命令"></a>Redis 集合(Set) 命令</h4><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>Sunion</td><td>返回所有给定集合的并集</td></tr><tr><td>Scard</td><td>获取集合的成员数</td></tr><tr><td>Srandmember</td><td>返回集合中一个或多个随机数</td></tr><tr><td>Smembers</td><td>返回集合中的所有成员</td></tr><tr><td>Sinter</td><td>返回给定所有集合的交集</td></tr><tr><td>Srem</td><td>除集合中一个或多个成员</td></tr><tr><td>Smove</td><td>将 member 元素从 source 集合移动到 destination 集合</td></tr><tr><td>Sadd</td><td>向集合添加一个或多个成员</td></tr><tr><td>Sismember</td><td>判断 member 元素是否是集合 key 的成员</td></tr><tr><td>Sdiffstore</td><td>返回给定所有集合的差集并存储在 destination 中</td></tr><tr><td>Sdiff</td><td>返回给定所有集合的差集</td></tr><tr><td>Sscan</td><td>迭代集合中的元素</td></tr><tr><td>Sinterstore</td><td>返回给定所有集合的交集并存储在 destination 中</td></tr><tr><td>Sunionstore</td><td>所有给定集合的并集存储在 destination 集合中</td></tr><tr><td>Spop</td><td>移除并返回集合中的一个随机元素</td></tr></tbody></table></div><h4 id="Redis-有序集合-sorted-set-命令"><a href="#Redis-有序集合-sorted-set-命令" class="headerlink" title="Redis 有序集合(sorted set) 命令"></a>Redis 有序集合(sorted set) 命令</h4><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>Zrevrank</td><td>返回有序集合中指定成员的排名，有序集成员按分数值递减(从大到小)排序</td></tr><tr><td>Zlexcount</td><td>在有序集合中计算指定字典区间内成员数量</td></tr><tr><td>Zunionstore</td><td>计算给定的一个或多个有序集的并集，并存储在新的 key 中</td></tr><tr><td>Zremrangebyrank</td><td>移除有序集合中给定的排名区间的所有成员</td></tr><tr><td>Zcard</td><td>获取有序集合的成员数</td></tr><tr><td>Zrem</td><td>移除有序集合中的一个或多个成员</td></tr><tr><td>Zinterstore</td><td>计算给定的一个或多个有序集的交集并将结果集存储在新的有序集合 key 中</td></tr><tr><td>Zrank</td><td>返回有序集合中指定成员的索引</td></tr><tr><td>Zincrby</td><td>有序集合中对指定成员的分数加上增量 increment</td></tr><tr><td>Zrangebyscore</td><td>通过分数返回有序集合指定区间内的成员</td></tr><tr><td>Zrangebylex</td><td>通过字典区间返回有序集合的成员</td></tr><tr><td>Zscore</td><td>返回有序集中，成员的分数值</td></tr><tr><td>Zremrangebyscore</td><td>移除有序集合中给定的分数区间的所有成员</td></tr><tr><td>Zscan</td><td>迭代有序集合中的元素（包括元素成员和元素分值）</td></tr><tr><td>Zrevrangebyscore</td><td>返回有序集中指定分数区间内的成员，分数从高到低排序</td></tr><tr><td>Zremrangebylex</td><td>移除有序集合中给定的字典区间的所有成员</td></tr><tr><td>Zrevrange</td><td>返回有序集中指定区间内的成员，通过索引，分数从高到底</td></tr><tr><td>Zrange</td><td>通过索引区间返回有序集合成指定区间内的成员</td></tr><tr><td>Zcount</td><td>计算在有序集合中指定区间分数的成员数</td></tr><tr><td>Zadd</td><td>向有序集合添加一个或多个成员，或者更新已存在成员的分数</td></tr></tbody></table></div><h4 id="Redis-连接-命令"><a href="#Redis-连接-命令" class="headerlink" title="Redis 连接 命令"></a>Redis 连接 命令</h4><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>Echo</td><td>打印字符串</td></tr><tr><td>Select</td><td>切换到指定的数据库</td></tr><tr><td>Ping</td><td>查看服务是否运行</td></tr><tr><td>Quit</td><td>关闭当前连接</td></tr><tr><td>Auth</td><td>验证密码是否正确</td></tr></tbody></table></div><h4 id="Redis-服务器-命令"><a href="#Redis-服务器-命令" class="headerlink" title="Redis 服务器 命令"></a>Redis 服务器 命令</h4><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>Client Pause</td><td>在指定时间内终止运行来自客户端的命令</td></tr><tr><td>Debug Object</td><td>获取 key 的调试信息</td></tr><tr><td>Flushdb</td><td>删除当前数据库的所有key</td></tr><tr><td>Save</td><td>异步保存数据到硬盘</td></tr><tr><td>Showlog</td><td>管理 redis 的慢日志</td></tr><tr><td>Lastsave</td><td>返回最近一次 Redis 成功将数据保存到磁盘上的时间，以 UNIX 时间戳格式表示</td></tr><tr><td>Config Get</td><td>获取指定配置参数的值</td></tr><tr><td>Command</td><td>获取 Redis 命令详情数组</td></tr><tr><td>Slaveof</td><td>将当前服务器转变为指定服务器的从属服务器(slave server)</td></tr><tr><td>Debug Segfault</td><td>让 Redis 服务崩溃</td></tr><tr><td>Flushall</td><td>删除所有数据库的所有key</td></tr><tr><td>Dbsize</td><td>返回当前数据库的 key 的数量</td></tr><tr><td>Bgrewriteaof</td><td>异步执行一个 AOF（AppendOnly File） 文件重写操作</td></tr><tr><td>Cluster Slots</td><td>获取集群节点的映射数组</td></tr><tr><td>Config Set</td><td>修改 redis 配置参数，无需重启</td></tr><tr><td>Command Info</td><td>获取指定 Redis 命令描述的数组</td></tr><tr><td>Shutdown</td><td>异步保存数据到硬盘，并关闭服务器</td></tr><tr><td>Sync</td><td>用于复制功能(replication)的内部命令</td></tr><tr><td>Client Kill</td><td>关闭客户端连接</td></tr><tr><td>Role</td><td>返回主从实例所属的角色</td></tr><tr><td>Monitor</td><td>实时打印出 Redis 服务器接收到的命令，调试用</td></tr><tr><td>Command Getkeys</td><td>获取给定命令的所有键</td></tr><tr><td>Client Getname</td><td>获取连接的名称</td></tr><tr><td>Config Resetstat</td><td>重置 INFO 命令中的某些统计数据</td></tr><tr><td>Command Count</td><td>获取 Redis 命令总数</td></tr><tr><td>Time</td><td>返回当前服务器时间</td></tr><tr><td>Info</td><td>获取 Redis 服务器的各种信息和统计数值</td></tr><tr><td>Config rewrite</td><td>对启动 Redis 服务器时所指定的 redis.conf 配置文件进行改写</td></tr><tr><td>Client List</td><td>获取连接到服务器的客户端连接列表</td></tr><tr><td>Client Setname</td><td>设置当前连接的名称</td></tr><tr><td>Bgsave</td><td>在后台异步保存当前数据库的数据到磁盘</td></tr></tbody></table></div><h4 id="Redis-脚本-命令"><a href="#Redis-脚本-命令" class="headerlink" title="Redis 脚本 命令"></a>Redis 脚本 命令</h4><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>Script kill</td><td>杀死当前正在运行的 Lua 脚本。</td></tr><tr><td>Script Load</td><td>将脚本 script 添加到脚本缓存中，但并不立即执行这个脚本。</td></tr><tr><td>Eval</td><td>执行 Lua 脚本。</td></tr><tr><td>Evalsha</td><td>执行 Lua 脚本。</td></tr><tr><td>Script Exists</td><td>查看指定的脚本是否已经被保存在缓存当中。</td></tr><tr><td>Script Flush</td><td>从脚本缓存中移除所有脚本。</td></tr></tbody></table></div><h4 id="Redis-事务-命令"><a href="#Redis-事务-命令" class="headerlink" title="Redis 事务 命令"></a>Redis 事务 命令</h4><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>Exec</td><td>执行所有事务块内的命令。</td></tr><tr><td>Watch</td><td>监视一个(或多个) key ，如果在事务执行之前这个(或这些) key 被其他命令所改动，那么事务将被打断。</td></tr><tr><td>Discard</td><td>取消事务，放弃执行事务块内的所有命令。</td></tr><tr><td>Unwatch</td><td>取消 WATCH 命令对所有 key 的监视。</td></tr><tr><td>Multi</td><td>标记一个事务块的开始。</td></tr></tbody></table></div><h4 id="Redis-HyperLogLog-命令"><a href="#Redis-HyperLogLog-命令" class="headerlink" title="Redis HyperLogLog 命令"></a>Redis HyperLogLog 命令</h4><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>Pgmerge</td><td>将多个 HyperLogLog 合并为一个 HyperLogLog</td></tr><tr><td>Pfadd</td><td>添加指定元素到 HyperLogLog 中。</td></tr><tr><td>Pfcount</td><td>返回给定 HyperLogLog 的基数估算值。</td></tr></tbody></table></div><h4 id="Redis-发布订阅-命令"><a href="#Redis-发布订阅-命令" class="headerlink" title="Redis 发布订阅 命令"></a>Redis 发布订阅 命令</h4><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>Unsubscribe</td><td>指退订给定的频道。</td></tr><tr><td>Subscribe</td><td>订阅给定的一个或多个频道的信息。</td></tr><tr><td>Pubsub</td><td>查看订阅与发布系统状态。</td></tr><tr><td>Punsubscribe</td><td>退订所有给定模式的频道。</td></tr><tr><td>Publish</td><td>将信息发送到指定的频道。</td></tr><tr><td>Psubscribe</td><td>订阅一个或多个符合给定模式的频道。</td></tr></tbody></table></div><h4 id="Redis-地理位置-geo-命令"><a href="#Redis-地理位置-geo-命令" class="headerlink" title="Redis 地理位置(geo) 命令"></a>Redis 地理位置(geo) 命令</h4><div class="table-container"><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>GEOHASH</td><td>返回一个或多个位置元素的 Geohash 表示</td></tr><tr><td>GEOPOS</td><td>从key里返回所有给定位置元素的位置（经度和纬度）</td></tr><tr><td>GEODIST</td><td>返回两个给定位置之间的距离</td></tr><tr><td>GEORADIUS</td><td>以给定的经纬度为中心， 找出某一半径内的元素</td></tr><tr><td>GEOADD</td><td>将指定的地理空间位置（纬度、经度、名称）添加到指定的key中</td></tr><tr><td>GEORADIUSBYMEMBER</td><td>找出位于指定范围内的元素，中心点是由给定的位置元素决定</td></tr></tbody></table></div><h3 id="如何在Redis中使用悲观锁和乐观锁"><a href="#如何在Redis中使用悲观锁和乐观锁" class="headerlink" title="如何在Redis中使用悲观锁和乐观锁"></a>如何在Redis中使用悲观锁和乐观锁</h3><p>乐观锁一般采取的方式：</p><p>获取版本号，也就是version</p><p>然后更新的时候比较版本号</p><blockquote><p>Redis检测测试</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; select 2  选择数据库</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[2]&gt; <span class="built_in">set</span> money 100  </span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[2]&gt; <span class="built_in">set</span> out 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[2]&gt; watch money <span class="comment">#监视money对象</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[2]&gt; multi <span class="comment"># 事务正常结束，数据没有发生变动，那么就可以正常执行成功</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[2](TX)&gt; decrby money 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379[2](TX)&gt; incrby out 20</span><br><span class="line">QUEUED</span><br></pre></td></tr></table></figure><p>乐观锁</p><p>流程</p><ol><li>先<strong>watch   key</strong> 监视                     </li><li>然后         <strong>multi</strong>          监测事务,监测事务是否发生变化，如果没有变化那就可以执行成功，如果发生变化，那么对不起，执行失败</li><li>如果发现事务执行失败，那么就先解锁          也就是<strong>unwatch</strong></li><li>获取最新的值，再次监视，select version , <strong>watch key</strong><br> . <strong>decrby key</strong> 值             减少<br> . <strong>incrby key</strong> 值             增加</li></ol><h3 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h3><p>:arrow_down_small:是java操作redis中的中间件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--导入jedis的包--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.41<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建一个new Jedis对象</span></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.1.100&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        <span class="comment">//jedis所有的指令就是我们学的所有的指令</span></span><br><span class="line">        System.out.println(jedis.ping());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>输出：</p><p>PONG  说明链接成功</p><h3 id="Redis事务"><a href="#Redis事务" class="headerlink" title="Redis事务"></a>Redis事务</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">redis的事务处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Redis</span>事务 &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//开启链接</span></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.1.100&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        <span class="comment">//清空当前数据库</span></span><br><span class="line">        jedis.flushDB();</span><br><span class="line">        <span class="comment">//将数据转换为json格式，目前公司大部分使用的均是json</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        jsonObject.put(<span class="string">&quot;u1&quot;</span>,<span class="string">&quot;我喜欢&quot;</span>);</span><br><span class="line">        jsonObject.put(<span class="string">&quot;u2&quot;</span>,<span class="string">&quot;你&quot;</span>);</span><br><span class="line">        <span class="comment">//开启事务</span></span><br><span class="line">        <span class="type">Transaction</span> <span class="variable">multi</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> jsonObject.toJSONString();</span><br><span class="line">        <span class="comment">//  System.out.println(jedis.ping());</span></span><br><span class="line">        <span class="comment">//如果我需要监控，那么我就需要加一个乐观锁</span></span><br><span class="line">        jedis.watch(result);<span class="comment">//加一个锁</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            multi.set(<span class="string">&quot;u1&quot;</span>,result);</span><br><span class="line">            multi.set(<span class="string">&quot;u2&quot;</span>,result);</span><br><span class="line">            <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">            multi.exec();<span class="comment">//如果成功执行事务</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            multi.discard(); <span class="comment">//如果失败了，那么就事务回滚，或者事务放弃</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(jedis.get(<span class="string">&quot;u1&quot;</span>));</span><br><span class="line">            System.out.println(jedis.get(<span class="string">&quot;u2&quot;</span>));</span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//multi.set(&quot;u1&quot;,&quot;老胡&quot;);</span></span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">        HashMap map = new HashMap();</span></span><br><span class="line"><span class="comment">        String ke = &quot;k1&quot;;</span></span><br><span class="line"><span class="comment">        map.put(ke,&quot;小黑&quot;);</span></span><br><span class="line"><span class="comment">        map.put(ke,&quot;你好&quot;);</span></span><br><span class="line"><span class="comment">        System.out.println(map);</span></span><br><span class="line"><span class="comment">        System.out.println(map.size());</span></span><br><span class="line"><span class="comment">        &#123;k1=你好&#125;</span></span><br><span class="line"><span class="comment">            1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">        <span class="comment">//连接关闭</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="SpringBoot整合Redis"><a href="#SpringBoot整合Redis" class="headerlink" title="SpringBoot整合Redis"></a>SpringBoot整合Redis</h3><p>springBoot操作数据： spring-data         jpa         JDBC     MONGODB      Redis</p><blockquote><p>注意在springBoot 2.x之后，原来的redis都被替换为lettuce</p></blockquote><p>Jedis ： 采用的直连，多个线程操作的话是不安全的，如果想要避免不安全，使用jedis pool链接池。BIO</p><p>lettuce：采用netty，实例可以在多个线程下使用，不存在线程不安全的情况，可以减少线程数据，更加像NIO模式。</p><ol><li><p>导入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--导入jedis的包--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.41<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><ol><li><p>配置文件</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置redis</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure></li></ol><ol><li><p>测试</p><p>源码分析</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">    proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;RedisOperations.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;RedisProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedisAutoConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean( //只有在没有的时候使用，故而，我们可以自定义一个RedisTemplate</span></span><br><span class="line"><span class="meta">        name = &#123;&quot;redisTemplate&quot;&#125;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">        <span class="comment">//默认的，redisTemplate ，没有过多的设置，redis对象都是需要序列化</span></span><br><span class="line">    <span class="comment">//两个泛型读书Object,Object的类型，我们使用需要强制转换为&lt;String,Obeject&gt;</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> <span class="keyword">throws</span> UnknownHostException &#123;</span><br><span class="line">        RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="comment">//由于String是Redis的最常使用的类型，所以但对提出来了一个bean</span></span><br><span class="line">    <span class="keyword">public</span> StringRedisTemplate <span class="title function_">stringRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> <span class="keyword">throws</span> UnknownHostException &#123;</span><br><span class="line">        <span class="type">StringRedisTemplate</span> <span class="variable">template</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringRedisTemplate</span>();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RedisSpringBootApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">        redisTemplate 操作不同的数据类型。api和我们的指令是一样的</span></span><br><span class="line"><span class="comment">        opsForValue  操作字符串，类似String</span></span><br><span class="line"><span class="comment">        opsForList 操作list 相当于list</span></span><br><span class="line"><span class="comment">        opsForSet</span></span><br><span class="line"><span class="comment">        opsForHash</span></span><br><span class="line"><span class="comment">        opsForZSet</span></span><br><span class="line"><span class="comment">        opsForGeo</span></span><br><span class="line"><span class="comment">        opsForHyperLogLogLog</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        除了基本的操作，我们常用方法都可以使用redisTemplate操作</span></span><br><span class="line"><span class="comment">        比如事务和基本的操作</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        获取redis的链接对象</span></span><br><span class="line"><span class="comment">        RedisConnection redisConnection = redisTemplate.getConnectionFactory().getConnection();</span></span><br><span class="line"><span class="comment">        redisConnection.flushDb();</span></span><br><span class="line"><span class="comment">        redisConnection.flushAll();</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;k&quot;</span>,<span class="number">123</span>);</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;k1&quot;</span>,<span class="string">&quot;罗小黑&quot;</span>);</span><br><span class="line">        System.out.println(redisTemplate.opsForValue().get(<span class="string">&quot;k&quot;</span>));</span><br><span class="line">        System.out.println(redisTemplate.opsForValue().get(<span class="string">&quot;k1&quot;</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置信息；</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xh<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Redis_SpringBoot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Redis_SpringBoot<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Redis_SpringBoot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>2.3.7.RELEASE<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--   重点jackson，是我们将redis的格式转换为redis格式，方便我们最直观的查看     --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis-reactive<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.taobao.arthas<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>arthas-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.projectreactor<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>reactor-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.xh.redis_springboot.RedisSpringBootApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>自定义RedisTemplate</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Title 自定义一个Template</span></span><br><span class="line"><span class="comment"> * @Description </span></span><br><span class="line"><span class="comment"> * @author  罗小黑</span></span><br><span class="line"><span class="comment"> * @param null</span></span><br><span class="line"><span class="comment"> * @return </span></span><br><span class="line"><span class="comment"> * @date 2022/10/12 19:34</span></span><br><span class="line"><span class="comment"> * @email </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Redis_self_RedisTemplate</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span></span><br><span class="line">            <span class="keyword">throws</span> UnknownHostException &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;String, Object&gt;();</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 序列化配置</span></span><br><span class="line">        <span class="comment">// json序列化配置</span></span><br><span class="line">        <span class="type">Jackson2JsonRedisSerializer</span> <span class="variable">objectJackson2JsonRedisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class);</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        <span class="comment">// String序列化配置</span></span><br><span class="line">        <span class="type">StringRedisSerializer</span> <span class="variable">stringRedisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line"></span><br><span class="line">        template.setHashValueSerializer(objectJackson2JsonRedisSerializer);</span><br><span class="line">        template.setValueSerializer(objectJackson2JsonRedisSerializer);</span><br><span class="line"></span><br><span class="line">        template.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line">        template.setKeySerializer(stringRedisSerializer);</span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>自定义RedisUtil工具类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xh.redis_springboot.Util;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnection;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Title 我们在使用Redis的时候通常使用我们自己的工具类</span></span><br><span class="line"><span class="comment"> * @Description 这是一种思想，一种封装重用的思想，避免我们直接去使用redis自带的指令</span></span><br><span class="line"><span class="comment"> * @author  罗小黑</span></span><br><span class="line"><span class="comment"> * @param null</span></span><br><span class="line"><span class="comment"> * @return</span></span><br><span class="line"><span class="comment"> * @date 2022/10/12 20:19</span></span><br><span class="line"><span class="comment"> * @email 2844135670@qq.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisUtil</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//============================Common=============================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关闭</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//获取链接然后导入</span></span><br><span class="line">        <span class="type">RedisConnection</span> <span class="variable">redisConnection</span> <span class="operator">=</span> Objects.requireNonNull(redisTemplate.getConnectionFactory()).getConnection();</span><br><span class="line">        redisConnection.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 清空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">flushDB</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">RedisConnection</span> <span class="variable">redisConnection</span> <span class="operator">=</span> Objects.requireNonNull(redisTemplate.getConnectionFactory()).getConnection();</span><br><span class="line">        redisConnection.flushDb();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定缓存失效时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">expire</span><span class="params">(String key, Long time)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                redisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据key 获取过期时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 时间(秒) 返回0代表为永久有效</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getExpire</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.getExpire(key, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断key是否存在</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">hasKey</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.hasKey(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 可以传一个值 或多个</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">del</span><span class="params">(String... key)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (key != <span class="literal">null</span> &amp;&amp; key.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (key.length == <span class="number">1</span>) &#123;</span><br><span class="line">                redisTemplate.delete(key[<span class="number">0</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                redisTemplate.delete(Arrays.asList(key));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//============================String=============================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存获取</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> key == <span class="literal">null</span> ? <span class="literal">null</span> : redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存放入</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">set</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForValue().set(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存放入并设置时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒) time要大于0 如果time小于等于0 将设置无限期</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true成功 false 失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">set</span><span class="params">(String key, Object value, Long time)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                set(key, value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递增</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delta 要增加几(大于0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">incr</span><span class="params">(String key, Long delta)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;递增因子必须大于0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递减</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delta 要减少几(小于0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">decr</span><span class="params">(String key, Long delta)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;递减因子必须大于0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, -delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//================================Map=================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashGet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">hget</span><span class="params">(String key, String item)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().get(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取hashKey对应的所有键值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 对应的多个键值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;Object, Object&gt; <span class="title function_">hmget</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().entries(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map 对应多个键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false 失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet 并设置时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map  对应多个键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map, Long time)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向一张hash表中放入数据,如果不存在将创建</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item  项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">hset</span><span class="params">(String key, String item, Object value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向一张hash表中放入数据,如果不存在将创建</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item  项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒)  注意:如果已存在的hash表有时间,这里将会替换原有的时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">hset</span><span class="params">(String key, String item, Object value, Long time)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除hash表中的值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 可以使多个 不能为null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hdel</span><span class="params">(String key, Object... item)</span> &#123;</span><br><span class="line">        redisTemplate.opsForHash().delete(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断hash表中是否有该项的值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">hHasKey</span><span class="params">(String key, String item)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().hasKey(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hash递增 如果不存在,就会创建一个 并把新增后的值返回</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by   要增加几(大于0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">hincr</span><span class="params">(String key, String item, <span class="type">double</span> by)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hash递减</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by   要减少记(小于0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">hdecr</span><span class="params">(String key, String item, <span class="type">double</span> by)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, -by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//============================set=============================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据key获取Set中的所有值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Set&lt;Object&gt; <span class="title function_">sGet</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().members(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据value从一个set中查询,是否存在</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">sHasKey</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().isMember(key, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将数据放入set缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">sSet</span><span class="params">(String key, Object... values)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().add(key, values);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将set数据放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time   时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">sSetAndTime</span><span class="params">(String key, Long time, Object... values)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> redisTemplate.opsForSet().add(key, values);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取set缓存的长度</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">sGetSetSize</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移除值为value的</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 移除的个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">setRemove</span><span class="params">(String key, Object... values)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().remove(key, values);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//===============================list=================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取list缓存的内容</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> start 开始</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end   结束  0 到 -1代表所有值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">lGet</span><span class="params">(String key, Long start, Long end)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().range(key, start, end);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取list缓存的长度</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">lGetListSize</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过索引 获取list中的值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index 索引  index&gt;=0时， 0 表头，1 第二个元素，依次类推；index&lt;0时，-1，表尾，-2倒数第二个元素，依次类推</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">lGetIndex</span><span class="params">(String key, Long index)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().index(key, index);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">lSet</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">lSet</span><span class="params">(String key, Object value, Long time)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">lSet</span><span class="params">(String key, List&lt;Object&gt; value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">lSet</span><span class="params">(String key, List&lt;Object&gt; value, Long time)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据索引修改list中的某条数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index 索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">lUpdateIndex</span><span class="params">(String key, Long index, Object value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().set(key, index, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移除N个值为value</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> count 移除多少个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 移除的个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">lRemove</span><span class="params">(String key, Long count, Object value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().remove(key, count, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><p>所有的Redis操作，其实都很简单，主要的是理解redis的思想和其中每一种数据结构的用处和作用。</p><h3 id="Redis-conf详细"><a href="#Redis-conf详细" class="headerlink" title="Redis.conf详细"></a>Redis.conf详细</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">下载redis </span><br><span class="line">docker pull redis</span><br><span class="line"></span><br><span class="line">创建实例并启动</span><br><span class="line"><span class="built_in">mkdir</span> -p /mydata/redis/conf      </span><br><span class="line"></span><br><span class="line"><span class="built_in">touch</span> redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6379:6379 --name redis -v /mydata/redis/data:/data \</span><br><span class="line">   -v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">   -d redis redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line"> <span class="built_in">ls</span>   查看当前文件夹下的文件</span><br><span class="line"> <span class="built_in">cat</span> redis.conf</span><br><span class="line"></span><br><span class="line"> 测试redis </span><br><span class="line">  </span><br><span class="line"> docker <span class="built_in">exec</span> -it redis redis-cli</span><br><span class="line"> </span><br><span class="line"> ---</span><br><span class="line"> 由于以前的数据全存在内存中，从而我们重复读取get a的时候会导致失败</span><br><span class="line">[root@localhost conf]<span class="comment"># cat redis.conf</span></span><br><span class="line">[root@localhost conf]<span class="comment"># docker exec -it redis redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> a b</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get a</span><br><span class="line"><span class="string">&quot;b&quot;</span>   //从而在一次上来的时候这块是null</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line">--让redis 持久化  ---&gt; <span class="built_in">pwd</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exit</span></span><br><span class="line">[root@localhost conf]<span class="comment"># pwd</span></span><br><span class="line">/mydata/redis/conf</span><br><span class="line">[root@localhost conf]<span class="comment"># ls</span></span><br><span class="line">redis.conf</span><br><span class="line">[root@localhost conf]<span class="comment"># vi redis.conf </span></span><br><span class="line">i</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">esc  :wq</span><br><span class="line"></span><br><span class="line">docker restart redis  //重启redis</span><br><span class="line">--设置开机自启动docker 里边容器</span><br><span class="line">sudo docker update &lt;容器名&gt; --restart=always</span><br></pre></td></tr></table></figure><p>启动的时候通过配置文件处理；</p><blockquote><p>单位</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost conf]<span class="comment"># pwd</span></span><br><span class="line">/mydata/redis/conf</span><br><span class="line">[root@localhost conf]<span class="comment"># ls</span></span><br><span class="line">redis.conf</span><br><span class="line">[root@localhost conf]<span class="comment"># vi redis.conf </span></span><br></pre></td></tr></table></figure><ol><li><p>配置文件unit单位对不敏感</p></li><li><p>包含</p></li><li><p>网络</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 127.0.0.1 <span class="comment">#绑定的IP</span></span><br><span class="line">protected-mode <span class="built_in">yes</span> <span class="comment">#包含模式</span></span><br><span class="line">port 6379 <span class="comment">#端口配置，不推荐修改</span></span><br></pre></td></tr></table></figure></li></ol><ol><li><p>通用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">daemonize <span class="built_in">yes</span> <span class="comment">#以守护进程的方式运行，默认是no，我们需要自己开启为yes!</span></span><br><span class="line"></span><br><span class="line">pidfile /var/run/redis_6379.pid  <span class="comment">#如果以后台程序运行，我们就需要给一个pid文件</span></span><br><span class="line">loglevel notice <span class="comment"># 日志文件</span></span><br><span class="line">logfile <span class="string">&quot;&quot;</span> <span class="comment">#日志文件位置名</span></span><br><span class="line">databases 16 <span class="comment">#数据库的数量，默认是16个数据库</span></span><br><span class="line">always-show-logo <span class="built_in">yes</span> <span class="comment">#是否显示logo </span></span><br></pre></td></tr></table></figure></li><li><p>快照</p><p>持久化，在规定的时间内，执行了多少次操作，则会持久化到文件 .rdb.aof</p><p>redis是内存数据库，如果没有持久化，那么数据断电就会丢失</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#如果在900秒内，如果有至少一个key 进行修改，我们就需要进行持久化操作</span></span><br><span class="line">save 900 1  </span><br><span class="line"><span class="comment">#如果在300秒内，有10个key进行修改，我们就需要进行持久化</span></span><br><span class="line">save  300 10</span><br><span class="line"><span class="comment">#如果60秒内。至少10000key进行修改，我们进行持久化操作</span></span><br><span class="line">save 60 10000</span><br><span class="line"><span class="comment">#之后我们可以自己自定义</span></span><br><span class="line"></span><br><span class="line">stop-writes-on-bgsave-error <span class="built_in">yes</span> <span class="comment">#持久化如果出错，是否还需要继续工作！</span></span><br><span class="line"></span><br><span class="line">rdbcompression <span class="built_in">yes</span> <span class="comment">#是否压缩rdb文件，需要占用一定的cpu的资源</span></span><br><span class="line">rdbchecksum <span class="built_in">yes</span> <span class="comment">#是否保持rdb文件的时候，进行错误的检查校验</span></span><br><span class="line"><span class="built_in">dir</span> ./ <span class="comment">#rdb文件保存路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#=============================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置密码 </span></span><br><span class="line">config <span class="built_in">set</span> requirepass <span class="string">&quot;密码&quot;</span></span><br><span class="line"><span class="comment">#此时就需要权限了，也就是需要密码了</span></span><br><span class="line">config get requirepass </span><br><span class="line"><span class="comment">#输入密码</span></span><br><span class="line">auth 密码</span><br><span class="line"><span class="comment">#此时就可以查看</span></span><br><span class="line">config get requirepass </span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>限制客户端</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">maxclients 10000  <span class="comment">#设置能链接上的redis的最大客户端数量</span></span><br><span class="line">maxmemory &lt;byte&gt; <span class="comment">#redis 配置最大的内存容量</span></span><br><span class="line">maxmemory-policy noeviction <span class="comment">#内存到达上限之后的处理策略</span></span><br><span class="line"></span><br><span class="line">volatile-lru，针对设置了过期时间的key，使用lru算法进行淘汰。</span><br><span class="line">allkeys-lru，针对所有key使用lru算法进行淘汰。</span><br><span class="line">volatile-random，从所有设置了过期时间的key中使用随机淘汰的方式进行淘汰。</span><br><span class="line">allkeys-random，针对所有的key使用随机淘汰机制进行淘汰。</span><br><span class="line">volatile-ttl，针对设置了过期时间的key，越早过期的越先被淘汰。</span><br><span class="line">noeviction，不会淘汰任何数据，当使用的内存空间超过 maxmemory 值时，再有写请求来时返回错误。</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>AOF : APPENDONLY 模式 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">appendonly no <span class="comment">#默认是不开启模式的aof默认是使用rdb的，大部分情况下rdb够用了</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly.aof&quot;</span> <span class="comment">#持久化的文件的名字 .rdb</span></span><br><span class="line"><span class="comment">#appendfsync always  每次修改都会 sync消耗性能</span></span><br><span class="line">appendsync everysec <span class="comment">#每秒执行一个sync 可能会丢失这个ls的数据</span></span><br><span class="line"><span class="comment">#appendfsync no 不执行sync这个是操作系统自己同步数据，速度最快</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="redis持久化"><a href="#redis持久化" class="headerlink" title="redis持久化"></a>redis持久化</h3><p><strong>AOF</strong>:</p><p>将我们所有的命令记录下来，history，恢复的时候就把这个文件全部执行一次。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost conf]<span class="comment"># vi redis.conf </span></span><br><span class="line">i</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">esc  :wq</span><br></pre></td></tr></table></figure><p>一般是默认不开启的，我们需要手动去开启。</p><p>我们一般需要将appendonly 改成yes就行，然后我们就开启了</p><p>更新后我们需要重启服务器，</p><p>我们可以直接使用<code>vim appendonly.aof</code>查看我们配置后产生的文件，但是当我们将aof文件进行一定的更改就会导致redis启动不起来了，这个时候我们就需要修复这个aof文件</p><p>redis给我们提供了一个工具 <code>redis-check-aof --fix</code></p><p>然后按照指令操作，我们就可以完成aof的文件修复。</p><blockquote><p>优点和缺点</p></blockquote><p>优点：</p><ol><li>每一次修改都同步，文件的完整会更好</li><li>每秒同步一次，可能会丢失一秒的数据</li><li>从不同步，效率是最高的</li></ol><p>缺点：</p><ol><li>相对于数据文件来说，AOF大于RDB,修复的速度也比RDB慢！</li><li>AOF运行效率也会比RDB慢，故而我们需要Redis默认的RDB持久化</li></ol><p>如果AOF文件大于64MB,也就是太大了，fork一个新进程将对我们的文件进行重写！</p><p><strong>RDB</strong>:</p><p>dump.rdb</p><p>redis默认RDB</p><ol><li>save的规则满足的情况下，会自动触发rdb规则</li><li>执行flushAll命令，也会触发我们rdb规则</li><li>退出redis也会产生rdb文件</li></ol><p>备份就产生一个dump.rdb文件</p><blockquote><p>如何恢复rdb文件</p></blockquote><ol><li>只要将rdb文件放在我们redis启动目录就可以，redis启动的时候会自动检查dump,rdb文件，然后恢复文件</li><li>查看我们需要存在的位置</li></ol><p>一般上我们默认使用RDB</p><p><strong>优点：</strong> </p><ol><li>适合大规模的数据恢复</li><li>对数据的完整性要求不高</li></ol><p><strong>缺点</strong></p><ol><li>需要一定的时间间隔进程操作，如果redis意外宕机了，这个最后一次修改的数据就没有了</li><li>fork进程的时候需要占用一定的内存空间</li></ol><h3 id="Redis发布订阅"><a href="#Redis发布订阅" class="headerlink" title="Redis发布订阅"></a>Redis发布订阅</h3><p>Redis 发布订阅 (pub/sub) 是一种消息通信模式：发送者 (pub) 发送消息，订阅者 (sub) 接收消息。</p><p>注意我们需要开启两个客户端，一个做订阅的一个做推送的。</p><p>Redis 客户端可以订阅任意数量的频道。</p><p>以下实例演示了发布订阅是如何工作的，需要开启两个 redis-cli 客户端。</p><p>在我们实例中我们创建了订阅频道名为 <strong>runoobChat</strong>:</p><p><code>SUBSCRIBE 名字</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; SUBSCRIBE runoobChat <span class="comment">#订阅一个频道，名字runoobChat</span></span><br><span class="line"></span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line">2) <span class="string">&quot;runoobChat&quot;</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment">#等待读取推送的消息</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>现在，我们先重新开启个 redis 客户端，然后在同一个频道 runoobChat 发布两次消息，订阅者就能接收到消息。 </p><p><code>PUBLISH 名字 信息</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; PUBLISH runoobChat <span class="string">&quot;Redis PUBLISH test&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; PUBLISH runoobChat <span class="string">&quot;Learn redis by runoob.com&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># 订阅者的客户端会显示如下消息</span></span><br><span class="line"> 1) <span class="string">&quot;message&quot;</span> <span class="comment">#消息</span></span><br><span class="line">2) <span class="string">&quot;runoobChat&quot;</span>   <span class="comment">#那个频道的消息</span></span><br><span class="line">3) <span class="string">&quot;Redis PUBLISH test&quot;</span> <span class="comment"># 消息的具体内容</span></span><br><span class="line"> 1) <span class="string">&quot;message&quot;</span></span><br><span class="line">2) <span class="string">&quot;runoobChat&quot;</span></span><br><span class="line">3) <span class="string">&quot;Learn redis by runoob.com&quot;</span></span><br></pre></td></tr></table></figure><p>gif 演示如下：</p><ul><li>开启本地 Redis 服务，开启两个 redis-cli 客户端。</li><li>在<strong>第一个 redis-cli 客户端</strong>输入 SUBSCRIBE runoobChat，意思是订阅 <code>runoobChat</code> 频道。</li><li>在<strong>第二个 redis-cli 客户端</strong>输入 PUBLISH runoobChat “Redis PUBLISH test” 往 runoobChat 频道发送消息，这个时候在第一个 redis-cli 客户端就会看到由第二个 redis-cli 客户端发送的测试消息。</li></ul><div class="table-container"><table><thead><tr><th>1</th><th>PSUBSCRIBE pattern 订阅一个或多个符合给定模式的频道。</th></tr></thead><tbody><tr><td>2</td><td>PUBSUB subcommand [argument 查看订阅与发布系统状态。</td></tr><tr><td>3</td><td>PUBLISH channel message 将信息发送到指定的频道。</td></tr><tr><td>4</td><td>PUNSUBSCRIBE  退订所有给定模式的频道。</td></tr><tr><td>5</td><td>SUBSCRIBE channe订阅给定的一个或多个频道的信息。</td></tr><tr><td>6</td><td>UNSUBSCRIBE   指退订给定的频道。</td></tr></tbody></table></div><h3 id="redis主从复制"><a href="#redis主从复制" class="headerlink" title="redis主从复制"></a>redis主从复制</h3><p>Redis Replication是一种 master-slave 模式的复制机制，这种机制使得 slave 节点可以成为与 master 节点完全相同的副本，可以采用一主多从或者级联结构 。</p><blockquote><p>主从复制的配置要点：</p><p>（1）配从库不配主，从库配置：slaveof 主库IP 主库端口</p><p>（2）查看redis的配置信息：info replication</p><p><strong>Redis为什么需要主从复制？</strong><br>使用Redis主从复制的原因主要是单台Redis节点存在以下的局限性：</p><p>（1）Redis虽然读写的速度都很快，单节点的Redis能够支撑QPS大概在5w左右，如果上千万的用户访问，Redis就承载不了，成为了高并发的瓶颈。</p><p>（2）单节点的Redis不能保证高可用，当Redis因为某些原因意外宕机时，会导致缓存不可用</p><p>（3）CPU的利用率上，单台Redis实例只能利用单个核心，这单个核心在面临海量数据的存取和管理工作时压力会非常大。</p><p><strong>主从复制的好处：</strong><br>（1）数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余方式。</p><p>（2）故障恢复：如果master宕掉了，使用哨兵模式，可以提升一个 slave 作为新的 master，进而实现故障转移，实现高可用</p><p>（3）负载均衡：可以轻易地实现横向扩展，实现读写分离，一个 master 用于写，多个 slave 用于分摊读的压力，从而实现高并发；</p><p><strong>主从复制的缺点：</strong><br>由于所有的写操作都是先在Master上操作，然后同步更新到Slave上，所以从Master同步到Slave服务器有一定的延迟，当系统很繁忙的时候，延迟问题会更加严重，Slave机器数量的增加也会使这个问题更加严重</p></blockquote><p><strong>环境配置</strong>：</p><p>只配置从库，不配置主库</p><p><code>info replication</code>查看相关配置库</p><p><code>vim redis79.conf</code> 进入配置文件进行更改</p><p>改端口port，改后台服务名字pid，改日志，改后台运行，改dbfilename  dump.rdb</p><p><code>redis-server kconfig/redis.conf</code>  我们启动相应配置后的redis从库</p><p><code>ps  -ef|grep redis</code> 查看后台启动信息</p><h4 id="一主二从"><a href="#一主二从" class="headerlink" title="一主二从"></a>一主二从</h4><p>刚刚配置后其每个数据库都是主库，只有经过配置后才能保证redis的某个库变成从库。</p><p>默认情况之下。每台Redis服务器都是主表</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 6379   <span class="comment">#启动redis的客户端</span></span><br><span class="line"><span class="comment">#注意这个是在你要指定作为从机的客户端窗口里边执行的，他选择老大，而不是老大选择他</span></span><br><span class="line">slaveof 127.0.0.1 6379 <span class="comment">#配置主表 简称任命老大</span></span><br></pre></td></tr></table></figure><p>我们通命令配置的，只能是暂时的。</p><p>我们可以通Redis.conf完成配置达到永久配置的方式，具体可以百度解决。</p><blockquote><p>replicaof <masterip> ip地址  <masterport>端口号   配置在从机的配置文件内，当服务重新启动，这个表就作为从机了</p></blockquote><p>注意：</p><p>当我们配置好主机和从机后，主机可以进行set添加数据，而添加的数据可以直接在从表中查到，但是从表不能添加数据，因为他是从表。</p><p>没有配置哨兵的时候：当主机断开链接的时候，从机依旧连接到主机，但是没有写操作，只有读操作，当这个时候主机回来了，那么从机还是保持链接，主机添加数据从机照样读取主机的数据。</p><p>如果是使用命令行，那么重新启动后就又会变回主机，但这个时候，只要变回从机，那么就可以立马拿到主机的数据</p><blockquote><p>复制原理</p></blockquote><p>slave启动启动成功链接到master后会发送一个sync同步命令</p><p>Master接受到命令后，启动后台的存盘进程，同时收集所有接收到用于修改数据集命令，在后台进程执行完毕后，master将传送整个数据文件到slave,并完成一次完全同步。</p><p>全量复制：而slave服务在接到数据库文件数据后，将其存盘并加载到内存中</p><p>增量复制：Master继续将新的所有收集到的修改命令依次传给slave，完成同步。</p><p>但是只要是重新链接Master,一次完全同步（全部复制）将会自动执行。</p><blockquote><p>层层连接</p></blockquote><p>A-&gt;B-&gt;C</p><h4 id="宕机手动配置主机"><a href="#宕机手动配置主机" class="headerlink" title="宕机手动配置主机"></a>宕机手动配置主机</h4><p>如果我们的主机挂掉了，那么我们如何将从机配置成为主机？</p><p>我们使用的是<code>slaveof no one</code>让从表自己变成主机，那么其他节点就可以手动连接到最新的这个主机，在哨兵没有创建的时候，一般需要我们手动去配置。如果这个时候老大修复了，那么我们就需要重写连接。</p><h4 id="哨兵自动配置"><a href="#哨兵自动配置" class="headerlink" title="哨兵自动配置"></a>哨兵自动配置</h4><p>Redis的主从复制模式下， 一旦主节点由于故障不能提供服务， 需要人工将从节点晋升为主节点， 同时还要通知应用方更新主节点地址， 对于很多应用场景这种故障处理的方式是无法接受的。 可喜的是Redis从2.8开始正式<br>提供了Redis Sentinel（哨兵） 架构来解决这个问题。</p><p>总结：</p><p>==<strong>Redis主从复制的缺点：没有办法对master进行动态选举，需要使用Sentinel机制完成动态选举</strong>==</p><ul><li><p>哨兵模式介绍</p><ul><li><strong>Sentinel(哨兵)进程是用于监控redis集群中Master主服务器工作的状态在Master主服务器发生故障的时候，可以实现Master和Slave服务器的切换，保证系统的高可用（HA）其已经被集成在redis2.6+的版本中，Redis的哨兵模式到了2.8版本之后就稳定了下来。</strong></li></ul></li><li><p>哨兵进程的作用</p><ul><li>监控(Monitoring): <ul><li>哨兵(sentinel) 会不断地检查你的Master和Slave是否运作正常。</li></ul></li><li>提醒(Notification):<ul><li>当被监控的某个Redis节点出现问题时, 哨兵(sentinel) 可以通过 API 向管理员或者其他应用程序发送通知。</li></ul></li></ul></li><li><p>自动故障迁移(Automatic failover)：</p><ul><li>当一个Master不能正常工作时，哨兵(sentinel) 会开始一次自动故障迁移操作。</li><li>它会将失效Master的其中一个Slave升级为新的Master, 并让失效Master的其他Slave改为复制新的Master；</li><li>当客户端试图连接失效的Master时，集群也会向客户端返回新Master的地址，使得集群可以使用现在的Master替换失效Master。</li><li>Master和Slave服务器切换后，Master的redis.conf、Slave的redis.conf和sentinel.conf的配置文件的内容都会发生相应的改变，即，Master主服务器的redis.conf配置文件中会多一行slaveof的配置，sentinel.conf的监控目标会随之调换。</li></ul></li><li><p>哨兵进程的工作方式</p><ul><li>每个Sentinel（哨兵）进程以每秒钟一次的频率向整个集群中的Master主服务器，Slave从服务器以及其他Sentinel（哨兵）进程发送一个 PING 命令。</li><li>如果一个实例（instance）距离最后一次有效回复 PING 命令的时间超过 down-after-milliseconds 选项所指定的值，则这个实例会被 Sentinel（哨兵）进程标记为主观下线（SDOWN）。</li><li>如果一个Master主服务器被标记为主观下线（SDOWN），则正在监视这个Master主服务器的所有</li><li>Sentinel（哨兵）进程要以每秒一次的频率确认Master主服务器的确进入了主观下线状态。</li><li>当有足够数量的 Sentinel（哨兵）进程（大于等于配置文件指定的值）在指定的时间范围内确认Master主服务器进入了主观下线状态（SDOWN）， 则Master主服务器会被标记为客观下线（ODOWN）。</li><li>在一般情况下， 每个Sentinel（哨兵）进程会以每 10 秒一次的频率向集群中的所有Master主服务器、Slave从服务器发送 INFO 命令。</li><li>当Master主服务器被 Sentinel（哨兵）进程标记为客观下线（ODOWN）时，Sentinel（哨兵）进程向下线的 Master主服务器的所有 Slave从服务器发送 INFO 命令的频率会从 10 秒一次改为每秒一次。</li><li>若没有足够数量的 Sentinel（哨兵）进程同意 Master主服务器下线， Master主服务器的客观下线状态就会被移除。若 Master主服务器重新向 Sentinel（哨兵）进程发送 PING 命令返回有效回复，Master主服务器的主观下线状态就会被移除。</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置哨兵</span></span><br><span class="line">vim sentinel.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#进入配置文件 按i进入编辑模式</span></span><br><span class="line">sentinel monitor  名字  ip地址   端口号  1 <span class="comment"># 1代表主机挂了之后是谁成为主机</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>1代表slave投票，让谁成为主机票数最多的就是主机</p><p>我们关闭主机后，那么哨兵自动将会替我们从表中选择主机。同时也会在日志里边显示slave0 ,slave1等都是从机，master是主机。这个时候如果主机回来了，那么<strong>主机就只能当从机了，农民翻身做主人了，你想要成为主人，不太可能了，除非关闭其他从机，然后保留你自己，在关闭主机，这样方可成为主机。</strong></p><blockquote><p>优点与缺点</p></blockquote><p>优点：</p><ol><li>哨兵集群，基于主从复制模式，所有的主从配置优点他全有</li><li>主从可以切换，故障可以转移，系统的可用性就会更好</li><li>哨兵模式就是主从模式的升级，手动到自动，更加健壮</li></ol><p>缺点：</p><ol><li>Redis不好在线扩容，集权容量一旦达到上限，在线扩容就会很麻烦</li><li>实现哨兵模式的配置其实是很麻烦的，里边有很多的选择。</li></ol><blockquote><p>哨兵模式的配置</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example sentinel.conf</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 哨兵sentinel实例运行的端口 默认26379</span></span><br><span class="line">port 26379</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 哨兵sentinel的工作目录</span></span><br><span class="line"><span class="built_in">dir</span> /tmp</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 哨兵sentinel监控的redis主节点的 ip port </span></span><br><span class="line"><span class="comment"># master-name  可以自己命名的主节点名字 只能由字母A-z、数字0-9 、这三个字符&quot;.-_&quot;组成。</span></span><br><span class="line"><span class="comment"># quorum 配置多少个sentinel哨兵统一认为master主节点失联 那么这时客观上认为主节点失联了</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</span></span><br><span class="line">  sentinel monitor mymaster 127.0.0.1 6379 2</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 当在Redis实例中开启了requirepass foobared 授权密码 这样所有连接Redis实例的客户端都要提供密码</span></span><br><span class="line"><span class="comment"># 设置哨兵sentinel 连接主从的密码 注意必须为主从设置一样的验证密码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span></span><br><span class="line">sentinel auth-pass mymaster MySUPER--secret-0123passw0rd</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 指定多少毫秒之后 主节点没有应答哨兵sentinel 此时 哨兵主观上认为主节点下线 默认30秒</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span></span><br><span class="line">sentinel down-after-milliseconds mymaster 30000</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 这个配置项指定了在发生failover主备切换时最多可以有多少个slave同时对新的master进行 同步，这个数字越小，完成failover所需的时间就越长，但是如果这个数字越大，就意味着越 多的slave因为replication而不可用。可以通过将这个值设为 1 来保证每次只有一个slave 处于不能处理命令请求的状态。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt;</span></span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 故障转移的超时时间 failover-timeout 可以用在以下这些方面： </span></span><br><span class="line"><span class="comment">#1. 同一个sentinel对同一个master两次failover之间的间隔时间。</span></span><br><span class="line"><span class="comment">#2. 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那里同步数据时。</span></span><br><span class="line"><span class="comment">#3.当想要取消一个正在进行的failover所需要的时间。  </span></span><br><span class="line"><span class="comment">#4.当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了</span></span><br><span class="line"><span class="comment"># 默认三分钟</span></span><br><span class="line"><span class="comment"># sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span></span><br><span class="line">sentinel failover-timeout mymaster 180000</span><br><span class="line"> </span><br><span class="line"><span class="comment"># SCRIPTS EXECUTION</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知相关人员。</span></span><br><span class="line"><span class="comment">#对于脚本的运行结果有以下规则：</span></span><br><span class="line"><span class="comment">#若脚本执行后返回1，那么该脚本稍后将会被再次执行，重复次数目前默认为10</span></span><br><span class="line"><span class="comment">#若脚本执行后返回2，或者比2更高的一个返回值，脚本将不会重复执行。</span></span><br><span class="line"><span class="comment">#如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为1时的行为相同。</span></span><br><span class="line"><span class="comment">#一个脚本的最大执行时间为60s，如果超过这个时间，脚本将会被一个SIGKILL信号终止，之后重新执行。</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#通知型脚本:当sentinel有任何警告级别的事件发生时（比如说redis实例的主观失效和客观失效等等），将会去调用这个脚本，这时这个脚本应该通过邮件，SMS等方式去通知系统管理员关于系统不正常运行的信息。调用该脚本时，将传给脚本两个参数，一个是事件的类型，一个是事件的描述。如果sentinel.conf配置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执行的，否则sentinel无法正常启动成功。</span></span><br><span class="line"><span class="comment">#通知脚本</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;</span></span><br><span class="line">  sentinel notification-script mymaster /var/redis/notify.sh</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 客户端重新配置主节点参数脚本</span></span><br><span class="line"><span class="comment"># 当一个master由于failover而发生改变时，这个脚本将会被调用，通知相关的客户端关于master地址已经发生改变的信息。</span></span><br><span class="line"><span class="comment"># 以下参数将会在调用脚本时传给脚本:</span></span><br><span class="line"><span class="comment"># &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt;</span></span><br><span class="line"><span class="comment"># 目前&lt;state&gt;总是“failover”,</span></span><br><span class="line"><span class="comment"># &lt;role&gt;是“leader”或者“observer”中的一个。 </span></span><br><span class="line"><span class="comment"># 参数 from-ip, from-port, to-ip, to-port是用来和旧的master和新的master(即旧的slave)通信的</span></span><br><span class="line"><span class="comment"># 这个脚本应该是通用的，能被多次调用，不是针对性的。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#一般都是运维来配置：</span></span><br><span class="line"><span class="comment"># sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</span></span><br><span class="line"> sentinel client-reconfig-script mymaster /var/redis/reconfig.sh</span><br></pre></td></tr></table></figure><h3 id="Redis缓存穿透和雪崩"><a href="#Redis缓存穿透和雪崩" class="headerlink" title="Redis缓存穿透和雪崩"></a>Redis缓存穿透和雪崩</h3><p>​     缓存穿透：用户想查询一个数据，发现redis内存数据库没有，也就是缓存没有命中，于是向着持久层数据库查询，发现也没有，故而本次查询失败，当用户很多的时候，缓存都没有命中，于是都去请求了持久层数据库，这样就会使持久层造成很大压力，这个时候就出现了缓存穿透。</p><p>缓存穿透<strong>，是指查询一个数据库一定不存在的数据。正常的使用缓存流程大致是，数据查询先进行缓存查询，如果key不存在或者key已经过期，再对数据库进行查询，并把查询到的对象，放进缓存。如果数据库查询对象为空，则不放进缓存</strong></p><p>缓存穿透解决思路：</p><ol><li>如果查询数据库也为空，直接设置一个默认值存放到缓存，这样第二次到缓冲中获取就有值了，而不会继续访问数据库，这种办法最简单粗暴。</li><li>根据缓存数据Key的规则。例如我们公司是做机顶盒的，缓存数据以Mac为Key，Mac是有规则，如果不符合规则就过滤掉，这样可以过滤一部分查询。在做缓存规划的时候，Key有一定规则的话，可以采取这种办法。这种办法只能缓解一部分的压力，过滤和系统无关的查询，但是无法根治。</li><li>采用布隆过滤器，将所有可能存在的数据哈希到一个足够大的BitSet中，不存在的数据将会被拦截掉，从而避免了对底层存储系统的查询压力。关于布隆过滤器，详情查看：基于BitSet的布隆过滤器（Bloom Filter）</li></ol><p>缓存击穿，<strong>是指一个key非常热点，在不停的扛着大并发，大并发集中对这一个点进行访问，当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，就像在一个屏障上凿开了一个洞。</strong></p><p>缓存雪崩</p><p><strong>就是指缓存由于某些原因（比如宕机、cache服务挂了或者不响应）整体crash掉了，导致大量请求到达后端数据库，从而导致数据库崩溃，整个系统崩溃，发生灾难。</strong><br>下面的就是一个雪崩的简单过程：<br>1、redis集群彻底崩溃<br>2、缓存服务大量对redis的请求hang住，占用资源<br>3、缓存服务大量的请求打到源头服务去查询mysql，直接打死mysql<br>4、源头服务因为mysql被打死也崩溃，对源服务的请求也hang住，占用资源</p><p>5、缓存服务大量的资源全部耗费在访问redis和源服务无果，最后自己被拖死，无法提供服务</p><p>6、nginx无法访问缓存服务，redis和源服务，只能基于本地缓存提供服务，但是缓存过期后，没有数据提供</p><p>7、网站崩渍</p><p><strong>缓存雪崩的解决方案</strong><br>1，采用加锁计数，或者使用合理的队列数量来避免缓存失效时对数据库造成太大的压力。这种办法虽然能缓解数据库的压力，但是同时又降低了系统的吞吐量。<br>2，分析用户行为，尽量让失效时间点均匀分布。避免缓存雪崩的出现。<br>3，如果是因为某台缓存服务器宕机，可以考虑做主备，比如：redis主备，但是双缓存涉及到更新事务的问题，update可能读到脏数据，需要好好解决。</p><h3 id="Redis集群分布部署"><a href="#Redis集群分布部署" class="headerlink" title="Redis集群分布部署"></a>Redis集群分布部署</h3>]]></content>
    
    
    <summary type="html">作为目前最受欢迎的NoSQL，Redis有他的独特之处，并且Redis作为在内存层次的数据库，他的快速和处理相对MySQL来说具有很大的优势，但是其与MySQL各有优势。</summary>
    
    
    
    <category term="数据库" scheme="https://www.blog.909111.xyz/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="Redis" scheme="https://www.blog.909111.xyz/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQ学习笔记</title>
    <link href="https://www.blog.909111.xyz/posts/d439760d.html"/>
    <id>https://www.blog.909111.xyz/posts/d439760d.html</id>
    <published>2023-11-09T02:50:23.338Z</published>
    <updated>2024-04-22T08:22:43.582Z</updated>
    
    <content type="html"><![CDATA[<h1 id="RabbitMQ学习笔记"><a href="#RabbitMQ学习笔记" class="headerlink" title="RabbitMQ学习笔记"></a>RabbitMQ学习笔记</h1><p>分布式架构：一个请求由多个服务（服务或者系统）协同处理完成。</p><p>RabbitMQ：消息队列，或者说是一个消息中间键。</p><p>MQ功能：</p><ol><li><strong>削峰</strong>：不让系统直接访问系统，而是通过MQ,然后交给MQ去访问系统，使得访问的人员进行排队。（有排队就会导致比较慢，但是安全有次序。）</li><li><strong>应用解耦</strong>：通过队列去访问系统，各个系统之间通过MQ去完成，也就会不会产生过多故障。</li><li><strong>异步处理</strong>：A-B，并不要A收到B的确定消息才会执行操作。</li></ol><p>MQ的分类：</p><ol><li><p>RabbitMQ: 和spring是一家公司的，使用AMQP(高级消息队列协议）基础上完成的，支持多种语言，缺点是商业版要付费。</p></li><li><p>kafka:为大数据而生，有百万级TPS的，实时计算，吞吐量高，使用在日志采集等方面。缺点是，单机超过64个队列/分区，load会发生明显的飙高现象，队列越多，load越高，发送响应时间越长。消费失败不支持重试，支持消息顺序，但一代代理宕机后，会产生消息乱序，社区更新慢。</p></li><li><p>RocketMQ：由阿里开发，金融行业需要，使用java语言实现，参考了kafka,一般常用于订单，交易，充值，流计算，消息推送，日志处理，bingblog分发等场景。</p><ol><li>优点：单机吞吐10w级别，信息可以做到0丢失，MQ功能比较完善，还是分布式，拓展性号，支持10亿级别的消息堆积，不会因为堆积而导致性能下降。</li><li>缺点：这次客户端语言不多，目前是java和C++,其中C++还不成熟，社区活跃一般。</li></ol></li></ol><h1 id="初级部分："><a href="#初级部分：" class="headerlink" title="初级部分："></a>初级部分：</h1><p>RabbitMQ：是一个消息中间件，可以当做一个快递站，快递员发包裹到快递站，然后本地快递员将快递发给用户。</p><p>生产者：生产者 - &gt; mq （一个交换机可以绑定多个队列） -&gt; 消费者，一般情况下是一个队列对应一个消费者，如果两个一个队列对应两个消费者，那么就只有一个消费者收到消息，这就想当与只有一个包裹是不可能发给两个人的。</p><p>核心部分：</p><ol><li>简单模式</li><li>工作模式</li><li>发布订阅模式</li><li>路由模式</li><li>主题模式</li><li>发布确认模式</li></ol><p><strong>connection:</strong>publisher/consumer 和 broker之间的TCP连接。</p><p><strong>Channel:</strong>如果每一次访问RabbitMQ都建立一个Connection，在消息量大的时候建立TCP Connection的开销是巨大的，效率也比较低。<strong>channel作为轻量级的Connection极大减少了操作系统建立TCP connection的开销。</strong></p><h2 id="安装rabbitMQ："><a href="#安装rabbitMQ：" class="headerlink" title="安装rabbitMQ："></a>安装rabbitMQ：</h2><p>官网：<a href="https://www.rabbitmq.com">https://www.rabbitmq.com</a></p><p>下载页面：<a href="https://www.rabbitmq.com/download.html">https://www.rabbitmq.com/download.html</a></p><p>我一般使用docker安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># latest RabbitMQ 3.10</span></span><br><span class="line">docker run -it --<span class="built_in">rm</span> --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3.10-management</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>其他安装方式：</p><ol><li>首先现在linux下的压缩包，或者使用工具将安装包上传到linux系统。</li></ol><ol><li><p>安装rabbitMQ的支持依赖</p><ol><li><code>rpm  -ivh erlang-21.3-1.el7.x86_64.rpm</code></li><li><code>yml install socat -y</code></li><li><code>rpm -ivh rabbitmq-server-3.8.8-1.el7.noarch.rpm</code></li></ol></li><li><p>添加常用命令：</p><ol><li><p>添加开机启动<code>chkconfig rabbitmq-server on</code></p></li><li><p>启动服务 </p><ol><li><p>找到安装路径</p></li><li><p>sbin下的service 里边的rabbitmq-server start   <code>/sbin/service rabbitmq-server start</code></p></li><li><p>查看服务状态<code>/sbin/service rabbitmq-server status</code></p></li><li><p>停止服务<code>/sbin/service rabbitmq-server stop</code></p></li><li><p>开启后台web管理插件<code>rabbitmq-plugins enable rabbitmq_management</code>（docker安装的不要这么操作）</p></li><li><p>使用账号访问，一般是账号密码都是guest，当然你必须保证你的端口号开放，如果云服务器的话，15972，注意ip地址，如果有域名的话，那么可以在域名后添加<code>：15672</code>直接访问.</p></li><li><p>如果不能直接访问的话，检查一下防火墙，<code>systemctl stop firewalld</code>,这个命令关闭本次防火墙，<code>systemctl enable firewalld</code>可以下次开机也关闭防火墙，<code>systemctl status firewalld</code>可以查看当前系统防护墙状态</p></li><li><p>添加一个新用户，如果是使用虚拟机的话，一般是不能直接使用guest登录的，当然这个我没碰到过</p><ol><li><p>创建一个账号<code>rabbitmqctl add_user 用户名 密码</code></p></li><li><p>设置用户角色 <code>rabbitmqctl set_user_tags admin administractor</code></p></li><li><p>设置用户权限</p><p><code>set_permission[-p &lt;vhostpath&gt;] &lt;user&gt; &lt;conf&gt; &lt;write&gt; &lt;read&gt;</code></p><p>举例：</p><p><code>rabbitmqctl set_permission -p &quot;/&quot; admin &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</code>用户user_admin具有/vhost1这个vritual host中的所有资源的配置，写，读权限。</p></li><li><p>当前用户和角色</p><p><code>rabbitmqctl list_user</code></p></li></ol></li></ol></li></ol></li></ol><h2 id="如何使用MQ-java代码实现"><a href="#如何使用MQ-java代码实现" class="headerlink" title="如何使用MQ(java代码实现)"></a>如何使用MQ(java代码实现)</h2><p>IDEA新建maven工程导入依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--指定jdk版本--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--rabbitmq依赖客户端--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.16.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--操作文件流的一个依赖--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="生产者和消费者："><a href="#生产者和消费者：" class="headerlink" title="生产者和消费者："></a>生产者和消费者：</h2><p>生产者 - 消息队列 - 消费者</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">生产者，目标是发消息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="comment">//队列名称</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span>  String QUEUE_NAME=<span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发消息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//建立一个连接方式</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        <span class="comment">//工厂IP 连接RabbitMQ的队列</span></span><br><span class="line">        factory.setHost(<span class="string">&quot;www.littlehei.fun&quot;</span>);</span><br><span class="line">        <span class="comment">//用户名</span></span><br><span class="line">        factory.setUsername(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//密码</span></span><br><span class="line">        factory.setPassword(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建链接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.newConnection();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取信道</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//生成一个队列</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        生成队列</span></span><br><span class="line"><span class="comment">        参数1，队列名称</span></span><br><span class="line"><span class="comment">        参数2，队列里边的消息是否持久化（磁盘）默认情况消息存储在内存中</span></span><br><span class="line"><span class="comment">        参数3，该队列是否只供一个消费者进行消费，是否进行消息共享，true可以多个消费者消费,false：只能一个消费者消费</span></span><br><span class="line"><span class="comment">        参数4，是否自动删除，最后一个消费者断开链接以后，该队是否自动删除，true，自动删除，false不删除</span></span><br><span class="line"><span class="comment">        参数5，其他参数</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">//发消息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello world&quot;</span>;<span class="comment">//初次使用</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        发送一个消费</span></span><br><span class="line"><span class="comment">        参数1，发送到哪个交换机</span></span><br><span class="line"><span class="comment">        参数2.路由的key值是哪个？  本次是队列的名称</span></span><br><span class="line"><span class="comment">        参数3，其他参数配置</span></span><br><span class="line"><span class="comment">        参数4，发送消息的消息体</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicPublish(<span class="string">&quot;&quot;</span>,QUEUE_NAME,<span class="literal">null</span>,message.getBytes());</span><br><span class="line">        System.out.println(<span class="string">&quot;消息发送成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>消费者：用来接受生成者产生的消息。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">消费者，用来消费生成者产生的代码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="comment">//队列的名称：</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span> String QUEUE_NAME=<span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//接收消息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//创建链接工厂</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        factory.setHost(<span class="string">&quot;www.littlehei.fun&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span>  factory.newConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span>  connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//声明</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag,message)-&gt;&#123;</span><br><span class="line">         <span class="comment">//  String message = new String(&quot;自己手动去创建一个消息，但是不推荐&quot;);</span></span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//取消消息时的回调</span></span><br><span class="line">        <span class="type">CancelCallback</span> <span class="variable">cancelCallback</span> <span class="operator">=</span> consumerTag -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;消息消费被中断&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        消费者接收消息</span></span><br><span class="line"><span class="comment">        参数1，消费哪个队列</span></span><br><span class="line"><span class="comment">        参数2，消费成功之后是否要自动应答，true表示自动应答，false表示不是</span></span><br><span class="line"><span class="comment">        参数3，消费者未成功消费的回调</span></span><br><span class="line"><span class="comment">        参数4，消费者取录消费的回到</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">      channel.basicConsume(QUEUE_NAME,<span class="literal">true</span>,deliverCallback,cancelCallback);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="工作队列"><a href="#工作队列" class="headerlink" title="工作队列"></a>工作队列</h2><p>生成者 —-大量发消息— 队列 — 接到消息—工作线程1或者工作线程2.。。。</p><p>==注意：一个消息只能被处理一次不能处理多次==</p><p>轮训处理消息，你一个，我下一个，他下下个。</p><p>不同<strong>工作线程</strong>之间的关系是==竞争==关系</p><p>创建链接工具类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetConnection</span> &#123;</span><br><span class="line">    <span class="comment">//建立一个工具类，每次都直接使用，减少代码重复量</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> Channel <span class="title function_">getChannel</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//创建一个链接工厂</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">&quot;www.littlehei.fun&quot;</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="keyword">return</span> channel;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>轮训分发代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">一个工作线程,可以多个创建，可以多线程创建，具体看你自己如何定于</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WorkThread1</span> &#123;</span><br><span class="line">    <span class="comment">//首先还是创建一个队列名称</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">final</span>   <span class="type">String</span>  <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//接收消息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">          <span class="comment">/*</span></span><br><span class="line"><span class="comment">        消费者接收消息</span></span><br><span class="line"><span class="comment">        参数1，消费哪个队列</span></span><br><span class="line"><span class="comment">        参数2，消费成功之后是否要自动应答，true表示自动应答，false表示不是</span></span><br><span class="line"><span class="comment">        参数3，消费者未成功消费的回调</span></span><br><span class="line"><span class="comment">        参数4，消费者取录消费的回到</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag,message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;接收到的消息为&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">CancelCallback</span> <span class="variable">cancelCallback</span> <span class="operator">=</span> (consumerTag)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;消息被取消消费接口回调&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(<span class="string">&quot;C1等待接收消息...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//消息接收</span></span><br><span class="line">        channel.basicConsume(QUEUE_NAME,<span class="literal">true</span>,deliverCallback,cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>生产者：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">生产者，可以发送大量消息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//队列名称</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">final</span>  String QUEUE_NAEM=<span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送大量消息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">        <span class="comment">//队列声明</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAEM,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//发送消息</span></span><br><span class="line">        <span class="comment">//从控制台中输入</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="comment">//判断是否有下一个消息输入</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (sc.hasNext())&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> sc.next();</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>,QUEUE_NAEM,<span class="literal">null</span>,name.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;发送完成： &quot;</span>+name);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">----------结果----------</span><br><span class="line">nihap</span><br><span class="line">发送完成nihap</span><br><span class="line">wp1</span><br><span class="line">发送完成wp1</span><br><span class="line">ci1</span><br><span class="line">发送完成ci1</span><br><span class="line">wooda</span><br><span class="line">发送完成wooda</span><br><span class="line">我喜欢你</span><br><span class="line">发送完成我喜欢你</span><br><span class="line">------------------</span><br><span class="line">C1等待接收消息...</span><br><span class="line">接收到的消息为nihap</span><br><span class="line">接收到的消息为ci1</span><br><span class="line">接收到的消息为我喜欢你</span><br><span class="line">--------------------</span><br><span class="line">C2等待接收消息...</span><br><span class="line">接收到的消息为wp1</span><br><span class="line">接收到的消息为wooda</span><br></pre></td></tr></table></figure><h2 id="消息应答"><a href="#消息应答" class="headerlink" title="消息应答"></a>消息应答</h2><p>为了防止消息在发送过程中不丢失，他是==指消费者收到消息并且处理该消息之后，告诉rabbitmq他已经处理完成了，rabbitmq可以把消息删除。==</p><h3 id="自动应答："><a href="#自动应答：" class="headerlink" title="自动应答："></a>自动应答：</h3><p>需要在<strong>高吞吐量和数据传输安全性方面做权衡</strong>，这种模式如果消息在接受到之前，消费者那边出现链接或者channel关闭，那么消息就丢失了，当然如果另一方面这种模式消费者那边可以传递过载消息，没有对传递的消息数量进行限制，这样有可能导致消费者由于接收太多还来不及处理的消息，导致这些消息积压，最终导致内存耗尽，最终这些消费者线程被操作系统杀死，故而<strong>这种模式适用在消费者可以高效并以某种速率能够处理这些消息的情况下使用。</strong>（不靠谱）                                         </p><h3 id="手动应答"><a href="#手动应答" class="headerlink" title="手动应答"></a>手动应答</h3><p>能用手动则用手动。手动方法</p><ol><li>Channel.basicAck(用于肯定确认)</li><li>Channel.basicNack(用于否定确认)</li><li>Channel.basicReject(用于否定确认)，对比nack少了一个参数，不处理该消息了直接就可以拒绝，也可以将他丢弃。</li></ol><p>批量应答（multiple）：==推荐使用false==,当接受到一个消息的时候，也就是队列往信道里边放了n条数据，那么他会将此信道里边的所有消息都应答一次。</p><h3 id="消息自动重新入队"><a href="#消息自动重新入队" class="headerlink" title="消息自动重新入队"></a>消息自动重新入队</h3><p>如果消费者由于某些原因失去连接，或者说他的通道已经关闭，连接已经关闭或者TCP连接丢失，导致消息未发送ACK确认，<strong>此时RabbitMQ将了解到消息未完全处理，并将其重新排队，如果此时其他消费者可以处理，他将很快将其重新分发给另一个消费者，</strong>这样即使某个消费者偶尔死亡，也可以确保不会丢失任何信息。</p><p>个人理解：</p><p>也就是本来做这个任务的员工有事辞职了，公司为了完成任务交给另一个还在职的员工完成这个任务，直到这个任务完成，这样保证任务不被丢失。</p><p>代码实现：</p><p>消息在手动应答的时候是不应该被丢失的，且会重新入队。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">我们主要围绕的是手动应答进行处理，要是消息应答不丢失，放回队列</span></span><br><span class="line"><span class="comment">重新消费</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Task</span> &#123;</span><br><span class="line">    <span class="comment">//老样子，队列名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;ack_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//声名队列</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从控制台中获取</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (sc.hasNext())&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> sc.next();</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>,QUEUE_NAME,<span class="literal">null</span>,message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;生产者发送消息： &quot;</span>+ message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">接收消息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Work_Consume1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;ack_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//接受消息</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;C1等待接受消息处理时间较短&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message)-&gt;&#123;</span><br><span class="line">            <span class="comment">//看情况你给不给休眠</span></span><br><span class="line">            SleepUtils.sleep(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;接收到消息&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            <span class="comment">//进行手动应答</span></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            参数1 ， 消息的标记tag</span></span><br><span class="line"><span class="comment">            参数2， 是否批量应答  false 不 ，true，批量应答</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.basicAck(message.getEnvelope().getDeliveryTag(),<span class="literal">false</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//手动接收消息</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//采用手动应答</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">autoAck</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        channel.basicConsume(QUEUE_NAME,autoAck,deliverCallback,(consumerTag-&gt;&#123;</span><br><span class="line">            System.out.println(consumerTag + <span class="string">&quot;消费者取消消费接口回调逻辑&quot;</span>);</span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Title 休眠工具类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SleepUtils</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">(<span class="type">int</span> second)</span> &#123;</span><br><span class="line">        <span class="comment">//JUC里边的工具类</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>*second);</span><br><span class="line">            <span class="comment">//TimeUnit.SECONDS.sleep(2);</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="comment">//中断</span></span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过上述方式，我们可以知道消息队列在我们创建多个消费者的时候，是轮转来的，当然，假设有两个消费者，如果有一个宕机，那么消息队列就将本轮转给没宕机的那个消费者消费，==只要生产者有产生，无论如何要将消息全部消费==，不可丢弃。</p><h2 id="Rabbit消息持久化"><a href="#Rabbit消息持久化" class="headerlink" title="Rabbit消息持久化"></a>Rabbit消息持久化</h2><p>消息是可以持久化保存的，持久的目的是为了处理任务丢失情况的，采用持久化可以保证消息存储，且消息不被丢失。</p><h4 id="队列如何持久化"><a href="#队列如何持久化" class="headerlink" title="队列如何持久化"></a>队列如何持久化</h4><blockquote><p>两个持久化操作都是在生产者中进行的。</p></blockquote><p>我们需要将durable参数设置为持久化</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//让队列持久化</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">durable</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">channel.queueDeclare(队列名,durable,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>)</span><br></pre></td></tr></table></figure><p>但是需要注意的是，==就是如果之前声明的队列不是持久化的，需要把原先队列先删除，然后重新创建一个持久化队列，不然就会出现错误==。</p><p>错误：</p><blockquote><p>com.rabbitmq.client.ShutdownSignalException: channel error; protocol method: #method<channel.close>(reply-code=406, reply-text=PRECONDITION_FAILED - inequivalent arg ‘durable’ for queue ‘ack_queue’ in vhost ‘/‘: received ‘true’ but current is ‘false’, class-id=50, method-id=10)</p></blockquote><p><strong>注意：</strong></p><p>==持久化后的rabbitMQ重启之后队列消息还是会存在的，未持久化的，那么对不起，他没了。==</p><h4 id="消息持久化"><a href="#消息持久化" class="headerlink" title="消息持久化"></a>消息持久化</h4><p>将消息标记为持久化并不能保证不会丢失消息，尽管他会告诉rabbitMQ将消息保存到磁盘中，但是这里仍然存在当消息刚刚存储池在磁盘的时候，但是还没有存储完，消息还在缓存的一个间隔点，此时并没有真正写入磁盘，持久性保证并不强，但是对于我们简单任务队列而言，这已经就绰绰有余了。</p><p><code>MessageProperties.PERSISTENT_TEXT_PLAIN</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Task</span> &#123;</span><br><span class="line">    <span class="comment">//老样子，队列名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;ack_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//声名队列</span></span><br><span class="line">        <span class="comment">//让队列持久化</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">durable</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        channel.queueDeclare(QUEUE_NAME,durable,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//从控制台中获取</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (sc.hasNext())&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> sc.next();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//添加持久化</span></span><br><span class="line">            <span class="comment">//设置生成者发送消息为持久化信息（要求保存到硬盘上）保存在内存中</span></span><br><span class="line">            <span class="comment">//MessageProperties.PERSISTENT_TEXT_PLAIN,指令完成持久化</span></span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>,QUEUE_NAME, MessageProperties.PERSISTENT_TEXT_PLAIN,message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">           <span class="comment">//未持久化时候的是</span></span><br><span class="line">            <span class="comment">// channel.basicPublish(&quot;&quot;,QUEUE_NAME,null,message.getBytes(&quot;UTF-8&quot;));</span></span><br><span class="line">            System.out.println(<span class="string">&quot;生产者发送消息： &quot;</span>+ message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="不公平分发："><a href="#不公平分发：" class="headerlink" title="不公平分发："></a>不公平分发：</h3><p>在某些情况下轮训分发并不好用，具体例子：有两个消费者在处理任务，其中有个消费者1处理任务的速度非常快，而另一个消费者2处理的速度却很慢，这个时候我们还采用轮训分发就会导致这个处理速度快的很大一部分时间处于空闲状态，而处理慢的那个消费者就一直在干活，这种分配方式就不是很好。 </p><p>==能者多劳==，多劳多得。</p><p>为了避免这种情况，我们有采用不公平分发操作</p><p>设置参数<strong>channel.basicQos(1);</strong></p><blockquote><p>能者多劳是在消费者中设置的</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//能者多劳</span></span><br><span class="line"><span class="type">int</span> <span class="variable">prefetchCount</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">channel.basicQos(prefetchCount);</span><br></pre></td></tr></table></figure><p>一般我们生活中采用的就是不公平分发。</p><p><strong>预取值：</strong></p><p>预先分配任务，比如生产者生成7条数据，通过队列分发，通过==预取值，预取值是多少，就给属于那条信道的消费者分配多少消息。和消费者处理消息的快慢无关。==</p><p><strong>注意</strong>：</p><p>预取值消耗完毕后，之后的值就按照那个消费者快给他分配的信息就多，谁慢，谁分配的信息就少。</p><p>预取值是洗发人员能限制缓冲区大小，避免缓冲区里边无限制的未确定消息问题。</p><p>需要注意的是，预取值并不是你直接输入多少条数据他就可以直接堆满的我们设置的预取值的，他可能由于消费费者处理速度影响，比如，你输入10条数据，但是设置预取值为5的最后值只会产生4条数据也说不准，因为另一个太快了，其他的数据都被他消耗完毕了。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置非公平分发</span></span><br><span class="line">      <span class="comment">//int i = 1;</span></span><br><span class="line">      <span class="comment">//预取值</span></span><br><span class="line">      <span class="type">int</span> i= <span class="number">5</span>; <span class="comment">//设置分发5个消息，也就是预取值为5</span></span><br><span class="line">      channel.basicQos(i);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置</span></span><br><span class="line">        <span class="comment">//int i = 1; //不公平分发</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>;<span class="comment">//此时设置就是预取值了</span></span><br><span class="line">        channel.basicQos(i);</span><br></pre></td></tr></table></figure><h2 id="发布和确认"><a href="#发布和确认" class="headerlink" title="发布和确认"></a>发布和确认</h2><p>生产者 - - 发送消息 — 队列hello         :apple:必须保存在磁盘上才能达到持久化操作。</p><ol><li>设置要去队列必须持久化</li><li>设置要求队列中的消息必须持久化</li><li>发布确认</li></ol><h3 id="开启发布确认"><a href="#开启发布确认" class="headerlink" title="开启发布确认"></a>开启发布确认</h3><h4 id="单个确认发布："><a href="#单个确认发布：" class="headerlink" title="单个确认发布："></a>单个确认发布：</h4><p>每次生产者生产一个消息他都会确认一次，这样的好处就是，如果发送信息丢失可以很容易确定位置，缺点是慢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//单个确认</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">publicMessageIndividually</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TimeoutException, InterruptedException &#123;</span><br><span class="line">       <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//队列的声明</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//使用信道对队列进行声明</span></span><br><span class="line">       channel.queueDeclare(queueName,<span class="literal">true</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">       <span class="comment">//开启发布确认</span></span><br><span class="line">       channel.confirmSelect();</span><br><span class="line">       <span class="comment">//开始时间</span></span><br><span class="line">       <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//批量发消息</span></span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;</span><br><span class="line">           <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> i + <span class="string">&quot;&quot;</span>;</span><br><span class="line">           channel.basicPublish(<span class="string">&quot;&quot;</span>,queueName,<span class="literal">null</span>,message.getBytes());</span><br><span class="line">           <span class="comment">//单个消息就马上进行发布确认</span></span><br><span class="line">           <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> channel.waitForConfirms();</span><br><span class="line">           <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">               System.out.println(<span class="string">&quot;消息发送成功&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//结束时间</span></span><br><span class="line">       <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">       System.out.println(<span class="string">&quot;发布&quot;</span> + MESSAGE_COUNT + <span class="string">&quot;单个消息&quot;</span> + (end-begin)+<span class="string">&quot;毫秒&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="批量确认发布："><a href="#批量确认发布：" class="headerlink" title="批量确认发布："></a>批量确认发布：</h4><p>批量发布对比单个发布速度快了很多，但是这个碰到问题去查找问题的时候就比较慢了。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//批量发布</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">publicMessageBatch</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TimeoutException, InterruptedException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//队列的声明</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用信道对队列进行声明</span></span><br><span class="line">        channel.queueDeclare(queueName,<span class="literal">true</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">//开启发布确认</span></span><br><span class="line">        channel.confirmSelect();</span><br><span class="line">        <span class="comment">//开始时间</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//批量确认消息的大小</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">batchSize</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="comment">//未确认消息个数</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//批量发消息，批量发布确认</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> i + <span class="string">&quot;&quot;</span>;</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>,queueName,<span class="literal">null</span>,message.getBytes());</span><br><span class="line">            <span class="comment">//单个消息就马上进行发布确认</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> channel.waitForConfirms();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//消息达到10确认一次</span></span><br><span class="line">            <span class="keyword">if</span>(i%batchSize == <span class="number">0</span>)&#123;</span><br><span class="line">                channel.waitForConfirms();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//结束时间</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;发布&quot;</span> + MESSAGE_COUNT + <span class="string">&quot;发布100个消息&quot;</span> + (end-begin) +<span class="string">&quot;毫秒&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="异步确认发布"><a href="#异步确认发布" class="headerlink" title="异步确认发布"></a>异步确认发布</h4><p>对比单步和批量这个就厉害多了，他可以异常进行，他是利用回调函数来达到消息可靠性传递的，这个中间件也是通过函数回调来保证是否投递成功。</p><p>寄快件的人疯狂发，然后到broker中选择哪些需要确认的进行确认。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//异步</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">publishMessageAsync</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">      <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//队列的声明</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//使用信道对队列进行声明</span></span><br><span class="line">      channel.queueDeclare(queueName,<span class="literal">true</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">      <span class="comment">//开启发布确认</span></span><br><span class="line">      channel.confirmSelect();</span><br><span class="line">      <span class="comment">//开始时间</span></span><br><span class="line">      <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//消息确认成功，回调函数</span></span><br><span class="line">      <span class="type">ConfirmCallback</span> <span class="variable">ackCallback</span> <span class="operator">=</span> (delivery,multiple)-&gt;&#123;</span><br><span class="line">          System.out.println(<span class="string">&quot;确认的消息：&quot;</span> + delivery);</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="comment">//消息确认失败，回调函数</span></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        1.消息的标记</span></span><br><span class="line"><span class="comment">        2.消息是否为批量</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="type">ConfirmCallback</span> <span class="variable">nackCallback</span> <span class="operator">=</span> (delivery,multiple)-&gt;&#123;</span><br><span class="line">          System.out.println(<span class="string">&quot;未确认的消息：&quot;</span> + delivery);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//在发消息的时候，你需要准备一个监听器，监听哪些消息成功了，哪些消息失效了</span></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">      1.监听哪些消息成功了</span></span><br><span class="line"><span class="comment">      2.监听哪些消息失败了</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      channel.addConfirmListener(ackCallback,nackCallback);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//批量发送消息</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;</span><br><span class="line">          <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;消息&quot;</span> + i;</span><br><span class="line">          channel.basicPublish(<span class="string">&quot;&quot;</span>,queueName,<span class="literal">null</span>,message.getBytes());</span><br><span class="line">          <span class="comment">//发布确认，这个时候要是进行发布确认就是同步了</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">//结束时间</span></span><br><span class="line">      <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span>  System.currentTimeMillis();</span><br><span class="line">      System.out.println(<span class="string">&quot;发布&quot;</span> + MESSAGE_COUNT + <span class="string">&quot;异步发布确认消息，耗时&quot;</span> + (end-begin) +<span class="string">&quot;毫秒&quot;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="这就出现一个问题，如何处理异步未确认消息"><a href="#这就出现一个问题，如何处理异步未确认消息" class="headerlink" title="这就出现一个问题，如何处理异步未确认消息"></a>这就出现一个问题，如何处理异步未确认消息</h4><p>最好的解决的解决方案，就是把未确认的消息放到一个基于内存的能发布线程访问的队列，比如说ConcurrentLinkedQueue这个队列在confirm callbacks与发布线程之间进行消息的传递。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//异步</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">publishMessageAsync</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">       <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//队列的声明</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//使用信道对队列进行声明</span></span><br><span class="line">       channel.queueDeclare(queueName,<span class="literal">true</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">       <span class="comment">//开启发布确认</span></span><br><span class="line">       channel.confirmSelect();</span><br><span class="line"></span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">       线程安全有序的一个哈希表，适用于高并发的情况下的</span></span><br><span class="line"><span class="comment">       1.轻松将序号和消息进行关联</span></span><br><span class="line"><span class="comment">       2.轻松批量删除条目，只要给到序号</span></span><br><span class="line"><span class="comment">       3.支持高并发（多线程）</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       ConcurrentSkipListMap&lt;Long,String&gt;  outstandingConfirms=</span><br><span class="line">               <span class="keyword">new</span> <span class="title class_">ConcurrentSkipListMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//消息确认成功，回调函数</span></span><br><span class="line">       <span class="type">ConfirmCallback</span> <span class="variable">ackCallback</span> <span class="operator">=</span> (delivery,multiple)-&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(multiple)&#123;</span><br><span class="line">            <span class="comment">//删除已经确认的消息，剩下的就是为确认的消息</span></span><br><span class="line">            ConcurrentNavigableMap&lt;Long, String&gt; confirmed =</span><br><span class="line">                     outstandingConfirms.headMap(delivery);</span><br><span class="line">            confirmed.clear();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            outstandingConfirms.remove(delivery);</span><br><span class="line">        &#125;</span><br><span class="line">           System.out.println(<span class="string">&quot;确认的消息：&quot;</span> + delivery);</span><br><span class="line">       &#125;;</span><br><span class="line">       <span class="comment">//消息确认失败，回调函数</span></span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">         1.消息的标记</span></span><br><span class="line"><span class="comment">         2.消息是否为批量</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       <span class="type">ConfirmCallback</span> <span class="variable">nackCallback</span> <span class="operator">=</span> (delivery,multiple)-&gt;&#123;</span><br><span class="line">          <span class="comment">//3.打印一下未确认的消息都有哪些</span></span><br><span class="line">         <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span>  outstandingConfirms.get(delivery);</span><br><span class="line">           System.out.println(<span class="string">&quot;未确认的消息是:&quot;</span> + message+<span class="string">&quot;未确认的标记：&quot;</span> + delivery);</span><br><span class="line">       &#125;;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//在发消息的时候，你需要准备一个监听器，监听哪些消息成功了，哪些消息失效了</span></span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">       1.监听哪些消息成功了</span></span><br><span class="line"><span class="comment">       2.监听哪些消息失败了</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       channel.addConfirmListener(ackCallback,nackCallback); <span class="comment">// 异步通知</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//开始时间</span></span><br><span class="line">       <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="comment">//批量发送消息</span></span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;</span><br><span class="line">           <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;消息&quot;</span> + i;</span><br><span class="line">           channel.basicPublish(<span class="string">&quot;&quot;</span>,queueName,<span class="literal">null</span>,message.getBytes());</span><br><span class="line">           <span class="comment">//发布确认，这个时候要是进行发布确认就是同步了</span></span><br><span class="line">           <span class="comment">/*</span></span><br><span class="line"><span class="comment">           1。此处记录下所有要发送的消息，消息的总和</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">      outstandingConfirms.put(channel.getNextPublishSeqNo(),message);</span><br><span class="line">           System.out.println();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//结束时间</span></span><br><span class="line">       <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span>  System.currentTimeMillis();</span><br><span class="line">       System.out.println(<span class="string">&quot;发布&quot;</span> + MESSAGE_COUNT + <span class="string">&quot;异步发布确认消息，耗时&quot;</span> + (end-begin) +<span class="string">&quot;毫秒&quot;</span>);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="以上三种发布的确认速度对比"><a href="#以上三种发布的确认速度对比" class="headerlink" title="以上三种发布的确认速度对比"></a>以上三种发布的确认速度对比</h3><p>单步发布消息</p><ul><li>同步等待确认，简单，但是吞吐量非常有限</li></ul><p>批量发布确认</p><ul><li>批量同步等待确认，加单，合理的吞吐量，一旦出现问题，但很难推断出是那条消息出现了问题。</li></ul><p>异步发布确认</p><p>最佳性能和资源使用，在出现错误的情况下可以很好的控制，但是实现起来稍微难一点。</p><h2 id="交换机（exchanges）"><a href="#交换机（exchanges）" class="headerlink" title="交换机（exchanges）"></a>交换机（exchanges）</h2><p>当使用到交换机的时候，我们用的就不是普通的模式了，而是发布订阅模式了。</p><p><strong>生产者生成的消息不会直接发送到队列</strong></p><p>而是直接将消息先发送到交换机，并且只能发送到交换机，之钱的我们可以直接发送到队列（事实上我们走的是默认交换机），然后队列交给消费者，现在不行了，改成先发送给交换机，交换机在发给队列。</p><p>交换机的工作方式很简单，<strong>他接收来自生产者的消息，另一方面将他们推送到队列。</strong></p><h3 id="交换机的类型"><a href="#交换机的类型" class="headerlink" title="交换机的类型"></a>交换机的类型</h3><p>直接（direct）,主题（topic）,标题（heads），扇出（fanout）</p><h4 id="无名exchanges"><a href="#无名exchanges" class="headerlink" title="无名exchanges"></a>无名exchanges</h4><p>事实上就是默认类型，我们通过空字符（””）串进行标识。</p><p><code>channel.basicPublic(&quot;&quot;,&quot;hello&quot;,null,message.getBytes());</code></p><p>实际上第一个参数就是交换机的名字，空字符串表示默认或者无名称交换机，消息能路由发送到队列中，其实是由routing(bindingkey)绑定key指定的，如果它存在的话。</p><h4 id="临时队列"><a href="#临时队列" class="headerlink" title="临时队列"></a>临时队列</h4><p>实际上是自定义的，一旦断开链接，这个队列就会被删除。</p><h4 id="绑定"><a href="#绑定" class="headerlink" title="绑定"></a>绑定</h4><p>实际上就是交换机和队列的桥梁，他告诉我们交换机和那个队列进行绑定关系</p><h4 id="Fanout"><a href="#Fanout" class="headerlink" title="Fanout"></a>Fanout</h4><p>fanout是一种交换机的类型，这种类型非常简单，正如名称中猜想的那样，他是将接收的所有消息<strong>广播</strong>到他知道的所有队列中，系统中默认有exchanges交换机类型。</p><p><img src="1667315273358.png" alt="1667315273358"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">发消息 交换机</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmitLog</span> &#123;</span><br><span class="line">    <span class="comment">//交换机的名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span>  String EXCHANGE_NAME=<span class="string">&quot;logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME,<span class="string">&quot;fanout&quot;</span>);</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (sc.hasNext())&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> sc.next();</span><br><span class="line">            channel.basicPublish(EXCHANGE_NAME,<span class="string">&quot;&quot;</span>,<span class="literal">null</span>,message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;生产者发送消息：&quot;</span> + message);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">消息接收,客户端</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLog</span> &#123;</span><br><span class="line">    <span class="comment">//交换机的名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span>  String EXCHANG_NAME=<span class="string">&quot;logs&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">        <span class="comment">//声明一个交换机</span></span><br><span class="line">      channel.exchangeDeclare(EXCHANG_NAME,<span class="string">&quot;fanout&quot;</span>);</span><br><span class="line">        <span class="comment">//声明一个队列，来一个临时队列</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        队列的名称是随机的。</span></span><br><span class="line"><span class="comment">        当消费者断开与队列的连接的时候，队列就可以自动删除</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span>  channel.queueDeclare().getQueue();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        绑定交换机和队列</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">      channel.queueBind(queueName,EXCHANG_NAME,<span class="string">&quot;&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;等待接受消息，把消息显示在屏幕上&quot;</span>);</span><br><span class="line">        <span class="comment">//接受消息</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer,message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Receive控制台打印接受到的消息&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>) );</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//消费者取消消息时回调接口</span></span><br><span class="line">        channel.basicConsume(queueName,<span class="literal">true</span>,deliverCallback,consumer-&gt;&#123;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Direct"><a href="#Direct" class="headerlink" title="Direct"></a>Direct</h4><p>从图上我们可以看到，X绑定了两个队列，绑定类型是direct,队列Q1绑定建为orange，队列2绑定键有两个，一个为black，另一个为green.</p><p>在这种情况下，发布这发布消息到exchange上，绑定键为orange的消息会被发布到队列Q1绑定键为blackgreen的消息会被发布到队列Q2,其他消息类型就被丢弃。</p><p><strong>多重绑定</strong></p><p>当然如果exchange的绑定类型是direct，但是他绑定的多个队列的key如果多相同在这种情况下虽然绑定类型是direct，但是他表现的就和fanout有点想类似了，就和广播差不多了。</p><p>这边就可以指定发给谁了，我不发给谁他就收不到消息，只有我允许他接收他才能得到接收。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DirectLogs</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//交换机的名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span>  String EXCHANGE_NAME=<span class="string">&quot;direct_logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (sc.hasNext())&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> sc.next();</span><br><span class="line">            channel.basicPublish(EXCHANGE_NAME,<span class="string">&quot;info&quot;</span>,<span class="literal">null</span>,message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;生产者发送消息：&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLogDirect01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span><span class="string">&quot;direct_logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class="line">        <span class="comment">//声明一个交换机</span></span><br><span class="line">        channel.queueDeclare(<span class="string">&quot;console&quot;</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        绑定交换机和队列</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueBind(<span class="string">&quot;console&quot;</span>,EXCHANGE_NAME,<span class="string">&quot;info&quot;</span>);</span><br><span class="line">        channel.queueBind(<span class="string">&quot;console&quot;</span>,EXCHANGE_NAME,<span class="string">&quot;warning&quot;</span>);</span><br><span class="line">        <span class="comment">//接受消息</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer, message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ReceiveLogsDirect01控制台打印接受到的消息&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>) );</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//消费者取消消息时回调接口</span></span><br><span class="line">        channel.basicConsume(<span class="string">&quot;console&quot;</span>,<span class="literal">true</span>,deliverCallback,consumer-&gt;&#123;&#125;);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLogDirect02</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span><span class="string">&quot;direct_logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class="line">        <span class="comment">//声明一个交换机</span></span><br><span class="line">        channel.queueDeclare(<span class="string">&quot;disk&quot;</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        绑定交换机和队列</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueBind(<span class="string">&quot;disk&quot;</span>,EXCHANGE_NAME,<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        <span class="comment">//接受消息</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer, message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ReceiveLogsDirect01控制台打印接受到的消息&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>) );</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//消费者取消消息时回调接口</span></span><br><span class="line">        channel.basicConsume(<span class="string">&quot;disk&quot;</span>,<span class="literal">true</span>,deliverCallback,consumer-&gt;&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Topic"><a href="#Topic" class="headerlink" title="Topic"></a>Topic</h4><p>对比上面两种交换机更加完美，当存在我们要接受日志类型有info.base和info.advantage,某个队列只想info.base的消息，那这个·时候上边两种交换机就做不到了。此时我们采用的就是topic交换机类型了。</p><p><strong>Topic</strong></p><p>发送类型是topic交换机的消息的routing_key不能随意写，<strong>必须满足一定的要求，他必须是一个单纯列表，以点号隔开</strong>，这个单次可以是任意单词。”nysc.xxx”等。限制要求单词列表不能超过255个字节。</p><p>需要注意的是 </p><p><strong>* 代表的是一个单词</strong></p><p><strong>‘#’ 代表的是可以替换零个或多个单词。</strong></p><p>下图绑定关系如下</p><p>Q1—&gt; 绑定的是</p><p>​    <strong>中间代orange带3个单词的字符串（<em> .orange. </em>）</strong></p><p>Q2—&gt; 绑定的是</p><p>​    <strong>最后一个单词是rabbit的3个单词（<em> . </em>rabbit）</strong></p><p>​    <strong>第一个单词是lazy的多个单词（lazy.#）</strong></p><p>下边我们将上图之间的数据接受情况列举出来</p><p>quick.<strong>orange</strong>.<strong>rabbit</strong>         被队列Q1Q2接受到</p><p><strong>lazy</strong>.<strong>orange</strong>.elephant         被队列Q1Q2接受到</p><p>quick.<strong>orange</strong>.fox            被队列Q1接受到</p><p><strong>lazy</strong>.brown.fox            被队列Q2接受到</p><p><strong>lazy</strong>.pink.<strong>rabbit</strong>            虽然满足两个绑定但只被队列Q2接受一次</p><p>quick.brown.fox            不匹配任何绑定不会被任何队列接收到会被丢弃</p><p>quick.<strong>orange</strong>.male.rabbit        是四个单词不匹配任何绑定会被丢弃</p><p><strong>lazy</strong>.orange.male.rabbit         是四个单词但匹配Q2</p><p>==上述加粗的是符合TOPIC类型交换机的单词指令==</p><p>==是最强大的，也是使用最广的==</p><ul><li>当队列绑定关系是#,那么这个队列将接收所有的数据，有点像Fanout了。</li><li>如果队列绑定的键中没有#和*出现，那么该队列绑定类类型就是direct了。</li></ul><p>消费者1</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">声明主题交换机</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLogsTopic01</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//老样子定义一个交换机名</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span> String EXCHANGE_NAME= <span class="string">&quot;topic_logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//接受消息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">       <span class="comment">//声明一个交换机</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME,<span class="string">&quot;topic&quot;</span>);</span><br><span class="line">        <span class="comment">//声明队列</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;Q1&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//绑定</span></span><br><span class="line">        channel.queueBind(queueName,EXCHANGE_NAME,<span class="string">&quot;*.orange.*&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;等待接受消息&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer,message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;接受队列：——&gt; &quot;</span> +queueName +<span class="string">&quot;绑定键：&quot;</span>+ message.getEnvelope().getRoutingKey());</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//接收消息</span></span><br><span class="line"></span><br><span class="line">        channel.basicConsume(queueName,<span class="literal">true</span>,deliverCallback,consumer-&gt;&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>等待接受消息<br>被队列Q1Q2接受到<br>接受队列：——&gt; Q1绑定键：lazy.orange.elephant<br>被队列Q1Q2接受到<br>接受队列：——&gt; Q1绑定键：quick.orange.rabbit<br>被队列Q1接受到<br>接受队列：——&gt; Q1绑定键：quick.orange.fox</p></blockquote><p>消费者2</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">声明主题交换机</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLogsTopic02</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//老样子定义一个交换机名</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span> String EXCHANGE_NAME= <span class="string">&quot;topic_logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//接受消息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">       <span class="comment">//声明一个交换机</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME,<span class="string">&quot;topic&quot;</span>);</span><br><span class="line">        <span class="comment">//声明队列</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;Q2&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//绑定</span></span><br><span class="line">        channel.queueBind(queueName,EXCHANGE_NAME,<span class="string">&quot;*.*.rabbit&quot;</span>);</span><br><span class="line">        channel.queueBind(queueName,EXCHANGE_NAME,<span class="string">&quot;lazy.#&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;等待接受消息&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer,message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;接受队列：——&gt; &quot;</span> +queueName +<span class="string">&quot;绑定键：&quot;</span>+ message.getEnvelope().getRoutingKey());</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//接收消息</span></span><br><span class="line"></span><br><span class="line">        channel.basicConsume(queueName,<span class="literal">true</span>,deliverCallback,consumer-&gt;&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>等待接受消息<br>被队列Q1Q2接受到<br>接受队列：——&gt; Q2绑定键：lazy.orange.elephant<br>被队列Q2接受到<br>接受队列：——&gt; Q2绑定键：lazy.brown.fox<br>被队列Q1Q2接受到<br>接受队列：——&gt; Q2绑定键：quick.orange.rabbit<br>虽然满足两个绑定但只被队列Q2接受一次<br>接受队列：——&gt; Q2绑定键：lazy.pink.rabbit<br>是四个单词但匹配Q2<br>接受队列：——&gt; Q2绑定键：lazy.orange.male.rabbit</p></blockquote><p>生产者</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">生产者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmitLogTopic</span> &#123;</span><br><span class="line">    <span class="comment">//老样子，还是定义一个交换机名字，注意这个交换</span></span><br><span class="line">    <span class="comment">// 机名字需要和消费者里边定义的交换机一样，避免出错</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span>  String EXCHANGE_NAME=<span class="string">&quot;topic_logs&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//获取信道链接</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        Q1--&gt; 绑定的是</span></span><br><span class="line"><span class="comment">    中间代orange带3个单词的字符串（* .orange. *）</span></span><br><span class="line"><span class="comment">        Q2--&gt; 绑定的是</span></span><br><span class="line"><span class="comment">        最后一个单词是rabbit的3个单词（* . *rabbit）</span></span><br><span class="line"><span class="comment">        第一个单词是lazy的多个单词（lazy.#）</span></span><br><span class="line"><span class="comment">        quick.orange.rabbit         被队列Q1Q2接受到</span></span><br><span class="line"><span class="comment">        lazy.orange.elephant 被队列Q1Q2接受到</span></span><br><span class="line"><span class="comment">        quick.orange.fox被队列Q1接受到</span></span><br><span class="line"><span class="comment">        lazy.brown.fox被队列Q2接受到</span></span><br><span class="line"><span class="comment">        lazy.pink.rabbit虽然满足两个绑定但只被队列Q2接受一次</span></span><br><span class="line"><span class="comment">        quick.brown.fox不匹配任何绑定不会被任何队列接收到会被丢弃</span></span><br><span class="line"><span class="comment">        quick.orange.male.rabbit是四个单词不匹配任何绑定会被丢弃</span></span><br><span class="line"><span class="comment">        lazy.orange.male.rabbit 是四个单词但匹配Q2</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Map&lt;String,String&gt; map  = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;quick.orange.rabbit&quot;</span>,<span class="string">&quot;被队列Q1Q2接受到&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;lazy.orange.elephant&quot;</span>,<span class="string">&quot;被队列Q1Q2接受到&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;quick.orange.fox&quot;</span>,<span class="string">&quot;被队列Q1接受到&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;lazy.brown.fox&quot;</span>,<span class="string">&quot;被队列Q2接受到&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;lazy.pink.rabbit&quot;</span>,<span class="string">&quot;虽然满足两个绑定但只被队列Q2接受一次&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;quick.brown.fox&quot;</span>,<span class="string">&quot;不匹配任何绑定不会被任何队列接收到会被丢弃&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;quick.orange.male.rabbit&quot;</span>,<span class="string">&quot;是四个单词不匹配任何绑定会被丢弃&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;lazy.orange.male.rabbit&quot;</span>,<span class="string">&quot;是四个单词但匹配Q2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String,  String&gt; mapEntry : map.entrySet()) &#123;</span><br><span class="line">           <span class="type">String</span> <span class="variable">routingKey</span> <span class="operator">=</span> mapEntry.getKey();</span><br><span class="line">           <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> mapEntry.getValue();</span><br><span class="line">            channel.basicPublish(EXCHANGE_NAME,routingKey,<span class="literal">null</span>,message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;生产者发送消息： &quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>生产者发送消息： 是四个单词不匹配任何绑定会被丢弃</p><p>生产者发送消息： 不匹配任何绑定不会被任何队列接收到会被丢弃</p><p>生产者发送消息： 被队列Q1Q2接受到</p><p>生产者发送消息： 被队列Q2接受到</p><p>生产者发送消息： 被队列Q1Q2接受到</p><p>生产者发送消息： 被队列Q1接受到</p><p>生产者发送消息： 虽然满足两个绑定但只被队列Q2接受一次</p><p>生产者发送消息： 是四个单词但匹配Q2</p></blockquote><h2 id="死信队列"><a href="#死信队列" class="headerlink" title="死信队列"></a>死信队列</h2><p>死信：<strong>顾名思义就是无法被消费的消息</strong>，一般情况下，product将消息投递到broker或者直接到queue里，consumer从queue取出消息，进行消费，但某些时候由于特定的<strong>原因导致queue中的某些消息无法被消费</strong>，这样的消息如果没有后续的处理，就变成死信，有死信自然就有死信队列。</p><p>一般应用场景：为了保证订单业务中的消息数据不丢失，需要使用rabbitMQ的死信队列机制，<strong>当消息消费发生异常的时候，将消息投入死信队列中</strong>，还有比如说：<strong>用户在商场下单成功并点击去支付后在指定时间未支付时自动失效。</strong></p><h3 id="死信的来源"><a href="#死信的来源" class="headerlink" title="死信的来源"></a><strong>死信的来源</strong></h3><ul><li>消息TTL过期</li><li>队列达到最大长度（队列满了，无法再添加数据到mq中）</li><li>消息被拒绝（basic.reject或basic.nack）并且requeue= false;</li></ul><h3 id="死信实战"><a href="#死信实战" class="headerlink" title="死信实战"></a>死信实战</h3><h4 id="消息TTL过期"><a href="#消息TTL过期" class="headerlink" title="消息TTL过期"></a>消息TTL过期</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">死信队列</span></span><br><span class="line"><span class="comment"> 之生产者代码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="comment">//普通交换机的名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">        <span class="comment">//死信消息，设置TTL时间</span></span><br><span class="line">        AMQP.<span class="type">BasicProperties</span> <span class="variable">properties</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">AMQP</span>.BasicProperties()</span><br><span class="line">                        .builder().expiration(<span class="string">&quot;10000&quot;</span>).build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">11</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;info &quot;</span>+ i;</span><br><span class="line">            channel.basicPublish(NORMAL_EXCHANGE,<span class="string">&quot;zhangsan&quot;</span>,properties,message.getBytes());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">死信</span></span><br><span class="line"><span class="comment">    消费者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer01</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//普通交换机的名称</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//死信交换机的名称</span></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">static</span>  <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//普通队列名称</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">NORMAL_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;normal_queue&quot;</span>;</span><br><span class="line">    <span class="comment">//死信队列名称</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">DEAD_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;dead_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//声明死信和普通交换机类型 direct</span></span><br><span class="line">        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        channel.exchangeDeclare(DEAD_EXCHANGE,BuiltinExchangeType.DIRECT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 普通队列</span></span><br><span class="line">        Map&lt;String,Object&gt; argument = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//过期时间10秒过期   可以不设置，可以交给队列自动去</span></span><br><span class="line">       <span class="comment">// argument.put(&quot;x-message-ttl&quot;,100000);</span></span><br><span class="line">        <span class="comment">//正常队列设置死信交换机</span></span><br><span class="line">        argument.put(<span class="string">&quot;x-dead-lettle-exchange&quot;</span>,DEAD_EXCHANGE);</span><br><span class="line">        <span class="comment">//设置死信RoutingKey</span></span><br><span class="line">        argument.put(<span class="string">&quot;x-dead-lettle-routing-key&quot;</span>,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line"></span><br><span class="line">        channel.queueDeclare(NORMAL_QUEUE,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,argument);</span><br><span class="line"></span><br><span class="line">        <span class="comment">///////////////////////////////////</span></span><br><span class="line">        <span class="comment">//声名死信队列</span></span><br><span class="line">        channel.queueDeclare(DEAD_QUEUE,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//绑定普通交换机和普通队列</span></span><br><span class="line">        channel.queueBind(NORMAL_QUEUE,NORMAL_EXCHANGE,<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        <span class="comment">//绑定死信的交换机与死信队列</span></span><br><span class="line">        channel.queueBind(DEAD_QUEUE,DEAD_EXCHANGE,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;等待接受......&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//绑定死信的交换机和死信的对列</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer,message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Consumer 01接受到消息是：&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        channel.basicConsume(NORMAL_QUEUE,<span class="literal">true</span>,deliverCallback,consumer-&gt;&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer02</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//死信队列名称</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">DEAD_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;dead_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;等待接受......&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//绑定死信的交换机和死信的对列</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer,message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Consumer 02接受到消息是：&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        channel.basicConsume(DEAD_QUEUE,<span class="literal">true</span>,deliverCallback,consumer-&gt;&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>==解决进不去死信队列的原因了，就是我没给他把过期时间值传进去，导致出现问题。==</p><h4 id="队列达到最大长度"><a href="#队列达到最大长度" class="headerlink" title="队列达到最大长度"></a>队列达到最大长度</h4><p>消息生成者代码去掉TTL属性。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer01</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//普通交换机的名称</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//死信交换机的名称</span></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">static</span>  <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//普通队列名称</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">NORMAL_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;normal_queue&quot;</span>;</span><br><span class="line">    <span class="comment">//死信队列名称</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">DEAD_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;dead_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//声明死信和普通交换机类型 direct</span></span><br><span class="line">        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        channel.exchangeDeclare(DEAD_EXCHANGE,BuiltinExchangeType.DIRECT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 普通队列</span></span><br><span class="line">        Map&lt;String,Object&gt; argument = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//过期时间10秒过期   可以不设置，可以交给队列自动去</span></span><br><span class="line">       <span class="comment">// argument.put(&quot;x-message-ttl&quot;,10000);</span></span><br><span class="line">        <span class="comment">//正常队列设置死信交换机</span></span><br><span class="line">        argument.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>,DEAD_EXCHANGE);</span><br><span class="line">        <span class="comment">//设置死信RoutingKey</span></span><br><span class="line">        argument.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置正常队列的长度的限制</span></span><br><span class="line">        argument.put(<span class="string">&quot;x-max-length&quot;</span>,<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        channel.queueDeclare(NORMAL_QUEUE,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,argument);</span><br><span class="line"></span><br><span class="line">        <span class="comment">///////////////////////////////////</span></span><br><span class="line">        <span class="comment">//声名死信队列</span></span><br><span class="line">        channel.queueDeclare(DEAD_QUEUE,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//绑定普通交换机和普通队列</span></span><br><span class="line">        channel.queueBind(NORMAL_QUEUE,NORMAL_EXCHANGE,<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        <span class="comment">//绑定死信的交换机与死信队列</span></span><br><span class="line">        channel.queueBind(DEAD_QUEUE,DEAD_EXCHANGE,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;等待接受......&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//绑定死信的交换机和死信的对列</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer,message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Consumer 01接受到消息是：&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        channel.basicConsume(NORMAL_QUEUE,<span class="literal">true</span>,deliverCallback,consumer-&gt;&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="comment">//普通交换机的名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">        <span class="comment">//死信消息，设置TTL时间 单位是ms</span></span><br><span class="line">     <span class="comment">//   AMQP.BasicProperties properties =</span></span><br><span class="line">      <span class="comment">//          new AMQP.BasicProperties()</span></span><br><span class="line">                        <span class="comment">//.builder().expiration(&quot;10000&quot;).build();</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">11</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;info &quot;</span>+ i;</span><br><span class="line">            channel.basicPublish(NORMAL_EXCHANGE,<span class="string">&quot;zhangsan&quot;</span>,properties,message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;生产者发送消息:&quot;</span>+message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="消息被拒绝"><a href="#消息被拒绝" class="headerlink" title="消息被拒绝"></a>消息被拒绝</h4><p>一旦消费者拒绝接受，就会成为死信队列。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="comment">//普通交换机的名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">        <span class="comment">//死信消息，设置TTL时间 单位是ms</span></span><br><span class="line">      <span class="comment">//演示长度  AMQP.BasicProperties properties =</span></span><br><span class="line">         <span class="comment">//   new AMQP.BasicProperties()</span></span><br><span class="line">           <span class="comment">//             .builder().expiration(&quot;10000&quot;).build();</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">11</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;info &quot;</span>+ i;                        <span class="comment">//properties</span></span><br><span class="line">            channel.basicPublish(NORMAL_EXCHANGE,<span class="string">&quot;zhangsan&quot;</span>,<span class="literal">null</span>,message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;生产者发送消息:&quot;</span>+message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer01</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//普通交换机的名称</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//死信交换机的名称</span></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">static</span>  <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//普通队列名称</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">NORMAL_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;normal_queue&quot;</span>;</span><br><span class="line">    <span class="comment">//死信队列名称</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">DEAD_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;dead_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//声明死信和普通交换机类型 direct</span></span><br><span class="line">        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        channel.exchangeDeclare(DEAD_EXCHANGE,BuiltinExchangeType.DIRECT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 普通队列</span></span><br><span class="line">        Map&lt;String,Object&gt; argument = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//过期时间10秒过期   可以不设置，可以交给队列自动去</span></span><br><span class="line">       <span class="comment">// argument.put(&quot;x-message-ttl&quot;,10000);</span></span><br><span class="line">        <span class="comment">//正常队列设置死信交换机</span></span><br><span class="line">        argument.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>,DEAD_EXCHANGE);</span><br><span class="line">        <span class="comment">//设置死信RoutingKey</span></span><br><span class="line">        argument.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置正常队列的长度的限制</span></span><br><span class="line">      <span class="comment">//演示拒绝  argument.put(&quot;x-max-length&quot;,6);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        channel.queueDeclare(NORMAL_QUEUE,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,argument);</span><br><span class="line"></span><br><span class="line">        <span class="comment">///////////////////////////////////</span></span><br><span class="line">        <span class="comment">//声名死信队列</span></span><br><span class="line">        channel.queueDeclare(DEAD_QUEUE,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//绑定普通交换机和普通队列</span></span><br><span class="line">        channel.queueBind(NORMAL_QUEUE,NORMAL_EXCHANGE,<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        <span class="comment">//绑定死信的交换机与死信队列</span></span><br><span class="line">        channel.queueBind(DEAD_QUEUE,DEAD_EXCHANGE,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;等待接受......&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//绑定死信的交换机和死信的对列</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer,message)-&gt;&#123;</span><br><span class="line">       <span class="comment">//拒绝消息在这里写</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">message1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">           <span class="comment">//指定你要拒绝的消息</span></span><br><span class="line">            <span class="keyword">if</span>(message1.equals(<span class="string">&quot;info 5&quot;</span>))&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;此消息是被拒绝的&quot;</span>+ message1);</span><br><span class="line">                <span class="comment">//拒接接收，且不放回队列，避免队列重新发送</span></span><br><span class="line">                channel.basicReject(message.getEnvelope().getDeliveryTag(),<span class="literal">false</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">                System.out.println(<span class="string">&quot;Consumer 01接受到消息是：&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">               <span class="comment">//   接收且不放回</span></span><br><span class="line">                channel.basicAck(message.getEnvelope().getDeliveryTag(),<span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//开启手动应答,                      //true是自动应答。</span></span><br><span class="line">        channel.basicConsume(NORMAL_QUEUE,<span class="literal">false</span>,deliverCallback,consumer-&gt;&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer02</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">static</span>  <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//死信队列名称</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">DEAD_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;dead_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">        channel.queueBind(DEAD_QUEUE,DEAD_EXCHANGE,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;等待接受......&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//绑定死信的交换机和死信的对列</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer,message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Consumer 02接受到消息是：&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(DEAD_QUEUE,<span class="literal">true</span>,deliverCallback,consumer-&gt;&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="延迟队列"><a href="#延迟队列" class="headerlink" title="延迟队列"></a>延迟队列</h2><p>延迟队列，对列内部是有序的，最重要的特性就是体现在他的延时属性上，延时队列中的元素时希望在指定时间到了之后或者之前取出和处理，简单的来说，延迟队列就是用来存放需要在指定时间被处理的元素的队列。</p><p><strong>延迟队列的使用场景</strong></p><ol><li>订单在十分钟内未支付则自动取消</li><li>新创建的店铺，如果在十天内没有上传商品，则自动发送消息提醒</li><li>用户注册成功后，如果没有在三天内登录则发送短信提醒消息</li><li>用户发起退款，如果在三天内没有得到处理则通知相关运营人员。</li><li>预定会员后，需要在预定的时间点前十分钟通知各个与会员人员参加会议。</li></ol><h3 id="延迟队列整合SpringBoot"><a href="#延迟队列整合SpringBoot" class="headerlink" title="延迟队列整合SpringBoot"></a>延迟队列整合SpringBoot</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xh<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>SpringBoot_RabbitMQ<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>SpringBoot_RabbitMQ<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>SpringBoot_RabbitMQ<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>2.3.7.RELEASE<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--rabbitMQ依赖--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.83<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.24<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--swagger--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--RabbitMQ测试依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.amqp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-rabbit-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.xh.springBoot.SpringBootRabbitMqApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">webApiConfig</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .groupName(<span class="string">&quot;webApi&quot;</span>)</span><br><span class="line">                .apiInfo(webApiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">webApiInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;rabbitMQ接口文档&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;描述Rabbit微服务接口定义&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;我喜欢&quot;</span>,<span class="string">&quot;127.0.0.1&quot;</span>,<span class="string">&quot;2844****670@qq.com&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="队列TTL"><a href="#队列TTL" class="headerlink" title="队列TTL"></a>队列TTL</h3><p>创建两个队列QA和QB，两者队列TTL分被是10s，40s,然后在创建一个交换机X和死信交换机Y，他们的类型都是direct，创建一个死信队列QD，他们的绑定关系如下</p><p>代码文件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">TTL 队列  配置文件类代码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TtlQueueConfig</span> &#123;</span><br><span class="line">    <span class="comment">//普通的交换机名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">X_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;X&quot;</span>;</span><br><span class="line">    <span class="comment">//死信交换机的名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">Y_DEAD_LETTER_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;Y&quot;</span>;</span><br><span class="line">    <span class="comment">//普通队列的名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">A_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;QA&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">B_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;QB&quot;</span>;</span><br><span class="line">    <span class="comment">//死信队列的名称</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">Y_DEAD_LETTER_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;QD&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//声明XCHANGE</span></span><br><span class="line">    <span class="meta">@Bean(&quot;xExchange&quot;)</span>  <span class="comment">//起别名</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">xExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(X_EXCHANGE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//声明yExchange 别名</span></span><br><span class="line">    <span class="meta">@Bean(&quot;yExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">yExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//声明队列</span></span><br><span class="line">    <span class="meta">@Bean(&quot;queueA&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queueA</span><span class="params">()</span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map  =<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//设置死信交换机</span></span><br><span class="line">        map.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>,Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">        <span class="comment">//设置死信RoutingKey</span></span><br><span class="line">        map.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="string">&quot;YD&quot;</span>);</span><br><span class="line">        <span class="comment">//设置TTL单位是ms  什么时候消息成为死信，10秒钟后</span></span><br><span class="line">        map.put(<span class="string">&quot;x-message-ttl&quot;</span>,<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(A_QUEUE).withArguments(map).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//声明队列</span></span><br><span class="line">    <span class="meta">@Bean(&quot;queueB&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queueB</span><span class="params">()</span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map  =<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//设置死信交换机</span></span><br><span class="line">        map.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>,Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">        <span class="comment">//设置死信RoutingKey</span></span><br><span class="line">        map.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="string">&quot;YD&quot;</span>);</span><br><span class="line">        <span class="comment">//设置TTL单位是ms  什么时候消息成为死信，40秒钟后</span></span><br><span class="line">        map.put(<span class="string">&quot;x-message-ttl&quot;</span>,<span class="number">40000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(B_QUEUE).withArguments(map).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//死信队列</span></span><br><span class="line">    <span class="meta">@Bean(&quot;queueD&quot;)</span></span><br><span class="line">    <span class="keyword">public</span>  Queue <span class="title function_">QueueD</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(Y_DEAD_LETTER_QUEUE).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绑定</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueABindingX</span><span class="params">(<span class="meta">@Qualifier(&quot;queueA&quot;)</span> Queue queueA,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange xExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueA).to(xExchange).with(<span class="string">&quot;XA&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//绑定</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueBBindingX</span><span class="params">(<span class="meta">@Qualifier(&quot;queueB&quot;)</span> Queue queueB,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange xExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueB).to(xExchange).with(<span class="string">&quot;XB&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//绑定</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueDBindingX</span><span class="params">(<span class="meta">@Qualifier(&quot;queueD&quot;)</span> Queue queueD,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@Qualifier(&quot;yExchange&quot;)</span> DirectExchange yExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueD).to(yExchange).with(<span class="string">&quot;YD&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">发送延迟消息</span></span><br><span class="line"><span class="comment">http://地址/ttl/sendMessage/子非吾喵</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span> <span class="comment">//打印日志</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/ttl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SellMessageController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//开始发送消息</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendMessage/&#123;message&#125;&quot;)</span></span><br><span class="line">    <span class="comment">//注意@PathVariable 可以自定义传值到url中，前提示变量名必须和url中的一样</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(<span class="meta">@PathVariable</span> String message)</span>&#123;</span><br><span class="line">        <span class="comment">//后边的语句参数会替换&#123;&#125;，这由程序员控制</span></span><br><span class="line">        log.info(<span class="string">&quot;当前时间:&#123;&#125;,发送一条信息给两个TTL队列:&#123;&#125;&quot;</span>,<span class="keyword">new</span> <span class="title class_">Date</span>().toString(),message);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;X&quot;</span>,<span class="string">&quot;XA&quot;</span>,<span class="string">&quot;消息来自ttl为10秒的消息队列：&quot;</span> + message);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;X&quot;</span>,<span class="string">&quot;XB&quot;</span>,<span class="string">&quot;消息来自ttl为40秒的消息队列：&quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="http://127.0.0.1:8080/ttl/sendMessage/hello1">http://127.0.0.1:8080/ttl/sendMessage/hello1</a></p><p><a href="http://127.0.0.1:8080/ttl/sendMessage/hello2">http://127.0.0.1:8080/ttl/sendMessage/hello2</a></p><p>上述存在一个不足之处，就是我们<strong>每次使用的时候，都需要增加一个新的时间需求，就需要新增一个队列</strong>，这里只是用了10s和40s两个时间选项，但万一我要一个小时呢，难不成还又要添加，这样太麻烦了。</p><h3 id="延迟队列优化"><a href="#延迟队列优化" class="headerlink" title="延迟队列优化"></a>延迟队列优化</h3><p>使用QC来设置时间，用户自定义时间。</p><p>具体代码如下</p><p>TtlQueueConfig.java中添加</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">C_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;QC&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//声明QC</span></span><br><span class="line">    <span class="meta">@Bean(&quot;queueC&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queueC</span><span class="params">()</span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//设置死信交换机</span></span><br><span class="line">        map.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>,Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">        <span class="comment">//设置死信RoutingKey</span></span><br><span class="line">        map.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="string">&quot;YD&quot;</span>);</span><br><span class="line">        <span class="comment">//TTL设置时长  ms (这里不写，又用户自己定义)</span></span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(C_QUEUE).withArguments(map).build();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//绑定</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueCBindingX</span><span class="params">(<span class="meta">@Qualifier(&quot;queueC&quot;)</span> Queue queueC,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange xExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueC).to(xExchange).with(<span class="string">&quot;XC&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>​    SellMessageController.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//开始发送消息 消息 TTL</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendExpirationMsg/&#123;message&#125;/&#123;ttlTime&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@PathVariable</span> String message,<span class="meta">@PathVariable</span> String ttlTime)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;当前时间：&#123;&#125;，发送一条时长&#123;&#125;毫秒TTL信息给队列QC:&#123;&#125;&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Date</span>().toString(),ttlTime,message);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;X&quot;</span>,<span class="string">&quot;XC&quot;</span>,message,msg -&gt; &#123;</span><br><span class="line">            <span class="comment">//发送消息的时候，延迟时长</span></span><br><span class="line">            msg.getMessageProperties().setExpiration(ttlTime);</span><br><span class="line">            <span class="keyword">return</span> msg;</span><br><span class="line">        &#125; );</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>==注意我在写这个代码的时候，刚刚开始是敲错了一个字母，导致运行时生成的队列，然后调错的时候，需要生成的队列删除，然后重新创建，可以解决问题。。==</p><pre><code>&gt;http://127.0.0.1:8080/ttl/sendExpirationMsg/hello1/2000&gt;&gt;http://127.0.0.1:8080/ttl/sendExpirationMsg/hello2/20000</code></pre><p>死信在做延迟的一个巨大缺陷，消息不会按时“死亡”，由于<strong>RabbitMQ只会检查第一个消息是否过期</strong>，如果过期则丢到死信队列，<strong>如果第一个消息的延时时长很长，而第二个消息的延迟时长很短，则第二个消息并不会优先得到执行。</strong></p><p>这里出现一个问题，当出现两条消息的时候，我们发现，他居然是按照谁先来的，哪怕你时间短，但是你比另一个队列慢一步，你就只能老老实实排队了。<img src="1667661985681.png" alt="1667661985681"></p><h3 id="RabbitMQ插件实现延迟队列"><a href="#RabbitMQ插件实现延迟队列" class="headerlink" title="RabbitMQ插件实现延迟队列"></a>RabbitMQ插件实现延迟队列</h3><p>这个就是解决上边的问题的，我们使用插件解决。</p><p>在官网上下载: <a href="https://www/rabbitmq.com/community-plugins.html，下载">https://www/rabbitmq.com/community-plugins.html，下载</a></p><p>rabbitmq_delayed_message_exchange-3.8.0</p><p>拷贝到</p><p>/usr/lib/rabbitmq/lib/rabbitmq_server-版本号/plugs</p><p>安装指令</p><p><code>rabbitmq-plugins enable rabbitmq_delayed_message_exchange</code></p><p>然后在linux系统下解压</p><p>然后安装<code>rabbitmq-plugins enable rabbitmq_delayed_message_exchange</code></p><p>之后重启</p><p><code>systemctl restart rabbitmq-server(这个是你安装时候的名字)</code></p><p>这个时候不在是队列，而是交换机了。</p><p><strong>没插件的时候</strong></p><p><strong>基于插件的</strong></p><p>==注意，由于我是docker安装的，我没找到安装这个插件的位置，故而，这一点，我只能敲一下代码了解一下==</p><p>解决办法：</p><p><a href="https://blog.csdn.net/DZP_dream/article/details/118391439">https://blog.csdn.net/DZP_dream/article/details/118391439</a></p><p><code>docker search rabbitmq</code></p><p>安装拉取容器：</p><p><code>docker run -dit --name rabbitmq -e RABBITMQ_DEFAULT_USER=guest -e RABBITMQ_DEFAULT_PASS=guest -p 15672:15672 -p 5672:5672 rabbitmq:management</code></p><p><a href="https://www.rabbitmq.com/community-plugins.html">https://www.rabbitmq.com/community-plugins.html</a> </p><p><code>docker cp rabbitmq_delayed_message_exchange-3.8.0.ez  rabbitmq:/plugins</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="built_in">local</span> rabbitmq]<span class="comment"># docker exec -it rabbitmq /bin/bash                                     </span></span><br><span class="line">root@3bb56f68570b:/<span class="comment"># rabbitmq-plugins list</span></span><br></pre></td></tr></table></figure><p>启动插件</p><p><code>root@3bb56f68570b:/# rabbitmq-plugins enable rabbitmq_delayed_message_exchange</code></p><p>DelayedConfig</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">延迟队列插件，可惜，我没有。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">//实例化</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelayedQueueConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//队列 //</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">DELAYED_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;delayed.queue&quot;</span>;</span><br><span class="line">    <span class="comment">//交换机</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">DELAYED_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;delayed.exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//routingKey</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">DELAYED_ROUTING_KEY</span> <span class="operator">=</span> <span class="string">&quot;delayed.routing&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">delayedQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">new</span> <span class="title class_">Queue</span>(DELAYED_QUEUE_NAME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//声明交换机  基于插件的交换机就是这么定义的</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">//自定义交换机 由于是不存在rabbit里边的交换机，也就是我们使用的延迟队列插件</span></span><br><span class="line">    <span class="keyword">public</span> CustomExchange <span class="title function_">delayedExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;x-delayed-type&quot;</span>,<span class="string">&quot;direct&quot;</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        1.交换机名称</span></span><br><span class="line"><span class="comment">        2.交换机类型</span></span><br><span class="line"><span class="comment">        3.是否需要持久化</span></span><br><span class="line"><span class="comment">        4.是否需要自动删除</span></span><br><span class="line"><span class="comment">        5.其他参数</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomExchange</span>(DELAYED_EXCHANGE_NAME,<span class="string">&quot;x-delayed-message&quot;</span>,</span><br><span class="line">                <span class="literal">true</span>,<span class="literal">false</span>,map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绑定</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">delayedQueueBingdingDelayedExchange</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@Qualifier(&quot;delayedQueue&quot;)</span> Queue delayedQueue,</span></span><br><span class="line"><span class="params">            <span class="meta">@Qualifier(&quot;delayedExchange&quot;)</span> CustomExchange delayedExchange</span></span><br><span class="line"><span class="params">    )</span>&#123;</span><br><span class="line">        <span class="comment">//绑定 将队列和交换机直接进行绑定</span></span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(delayedQueue).to(delayedExchange).with(DELAYED_ROUTING_KEY).noargs();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>生产者代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Title  发送消息  基于插件的 消息以及 延迟的时间</span></span><br><span class="line"><span class="comment"> * @Description 延迟队列的插件</span></span><br><span class="line"><span class="comment"> * @author  罗小黑</span></span><br><span class="line"><span class="comment"> * @date 2022/11/6 11:40</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/sendDelayMsg/&#123;message&#125;/&#123;delayTime&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendDelayedMsg</span><span class="params">(<span class="meta">@PathVariable</span> String message,<span class="meta">@PathVariable</span> Integer delayedTime)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;当前时间：&#123;&#125;，发送一条时长&#123;&#125;毫秒信息给延迟队列delayedTime:&#123;&#125;&quot;</span>,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Date</span>().toString(),delayedTime,message);</span><br><span class="line">    rabbitTemplate.convertAndSend(DelayedQueueConfig.DELAYED_EXCHANGE_NAME,</span><br><span class="line">            DelayedQueueConfig.DELAYED_ROUTING_KEY,message, msg -&gt; &#123;</span><br><span class="line">        <span class="comment">//发送消息的时候，延迟时长  单位ms</span></span><br><span class="line">        msg.getMessageProperties().setDelay(delayedTime);</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>消费者代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">延迟队列消费者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelayedQueueConsumer</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        基于插件的延迟队列</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//监听消息</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues= DelayedQueueConfig.DELAYED_QUEUE_NAME)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveDelayQueue</span><span class="params">(Message message)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody());</span><br><span class="line">        log.info(<span class="string">&quot;当前时间：&#123;&#125;，收到延迟队列的消息：&#123;&#125;&quot;</span>,<span class="keyword">new</span> <span class="title class_">Date</span>().toString(),msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="http://127.0.0.1:8080/ttl/sendDelayMsg/come">http://127.0.0.1:8080/ttl/sendDelayMsg/come</a> on bady1/20000</p><p><a href="http://127.0.0.1:8080/ttl/sendDelayMsg/come">http://127.0.0.1:8080/ttl/sendDelayMsg/come</a> on bady1/2000</p><p>第二个消息被先消费掉了，符合预期。</p><h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><p>延迟队列在需要延时的处理的场景下非常有用，使用rabbitmq来实现延迟队列可以很好的利用rabbitmq的特性，<strong>如消息的可靠发送，消息可靠投递，死信队列来保证消息至少被消费一次已经未被正常处理的消息不会被丢弃</strong>，另外，通过rabbitMQ集群的特性，可以很好的解决单点故障问题，不会因为单个节点挂掉导致延迟队列不可用或者信息丢失</p><p>当然，延迟队列还有很多其他选择，比如利用java的delayQueue,利用Redis的zset，利用Quartz或者利用kafka的时间轮，这些方式各有各的特点，看需要的适用的场景。</p><h1 id="高级部分："><a href="#高级部分：" class="headerlink" title="高级部分："></a>高级部分：</h1><h2 id="发布确认高级"><a href="#发布确认高级" class="headerlink" title="发布确认高级"></a>发布确认高级</h2><p>在生产环境下中由于一些不明的原因，导致rabbitmq重启，在rabbitmq 重启期间生产者消息投递失败，导致消息丢失，需要手动处理和恢复，这个时候，我们如何保证rabbitmq的消息的可靠投递呢?</p><p>高级就是，当生产者发送消息给交换机，但是交换机收不到的时候，我们将消息放到缓存中，当交换机可以收到消息的时候，我们就把消息从缓存中移除。一般会出现的问题是，交换机收不到消息，二是队列收不到消息。</p><p><strong>代码架构部分</strong></p><p><strong>配置文件</strong></p><p>在spring.rabbitmq.publisher-confirm-type=correlated</p><p>confirm</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">发布确认配置类</span></span><br><span class="line"><span class="comment"> 目的是为了 发布确认 （高级）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfirmConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//交换机</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span> String CONFIRM_EXCHANGE_NAME= <span class="string">&quot;confirm_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//队列</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;confirm_queue&quot;</span>;</span><br><span class="line">    <span class="comment">//RoutingKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_ROUTING_KEY</span> <span class="operator">=</span> <span class="string">&quot;key1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//声明一个交换机</span></span><br><span class="line">    <span class="meta">@Bean(&quot;confirmExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">confirmExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(CONFIRM_EXCHANGE_NAME);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//声明一个队列</span></span><br><span class="line">    <span class="meta">@Bean(&quot;confirmQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">confirmQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(CONFIRM_QUEUE_NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绑定</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueBindingExchange</span><span class="params">(<span class="meta">@Qualifier(&quot;confirmQueue&quot;)</span> Queue confirmQueue,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@Qualifier(&quot;confirmExchange&quot;)</span> DirectExchange confirmExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(confirmQueue).to(confirmExchange).with(CONFIRM_ROUTING_KEY);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>消费者</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    Product接收消息</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = ConfirmConfig.CONFIRM_QUEUE_NAME)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveConfirmMessage</span><span class="params">(Message message)</span>&#123;</span><br><span class="line">       <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody());</span><br><span class="line">        log.info(<span class="string">&quot;接受到队列confirm.queue的消息： &#123;&#125; &quot;</span> ,msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>生产者</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/confirm&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送消息</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendMessage/&#123;message&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(<span class="meta">@PathVariable</span> String message)</span>&#123;</span><br><span class="line">        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME,</span><br><span class="line">                ConfirmConfig.CONFIRM_ROUTING_KEY,message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>回调接口</p><p>一旦消息没有被接受我们采取回调接口去确定。</p><p>NONE</p><p>禁用发布确认模式，是默认值</p><p>CORRELATED</p><p>发布消息成功到交换器后会触发回调方法</p><p>SIMPLE</p><p>经过测试有两种效果，其一效果和CORRELATED值一样会触发回调方法。</p><p>其二在发布消息成功后采用rabbitTemplate调用waitForConfirms或waitForConfirmsOrDie方法，等待broker节点返回发送结果，根据返回结果来判定下一步的逻辑，要注意的点是waitForConfirmsOrDie方法，如果返回fasle则会关闭channel，则接下来无法发送消息到broker.</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 应用名称</span></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">SpringBoot_RabbitMQ</span></span><br><span class="line"><span class="attr">spring.rabbitmq.host</span>=<span class="string">114.132.77.86</span></span><br><span class="line"><span class="attr">spring.rabbitmq.publisher-confirm-type</span>=<span class="string">correlated</span></span><br><span class="line"><span class="attr">spring.rabbitmq.port</span>=<span class="string">5672</span></span><br><span class="line"><span class="attr">spring.rabbitmq.username</span>=<span class="string">guest</span></span><br><span class="line"><span class="attr">spring.rabbitmq.password</span>=<span class="string">guest</span></span><br></pre></td></tr></table></figure><p>定义一个回调方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">定义一个回调接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//1</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCallBack</span> <span class="keyword">implements</span> <span class="title class_">RabbitTemplate</span>.ConfirmCallback&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//由于是内部接口，故而不能直接我们实现的接口，我们需要直接注入</span></span><br><span class="line">    <span class="comment">//注入</span></span><br><span class="line">    <span class="meta">@Autowired</span>  <span class="comment">//2</span></span><br><span class="line">    <span class="keyword">private</span>  RabbitTemplate rabbitTemplate;</span><br><span class="line">    <span class="meta">@PostConstruct</span>  <span class="comment">//注入  3 一步一步来，这个注解是在其他注解执行完毕之后才会执行，切记</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//注入</span></span><br><span class="line">        rabbitTemplate.setConfirmCallback(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    交换机确认回调方法</span></span><br><span class="line"><span class="comment">    1.发消息 交换机接收到了消息  回馈</span></span><br><span class="line"><span class="comment">        1.1correlationData保存回调消息ID以及相关信息</span></span><br><span class="line"><span class="comment">        1.2交换机接收到消息  ack  = true</span></span><br><span class="line"><span class="comment">        1.3 cause  null</span></span><br><span class="line"><span class="comment">    2.发送消息 交换机接收失败了问题</span></span><br><span class="line"><span class="comment">        2.1 correlationData 保存回调信息的ID以及相关信息</span></span><br><span class="line"><span class="comment">        2.2 交换机接收到消息  ack =  false</span></span><br><span class="line"><span class="comment">        2.3 cause 失败的原因</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(CorrelationData correlationData, <span class="type">boolean</span> ack, String cause)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> correlationData.getId()!=<span class="literal">null</span> ? correlationData.getId() : <span class="string">&quot;&quot;</span> ;</span><br><span class="line">        <span class="keyword">if</span>(ack)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;交换机已经收到的ID为： &#123;&#125;的消息&quot;</span>,id);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            log.info(<span class="string">&quot;交换机还未收到ID为：&#123;&#125;的消息,由于原因：&#123;&#125;&quot;</span>,id,cause);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">//开始发消息，测试确认</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/confirm&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送消息</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendMessage/&#123;message&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(<span class="meta">@PathVariable</span> String message)</span>&#123;</span><br><span class="line">        <span class="type">CorrelationData</span> <span class="variable">correlationData1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME,</span><br><span class="line">                ConfirmConfig.CONFIRM_ROUTING_KEY,message,correlationData1);</span><br><span class="line">        log.info(<span class="string">&quot;发送消息内容：&#123;&#125;&quot;</span>,message + <span class="string">&quot;key1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">CorrelationData</span> <span class="variable">correlationData2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME,</span><br><span class="line">                ConfirmConfig.CONFIRM_ROUTING_KEY,message,correlationData2);</span><br><span class="line">        log.info(<span class="string">&quot;发送消息内容：&#123;&#125;&quot;</span>,message + <span class="string">&quot;key2&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="回退消息"><a href="#回退消息" class="headerlink" title="回退消息"></a>回退消息</h2><p>在开启了生成者确认机制情况下，交换机接收到消息后，会直接将消息生产者发送确认消息，如果发现该消息不可路由，那么消息会被直接丢弃，此时生产者是不知道消息被丢弃这个事件的，那么如何让无法被路由的消息帮我想办法处理一下？最简单的就是通知我一下，我好方便处理，通过设置mandatory参数就可以在当消息传递过程中不可达目的时将消息返回给生成者。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">//1</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCallBack</span> <span class="keyword">implements</span> <span class="title class_">RabbitTemplate</span>.ConfirmCallback,RabbitTemplate.ReturnCallback&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//由于是内部接口，故而不能直接我们实现的接口，我们需要直接注入</span></span><br><span class="line">    <span class="comment">//注入</span></span><br><span class="line">    <span class="meta">@Autowired</span>  <span class="comment">//2</span></span><br><span class="line">    <span class="keyword">private</span>  RabbitTemplate rabbitTemplate;</span><br><span class="line">    <span class="meta">@PostConstruct</span>  <span class="comment">//注入  3 一步一步来，这个注解是在其他注解执行完毕之后才会执行，切记</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//注入</span></span><br><span class="line">        rabbitTemplate.setConfirmCallback(<span class="built_in">this</span>);</span><br><span class="line"><span class="comment">//不注入的化没有结果</span></span><br><span class="line">        rabbitTemplate.setReturnCallback(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    交换机确认回调方法</span></span><br><span class="line"><span class="comment">    1.发消息 交换机接收到了消息  回馈</span></span><br><span class="line"><span class="comment">        1.1correlationData保存回调消息ID以及相关信息</span></span><br><span class="line"><span class="comment">        1.2交换机接收到消息  ack  = true</span></span><br><span class="line"><span class="comment">        1.3 cause  null</span></span><br><span class="line"><span class="comment">    2.发送消息 交换机接收失败了问题</span></span><br><span class="line"><span class="comment">        2.1 correlationData 保存回调信息的ID以及相关信息</span></span><br><span class="line"><span class="comment">        2.2 交换机接收到消息  ack =  false</span></span><br><span class="line"><span class="comment">        2.3 cause 失败的原因</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(CorrelationData correlationData, <span class="type">boolean</span> ack, String cause)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> correlationData.getId()!=<span class="literal">null</span> ? correlationData.getId() : <span class="string">&quot;&quot;</span> ;</span><br><span class="line">        <span class="keyword">if</span>(ack)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;交换机已经收到的ID为： &#123;&#125;的消息&quot;</span>,id);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            log.info(<span class="string">&quot;交换机还未收到ID为：&#123;&#125;的消息,由于原因：&#123;&#125;&quot;</span>,id,cause);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//回退接口实现，可以在当消息在传递过程中不可达</span></span><br><span class="line">    <span class="comment">// 目的时将消息返回给生产者</span></span><br><span class="line">    <span class="comment">//只有当消息不可达目的地时候才进行回退</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnedMessage</span><span class="params">(Message message, <span class="type">int</span> replyCode, String replyText, String exchange, String routingKey)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;消息：&#123;&#125;,被交换机&#123;&#125; 退回了，退回原因是：&#123;&#125;，路由Key:&#123;&#125;&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()),exchange,replyText,routingKey);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/confirm&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送消息</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendMessage/&#123;message&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(<span class="meta">@PathVariable</span> String message)</span>&#123;</span><br><span class="line">        <span class="type">CorrelationData</span> <span class="variable">correlationData1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME,</span><br><span class="line">                ConfirmConfig.CONFIRM_ROUTING_KEY,message,correlationData1);</span><br><span class="line">        log.info(<span class="string">&quot;发送消息内容：&#123;&#125;&quot;</span>,message + <span class="string">&quot;key1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">CorrelationData</span> <span class="variable">correlationData2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME,</span><br><span class="line">                ConfirmConfig.CONFIRM_ROUTING_KEY + <span class="string">&quot;2&quot;</span> ,message + <span class="string">&quot;key2&quot;</span>,correlationData2);</span><br><span class="line">        log.info(<span class="string">&quot;发送消息内容：&#123;&#125;&quot;</span>,message + <span class="string">&quot;key2&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>回退处理</p><p><a href="http://127.0.0.1:8080/confirm/sendMessage/你好">http://127.0.0.1:8080/confirm/sendMessage/你好</a></p><h3 id="备份交换机"><a href="#备份交换机" class="headerlink" title="备份交换机"></a>备份交换机</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">发布确认配置类</span></span><br><span class="line"><span class="comment"> 目的是为了 发布确认 （高级）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfirmConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//交换机</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span> String CONFIRM_EXCHANGE_NAME= <span class="string">&quot;confirm_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//队列</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;confirm_queue&quot;</span>;</span><br><span class="line">    <span class="comment">//RoutingKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_ROUTING_KEY</span> <span class="operator">=</span> <span class="string">&quot;key1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//备份交换机</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">BACKUP_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;backup_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//备份队列</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">BACKUP_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;backup_queue&quot;</span>;</span><br><span class="line">    <span class="comment">//报警队列</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">WARNING_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;warning_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//声明一个交换机</span></span><br><span class="line">    <span class="meta">@Bean(&quot;confirmExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">confirmExchange</span><span class="params">()</span>&#123;                       <span class="comment">//持久化</span></span><br><span class="line">      <span class="keyword">return</span> ExchangeBuilder.directExchange(CONFIRM_EXCHANGE_NAME).durable(<span class="literal">true</span>).withArgument(<span class="string">&quot;alternate-exchange&quot;</span>,BACKUP_EXCHANGE_NAME).build();</span><br><span class="line">    <span class="comment">//    return  new DirectExchange(CONFIRM_EXCHANGE_NAME);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//声明一个队列</span></span><br><span class="line">    <span class="meta">@Bean(&quot;confirmQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">confirmQueue</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>  QueueBuilder.durable(CONFIRM_QUEUE_NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//绑定</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueBindingExchange</span><span class="params">(<span class="meta">@Qualifier(&quot;confirmQueue&quot;)</span> Queue confirmQueue,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@Qualifier(&quot;confirmExchange&quot;)</span> DirectExchange confirmExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(confirmQueue).to(confirmExchange).with(CONFIRM_ROUTING_KEY);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//创建一个备份交换机</span></span><br><span class="line">    <span class="meta">@Bean(&quot;backupExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> FanoutExchange <span class="title function_">backupExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">new</span> <span class="title class_">FanoutExchange</span>(BACKUP_EXCHANGE_NAME);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean(&quot;backupQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span>  Queue <span class="title function_">backupQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(BACKUP_QUEUE_NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;warningQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span>  Queue <span class="title function_">warningQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(WARNING_QUEUE_NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//备份交换机邦定到备份队列</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueBindingBackupExchange</span><span class="params">(<span class="meta">@Qualifier(&quot;backupQueue&quot;)</span> Queue backupQueue,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@Qualifier(&quot;backupExchange&quot;)</span> FanoutExchange backupExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(backupQueue).to(backupExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//报警交换机邦定到报警</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueBindingWarningExchange</span><span class="params">(<span class="meta">@Qualifier(&quot;warningQueue&quot;)</span> Queue warningQueue,</span></span><br><span class="line"><span class="params">                                              <span class="meta">@Qualifier(&quot;backupExchange&quot;)</span> FanoutExchange backupExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(warningQueue).to(backupExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>消费者</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">报警消费者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WarningConsumer</span> &#123;</span><br><span class="line">    <span class="comment">//接受报警信息</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = ConfirmConfig.WARNING_QUEUE_NAME)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveWarningMsg</span><span class="params">(Message message)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody());</span><br><span class="line">        log.info(<span class="string">&quot;报警发现不可路由消息： &#123;&#125;&quot;</span> ,msg);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="幂等性"><a href="#幂等性" class="headerlink" title="幂等性"></a>幂等性</h2><p>用户对于同一操作发起的一次请求或者多次请求的结果是一致的，不会因为多次点击而产生了副作用。举个最简单的例子，那就是支付，用户购买商品后支付，支付扣款成功，但是返回结果的时候网络异常，此时钱已经扣了，用户再次点击按钮，此时会进行第二次扣款，返回结果成功，用户查询余额发现多扣钱了，流水记录也变成了两条。在以前的单应用系统中，我们只需要把数据操作放入事务中即可，发生错误立即回滚，但是再响应客户端的时候也有可能出现网络中断或者异常等等</p><p><strong>消息被重复消费</strong></p><p>消费者在消费MQ中的消息时，MQ已把消息发送给消费者，消费者在给MQ返回ack时网络中断，故MQ未收到确认信息，该条消息会重新发给其他的消费者，或者在网络重连后再次发送给该消费者，但实际上该消费者已成功消费了该条消息，造成消费者消费了重复的消息。</p><p><strong>解决思路</strong></p><p>MQ消费者的幂等性的解决一般使用全局ID或者写个唯一标识比如时间戳或者UUID或者订单消费者消费MQ中的消息也可利用MQ的该id来判断，或者可按自己的规则生成一个全局唯一id，每次消费消息时用该id先判断该消息是否已消费过。</p><p><strong>消费端的幂等性保障</strong><br>在海量订单生成的业务高峰期，生产端有可能就会重复发生了消息，这时候消费端就要实现幂等性，这就意味着我们的消息永远不会被消费多次，即使我们收到了一样的消息。业界主流的幂等性有两种操作：a.唯一ID+指纹码机制，利用数据库主键去重，b.利用redis的原子性去实现</p><p><strong>唯一lD+指纹码机制</strong><br>指纹码：我们的一些规则或者时间戳加别的服务给到的唯一信息码，它并不一定是我们系统生成的，基本都是由我们的业务规则拼接而来，但是一定要保证唯一性，然后就利用查询语句进行判断这个id是否存在数据库中，优势就是实现简单就一个拼接，然后查询判断是否重复；劣势就是在高并发时，如果是单个数据库就会有写入性能瓶颈当然也可以采用分库分表提升性能，但也不是我们最推荐的方式。</p><p><strong>Redis原子性</strong>（重点选择）<br>利用redis执行setnx命令，天然具有幕等性。从而实现不重复消费。</p><h3 id="优先级队列"><a href="#优先级队列" class="headerlink" title="优先级队列"></a>优先级队列</h3><p>在我们系统中有一个订单催付的场景，我们的客户在天猫下的订单，淘宝会及时将订单推送给我们，如果在用户设定的时间内未付款那么就会给用户推送一条短信提醒，很简单的一个功能对吧，但是，tmall商家对我们来说，肯定是要分大客户和小客户的对吧，比如像苹果，小米这样大商家一年起码能给我们创造很大的利润，所以理应当然，他们的订单必须得到优先处理，而曾经我们的后端系统是使用 redis来存放的定时轮询，大家都知道 redis 只能用List做一个简简单单的消息队列，并不能实现一个优先级的场景，所以订单量大了后采用RabbitMQ进行改造和优化，如果发现是大客户的订单给一个相对比较高的优先级，否则就是默认优先级。</p><p>如何添加</p><p>a.控制台添加</p><p>b.队列中代码添加优先级</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,Object&gt; parame = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">parame.put(<span class="string">&quot;x-max-prority&quot;</span>,<span class="number">10</span>);</span><br><span class="line">channel.queueDeclare(<span class="string">&quot;hello&quot;</span>,<span class="literal">true</span>,<span class="literal">false</span>,<span class="literal">false</span>,params);</span><br></pre></td></tr></table></figure><p>c.消息中代码添加优先级</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="comment">//队列名称</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span>  String QUEUE_NAME=<span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发消息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//建立一个连接方式</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        <span class="comment">//工厂IP 连接RabbitMQ的队列</span></span><br><span class="line">        factory.setHost(<span class="string">&quot;www.littlehei.fun&quot;</span>);</span><br><span class="line">        <span class="comment">//用户名</span></span><br><span class="line">        factory.setUsername(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//密码</span></span><br><span class="line">        factory.setPassword(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建链接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.newConnection();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取信道</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//生成一个队列</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        生成队列</span></span><br><span class="line"><span class="comment">        参数1，队列名称</span></span><br><span class="line"><span class="comment">        参数2，队列里边的消息是否持久化（磁盘）默认情况消息存储在内存中</span></span><br><span class="line"><span class="comment">        参数3，该队列是否只供一个消费者进行消费，是否进行消息共享，true可以多个消费者消费,false：只能一个消费者消费</span></span><br><span class="line"><span class="comment">        参数4，是否自动删除，最后一个消费者断开链接以后，该队是否自动删除，true，自动删除，false不删除</span></span><br><span class="line"><span class="comment">        参数5，其他参数</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;x-max-priority&quot;</span>,<span class="number">10</span>);<span class="comment">//官方允许是0-255之间，此处设置10，允许优化级范围为0-10 不要设置过大，浪费CPU和内存</span></span><br><span class="line"></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME,<span class="literal">true</span>,<span class="literal">false</span>,<span class="literal">false</span>,map);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//发消息</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;info&quot;</span> + i;<span class="comment">//初次使用</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(i == <span class="number">5</span>)&#123;</span><br><span class="line">                AMQP.<span class="type">BasicProperties</span> <span class="variable">properties</span> <span class="operator">=</span></span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">AMQP</span>.BasicProperties().builder().priority(<span class="number">5</span>).build();</span><br><span class="line">                channel.basicPublish(<span class="string">&quot;&quot;</span>,QUEUE_NAME,properties,message.getBytes());</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                channel.basicPublish(<span class="string">&quot;&quot;</span>,QUEUE_NAME,<span class="literal">null</span>,message.getBytes());</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        发送一个消费</span></span><br><span class="line"><span class="comment">        参数1，发送到哪个交换机</span></span><br><span class="line"><span class="comment">        参数2.路由的key值是哪个？  本次是队列的名称</span></span><br><span class="line"><span class="comment">        参数3，其他参数配置</span></span><br><span class="line"><span class="comment">        参数4，发送消息的消息体</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        System.out.println(<span class="string">&quot;消息发送成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="comment">//队列的名称：</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span> String QUEUE_NAME=<span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//接收消息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//创建链接工厂</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        factory.setHost(<span class="string">&quot;www.littlehei.fun&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span>  factory.newConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span>  connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//声明</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message)-&gt;&#123;</span><br><span class="line">            <span class="comment">//  String message = new String(&quot;自己手动去创建一个消息，但是不推荐&quot;);</span></span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//取消消息时的回调</span></span><br><span class="line">        <span class="type">CancelCallback</span> <span class="variable">cancelCallback</span> <span class="operator">=</span> consumerTag -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;消息消费被中断&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        消费者接收消息</span></span><br><span class="line"><span class="comment">        参数1，消费哪个队列</span></span><br><span class="line"><span class="comment">        参数2，消费成功之后是否要自动应答，true表示自动应答，false表示不是</span></span><br><span class="line"><span class="comment">        参数3，消费者未成功消费的回调</span></span><br><span class="line"><span class="comment">        参数4，消费者取录消费的回到</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        channel.basicConsume(QUEUE_NAME,<span class="literal">true</span>,deliverCallback,cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>d.注意事项</strong></p><p>要让队列实现优先级需要做的事情有如下事情：</p><p>队列需要设置优先级队列，消息需要设置消息的优先级，消费者需要等待消息已经发送到队列中才去消费，因为这样才有机会对消息进行排序</p><h3 id="惰性队列"><a href="#惰性队列" class="headerlink" title="惰性队列"></a>惰性队列</h3><p>RabbitMQ从3.6.0版本开始引入了惰性队列的概念。惰性队列会尽可能的将消息存入磁盘中，而在消费者消费到相应的消息时才会被加载到内存中，它的一个重要的设计目标是能够支持更长的队列，即支持更多的消息存储。当消费者由于各种各样的原因（比如消费者下线、若机亦或者是由于维护而关闭等）而致使长时间内不能消费消息造成堆积时，惰性队列就很有必要了。<br>默认情况下，当生产者将消息发送到RabbitMQ的时候，队列中的消息会尽可能的存储在内存之中，这样可以更加快速的将消息发送给消费者。即使是持久化的消息，在被写入磁盘的同时也会在内存中驻留一份备份。当RabbitMQ需要释放内存的时候，会将内存中的消息换页至磁盘中，这个操作会耗费较长的时间，也会阻塞队列的操作，进而无法接收新的消息。虽然RabbitMQ的开发者们一直在升级相关的算法，但是效果始终不太理想，尤其是在消息量特别大的时候。+</p><p><img src="1667797292928.png" alt="1667797292928"></p><p>当消息大量过来，我们短时间处理不过来，这个时候我们采用惰性队列了</p><p>队列具备两种模式：default 和lazy。默认的为default模式，在3.6.0之前的版本无需做任何变更。lazy模式即为惰性队列的模式，可以通过调用channel.queueDeclare方法的时候在参数中设置，也可以通过Policy的方式设置，如果一个队列同时使用这两种方式设置的话，那么Policy的方式具备更高的优先级。<br><strong>如果要通过声明的方式改变已有队列的模式的话，那么只能先删除队列，然后再重新声明一个新的。</strong><br><strong>在队列声明的时候可以通过“x-queue-mode”参数来设置队列的模式，取值为“default’和lazy”。</strong>下面示例中演示了一个惰性队列的声明细节：</p><blockquote><p>Map<String，Object> args =new HashMap<String，Object>（）；</p><p>args.put（”x-queue-mode”，”lazy”）；</p><p>channel.queueDeclare（”myqueue”，false，false，false，args）；</p></blockquote><p><strong>在发送1百万条消息，每条消息大概占1KB的情况下，普通队列占用内存是1.2GB，而惰性队列仅仅占用1.5MB</strong>。</p><h1 id="集群部分："><a href="#集群部分：" class="headerlink" title="集群部分："></a>集群部分：</h1><h2 id="clustering"><a href="#clustering" class="headerlink" title="clustering"></a><strong>clustering</strong></h2><h2 id="搭建集群"><a href="#搭建集群" class="headerlink" title="搭建集群"></a>搭建集群</h2><p>如果是本地虚拟机的话，我们就将几台虚拟机进行克隆，造成集群环境。</p><p>然后选择一台服务器作为集群，其他两台服务器加入进去。</p><ol><li><p>修改3台机器的主机名称</p><p><code>vim /etc/hostname</code></p><p><code>vim /etc/host</code>进入后更该就行</p><p>​    ip地址 node1</p><p>​    ip地址 node2</p><p>​    ip地址 node3</p></li></ol><ol><li><p>配置各个节点的host文件，让各个节点都能相互识别对方。</p></li><li><p>确保各个节点的cookie文件使用的是同一个值。</p><p><code>scp/var/lib/rabbitmq/.erlang.cookie root@node2:/var/lib/rabbitmg/.erlang.cookie</code></p><p><code>scp/var/lib/rabbitmq/.erlang.cookie root@node3:/var/lib/rabbitmg/.erlang.cookie</code></p></li></ol><ol><li><p>启动RabbitMQ服务，顺带启动Erlang虚拟机和rabbitMQ应用服务（在三台节点上分布执行命令）</p><p><code>rabbitmq-server-detached</code></p></li><li><p>在节点2执行</p><p>rabbitmqctl stop_app</p><p>（rabbitmqctl stop会将Erlang虚拟机关闭，rabbitmqct stop_app 只关闭RabbitMQ服务）</p><p>rabbitmqctl reset</p><p>rabbitmqctl join_cluster rabbit@node1</p><p>rabbitmqctl start_app（只启动应用服务）</p></li><li><p>在节点3执行</p><p>rabbitmqctl stop_app</p><p>rabbitmqctl reset</p><p>rabbitmqctl join_cluster rabbit@node2</p><p>rabbitmqctl start_app（只启动应用服务)</p></li><li><p>集群状态</p><p>rabbitmqctl cluster_status</p></li><li><p>需要重新设置用户角色</p><p>创建账号</p><p>​    rabbitmqctl add_user admin 123</p><p>设置用户角色</p><p>​    rabbitmqctl set_user_tags admin adminstractor</p><p>设置用户权限</p><p>​    <code>rabbitmqctl set_permissions -p &quot;/&quot; admin &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</code></p><p>此时如图，表示存在集群；</p></li><li><p>解除集群节点（node2，和node3分别执行）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl stop_app</span><br><span class="line"></span><br><span class="line">rabbitmqctl reset</span><br><span class="line"></span><br><span class="line">rabbitmqctl start_app</span><br><span class="line"></span><br><span class="line">rabbitmqctl cluster_status</span><br><span class="line"></span><br><span class="line">rabbitmqetl forget_cluster_node rabbit@node2（node1机器上执行）</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h2 id="镜像队列"><a href="#镜像队列" class="headerlink" title="镜像队列"></a>镜像队列</h2><p>如果RabbitMQ集群中只有一个Broker 节点，那么该节点的失效将导致整体服务的临时性不可用，并且也可能会导致消息的丢失。可以将所有消息都设置为持久化，并且对应队列的durable属性也设置为true，但是这样仍然无法避免由于缓存导致的问题：因为消息在发送之后和被写入磁盘井执行刷盘动作之间存在一个短暂却会产生问题的时间窗，通过publisherconfirm机制能够确保客户端知道哪些消息己经存入磁盘，尽管如此，一般不希望遇到因单点故障导致的服务不可用。<br>引入镜像队列（Miror Queue）的机制，可以将队列镜像到集群中的其他Broker节点之上，如果集群中的一个节点失效了，队列能自动地切换到镜像中的另一个节点上以保证服务的可用性。</p><p><strong>搭建步骤</strong></p><ol><li><p>启动三台集群节点</p></li><li><p>随便找一个节点添加policy</p></li></ol><p>单点无法连接</p><p>采用负载均衡，Haproxy + keepalive 实现高可用负载均衡。</p><h2 id="FederationExchange（联邦交换机）"><a href="#FederationExchange（联邦交换机）" class="headerlink" title="FederationExchange（联邦交换机）"></a>FederationExchange（联邦交换机）</h2><p>（broker北京），（broker 深圳）彼此之间相距甚远，网络延迟是一个不得不面对的问题。有一个在北京的业务（Client北京）需要连接（broker北京），向其中的交换器exchangeA发送消息，此时的网络延迟很小，（Client北京）可以迅速将消息发送至exchangeA中，就算在开启了publisherconfirm机制或者事务机制的情况下，也可以迅速收到确认信息。此时又有个在深圳的业务（Client 深圳）需要向 exchangeA发送消息，那么（Client深圳）（broker北京）之间有很大的网络延迟，（Client 深圳）将发送消息至exchangeA会经历一定的延迟，尤其是在开启了publisherconfirm机制或者事务机制的情况下，（Client深圳）会等待很长的延迟时间来接收（broker北京）的确认信息，进而必然造成这条发送线程的性能降低，甚至造成一定程度上的阻塞。</p><p>将业务（Client深圳）部署到北京的机房可以解决这个问题，但是如果（Client深圳）调用的另些服务都部署在深圳，那么又会引发新的时延问题，总不见得将所有业务全部部署在一个机房，那么容灾又何以实现？<br>这里使用Federation 插件就可以很好地解决这个问题.</p><p>由于两个地区的服务器比较远，这个时候就存在一种服务延迟情况，我们的federation交换机就是解决这个问题的。</p><p>搭建步骤：</p><ol><li><p>需要保证每台节点单独运行</p></li><li><p>在每台机器上开启federation相关插件</p><p><code>rabbitmq-plugins enable rabbitmq_federation</code></p><p><code>rabbitmq-plugins enable rabbitmq federation_management</code></p><p>每台服务器上都装一下。</p><p>两个指令都需要安装。</p></li><li><p>原理图：（高山流水，只能从上游流向下游）。</p><p>注意的是，必须从创建好下游节点的交换机，才能够将消息从上游传到下游。上游的消息在下游不能接收，那么这个消息就无法传递到下游。</p></li></ol><ol><li>在downstean(node2)配置upstream(node1);</li></ol><ol><li>添加规则</li></ol><h3 id="联邦队列"><a href="#联邦队列" class="headerlink" title="联邦队列"></a>联邦队列</h3><h2 id="Shovel"><a href="#Shovel" class="headerlink" title="Shovel"></a>Shovel</h2><p>使用它的原因<br>Federation 具备的数据转发功能类似，Shovel够可靠、持续地从一个Broker中的队列（作为源端，即source）拉取数据并转发至另一个Broker中的交换器（作为目的端，即destination）。作为源端的队列和作为目的端的交换器可以同时位于同一个Broker，也可以位于不同的Broker上。Shovel可以翻译为“铲子”<br>是一种比较形象的比喻，这个”铲子”可以将消息从一方“铲子”另一方。Shovel行为就像优秀的客户端应用程序能够负责连接源和目的地、负责消息的读写及负责连接失败问题的处理。<br>搭建步骤<br>1.开启插件（需要的机器都开启）</p><p><code>rabbitmq-plugins enable rabbitmq_shovel</code></p><p><code>rabbitmq-plugins enable rabbitmq_shovel_management</code></p>]]></content>
    
    
    <summary type="html">本文主要RabbitMQ的记录</summary>
    
    
    
    <category term="消息队列" scheme="https://www.blog.909111.xyz/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
    
    <category term="RabbitMQ" scheme="https://www.blog.909111.xyz/tags/RabbitMQ/"/>
    
  </entry>
  
  <entry>
    <title>MySQL学习</title>
    <link href="https://www.blog.909111.xyz/posts/c6fb831a.html"/>
    <id>https://www.blog.909111.xyz/posts/c6fb831a.html</id>
    <published>2023-11-09T02:50:23.336Z</published>
    <updated>2024-04-22T08:16:00.160Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MySql初步学习"><a href="#MySql初步学习" class="headerlink" title="MySql初步学习"></a>MySql初步学习</h1><p>安装mysql 。。。自行百度</p><h3 id="链接数据库"><a href="#链接数据库" class="headerlink" title="链接数据库"></a>链接数据库</h3><p>通过命令行！！！</p><p><code>mysql -u用户名 -p密码</code>   链接数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-- 更新数据库密码（适合小白忘记密码）</span><br><span class="line">update mysql.user set authentication_string=password(&#x27;a&#x27;) where user= &#x27;root&#x27; and Host=&#x27;localhost&#x27;;</span><br><span class="line"></span><br><span class="line">flush privileges ; -- 刷新权限</span><br><span class="line"></span><br><span class="line">-- --------------------------------------</span><br><span class="line">-- 查看所有的数据库</span><br><span class="line">show databases; </span><br><span class="line">-- 使用某个数据库</span><br><span class="line">user 数据库名;</span><br><span class="line"></span><br><span class="line">-- 展现数据库中所有的表</span><br><span class="line">show tables;-- 查看数据库中所有的表</span><br><span class="line">-- 查看表中的数据</span><br><span class="line">describe 表名;</span><br><span class="line">-- 创建一个数据库</span><br><span class="line">create database 数据库名;</span><br><span class="line">use 数据库名;</span><br><span class="line"></span><br><span class="line">-- 退出数据库</span><br><span class="line">exit ;</span><br></pre></td></tr></table></figure><p>数据库语言    CURD业务程序员（简单的增删改查），API，</p><h3 id="DDL-数据库定义语言-："><a href="#DDL-数据库定义语言-：" class="headerlink" title="DDL(数据库定义语言)："></a>DDL(数据库定义语言)：</h3><p><strong>是对数据库内部的对象进行创建，删除，修改等的操作语言。它和DML语言最大的区别是DML只是对表内部数据的操作，而不涉及到表的定义，结构的修改，更不会涉及到其它对象。</strong> </p><ol><li><p>创建数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create database if not exists &lt;name&gt; ; -- 创建一个数据库</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><ol><li><p>删除数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop database if not exists &lt;name&gt; ; 删除一个数据库</span><br></pre></td></tr></table></figure></li></ol><ol><li>使用数据库</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use &lt;name&gt; ; -- 使用数据库</span><br></pre></td></tr></table></figure><ol><li><p>查看数据库</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases; -- 查看所有数据库</span><br></pre></td></tr></table></figure></li></ol><h4 id="数据库的数据类型"><a href="#数据库的数据类型" class="headerlink" title="数据库的数据类型"></a>数据库的数据类型</h4><blockquote><p>数值</p></blockquote><div class="table-container"><table><thead><tr><th>tinyint</th><th>十分小的数据</th><th>1个字节</th></tr></thead><tbody><tr><td>smallint</td><td>比较小的数据</td><td>2个字节</td></tr><tr><td>mediumint</td><td>中等大小的数据</td><td>3个字节</td></tr><tr><td>int</td><td>标准的整数</td><td>4个字节</td></tr><tr><td>bigint</td><td>较大的数据</td><td>8个字节</td></tr><tr><td>float</td><td>单精度（浮点性）</td><td>4个字节</td></tr><tr><td>double</td><td>双精度</td><td>8个字节</td></tr><tr><td>decimal</td><td>字符串形式的浮点数</td><td>金融计算的时候一般使用</td></tr></tbody></table></div><blockquote><p>字符串</p></blockquote><div class="table-container"><table><thead><tr><th><strong>char</strong></th><th><strong>字符串固定大小</strong></th><th><strong>0-255</strong></th></tr></thead><tbody><tr><td>varchar :1st_place_medal:</td><td>可变字符串</td><td>0-65535</td></tr><tr><td>tinytext</td><td>微型文本</td><td>2^8 -1</td></tr><tr><td>text :2nd_place_medal:</td><td>文本串</td><td>2^16-1</td></tr></tbody></table></div><blockquote><p>时间日期</p></blockquote><div class="table-container"><table><thead><tr><th>date</th><th>YYYY-MM-DD</th><th>日期格式</th></tr></thead><tbody><tr><td>time</td><td>HH:mm:ss</td><td>时区格式</td></tr><tr><td>datetime</td><td>YYYY-MM-DD HH:mm:ss</td><td>最长用的时间格式</td></tr><tr><td>timestamp</td><td>时间戳，1970.1.1</td><td>从1970.1.1到现在的毫秒数！也比较常用</td></tr><tr><td>year</td><td>年份表示</td></tr></tbody></table></div><blockquote><p>null</p></blockquote><p>没有值，注意，不要使用null进行运算，结果运算为null.</p><h4 id="数据库的子段属性："><a href="#数据库的子段属性：" class="headerlink" title="数据库的子段属性："></a>数据库的子段属性：</h4><p><strong>Unsigned：</strong></p><ul><li>无符号的整数</li><li>声明了该列不能声明为负数</li></ul><p><strong>zerofill：</strong></p><ul><li>0填充的</li><li>不足的位数，用0来补充,int(3)， 5  —-  005</li></ul><p><strong>自增</strong></p><ul><li>通常理解为自增，自动在上一条记录的基础之上+1(默认)。</li><li>通常用来设计唯一的主键— index,必须是整数类型。</li><li>可以自定义设计主键自增的起始值和步长</li></ul><p><strong>非空 null  not  null:</strong></p><ul><li><p>假设设置为not null 如果不给他赋值就会报错</p></li><li><p>null 如果不填写值，这个值就会自动填充为空值。</p></li></ul><p><strong>默认</strong></p><p>设置默认的值</p><p>如果不给他设置值，他就会默认为我们设置的填充值</p><p><strong>一般创建表格的时候我们必须创建的存在的5个字段</strong></p><blockquote><p>id  主键</p><p>version  乐观锁</p><p>is_delete     伪删除 数据无价假删除保数据</p><p>gmt_create  创建时间</p><p>gmt_update  删除时间</p></blockquote><p><strong>创建表</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-- 创建表格，一般表面我们使用``进行标记</span><br><span class="line">-- 注意表中字符串的使用一般是单引号或者双引号</span><br><span class="line">-- 所有的语句后添加，最后一个不要加</span><br><span class="line"></span><br><span class="line">create table if not exists test1(</span><br><span class="line">    -- id 列名  int 数据类型  primary key 主键 not null 不为空 auto_increment 自增   comment &quot;&quot; 别名</span><br><span class="line">id  int  primary key  not null auto_increment comment &#x27;主键&#x27;,</span><br><span class="line">    -- default &#x27;&#x27; 默认的</span><br><span class="line">    name varchar(10) not null default &#x27;匿名&#x27; comment &#x27;姓名&#x27;，</span><br><span class="line">    </span><br><span class="line">    birthday datetime default null comment &#x27;生日&#x27;</span><br><span class="line"></span><br><span class="line">)Engine=innodb default charset=utf8;</span><br></pre></td></tr></table></figure><p>格式</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists(</span><br><span class="line">`字段名` 列类型 [属性] [索引] [注释],</span><br><span class="line">    `字段名` 列类型 [属性] [索引] [注释],</span><br><span class="line">    `字段名` 列类型 [属性] [索引] [注释],</span><br><span class="line">    .....</span><br><span class="line">    `字段名` 列类型 [属性] [索引] [注释]</span><br><span class="line">)[表类型][字符编码集][注释]</span><br><span class="line"></span><br><span class="line">show create database [数据库名]  -- 查看创建数据库的语句</span><br><span class="line">show create table [数据库名] -- 查看数据库表的定义语句</span><br><span class="line">Desc [表名] -- 显示表的结构</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>数据库引擎</strong></p><p><strong>MYISAM   早先年使用的</strong></p><blockquote><p>事务支持： 不支持</p><p>数据行锁定：不支持</p><p>外键：不支持</p><p>全文索引： 支持</p><p>表空间大小 ： 较小</p></blockquote><p><strong>INNODB 目前默认使用的</strong></p><blockquote><p>事务支持： 支持</p><p>数据行锁定：支持</p><p>外键：支持</p><p>全文索引： 不支持</p><p>表空间大小：较大，约为2倍</p></blockquote><p><strong>常规使用操作：</strong></p><blockquote><p>MYISAM 节约空间，速度较快</p><p>INNODB 安全性高，事务的处理，多表多用户操作</p><p>在物理空间存储的位置</p></blockquote><p>所有的数据库文件都存在data下一个文件夹就代表一个数据库</p><p>本质还是文件的存储</p><h5 id="MYSQL引擎在物理文件上的区别"><a href="#MYSQL引擎在物理文件上的区别" class="headerlink" title="MYSQL引擎在物理文件上的区别"></a>MYSQL引擎在物理文件上的区别</h5><ul><li><p>​    InnoDB在数据库表中只有一个*.frm文件，以及目录上级目录下的ibdata1文件</p><p>   ​    MYISAM对应文件</p><ul><li>*.frm —表结构的定义文件</li><li>*.MYD 数据文件（data）</li><li>*.MYI  索引文件（index）</li></ul></li></ul><blockquote><p>设置数据库表的字符集编码</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">charset=utf8;</span><br></pre></td></tr></table></figure><p>不设置的话会是使用mysql中默认的编码，他不支持中文。</p><p>my.ini中配置默认的编码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">character-set-server=utf8;</span><br></pre></td></tr></table></figure><p>===============================================================</p><h5 id="修改表"><a href="#修改表" class="headerlink" title="修改表"></a>修改表</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 修改表的名字 alter table 旧表名  rename as 新表名</span><br><span class="line">alter table san rename san1;</span><br></pre></td></tr></table></figure><h5 id="增加表字段"><a href="#增加表字段" class="headerlink" title="增加表字段"></a>增加表字段</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 添加表字段 alter table 表名 add 列名 数据类型</span><br><span class="line">alter table test add min int(4);</span><br></pre></td></tr></table></figure><h5 id="修改表的字段"><a href="#修改表的字段" class="headerlink" title="修改表的字段"></a>修改表的字段</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-- 修改约束 alter table 表名 modify 列名 数据类型</span><br><span class="line">alter table test modify min varchar(20);</span><br><span class="line"></span><br><span class="line">-- 字段 重命名 以及修改约束  alter  table  表名 change 旧名字 新名字 列属性</span><br><span class="line">alter table test change min min1 int(11); </span><br><span class="line"></span><br><span class="line">-- 删除表字段  alter table 表名 drop 列名</span><br><span class="line">alter table 表名 drop 列名；</span><br><span class="line"></span><br><span class="line">-- 删除表 </span><br><span class="line">drop table if exists 表名</span><br></pre></td></tr></table></figure><p>== 所有的创建和删除操作劲量加上判断，以免造成错误 == </p><h4 id="MYSQL数据管理"><a href="#MYSQL数据管理" class="headerlink" title="MYSQL数据管理"></a><strong>MYSQL数据管理</strong></h4><h5 id="外键"><a href="#外键" class="headerlink" title="外键"></a>外键</h5><p>方式一</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-- 定义外键key</span><br><span class="line">-- 给这个外键添加约束执行引用 references 引用</span><br><span class="line">key FK_列名(列名) ，</span><br><span class="line">constraint FK_列名 foreign key 列名 references 表名（列名）</span><br><span class="line"></span><br><span class="line">-- 方式二，创建表成功后，添加外键约束</span><br><span class="line">alter table test</span><br><span class="line">add constraint FK_列名 foregin key (列名) references  `表名`(列名)；</span><br><span class="line">-- alter table 表 add constraint 约束名 foreign key(作为主键的列) referebces 那个表（哪个字段）</span><br></pre></td></tr></table></figure><p>删除有外键关联的值的时候，必须要删除外键。</p><p>最好的办法，数据库就是单纯的表，用来存数据，只有行和列</p><p>我们想使用多张表的时候想使用外键。</p><h3 id="DML（数据库操作语言）："><a href="#DML（数据库操作语言）：" class="headerlink" title="DML（数据库操作语言）："></a>DML（数据库操作语言）：</h3><p><strong>数据操作语言DML（Data Manipulation Language），用户通过它可以实现对数据库的基本操作。例如，对表中数据的查询、插入、删除和修改。 在DML中，应用程序可以对数据库作插，删，改，排，检等五种操作</strong> </p><p>数据库意义，存储，管理。</p><p>创建一个表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists test(</span><br><span class="line">    -- id 列名  int 数据类型  primary key 主键 not null 不为空 auto_increment 自增   comment &quot;&quot; 别名</span><br><span class="line">id  int  primary key  not null auto_increment comment &#x27;主键&#x27;,</span><br><span class="line">    -- default &#x27;&#x27; 默认的</span><br><span class="line">    name varchar(10) not null default &#x27;匿名&#x27; comment &#x27;姓名&#x27;</span><br><span class="line">)Engine=innodb default charset=utf8;</span><br></pre></td></tr></table></figure><h5 id="添加-insert"><a href="#添加-insert" class="headerlink" title="添加(insert):"></a>添加(insert):</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-- 一般写插入语句，我们一定要数据和字段一一对应 一个子段对应一个值</span><br><span class="line">-- 插入数据</span><br><span class="line">insert into 表名 (【字段1，自段2，字段三】) value (&#x27;值1&#x27;)，(&#x27;值2&#x27;),(&#x27;值3&#x27;)；</span><br><span class="line"></span><br><span class="line">insert into test(name) value(&quot;张三&quot;)；</span><br><span class="line"> -- 或者</span><br><span class="line"> -- 已知列  id name </span><br><span class="line"> insert into test value (&#x27;12&#x27;,&#x27;name&#x27;)；</span><br><span class="line"> </span><br><span class="line"> -- 由于主键自增，那么我们不插入id</span><br><span class="line"> insert into test value( ,&#x27;name&#x27;)；</span><br><span class="line"> </span><br><span class="line"> -- 一次插入多个数据</span><br><span class="line"> insert into test(name) value (&#x27;张三&#x27;),（&#x27;李四&#x27;）;</span><br><span class="line"> </span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>注意：</p><ol><li>字段使用英文逗号隔开</li><li>不写具体的列进行插入，那么我们插入的时候就需要整个数据库列的值全部插入</li><li>字段可以省略，但是后面的值必须要一一对应，不能少</li><li>可以同时插入多条数据，value后边的值，需要使用 英文逗号隔开。(),()</li></ol><h5 id="更新-update"><a href="#更新-update" class="headerlink" title="更新(update):"></a>更新(update):</h5><p>一般是更新数据库中的数据，而不是更新表的子段。。。。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-- 修改学员的名字</span><br><span class="line">update test set name = &#x27;张三&#x27; where id = 1 ;</span><br><span class="line">-- 在不指定具体的条件的情况下更改会更改表中所有name的数据</span><br><span class="line">update test set name = &#x27;李四&#x27;;  -- 更新整个表中列为name的所有数据是name都等于&#x27;李四&#x27;；  切记不要傻乎乎的使用。。。后果就是删库跑路</span><br><span class="line"></span><br><span class="line">-- 修改多个属性，逗号隔开</span><br><span class="line">update test set name =  &#x27;张三&#x27;  , tel = &#x27;123321&#x27;, email = &#x27;2569758@qq.com&#x27; where id = 1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 语法 </span><br><span class="line">update 表名 set 【列名1 = 值1，列2 = 值2 。。。。】 where 【条件】； </span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>操作符</th><th>含义</th><th>范围</th><th>结果</th></tr></thead><tbody><tr><td>=</td><td>等于</td><td>5=6</td><td>false</td></tr><tr><td>&lt;&gt; 或  !=</td><td>不等于</td><td>5&lt;&gt; 6</td><td>true</td></tr><tr><td>&gt;</td><td>大于</td><td>5&gt;6</td><td>false</td></tr><tr><td>&lt;</td><td>小于</td><td>5&lt;6</td><td>true</td></tr><tr><td>&lt;=</td><td>小于等于</td><td>—</td><td></td></tr><tr><td>&gt;=</td><td>大于等于</td><td>—</td><td></td></tr><tr><td>between… and …</td><td>介于…之间</td><td>[2,5]</td><td></td></tr><tr><td>and</td><td>和</td><td>5&gt;1 and 1&gt;2</td><td>false</td></tr><tr><td>or</td><td>或</td><td>5&gt;1 or 1&gt;2</td><td>true</td></tr></tbody></table></div><p><code>update 表名 set 【列名1 = 值1，列2 = 值2 。。。。】 where 【条件】；</code> </p><p>注意：</p><ol><li><p>更新某个类需要指定列名，顺带加上条件，没有加条件则会更新所有的列</p></li><li><p>不同列名之间需要加，隔开。</p></li></ol><h5 id="删除-delete"><a href="#删除-delete" class="headerlink" title="删除(delete)"></a>删除(delete)</h5><p>删除表中的数据，和drop不一样，drop是删除整个表，delete是删除表中的数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 删除数据 尽量避免不添加条件删除</span><br><span class="line">delete from 表名 ; -- 这样会删除整个数据库</span><br><span class="line"></span><br><span class="line">-- 删除指定数据，也就是根据条件删除</span><br><span class="line">delete from 表名 where  列名1 = 值1 and 列名2 = 值2 ...；</span><br></pre></td></tr></table></figure><h5 id="TRUNCATE命令（推荐）"><a href="#TRUNCATE命令（推荐）" class="headerlink" title="TRUNCATE命令（推荐）"></a>TRUNCATE命令（推荐）</h5><p>清空某一张表。。。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 清空student表 truncate</span><br><span class="line">TRUNCATE 表名；</span><br></pre></td></tr></table></figure><h5 id="delete-和-truncate区别："><a href="#delete-和-truncate区别：" class="headerlink" title="delete 和 truncate区别："></a>delete 和 truncate区别：</h5><ol><li>相同点：都能删除表数据，且不会删除表结构</li><li>不同：<ol><li>truncate 重新设置<strong>自增列</strong> 记数器会归零</li><li>truncate不会影响事务</li></ol></li></ol><p><strong>delete删除问题，重启数据库，现象</strong></p><blockquote><p>InnoDB 自增会重1开始(存在内存中的，断电就失去)；</p><p>MyISAM 继续从上一个自增量开始(存在文件中，不会丢失）</p></blockquote><h3 id="DQL（数据库查询语言）："><a href="#DQL（数据库查询语言）：" class="headerlink" title="DQL（数据库查询语言）："></a>DQL（数据库查询语言）：</h3><p><strong>DQL（data query language）数据查询语言，专门用来查询数据。</strong> </p><ul><li>一般使用的都是Select 所有的查询操作都是这个</li><li>简单的查询和复杂的查询都能做</li><li>数据库中最核心的语言，也是最重要的语句。</li><li>使用频率最高的语句</li></ul><h5 id="查询所有"><a href="#查询所有" class="headerlink" title="查询所有"></a>查询所有</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from 表名； -- 一般不推荐使用 sql优化不推荐使用</span><br></pre></td></tr></table></figure><h5 id="查询指定字段"><a href="#查询指定字段" class="headerlink" title="查询指定字段"></a>查询指定字段</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id , name from表名； </span><br></pre></td></tr></table></figure><h5 id="查询起别名，然后通过别名得到数据"><a href="#查询起别名，然后通过别名得到数据" class="headerlink" title="查询起别名，然后通过别名得到数据"></a>查询起别名，然后通过别名得到数据</h5><p>as 可以给字段起别名，也可以给表起别名 </p><p>如 ： from 表名 as ‘别名’</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 列名1 as &#x27;别名1&#x27; , 列名2 as &#x27;别名2&#x27; ... from 表名；</span><br></pre></td></tr></table></figure><h5 id="去重查询distinct"><a href="#去重查询distinct" class="headerlink" title="去重查询distinct"></a>去重查询distinct</h5><p>去除查到的重复的值</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select distinct 列名 from 表名；  -- 查询表中重复的数据，使得重复的数据只显示一条。</span><br><span class="line"></span><br><span class="line">select version() ; -- 查询系统版本</span><br><span class="line">select 100*3 -1 as &#x27;结果&#x27; ;  -- 用来计算  </span><br><span class="line">select @@auto_increment_increment ;   -- 查询自增的步长（变量）</span><br><span class="line"></span><br><span class="line">-- 例子 查询考试成绩 + 1 查看</span><br><span class="line">select id , scode + 1 as &#x27;加分后&#x27; from 表名;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="数据库中表达式："><a href="#数据库中表达式：" class="headerlink" title="数据库中表达式："></a>数据库中表达式：</h5><p>文本值，列，NULL，函数，计算表达式，系统变量….</p><blockquote><p>select 表达式 from 表名；</p></blockquote><h5 id="WHERE条件"><a href="#WHERE条件" class="headerlink" title="WHERE条件"></a>WHERE条件</h5><p>一般作为检索数据中的符合条件的值</p><p>搜索的条件一般由一个或多个条件组成。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">select id , score from 表名；</span><br><span class="line">-- 查询成绩在95 - 100 直接的 id</span><br><span class="line">select id from 表名 where score &gt;=95  and score &lt;= 100;</span><br><span class="line"></span><br><span class="line">-- and  &amp;&amp; </span><br><span class="line">select id from 表名 where score &gt;=95  &amp;&amp; score &lt;= 100;</span><br><span class="line"></span><br><span class="line">-- 模糊查询（between）</span><br><span class="line">select id from 表名 where score between 95 and 100;</span><br><span class="line"></span><br><span class="line">-- 除了1000号同学以为的所有同学的成绩</span><br><span class="line">select id ,score from 表名 where id != 1000;</span><br><span class="line"></span><br><span class="line">-- != not </span><br><span class="line">select id ,score from 表名 where not id = 1000;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>了解逻辑运算符：</p></blockquote><div class="table-container"><table><thead><tr><th>运算符</th><th>语法</th><th>描述</th></tr></thead><tbody><tr><td>and           &amp;&amp;</td><td>a and b  a &amp;&amp; b</td><td>逻辑与，两真为真</td></tr><tr><td>or              \</td><td>\</td><td></td><td>a \</td><td>\</td><td>b         a   or  b</td><td>逻辑或 ，一真为真，全假为假</td></tr><tr><td>not           !</td><td>not  a           !a</td><td>逻辑非，真为假，假为真<em>**</em></td></tr></tbody></table></div><p><strong>模糊查询</strong></p><div class="table-container"><table><thead><tr><th>运算符</th><th>语法</th><th>描述</th></tr></thead><tbody><tr><td>is null</td><td>a is  null</td><td>如果操作符为null,结果为真</td></tr><tr><td>is not null</td><td>a is not null</td><td>如果操作符不为空，结果为真</td></tr><tr><td>between</td><td>a between b and c</td><td>如果a在b和c之间，则结果为真</td></tr><tr><td>like</td><td>a like  b</td><td>sql匹配成功，如果a匹配b，则结果为真</td></tr><tr><td>in</td><td>a in b</td><td>a 在 b 中</td></tr><tr><td></td><td></td></tr></tbody></table></div><p>举例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">-- 查询姓刘的同学的名字</span><br><span class="line">select id , name from 表名 where name like &#x27;刘%&#x27;；</span><br><span class="line"></span><br><span class="line">-- 查询姓刘的同学，且只有一个字的</span><br><span class="line">select id , name from 表名 where name like &#x27;刘_&#x27;；</span><br><span class="line"></span><br><span class="line">-- 查询姓刘的同学，且只有两个字的</span><br><span class="line">select id , name from 表名 where name like &#x27;刘__&#x27;；</span><br><span class="line"></span><br><span class="line">-- 查询名字中有嘉的同学，%嘉%</span><br><span class="line">select id , name from 表名 where name like &#x27;%嘉%&#x27;；</span><br><span class="line"></span><br><span class="line">-- =================== in（具体的一个或多个值） ================</span><br><span class="line"> -- 查询101,102,103 号学员</span><br><span class="line"> select id, name from 表名 where id in ( 101,102,103);</span><br><span class="line"> </span><br><span class="line"> -- 用in查询名字等于张三，李四。。。的学生</span><br><span class="line"> select id , name from 表名 where name in (&#x27;张三&#x27;, &#x27;李四&#x27; ,&#x27;王五&#x27;...)；</span><br><span class="line"> </span><br><span class="line"> -- 查询姓名为空的学习（当然我们设置默认值，必定不存在这个值）</span><br><span class="line">  select id , name from 表名 where name  = &#x27;&#x27; or name is null;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  -- 查询姓名不为空的同学</span><br><span class="line">    select id , name from 表名 where name  != &#x27;&#x27; or name is not null;</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure><h5 id="连表查询（JOIN-on）"><a href="#连表查询（JOIN-on）" class="headerlink" title="连表查询（JOIN on）"></a>连表查询（JOIN on）</h5><p><img src="F:\三期学习资料\学习资料\Mysql\1666274982133.png" alt="1666274982133"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">-- 连接两个表</span><br><span class="line">select s.id , s.name ,cid ,cname </span><br><span class="line">from stu s inner join class as r</span><br><span class="line">where s.id = r.id;</span><br><span class="line"> </span><br><span class="line">-- 右连接 right join </span><br><span class="line">select s.id , name , cid , cname from stu s</span><br><span class="line">right join class c</span><br><span class="line">on s.id = c.id</span><br><span class="line"></span><br><span class="line">-- 左连接 left join  </span><br><span class="line">select s.id , name , cid , cname from stu s</span><br><span class="line">left join class c</span><br><span class="line">on s.id = c.id</span><br><span class="line"></span><br><span class="line">-- join  on  连接查询</span><br><span class="line">-- where  等值查询</span><br><span class="line"></span><br><span class="line">-- 查询name为空的同学</span><br><span class="line">select s.id , sname , cid, cname </span><br><span class="line">from stu s left join </span><br><span class="line">class c on s.id = c.id </span><br><span class="line">where name is null;</span><br><span class="line"></span><br><span class="line">-- 查询时间为空的学生信息</span><br><span class="line">select s.id ,date, name ,cid , cname from stu s</span><br><span class="line">left join class c</span><br><span class="line">on s.id = c.id</span><br><span class="line">where date is null;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th style="text-align:center">操作</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">inner   join</td><td style="text-align:center">如果表中至少有一个匹配值，那么就返回行</td></tr><tr><td style="text-align:center">left join</td><td style="text-align:center">会从左表中返回所有的值，即使右表中没有</td></tr><tr><td style="text-align:center">right join</td><td style="text-align:center">会从右表中返回所有的值，即使左表中没有</td></tr></tbody></table></div><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">-- 测试数据库</span><br><span class="line">create table `table_a` (</span><br><span class="line">  `aid` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `a_name` varchar(255) NOT NULL,</span><br><span class="line">  `age` smallint NOT NULL,</span><br><span class="line">  PRIMARY KEY(`aid`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT &#x27;测试表A&#x27;;</span><br><span class="line"> </span><br><span class="line">create table `table_b` (</span><br><span class="line">  `bid` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `b_name` varchar(255) NOT NULL,</span><br><span class="line">  `age` smallint NOT NULL,</span><br><span class="line">  PRIMARY KEY(`bid`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT &#x27;测试表B&#x27;;</span><br><span class="line"> </span><br><span class="line"># 插入测试数据</span><br><span class="line">INSERT INTO `table_a`(aid, a_name, age) VALUES(1, &#x27;test1&#x27;, 1),(2, &#x27;test2&#x27;, 2),(3, &#x27;test3&#x27;, 3);</span><br><span class="line">INSERT INTO `table_b`(bid, b_name, age) VALUES(1, &#x27;test2&#x27;, 2),(2, &#x27;test3&#x27;, 3),(4, &#x27;test4&#x27;, 4);</span><br></pre></td></tr></table></figure><p>这三条SQL都是等价的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM table_a JOIN table_b;</span><br><span class="line">SELECT * FROM table_a INNER JOIN table_b;</span><br><span class="line">SELECT * FROM table_a CROSS JOIN table_b;</span><br></pre></td></tr></table></figure><p>结果如下：</p><h6 id="inner-join连接"><a href="#inner-join连接" class="headerlink" title="inner  join连接"></a>inner  join连接</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-- 相当于笛卡尔积</span><br><span class="line">mysql&gt; SELECT * FROM table_a INNER JOIN table_b;</span><br><span class="line">+-----+--------+-----+-----+--------+-----+</span><br><span class="line">| aid | a_name | age | bid | b_name | age |</span><br><span class="line">+-----+--------+-----+-----+--------+-----+</span><br><span class="line">|   1 | test1  |   1 |   1 | test2  |   2 |</span><br><span class="line">|   2 | test2  |   2 |   1 | test2  |   2 |</span><br><span class="line">|   3 | test3  |   3 |   1 | test2  |   2 |</span><br><span class="line">|   1 | test1  |   1 |   2 | test3  |   3 |</span><br><span class="line">|   2 | test2  |   2 |   2 | test3  |   3 |</span><br><span class="line">|   3 | test3  |   3 |   2 | test3  |   3 |</span><br><span class="line">|   1 | test1  |   1 |   4 | test4  |   4 |</span><br><span class="line">|   2 | test2  |   2 |   4 | test4  |   4 |</span><br><span class="line">|   3 | test3  |   3 |   4 | test4  |   4 |</span><br><span class="line">+-----+--------+-----+-----+--------+-----+</span><br></pre></td></tr></table></figure><p>有ON和WHERE筛选条件，此时得到的结果是<strong>两张表的交集</strong>（中间的图），对于内连接，ON和WHERE是等价的，但是对于外连接则不是，在下面会讲到。 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 这两条SQL是等价的，不过建议使用ON关键字，约定俗成</span><br><span class="line">SELECT * FROM table_a a INNER JOIN table_b b ON a.a_name=b.b_name;</span><br><span class="line">SELECT * FROM table_a a INNER JOIN table_b b WHERE a.a_name=b.b_name;</span><br><span class="line"></span><br><span class="line"># 结果如下：</span><br><span class="line">mysql&gt; SELECT * FROM table_a a INNER JOIN table_b b ON a.a_name=b.b_name;</span><br><span class="line">+-----+--------+-----+-----+--------+-----+</span><br><span class="line">| aid | a_name | age | bid | b_name | age |</span><br><span class="line">+-----+--------+-----+-----+--------+-----+</span><br><span class="line">|   2 | test2  |   2 |   1 | test2  |   2 |</span><br><span class="line">|   3 | test3  |   3 |   2 | test3  |   3 |</span><br><span class="line">+-----+--------+-----+-----+--------+-----+</span><br><span class="line"></span><br></pre></td></tr></table></figure><h6 id="右连接-right-join"><a href="#右连接-right-join" class="headerlink" title="右连接(right join)"></a>右连接(right join)</h6><p>右连接的关键字是 <code>RIGHT JOIN</code>，从上图可以得到（右边的图），右连接其实就是<strong>两个表的交集+右表剩下的数据</strong> ，当然这是在没其他过滤条件的情况下。 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM `table_a` a RIGHT JOIN `table_b` b ON a.a_name=b.b_name;</span><br><span class="line">+------+--------+------+-----+--------+-----+</span><br><span class="line">| aid  | a_name | age  | bid | b_name | age |</span><br><span class="line">+------+--------+------+-----+--------+-----+</span><br><span class="line">|    2 | test2  |    2 |   1 | test2  |   2 |</span><br><span class="line">|    3 | test3  |    3 |   2 | test3  |   3 |</span><br><span class="line">| NULL | NULL   | NULL |   4 | test4  |   4 |</span><br><span class="line">+------+--------+------+-----+--------+-----+</span><br></pre></td></tr></table></figure><h6 id="左连接-left-join"><a href="#左连接-left-join" class="headerlink" title="左连接(left join)"></a>左连接(left join)</h6><p>左连接的关键字是 <code>LEFT JOIN</code>，从上图可以得到（左边的图），左连接其实就是<strong>两个表的交集+左表剩下的数据</strong> ，当然这是在没其他过滤条件的情况下。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 没找到的被置为NULL</span><br><span class="line">mysql&gt; SELECT * FROM `table_a` a LEFT JOIN `table_b` b ON a.a_name=b.b_name;</span><br><span class="line">+-----+--------+-----+------+--------+------+</span><br><span class="line">| aid | a_name | age | bid  | b_name | age  |</span><br><span class="line">+-----+--------+-----+------+--------+------+</span><br><span class="line">|   2 | test2  |   2 |    1 | test2  |    2 |</span><br><span class="line">|   3 | test3  |   3 |    2 | test3  |    3 |</span><br><span class="line">|   1 | test1  |   1 | NULL | NULL   | NULL |</span><br><span class="line">+-----+--------+-----+------+--------+------+</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p><strong>WHERE子句中的过滤条件就是我们常见的那种，不管是内连接还是外连接，只要不符合WHERE子句的过滤条件，都会被过滤掉。</strong></p><p><strong>而ON子句中的过滤条件对于内连接和外连接是不同的，对于内连接，ON和WHERE的作用是一致的，因为匹配不到的都会过滤，所以你可以看到内连接并不强制需要 ON 关键字；但是对于外连接，ON决定匹配不到的是否要过滤，所以你可以看到外连接是强制需要 ON 关键字的。</strong></p></blockquote><p>我要查询哪些数据 select …</p><p>从那几个表中查    from    表      XXX    join     连接的表     on    交叉条件</p><p>假设存在一种多张表查询，慢慢来，先查询两张表  然后在慢慢添加。</p><h5 id="自连接-了解"><a href="#自连接-了解" class="headerlink" title="自连接(了解)"></a>自连接(了解)</h5><p>自己的表和自己的表连接： <strong>核心是一张表拆为两张表使用</strong></p><p>将数据同一张表中数据进行查分，然后起别名。将一张表变成两张表处理。</p><p>分为父和子，也就是拆分的表可以成为父和子关系或者说<strong>包含</strong>和<strong>被包含</strong>关系。</p><h5 id="分页和排序"><a href="#分页和排序" class="headerlink" title="分页和排序"></a>分页和排序</h5><p><strong>limit  和 order by</strong></p><h6 id="limit（分页）"><a href="#limit（分页）" class="headerlink" title="limit（分页）"></a>limit（分页）</h6><p>​    limit  当前页，页面大小</p><p>​    <code>limit  0 , 5</code>       —前边数字表示第几页，后边数据每页显示的数据条数</p><h6 id="order-by-（排序）"><a href="#order-by-（排序）" class="headerlink" title="order by （排序）"></a>order by （排序）</h6><ul><li><p>升序    asc</p><p><code>order by id  asc</code> 根据id升序排序</p></li><li><p>降序        desc</p><p><code>order by  id  desc</code>根据id降序排序</p></li></ul><h5 id="子查询和嵌套查询"><a href="#子查询和嵌套查询" class="headerlink" title="子查询和嵌套查询"></a>子查询和嵌套查询</h5><p><strong>出现在其他语句中的select语句被称为子查询</strong></p><p>:top:<strong>查询顺序是由里及外。</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">-- 查询 数据库结构的所有考试结果(学号，科目编号，成绩)，降序排列</span><br><span class="line">-- 方式1  id 是stu 表 学生编号，sid 是 score 表，成绩编号</span><br><span class="line">select id , s.sid, score</span><br><span class="line">from score s,</span><br><span class="line">inner join sub  u</span><br><span class="line">on s.id = u.id</span><br><span class="line">where sname = &#x27;数据结构&#x27;</span><br><span class="line">order by score desc</span><br><span class="line"></span><br><span class="line">-- 方式2 使用子查询</span><br><span class="line">select id , sid ,score</span><br><span class="line">from score </span><br><span class="line">where sid = (</span><br><span class="line">    -- 作为子查询 先查询里边的然后在查询外边的</span><br><span class="line">select sid </span><br><span class="line">    from score </span><br><span class="line">    where sname = &#x27;数据结构&#x27;</span><br><span class="line">)</span><br><span class="line">order by score desc;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 查询所有数据库结构 的学生学号</span><br><span class="line">select id from score where sname = &#x27;数据结构&#x27;； </span><br><span class="line"></span><br><span class="line">-- 查询分数不小于80分的学号和姓名</span><br><span class="line">select distinct id , name </span><br><span class="line">from stu t</span><br><span class="line">inner join score s</span><br><span class="line">on s.id = t.id</span><br><span class="line">where score &gt; 80;</span><br><span class="line"></span><br><span class="line">-- 在此基础上添加一个科目，高等数学</span><br><span class="line">select distinct id , name </span><br><span class="line">from stu t</span><br><span class="line">inner join score s</span><br><span class="line">on s.id = t.id</span><br><span class="line">where score &gt; 80 and sid = (</span><br><span class="line">select sid  from score </span><br><span class="line">    where sname = &#x27;高等数学&#x27;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>按位置分类：</p><blockquote><p>select后面<br>from后面<br>where或having后面<br>exists后面<br>按结果级的行数不同分类：</p></blockquote><ul><li>标量子查询 (结果集有一行一列)</li><li>列子查询 (结果集只有一列多行)</li><li>行子查询 (结果集只有一行多列)</li><li>表子查询 (结果集一般为多行多列)</li></ul><p><strong>where或having后面长放的</strong></p><ul><li>标量子查询</li><li>列子查询</li><li>行子查询</li></ul><p><strong>特点：</strong></p><ul><li><p>子查询都放在小括号内，结尾不用加 ;</p></li><li><p>子查询可以放在from后面、select后面、where后面、having后面，但一般放在条件的右侧</p></li><li>子查询优先于主查询执行，主查询使用了子查询的执行结果</li><li>子查询根据查询结果的行数不同分为以下两类：单行子查询和多行子查询</li></ul><blockquote><p><strong>单行子查询</strong><br>结果集只有一行<br>一般搭配单行操作符使用：&gt; &lt; = &lt;&gt; &gt;= &lt;=<br>非法使用子查询的情况：</p><p>子查询的结果为一组值<br>子查询的结果为空</p><p><strong>多行子查询</strong><br>结果集有多行<br>一般搭配多行操作符使用：any、all、in、not in<br>in：属于子查询结果中的任意一个就行<br>any和all:往往可以用其他查询代替</p></blockquote><h5 id="MySQL常用函数"><a href="#MySQL常用函数" class="headerlink" title="MySQL常用函数"></a>MySQL常用函数</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-- 数学运算</span><br><span class="line">SELECT ABS(-10);-- 绝对值</span><br><span class="line">SELECT CEIL(10.1);-- ceil和ceiling 向上取整</span><br><span class="line">SELECT FLOOR(10.1);-- 向下取整</span><br><span class="line">SELECT RAND();-- 返回0-1随机数</span><br><span class="line">SELECT SIGN(NULL);-- 返回参数的符号 负数返回-1 正数返回1 </span><br><span class="line">-- 0和非数字返回0 null返回null</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-- 字符串函数</span><br><span class="line">SELECT CHAR_LENGTH(&#x27;fwebw&#x27;);-- 返回字符串长度</span><br><span class="line">SELECT CONCAT(&#x27;1&#x27;,&#x27;2&#x27;,&#x27;3&#x27;);-- 拼接字符串</span><br><span class="line">SELECT INSERT(&#x27;123456&#x27;,1,3,&#x27;0&#x27;);-- 先把第一个字符串的第1位起的0个字符去除</span><br><span class="line">-- 然后再把第二个字符串插入到对应位置</span><br><span class="line">SELECT LOWER(&#x27;JIOji&#x27;);-- 转小写字母</span><br><span class="line">SELECT UPPER(&#x27;wfdINOI&#x27;);-- 转大写字母 </span><br><span class="line">SELECT INSTR(&#x27;asdasd&#x27;,&#x27;sd&#x27;);-- 返回第一个字串出现的位置</span><br><span class="line">SELECT REPLACE(&#x27;123456789123&#x27;,&#x27;123&#x27;,&#x27;hhh&#x27;);-- 把s1中s2部分替换为s3（所有s2）</span><br><span class="line">SELECT SUBSTR(&#x27;123456789&#x27;,2,4);-- 截取字符串，从第2个字符开始截取4个字符</span><br><span class="line">SELECT REVERSE(&#x27;123465&#x27;);-- 翻转字符串</span><br><span class="line"></span><br><span class="line">-- 查询姓周的同学并把姓换为邹</span><br><span class="line">SELECT REPLACE(studentName,&#x27;周&#x27;,&#x27;邹&#x27;) FROM students</span><br><span class="line">WHERE studentName LIKE &#x27;周%&#x27;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-- 时间和日期函数</span><br><span class="line">SELECT CURRENT_DATE();-- 获取当前日期</span><br><span class="line">SELECT CURDATE()-- 获取当前日期</span><br><span class="line">SELECT CURRENT_TIME();-- 获取当前时间（时分秒）</span><br><span class="line">SELECT SYSDATE();-- 获取系统时间</span><br><span class="line">SELECT NOW();-- 获取时间</span><br><span class="line">SELECT YEAR(NOW());-- 获取当前年</span><br><span class="line">SELECT MONTH(NOW());-- 获取当前月</span><br><span class="line">-- ······获取日时分秒同理</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- 系统</span><br><span class="line">SELECT SYSTEM_USER();</span><br><span class="line">SELECT USER();-- 获取当前用户</span><br><span class="line">SELECT VERSION(); -- 获取当前版本信息</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>函数字段</th><th></th><th>描述</th></tr></thead><tbody><tr><td>abs()</td><td></td><td>绝对值</td></tr><tr><td>ceiling()</td><td></td><td>向上取整</td></tr><tr><td>floor()</td><td></td><td>向下取整</td></tr><tr><td>rand()</td><td></td><td>返回一个0-1直接的随机数</td></tr><tr><td>sign()</td><td></td><td>判断一个数的符号  负数范围-1，正数返回1</td></tr><tr><td>char_length()</td><td></td><td>判断字符串长度</td></tr><tr><td>concat(‘’,’’,’’)</td><td></td><td>拼接字符串</td></tr><tr><td>insert(‘查询并被替换的’,1，3,’要替换的’)</td><td></td><td>查询替换从1，到3号位置替换</td></tr><tr><td>lower()</td><td></td><td>将字符串专为小写</td></tr><tr><td>upper()</td><td></td><td>将小写转为大写</td></tr><tr><td>instr()</td><td></td><td>返回第一次出现的字符串索引</td></tr><tr><td>replace()</td><td></td><td>替换出现的指定字符串</td></tr><tr><td>substr()</td><td></td><td>截取字符串</td></tr><tr><td>reverse()</td><td></td><td>反转</td></tr><tr><td>….</td><td></td><td>….</td></tr></tbody></table></div><h5 id="聚合函数和分组过滤（having-by-）"><a href="#聚合函数和分组过滤（having-by-）" class="headerlink" title="聚合函数和分组过滤（having by ）"></a>聚合函数和分组过滤（having by ）</h5><div class="table-container"><table><thead><tr><th>聚合函数</th><th>描述</th></tr></thead><tbody><tr><td>count()</td><td>统计</td></tr><tr><td>sum()</td><td>求和</td></tr><tr><td>avg()</td><td>平均值</td></tr><tr><td>max()</td><td>最大值</td></tr><tr><td>min()</td><td>最小值</td></tr></tbody></table></div><p>having的用法</p><p><strong>having字句可以让我们筛选成组后的各种数据，where字句在聚合前先筛选记录，也就是说作用在group by和having字句前。而 having子句在聚合后对组记录进行筛选。</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-- 查询不同科目的平均分最高分和最低分 平均分大于80</span><br><span class="line">-- 由于按照顺序执行，所以where不能限定分组后计算出的平均值等信息</span><br><span class="line">-- 可以使用having</span><br><span class="line">SELECT sname,AVG(score),MAX(score),MIN(score)</span><br><span class="line">FROM score s</span><br><span class="line">INNER JOIN `sub` sub</span><br><span class="line">ON s.id=sub.id</span><br><span class="line">GROUP BY s.id</span><br><span class="line">HAVING AVG(score)&gt;=80;</span><br></pre></td></tr></table></figure><h3 id="事务（transaction）"><a href="#事务（transaction）" class="headerlink" title="事务（transaction）"></a>事务（transaction）</h3><p>事务特性：ACID（原子性，一致性，隔离性，持久性）</p><ul><li><p>A:原子性</p><ul><li>要么成功要么不成功</li></ul></li><li><p>C:一致性</p><ul><li>最终一致性，保证最终结果一致</li></ul></li><li><p>I:隔离性</p><ul><li>一个事务的提交不会影响下一个事务。</li><li>隔离产生的问题<ul><li>脏读： 一个事务读取了另一个事务未提交的数据。</li><li>不可重复读：在一个事务内读取表中的某一行数据，多次读取结果不同。</li><li>幻读：指在一个事务内读取到别的事务插入的数据，导致前后读取不一致。</li></ul></li></ul></li><li><p>D:持久性</p><ul><li>表示事务结束后的数不会随着外界原因导致数据丢失</li><li>也就是说，事务没有提交，那么就恢复到原来的未提交状态，如果提交，那么就更新为提交后的状态，持久化到数据，事务一旦提交就不可逆。</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- 手动开启事务</span><br><span class="line">start transaction -- 标记一个事务的开始，从这个之后的sql都在同一个事务内</span><br><span class="line"></span><br><span class="line">insert xxx</span><br><span class="line">insert xxx</span><br><span class="line"></span><br><span class="line">-- 提交 持久化</span><br><span class="line">commit ;</span><br><span class="line">-- 如果提交失败就回滚到原来的样子</span><br><span class="line">rollback;</span><br><span class="line"></span><br><span class="line">-- 事务结束</span><br><span class="line">set autocommit = 1 ；-- 开启自动提交</span><br><span class="line"></span><br><span class="line">savepoint 保存点名 -- 设置一个事务的保持点</span><br><span class="line">rollback to savepoint 保存点名  -- 回滚到保存点</span><br><span class="line">release  savepoint 保存点名 -- 撤销保存点</span><br></pre></td></tr></table></figure><p>模拟场景</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">-- 转账</span><br><span class="line">create database shop character set utf8 collate utf_8_general_cli;</span><br><span class="line">use shop;</span><br><span class="line">create table account(</span><br><span class="line">id int (3) not null primary key auto_increment,</span><br><span class="line">    name varchar(20) not null，</span><br><span class="line">    money decimal(9,2) not null</span><br><span class="line">) engine = innodb default charset=utf8;</span><br><span class="line"></span><br><span class="line">-- 插入数据</span><br><span class="line">insert into account(name,money) </span><br><span class="line">value(&#x27;A&#x27;,1024.00),(&#x27;B&#x27;,2048.00)</span><br><span class="line"></span><br><span class="line">-- 模拟转账：事务</span><br><span class="line">set autocommit = 0; -- 关闭自动提交</span><br><span class="line">start transaction ; -- 开启事务</span><br><span class="line">update account set money - 500 where name = &#x27;A&#x27;;</span><br><span class="line">update account set money + 500 where name = &#x27;B&#x27;;</span><br><span class="line"></span><br><span class="line">commit ; -- 提交事务</span><br><span class="line">rollback ; -- 回滚</span><br><span class="line">set autocommit = 1; -- 恢复默认值</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><p>==<strong>是帮助mysql高效获取数据的数据结构，提取句子主干，可以得到索引的本质，索引是数据结构。</strong>==</p><h4 id="索引分类："><a href="#索引分类：" class="headerlink" title="索引分类："></a><strong>索引分类：</strong></h4><ol><li><p>主键索引：创建主键后会自动建立索引</p><ol><li><p>唯一标识，主键不可重复，只能有一个主键</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#随表一起建索引：</span><br><span class="line">CREATE TABLE customer (</span><br><span class="line">    id INT(10) UNSIGNED  AUTO_INCREMENT ,</span><br><span class="line">    customer_no VARCHAR(200),</span><br><span class="line">    customer_name VARCHAR(200),</span><br><span class="line">    PRIMARY KEY(id) </span><br><span class="line">);</span><br><span class="line">#使用AUTO_INCREMENT关键字的列必须有索引(只要有索引就行)。</span><br><span class="line">CREATE TABLE customer2 (</span><br><span class="line">    id INT(10) UNSIGNED,</span><br><span class="line">    customer_no VARCHAR(200),</span><br><span class="line">    customer_name VARCHAR(200),</span><br><span class="line"> PRIMARY KEY(id) </span><br><span class="line">);</span><br><span class="line">#单独建主键索引：</span><br><span class="line">ALTER TABLE customer </span><br><span class="line">add PRIMARY KEY </span><br><span class="line">customer(customer_no);  </span><br><span class="line">#删除建主键索引：</span><br><span class="line">ALTER TABLE customer</span><br><span class="line">drop PRIMARY KEY ;  </span><br><span class="line">#修改建主键索引：</span><br><span class="line">#必须先删除掉(drop)原索引，再新建(add)索引</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol></li><li><p>唯一索引:索引列的值必须唯一，但允许有空值</p><ol><li><p>避免重复的列出现，唯一索引可以重复，多个列都可以标识为，唯一索引。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#随表一起建索引：</span><br><span class="line">CREATE TABLE customer (</span><br><span class="line">    id INT(10) UNSIGNED  AUTO_INCREMENT ,</span><br><span class="line">    customer_no VARCHAR(200),</span><br><span class="line">    customer_name VARCHAR(200),</span><br><span class="line">  PRIMARY KEY(id),</span><br><span class="line">  KEY (customer_name),</span><br><span class="line">  UNIQUE (customer_no)</span><br><span class="line">);</span><br><span class="line">#建立 唯一索引时必须保证所有的值是唯一的（除了null），若有重复数据，会报错。   </span><br><span class="line">#单独建唯一索引：</span><br><span class="line">CREATE UNIQUE INDEX </span><br><span class="line">idx_customer_no </span><br><span class="line">ON customer(customer_no); </span><br><span class="line">#删除索引：</span><br><span class="line">DROP INDEX idx_customer_no</span><br><span class="line">on customer ;</span><br></pre></td></tr></table></figure></li></ol></li></ol><ol><li><p>常规索引</p><ol><li><p>默认的，index，key关键字来设置</p></li><li><p>单列索引：一个索引只包含单个列，一个表可以有多个单列索引</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#随表一起建索引：</span><br><span class="line">CREATE TABLE customer (</span><br><span class="line">    id INT(10) UNSIGNED  AUTO_INCREMENT ,</span><br><span class="line">    customer_no VARCHAR(200),</span><br><span class="line">    customer_name VARCHAR(200),</span><br><span class="line">  PRIMARY KEY(id),</span><br><span class="line">  KEY (customer_name)  </span><br><span class="line">);</span><br><span class="line">#随表一起建立的索引 索引名同 列名(customer_name)</span><br><span class="line">#单独建单值索引：</span><br><span class="line">CREATE INDEX idx_customer_name </span><br><span class="line">ON customer(customer_name); </span><br><span class="line">#删除索引：</span><br><span class="line">DROP INDEX idx_customer_name ;</span><br></pre></td></tr></table></figure></li></ol></li></ol><pre><code> 3.  复合索引：一个索引包含多个列，在数据库操作期间，复合索引比单值索引所需要的开销更小（对于相同的多个列建索引）     <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#随表一起建索引：</span><br><span class="line">CREATE TABLE customer (</span><br><span class="line">    id INT(10) UNSIGNED  AUTO_INCREMENT ,</span><br><span class="line">    customer_no VARCHAR(200),</span><br><span class="line">    customer_name VARCHAR(200),</span><br><span class="line">  PRIMARY KEY(id),</span><br><span class="line">  KEY (customer_name),</span><br><span class="line">  UNIQUE (customer_name),</span><br><span class="line">  KEY (customer_no,customer_name)</span><br><span class="line">);</span><br><span class="line">#单独建索引：</span><br><span class="line">CREATE INDEX idx_no_name</span><br><span class="line">ON customer(customer_no,customer_name); </span><br><span class="line">#删除索引：</span><br><span class="line">DROP INDEX idx_no_name  on customer ;</span><br></pre></td></tr></table></figure></code></pre><ol><li><p>全文索引</p><ol><li><p>在特定的数据库引擎下才有的，myIsam</p></li><li><p>快速定位数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- 索引的使用</span><br><span class="line">-- 在创建表的时候给字段增加索引</span><br><span class="line">-- 创建完毕后，增加索引</span><br><span class="line"></span><br><span class="line">-- 显示所有的索引信息</span><br><span class="line">show index from student;</span><br><span class="line"></span><br><span class="line">-- 增加一个全文索引（索引名） 列名</span><br><span class="line">alter table school.student</span><br><span class="line">add fulltext </span><br><span class="line">index studentName(studentName);</span><br><span class="line"></span><br><span class="line">-- explain 分析mysql执行的状况</span><br><span class="line">explain select * from student ; -- 非全文索引</span><br><span class="line"></span><br><span class="line">select * from student</span><br><span class="line">where match(studentName) against(&#x27;刘&#x27;)；</span><br></pre></td></tr></table></figure></li></ol><ol><li><p>聚集索引和非聚集索引</p><ol><li>聚集索引：指索引项的排序方式和表中数据记录排序方式一致的索引。 </li><li>非聚集索引：与聚集索引相反，索引顺序与物理存储顺序不一致 </li></ol></li></ol></li></ol><h4 id="索引测试"><a href="#索引测试" class="headerlink" title="索引测试"></a>索引测试</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">-- 我们在创建索引的时候一般使用  primary  key (列名)事实上这就是设置主键，但是这个也就是创建了唯一索引</span><br><span class="line">create table if not exists yyl(</span><br><span class="line">id int(10) not null primary key auto_increment comment &#x27;主键&#x27;,</span><br><span class="line">    name varchar(20) default null comment  &#x27;姓名&#x27;,</span><br><span class="line">    pwd varchar(50) not null default &#x27;123321&#x27; comment &#x27;密码&#x27;,</span><br><span class="line">    age int (10) not null default &#x27;0&#x27; comment &#x27;年龄&#x27;</span><br><span class="line">)engine = innodb default charset = utf8;</span><br><span class="line"></span><br><span class="line">-- 插入100万数据</span><br><span class="line">delimiter $$ -- 写数据之前必须要写，标志</span><br><span class="line">create function mock_data()</span><br><span class="line">returns int</span><br><span class="line">begin</span><br><span class="line">declare num int default 1000000;</span><br><span class="line">declare i int default 0;</span><br><span class="line">while i &lt; num do</span><br><span class="line">-- 插入语句</span><br><span class="line"></span><br><span class="line">insert into yyl (name,pwd,age) </span><br><span class="line">value(concat(&#x27;用户&#x27;,i),UUID(),floor(rand()*100));</span><br><span class="line">set i = i + 1;</span><br><span class="line">end while;</span><br><span class="line">return i;</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">-- 执行一下</span><br><span class="line">select mock_data();</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">select mock_data();</span><br><span class="line">受影响的行: 0</span><br><span class="line">时间: 42.708ms</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">-- 插入表数据</span><br><span class="line">insert into yyl (name,pwd,age) </span><br><span class="line">value(concat(&#x27;用户&#x27;,i),UUID(),floor(rand()*100));</span><br><span class="line"></span><br><span class="line">-- 由于插入了1000000条数据，那么查询一个值</span><br><span class="line">select * from yyl where name = &#x27;用户99999&#x27;;</span><br><span class="line">/*</span><br><span class="line">没创建索引的时候去查询数据</span><br><span class="line">[SQL] select * from yyl where name = &#x27;用户99999&#x27;;</span><br><span class="line">受影响的行: 0</span><br><span class="line">时间: 0.744ms</span><br><span class="line">我们发现时间比较长</span><br><span class="line">*/</span><br><span class="line">explain select * from yyl where name = &#x27;用户99999&#x27;; -- rows 1000539次</span><br><span class="line"></span><br><span class="line">-- 创建索引 id_表名_字段名 on 索引名 on 表（字段）</span><br><span class="line">create index id_yyl_name on yyl(name);</span><br><span class="line"></span><br><span class="line">-- 删除索引</span><br><span class="line">drop index id_yyl_name ;</span><br><span class="line">/*</span><br><span class="line">创建索引后再去查询数据非常快</span><br><span class="line">[SQL] select * from yyl where name = &#x27;用户99999&#x27;; </span><br><span class="line">受影响的行: 0</span><br><span class="line">时间: 0.009ms</span><br><span class="line">*/</span><br><span class="line">-- 此时explain   rows =1;</span><br><span class="line">explain select * from yyl where name = &#x27;用户99999&#x27;;</span><br></pre></td></tr></table></figure><p>==创建索引==</p><p>​    ==create index id <em> 表名</em> 字段名 on 索引名 表(字段)；==</p><p>==索引在小数据量的时候，用处不大，但是在大数据的时候，区别十分明显。==</p><h4 id="索引原则"><a href="#索引原则" class="headerlink" title="索引原则"></a>索引原则</h4><ul><li>索引不是越多越好</li><li>不要对进程变动数据加索引</li><li>小数据量的表不需要加索引</li><li>索引一般加在常常用来查询的字段上！</li></ul><p>索引的数据结构：</p><ul><li>Hash 类型的索引</li><li>B+树：innodb的默认数据结构</li></ul><h5 id="讨论为啥Innodb要使用B-树而不使用其他数据结构呢？"><a href="#讨论为啥Innodb要使用B-树而不使用其他数据结构呢？" class="headerlink" title="讨论为啥Innodb要使用B+树而不使用其他数据结构呢？"></a>讨论为啥Innodb要使用B+树而不使用其他数据结构呢？</h5><ul><li><p>​    B-树：（不是二分查找，却相似于二分查找）</p><ul><li>B-树是一种多路自平衡的搜索树，它类似普通的平衡二叉树，不同的一点是B-树允许每个节点有更多的子节点。B-Tree相对于AVLTree缩减了节点个数，使每次磁盘I/O取到内存的数据都发挥了作用，从而提高了查询效率。</li><li>存在问题：<ul><li>每个节点中有key，也有data，而每一个页的存储空间是有限的，如果data数据较大时将会导致每个节点（即一个页）能存储的key的数量很小。 当存储的数据量很大时同样会导致B-Tree的深度较大，增大查询时的磁盘I/O次数，进而影响查询效率 </li></ul></li></ul></li><li><p>B+树：</p><ul><li>B+Tree是在B-Tree基础上的一种优化，InnoDB存储引擎就是用B+Tree实现其索引结构。</li><li>它带来的变化点：<ul><li>B+树每个节点可以包含更多的节点，这样做有两个原因，一个是降低树的高度。另外一个是将数据范围变为多个区间，区间越多，数据检索越快</li><li>非叶子节点存储key，叶子节点存储key和数据叶子节点两两指针相互链接（符合磁盘的预读特性），顺序查询性能更高</li></ul></li><li>通常在B+Tree上有两个头指针，一个指向根节点，另一个指向关键字最小的叶子节点，而且所有叶子节点（即数据节点）之间是一种链式环结构。</li><li>因此可以对B+Tree进行两种查找运算：<ul><li>一种是对于主键的范围查找的分页查找。</li><li>另一种是从根节点开始，进行随机查找。 </li></ul></li></ul><p><strong>B树和B+树的区别：</strong></p><blockquote><p>B+树内节点不存储数据，所有数据存储在叶节点导致查询时间复杂度固定为log n<br>B-树查询时间复杂度不固定，与Key在树中的位置有关，最好为O(1)<br>B+树叶节点两两相连可大大增加区间访问性，可使用在范围查询等<br>B+树更适合外部存储（存储磁盘数据）。由于内节点无data域，每个节点能索引的范围更大更精确。</p></blockquote></li></ul><h3 id="DCL（数据库控制语言）："><a href="#DCL（数据库控制语言）：" class="headerlink" title="DCL（数据库控制语言）："></a>DCL（数据库控制语言）：</h3><p><strong>数据控制语言 用户权限控制 grant、revoke</strong> </p><h4 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h4><h5 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">-- 创建用户 create user 用户名 identified by &#x27;密码&#x27;</span><br><span class="line">create user xh identitied by &#x27;a&#x27;;</span><br><span class="line">-- 修改密码</span><br><span class="line">set password = password(&#x27;123321&#x27;);</span><br><span class="line">-- 修改密码（修改指定用户密码）</span><br><span class="line">set password from xh = password(&#x27;a&#x27;);</span><br><span class="line">-- 重命名</span><br><span class="line">rename user 原来名 to 新名字;</span><br><span class="line">-- 用户授权</span><br><span class="line">-- all privileges 除了给别人授权，其他都能干</span><br><span class="line">grant all privileges on *.* to xh;</span><br><span class="line">-- 查询权限</span><br><span class="line">show grant for xh ; -- 查看指定用户的权限</span><br><span class="line">show grant for root@loaclhost</span><br><span class="line">-- root用户权限：Grant all privileges on *.* to &#x27;root&#x27;@&#x27;localhost&#x27; with grant option </span><br><span class="line">Grant all privileges on *.* to &#x27;root&#x27;@&#x27;localhost&#x27; with grant option </span><br><span class="line">-- 撤销权限 revoke 哪些权限，在哪个库撤销，给谁撤销</span><br><span class="line">revoke all privileges on *.* from xh;</span><br><span class="line">-- 删除用户</span><br><span class="line">drop user xh;</span><br></pre></td></tr></table></figure><h4 id="MYSQL备份"><a href="#MYSQL备份" class="headerlink" title="MYSQL备份"></a>MYSQL备份</h4><p>为啥要备份：</p><ul><li><p>保证重要数据不丢失。</p></li><li><p>数据转移。</p></li></ul><p>MYSQL数据库备份的方式：</p><ul><li>直接拷贝物理文件</li><li>在可视化编辑器中手动导出</li><li>使用命令行导出  mysqldump  命令行导出。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导出数据库，windows或者linux导出</span></span><br><span class="line"><span class="comment"># -p 后密码 ，数据库名 ，表名 &gt;D:/文件名.sql</span></span><br><span class="line">mysqldump -hlocalhost -uroot -pa <span class="built_in">test</span> test1 &gt;D:/a.sql</span><br><span class="line"><span class="comment"># 导入数据库</span></span><br><span class="line">mysql -uroot -pa 库名 &lt; 备份文件</span><br><span class="line"></span><br><span class="line">use <span class="built_in">test</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> d:/文件名.sql;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="数据库规范"><a href="#数据库规范" class="headerlink" title="数据库规范"></a>数据库规范</h4><h5 id="为啥需要设计？"><a href="#为啥需要设计？" class="headerlink" title="为啥需要设计？"></a>为啥需要设计？</h5><p>==当数据库比较复杂的时候，我们需要设计==</p><p>一个糟糕的数据库设计：</p><ul><li>存在数据沉余，浪费空间</li><li>数据插入和删除都会比较麻烦，异常【屏蔽使用物理外键】</li><li>程序的性能很差</li></ul><p>良好的数据库设计：</p><ul><li>节省内存空间。</li><li>保证数据库的完整性。</li><li>方便我们进行开发。</li></ul><p>软件开发中，关于数据库设计</p><ul><li>分析需求：分析业务和需要处理的数据库的需求。</li><li>概要设计：设计关系图E-R图。</li></ul><p>用个人博客：</p><ul><li>收集用户信息：<ul><li>用户表（用户登录注册，用户信息，写博客，创建分类）</li><li>分类表（类型编号，类型名，类型图片）</li><li>文章表(文章id,文章名，文章类型，文章内容，作者)</li><li>友链表（）</li><li>自定义表（）</li></ul></li></ul><h4 id="三大范式"><a href="#三大范式" class="headerlink" title="三大范式"></a>三大范式</h4><p>为什么需要数据规范化</p><ul><li>信息重复</li><li>更新异常</li><li>插入异常<ul><li>无法正常显示信息</li></ul></li><li>删除异常<ul><li>丢失有效的信息</li></ul></li></ul><blockquote><p>三大范式</p></blockquote><p>​    第一范式：保证原子性，也就是每一列都不可再分。</p><p>​    第二范式：必须先满足第一范式，然后才能判断是否满足第二范式，确保==每张表只干一件事==</p><p>​    </p><p>​    第三范式：确保满足第二范式的基础下，确保每张表每一列的数据都和主键直接相关，而不是间接相关。</p><p><strong>规范性和性能问题</strong></p><p>关联查询的表不得超过三张表</p><ul><li>在考虑商业化的需求和目标（成本和用户体验！）数据库的性能更加重要</li><li>在规范性能问题的时候，需要适当考虑一下规范性。</li><li>故意给某些表增加一些冗余的字段（从多表查询中变为单表查询，问就是增快查询数据呗）</li><li>故意增加一些计算列（从大数据量降为小数据量：索引）。</li></ul><h4 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h4><p>连接数据库的一个包，可以通过这个包，我们通过包提供的封装类，完成连接数据库指令操作。</p><p>创建一个JDBC</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 连接mysql</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBC</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String [] args)</span> <span class="keyword">throws</span> ClassNotFoundException&#123;</span><br><span class="line">        <span class="comment">//1加载驱动</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);<span class="comment">//固定语法，加载驱动，注意mysql5.0和8.0直接驱动连接有差别.5.0的不需要有cj，也就是com.mysql.jdbc.Driver,但是8.0的是com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2用户信息，url</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/数据库名？useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=true&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>; </span><br><span class="line">        <span class="comment">//3连接成功,数据库对象 Connection 代表数据库</span></span><br><span class="line">       <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(url,username,password); </span><br><span class="line">        <span class="comment">//4执行sql对象  Statement 执行sql对象的</span></span><br><span class="line">     <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();   </span><br><span class="line">        <span class="comment">//执行sql对象去执行sql的可能存在的结果</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;你要写的sql语句&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="type">ResuletSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> statement.executeQuery(sql);<span class="comment">//返回结果集，结果集中封装了我们全部查询出来的结果</span></span><br><span class="line">        <span class="keyword">while</span>(resultSet.next())&#123;</span><br><span class="line">            <span class="comment">//以下全为表中的列字段</span></span><br><span class="line">            System.out.println(<span class="string">&quot;id= &quot;</span> resultSet.getObject(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">               System.out.println(<span class="string">&quot;name= &quot;</span> resultSet.getObject(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">               System.out.println(<span class="string">&quot;pwd= &quot;</span> resultSet.getObject(<span class="string">&quot;pwd&quot;</span>));</span><br><span class="line">               System.out.println(<span class="string">&quot;email= &quot;</span> resultSet.getObject(<span class="string">&quot;email&quot;</span>));</span><br><span class="line">               System.out.println(<span class="string">&quot;birth= &quot;</span> resultSet.getObject(<span class="string">&quot;brithday&quot;</span>));</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">                <span class="comment">//释放连接，关闭。</span></span><br><span class="line">        resultSet.close();</span><br><span class="line">        statement.close();</span><br><span class="line">        connection.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>步骤总结：</p><ol><li>加载驱动</li><li>连接数据库DriverManager</li><li>获取执行sql的对象Statement</li><li>返回获得的结果集（list）</li><li>释放连接</li></ol><blockquote><p>DriverManager</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">   <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(url,username,password);<span class="comment">//连接数据库</span></span><br><span class="line"><span class="comment">//事务以及自动提交都可以通过这个操作</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>Url</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/数据库名?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=true&quot;</span>;</span><br><span class="line"><span class="comment">// mysql 3306 </span></span><br><span class="line"><span class="comment">// jdbc:mysql://主机地址：端口号/数据库名？参数1&amp;参数2.。。。</span></span><br><span class="line"><span class="comment">//oracle 1521</span></span><br><span class="line"><span class="comment">//jdbc:oracle:thin:@localhost:1521:表名？</span></span><br></pre></td></tr></table></figure><blockquote><p>Statement</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//4执行sql对象  Statement 执行sql对象的</span></span><br><span class="line">    <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();   </span><br><span class="line">statement.executeQuery();<span class="comment">// 查询操作返回ResultSet</span></span><br><span class="line">statement.execute();<span class="comment">//执行任何Sql</span></span><br><span class="line">statement.executeUpdate()；<span class="comment">//更新，插入删除，都是通过这个。</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>ResultSet查询的结果集：封装了所有的查询结果</p></blockquote><p>获得指定的数据类型</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="type">ResuletSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> statement.executeQuery(sql);<span class="comment">//返回结果集，结果集中封装了我们全部查询出来的结果</span></span><br><span class="line"><span class="comment">//如果不知道列类型的话我们就使用</span></span><br><span class="line">resultSet.getObject();</span><br><span class="line"><span class="comment">//知道的话</span></span><br><span class="line">resultSet.getString();</span><br><span class="line">resultSet.getInt();</span><br><span class="line">resultSet.getFloat();</span><br><span class="line">....</span><br></pre></td></tr></table></figure><p>遍历指针</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">resultSet.beforeFirst();<span class="comment">//移动到最前边</span></span><br><span class="line">resultSet.afterLast();<span class="comment">//移动到最后边</span></span><br><span class="line">resultSet.next();<span class="comment">//移动到下一个数据</span></span><br><span class="line">resultSet.previous();<span class="comment">//移动到前一行</span></span><br><span class="line">resultSet.absolute(row)；<span class="comment">//移动到指定行</span></span><br></pre></td></tr></table></figure><blockquote><p>释放资源:必须要做的</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">resultSet.close();</span><br><span class="line">statement.close();</span><br><span class="line">connection.close();</span><br></pre></td></tr></table></figure><h5 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h5><p>创建一个JDBC链接的工具类（oracle）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSetMetaData;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DBHelper</span> &#123;</span><br><span class="line"><span class="comment">//加载成功，在整个程序中，只需要加载在一次就好了</span></span><br><span class="line">    <span class="comment">//放到静态快里边：因为静态快，自动执行，并且只执行一次</span></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Class.forName(MyProperties.getInstance().getProperty(<span class="string">&quot;driverClass&quot;</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;<span class="comment">//静态方法，可以不实例化，而直接调用</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取连接这一段代码，太长了，对此我们封装一下</span></span><br><span class="line"><span class="keyword">public</span> Connection <span class="title function_">getCon</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="comment">//在这里，连接地址，用户名，和密码，对于不同的用户，可能不一样</span></span><br><span class="line"><span class="comment">//我们可以将这个三个东西，作为配置项，配置到程序中</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">conn = DriverManager.getConnection(MyProperties.getInstance().getProperty(<span class="string">&quot;url&quot;</span>),</span><br><span class="line">MyProperties.getInstance());</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> conn;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 增删改</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sql 要执行的语句</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params 要注入的参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">doUpdate</span><span class="params">(String sql,List&lt;Object&gt; params)</span> &#123;</span><br><span class="line"><span class="comment">//定义返回值</span></span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//获取连接</span></span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> getCon();</span><br><span class="line"><span class="comment">//创建预处理语句对象</span></span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line"><span class="comment">//如果有问号，有参数，要注入参数</span></span><br><span class="line">doParams(ps,params);</span><br><span class="line"><span class="comment">//执行</span></span><br><span class="line">result = ps.executeUpdate();</span><br><span class="line"><span class="comment">//关闭各种连接，接口</span></span><br><span class="line">closeAll(conn,<span class="literal">null</span>,ps);</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//最终返回数据</span></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询语句</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sql</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">findAll</span><span class="params">(String sql,List&lt;Object&gt;params)</span>&#123;</span><br><span class="line">List&lt;Map&lt;String,Object&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Map&lt;String,Object&gt;&gt;();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//获取连接</span></span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> getCon();</span><br><span class="line"><span class="comment">//创建预处理语句对象</span></span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line"><span class="comment">//如果有问号，有参数，要注入参数</span></span><br><span class="line">doParams(ps, params);</span><br><span class="line"><span class="comment">//执行这里开始不一样</span></span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> ps.executeQuery();</span><br><span class="line"><span class="comment">//我们要将resultSet里边的值，转化为List&lt;Map&lt;String,Object&gt;&gt;</span></span><br><span class="line"><span class="comment">//Map&lt;String,Object&gt; 键值对     键  ： 表的字段  值:这个字段对应的值</span></span><br><span class="line"><span class="type">ResultSetMetaData</span> <span class="variable">rsmd</span> <span class="operator">=</span>rs.getMetaData();</span><br><span class="line"><span class="comment">//我们将所有的列名，存到一个数组中</span></span><br><span class="line">String [] cnames = <span class="keyword">new</span> <span class="title class_">String</span> [rsmd.getColumnCount()];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span> ;i&lt;cnames.length;i++) &#123;</span><br><span class="line">cnames[i] = rsmd.getColumnName(i+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//开始获得数据</span></span><br><span class="line"><span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line"><span class="comment">//创建map对象</span></span><br><span class="line">Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;cnames.length;i++) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(rs.getObject(cnames[i])== <span class="literal">null</span>)&#123;</span><br><span class="line">map.put(cnames[i].toLowerCase(), <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;oracle.sql.BLOB&quot;</span>.equals(rs.getObject(cnames[i]).getClass().getName()))&#123;</span><br><span class="line">map.put(cnames[i].toLowerCase(), rs.getBytes(cnames[i]));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">//键  转换为小写     值  </span></span><br><span class="line">map.put(cnames[i].toLowerCase(),rs.getObject(cnames[i]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//将map添加到list中</span></span><br><span class="line">list.add(map);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//关闭</span></span><br><span class="line">closeAll(conn,rs,ps);</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> list;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">findAll</span><span class="params">(String sql,Object...params)</span>&#123;</span><br><span class="line">List&lt;Map&lt;String,Object&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Map&lt;String,Object&gt;&gt;();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//获取连接</span></span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> getCon();</span><br><span class="line"><span class="comment">//创建预处理语句对象</span></span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line"><span class="comment">//如果有问号，有参数，要注入参数</span></span><br><span class="line">doParams(ps, params);</span><br><span class="line"></span><br><span class="line"><span class="comment">//执行这里开始不一样</span></span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> ps.executeQuery();</span><br><span class="line"><span class="comment">//我们要将resultSet里边的值，转化为List&lt;Map&lt;String,Object&gt;&gt;</span></span><br><span class="line"><span class="comment">//Map&lt;String,Object&gt; 键值对     键  ： 表的字段  值:这个字段对应的值</span></span><br><span class="line"><span class="type">ResultSetMetaData</span> <span class="variable">rsmd</span> <span class="operator">=</span>rs.getMetaData();</span><br><span class="line"><span class="comment">//我们将所有的列名，存到一个数组中</span></span><br><span class="line">String [] cnames = <span class="keyword">new</span> <span class="title class_">String</span> [rsmd.getColumnCount()];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span> ;i&lt;cnames.length;i++) &#123;</span><br><span class="line">cnames[i] = rsmd.getColumnName(i+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//开始获得数据</span></span><br><span class="line"><span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line"><span class="comment">//创建map对象</span></span><br><span class="line">Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;cnames.length;i++) &#123;</span><br><span class="line"><span class="comment">// 键          转为小写    值</span></span><br><span class="line"><span class="comment">//对于blob 的值，我们这里要区分一下</span></span><br><span class="line"><span class="keyword">if</span>(rs.getObject(cnames[i])== <span class="literal">null</span>)&#123;</span><br><span class="line">map.put(cnames[i].toLowerCase(), <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//System.out.println(rs.getObject(cnames[i]).getClass().getName());</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;oracle.sql.BLOB&quot;</span>.equals(rs.getObject(cnames[i]).getClass().getName()))&#123;</span><br><span class="line">map.put(cnames[i].toLowerCase(), rs.getBytes(cnames[i]));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">//键  转换为小写     值  </span></span><br><span class="line">map.put(cnames[i].toLowerCase(),rs.getObject(cnames[i]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//将map添加到list中</span></span><br><span class="line">list.add(map);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//注入参数</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doParams</span><span class="params">(PreparedStatement ps, List&lt;Object&gt; params)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(ps != <span class="literal">null</span> &amp;&amp;params!= <span class="literal">null</span>&amp;&amp; params.size()&gt;<span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">//循环注入</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;params.size();i++) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">ps.setObject(i+<span class="number">1</span>, params.get(i));</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//重载                                                                                                                      ...量词参数  代表任意个参数 本质是数组</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doParams</span><span class="params">(PreparedStatement ps, Object...params)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(ps != <span class="literal">null</span> &amp;&amp; params.length&gt;<span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">//循环注入</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;params.length;i++) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">ps.setObject(i+<span class="number">1</span>, params[i]);</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">doUpdate</span><span class="params">(String sql,Object... params)</span> &#123;</span><br><span class="line"><span class="comment">//定义返回值</span></span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//获取连接</span></span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> getCon();</span><br><span class="line"><span class="comment">//创建预处理语句对象</span></span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line"><span class="comment">//如果有问号，有参数，要注入参数</span></span><br><span class="line">doParams(ps,params);</span><br><span class="line"><span class="comment">//执行</span></span><br><span class="line">result = ps.executeUpdate();</span><br><span class="line"><span class="comment">//关闭各种连接，接口</span></span><br><span class="line">closeAll(conn,<span class="literal">null</span>,ps);</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e1) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e1.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//最终返回数据</span></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">closeAll</span><span class="params">(Connection conn, ResultSet rs, PreparedStatement ps)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(conn != <span class="literal">null</span> ) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">conn.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(rs != <span class="literal">null</span> ) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">rs.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(ps != <span class="literal">null</span> ) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">ps.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">      &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="工具类（单例）-Oracle"><a href="#工具类（单例）-Oracle" class="headerlink" title="工具类（单例）(Oracle)"></a>工具类（单例）(Oracle)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProperties</span> <span class="keyword">extends</span> <span class="title class_">Properties</span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> MyProperties myProperties;</span><br><span class="line"></span><br><span class="line"><span class="comment">//构造函数私有化  单例模式</span></span><br><span class="line"><span class="comment">//单例  只有一个实例</span></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">MyProperties</span><span class="params">()</span>&#123;<span class="comment">//装载通过数据流获得的资源配置文件</span></span><br><span class="line"><span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> MyProperties.class.getClassLoader().getResourceAsStream(<span class="string">&quot;db.properties&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//load 装载配置文件  void java.util.Properties.load(InputStream inStream) throws IOException</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.load(is);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//单例模式设计之后 ，一定要有一个公有的方法，让其他对象访问到这个属性</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> MyProperties <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">if</span>( myProperties  == <span class="literal">null</span> )&#123;</span><br><span class="line">myProperties = <span class="keyword">new</span> <span class="title class_">MyProperties</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> myProperties;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="db-properties"><a href="#db-properties" class="headerlink" title="db.properties"></a>db.properties</h5><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#db.properties</span></span><br><span class="line"><span class="attr">driverClass</span>=oracle.jdbc.OracleDriver</span><br><span class="line"><span class="attr">url</span>=jdbc:oracle:thin:@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">1521</span>:orcl</span><br><span class="line"><span class="attr">user</span>=scott</span><br><span class="line"><span class="attr">password</span>=a</span><br><span class="line"></span><br><span class="line"><span class="comment">#mysql连接方式</span></span><br><span class="line"><span class="comment">#driverClass=com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="comment">#url=jdbc:mysql://127.0.0.1:3306/res</span></span><br><span class="line"><span class="comment">#user=root</span></span><br><span class="line"><span class="comment">#password=a</span></span><br></pre></td></tr></table></figure><h5 id="工具类（Mysql-DBHelper）"><a href="#工具类（Mysql-DBHelper）" class="headerlink" title="工具类（Mysql,DBHelper）"></a>工具类（Mysql,DBHelper）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装  数据库操作的工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 38929</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>  2021年5月29日 下午4:43:06</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DBHelper</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置信息</span></span><br><span class="line"><span class="comment">//ORACLE</span></span><br><span class="line"><span class="comment">//private static String driverClassName = &quot;oracle.jdbc.driver.OracleDriver&quot;;</span></span><br><span class="line"><span class="comment">//private String url = &quot;jdbc:oracle:thin:@localhost:1521:ORCL&quot;;</span></span><br><span class="line"><span class="comment">//private String user = &quot;scott&quot;;</span></span><br><span class="line"><span class="comment">//private String password = &quot;a&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//MySQL</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//相关对象</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//连接对象</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">PreparedStatement</span> <span class="variable">pstmt</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//预编译</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//结果集</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//只在类中第一次加载才执行 且 执行一次      -&gt;   当使用JNDI连接数据库时  可以注释该静态加载 </span></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line"><span class="comment">//2、加载并注册依赖oracle.jdbc.driver.OracleDriver.class</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Class.forName( ReadConfig.getInstance().getProperty(<span class="string">&quot;driverClassName&quot;</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//建立连接</span></span><br><span class="line"><span class="keyword">private</span> Connection <span class="title function_">getConn</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//3、建立连接     url  uname  pwd</span></span><br><span class="line"><span class="comment">//url 统一资源定位符   jdbc:oracle:thin:@数据库的IP地址:1521:实例名    127.0.0.1 | localhost:1521:ORCL </span></span><br><span class="line"><span class="comment">//ctrl 1 + 2 -&gt; L</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//conn = DriverManager.getConnection(&quot;jdbc:oracle:thin:@localhost:1521:ORCL&quot;, &quot;scott&quot;, &quot;a&quot;);</span></span><br><span class="line">conn = DriverManager.getConnection(ReadConfig.getInstance().getProperty(<span class="string">&quot;url&quot;</span>), ReadConfig.getInstance());</span><br><span class="line"></span><br><span class="line"><span class="comment">//从服务器 context.xml 中 上下文获取配置的DataSource  </span></span><br><span class="line"><span class="comment">//Context context= new InitialContext();</span></span><br><span class="line"><span class="comment">//从命名目录接口中根据资源名查询  前面 java:comp/env/blog 固定的   类似于协议</span></span><br><span class="line"><span class="comment">//DataSource dataSource =  (DataSource)context.lookup(&quot;java:comp/env/blog&quot;);</span></span><br><span class="line"><span class="comment">//从数据库连接池获取一个空闲的连接 </span></span><br><span class="line"><span class="comment">//conn = dataSource.getConnection();</span></span><br><span class="line"><span class="comment">/*&#125; catch (NamingException e) &#123;</span></span><br><span class="line"><span class="comment">e.printStackTrace();*/</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> conn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 关闭资源</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> rs</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pstmt</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> conn</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unused&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">closeAll</span><span class="params">(ResultSet rs, PreparedStatement pstmt, Connection conn)</span> &#123;</span><br><span class="line"><span class="comment">//7、关闭资源  先开启的后关闭  后开启的先关闭  结果集 -&gt; 语句块 -&gt; 连接</span></span><br><span class="line"><span class="keyword">if</span>( rs != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">rs.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>( pstmt != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">pstmt.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>( conn != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">conn.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新操作   Object ... params  不定参数   类似于数组  万物皆对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sql  要执行的更新语句   可以 insert update delete </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params 要执行的SQL语句中的占位符？ 所对应参数的值 </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(String sql, Object ... params)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> -<span class="number">1</span>;<span class="comment">//定义默认的范围值</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">conn = <span class="built_in">this</span>.getConn();<span class="comment">//获取连接</span></span><br><span class="line">pstmt = conn.prepareStatement(sql);<span class="comment">//预编译对象装载SQL</span></span><br><span class="line"><span class="built_in">this</span>.setParams(pstmt, params);<span class="comment">//需要给占位符注入参数</span></span><br><span class="line">result = pstmt.executeUpdate();<span class="comment">//执行更新语句</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 给预编译语句块中占位符 赋值 设置参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pstmt   预编译对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params  要执行的SQL语句中的占位符？ 所对应参数的值 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setParams</span><span class="params">(PreparedStatement pstmt, Object ... params)</span> &#123;</span><br><span class="line"><span class="comment">//去空判断  说明没有参数给我   也就是执行的SQL语句中没有占位符</span></span><br><span class="line"><span class="keyword">if</span>( <span class="literal">null</span> == params || params.length &lt;= <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//有参数 则循环参数  给预编译语句块中占位符 赋值</span></span><br><span class="line"><span class="comment">//先获取参数的长度  节省资源 提高性能</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, len = params.length; i &lt; len; i++) &#123;</span><br><span class="line"><span class="comment">//我不清楚占位符 对应的详细数据类型    万物皆对象</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">pstmt.setObject( i + <span class="number">1</span>, params[i]);<span class="comment">// % +v+ %</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="comment">//项目可以使用日志来记录</span></span><br><span class="line">System.out.println(<span class="string">&quot;第&quot;</span> + (i+<span class="number">1</span>) + <span class="string">&quot;个参数注值失败...&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 单条查询 返回一条记录   select * from userinfo where user_name = ? and user_pwd = ?</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sql  查询SQL  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params 查询参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> map  一条记录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">findSingle</span><span class="params">(String sql, Object ... params)</span>&#123;</span><br><span class="line">Map&lt;String, Object&gt; map = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">conn = <span class="built_in">this</span>.getConn();<span class="comment">//获取连接</span></span><br><span class="line">pstmt = conn.prepareStatement(sql);<span class="comment">//预编译对象装载SQL</span></span><br><span class="line"><span class="built_in">this</span>.setParams(pstmt, params);<span class="comment">//需要给占位符注入参数</span></span><br><span class="line">rs = pstmt.executeQuery();<span class="comment">//执行更新语句</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//现获取所有的列名</span></span><br><span class="line">List&lt;String&gt; columnNames = <span class="built_in">this</span>.getAllColumnNames(rs);</span><br><span class="line"><span class="keyword">if</span>( rs.next()) &#123; <span class="comment">//处理结果集</span></span><br><span class="line">map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line"><span class="comment">//map.put(&quot;user_id&quot;, rs.getInt(&quot;user_id&quot;));</span></span><br><span class="line"><span class="comment">//map.put(&quot;user_name&quot;, rs.getString(&quot;user_name&quot;));</span></span><br><span class="line"><span class="comment">//map.put(&quot;user_pwd&quot;, rs.getString(&quot;user_pwd&quot;));</span></span><br><span class="line"><span class="comment">//如果换了查询的表  还会有这些列吗？  select * from emp; </span></span><br><span class="line"><span class="comment">//如何查询表所对应各个列的名称？  请去API 先行查看 rs.getMetaData()</span></span><br><span class="line"></span><br><span class="line"><span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//列所对应的值</span></span><br><span class="line"><span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;<span class="comment">//列所对应的值的类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//增强for</span></span><br><span class="line"><span class="keyword">for</span>(String columnName : columnNames) &#123;</span><br><span class="line"><span class="comment">//列对应的类型不确定</span></span><br><span class="line"><span class="comment">//map.put(columnName, rs.getObject(columnName));</span></span><br><span class="line">value = rs.getObject(columnName);</span><br><span class="line"><span class="comment">//判空</span></span><br><span class="line"><span class="keyword">if</span>( <span class="literal">null</span> == value) &#123;</span><br><span class="line">map.put(columnName, value);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">type = value.getClass().getName(); <span class="comment">//获取类型</span></span><br><span class="line"><span class="comment">//System.out.println(type); //oracle.sql.BLOB   java.math.BigDecimal</span></span><br><span class="line"><span class="comment">//判断类型</span></span><br><span class="line"><span class="comment">//TODO 如果是Blob类型 该怎么办 ?  图片的处理？？? 想办法获取对应的数据类型？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;oracle.sql.BLOB&quot;</span>.equals(type)) &#123;</span><br><span class="line"><span class="comment">//获取对应类型数据</span></span><br><span class="line"><span class="type">Blob</span> <span class="variable">blob</span> <span class="operator">=</span> rs.getBlob(columnName);</span><br><span class="line"><span class="comment">//获取对应二进制流操作</span></span><br><span class="line"><span class="keyword">try</span>(<span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> blob.getBinaryStream())&#123;</span><br><span class="line"><span class="type">byte</span> [] bt = <span class="keyword">new</span> <span class="title class_">byte</span>[ (<span class="type">int</span>)blob.length()];</span><br><span class="line">is.read(bt);</span><br><span class="line">map.put(columnName, bt);<span class="comment">//存入字节数组</span></span><br><span class="line">&#125;<span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">map.put(columnName, value);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JDBC2.0 获取所有的列名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> rs</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getAllColumnNames</span><span class="params">(ResultSet rs)</span>&#123;</span><br><span class="line"><span class="comment">//存储列的集合</span></span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//getMetaData() 获取此 ResultSet 对象的列的编号、类型和属性</span></span><br><span class="line"><span class="type">ResultSetMetaData</span> <span class="variable">rsmd</span> <span class="operator">=</span> rs.getMetaData();</span><br><span class="line"><span class="comment">//获取列的数量</span></span><br><span class="line"><span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> rsmd.getColumnCount();</span><br><span class="line"><span class="comment">//列的范围确定 循环</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= count; i++)&#123;</span><br><span class="line"><span class="comment">//获取对应列的列名</span></span><br><span class="line">list.add(rsmd.getColumnName(i).toLowerCase());</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 多行查询 返回多条  select * from emp; </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sql  查询SQL  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params 查询参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> list </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">findMultiple</span><span class="params">(String sql, Object ... params)</span>&#123;</span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Map&lt;String,Object&gt;&gt;();</span><br><span class="line">Map&lt;String, Object&gt; map = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">conn = <span class="built_in">this</span>.getConn();<span class="comment">//获取连接</span></span><br><span class="line">pstmt = conn.prepareStatement(sql);<span class="comment">//预编译对象装载SQL</span></span><br><span class="line"><span class="built_in">this</span>.setParams(pstmt, params);<span class="comment">//需要给占位符注入参数</span></span><br><span class="line">rs = pstmt.executeQuery();<span class="comment">//执行更新语句</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//现获取所有的列名</span></span><br><span class="line">List&lt;String&gt; columnNames = <span class="built_in">this</span>.getAllColumnNames(rs);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>( rs.next()) &#123; <span class="comment">//处理结果集</span></span><br><span class="line">map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line"><span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//列所对应的值</span></span><br><span class="line"><span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;<span class="comment">//列所对应的值的类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//增强for</span></span><br><span class="line"><span class="keyword">for</span>(String columnName : columnNames) &#123;</span><br><span class="line"><span class="comment">//列对应的类型不确定</span></span><br><span class="line"><span class="comment">//map.put(columnName, rs.getObject(columnName));</span></span><br><span class="line">value = rs.getObject(columnName);</span><br><span class="line"><span class="comment">//判空</span></span><br><span class="line"><span class="keyword">if</span>( <span class="literal">null</span> == value) &#123;</span><br><span class="line">map.put(columnName, value);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">type = value.getClass().getName(); <span class="comment">//获取类型</span></span><br><span class="line"><span class="comment">//System.out.println(type); //oracle.sql.BLOB   java.math.BigDecimal</span></span><br><span class="line"><span class="comment">//判断类型</span></span><br><span class="line"><span class="comment">//TODO 如果是Blob类型 该怎么办 ?  图片的处理？？? 想办法获取对应的数据类型？</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;oracle.sql.BLOB&quot;</span>.equals(type)) &#123;</span><br><span class="line"><span class="comment">//获取对应类型数据</span></span><br><span class="line"><span class="type">Blob</span> <span class="variable">blob</span> <span class="operator">=</span> rs.getBlob(columnName);</span><br><span class="line"><span class="comment">//获取对应二进制流操作</span></span><br><span class="line"><span class="keyword">try</span>(<span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> blob.getBinaryStream())&#123;</span><br><span class="line"><span class="type">byte</span> [] bt = <span class="keyword">new</span> <span class="title class_">byte</span>[ (<span class="type">int</span>)blob.length()];</span><br><span class="line">is.read(bt);</span><br><span class="line">map.put(columnName, bt);<span class="comment">//存入字节数组</span></span><br><span class="line">&#125;<span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">map.put(columnName, value);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">list.add(map);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  以对象的方式 将将查询结果返回</span></span><br><span class="line"><span class="comment"> *   c.newInstance() -&gt; new AdminInfo() </span></span><br><span class="line"><span class="comment"> *   m.invoke(obj, value)  激活m方法</span></span><br><span class="line"><span class="comment"> *   获取当前class实例中所有的方法和属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> c</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt; 限定类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sql  查询SQL </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params 注入的参数 </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt;List&lt;T&gt; <span class="title function_">findMultiple</span><span class="params">(Class c,String sql, Object ... params)</span>&#123;</span><br><span class="line">List&lt;T&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;T&gt;();</span><br><span class="line">System.out.println(<span class="number">1111</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">conn = <span class="built_in">this</span>.getConn();<span class="comment">//获取连接</span></span><br><span class="line">pstmt = conn.prepareStatement(sql);<span class="comment">//预编译对象装载SQL</span></span><br><span class="line"><span class="built_in">this</span>.setParams(pstmt, params);<span class="comment">//需要给占位符注入参数</span></span><br><span class="line">rs = pstmt.executeQuery();<span class="comment">//执行更新语句</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//现获取所有的列名</span></span><br><span class="line">List&lt;String&gt; columnNames = <span class="built_in">this</span>.getAllColumnNames(rs);</span><br><span class="line"></span><br><span class="line"><span class="type">T</span> <span class="variable">t</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//声明一个对象</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//列所对应的值</span></span><br><span class="line"><span class="type">String</span> <span class="variable">typeName</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;<span class="comment">//列所对应的值的类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//通过反射来获取类中所有的方法 methods</span></span><br><span class="line">Method [] methods = c.getDeclaredMethods();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>( rs.next()) &#123; <span class="comment">//处理结果集</span></span><br><span class="line"><span class="comment">//创建对象</span></span><br><span class="line">t =  (T)c.newInstance();<span class="comment">//调用无参数的构造方法  AdminInfo admin = new AdminInfo();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//增强for  列</span></span><br><span class="line"><span class="keyword">for</span>(String columnName : columnNames) &#123;</span><br><span class="line"><span class="comment">//列对应的类型不确定</span></span><br><span class="line">value = rs.getObject(columnName);</span><br><span class="line"></span><br><span class="line"><span class="comment">//判空</span></span><br><span class="line"><span class="keyword">if</span>( <span class="literal">null</span> == value) &#123; <span class="comment">// 数据库无数据</span></span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//循环类中所有的方法</span></span><br><span class="line"><span class="keyword">for</span>(Method method : methods) &#123;</span><br><span class="line"><span class="comment">//是否有对应setXXX 方法名   set + columnName -&gt; method的名字</span></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;set&quot;</span> + columnName;</span><br><span class="line"><span class="comment">//获取列对应值的类型</span></span><br><span class="line">typeName = value.getClass().getName();</span><br><span class="line"><span class="comment">//System.out.println( typeName );</span></span><br><span class="line"><span class="comment">//找到对应的方法名</span></span><br><span class="line"><span class="keyword">if</span>( name.equalsIgnoreCase( method.getName())) &#123;</span><br><span class="line"><span class="comment">//判断数据类型</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;java.math.BigDecimal&quot;</span>.equals(typeName)) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">method.invoke( t, rs.getDouble( columnName ));</span><br><span class="line">&#125;<span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">method.invoke( t, rs.getString( columnName ));</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;java.lang.String&quot;</span>.equals(typeName)) &#123;</span><br><span class="line">method.invoke( t, rs.getString( columnName ));</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;java.lang.Double&quot;</span>.equals(typeName)) &#123;</span><br><span class="line">method.invoke( t, rs.getDouble( columnName ));</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;java.lang.Integer&quot;</span>.equals(typeName)) &#123;</span><br><span class="line">method.invoke( t, rs.getInt( columnName ));</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;java.lang.Date&quot;</span>.equals(typeName)) &#123;</span><br><span class="line"><span class="comment">//MySQL 中date 数据类型 转换成JavaBean 对象中使用String </span></span><br><span class="line">method.invoke( t, rs.getString( columnName ));</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;oracle.sql.BLOB&quot;</span>.equals(typeName)) &#123;  <span class="comment">//TODO 如果是Blob类型 该怎么办 ?  图片的处理？？? 想办法获取对应的数据类型？</span></span><br><span class="line"><span class="comment">//获取对应类型数据</span></span><br><span class="line"><span class="type">Blob</span> <span class="variable">blob</span> <span class="operator">=</span> rs.getBlob(columnName);</span><br><span class="line"><span class="comment">//获取对应二进制流操作</span></span><br><span class="line"><span class="keyword">try</span>(<span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> blob.getBinaryStream())&#123;</span><br><span class="line"><span class="type">byte</span> [] bt = <span class="keyword">new</span> <span class="title class_">byte</span>[ (<span class="type">int</span>)blob.length()];</span><br><span class="line">is.read(bt);</span><br><span class="line">method.invoke( t, bt);</span><br><span class="line">&#125;<span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;oracle.sql.CLOB&quot;</span>.equals(typeName))&#123;</span><br><span class="line"><span class="type">Reader</span> <span class="variable">in</span> <span class="operator">=</span> rs.getCharacterStream(columnName);</span><br><span class="line"><span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>( in );</span><br><span class="line"><span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> br.readLine();<span class="comment">//每次读取一行数据</span></span><br><span class="line"><span class="keyword">while</span>( <span class="literal">null</span> != str ) &#123;</span><br><span class="line">sb.append( str );</span><br><span class="line">str = br.readLine();</span><br><span class="line">&#125;</span><br><span class="line">method.invoke( t, sb.toString());</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//TODO 后期需要 自行扩展</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">list.add(t); <span class="comment">//设置对象到list集合中</span></span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;<span class="keyword">catch</span> (InstantiationException | IllegalAccessException | IllegalArgumentException | InvocationTargetException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  以对象的方式 将将查询结果返回</span></span><br><span class="line"><span class="comment"> *   c.newInstance() -&gt; new AdminInfo() </span></span><br><span class="line"><span class="comment"> *   m.invoke(obj, value)  激活m方法</span></span><br><span class="line"><span class="comment"> *   获取当前class实例中所有的方法和属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> c</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt; 限定类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sql  查询SQL </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params 注入的参数 </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">findSingle</span><span class="params">(Class c,String sql, Object ... params)</span>&#123;</span><br><span class="line"><span class="type">T</span> <span class="variable">t</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//声明一个对象</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">conn = <span class="built_in">this</span>.getConn();<span class="comment">//获取连接</span></span><br><span class="line">pstmt = conn.prepareStatement(sql);<span class="comment">//预编译对象装载SQL</span></span><br><span class="line"><span class="built_in">this</span>.setParams(pstmt, params);<span class="comment">//需要给占位符注入参数</span></span><br><span class="line">rs = pstmt.executeQuery();<span class="comment">//执行更新语句</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//现获取所有的列名</span></span><br><span class="line">List&lt;String&gt; columnNames = <span class="built_in">this</span>.getAllColumnNames(rs);</span><br><span class="line"></span><br><span class="line"><span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//列所对应的值</span></span><br><span class="line"><span class="type">String</span> <span class="variable">typeName</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;<span class="comment">//列所对应的值的类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//通过反射来获取类中所有的方法 methods</span></span><br><span class="line">Method [] methods = c.getDeclaredMethods();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( rs.next()) &#123; <span class="comment">//处理结果集</span></span><br><span class="line"><span class="comment">//创建对象</span></span><br><span class="line">t =  (T)c.newInstance();<span class="comment">//调用无参数的构造方法  AdminInfo admin = new AdminInfo();</span></span><br><span class="line"><span class="comment">//增强for  列</span></span><br><span class="line"><span class="keyword">for</span>(String columnName : columnNames) &#123;</span><br><span class="line"><span class="comment">//列对应的类型不确定</span></span><br><span class="line">value = rs.getObject(columnName);</span><br><span class="line"><span class="comment">//判空</span></span><br><span class="line"><span class="keyword">if</span>( <span class="literal">null</span> == value) &#123; <span class="comment">// 数据库无数据</span></span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//循环类中所有的方法</span></span><br><span class="line"><span class="keyword">for</span>(Method method : methods) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//是否有对应setXXX 方法名   set + columnName -&gt; method的名字</span></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;set&quot;</span> + columnName;</span><br><span class="line"><span class="comment">//获取列对应值的类型</span></span><br><span class="line">typeName = value.getClass().getName();</span><br><span class="line"><span class="comment">//System.out.println( name + &quot;--&quot; + typeName );</span></span><br><span class="line"><span class="comment">//找到对应的方法名</span></span><br><span class="line"><span class="keyword">if</span>( name.equalsIgnoreCase( method.getName())) &#123;</span><br><span class="line"><span class="comment">//判断数据类型</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;java.math.BigDecimal&quot;</span>.equals(typeName)) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">method.invoke( t, rs.getDouble( columnName ));</span><br><span class="line">&#125;<span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">method.invoke( t, rs.getString( columnName ));</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;java.lang.String&quot;</span>.equals(typeName)) &#123;</span><br><span class="line">method.invoke( t, rs.getString( columnName ));</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;java.lang.Double&quot;</span>.equals(typeName)) &#123;</span><br><span class="line">method.invoke( t, rs.getDouble( columnName ));</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;java.lang.Integer&quot;</span>.equals(typeName)) &#123;</span><br><span class="line">method.invoke( t, rs.getInt( columnName ));</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;java.lang.Date&quot;</span>.equals(typeName)) &#123;</span><br><span class="line"><span class="comment">//MySQL 中date 数据类型 转换成JavaBean 对象中使用String </span></span><br><span class="line">method.invoke( t, rs.getString( columnName ));</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;oracle.sql.BLOB&quot;</span>.equals(typeName)) &#123;  <span class="comment">//TODO 如果是Blob类型 该怎么办 ?  图片的处理？？? 想办法获取对应的数据类型？</span></span><br><span class="line"><span class="comment">//获取对应类型数据</span></span><br><span class="line"><span class="type">Blob</span> <span class="variable">blob</span> <span class="operator">=</span> rs.getBlob(columnName);</span><br><span class="line"><span class="comment">//获取对应二进制流操作</span></span><br><span class="line"><span class="keyword">try</span>(<span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> blob.getBinaryStream())&#123;</span><br><span class="line"><span class="type">byte</span> [] bt = <span class="keyword">new</span> <span class="title class_">byte</span>[ (<span class="type">int</span>)blob.length()];</span><br><span class="line">is.read(bt);</span><br><span class="line">method.invoke( t, bt);</span><br><span class="line">&#125;<span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;oracle.sql.CLOB&quot;</span>.equals(typeName))&#123;</span><br><span class="line"><span class="type">Reader</span> <span class="variable">in</span> <span class="operator">=</span> rs.getCharacterStream(columnName);</span><br><span class="line"><span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>( in );</span><br><span class="line"><span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> br.readLine();<span class="comment">//每次读取一行数据</span></span><br><span class="line"><span class="keyword">while</span>( <span class="literal">null</span> != str ) &#123;</span><br><span class="line">sb.append( str );</span><br><span class="line">str = br.readLine();</span><br><span class="line">&#125;</span><br><span class="line">method.invoke( t, sb.toString());</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//TODO 后期需要 自行扩展</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;<span class="keyword">catch</span> (InstantiationException | IllegalAccessException | IllegalArgumentException | InvocationTargetException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">total</span><span class="params">(String sql,Object...params)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">conn = <span class="built_in">this</span>.getConn();</span><br><span class="line">pstmt = conn.prepareStatement(sql);</span><br><span class="line"><span class="comment">//设置参数</span></span><br><span class="line">setParams(pstmt,params);</span><br><span class="line"><span class="comment">//执行语句块</span></span><br><span class="line">rs= pstmt.executeQuery();</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理结果集</span></span><br><span class="line"><span class="keyword">if</span>(rs.next()) &#123;</span><br><span class="line">result = rs.getInt(<span class="number">1</span>);<span class="comment">//列索引第一列</span></span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.closeAll(rs, pstmt, conn);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="工具类（mysql-也是单例）"><a href="#工具类（mysql-也是单例）" class="headerlink" title="工具类（mysql,也是单例）"></a>工具类（mysql,也是单例）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReadConfig</span> <span class="keyword">extends</span> <span class="title class_">Properties</span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1560020482133144083L</span>;</span><br><span class="line"><span class="comment">//饿汉单例   提前实例化对�?</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">ReadConfig</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReadConfig</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//构造方法私有化  </span></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">ReadConfig</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//想办法读取自己的配置文件   </span></span><br><span class="line"><span class="comment">//JDK1.7 会自动关闭且�?定关闭资�?   try - with -resources</span></span><br><span class="line"><span class="keyword">try</span>(<span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="built_in">this</span>.getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;db.properties&quot;</span>))&#123;</span><br><span class="line"><span class="comment">//业务代码  流处�? </span></span><br><span class="line"><span class="built_in">this</span>.load(is); <span class="comment">//读取配置文件</span></span><br><span class="line">&#125;<span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//因为构�?�私有化就意味着外部无法实例化该对象 必须对外提供�?个获取实例的方法  并在内部提前实例�? </span></span><br><span class="line"><span class="comment">//又因为外部无法是实例�? 只能通过类名方法 该方�? �?声明为静态的 </span></span><br><span class="line"><span class="keyword">public</span>  <span class="keyword">static</span> ReadConfig <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="db-properties-1"><a href="#db-properties-1" class="headerlink" title="db.properties"></a>db.properties</h5><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#MySQL5</span></span><br><span class="line"><span class="comment">#driverClassName=com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="comment">#url=jdbc:mysql://localhost:3306/blog</span></span><br><span class="line"><span class="comment">#user=root</span></span><br><span class="line"><span class="comment">#password=a</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#MySQL8</span></span><br><span class="line"><span class="attr">driverClassName</span>=com.mysql.cj.jdbc.Driver</span><br><span class="line"></span><br><span class="line"><span class="attr">url</span>=jdbc:mysql://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">3306</span>/数据库?useOldAliasMetadataBehavior=<span class="literal">true</span>&amp;useSSL=<span class="literal">false</span>&amp;useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf8&amp;serverTimezone=GMT%<span class="number">2</span>B8</span><br><span class="line"><span class="attr">user</span>=root</span><br><span class="line"><span class="attr">password</span>=a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Oracle</span></span><br><span class="line"><span class="comment">#driverClassName=oracle.jdbc.driver.OracleDriver</span></span><br><span class="line"><span class="comment">#url=jdbc:oracle:thin:@localhost:1521:orcl</span></span><br><span class="line"><span class="comment">#user=scott</span></span><br><span class="line"><span class="comment">#password=a</span></span><br></pre></td></tr></table></figure><h4 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminInfoDAOImpl</span> <span class="keyword">implements</span> <span class="title class_">IAdminInfoDAO</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> AdminInfo <span class="title function_">login</span><span class="params">(String aname, String pwd)</span> &#123;</span><br><span class="line">         <span class="type">DBHelper</span> <span class="variable">db</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DBHelper</span>();</span><br><span class="line">         <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from admininfo where aname = ? and pwd = md5(?)&quot;</span>;</span><br><span class="line">         <span class="keyword">return</span> db.findSingle(AdminInfo.class,sql,aname,pwd);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(String aname, String pwd, String photo)</span> &#123;</span><br><span class="line"><span class="type">DBHelper</span> <span class="variable">db</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DBHelper</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into admininfo value(0,?,md5(?),?)&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> db.update(sql, aname,pwd,photo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//默认不查询密码 如果需要查询 将来界面渲染密码  必须摘码显示 123456 -&gt; 1***6</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;AdminInfo&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">DBHelper</span> <span class="variable">db</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DBHelper</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select aid,aname,photo from admininfo order by aid desc&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> db.findMultiple(AdminInfo.class, sql);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>==sql注入漏洞也就是sql拼接==</p><p>PreparedStatement：可以预防SQL注入</p><p>上述我们使用的工具类就是使用PreparedStatement来的。</p><p>事务：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新操作   Object ... params  不定参数   类似于数组  万物皆对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sql  要执行的更新语句   可以 insert update delete </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params 要执行的SQL语句中的占位符？ 所对应参数的值 </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(String sql, Object ... params)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> -<span class="number">1</span>;<span class="comment">//定义默认的范围值</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">conn = <span class="built_in">this</span>.getConn();<span class="comment">//获取连接</span></span><br><span class="line"><span class="comment">//开启事务   conn.setAutoCommit(false);</span></span><br><span class="line">pstmt = conn.prepareStatement(sql);<span class="comment">//预编译对象装载SQL</span></span><br><span class="line"><span class="built_in">this</span>.setParams(pstmt, params);<span class="comment">//需要给占位符注入参数</span></span><br><span class="line">result = pstmt.executeUpdate();<span class="comment">//执行更新语句</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//事务提交conn.commit();</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">//如果失败事务提交失败则回滚</span></span><br><span class="line"><span class="comment">/*try &#123;</span></span><br><span class="line"><span class="comment">conn.rollback();</span></span><br><span class="line"><span class="comment">&#125;catch(SQLException e)&#123;</span></span><br><span class="line"><span class="comment">e.printStackTrace();</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="数据库链接池，池化技术"><a href="#数据库链接池，池化技术" class="headerlink" title="数据库链接池，池化技术"></a>数据库链接池，池化技术</h3><p>数据库链接—执行完毕—释放</p><p>连接—释放十分浪费资源</p><p>池化技术：</p><p>准备一些预先的资源，过来就连接预先准备好的</p><p>需要的包下载：<a href="https://blog.csdn.net/qq_51178489/article/details/118805942">https://blog.csdn.net/qq_51178489/article/details/118805942</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mchange.v2.c3p0.ComboPooledDataSource;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbcp2.BasicDataSourceFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCUtils_C3P0</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DataSource dataSource=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//xml数据源直接加载不用反射</span></span><br><span class="line"><span class="comment">//            dataSource= new ComboPooledDataSource();     //无参数时用默认数据源</span></span><br><span class="line">            dataSource=<span class="keyword">new</span> <span class="title class_">ComboPooledDataSource</span>(<span class="string">&quot;MySQL&quot;</span>); <span class="comment">//用配置name=&quot;MySQL&quot;的数据源   也可以datasource.setMaxPoolSize();等</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;     <span class="comment">//提供连接</span></span><br><span class="line">        <span class="keyword">return</span> dataSource.getConnection();         <span class="comment">//数据源中获取连接，自动装好参数比如账号密码url</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">release</span><span class="params">(Connection con, PreparedStatement st, ResultSet re)</span>&#123;   <span class="comment">//提供关闭</span></span><br><span class="line">        <span class="keyword">if</span>(re!=<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                re.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(st!=<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                st.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(con!=<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                con.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c3p0-config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 默认配置，如果没有指定则使用这个配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default-config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>a<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span>&gt;</span>jdbc:mysql://localhost:3306/school<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;checkoutTimeout&quot;</span>&gt;</span>30000<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;idleConnectionTestPeriod&quot;</span>&gt;</span>30<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialPoolSize&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdleTime&quot;</span>&gt;</span>30<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxPoolSize&quot;</span>&gt;</span>100<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minPoolSize&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxStatements&quot;</span>&gt;</span>200<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">default-config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 命名的配置,可以通过方法调用实现 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">named-config</span> <span class="attr">name</span>=<span class="string">&quot;MySQL&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span>&gt;</span>jdbc:mysql://localhost:3306/school<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 如果池中数据连接不够时一次增长多少个 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;acquireIncrement&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 初始化数据库连接池时连接的数量 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialPoolSize&quot;</span>&gt;</span>20<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库连接池中的最大的数据库连接数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxPoolSize&quot;</span>&gt;</span>25<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库连接池中的最小的数据库连接数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minPoolSize&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">named-config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c3p0-config</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">博主对mySQL初步学习的了解，暂时没有深入了解，本文将会持续跟新，并以多文档进行，编程之路很长很长，我得学会边走边看看风景</summary>
    
    
    
    <category term="数据库" scheme="https://www.blog.909111.xyz/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://www.blog.909111.xyz/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>MySQL的常用语句纪录</title>
    <link href="https://www.blog.909111.xyz/posts/a9be6930.html"/>
    <id>https://www.blog.909111.xyz/posts/a9be6930.html</id>
    <published>2023-11-09T02:50:23.335Z</published>
    <updated>2024-04-22T08:16:27.439Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MySQL基础"><a href="#MySQL基础" class="headerlink" title="MySQL基础"></a>MySQL基础</h1><h2 id="MySql基本指令"><a href="#MySql基本指令" class="headerlink" title="MySql基本指令"></a>MySql基本指令</h2><h3 id="1、MySQL常用命令"><a href="#1、MySQL常用命令" class="headerlink" title="1、MySQL常用命令"></a>1、MySQL常用命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 创建数据库</span><br><span class="line">create database name;  </span><br><span class="line">#选择数据库</span><br><span class="line">use databasename;</span><br><span class="line">#直接删除数据库，不提醒</span><br><span class="line">drop database name ;</span><br><span class="line">#显示表</span><br><span class="line">show tables; </span><br><span class="line">#表的详细描述</span><br><span class="line">describe tablename; </span><br><span class="line"></span><br><span class="line">select 中加上distinct去除重复字段</span><br><span class="line"></span><br><span class="line">#删除数据库前，有提示。</span><br><span class="line">mysqladmin drop databasename </span><br><span class="line"></span><br><span class="line">#显示当前mysql版本和当前日期</span><br><span class="line"></span><br><span class="line">select version(),current_date;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2、修改mysql中root的密码："><a href="#2、修改mysql中root的密码：" class="headerlink" title="2、修改mysql中root的密码："></a>2、修改mysql中root的密码：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">shell&gt;</span><span class="language-bash">mysql -u root -p</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">update user <span class="built_in">set</span> password=password(”xueok654123″) <span class="built_in">where</span> user=’root’;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">flush privileges //刷新数据库</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt;</span><span class="language-bash">use dbname； 打开数据库：</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt;</span><span class="language-bash">show databases; 显示所有数据库</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt;</span><span class="language-bash">show tables; 显示数据库mysql中所有的表：先use mysql；然后</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt;</span><span class="language-bash">describe user; 显示表mysql数据库中user表的列信息)；</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3、grant授权"><a href="#3、grant授权" class="headerlink" title="3、grant授权"></a>3、grant授权</h3><p>创建一个可以从任何地方连接服务器的一个完全的超级用户，但是必须使用一个口令something做这个</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant all privileges on *.* to user@localhost identified by ’something’ with</span><br></pre></td></tr></table></figure><p>增加新用户</p><p><strong>格式：grant select on 数据库.* to 用户名@登录主机 identified by “密码”</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON *.* TO monty@localhost IDENTIFIED BY ’something’ WITH GRANT OPTION;</span><br><span class="line">GRANT ALL PRIVILEGES ON . TO monty@”%” IDENTIFIED BY ’something’ WITH GRANT OPTION;</span><br></pre></td></tr></table></figure><p><strong>删除授权：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; revoke all privileges on . from root@”%”;</span><br><span class="line"></span><br><span class="line">mysql&gt; delete from user <span class="built_in">where</span> user=”root” and host=”%”;</span><br><span class="line"></span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>创建一个用户custom在特定客户端it363.com登录，可访问特定数据库fangchandb</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt;grant select, insert, update, delete, create,drop on fangchandb.* to custom@ it363.com identified by ‘ passwd’</span><br></pre></td></tr></table></figure><p><strong>重命名表:</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; alter table t1 rename t2;</span><br></pre></td></tr></table></figure><h3 id="4、mysqldump"><a href="#4、mysqldump" class="headerlink" title="4、mysqldump"></a>4、mysqldump</h3><p><strong>备份数据库</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysqldump -h host -u root -p dbname &gt;dbname_backup.sql</span><br></pre></td></tr></table></figure><p><strong>恢复数据库</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysqladmin -h myhost -u root -p create dbname</span><br><span class="line">shell&gt; mysqldump -h host -u root -p dbname &lt; dbname_backup.sql</span><br></pre></td></tr></table></figure><p><strong>如果只想卸出建表指令，则命令如下：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysqladmin -u root -p -d databasename &gt; a.sql</span><br></pre></td></tr></table></figure><p>如果只想卸出插入数据的sql命令，而不需要建表命令，则命令如下：</p><p>shell&gt; mysqladmin -u root -p -t databasename &gt; a.sql</p><p>那么如果我只想要数据，而不想要什么sql命令时，应该如何操作呢？</p><p>mysqldump -T./ phptest driver</p><p>其中，只有指定了-T参数才可以卸出纯文本文件，表示卸出数据的目录，./表示当前目录，即与mysqldump同一目录。如果不指定driver 表，则将卸出整个数据库的数据。每个表会生成两个文件，一个为.sql文件，包含建表执行。另一个为.txt文件，只包含数据，且没有sql指令。</p><h3 id="5、可将查询存储在一个文件中并告诉mysql从文件中读取查询而不是等待键盘输入。可利用外壳程序键入重定向实用程序来完成这项工作。"><a href="#5、可将查询存储在一个文件中并告诉mysql从文件中读取查询而不是等待键盘输入。可利用外壳程序键入重定向实用程序来完成这项工作。" class="headerlink" title="5、可将查询存储在一个文件中并告诉mysql从文件中读取查询而不是等待键盘输入。可利用外壳程序键入重定向实用程序来完成这项工作。"></a>5、可将查询存储在一个文件中并告诉mysql从文件中读取查询而不是等待键盘输入。可利用外壳程序键入重定向实用程序来完成这项工作。</h3><p>例如，如果在文件my_file.sql 中存放有查询，可如下执行这些查询：</p><p>例如，如果您想将建表语句提前写在sql.txt中:</p><p>mysql &gt; mysql -h myhost -u root -p database &lt; sql.txt</p><p>转 mysql命令</p><h2 id="一-安装与配置MYSQL"><a href="#一-安装与配置MYSQL" class="headerlink" title="一 . 安装与配置MYSQL"></a>一 . 安装与配置MYSQL</h2><p>这个就不说了，一般分为Windows安装和Linux安装</p><h2 id="二-常用mysql命令行命令"><a href="#二-常用mysql命令行命令" class="headerlink" title="二 . 常用mysql命令行命令"></a>二 . 常用mysql命令行命令</h2><p>1 .mysql的启动与停止</p><p>启动MYSQL服务 <code>net start mysql</code></p><p>停止MYSQL服务 <code>net stop mysql</code></p><p>2 .<code>netstat –na | findstr 3306</code> 查看被监听的端口 , findstr用于查找后面的端口是否存在</p><p>3 . 在命令行中登陆MYSQL控制台 , 即使用 <code>MYSQL COMMEND LINE TOOL</code></p><p>语法格式 <code>mysql –user=root –password=123456 db_name</code></p><p>或 <code>mysql –u root –p123456 db_name</code></p><p>4 . 进入MYSQL命令行工具后 , 使用<code>status;</code>或/s 查看运行环境信息</p><p>5 . 切换连接数据库的语法 :<code>use new_dbname;</code></p><p>6 . 显示所有数据库 : <code>show databases;</code></p><p>7 . 显示数据库中的所有表 :<code>show tables;</code></p><p>8 . 显示某个表创建时的全部信息 : <code>show create table table_name;</code></p><p>9 . 查看表的具体属性信息及表中各字段的描述</p><p><code>Describe table_name;</code> 缩写形式 : <code>desc table_name;</code></p><h2 id="三-MySql中的SQL语句"><a href="#三-MySql中的SQL语句" class="headerlink" title="三 . MySql中的SQL语句"></a>三 . MySql中的SQL语句</h2><ol><li><p>数据库创建 : <code>Create database db_name;</code></p><p>数据库删除 : <code>Drop database db_name;</code> 删除时可先判断是否存在，写成 : <code>drop database if exits db_name</code></p></li><li><p>建表 : 创建数据表的语法 :<code>create table table_name (字段1 数据类型 , 字段2 数据类型);</code></p><p>例 : create table mytable (id int , username char(20));</p></li><li><p>删表 :<code>drop table table_name;</code>例 : drop table mytable;</p></li><li><p>添加数据 : <code>Insert into 表名 [(字段1 , 字段2 , ….)] values (值1 , 值2 , …..);</code></p><p>如果向表中的每个字段都插入一个值,那么前面 [ ] 括号内字段名可写也可不写</p><p>例 : insert into mytable (id,username) values (1,’zhangsan’);</p></li><li><p>查询 : 查询所有数据 : <code>select * from table_name;</code></p><p>查询指定字段的数据 :<code>select 字段1 , 字段2 from table_name;</code></p><p>例 : select id,username from mytable where id=1 order by desc;多表查询语句——————参照第17条实例</p></li><li><p>更新指定数据 , 更新某一个字段的数据(注意，不是更新字段的名字)</p></li></ol><p><code>Update table_name set 字段名=’新值’ [, 字段2 =’新值’ , …..][where id=id_num] [order by 字段 顺序]</code></p><p>​    例 : update mytable set username=’lisi’ where id=1;</p><p>​    Order语句是查询的顺序 , 如 : <code>order by id desc(或asc)</code> , 顺序有两种 : desc倒序(100—1,即从最新数据往后查询),asc(从1-100)，Where和order语句也可用于查询select 与删除delete</p><ol><li><p>删除表中的信息 :</p><p>删除整个表中的信息 : <code>delete from table_name;</code></p><p>删除表中指定条件的语句 : <code>delete from table_name where 条件语句 ;</code> 条件语句如 : id=3;</p></li><li><p>创建数据库用户</p><p>一次可以创建多个数据库用户如：</p><p><code>CREATE USER username1 identified BY ‘password’ , username2 IDENTIFIED BY ‘password’….</code></p></li><li><p>用户的权限控制：grant库，表级的权限控制 : 将某个库中的某个表的控制权赋予某个用户</p><p><code>Grant all ON db_name.table_name TO user_name [ indentified by ‘password’ ];</code></p></li><li><p>表结构的修改</p><p>(1)增加一个字段格式：</p><p>​    <code>alter table table_name add column (字段名 字段类型); ----此方法带括号</code></p><p>(2)指定字段插入的位置：</p><p>​    <code>alter table table_name add column 字段名 字段类型 after 某字段；</code></p><p>删除一个字段：</p><p>​    <code>alter table table_name drop字段名;</code></p><p>(3)修改字段名称/类型</p><p>​    <code>alter table table_name change 旧字段名 新字段名 新字段的类型;</code></p><p>(4)改表的名字</p><p>​    <code>alter table table_name rename to new_table_name;</code></p><p>(5)一次性清空表中的所有数据</p><p>​    <code>truncate table table_name; 此方法也会使表中的取号器(ID)从1开始</code></p></li><li><p>增加主键，外键，约束，索引。。。。(使用方法见17实例)</p><p>① <strong>约束(主键Primary key、唯一性Unique、非空Not Null)</strong></p><p>② <strong>自动增张 auto_increment</strong></p><p>③<strong>外键Foreign key——-与reference table_name(col_name列名)配合使用，建表时单独使用</strong></p><p>④ <strong>删除多个表中有关联的数据——设置foreign key 为set null —-具体设置参考帮助文档</strong></p></li><li><p>查看数据库当前引擎</p><p><code>`SHOW CREATE TABLE table_name;</code></p></li><li><p>修改数据库引擎</p><p><code>ALTER TABLE table_name ENGINE=MyISAM | InnoDB;</code></p></li><li><p>SQL语句运用实例:</p><p><strong>—1 建users表</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table users (</span><br><span class="line">id int primary key auto_increment,</span><br><span class="line">nikename varchar(20) not null unique,</span><br><span class="line">password varchar(100) not null,</span><br><span class="line">address varchar(200), </span><br><span class="line">reg_date timestamp not null default CURRENT_TIMESTAMP</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li></ol><pre><code>**--2 建articles表,在建表时设置外键**<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table articles (</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    content longtext not null,</span><br><span class="line">    userid int,</span><br><span class="line">    constraint foreign key (userid) references users(id) on delete set null</span><br><span class="line">);</span><br></pre></td></tr></table></figure>​    **--2.1 建articles表,建表时不设置外键**<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table articles (</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    content longtext not null,</span><br><span class="line">    userid int</span><br><span class="line">);</span><br></pre></td></tr></table></figure>​    -**-2.2 给articles表设置外键**​    `alter table articles add constraint foreign key (userid) references users(id) on delete set null;`**--3. 向users表中插入数据,同时插入多条**`insert into users (id,nikename,password,address) values (1,&#39;lyh1&#39;,&#39;1234&#39;,null),(10,&#39;lyh22&#39;,&#39;4321&#39;,&#39;湖北武汉&#39;),(null,&#39;lyh333&#39;,&#39;5678&#39;, &#39;北京海淀&#39;);`</code></pre><p>​    <strong>—4. 向article中插入三条数据</strong></p><p>​    <code>insert into articles (id,content,userid) values (2,&#39;hahahahahaha&#39;,11),(null,&#39;xixixixixix&#39;,10),(13,&#39;aiaiaiaiaiaiaiaiaiaiaiaia&#39;,1),(14,&#39;hohoahaoaoooooooooo&#39;,10);</code></p><p>​    <strong>—5. 进行多表查询，选择users表中ID=10的用户发布的所有留言及该用户的所有信息</strong></p><p>​    <code>select articles.id,articles.content,users.* from users,articles where users.id=10 and articles.userid=users.id order by articles.id desc;</code></p><p>​    <strong>—6. 查看数据库引擎类型</strong></p><p>​    <code>show create table users;</code></p><p>​    <strong>—7. 修改数据库引擎类型</strong></p><p>​    <code>alter table users engine=MyISAM;</code>—-因为users表中ID被设置成外键，执行此句会出错</p><p>​    -<strong>-8. 同表查询,已知一个条件的情况下.查询ID号大于用户lyh1的ID号的所有用户</strong></p><p>​    <code>select a.id,a.nikename,a.address from users a,users b where b.nikename=&#39;lyh1&#39; and a.id&gt;b.id;</code></p><p>​    ———也可写成</p><p>​    <code>select id,nikename,address from users where id&gt;(select id from users where nikename=&#39;lyh1&#39;);</code></p><h3 id="习题："><a href="#习题：" class="headerlink" title="习题："></a>习题：</h3><ol><li><strong>显示年龄比领导还大的员工：</strong></li></ol><p><code>select a.name from users a,users b where a.managerid=b.id and a.age&gt;b.age;</code></p><ol><li><p><strong>查询编号为2的发帖人: 先查articles表,得到发帖人的编号,再根据编号查users得到的用户名。</strong></p><p><strong>接着用关联查询.</strong></p><ol><li><code>select * from articles,users</code>得到笛卡儿积,再加<code>order by articles.id</code>以便观察</li><li>使用<code>select * from articles,users where articles.id=2</code> 筛选出2号帖子与每个用户的组合记录</li><li>再使用<code>select * from articles,users where articles.id=2 and articles.userid=users.id</code>选出users.id等于2号帖的发帖人id的记录.</li><li>只取用户名:select user where user.id=(select userid from articles where article.id =2)</li></ol></li><li><p><strong>找出年龄比小王还大的人:假设小王是28岁,先想找出年龄大于28的人</strong></p><p><code>select * from users where age&gt;(select age from users where name=&#39;xiaowang&#39;);</code></p></li></ol><p>   <strong>要查询的记录需要参照表里面的其他记录:</strong></p><p><code>select a.name from users a,users b where b.name=&#39;xiaowang&#39; and a.age&gt;b.age</code></p><p>表里的每个用户都想pk一下.<code>select a.nickname,b.nickname from users a,users b where a.id&gt;b.id ;</code></p><p>更保险的语句:<code>select a.nickname,b.nickname from (select * from users order by id) a,(select * from users order by id) b where a.id&gt;b.id ;</code></p><p>再查询某个人发的所有帖子.</p><p><code>select b.* from articles a , articles b where a.id=2 and a.userid=b.userid</code></p><p>说明: 表之间存在着关系，ER概念的解释，用access中的示例数据库演示表之间的关系.<strong>只有innodb引擎才支持foreign key，mysql的任何引擎目前都不支持check约束。</strong></p><h2 id="四-字符集出现错误解决办法"><a href="#四-字符集出现错误解决办法" class="headerlink" title="四. 字符集出现错误解决办法"></a><strong>四. 字符集出现错误解决办法</strong></h2><p>出现的问题：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update <span class="built_in">users</span></span><br><span class="line">-&gt; <span class="built_in">set</span> username=<span class="string">&#x27;关羽&#x27;</span></span><br><span class="line">-&gt; <span class="built_in">where</span> userid=2;</span><br><span class="line"></span><br><span class="line">ERROR 1366 (HY000): Incorrect string value: <span class="string">&#x27;/xB9/xD8/xD3/xF0&#x27;</span> <span class="keyword">for</span> column <span class="string">&#x27;username&#x27;</span> at row 1</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>向表中插入中文字符时，出现错误。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from <span class="built_in">users</span>;</span><br><span class="line">+--------+----------+</span><br><span class="line">| userid | username |</span><br><span class="line">+--------+----------+</span><br><span class="line">| 2 | ???? |</span><br><span class="line">| 3 | ???? |</span><br><span class="line">| 4 | ?í?ù |</span><br><span class="line">+--------+----------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>表中的中文字符位乱码。</p><p>解决办法：</p><p>使用命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; status;</span><br><span class="line">mysql Ver 14.12 Distrib 5.0.45, <span class="keyword">for</span> Win32 (ia32)</span><br><span class="line">Connection <span class="built_in">id</span>: 8</span><br><span class="line">Current database: <span class="built_in">test</span></span><br><span class="line">Current user: root@localhost</span><br><span class="line">SSL: Not <span class="keyword">in</span> use</span><br><span class="line">Using delimiter: ;</span><br><span class="line">Server version: 5.0.45-community-nt MySQL Community Edition (GPL)</span><br><span class="line">Protocol version: 10</span><br><span class="line">Connection: localhost via TCP/IP</span><br><span class="line">Server characterset: latin1</span><br><span class="line">Db characterset: latin1</span><br><span class="line">Client characterset: gbk</span><br><span class="line">Conn. characterset: gbk</span><br><span class="line">TCP port: 3306</span><br><span class="line">Uptime: 7 hours 39 min 19 sec</span><br><span class="line">Threads: 2 Questions: 174 Slow queries: 0 Opens: 57 Flush tables: 1 Open ta</span><br><span class="line">bles: 1 Queries per second avg: 0.006</span><br></pre></td></tr></table></figure><p>查看mysql发现<strong>Server characterset，Db characterset的字符集设成了latin1</strong>，所以出现中文乱码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br><span class="line">+----------------+</span><br><span class="line">| Tables_in_test |</span><br><span class="line">+----------------+</span><br><span class="line">| <span class="built_in">users</span> |</span><br><span class="line">+----------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure><p>更改表的字符集。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table <span class="built_in">users</span> character <span class="built_in">set</span> GBK;</span><br><span class="line">Query OK, 3 rows affected (0.08 sec)</span><br><span class="line">Records: 3 Duplicates: 0 Warnings: 0</span><br></pre></td></tr></table></figure><p>查看表的结构：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show create <span class="built_in">users</span>;</span><br><span class="line"></span><br><span class="line">ERROR 1064 (42000): You have an error <span class="keyword">in</span> your SQL syntax; check the manual that corresponds to your MySQL server version <span class="keyword">for</span> the right syntax to use near <span class="string">&#x27;users&#x27;</span> at line 1</span><br><span class="line">mysql&gt; show create table <span class="built_in">users</span>;</span><br><span class="line"></span><br><span class="line">| Table | Create Table|| <span class="built_in">users</span> | </span><br><span class="line">CREATE TABLE <span class="built_in">users</span> (</span><br><span class="line">userid int(11) default NULL,</span><br><span class="line">username char(20) character <span class="built_in">set</span> latin1 default NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=gbk |</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; desc <span class="built_in">users</span>;</span><br><span class="line"></span><br><span class="line">+----------+----------+------+-----+---------+-------+</span><br><span class="line">| Field | Type | Null | Key | Default | Extra |</span><br><span class="line">+----------+----------+------+-----+---------+-------+</span><br><span class="line">| userid | int(11) | YES | | NULL | |</span><br><span class="line">| username | char(20) | YES | | NULL | |</span><br><span class="line">+----------+----------+------+-----+---------+-------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.02 sec)</span><br></pre></td></tr></table></figure><p>这时向表中插入中文然后有错误。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into <span class="built_in">users</span> values(88,<span class="string">&#x27;中文&#x27;</span>);</span><br><span class="line"></span><br><span class="line">ERROR 1366 (HY000): Incorrect string value: <span class="string">&#x27;/xD6/xD0/xCE/xC4&#x27;</span> <span class="keyword">for</span> column <span class="string">&#x27;username&#x27;</span> at row 1</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into <span class="built_in">users</span> values(88,<span class="string">&#x27;中文&#x27;</span>);</span><br><span class="line">ERROR 1366 (HY000): Incorrect string value: <span class="string">&#x27;/xD6/xD0/xCE/xC4&#x27;</span> <span class="keyword">for</span> column <span class="string">&#x27;username&#x27;</span> at row 1</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>还要更改users表的username的字符集。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table <span class="built_in">users</span> modify username char(20) character <span class="built_in">set</span> gbk;</span><br><span class="line"></span><br><span class="line">ERROR 1366 (HY000): Incorrect string value: <span class="string">&#x27;/xC0/xEE/xCB/xC4&#x27;</span> <span class="keyword">for</span> column <span class="string">&#x27;username&#x27;</span> at row 1</span><br><span class="line"></span><br><span class="line">mysql&gt; alter table <span class="built_in">users</span> modify username char(20) character <span class="built_in">set</span> gbk;</span><br><span class="line"></span><br><span class="line">ERROR 1366 (HY000): Incorrect string value: <span class="string">&#x27;/xC0/xEE/xCB/xC4&#x27;</span> <span class="keyword">for</span> column <span class="string">&#x27;username&#x27;</span> at row 1</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>因为表中已经有数据，所以更改username字符集的操作没有成功</p><p>清空users表中的数据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="built_in">truncate</span> table <span class="built_in">users</span>;</span><br><span class="line">Query OK, 3 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure><p>重新更改user表中username的字符集</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table <span class="built_in">users</span> modify username char(20) character <span class="built_in">set</span> gbk;</span><br><span class="line"></span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br></pre></td></tr></table></figure><p>这时再插入中文字符，插入成功。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into <span class="built_in">users</span> values(88,<span class="string">&#x27;中文&#x27;</span>);</span><br><span class="line"></span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line">mysql&gt; select * from <span class="built_in">users</span>;</span><br><span class="line">+--------+----------+</span><br><span class="line">| userid | username |</span><br><span class="line">+--------+----------+</span><br><span class="line">| 88 | 中文 |</span><br><span class="line">+--------+----------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line">mysql&gt;<span class="built_in">exit</span>;</span><br></pre></td></tr></table></figure><p><strong>学习MySQL常用操作命令</strong></p><p><strong>1、启动MySQL服务器</strong></p><p>实际上上篇已讲到如何启动MySQL。两种方法： <strong>一是用winmysqladmin，如果机器启动时已自动运行，则可直接进入下一步操作。 二是在DOS方式下运行 d:mysqlbinmysqld</strong></p><p><strong>2、进入mysql交互操作界面</strong></p><p>在DOS方式下，运行： <code>d:mysqlbinmysql</code></p><p>出现: mysql 的提示符，此时已进入mysql的交互操作方式。</p><p>如果出现 “ERROR 2003: Can′t connect to MySQL server on ′localhost′ (10061)“，</p><p>说明你的MySQL还没有启动。</p><p><strong>3、退出MySQL操作界面</strong></p><p>在mysql&gt;提示符下输入quit可以随时退出交互操作界面：</p><p><code>mysql&gt; quit</code></p><p>Bye</p><p>你也可以用control-D退出。</p><p><strong>4、第一条命令</strong></p><p><code>mysql&gt; select version(),current_date();</code></p><p>+————————+————————-+</p><p>| version() | current_date() |</p><p>+————————+————————-+</p><p>| 3.23.25a-debug | 2001-05-17 |</p><p>+————————+————————-+</p><p>1 row in set (0.01 sec)</p><p>mysql&gt;</p><p>此命令要求mysql服务器告诉你它的版本号和当前日期。尝试用不同大小写操作上述命令，看结果如何。结果说明mysql命令的大小写结果是一致的。</p><p>练习如下操作：</p><p><code>mysql&gt;Select (20+5)*4;</code></p><p><code>mysql&gt;Select (20+5)*4,sin(pi()/3);</code></p><p><code>mysql&gt;Select (20+5)*4 AS Result,sin(pi()/3);</code> (AS: 指定假名为Result)</p><p><strong>5、多行语句</strong></p><p>一条命令可以分成多行输入，直到出现分号“；”为止：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> mysql&gt; select</span><br><span class="line">-&gt; USER()</span><br><span class="line">-&gt; ,</span><br><span class="line">-&gt; now()</span><br><span class="line">-&gt;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+--------------------+---------------------+</span><br><span class="line">| USER() | now() |</span><br><span class="line">+--------------------+---------------------+</span><br><span class="line">| ODBC@localhost | 2001-05-17 22:59:15 |</span><br><span class="line">+--------------------+---------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.06 sec)</span><br><span class="line">mysql&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>注意中间的逗号和最后的分号的使用方法。</p><p><strong>6、一行多命令</strong></p><p>输入如下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT USER(); SELECT NOW();</span><br><span class="line">+------------------+</span><br><span class="line">| USER() |</span><br><span class="line">+------------------+</span><br><span class="line">| ODBC@localhost |</span><br><span class="line">+------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line">+---------------------+</span><br><span class="line">| NOW() |</span><br><span class="line">+---------------------+</span><br><span class="line">| 2001-05-17 23:06:15 |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure><p>注意中间的分号，命令之间用分号隔开。</p><p><strong>7、显示当前存在的数据库</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+----------+</span><br><span class="line">| Database |</span><br><span class="line">+----------+</span><br><span class="line">| mysql |</span><br><span class="line">| <span class="built_in">test</span> |</span><br><span class="line">+----------+</span><br><span class="line">2 row <span class="keyword">in</span> <span class="built_in">set</span> (0.06 sec)</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure><p><strong>8、选择数据库并显示当前选择的数据库</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; USE mysql</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt;</span><br><span class="line">(USE 和 QUIT 命令不需要分号结束。)</span><br><span class="line">mysql&gt; select database();</span><br><span class="line">±--------------+</span><br><span class="line">| database() |</span><br><span class="line">±--------------+</span><br><span class="line">| mysql |</span><br><span class="line">±--------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure><p><strong>9、显示当前数据库中存在的表</strong></p><p><code>mysql&gt; SHOW TABLES;</code></p><p><strong>10、显示表(db)的内容</strong></p><p><code>mysql&gt;select * from db;</code></p><p><strong>11、命令的取消</strong></p><p>当命令输入错误而又无法改变(多行语句情形)时，只要在分号出现前就可以用 c来取消该条命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select</span><br><span class="line">-&gt; user()</span><br><span class="line">-&gt; c</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure><p>这是一些最常用的最基本的操作命令，通过多次练习就可以牢牢掌捂了</p><p>==========================================================================</p><h2 id="五-mysql命令"><a href="#五-mysql命令" class="headerlink" title="五. mysql命令"></a>五. mysql命令</h2><p>测试环境：mysql 5.0.45</p><p>【注：可以在mysql中通过mysql&gt; SELECT VERSION();来查看数据库版本】</p><p>整理：leo</p><h3 id="一、连接MYSQL。"><a href="#一、连接MYSQL。" class="headerlink" title="一、连接MYSQL。"></a>一、连接MYSQL。</h3><p>格式： <code>mysql -h主机地址 -u用户名 －p用户密码</code></p><h4 id="1、连接到本机上的MYSQL。"><a href="#1、连接到本机上的MYSQL。" class="headerlink" title="1、连接到本机上的MYSQL。"></a><strong>1、连接到本机上的MYSQL。</strong></h4><p>首先打开DOS窗口，然后进入目录mysql/bin，再键入命令<code>mysql -u root -p</code>，回车后提示你输密码.注意用户名前可以有空格也可以没有空格，但是密码前必须没有空格，否则让你重新输入密码.</p><p>如果刚安装好MYSQL，超级用户root是没有密码的，故直接回车即可进入到MYSQL中了，MYSQL的提示符是： mysql&gt;</p><h4 id="2、连接到远程主机上的MYSQL。"><a href="#2、连接到远程主机上的MYSQL。" class="headerlink" title="2、连接到远程主机上的MYSQL。"></a><strong>2、连接到远程主机上的MYSQL。</strong></h4><p>假设远程主机的IP为：110.110.110.110，用户名为root,密码为abcd123。则键入以下命令：</p><p><code>mysql -h110.110.110.110 -u root -p abcd123;</code> (注:u与root之间可以不用加空格，其它也一样)</p><p><strong>3、退出MYSQL命令： exit (回车)</strong></p><h3 id="二、修改密码。"><a href="#二、修改密码。" class="headerlink" title="二、修改密码。"></a><strong>二、修改密码。</strong></h3><p>格式：<code>mysqladmin -u用户名 -p旧密码 password 新密码</code></p><h4 id="1、给root加个密码ab12。"><a href="#1、给root加个密码ab12。" class="headerlink" title="1、给root加个密码ab12。"></a>1、给root加个密码ab12。</h4><p>首先在DOS下进入目录mysql/bin，然后键入以下命令</p><p><code>mysqladmin -u root -password ab12</code></p><p>注：因为开始时root没有密码，所以-p旧密码一项就可以省略了。</p><h4 id="2、再将root的密码改为djg345。"><a href="#2、再将root的密码改为djg345。" class="headerlink" title="2、再将root的密码改为djg345。"></a>2、再将root的密码改为djg345。</h4><p><code>mysqladmin -u root -p ab12 password djg345</code></p><h3 id="三、增加新用户。"><a href="#三、增加新用户。" class="headerlink" title="三、增加新用户。"></a>三、增加新用户。</h3><p>(注意：和上面不同，下面的因为是MYSQL环境中的命令，所以后面都带一个分号作为命令结束符)</p><p>格式：<code>grant select on 数据库.* to 用户名@登录主机 identified by “密码”</code></p><p>1、增加一个用户test1密码为abc，让他可以在任何主机上登录，并对所有数据库有查询、插入、修改、删除的权限。首先用root用户连入MYSQL，然后键入以下命令：</p><p><code>grant select,insert,update,delete on *.* to [email=test1@”%]test1@”%[/email]” Identified by “abc”;</code></p><p><strong>但增加的用户是十分危险的，你想如某个人知道test1的密码，那么他就可以在internet上的任何一台电脑上登录你的mysql数据库并对你的数据可以为所欲为了，解决办法见2。</strong></p><p>2、增加一个用户test2密码为abc,让他只可以在localhost上登录，并可以对数据库mydb进行查询、插入、修改、删除的操作(localhost指本地主机，即MYSQL数据库所在的那台主机)，</p><p>这样用户即使用知道test2的密码，他也无法从internet上直接访问数据库，<strong>只能通过MYSQL主机上的web页来访问了。</strong></p><p><code>grant select,insert,update,delete on mydb.* to [email=test2@localhost]test2@localhost[/email] identified by “abc”;</code></p><p>如果<strong>你不想test2有密码，可以再打一个命令将密码消掉。</strong></p><p><code>grant select,insert,update,delete on mydb.* to [email=test2@localhost]test2@localhost[/email] identified by “”;</code></p><h2 id="六-MYSQL中有关数据库方面的操作。"><a href="#六-MYSQL中有关数据库方面的操作。" class="headerlink" title="六. MYSQL中有关数据库方面的操作。"></a>六. MYSQL中有关数据库方面的操作。</h2><p>注意：你必须首先登录到MYSQL中，以下操作都是在MYSQL的提示符下进行的，而且每个命令以分号结束。</p><h3 id="一、操作技巧"><a href="#一、操作技巧" class="headerlink" title="一、操作技巧"></a>一、操作技巧</h3><p>1、如果你打命令时，回车后发现忘记加分号，你无须重打一遍命令，只要打个分号回车就可以了。也就是说你可以把一个完整的命令分成几行来打，完后用分号作结束标志就OK。</p><p>2、你可以使用光标上下键调出以前的命令。</p><h3 id="二、显示命令"><a href="#二、显示命令" class="headerlink" title="二、显示命令"></a>二、显示命令</h3><p>1、显示当前数据库服务器中的数据库列表：</p><p><code>mysql&gt; SHOW DATABASES;</code></p><p>注意：mysql库里面有MYSQL的系统信息，我们改密码和新增用户，实际上就是用这个库进行操作。</p><p>2、显示数据库中的数据表：</p><p><code>mysql&gt; USE 库名；</code></p><p><code>mysql&gt; SHOW TABLES;</code></p><p>3、显示数据表的结构：</p><p><code>mysql&gt; DESCRIBE 表名;</code></p><p>4、建立数据库：</p><p><code>mysql&gt; CREATE DATABASE 库名;</code></p><p>5、建立数据表：</p><p><code>mysql&gt; USE 库名;</code></p><p><code>mysql&gt; CREATE TABLE 表名 (字段名 VARCHAR(20), 字段名 CHAR(1));</code></p><p>6、删除数据库：</p><p><code>mysql&gt; DROP DATABASE 库名;</code></p><p>7、删除数据表：</p><p><code>mysql&gt; DROP TABLE 表名；</code></p><p>8、将表中记录清空：</p><p><code>mysql&gt; DELETE FROM 表名;</code></p><p>9、显示表中的记录：</p><p><code>mysql&gt; SELECT * FROM 表名;</code></p><p>10、往表中插入记录：</p><p><code>mysql&gt; INSERT INTO 表名 VALUES (”hyq”,”M”);</code></p><p>11、更新表中数据：</p><p><code>mysql-&gt; UPDATE 表名 SET 字段名1=’a&#39;,字段名2=’b’ WHERE 字段名3=’c&#39;;</code></p><p>12、用文本方式将数据装入数据表中：</p><p><code>mysql&gt; LOAD DATA LOCAL INFILE “D:/mysql.txt” INTO TABLE 表名;</code></p><p>13、导入.sql文件命令：</p><p><code>mysql&gt; USE 数据库名;</code></p><p><code>mysql&gt; SOURCE d:/mysql.sql;</code></p><p>14、命令行修改root密码：</p><p><code>mysql&gt; UPDATE mysql.user SET password=PASSWORD(’新密码’) WHERE User=’root’;</code></p><p><code>mysql&gt; FLUSH PRIVILEGES;</code></p><p>15、显示use的数据库名：</p><p><code>mysql&gt; SELECT DATABASE();</code></p><p>16、显示当前的user：</p><p><code>mysql&gt; SELECT USER();</code></p><h3 id="三、一个建库和建表以及插入数据的实例"><a href="#三、一个建库和建表以及插入数据的实例" class="headerlink" title="三、一个建库和建表以及插入数据的实例"></a>三、一个建库和建表以及插入数据的实例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">drop database if exists school; //如果存在SCHOOL则删除</span><br><span class="line">create database school;       //建立库SCHOOL</span><br><span class="line">use school; //打开库SCHOOL</span><br><span class="line"></span><br><span class="line">create table teacher //建立表TEACHER(</span><br><span class="line">id int(3) auto_increment not null primary key,</span><br><span class="line">name char(10) not null,</span><br><span class="line">address varchar(50) default ‘深圳’,</span><br><span class="line">year date</span><br><span class="line">); //建表结束</span><br><span class="line"></span><br><span class="line">//以下为插入字段</span><br><span class="line">insert into teacher values(”,’allen’,&#x27;大连一中’,&#x27;1976-10-10′);</span><br><span class="line">insert into teacher values(”,’jack’,&#x27;大连二中’,&#x27;1975-12-23′);</span><br></pre></td></tr></table></figure><p>如果你在mysql提示符键入上面的命令也可以，但不方便调试。</p><p>​    (1)<strong>你可以将以上命令原样写入一个文本文件中，假设为school.sql，然后复制到c://下，并在DOS状态进入目录[url=file:mysql//bin]//mysql//bin[/url]，然后键入以下命令：</strong></p><p>​    <code>mysql -uroot -p密码 &lt; c://school.sql</code></p><p><strong>如果成功，空出一行无任何显示；如有错误，会有提示。(以上命令已经调试，你只要将//的注释去掉即可使用)。</strong></p><p>(2)或者进入命令行后使用 <code>mysql&gt; source c://school.sql;</code>也可以将school.sql文件导入数据库中。</p><h3 id="四、将文本数据转到数据库中"><a href="#四、将文本数据转到数据库中" class="headerlink" title="四、将文本数据转到数据库中"></a>四、将文本数据转到数据库中</h3><p>1、文本数据应符合的格式：字段数据之间用<strong>tab</strong>键隔开，null值用<code>[url=file:n]//n[/url]</code>来代替.例：</p><p><code>3 rose 大连二中 1976-10-10</code></p><p><code>4 mike 大连一中 1975-12-23</code></p><p><strong>假设你把这两组数据存为school.txt文件，放在c盘根目录下。</strong></p><p>数据传入命令 <code>load data local infile “c://school.txt” into table 表名;</code></p><p>注意：你最好将文件复制到[url=file:mysql//bin]//mysql//bin[/url]目录下，并且要先用use命令打表所在的库。</p><h3 id="五、备份数据库1-导出整个数据库"><a href="#五、备份数据库1-导出整个数据库" class="headerlink" title="五、备份数据库1.导出整个数据库"></a>五、备份数据库1.导出整个数据库</h3><p>导出文件默认是存在mysql/bin目录下</p><p><strong>mysqldump -u 用户名 -p 数据库名 &gt; 导出的文件名</strong></p><p><code>mysqldump -u user_name -p123456 database_name &gt; outfile_name.sql</code></p><p>2.导出一个表</p><p><strong>mysqldump -u 用户名 -p 数据库名 表名&gt; 导出的文件名</strong></p><p><code>mysqldump -u user_name -p database_name table_name &gt; outfile_name.sql</code></p><p>3.导出一个数据库结构</p><p><code>mysqldump -u user_name -p -d –add-drop-table database_name &gt; outfile_name.sql</code></p><p><strong>-d 没有数据 –add-drop-table 在每个create语句之前增加一个drop table</strong></p><p>4.带语言参数导出</p><p><code>mysqldump -uroot -p –default-character-set=latin1 –set-charset=gbk –skip-opt database_name &gt; outfile_name.sql</code></p><h3 id="六、导入数据库"><a href="#六、导入数据库" class="headerlink" title="六、导入数据库"></a>六、导入数据库</h3><p>例如：数据库名为 dbTest</p><p>首先，进入mysql</p><p><code>mysql -uroot -p123456</code></p><p>然后，创建数据库</p><p><code>create dbTest</code></p><p><code>exit</code></p><p>最后，导入数据库</p><p><code>mysql -uroot -p123456 dbTest</code></p><p>数据库及表导出导入示例：</p><p>导出数据库</p><p><code>mysqldump -u root -p123456 gameTop &gt; gameTop_db.sql</code></p><p>导出数据库的表</p><p><code>mysqldump -u -p123456 root gameTop gametop800 &gt; gameTop_table.sql</code></p><p>导出数据库的特定表</p><p><code>mysqldump -u root -p123456  gameTop --table gametop800  &gt; gameTop_table.sql</code></p><p>导出数据库(只导结构，不要数据)</p><p><code>mysqldump -u root -p123456 --opt -d gameTop &gt; gameTop_db.sql</code></p><p>或者</p><p><code>mysqldump -u root -p123456  -d gameTop &gt; gameTop_db.sql</code></p><p>导出数据库(只导数据，不要结构)</p><p><code>mysqldump -u root -p123456  -t gameTop &gt; gameTop_db.sql</code></p><p>注：不加 -d 和 -t 则既导出结构，也导出数据</p><p>mysqldump导出抛出异常：</p><p><code>mysqldump: Got error: 1044: Access denied for user &#39;username&#39;@&#39;%&#39; to database &#39;dbname&#39; when using LOCK TABLES</code></p><p>解决办法，添加参数 —skip-lock-tables：</p><p><code>mysqldump --skip-lock-tables -h172.88.12.102 -username-pAnJnVs3C2tYXyTwV dbname&gt; dbname_bk.sql</code></p><p>导入数据库：</p><p>登录MySQL:      <code>mysql -uroot -p123456</code></p><p>创建数据库：    <code>create database gameTop;</code></p><p>导入数据库：</p><p><code>mysql -uroot -p123456 gameTop</code></p><p>导入数据库表：</p><p><code>mysql -uroot -p123456 gameTop  gametop800 &lt;  gameTop_table.sql</code></p><p>导入数据库表：</p><p><code>mysql -uroot -p123456 gameTop</code></p><p>1:使用SHOW语句找出在服务器上当前存在什么数据库：</p><p><code>mysql&gt; SHOW DATABASES;</code></p><p>2:创建一个数据库MYSQLDATA</p><p><code>mysql&gt; CREATE DATABASE MYSQLDATA;</code></p><p>3:选择你所创建的数据库</p><p><code>mysql&gt; USE MYSQLDATA;</code> (按回车键出现Database changed 时说明操作成功！)</p><p>4:查看现在的数据库中存在什么表</p><p><code>mysql&gt; SHOW TABLES;</code></p><p>5:创建一个数据库表</p><p><code>mysql&gt; CREATE TABLE MYTABLE (name VARCHAR(20), sex CHAR(1));</code></p><p>6:显示表的结构：</p><p><code>mysql&gt; DESCRIBE MYTABLE;</code></p><p>7:往表中加入记录</p><p><code>mysql&gt; insert into MYTABLE values (”hyq”,”M”);</code></p><p>8:用文本方式将数据装入数据库表中(例如D:/mysql.txt)</p><p><code>mysql&gt; LOAD DATA LOCAL INFILE “D:/mysql.txt” INTO TABLE MYTABLE;</code></p><p>9:导入.sql文件命令(例如D:/mysql.sql)</p><p><code>mysql&gt;use database;</code></p><p><code>mysql&gt;source d:/mysql.sql;</code></p><p>10:删除表</p><p><code>mysql&gt;drop TABLE MYTABLE;</code></p><p>11:清空表</p><p><code>mysql&gt;delete from MYTABLE;</code></p><p>12:更新表中数据</p><p><code>mysql&gt;update MYTABLE set sex=”f” where name=’hyq’;</code></p><p>以下是无意中在网络看到的使用MySql的管理心得,</p><ul><li><p>在windows中MySql以服务形式存在，在使用前应确保此服务已经启动，未启动可用net start mysql命令启动。而Linux中启动时可用“/etc/rc.d/init.d/mysqld start”命令，注意启动者应具有管理员权限。</p></li><li><p>刚安装好的MySql包含一个含空密码的root帐户和一个匿名帐户，这是很大的安全隐患，对于一些重要的应用我们应将安全性尽可能提高，在这里应把匿名帐户删除、 root帐户设置密码，可用如下命令进行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">delete from User <span class="built_in">where</span> User=”<span class="string">&quot;;</span></span><br><span class="line"><span class="string">update User set Password=PASSWORD(’newpassword’) where User=’root’;</span></span><br></pre></td></tr></table></figure></li><li><p>如果要对用户所用的登录终端进行限制，可以更新User表中相应用户的Host字段，在进行了以上更改后应重新启动数据库服务，此时登录时可用如下类似命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p;</span><br><span class="line">mysql -uroot -pnewpassword;</span><br><span class="line">mysql mydb -uroot -p;</span><br><span class="line">mysql mydb -uroot -pnewpassword;</span><br></pre></td></tr></table></figure><p>上面命令参数是常用参数的一部分，详细情况可参考文档。此处的mydb是要登录的数据库的名称。</p></li><li><p>在 进行开发和实际应用中，用户不应该只用root用户进行连接数据库，虽然使用root用户进行测试时很方便，但会给系统带来重大安全隐患，也不利于管理技 术的提高。我们给一个应用中使用的用户赋予最恰当的数据库权限。如一个只进行数据插入的用户不应赋予其删除数据的权限。</p></li><li><p>MySql的用户管理是通过 User表来实现的，添加新用户常用的方法有两个，一是在User表插入相应的数据行，同时设置相应的权限；二是通过GRANT命令创建具有某种权限的用 户。其中GRANT的常用用法如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grant all on mydb.* to NewUserName@HostName identified by “password” ;</span><br><span class="line">grant usage on . to NewUserName@HostName identified by “password”;</span><br><span class="line">grant select,insert,update on mydb.* to NewUserName@HostName identified by “password”;</span><br><span class="line">grant update,delete on mydb.TestTable to NewUserName@HostName identified by “password”;</span><br></pre></td></tr></table></figure></li></ul><ul><li>若 要给此用户赋予他在相应对象上的权限的管理能力，可在GRANT后面添加WITH GRANT OPTION选项。而对于用插入User表添加的用户，Password字段应用PASSWORD 函数进行更新加密，以防不轨之人窃看密码。对于那些已经不用的用户应给予清除，权限过界的用户应及时回收权限，回收权限可以通过更新User表相应字段， 也可以使用REVOKE操作。</li></ul><p>下面给出本人从其它资料(www.cn-Java.com)获得的对常用权限的解释：</p><h2 id="七-全局管理权限："><a href="#七-全局管理权限：" class="headerlink" title="七. 全局管理权限："></a>七. 全局管理权限：</h2><ol><li><strong>FILE: 在MySQL服务器上读写文件。</strong></li><li><strong>PROCESS: 显示或杀死属于其它用户的服务线程。</strong></li><li><strong>RELOAD: 重载访问控制表，刷新日志等。</strong></li><li><strong>SHUTDOWN: 关闭MySQL服务。</strong></li><li><strong>数据库/数据表/数据列权限：</strong></li><li><strong>ALTER: 修改已存在的数据表(例如增加/删除列)和索引。</strong></li><li><strong>CREATE: 建立新的数据库或数据表.</strong></li><li><strong>DELETE: 删除表的记录。</strong></li><li><strong>DROP: 删除数据表或数据库。</strong></li><li><strong>INDEX: 建立或删除索引。</strong></li><li><strong>INSERT: 增加表的记录。</strong></li><li><strong>SELECT: 显示/搜索表的记录。</strong></li><li><strong>UPDATE: 修改表中已存在的记录。</strong></li><li><strong>特别的权限：ALL: 允许做任何事(和root一样)。</strong></li><li><strong>USAGE: 只允许登录–其它什么也不允许做。</strong></li></ol><p>知识拓展：</p><p><code>mysql -uroot -p123456 gameTop  gametop800</code></p>]]></content>
    
    
    <summary type="html">作为当今最受欢迎的数据库，其因为免费，轻量而成为目前企业级开发的主要数据库。</summary>
    
    
    
    <category term="数据库" scheme="https://www.blog.909111.xyz/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://www.blog.909111.xyz/tags/MySQL/"/>
    
  </entry>
  
</feed>
