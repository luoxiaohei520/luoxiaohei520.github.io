<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Miaow.Y.Huçš„åšå®¢ğŸ¥</title>
  
  
  <link href="https://luoxiaohei520.github.io/atom.xml" rel="self"/>
  
  <link href="https://luoxiaohei520.github.io/"/>
  <updated>2023-11-09T02:50:23.344Z</updated>
  <id>https://luoxiaohei520.github.io/</id>
  
  <author>
    <name>Miaow.Y.HuğŸ¥</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>pdfé˜…è¯»å™¨</title>
    <link href="https://luoxiaohei520.github.io/posts/0.html"/>
    <id>https://luoxiaohei520.github.io/posts/0.html</id>
    <published>2023-11-09T02:50:23.344Z</published>
    <updated>2023-11-09T02:50:23.344Z</updated>
    
    <content type="html"><![CDATA[<h1>1.æœ¬åœ°æ–‡ä»¶:åœ¨mdæ–‡ä»¶è·¯å¾„ä¸‹åˆ›å»ºä¸€ä¸ªåŒåæ–‡ä»¶å¤¹ï¼Œå…¶å†…æ”¾pdfæ–‡ä»¶åä¸ºxxx.pdfçš„æ–‡ä»¶</h1><div class="row">    <embed src="xxx.pdf" width="100%" height="550" type="application/pdf"></div><h1>2.åœ¨çº¿é“¾æ¥</h1><div class="row">    <embed src="https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/pdf/å°ä½œæ–‡è®²ä¹‰.pdf" width="100%" height="550" type="application/pdf"></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;1.æœ¬åœ°æ–‡ä»¶:åœ¨mdæ–‡ä»¶è·¯å¾„ä¸‹åˆ›å»ºä¸€ä¸ªåŒåæ–‡ä»¶å¤¹ï¼Œå…¶å†…æ”¾pdfæ–‡ä»¶åä¸ºxxx.pdfçš„æ–‡ä»¶&lt;/h1&gt;


	&lt;div class=&quot;row&quot;&gt;
    &lt;embed src=&quot;xxx.pdf&quot; width=&quot;100%&quot; height=&quot;550&quot; type=&quot;applica</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•2</title>
    <link href="https://luoxiaohei520.github.io/posts/ba945d0d.html"/>
    <id>https://luoxiaohei520.github.io/posts/ba945d0d.html</id>
    <published>2023-11-09T02:50:23.344Z</published>
    <updated>2023-11-09T02:50:23.344Z</updated>
    
    <content type="html"><![CDATA[<p>ç”±äºä¸Šä¸ªæ–‡ä»¶å­—æ•°åˆ°è¾¾2wä»¥ä¸Šï¼Œæœ¬è½¯ä»¶åŠ è½½æ¯”è¾ƒéº»çƒ¦ï¼Œæ•…è€Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶ç”¨æ¥è®°å½•ã€‚</p><h1>æ•°æ®ç»“æ„ä¸ç®—æ³•</h1><h2 id="9-å“ˆå¸Œè¡¨">9 å“ˆå¸Œè¡¨</h2><p>ä¸€ç§æ•°æ®ç»“æ„</p><p>ä¸€èˆ¬æœ‰hashMap,hashtable</p><p>å“ˆå¸Œè¡¨ï¼Œæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œä¸»è¦æ˜¯key ä¸valueçš„å…³ç³»ï¼Œäº†è§£hashè¡¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£çš„æ˜¯å“ˆå¸Œè¡¨ï¼Œéœ€è¦çŸ¥é“å“ˆå¸Œå‡½æ•°ï¼Œåœ¨jdk1.8ä¹‹åï¼Œé‡‡ç”¨çš„çº¢é»‘æ ‘è¿›è¡Œä¸€å®šçš„å­˜å‚¨ï¼Œå…¶æ˜¯æ ¹æ®å…³é”®ç å€¼è€Œè¿›è¡Œè®¿é—®çš„æ•°æ®ç»“æ„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å…¶é€šè¿‡æŠŠå…³é”®ç æ˜ å°„åˆ°è¡¨ä¸­çš„ä¸€ä¸ªä½ç½®æ¥è®¿é—®è®°å½•ï¼Œä»¥åŠ å¿«æŸ¥æ‰¾çš„é€Ÿåº¦ï¼Œè¿™ä¸ªæ˜ å°„å‡½æ•°æˆ‘ä»¬ç§°ä¹‹ä¸ºæ•£åˆ—å‡½æ•°ï¼Œå­˜æ”¾è®°å½•çš„æ•°ç»„å«åšæ•£åˆ—è¡¨ã€‚</strong></p><p>hashtableæ¥å­˜å‚¨é›‡å‘˜ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashtableDemo</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">hashTable</span> <span class="variable">hashtab</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">hashTable</span>(<span class="number">8</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">10</span>,<span class="string">&quot;ç¤¾ä¼šè™&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">18</span>,<span class="string">&quot;åºŸç‰©åˆ€&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">26</span>,<span class="string">&quot;é»‘ç‰›&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">3</span>,<span class="string">&quot;ç™½ç‰›&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">193</span>,<span class="string">&quot;å°äº®&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp6</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">231</span>,<span class="string">&quot;å”è€é¸­&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp7</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">12</span>,<span class="string">&quot;ç™¾ç‰¹æ›¼&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp8</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">1</span>,<span class="string">&quot;ç‹¬çˆ±å°å°¹&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp9</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">123</span>,<span class="string">&quot;ä¸½ä¸½&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp10</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">126</span>,<span class="string">&quot;å¸¦ç¯®å­&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp11</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">29</span>,<span class="string">&quot;åˆ˜å¢‰&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp12</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">86</span>,<span class="string">&quot;ä¸çœŸ&quot;</span>);</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">Emp13</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">800</span>,<span class="string">&quot;ç‹å†°å†°&quot;</span>);<span class="comment">//å®šä¹‰æ•°æ®</span></span><br><span class="line"></span><br><span class="line">        hashtab.add(Emp1);</span><br><span class="line">        hashtab.add(Emp2);</span><br><span class="line">        hashtab.add(Emp3);</span><br><span class="line">        hashtab.add(Emp4);</span><br><span class="line">        hashtab.add(Emp5);</span><br><span class="line">        hashtab.add(Emp6);</span><br><span class="line">        hashtab.add(Emp7);</span><br><span class="line">        hashtab.add(Emp8);</span><br><span class="line">        hashtab.add(Emp9);</span><br><span class="line">        hashtab.add(Emp10);</span><br><span class="line">        hashtab.add(Emp11);</span><br><span class="line">        hashtab.add(Emp12);</span><br><span class="line">        hashtab.add(Emp13);<span class="comment">//æ’å…¥æ•°æ®</span></span><br><span class="line">        </span><br><span class="line">        hashtab.list();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºhashtable</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">hashTable</span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line"><span class="keyword">private</span> EmpLinkedList[] empLinkedLists;</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªæ„é€ å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">hashTable</span><span class="params">(<span class="type">int</span> size)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.size = size;</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–empLinkedListArray</span></span><br><span class="line">empLinkedLists = <span class="keyword">new</span> <span class="title class_">EmpLinkedList</span>[size];</span><br><span class="line"><span class="comment">//ç»†èŠ‚ï¼Œå¼•ç”¨ç±»å‹çš„å˜é‡åœ¨å£°æ˜åå¦‚æœä¸åˆå§‹åŒ–é‚£ä¹ˆé»˜è®¤å€¼å°±æ˜¯null</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; size; i++) &#123;</span><br><span class="line"><span class="comment">//è¿™ä¸ªå¾ªç¯ä½“å°±æ˜¯åœ¨åˆå§‹åŒ–</span></span><br><span class="line">empLinkedLists[i] = <span class="keyword">new</span> <span class="title class_">EmpLinkedList</span>();<span class="comment">//åœ¨è¿™é‡Œå¿…é¡»è¦é€ä¸€ä¸ºæ¯ä¸ªå…ƒç´ å®ä¾‹åŒ–</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> id % size;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ·»åŠ é›‡å‘˜</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Emp emp)</span>&#123;</span><br><span class="line"><span class="comment">//æ ¹æ®å‘˜å·¥çš„idå¾—åˆ°è¯¥å‘˜å·¥åº”è¯¥åŠ å…¥</span></span><br><span class="line"><span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> hash(emp.id);</span><br><span class="line">empLinkedLists[num].add(emp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; size ; i ++ ) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;ç¬¬&quot;</span>+i+<span class="string">&quot;ä¸ªé“¾è¡¨çŠ¶å†µ&quot;</span>);</span><br><span class="line">empLinkedLists[i].list();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¡¨æ˜¯</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Emp</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> id;</span><br><span class="line"><span class="keyword">public</span> String name;</span><br><span class="line"><span class="keyword">public</span> Emp next;  <span class="comment">//next é»˜è®¤ä¸ºç©º</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Emp</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Emp</span><span class="params">(<span class="type">int</span> id, String name)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line"><span class="built_in">this</span>.id = id;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.id = id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> Emp <span class="title function_">getNext</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNext</span><span class="params">(Emp next)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.next = next;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªEmpLinkList,è¡¨ç¤ºé“¾è¡¨</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmpLinkedList</span>&#123;</span><br><span class="line"><span class="comment">//æŠ•æŒ‡é’ˆï¼Œæ‰§è¡Œç¬¬ä¸€ä¸ªEmp,å› æ­¤æˆ‘ä»¬è¿™ä¸ªé“¾è¡¨çš„headæ˜¯ç›´æ¥æŒ‡å‘ç¬¬ä¸€ä¸ªEmp</span></span><br><span class="line"><span class="keyword">private</span> Emp head; <span class="comment">//é»˜è®¤ä¸ºç©º</span></span><br><span class="line"><span class="comment">//æ·»åŠ é›‡å‘˜åˆ°é“¾è¡¨</span></span><br><span class="line"><span class="comment">//è¯´æ˜</span></span><br><span class="line"><span class="comment">//å‡å®šï¼Œå½“æ·»åŠ é›‡å‘˜æ—¶å€™ï¼Œidæ˜¯è‡ªå¢é•¿ï¼Œå³idçš„åˆ†é…æ€»æ•°ä»å°åˆ°å¤§çš„</span></span><br><span class="line"><span class="comment">//å› æ­¤æˆ‘ä»¬å°†è¯¥é›‡å‘˜ç›´æ¥åŠ å…¥åˆ°æœ¬é“¾è¡¨çš„æœ€åå³å¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Emp emp)</span> &#123;</span><br><span class="line"><span class="comment">//å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªé›‡å‘˜</span></span><br><span class="line"><span class="keyword">if</span>(head == <span class="literal">null</span> ) &#123;</span><br><span class="line">head = emp;</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¦‚æœä¸æ˜¯ç¬¬ä¸€ä¸ªé›‡å‘˜ï¼Œåˆ™ä½¿ç”¨ä¸€ä¸ªè¾…åŠ©çš„æŒ‡é’ˆï¼Œå¸®åŠ©å®šä½åˆ°æœ€å</span></span><br><span class="line"><span class="type">Emp</span> <span class="variable">curEmp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(curEmp.next == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">curEmp = curEmp.next; <span class="comment">//åç§»</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//é€€å‡ºæ—¶ç›´æ¥å°†empåŠ å…¥é“¾è¡¨</span></span><br><span class="line">curEmp.next = emp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//éå†é“¾è¡¨çš„é›‡å‘˜ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(head == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœé“¾è¡¨ä¸ºç©º</span></span><br><span class="line">System.out.println(<span class="string">&quot;å½“å‰é“¾è¡¨ä¸ºç©º&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;å½“å‰é“¾è¡¨çš„ä¿¡æ¯ä¸ºï¼š&quot;</span>);</span><br><span class="line"><span class="type">Emp</span> <span class="variable">cuEmp</span> <span class="operator">=</span> head ; <span class="comment">//è¾…åŠ©æŒ‡é’ˆ</span></span><br><span class="line"><span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;id = %d name = %s\n&quot;</span>,cuEmp.id,cuEmp.name);</span><br><span class="line">count ++;</span><br><span class="line"><span class="keyword">if</span>(cuEmp.next == <span class="literal">null</span> ) &#123;</span><br><span class="line"><span class="comment">//è¯´æ˜cuEmpå·²ç»æ˜¯æœ€åçš„èŠ‚ç‚¹</span></span><br><span class="line">System.out.println(<span class="string">&quot;å…±è®¡æœ‰&quot;</span>+ count+ <span class="string">&quot;ä¸ª&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">cuEmp = cuEmp.next;<span class="comment">//åç§»ï¼Œéå†</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10-æ•°æ®ç»“æ„çš„å­˜å‚¨æ–¹å¼">10.æ•°æ®ç»“æ„çš„å­˜å‚¨æ–¹å¼</h2><h3 id="10-1äºŒå‰æ ‘">10.1äºŒå‰æ ‘</h3><ol><li><p>æ•°ç»„çš„å­˜å‚¨æ–¹å¼çš„åˆ†æ<br>**ä¼˜ç‚¹ï¼š**é€šè¿‡ä¸‹æ ‡æ–¹å¼è®¿é—®å…ƒç´ ï¼Œé€Ÿåº¦å¿«ã€‚å¯¹äºæœ‰åºæ•°ç»„ï¼Œè¿˜å¯ä»¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æé«˜æ£€ç´¢é€Ÿåº¦ã€‚</p><p>**ç¼ºç‚¹ï¼š**å¦‚æœè¦æ£€ç´¢å…·ä½“æŸä¸ªå€¼ï¼Œæˆ–è€…æ’å…¥å€¼ï¼ˆæŒ‰ç…§ä¸€å®šé¡ºåºï¼‰ä¼šæ•´ä½“ç§»åŠ¨ï¼Œæ•ˆç‡è¾ƒä½ã€‚</p></li><li><p>é“¾å¼å­˜å‚¨æ–¹å¼çš„åˆ†æ</p><p>**ä¼˜ç‚¹ï¼š**åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯¹æ•°ç»„çš„å­˜å‚¨æ–¹å¼æœ‰ä¼˜åŒ–ï¼ˆæ¯”å¦‚ï¼šæ’å…¥ä¸€ä¸ªæ•°å€¼èŠ‚ç‚¹ï¼Œåªéœ€è¦å°†æ’å…¥èŠ‚ç‚¹ï¼Œé“¾æ¥åˆ°é“¾è¡¨ä¸­å³å¯ï¼Œåˆ é™¤æ•ˆç‡ä¹Ÿå¾ˆå¥½ï¼‰</p><p><strong>ç¼ºç‚¹ï¼š<strong>åœ¨è¿›è¡Œ</strong>æ£€ç´¢</strong>æ—¶ï¼Œæ•ˆç‡ä»ç„¶æ¯”è¾ƒä½ï¼Œæ¯”å¦‚ï¼ˆæ£€ç´¢æŸä¸ªå€¼ï¼Œéœ€è¦ä»å¤´ç»“ç‚¹å¼€å§‹éå†ï¼‰</p></li><li><p>æ ‘å­˜å‚¨æ–¹å¼çš„åˆ†æ</p><p>**ä¼˜ç‚¹ï¼š**å¯ä»¥æé«˜æ•°æ®å­˜å‚¨ï¼Œè¯»å–çš„æ•ˆç‡ï¼Œæ¯”å¦‚åˆ©ç”¨äºŒå‰æ’åºæ ‘ï¼Œæ—¢å¯ä»¥ä¿è¯æ•°æ®çš„æ£€ç´¢é€Ÿåº¦ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä¿è¯æ•°æ®çš„æ’å…¥ï¼Œåˆ é™¤ï¼Œä¿®æ”¹çš„é€Ÿåº¦ã€‚</p><p>**ç¼ºç‚¹ï¼š**é¡ºåºå­˜å‚¨å¯èƒ½ä¼šæµªè´¹ç©ºé—´ï¼ˆåœ¨éå®Œå…¨äºŒå‰æ ‘çš„æ—¶å€™ï¼Œä½†æ˜¯è¯»å–æŸä¸ªç‰¹å®šçš„èŠ‚ç‚¹çš„æ—¶å€™æ•ˆç‡æ¯”è¾ƒé«˜O(0)ï¼‰;é“¾å¼å­˜å‚¨ç›¸å¯¹äºäºŒå‰æ ‘ï¼Œæµªè´¹ç©ºé—´è¾ƒå°‘ï¼Œä½†æ˜¯è¯»å–æŸä¸ªç»“ç‚¹æ—¶æ•ˆç‡åä½O(nlogn)ã€‚</p></li></ol><h3 id="10-2-äºŒå‰æ ‘çš„æ¦‚ç‡å’Œå¸¸ç”¨æœ¯è¯­">10.2 äºŒå‰æ ‘çš„æ¦‚ç‡å’Œå¸¸ç”¨æœ¯è¯­</h3><p>**æ»¡äºŒå‰æ ‘ï¼š**åœ¨ä¸€ä¸ªäºŒå‰æ ‘ä¸­ï¼Œå¦‚æœæ‰€æœ‰åˆ†æ”¯èŠ‚ç‚¹éƒ½æœ‰å·¦å­©å­èŠ‚ç‚¹å’Œå³å­©å­èŠ‚ç‚¹ï¼Œå¹¶ä¸”å¶èŠ‚ç‚¹éƒ½é›†ä¸­åœ¨äºŒå‰æ ‘ä¸­çš„æœ€ä¸‹ä¸€å±‚ï¼Œè¿™æ ·çš„äºŒå‰æ ‘è¢«ç§°ä¸ºæ»¡äºŒå‰æ ‘ã€‚</p><p>**å®Œå…¨äºŒå‰æ ‘ï¼š**è‹¥äºŒå‰æ ‘ä¸­æœ€å¤šåªæœ‰æœ€ä¸‹é¢ä¸¤å±‚çš„ç»“ç‚¹çš„åº¦æ•°å¯ä»¥å°äº2ï¼Œå¹¶ä¸”æœ€ä¸‹é¢ä¸€å±‚çš„å¶å­èŠ‚ç‚¹ï¼Œéƒ½ä¾æ¬¡æ’åˆ—åœ¨è¯¥å±‚æœ€å·¦è¾¹çš„ä½ç½®ä¸Šï¼Œè¿™æ ·çš„äºŒå‰æ ‘ç§°ä¸ºå®Œå…¨äºŒå‰æ ‘ã€‚</p><h4 id="éå†å’ŒèŠ‚ç‚¹åˆ é™¤">éå†å’ŒèŠ‚ç‚¹åˆ é™¤</h4><p>äºŒå‰æ ‘æ˜¯ä¸€ç§éå¸¸é‡è¦çš„æ•°æ®ç»“æ„ï¼Œéå¸¸å¤šçš„æ•°æ®ç»“æ„éƒ½æ˜¯åŸºäºäºŒå‰æ ‘çš„åŸºç¡€æ¼”å˜è€Œæ¥çš„ã€‚å¯¹äºäºŒå‰æ ‘æœ‰æ·±åº¦éå†å’Œå¹¿åº¦éå†ï¼Œæ·±åº¦éå†æœ‰å‰åºã€ä¸­åºä»¥åŠååºä¸‰ç§éå†æ–¹æ³•ï¼Œå¹¿åº¦éå†å³æˆ‘ä»¬å¯»å¸¸æ‰€è¯´çš„å±‚æ¬¡éå†ã€‚ç”±äºæ ‘çš„å®šä¹‰æœ¬èº«å°±æ˜¯é€’å½’å®šä¹‰ï¼Œå› æ­¤é‡‡ç”¨é€’å½’çš„æ–¹æ³•å®ç°æ ‘çš„ä¸‰ç§éå†ã€‚</p><ul><li>å‰åºéå†ï¼šæ ¹ç»“ç‚¹ --&gt;å·¦å­æ ‘â€“&gt;å³å­æ ‘ï¼›</li><li>ä¸­åºéå†ï¼šå·¦å­æ ‘ --&gt;æ ¹ç»“ç‚¹â€“&gt;å³å­æ ‘ï¼›</li><li>åç»­éå†ï¼šå·¦å­æ ‘ --&gt;å³å­æ ‘â€“&gt;æ ¹ç»“ç‚¹ï¼›</li><li>å±‚æ¬¡éå†ï¼šä»…ä»…éœ€æŒ‰æˆæ¬¡éå†å³å¯ï¼›</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BinaryTreeDemo</span> &#123;</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰äºŒå‰æ ‘</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªäºŒå‰æ ‘</span></span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªäºŒå‰æ ‘</span></span><br><span class="line">        <span class="type">BinaryTree</span> <span class="variable">binaryTree</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BinaryTree</span>();</span><br><span class="line">        <span class="comment">//åˆ›å»ºç»“ç‚¹</span></span><br><span class="line">        <span class="type">HeroNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">1</span>, <span class="string">&quot;å®‹æ±Ÿ&quot;</span>);</span><br><span class="line">        <span class="type">HeroNode</span> <span class="variable">node2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">2</span>, <span class="string">&quot;å¢ä¿Šä¹‰&quot;</span>);</span><br><span class="line">        <span class="type">HeroNode</span> <span class="variable">node3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">3</span>, <span class="string">&quot;å´ç”¨&quot;</span>);</span><br><span class="line">        <span class="type">HeroNode</span> <span class="variable">node4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">4</span>, <span class="string">&quot;å…¬å­™èƒœ&quot;</span>);</span><br><span class="line">        <span class="type">HeroNode</span> <span class="variable">node5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">5</span>, <span class="string">&quot;å…³èƒœ&quot;</span>);</span><br><span class="line">        root.setLeft(node2);</span><br><span class="line">        root.setRight(node3);</span><br><span class="line">        node3.setLeft(node4);</span><br><span class="line">        node3.setRight(node5);</span><br><span class="line">        binaryTree.setRoot(root);</span><br><span class="line">        System.out.println(<span class="string">&quot;å‰åºéå†&quot;</span>);</span><br><span class="line">        binaryTree.preOrder();</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸­åºéå†&quot;</span>);</span><br><span class="line">        binaryTree.midOrder();</span><br><span class="line">        System.out.println(<span class="string">&quot;ååºéå†&quot;</span>);</span><br><span class="line">        binaryTree.postOrder();</span><br><span class="line">        binaryTree.delNode(<span class="number">3</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ é™¤ç»“ç‚¹3ï¼Œå‰åºéå†&quot;</span>);</span><br><span class="line">        binaryTree.preOrder();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å®šä¹‰BinaryTree äºŒå‰æ ‘</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BinaryTree</span> &#123;</span><br><span class="line"><span class="keyword">private</span> HeroNode root;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> HeroNode <span class="title function_">getRoot</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRoot</span><span class="params">(HeroNode root)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.root = root;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å‰åºéå†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">preOrder</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.root != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.root.preOrder();</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;äºŒå‰æ ‘ä¸ºç©ºï¼Œä¸èƒ½éå†&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¸­åºéå†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">midOrder</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.root != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.root.midOrder();</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;äºŒå‰æ ‘ä¸ºç©ºï¼Œæ— æ³•éå†&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ååºéå†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postOrder</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.root != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.root.postOrder();</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;äºŒå‰æ ‘ä¸ºç©ºï¼Œæ— æ³•éå†&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ é™¤ç»“ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delNode</span><span class="params">(<span class="type">int</span> no)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(root != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœåªæœ‰ä¸€ä¸ªrootç»“ç‚¹, è¿™é‡Œç«‹å³åˆ¤æ–­rootæ˜¯ä¸æ˜¯å°±æ˜¯è¦åˆ é™¤ç»“ç‚¹</span></span><br><span class="line"><span class="keyword">if</span>(root.getNo() == no) &#123;</span><br><span class="line">root = <span class="literal">null</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//é€’å½’åˆ é™¤</span></span><br><span class="line">root.delNode(no);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;ç©ºæ ‘ï¼Œä¸èƒ½åˆ é™¤~&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å…ˆåˆ›å»ºHeroNode ç»“ç‚¹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeroNode</span> &#123;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> no;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> HeroNode left; <span class="comment">//é»˜è®¤null</span></span><br><span class="line"><span class="keyword">private</span> HeroNode right; <span class="comment">//é»˜è®¤null</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode</span><span class="params">(<span class="type">int</span> no, String name)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.no = no;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNo</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> no;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNo</span><span class="params">(<span class="type">int</span> no)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.no = no;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> HeroNode <span class="title function_">getLeft</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLeft</span><span class="params">(HeroNode left)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.left = left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> HeroNode <span class="title function_">getRight</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRight</span><span class="params">(HeroNode right)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.right = right;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;HeroNode [no=&quot;</span> + no + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‰åºéå†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">preOrder</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(<span class="built_in">this</span>);<span class="comment">//å…ˆè¾“å‡ºçˆ¶èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">//é€’å½’å‘å·¦å­æ ‘å‰åºéå†</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.left != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.left.preOrder();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//é€’å½’å‘å³å­æ ‘å‰åºéå†</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.right != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.right.preOrder();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸­åºéå†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">midOrder</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//é€’å½’å‘å·¦å­æ ‘ä¸­åºéå†</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.left != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.left.midOrder();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="built_in">this</span>);<span class="comment">//è¾“å‡ºçˆ¶èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">//é€’å½’å‘å³å­æ ‘å‰åºéå†</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.right != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.right.midOrder();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ååºéå†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postOrder</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//é€’å½’å‘å·¦å­æ ‘ååºéå†</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.left != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.left.postOrder();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//é€’å½’å‘å³å­æ ‘å‰åºéå†</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.right != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.right.postOrder();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="built_in">this</span>);<span class="comment">//è¾“å‡ºçˆ¶èŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€’å½’åˆ é™¤ç»“ç‚¹</span></span><br><span class="line"><span class="comment">//1.å¦‚æœåˆ é™¤çš„èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ï¼Œåˆ™åˆ é™¤è¯¥èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">//2.å¦‚æœåˆ é™¤çš„èŠ‚ç‚¹æ˜¯éå¶å­èŠ‚ç‚¹ï¼Œåˆ™åˆ é™¤è¯¥å­æ ‘</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delNode</span><span class="params">(<span class="type">int</span> no)</span> &#123;</span><br><span class="line"><span class="comment">//æ€è·¯</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 1. å› ä¸ºæˆ‘ä»¬çš„äºŒå‰æ ‘æ˜¯å•å‘çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ˜¯åˆ¤æ–­å½“å‰ç»“ç‚¹çš„å­ç»“ç‚¹æ˜¯å¦éœ€è¦åˆ é™¤ç»“ç‚¹ï¼Œè€Œä¸èƒ½å»åˆ¤æ–­å½“å‰è¿™ä¸ªç»“ç‚¹æ˜¯ä¸æ˜¯éœ€è¦åˆ é™¤ç»“ç‚¹.</span></span><br><span class="line"><span class="comment">2. å¦‚æœå½“å‰ç»“ç‚¹çš„å·¦å­ç»“ç‚¹ä¸ä¸ºç©ºï¼Œå¹¶ä¸”å·¦å­ç»“ç‚¹ å°±æ˜¯è¦åˆ é™¤ç»“ç‚¹ï¼Œå°±å°†this.left = null; å¹¶ä¸”å°±è¿”å›(ç»“æŸé€’å½’åˆ é™¤)</span></span><br><span class="line"><span class="comment">3. å¦‚æœå½“å‰ç»“ç‚¹çš„å³å­ç»“ç‚¹ä¸ä¸ºç©ºï¼Œå¹¶ä¸”å³å­ç»“ç‚¹ å°±æ˜¯è¦åˆ é™¤ç»“ç‚¹ï¼Œå°±å°†this.right= null ;å¹¶ä¸”å°±è¿”å›(ç»“æŸé€’å½’åˆ é™¤)</span></span><br><span class="line"><span class="comment">4. å¦‚æœç¬¬2å’Œç¬¬3æ­¥æ²¡æœ‰åˆ é™¤ç»“ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å‘å·¦å­æ ‘è¿›è¡Œé€’å½’åˆ é™¤</span></span><br><span class="line"><span class="comment">5.  å¦‚æœç¬¬4æ­¥ä¹Ÿæ²¡æœ‰åˆ é™¤ç»“ç‚¹ï¼Œåˆ™åº”å½“å‘å³å­æ ‘è¿›è¡Œé€’å½’åˆ é™¤.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//2. å¦‚æœå½“å‰ç»“ç‚¹çš„å·¦å­ç»“ç‚¹ä¸ä¸ºç©ºï¼Œå¹¶ä¸”å·¦å­ç»“ç‚¹ å°±æ˜¯è¦åˆ é™¤ç»“ç‚¹ï¼Œå°±å°†this.left = null; å¹¶ä¸”å°±è¿”å›(ç»“æŸé€’å½’åˆ é™¤)</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.left != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.left.no == no) &#123;</span><br><span class="line"><span class="built_in">this</span>.left = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.å¦‚æœå½“å‰ç»“ç‚¹çš„å³å­ç»“ç‚¹ä¸ä¸ºç©ºï¼Œå¹¶ä¸”å³å­ç»“ç‚¹ å°±æ˜¯è¦åˆ é™¤ç»“ç‚¹ï¼Œå°±å°†this.right= null ;å¹¶ä¸”å°±è¿”å›(ç»“æŸé€’å½’åˆ é™¤)</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.right != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.right.no == no) &#123;</span><br><span class="line"><span class="built_in">this</span>.right = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//4.æˆ‘ä»¬å°±éœ€è¦å‘å·¦å­æ ‘è¿›è¡Œé€’å½’åˆ é™¤</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.left != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.left.delNode(no);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//5.åˆ™åº”å½“å‘å³å­æ ‘è¿›è¡Œé€’å½’åˆ é™¤</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">this</span>.right != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="built_in">this</span>.right.delNode(no);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-3é“¾å¼å­˜å‚¨">10.3é“¾å¼å­˜å‚¨</h3><p><strong>æŸ¥æ‰¾èŠ‚ç‚¹</strong>ï¼šå…ˆå¯¹æ ‘è¿›è¡Œä¸€æ¬¡éå†ï¼Œç„¶åæ‰¾å‡ºè¦æ‰¾çš„é‚£ä¸ªæ•°ï¼›å› ä¸ºæœ‰ä¸‰ç§æ’åºæ–¹æ³•ï¼Œæ‰€ä»¥æŸ¥æ‰¾èŠ‚ç‚¹ä¹Ÿåˆ†ä¸ºå…ˆåºæŸ¥æ‰¾ï¼Œä¸­åºæŸ¥æ‰¾ï¼ŒååºæŸ¥æ‰¾ï¼›</p><p><strong>åˆ é™¤èŠ‚ç‚¹</strong>ï¼šç”±äºé“¾å¼å­˜å‚¨ï¼Œä¸èƒ½æ‰¾åˆ°è¦åˆ çš„æ•°ç›´æ¥åˆ é™¤ï¼Œéœ€è¦æ‰¾åˆ°ä»–çš„çˆ¶èŠ‚ç‚¹ï¼Œç„¶åå°†æŒ‡å‘è¯¥æ•°è®¾ç½®ä¸ºnullï¼›æ‰€ä»¥éœ€è¦ä¸€ä¸ªå˜é‡æ¥æŒ‡å‘çˆ¶èŠ‚ç‚¹ï¼Œæ‰¾åˆ°æ•°åï¼Œå†æ–­å¼€è¿æ¥ã€‚</p><p>æ ‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BinaryTree</span> &#123;</span><br><span class="line"></span><br><span class="line">    TreeNode root;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¾ç½®æ ¹èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRoot</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.root = root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–æ ¹èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">getRoot</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…ˆåºéå†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">frontShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">            root.frontShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸­åºéå†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">middleShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">            root.middleShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ååºéå†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">            root.afterShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…ˆåºæŸ¥æ‰¾</span></span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">frontSearch</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> root.frontSearch(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ é™¤ä¸€ä¸ªå­æ ‘</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root.value == i) &#123;</span><br><span class="line">            root = <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            root.delete(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>èŠ‚ç‚¹ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹çš„æƒ</span></span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">    <span class="comment">//å·¦å„¿å­</span></span><br><span class="line">    TreeNode leftNode;</span><br><span class="line">    <span class="comment">//å³å„¿å­</span></span><br><span class="line">    TreeNode rightNode;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TreeNode</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¾ç½®å·¦å„¿å­</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLeftNode</span><span class="params">(TreeNode leftNode)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.leftNode = leftNode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¾ç½®å³å„¿å­</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRightNode</span><span class="params">(TreeNode rightNode)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.rightNode = rightNode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…ˆåºéå†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">frontShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//å…ˆéå†å½“å‰èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">        System.out.print(value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="comment">//å·¦èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (leftNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            leftNode.frontShow(); <span class="comment">//é€’å½’æ€æƒ³</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å³èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (rightNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            rightNode.frontShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸­åºéå†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">middleShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//å·¦èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (leftNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            leftNode.middleShow(); <span class="comment">//é€’å½’æ€æƒ³</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å…ˆéå†å½“å‰èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">        System.out.print(value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="comment">//å³èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (rightNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            rightNode.middleShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åç»­éå†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//å·¦èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (leftNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            leftNode.afterShow(); <span class="comment">//é€’å½’æ€æƒ³</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å³èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (rightNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            rightNode.afterShow();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å…ˆéå†å½“å‰èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">        System.out.print(value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…ˆåºæŸ¥æ‰¾</span></span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">frontSearch</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">target</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//å¯¹æ¯”å½“å‰èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.value == i) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">            <span class="comment">//å½“å‰èŠ‚ç‚¹ä¸æ˜¯è¦æŸ¥æ‰¾çš„èŠ‚ç‚¹</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//æŸ¥æ‰¾å·¦å„¿å­</span></span><br><span class="line">            <span class="keyword">if</span> (leftNode != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//æŸ¥æ‰¾çš„è¯tèµ‹å€¼ç»™targetï¼ŒæŸ¥ä¸åˆ°targetè¿˜æ˜¯null</span></span><br><span class="line">                target = leftNode.frontSearch(i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å¦‚æœtargetä¸ä¸ºç©ºï¼Œè¯´æ˜åœ¨å·¦å„¿å­ä¸­å·²ç»æ‰¾åˆ°</span></span><br><span class="line">            <span class="keyword">if</span> (target != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> target;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å¦‚æœå·¦å„¿å­æ²¡æœ‰æŸ¥åˆ°ï¼Œå†æŸ¥æ‰¾å³å„¿å­</span></span><br><span class="line">            <span class="keyword">if</span> (rightNode != <span class="literal">null</span>) &#123;</span><br><span class="line">                target = rightNode.frontSearch(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ é™¤ä¸€ä¸ªå­æ ‘</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">parent</span> <span class="operator">=</span> <span class="built_in">this</span>;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­å·¦å„¿å­</span></span><br><span class="line">        <span class="keyword">if</span> (parent.leftNode != <span class="literal">null</span> &amp;&amp; parent.leftNode.value == i) &#123;</span><br><span class="line">            parent.leftNode = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­å³å„¿å­</span></span><br><span class="line">        <span class="keyword">if</span> (parent.rightNode != <span class="literal">null</span> &amp;&amp; parent.rightNode.value == i) &#123;</span><br><span class="line">            parent.rightNode = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¦‚æœéƒ½ä¸æ˜¯ï¼Œé€’å½’æ£€æŸ¥å¹¶åˆ é™¤å·¦å„¿å­</span></span><br><span class="line">        parent = leftNode;</span><br><span class="line">        <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">            parent.delete(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//é€’å½’æ£€æŸ¥å¹¶åˆ é™¤å³å„¿å­</span></span><br><span class="line">        parent = rightNode;</span><br><span class="line">        <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">            parent.delete(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€æ£µæ ‘</span></span><br><span class="line">        <span class="type">BinaryTree</span> <span class="variable">binaryTree</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BinaryTree</span>();</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªæ ¹èŠ‚ç‚¹</span></span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//æŠŠæ ¹èŠ‚ç‚¹èµ‹ç»™æ ‘</span></span><br><span class="line">        binaryTree.setRoot(root);</span><br><span class="line">        <span class="comment">//åˆ›å»ºå·¦,å³èŠ‚ç‚¹</span></span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">rootLeft</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">rootRight</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//æŠŠæ–°å»ºçš„èŠ‚ç‚¹è®¾ç½®ä¸ºæ ¹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹</span></span><br><span class="line">        root.setLeftNode(rootLeft);</span><br><span class="line">        root.setRightNode(rootRight);</span><br><span class="line">        <span class="comment">//ä¸ºç¬¬äºŒå±‚çš„å·¦èŠ‚ç‚¹åˆ›å»ºä¸¤ä¸ªå­èŠ‚ç‚¹</span></span><br><span class="line">        rootLeft.setLeftNode(<span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">4</span>));</span><br><span class="line">        rootLeft.setRightNode(<span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">5</span>));</span><br><span class="line">        <span class="comment">//ä¸ºç¬¬äºŒå±‚çš„å³èŠ‚ç‚¹åˆ›å»ºä¸¤ä¸ªå­èŠ‚ç‚¹</span></span><br><span class="line">        rootRight.setLeftNode(<span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">6</span>));</span><br><span class="line">        rootRight.setRightNode(<span class="keyword">new</span> <span class="title class_">TreeNode</span>(<span class="number">7</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å…ˆåºéå†</span></span><br><span class="line">        binaryTree.frontShow(); <span class="comment">//1 2 4 5 3 6 7</span></span><br><span class="line">        System.out.println();</span><br><span class="line">        <span class="comment">//ä¸­åºéå†</span></span><br><span class="line">        binaryTree.middleShow(); <span class="comment">//4 2 5 1 6 3 7</span></span><br><span class="line">        System.out.println();</span><br><span class="line">        <span class="comment">//ååºéå†</span></span><br><span class="line">        binaryTree.afterShow(); <span class="comment">//4 5 2 6 7 3 1</span></span><br><span class="line">        System.out.println();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å…ˆåºæŸ¥æ‰¾</span></span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">result</span> <span class="operator">=</span> binaryTree.frontSearch(<span class="number">5</span>);</span><br><span class="line">        System.out.println(result); <span class="comment">//binarytree.TreeNode@1b6d3586</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ é™¤ä¸€ä¸ªå­æ ‘</span></span><br><span class="line">        binaryTree.delete(<span class="number">2</span>);</span><br><span class="line">        binaryTree.frontShow(); <span class="comment">//1 3 6 7 ï¼Œ2å’Œä»–çš„å­èŠ‚ç‚¹è¢«åˆ é™¤äº†</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="10-4é¡ºåºå­˜å‚¨çš„äºŒå‰æ ‘">10.4é¡ºåºå­˜å‚¨çš„äºŒå‰æ ‘</h3><p><strong>æ¦‚è¿°</strong>ï¼šé¡ºåºå­˜å‚¨ä½¿ç”¨æ•°ç»„çš„å½¢å¼å®ç°ï¼›ç”±äºéå®Œå…¨äºŒå‰æ ‘ä¼šå¯¼è‡´æ•°ç»„ä¸­å‡ºç°ç©ºç¼ºï¼Œæœ‰çš„ä½ç½®ä¸èƒ½å¡«ä¸Šæ•°å­—ï¼Œæ‰€ä»¥é¡ºåºå­˜å‚¨äºŒå‰æ ‘é€šå¸¸æƒ…å†µä¸‹åªè€ƒè™‘<strong>å®Œå…¨äºŒå‰æ ‘</strong></p><p><strong>åŸç†</strong>ï¼š é¡ºåºå­˜å‚¨åœ¨æ•°ç»„ä¸­æ˜¯æŒ‰ç…§ç¬¬ä¸€å±‚ç¬¬äºŒå±‚ä¸€æ¬¡å¾€ä¸‹å­˜å‚¨çš„ï¼Œéå†æ–¹å¼ä¹Ÿæœ‰å…ˆåºéå†ã€ä¸­åºéå†ã€åç»­éå†</p><p><strong>æ€§è´¨</strong>ï¼š</p><ul><li>ç¬¬nä¸ªå…ƒç´ çš„å·¦å­èŠ‚ç‚¹æ˜¯ï¼š2*n+1ï¼›</li><li>ç¬¬nä¸ªå…ƒç´ çš„å³å­èŠ‚ç‚¹æ˜¯ï¼š2*n+2ï¼›</li><li>ç¬¬nä¸ªå…ƒç´ çš„çˆ¶èŠ‚ç‚¹æ˜¯ï¼šï¼ˆn-1)/2</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayBinaryTree</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">int</span>[] data = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>&#125;;</span><br><span class="line"><span class="type">ArrayBinaryTree</span> <span class="variable">tree</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayBinaryTree</span>(data);</span><br><span class="line"><span class="comment">//å…ˆåºéå†</span></span><br><span class="line">tree.frontShow(); <span class="comment">//1 2 4 5 3 6 7</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span>[] data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayBinaryTree</span><span class="params">(<span class="type">int</span>[] data)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.data = data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é‡è½½å…ˆåºéå†æ–¹æ³•ï¼Œä¸ç”¨æ¯æ¬¡ä¼ å‚æ•°äº†,ä¿è¯æ¯æ¬¡ä»å¤´å¼€å§‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">frontShow</span><span class="params">()</span> &#123;</span><br><span class="line">frontShow(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å…ˆåºéå†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">frontShow</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (data == <span class="literal">null</span> || data.length == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å…ˆéå†å½“å‰èŠ‚ç‚¹çš„å†…å®¹</span></span><br><span class="line">System.out.print(data[index] + <span class="string">&quot; &quot;</span>);</span><br><span class="line"><span class="comment">//å¤„ç†å·¦å­æ ‘ï¼š2*index+1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="number">2</span> * index + <span class="number">1</span> &lt; data.length) &#123;</span><br><span class="line">frontShow(<span class="number">2</span> * index + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¤„ç†å³å­æ ‘ï¼š2*index+2</span></span><br><span class="line"><span class="keyword">if</span> (<span class="number">2</span> * index + <span class="number">2</span> &lt; data.length) &#123;</span><br><span class="line">frontShow(<span class="number">2</span> * index + <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="10-5çº¿ç´¢äºŒå‰æ ‘">10.5çº¿ç´¢äºŒå‰æ ‘</h3><p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨çº¿ç´¢äºŒå‰æ ‘ï¼Ÿ</strong></p><p>å½“ç”¨äºŒå‰é“¾è¡¨ä½œä¸ºäºŒå‰æ ‘çš„å­˜å‚¨ç»“æ„æ—¶ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„æ‰¾åˆ°æŸä¸ªç»“ç‚¹çš„å·¦å³å­©å­ï¼›ä½†ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ— æ³•ç›´æ¥æ‰¾åˆ°è¯¥ç»“ç‚¹åœ¨æŸç§éå†åºåˆ—ä¸­çš„å‰é©±å’Œåç»§ç»“ç‚¹</p><p><strong>åŸç†</strong>ï¼šnä¸ªç»“ç‚¹çš„äºŒå‰é“¾è¡¨ä¸­å«æœ‰n+1(2n-(n-1)=n+1ä¸ªç©ºæŒ‡é’ˆåŸŸã€‚åˆ©ç”¨äºŒå‰é“¾è¡¨ä¸­çš„ç©ºæŒ‡é’ˆåŸŸï¼Œå­˜æ”¾æŒ‡å‘ç»“ç‚¹åœ¨æŸç§éå†æ¬¡åºä¸‹çš„å‰é©±å’Œåç»§ç»“ç‚¹çš„æŒ‡é’ˆã€‚</p><p><strong>ä¾‹å¦‚</strong>ï¼šæŸä¸ªç»“ç‚¹çš„å·¦å­©å­ä¸ºç©ºï¼Œåˆ™å°†ç©ºçš„å·¦å­©å­æŒ‡é’ˆåŸŸæ”¹ä¸ºæŒ‡å‘å…¶å‰é©±ï¼›å¦‚æœæŸä¸ªç»“ç‚¹çš„å³å­©å­ä¸ºç©ºï¼Œåˆ™å°†ç©ºçš„å³å­©å­æŒ‡é’ˆåŸŸæ”¹ä¸ºæŒ‡å‘å…¶åç»§ï¼ˆè¿™ç§é™„åŠ çš„æŒ‡é’ˆç§°ä¸º&quot;çº¿ç´¢&quot;ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadedBinaryTree</span> &#123;</span><br><span class="line"></span><br><span class="line">    ThreadedNode root;</span><br><span class="line">    <span class="comment">//ç”¨äºä¸´æ—¶å­˜å‚¨å‰é©±èŠ‚ç‚¹</span></span><br><span class="line">    <span class="type">ThreadedNode</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//è®¾ç½®æ ¹èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRoot</span><span class="params">(ThreadedNode root)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.root = root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸­åºçº¿ç´¢åŒ–äºŒå‰æ ‘</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">threadNodes</span><span class="params">()</span> &#123;</span><br><span class="line">        threadNodes(root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">threadNodes</span><span class="params">(ThreadedNode node)</span> &#123;</span><br><span class="line">        <span class="comment">//å½“å‰èŠ‚ç‚¹å¦‚æœä¸ºnullï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¤„ç†å·¦å­æ ‘</span></span><br><span class="line">        threadNodes(node.leftNode);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¤„ç†å‰é©±èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (node.leftNode == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//è®©å½“å‰èŠ‚ç‚¹çš„å·¦æŒ‡é’ˆæŒ‡å‘å‰é©±èŠ‚ç‚¹</span></span><br><span class="line">            node.leftNode = pre;</span><br><span class="line">            <span class="comment">//æ”¹å˜å½“å‰èŠ‚ç‚¹å·¦æŒ‡é’ˆç±»å‹</span></span><br><span class="line">            node.leftType = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¤„ç†å‰é©±çš„å³æŒ‡é’ˆï¼Œå¦‚æœå‰é©±èŠ‚ç‚¹çš„å³æŒ‡é’ˆæ˜¯nullï¼ˆæ²¡æœ‰å³å­æ ‘ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (pre != <span class="literal">null</span> &amp;&amp; pre.rightNode == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//è®©å‰é©±èŠ‚ç‚¹çš„å³æŒ‡é’ˆæŒ‡å‘å½“å‰èŠ‚ç‚¹</span></span><br><span class="line">            pre.rightNode = node;</span><br><span class="line">            <span class="comment">//æ”¹å˜å‰é©±èŠ‚ç‚¹çš„å³æŒ‡é’ˆç±»å‹</span></span><br><span class="line">            pre.rightType = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¯å¤„ç†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå½“å‰èŠ‚ç‚¹æ˜¯ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹</span></span><br><span class="line">        pre = node;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¤„ç†å³å­æ ‘</span></span><br><span class="line">        threadNodes(node.rightNode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éå†çº¿ç´¢äºŒå‰æ ‘</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">threadIterate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//ç”¨äºä¸´æ—¶å­˜å‚¨å½“å‰éå†èŠ‚ç‚¹</span></span><br><span class="line">        <span class="type">ThreadedNode</span> <span class="variable">node</span> <span class="operator">=</span> root;</span><br><span class="line">        <span class="keyword">while</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//å¾ªç¯æ‰¾åˆ°æœ€å¼€å§‹çš„èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">while</span> (node.leftType == <span class="number">0</span>) &#123;</span><br><span class="line">                node = node.leftNode;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//æ‰“å°å½“å‰èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">            System.out.print(node.value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">            <span class="comment">//å¦‚æœå½“å‰èŠ‚ç‚¹çš„å³æŒ‡é’ˆæŒ‡å‘çš„æ˜¯åç»§èŠ‚ç‚¹ï¼Œå¯èƒ½åç»§èŠ‚ç‚¹è¿˜æœ‰åç»§èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">while</span> (node.rightType == <span class="number">1</span>) &#123;</span><br><span class="line">                node = node.rightNode;</span><br><span class="line">                System.out.print(node.value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//æ›¿æ¢éå†çš„èŠ‚ç‚¹</span></span><br><span class="line">            node = node.rightNode;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–æ ¹èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> ThreadedNode <span class="title function_">getRoot</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…ˆåºéå†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">frontShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">            root.frontShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸­åºéå†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">middleShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">            root.middleShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ååºéå†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">            root.afterShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…ˆåºæŸ¥æ‰¾</span></span><br><span class="line">    <span class="keyword">public</span> ThreadedNode <span class="title function_">frontSearch</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> root.frontSearch(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ é™¤ä¸€ä¸ªå­æ ‘</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root.value == i) &#123;</span><br><span class="line">            root = <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            root.delete(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadedNode</span> &#123;</span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹çš„æƒ</span></span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">    <span class="comment">//å·¦å„¿å­</span></span><br><span class="line">    ThreadedNode leftNode;</span><br><span class="line">    <span class="comment">//å³å„¿å­</span></span><br><span class="line">    ThreadedNode rightNode;</span><br><span class="line">    <span class="comment">//æ ‡è¯†æŒ‡é’ˆç±»å‹,1è¡¨ç¤ºæŒ‡å‘ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œ0</span></span><br><span class="line">    <span class="type">int</span> leftType;</span><br><span class="line">    <span class="type">int</span> rightType;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ThreadedNode</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¾ç½®å·¦å„¿å­</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLeftNode</span><span class="params">(ThreadedNode leftNode)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.leftNode = leftNode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¾ç½®å³å„¿å­</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRightNode</span><span class="params">(ThreadedNode rightNode)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.rightNode = rightNode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…ˆåºéå†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">frontShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//å…ˆéå†å½“å‰èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">        System.out.print(value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="comment">//å·¦èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (leftNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            leftNode.frontShow(); <span class="comment">//é€’å½’æ€æƒ³</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å³èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (rightNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            rightNode.frontShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸­åºéå†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">middleShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//å·¦èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (leftNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            leftNode.middleShow(); <span class="comment">//é€’å½’æ€æƒ³</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å…ˆéå†å½“å‰èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">        System.out.print(value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="comment">//å³èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (rightNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            rightNode.middleShow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åç»­éå†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//å·¦èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (leftNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            leftNode.afterShow(); <span class="comment">//é€’å½’æ€æƒ³</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å³èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (rightNode != <span class="literal">null</span>) &#123;</span><br><span class="line">            rightNode.afterShow();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å…ˆéå†å½“å‰èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">        System.out.print(value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…ˆåºæŸ¥æ‰¾</span></span><br><span class="line">    <span class="keyword">public</span> ThreadedNode <span class="title function_">frontSearch</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="type">ThreadedNode</span> <span class="variable">target</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//å¯¹æ¯”å½“å‰èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.value == i) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">            <span class="comment">//å½“å‰èŠ‚ç‚¹ä¸æ˜¯è¦æŸ¥æ‰¾çš„èŠ‚ç‚¹</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//æŸ¥æ‰¾å·¦å„¿å­</span></span><br><span class="line">            <span class="keyword">if</span> (leftNode != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//æŸ¥æ‰¾çš„è¯tèµ‹å€¼ç»™targetï¼ŒæŸ¥ä¸åˆ°targetè¿˜æ˜¯null</span></span><br><span class="line">                target = leftNode.frontSearch(i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å¦‚æœtargetä¸ä¸ºç©ºï¼Œè¯´æ˜åœ¨å·¦å„¿å­ä¸­å·²ç»æ‰¾åˆ°</span></span><br><span class="line">            <span class="keyword">if</span> (target != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> target;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å¦‚æœå·¦å„¿å­æ²¡æœ‰æŸ¥åˆ°ï¼Œå†æŸ¥æ‰¾å³å„¿å­</span></span><br><span class="line">            <span class="keyword">if</span> (rightNode != <span class="literal">null</span>) &#123;</span><br><span class="line">                target = rightNode.frontSearch(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ é™¤ä¸€ä¸ªå­æ ‘</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">        <span class="type">ThreadedNode</span> <span class="variable">parent</span> <span class="operator">=</span> <span class="built_in">this</span>;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­å·¦å„¿å­</span></span><br><span class="line">        <span class="keyword">if</span> (parent.leftNode != <span class="literal">null</span> &amp;&amp; parent.leftNode.value == i) &#123;</span><br><span class="line">            parent.leftNode = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­å³å„¿å­</span></span><br><span class="line">        <span class="keyword">if</span> (parent.rightNode != <span class="literal">null</span> &amp;&amp; parent.rightNode.value == i) &#123;</span><br><span class="line">            parent.rightNode = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¦‚æœéƒ½ä¸æ˜¯ï¼Œé€’å½’æ£€æŸ¥å¹¶åˆ é™¤å·¦å„¿å­</span></span><br><span class="line">        parent = leftNode;</span><br><span class="line">        <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">            parent.delete(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//é€’å½’æ£€æŸ¥å¹¶åˆ é™¤å³å„¿å­</span></span><br><span class="line">        parent = rightNode;</span><br><span class="line">        <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">            parent.delete(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€æ£µæ ‘</span></span><br><span class="line">        <span class="type">ThreadedBinaryTree</span> <span class="variable">binaryTree</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadedBinaryTree</span>();</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªæ ¹èŠ‚ç‚¹</span></span><br><span class="line">        <span class="type">ThreadedNode</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadedNode</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//æŠŠæ ¹èŠ‚ç‚¹èµ‹ç»™æ ‘</span></span><br><span class="line">        binaryTree.setRoot(root);</span><br><span class="line">        <span class="comment">//åˆ›å»ºå·¦,å³èŠ‚ç‚¹</span></span><br><span class="line">        <span class="type">ThreadedNode</span> <span class="variable">rootLeft</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadedNode</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="type">ThreadedNode</span> <span class="variable">rootRight</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadedNode</span>(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//æŠŠæ–°å»ºçš„èŠ‚ç‚¹è®¾ç½®ä¸ºæ ¹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹</span></span><br><span class="line">        root.setLeftNode(rootLeft);</span><br><span class="line">        root.setRightNode(rootRight);</span><br><span class="line">        <span class="comment">//ä¸ºç¬¬äºŒå±‚çš„å·¦èŠ‚ç‚¹åˆ›å»ºä¸¤ä¸ªå­èŠ‚ç‚¹</span></span><br><span class="line">        rootLeft.setLeftNode(<span class="keyword">new</span> <span class="title class_">ThreadedNode</span>(<span class="number">4</span>));</span><br><span class="line">        <span class="type">ThreadedNode</span> <span class="variable">fiveNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadedNode</span>(<span class="number">5</span>);</span><br><span class="line">        rootLeft.setRightNode(fiveNode);</span><br><span class="line">        <span class="comment">//ä¸ºç¬¬äºŒå±‚çš„å³èŠ‚ç‚¹åˆ›å»ºä¸¤ä¸ªå­èŠ‚ç‚¹</span></span><br><span class="line">        rootRight.setLeftNode(<span class="keyword">new</span> <span class="title class_">ThreadedNode</span>(<span class="number">6</span>));</span><br><span class="line">        rootRight.setRightNode(<span class="keyword">new</span> <span class="title class_">ThreadedNode</span>(<span class="number">7</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¸­åºéå†</span></span><br><span class="line">        binaryTree.middleShow(); <span class="comment">//4 2 5 1 6 3 7</span></span><br><span class="line">        System.out.println();</span><br><span class="line">        <span class="comment">//ä¸­åºçº¿ç´¢åŒ–äºŒå‰æ ‘</span></span><br><span class="line">        binaryTree.threadNodes();</span><br><span class="line"><span class="comment">//        //è·å–5çš„åç»§èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">//        ThreadedNode afterFive = fiveNode.rightNode;</span></span><br><span class="line"><span class="comment">//        System.out.println(afterFive.value); //1</span></span><br><span class="line">        binaryTree.threadIterate(); <span class="comment">//4 2 5 1 6 3 7</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-6äºŒå‰æ’åºæ ‘">10.6äºŒå‰æ’åºæ ‘</h3><p><strong>æ¦‚è¿°</strong>ï¼šäºŒå‰æ’åºæ ‘ï¼ˆBinary Sort Treeï¼‰ä¹Ÿå«äºŒå‰æŸ¥æ‰¾æ ‘æˆ–è€…æ˜¯ä¸€é¢—ç©ºæ ‘ï¼Œå¯¹äºäºŒå‰æ ‘ä¸­çš„ä»»ä½•ä¸€ä¸ªéå¶å­èŠ‚ç‚¹ï¼Œè¦æ±‚å·¦å­èŠ‚ç‚¹æ¯”å½“å‰èŠ‚ç‚¹å€¼å°ï¼Œå³å­èŠ‚ç‚¹æ¯”å½“å‰èŠ‚ç‚¹å€¼å¤§</p><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>æŸ¥æ‰¾æ€§èƒ½ä¸æ’å…¥åˆ é™¤æ€§èƒ½éƒ½é€‚ä¸­è¿˜ä¸é”™</li><li>ä¸­åºéå†çš„ç»“æœåˆšå¥½æ˜¯ä»å¤§åˆ°å°</li></ul><p><strong>åˆ›å»ºäºŒå‰æ’åºæ ‘åŸç†</strong>ï¼šå…¶å®å°±æ˜¯ä¸æ–­åœ°æ’å…¥èŠ‚ç‚¹ï¼Œç„¶åè¿›è¡Œæ¯”è¾ƒã€‚</p><p><strong>åˆ é™¤èŠ‚ç‚¹</strong></p><ul><li>åˆ é™¤å¶å­èŠ‚ç‚¹ï¼Œåªéœ€è¦æ‰¾åˆ°çˆ¶èŠ‚ç‚¹ï¼Œå°†çˆ¶èŠ‚ç‚¹ä¸ä»–çš„è¿æ¥æ–­å¼€å³å¯</li><li>åˆ é™¤æœ‰ä¸€ä¸ªå­èŠ‚ç‚¹çš„å°±éœ€è¦å°†ä»–çš„å­èŠ‚ç‚¹æ¢åˆ°ä»–ç°åœ¨çš„ä½ç½®</li><li>åˆ é™¤æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼Œéœ€è¦ä½¿ç”¨ä»–çš„å‰é©±èŠ‚ç‚¹æˆ–è€…åç»§èŠ‚ç‚¹è¿›è¡Œæ›¿æ¢ï¼Œå°±æ˜¯å·¦å­æ ‘æœ€å³ä¸‹æ–¹çš„æ•°ï¼ˆæœ€å¤§çš„é‚£ä¸ªï¼‰æˆ–å³å­æ ‘æœ€å·¦è¾¹çš„æ ‘ï¼ˆæœ€å°çš„æ•°ï¼‰ï¼›å³ç¦»èŠ‚ç‚¹å€¼æœ€æ¥è¿‘çš„å€¼ï¼›ï¼ˆè¿˜è¦æ³¨è§£è¦å»åˆ¤æ–­è¿™ä¸ªå€¼æœ‰æ²¡æœ‰å³èŠ‚ç‚¹ï¼Œæœ‰å°±è¦å°†å³èŠ‚ç‚¹ç§»ä¸Šæ¥ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BinarySortTree</span> &#123;</span><br><span class="line">    Node root;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ·»åŠ èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœæ˜¯ä¸€é¢—ç©ºæ ‘</span></span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            root = node;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            root.add(node);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸­åºéå†</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">middleShow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="literal">null</span>) &#123;</span><br><span class="line">            root.middleShow(root);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŸ¥æ‰¾èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> Node <span class="title function_">search</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root.search(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŸ¥æ‰¾çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> Node <span class="title function_">searchParent</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root.searchParent(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//æ‰¾åˆ°è¿™ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            <span class="type">Node</span> <span class="variable">target</span> <span class="operator">=</span> search(value);</span><br><span class="line">            <span class="comment">//å¦‚æœæ²¡æœ‰è¿™ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (target == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//æ‰¾åˆ°ä»–çš„çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">            <span class="type">Node</span> <span class="variable">parent</span> <span class="operator">=</span> searchParent(value);</span><br><span class="line">            <span class="comment">//è¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (target.left == <span class="literal">null</span> &amp;&amp; target.left == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//è¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">if</span> (parent.left.value == value) &#123;</span><br><span class="line">                    parent.left = <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//è¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    parent.right = <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//è¦åˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹çš„æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (target.left != <span class="literal">null</span> &amp;&amp; target.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">//åˆ é™¤å³å­æ ‘ä¸­å€¼æœ€å°çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”è·å–åˆ°å€¼</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> deletMin(target.right);</span><br><span class="line">                <span class="comment">//æ›¿æ¢ç›®æ ‡èŠ‚ç‚¹ä¸­çš„å€¼</span></span><br><span class="line">                target.value = min;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//è¦åˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸€ä¸ªå·¦å­èŠ‚ç‚¹æˆ–å³å­èŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//æœ‰å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">if</span> (target.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//è¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">                    <span class="keyword">if</span> (parent.left.value == value) &#123;</span><br><span class="line">                        parent.left = target.left;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//è¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹</span></span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        parent.right = target.left;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//æœ‰å³å­èŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//è¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹</span></span><br><span class="line">                    <span class="keyword">if</span> (parent.left.value == value) &#123;</span><br><span class="line">                        parent.left = target.right;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//è¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯çˆ¶èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹</span></span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        parent.right = target.right;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ é™¤ä¸€æ£µæ ‘ä¸­æœ€å°çš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">deletMin</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">target</span> <span class="operator">=</span> node;</span><br><span class="line">        <span class="comment">//é€’å½’å‘å·¦æ‰¾æœ€å°å€¼</span></span><br><span class="line">        <span class="keyword">while</span> (target.left != <span class="literal">null</span>) &#123;</span><br><span class="line">            target = target.left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åˆ é™¤æœ€å°çš„èŠ‚ç‚¹</span></span><br><span class="line">        delete(target.value);</span><br><span class="line">        <span class="keyword">return</span> target.value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">    Node left;</span><br><span class="line">    Node right;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘å­æ ‘ä¸­æ·»åŠ èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*åˆ¤æ–­ä¼ å…¥çš„èŠ‚ç‚¹çš„å€¼æ¯”å½“å‰ç´«è–¯çš„æ ¹èŠ‚ç‚¹çš„å€¼å¤§è¿˜æ˜¯å°*/</span></span><br><span class="line">        <span class="comment">//æ·»åŠ çš„èŠ‚ç‚¹æ¯”å½“å‰èŠ‚ç‚¹æ›´å°(ä¼ ç»™å·¦èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (node.value &lt; <span class="built_in">this</span>.value) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœå·¦èŠ‚ç‚¹ä¸ºç©º</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.left == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.left = node;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å¦‚æœä¸ä¸ºç©º</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.left.add(node);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ·»åŠ çš„èŠ‚ç‚¹æ¯”å½“å‰èŠ‚ç‚¹æ›´å¤§(ä¼ ç»™å³èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.right == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.right = node;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.right.add(node);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸­åºéå†äºŒå‰æ’åºæ ‘ï¼Œç»“æœåˆšå¥½æ˜¯ä»å°åˆ°å¤§</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">middleShow</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        middleShow(node.left);</span><br><span class="line">        System.out.print(node.value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        middleShow(node.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŸ¥æ‰¾èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> Node <span class="title function_">search</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.value == value) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value &lt; <span class="built_in">this</span>.value) &#123;</span><br><span class="line">            <span class="keyword">if</span> (left == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> left.search(value);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (right == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> right.search(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŸ¥æ‰¾çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> Node <span class="title function_">searchParent</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="built_in">this</span>.left != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.left.value == value) || (<span class="built_in">this</span>.right != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.right.value == value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.value &gt; value &amp;&amp; <span class="built_in">this</span>.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.left.searchParent(value);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.value &lt; value &amp;&amp; <span class="built_in">this</span>.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.right.searchParent(value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] arr = &#123;<span class="number">8</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">13</span>&#125;;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€é¢—äºŒå‰æ’åºæ ‘</span></span><br><span class="line">        <span class="type">BinarySortTree</span> <span class="variable">bst</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BinarySortTree</span>();</span><br><span class="line">        <span class="comment">//å¾ªç¯æ·»åŠ </span></span><br><span class="line"><span class="comment">/*        for(int i=0;i&lt; arr.length;i++) &#123;</span></span><br><span class="line"><span class="comment">            bst.add(new Node(arr[i]));</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i : arr) &#123;</span><br><span class="line">            bst.add(<span class="keyword">new</span> <span class="title class_">Node</span>(i));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¸­åºéå†</span></span><br><span class="line">        bst.middleShow(); <span class="comment">//1 3 4 6 7 8 10 13 14</span></span><br><span class="line">        System.out.println();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æŸ¥æ‰¾èŠ‚ç‚¹</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> bst.search(<span class="number">10</span>);</span><br><span class="line">        System.out.println(node.value);<span class="comment">//10</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Node</span> <span class="variable">node2</span> <span class="operator">=</span> bst.search(<span class="number">20</span>);</span><br><span class="line">        System.out.println(node2); <span class="comment">//null</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//æŸ¥æ‰¾çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">node3</span> <span class="operator">=</span> bst.searchParent(<span class="number">1</span>);</span><br><span class="line">        <span class="type">Node</span> <span class="variable">node4</span> <span class="operator">=</span> bst.searchParent(<span class="number">14</span>);</span><br><span class="line">        System.out.println(node3.value); <span class="comment">//3</span></span><br><span class="line">        System.out.println(node4.value); <span class="comment">//10</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ é™¤å¶å­èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">//        bst.delete(13);</span></span><br><span class="line"><span class="comment">//        bst.middleShow(); //1 3 4 6 7 8 10 14</span></span><br><span class="line"><span class="comment">//        System.out.println();</span></span><br><span class="line"><span class="comment">//        //åˆ é™¤åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹çš„èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">//        bst.delete(10);</span></span><br><span class="line"><span class="comment">//        bst.middleShow(); //1 3 4 6 7 8 ï¼›10å’Œ14éƒ½æ²¡äº†</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ é™¤æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹çš„èŠ‚ç‚¹</span></span><br><span class="line">        bst.delete(<span class="number">3</span>);</span><br><span class="line">        bst.middleShow(); <span class="comment">//1 4 6 7 8 10 13 14</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="10-7å¹³è¡¡äºŒå‰æ ‘">10.7å¹³è¡¡äºŒå‰æ ‘</h3><p>å¹³è¡¡äºŒå‰æ ‘ï¼ˆBalanced Binary Treeï¼‰åˆè¢«ç§°ä¸ºAVLæ ‘ï¼Œä¸”å…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼šå®ƒæ˜¯ä¸€æ£µç©ºæ ‘æˆ–å®ƒçš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1ï¼Œå¹¶ä¸”å·¦å³ä¸¤ä¸ªå­æ ‘éƒ½æ˜¯ä¸€æ£µå¹³è¡¡äºŒå‰æ ‘ã€‚è¿™ä¸ªæ–¹æ¡ˆå¾ˆå¥½çš„è§£å†³äº†äºŒå‰æŸ¥æ‰¾æ ‘é€€åŒ–æˆé“¾è¡¨çš„é—®é¢˜ï¼ŒæŠŠæ’å…¥ï¼ŒæŸ¥æ‰¾ï¼Œåˆ é™¤çš„æ—¶é—´å¤æ‚åº¦æœ€å¥½æƒ…å†µå’Œæœ€åæƒ…å†µéƒ½ç»´æŒåœ¨<code>O(logN)</code>ã€‚ä½†æ˜¯é¢‘ç¹æ—‹è½¬ä¼šä½¿æ’å…¥å’Œåˆ é™¤ç‰ºç‰²æ‰<code>O(logN)</code>å·¦å³çš„æ—¶é—´ï¼Œä¸è¿‡ç›¸å¯¹äºŒå‰æŸ¥æ‰¾æ ‘æ¥è¯´ï¼Œæ—¶é—´ä¸Šç¨³å®šäº†å¾ˆå¤šã€‚</p><p><strong>å¹³è¡¡å› å­ BF</strong></p><ul><li>å®šä¹‰ï¼šå·¦å­æ ‘å’Œå³å­æ ‘é«˜åº¦å·®</li><li>è®¡ç®—ï¼š<code>å·¦å­æ ‘é«˜åº¦ - å³å­æ ‘é«˜åº¦çš„å€¼</code></li><li>åˆ«åï¼šç®€ç§° BFï¼ˆBalance Factorï¼‰</li><li>ä¸€èˆ¬æ¥è¯´ BF çš„ç»å¯¹å€¼å¤§äº 1ï¼Œ,å¹³è¡¡æ ‘äºŒå‰æ ‘å°±å¤±è¡¡ï¼Œéœ€è¦æ—‹è½¬çº æ­£</li></ul><p><strong>æœ€å°ä¸å¹³è¡¡å­æ ‘</strong></p><ul><li>è·ç¦»æ’å…¥èŠ‚ç‚¹æœ€è¿‘çš„ï¼Œå¹¶ä¸” BF çš„ç»å¯¹å€¼å¤§äº 1 çš„èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘ã€‚</li><li>æ—‹è½¬çº æ­£åªéœ€è¦çº æ­£æœ€å°ä¸å¹³è¡¡å­æ ‘å³å¯</li></ul><h4 id="æ—‹è½¬æ–¹å¼">æ—‹è½¬æ–¹å¼</h4><p><strong>2 ç§æ—‹è½¬æ–¹å¼</strong>:</p><p>å·¦æ—‹ :</p><ul><li>æ—§æ ¹èŠ‚ç‚¹ä¸ºæ–°æ ¹èŠ‚ç‚¹çš„å·¦å­æ ‘</li><li>æ–°æ ¹èŠ‚ç‚¹çš„å·¦å­æ ‘ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ä¸ºæ—§æ ¹èŠ‚ç‚¹çš„å³å­æ ‘</li></ul><p>å³æ—‹ï¼š</p><ul><li>æ—§æ ¹èŠ‚ç‚¹ä¸ºæ–°æ ¹èŠ‚ç‚¹çš„å³å­æ ‘</li><li>æ–°æ ¹èŠ‚ç‚¹çš„å³å­æ ‘ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ä¸ºæ—§æ ¹èŠ‚ç‚¹çš„å·¦å­æ ‘</li></ul><p><strong>4 ç§æ—‹è½¬çº æ­£ç±»å‹</strong>ï¼š</p><ul><li>å·¦å·¦å‹ï¼šæ’å…¥å·¦å­©å­çš„å·¦å­æ ‘ï¼Œå³æ—‹</li><li>å³å³å‹ï¼šæ’å…¥å³å­©å­çš„å³å­æ ‘ï¼Œå·¦æ—‹</li><li>å·¦å³å‹ï¼šæ’å…¥å·¦å­©å­çš„å³å­æ ‘ï¼Œå…ˆå·¦æ—‹ï¼Œå†å³æ—‹</li><li>å³å·¦å‹ï¼šæ’å…¥å³å­©å­çš„å·¦å­æ ‘ï¼Œå…ˆå³æ—‹ï¼Œå†å·¦æ—‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">    Node left;</span><br><span class="line">    Node right;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–å½“å‰èŠ‚ç‚¹é«˜åº¦</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">height</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Math.max(left == <span class="literal">null</span> ? <span class="number">0</span> : left.height(), right == <span class="literal">null</span> ? <span class="number">0</span> : right.height()) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–å·¦å­æ ‘é«˜åº¦</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">leftHeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (left == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left.height();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–å³å­æ ‘é«˜åº¦</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">rightHeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (right == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> right.height();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘å­æ ‘ä¸­æ·»åŠ èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*åˆ¤æ–­ä¼ å…¥çš„èŠ‚ç‚¹çš„å€¼æ¯”å½“å‰ç´«è–¯çš„æ ¹èŠ‚ç‚¹çš„å€¼å¤§è¿˜æ˜¯å°*/</span></span><br><span class="line">        <span class="comment">//æ·»åŠ çš„èŠ‚ç‚¹æ¯”å½“å‰èŠ‚ç‚¹æ›´å°(ä¼ ç»™å·¦èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (node.value &lt; <span class="built_in">this</span>.value) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœå·¦èŠ‚ç‚¹ä¸ºç©º</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.left == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.left = node;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å¦‚æœä¸ä¸ºç©º</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.left.add(node);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ·»åŠ çš„èŠ‚ç‚¹æ¯”å½“å‰èŠ‚ç‚¹æ›´å¤§(ä¼ ç»™å³èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.right == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="built_in">this</span>.right = node;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.right.add(node);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æŸ¥è¯¢æ˜¯å¦å¹³è¡¡</span></span><br><span class="line">        <span class="comment">//å³æ—‹è½¬</span></span><br><span class="line">        <span class="keyword">if</span> (leftHeight() - rightHeight() &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="comment">//åŒæ—‹è½¬ï¼Œå½“å·¦å­æ ‘å·¦è¾¹é«˜åº¦å°äºå·¦å­æ ‘å³è¾¹é«˜åº¦æ—¶</span></span><br><span class="line">            <span class="keyword">if</span> (left != <span class="literal">null</span> &amp;&amp; left.leftHeight() &lt; left.rightHeight()) &#123;</span><br><span class="line">                <span class="comment">//å·¦å­æ ‘å…ˆè¿›è¡Œå·¦æ—‹è½¬</span></span><br><span class="line">                left.leftRotate();</span><br><span class="line">                <span class="comment">//æ•´ä½“è¿›è¡Œå³æ—‹è½¬</span></span><br><span class="line">                rightRotate();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å•æ—‹è½¬</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                rightRotate();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å·¦æ—‹è½¬</span></span><br><span class="line">        <span class="keyword">if</span> (leftHeight() - rightHeight() &lt;= -<span class="number">2</span>) &#123;</span><br><span class="line">            <span class="comment">//åŒæ—‹è½¬</span></span><br><span class="line">            <span class="keyword">if</span> (right != <span class="literal">null</span> &amp;&amp; right.rightHeight() &lt; right.leftHeight()) &#123;</span><br><span class="line">                right.rightRotate();</span><br><span class="line">                leftRotate();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å•æ—‹è½¬</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                leftRotate();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å³æ—‹è½¬</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">rightRotate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ï¼Œå€¼ç­‰äºå½“å‰èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">newRight</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(value);</span><br><span class="line">        <span class="comment">//æŠŠæ–°èŠ‚ç‚¹çš„å³å­æ ‘è®¾ç½®ä¸ºå½“å‰èŠ‚ç‚¹çš„å³å­æ ‘</span></span><br><span class="line">        newRight.right = right;</span><br><span class="line">        <span class="comment">//æŠŠæ–°èŠ‚ç‚¹çš„å·¦å­æ ‘è®¾ç½®ä¸ºå½“å‰èŠ‚ç‚¹çš„å·¦å­æ ‘çš„å³å­æ ‘</span></span><br><span class="line">        newRight.left = left.right;</span><br><span class="line">        <span class="comment">//æŠŠå½“å‰èŠ‚ç‚¹çš„å€¼æ¢ä½å·¦å­èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">        value = left.value;</span><br><span class="line">        <span class="comment">//æŠŠå½“å‰èŠ‚ç‚¹çš„å·¦å­æ ‘è®¾ç½®ä¸ºå·¦å­æ ‘çš„å·¦å­æ ‘</span></span><br><span class="line">        left = left.left;</span><br><span class="line">        <span class="comment">//æŠŠå½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºæ–°èŠ‚ç‚¹</span></span><br><span class="line">        right = newRight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å·¦æ—‹è½¬</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">leftRotate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ï¼Œå€¼ç­‰äºå½“å‰èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">newLeft</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(value);</span><br><span class="line">        <span class="comment">//æŠŠæ–°èŠ‚ç‚¹çš„å·¦å­æ ‘è®¾ç½®ä¸ºå½“å‰èŠ‚ç‚¹çš„å·¦å­æ ‘</span></span><br><span class="line">        newLeft.left = left;</span><br><span class="line">        <span class="comment">//æŠŠæ–°èŠ‚ç‚¹çš„å³å­æ ‘è®¾ç½®ä¸ºå½“å‰èŠ‚ç‚¹çš„å³å­æ ‘çš„å·¦å­æ ‘</span></span><br><span class="line">        newLeft.right = right.left;</span><br><span class="line">        <span class="comment">//æŠŠå½“å‰èŠ‚ç‚¹çš„å€¼æ¢ä½å³å­èŠ‚ç‚¹çš„å€¼</span></span><br><span class="line">        value = right.value;</span><br><span class="line">        <span class="comment">//æŠŠå½“å‰èŠ‚ç‚¹çš„å³å­æ ‘è®¾ç½®ä¸ºå³å­æ ‘çš„å³å­æ ‘</span></span><br><span class="line">        right = right.right;</span><br><span class="line">        <span class="comment">//æŠŠå½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºæ–°èŠ‚ç‚¹</span></span><br><span class="line">        left = newLeft;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸­åºéå†äºŒå‰æ’åºæ ‘ï¼Œç»“æœåˆšå¥½æ˜¯ä»å°åˆ°å¤§</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">middleShow</span><span class="params">(Node node)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        middleShow(node.left);</span><br><span class="line">        System.out.print(node.value + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        middleShow(node.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŸ¥æ‰¾èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> Node <span class="title function_">search</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.value == value) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value &lt; <span class="built_in">this</span>.value) &#123;</span><br><span class="line">            <span class="keyword">if</span> (left == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> left.search(value);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (right == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> right.search(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŸ¥æ‰¾çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> Node <span class="title function_">searchParent</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="built_in">this</span>.left != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.left.value == value) || (<span class="built_in">this</span>.right != <span class="literal">null</span> &amp;&amp; <span class="built_in">this</span>.right.value == value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.value &gt; value &amp;&amp; <span class="built_in">this</span>.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.left.searchParent(value);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.value &lt; value &amp;&amp; <span class="built_in">this</span>.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">this</span>.right.searchParent(value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] arr = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€é¢—äºŒå‰æ’åºæ ‘</span></span><br><span class="line">        <span class="type">BinarySortTree</span> <span class="variable">bst</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BinarySortTree</span>();</span><br><span class="line">        <span class="comment">//å¾ªç¯æ·»åŠ </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i : arr) &#123;</span><br><span class="line">            bst.add(<span class="keyword">new</span> <span class="title class_">Node</span>(i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æŸ¥çœ‹é«˜åº¦</span></span><br><span class="line">        System.out.println(bst.root.height()); <span class="comment">//3</span></span><br><span class="line">        <span class="comment">//æŸ¥çœ‹èŠ‚ç‚¹å€¼</span></span><br><span class="line">        System.out.println(bst.root.value); <span class="comment">//æ ¹èŠ‚ç‚¹ä¸º4</span></span><br><span class="line">        System.out.println(bst.root.left.value); <span class="comment">//å·¦å­èŠ‚ç‚¹ä¸º2</span></span><br><span class="line">        System.out.println(bst.root.right.value); <span class="comment">//å³å­èŠ‚ç‚¹ä¸º5</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬æ–‡ä¸»è¦æ˜¯ç¬”è€…åœ¨å­¦ä¹ javaæ•°æ®ç»“æ„å’Œç®—æ³•çš„ç¬”è®°</summary>
    
    
    
    <category term="javaå­¦ä¹ " scheme="https://luoxiaohei520.github.io/categories/java%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="javaå­¦ä¹ " scheme="https://luoxiaohei520.github.io/tags/java%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>ç³»ç»Ÿæ¶æ„å¸ˆä¸Šåˆé¢˜çŸ¥è¯†ç‚¹</title>
    <link href="https://luoxiaohei520.github.io/posts/7593676.html"/>
    <id>https://luoxiaohei520.github.io/posts/7593676.html</id>
    <published>2023-11-09T02:50:23.344Z</published>
    <updated>2023-11-09T02:50:23.344Z</updated>
    
    <content type="html"><![CDATA[<h1>ç³»ç»Ÿæ¶æ„å¸ˆ</h1><h2 id="è®¡ç®—æœºç»„æˆä¸ä½“ç³»ç»“æ„">è®¡ç®—æœºç»„æˆä¸ä½“ç³»ç»“æ„</h2><h3 id="è®¡ç®—æœºç³»ç»Ÿç»„æˆ">è®¡ç®—æœºç³»ç»Ÿç»„æˆ</h3><ul><li><p>è®¡ç®—æœºç¡¬ä»¶ç»„æˆ</p><ul><li><p>æ§åˆ¶å™¨</p><ul><li>è®¡ç®—æœºçš„æŒ‡æŒ¥ä¸­å¿ƒï¼Œè´Ÿè´£å†³å®šæ‰§è¡Œç¨‹åºçš„é¡ºåºï¼Œç»™å‡ºæ‰§è¡ŒæŒ‡ä»¤æ—¶æœºå™¨å„éƒ¨åˆ†æ‰€éœ€è¦çš„æ“ä½œæ§åˆ¶å‘½ä»¤</li><li>ç¨‹åºè®¡æ•°å™¨ã€æŒ‡ä»¤å¯„å­˜å™¨ã€æŒ‡ä»¤è¯‘ç å™¨ã€æ—¶åºäº§ç”Ÿå™¨ã€æ“ä½œæ§åˆ¶å™¨</li></ul></li><li><p>è¿ç®—å™¨</p><ul><li>æœ€å°‘åŒ…æ‹¬3ä¸ªå¯„å­˜å™¨å’Œ1ä¸ªç®—æœ¯é€»è¾‘å•å…ƒ</li></ul></li><li><p>ä¸»å­˜å‚¨å™¨</p><ul><li>å†…å­˜</li></ul></li><li><p>è¾…åŠ©å­˜å‚¨å™¨</p><ul><li>ç¡¬ç›˜</li></ul></li><li><p>è¾“å…¥è®¾å¤‡</p><ul><li>é”®ç›˜ã€é¼ æ ‡ã€è§¦æ‘¸æ¿ç­‰</li></ul></li><li><p>è¾“å‡ºè®¾å¤‡</p><ul><li>æ˜¾ç¤ºå™¨ã€æŒ‡ç¤ºç¯ç­‰</li></ul></li></ul></li><li><p>è®¡ç®—æœºä½“ç³»ç»“æ„åˆ†ç±»</p><ul><li><p>å†¯è¯ºä¾æ›¼</p><ul><li>æŒ‡ä»¤åœ°å€å’Œæ•°æ®åœ°å€åœ¨ä¸€èµ·</li></ul></li><li><p>å“ˆä½›ç»“æ„</p><ul><li>æŒ‡ä»¤åœ°å€å’Œæ•°æ®åœ°å€åˆ†å¼€</li></ul></li><li><p>Flynnåˆ†ç±»æ³•</p><ul><li>å•æŒ‡ä»¤å•æ•°æ®æµ SISD</li><li>å•æŒ‡ä»¤å¤šæ•°æ®æµ SIMD</li><li>å¤šæŒ‡ä»¤å•æ•°æ®æµ MISD</li><li>å¤šæŒ‡ä»¤å¤šæ•°æ®æµ MIMD</li></ul></li></ul></li><li><p>å¤æ‚æŒ‡ä»¤é›†ç³»ç»Ÿä¸ç²¾ç®€æŒ‡ä»¤é›†ç³»ç»Ÿ</p><ul><li><p>CICSå¤æ‚æŒ‡ä»¤ç³»ç»Ÿ</p><ul><li>æŒ‡ä»¤æ•°æ®ä¼—å¤š</li><li>æŒ‡ä»¤ä½¿ç”¨é¢‘ç‡ç›¸å·®æ‚¬æ®Š</li><li>æ”¯æŒå¤šç§å¯»å€æ–¹å¼</li><li>å˜é•¿æŒ‡ä»¤</li><li>æŒ‡ä»¤å¯ä»¥å¯¹ä¸»å­˜å‚¨å•å…ƒä¸­çš„æ•°æ®ç›´æ¥å¤„ç†</li><li>ä»¥å¾®ç¨‹åºæ§åˆ¶ä¸ºä¸»</li></ul></li><li><p>RICSç²¾ç®€æŒ‡ä»¤ç³»ç»Ÿ</p><ul><li>æŒ‡ä»¤æ•°é‡å°‘</li><li>æŒ‡ä»¤å¯»å€æ–¹å¼å°‘ï¼ŒæŒ‡ä»¤æ ¼å¼ç§ç±»å°‘</li><li>æŒ‡ä»¤é•¿åº¦å›ºå®š</li><li>ä»¥ç¡¬å¸ƒçº¿æ§åˆ¶é€»è¾‘ä¸ºä¸»</li><li>å•å‘¨æœŸæŒ‡ä»¤æ‰§è¡Œï¼Œé‡‡ç”¨æµæ°´çº¿æŠ€æœ¯</li><li>ä¼˜åŒ–çš„ç¼–è¯‘å™¨</li><li>CPUä¸­é€šç”¨çš„å¯„å­˜å™¨æ•°é‡å¤šï¼Œä¸€èˆ¬32ä¸ªå¤šåˆ™ä¸Šåƒä¸ª</li></ul></li></ul></li><li><p>æ€»çº¿</p><ul><li>åœ°å€æ€»çº¿</li><li>æ•°æ®æ€»çº¿</li><li>æ§åˆ¶æ€»çº¿</li></ul></li></ul><h3 id="å­˜å‚¨å™¨ç³»ç»Ÿ">å­˜å‚¨å™¨ç³»ç»Ÿ</h3><ul><li><p>ä¸»å­˜å‚¨å™¨</p><ul><li>RAMéšæœºå­˜å‚¨å™¨</li><li>ROMåªè¯»å­˜å‚¨å™¨</li></ul></li><li><p>è¾…å­˜å‚¨å™¨</p><ul><li>ç¡¬ç›˜</li></ul></li><li><p>cacheå­˜å‚¨å™¨</p></li></ul><h3 id="æµæ°´çº¿">æµæ°´çº¿</h3><ul><li><p>æµæ°´çº¿å‘¨æœŸ</p><ul><li>å°†æµæ°´çº¿åˆ†å‰²æˆNæ®µï¼Œæœ€è€—æ—¶çš„é‚£ä¸€æ®µå³ä¸ºæµæ°´çº¿çš„ç”Ÿå‘½å‘¨æœŸ</li></ul></li><li><p>æµæ°´çº¿æ‰§è¡Œæ—¶é—´è®¡ç®—</p><ul><li><p>æµæ°´çº¿å‘¨æœŸTï¼ŒèŠ±è´¹æ—¶é—´æœ€é•¿çš„æ­¥éª¤</p></li><li><p>æ‰§è¡Œ100æ¡æŒ‡ä»¤</p><ul><li>100T+å…¶ä»–æ­¥éª¤çš„1æ¬¡æ—¶é—´</li></ul></li></ul></li><li><p>æµæ°´çº¿ååé‡</p><ul><li>å•ä½æ—¶é—´å†…æµæ°´çº¿å®Œæˆçš„ä»»åŠ¡é‡æˆ–è€…æ•°æ®çš„ç»“æœé‡</li></ul></li><li><p>æµæ°´çº¿åŠ é€Ÿæ¯”</p><ul><li>ä¸ä½¿ç”¨æµæ°´çº¿æ‰§è¡Œæ—¶é—´ / ä½¿ç”¨æµæ°´çº¿çš„æ‰§è¡Œæ—¶é—´</li></ul></li></ul><h2 id="æ“ä½œç³»ç»Ÿ">æ“ä½œç³»ç»Ÿ</h2><h3 id="æ“ä½œç³»ç»Ÿçš„ç±»å‹ä¸ç»“æ„">æ“ä½œç³»ç»Ÿçš„ç±»å‹ä¸ç»“æ„</h3><ul><li><p>æ“ä½œç³»ç»Ÿçš„å®šä¹‰</p><ul><li>ç®¡ç†è®¡ç®—æœºç¡¬ä»¶å’Œè½¯ä»¶èµ„æºçš„ç³»ç»Ÿè½¯ä»¶ï¼Œæ˜¯è®¡ç®—æœºçš„å†…æ ¸å’ŒåŸºçŸ³</li></ul></li><li><p>æ“ä½œç³»ç»Ÿçš„åˆ†ç±»</p><ul><li>æ‰¹å¤„ç†æ“ä½œç³»ç»Ÿ</li><li>åˆ†æ—¶æ“ä½œç³»ç»Ÿ</li><li>å®æ—¶æ“ä½œç³»ç»Ÿ</li><li>ç½‘ç»œæ“ä½œç³»ç»Ÿ</li><li>åˆ†å¸ƒå¼æ“ä½œç³»ç»Ÿ</li></ul></li></ul><h3 id="æ“ä½œç³»ç»Ÿçš„åŸºæœ¬åŸç†">æ“ä½œç³»ç»Ÿçš„åŸºæœ¬åŸç†</h3><ul><li>è¿›ç¨‹ç®¡ç†</li><li>å­˜å‚¨ç®¡ç†</li><li>è®¾å¤‡ç®¡ç†</li><li>æ–‡ä»¶ç®¡ç†</li><li>ä½œä¸šç®¡ç†</li></ul><h2 id="æ•°æ®åº“ç³»ç»Ÿ">æ•°æ®åº“ç³»ç»Ÿ</h2><h3 id="æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„ç±»å‹">æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„ç±»å‹</h3><h3 id="æ•°æ®åº“çš„æ¨¡å¼ä¸èŒƒå¼">æ•°æ®åº“çš„æ¨¡å¼ä¸èŒƒå¼</h3><ul><li><p>æ•°æ®åº“çš„ç»“æ„ä¸æ¨¡å¼</p><ul><li><p>å¤–æ¨¡å¼/ç”¨æˆ·æ¨¡å¼</p><ul><li>ç”¨æˆ·ä¸æ•°æ®åº“ä¹‹é—´çš„æ¥å£ï¼Œå¯¹ç”¨æˆ·ä½¿ç”¨æ•°æ®çš„è¡¨ç¤ºï¼Œç±»å¦‚æ•°æ®åº“çš„è¡¨</li></ul></li><li><p>æ¦‚å¿µæ¨¡å¼</p><ul><li>æ¦‚å¿µæ¨¡å¼åæ˜ äº†æ•°æ®åº“ç³»ç»Ÿçš„æ•´ä½“è§‚</li></ul></li><li><p>å†…æ¨¡å¼</p><ul><li>æ•°æ®åº“ä¸­å…¨ä½“æ•°æ®çš„å†…éƒ¨è¡¨ç¤ºæˆ–åº•å±‚æè¿°</li></ul></li></ul></li><li><p>æ•°æ®æ¨¡å‹</p><ul><li><p>æ¦‚å¿µæ•°æ®æ¨¡å‹</p><ul><li>æŒ‰ç…§ç”¨æˆ·çš„è§‚ç‚¹å¯¹æ•°æ®å’Œä¿¡æ¯è¿›è¡Œå»ºæ¨¡ï¼Œä¸»è¦ç”¨ä¹¦æ•°æ®åº“è®¾è®¡</li></ul></li><li><p>åŸºæœ¬æ•°æ®æ¨¡å‹</p><ul><li><p>å±‚æ¬¡æ¨¡å‹</p><ul><li>ä¼˜ç‚¹ï¼šæŸ¥è¯¢æ•ˆç‡é«˜ 1ï¼šn</li><li>ç¼ºç‚¹ï¼šå¯¹ n:néœ€è¦è¾…åŠ©å®ç°ï¼Œä¸”é€»è¾‘å¤æ‚</li></ul></li><li><p>ç½‘çŠ¶æ¨¡å‹</p><ul><li>ä¼˜ç‚¹ï¼šmï¼šnæŸ¥è¯¢æ•ˆç‡é«˜</li><li>ç¼ºç‚¹ï¼šç¼–å†™åº”ç”¨ç¨‹åºè¿‡äºå¤æ‚</li></ul></li><li><p>å…³ç³»æ¨¡å‹</p></li><li><p>NoSQL</p><ul><li>Not only SQL</li></ul></li></ul></li></ul></li><li><p>å…³ç³»ä»£æ•°</p><ul><li><p>å¹¶</p><ul><li>ç›¸å½“äºSQLä¸­çš„unionï¼ŒAâˆªB</li></ul></li><li><p>äº¤</p><ul><li>ç›¸å½“äºSQLä¸­çš„intersectï¼ŒAâˆ©B</li></ul></li><li><p>å·®</p><ul><li>ç›¸å½“äºSQLä¸­çš„exceptï¼ŒA-B</li></ul></li><li><p>æŠ•å½±</p><ul><li>ç›¸å½“äºSQLä¸­çš„select</li></ul></li><li><p>ç¬›å¡å°”ä¹˜ç§¯</p><ul><li>ç­‰ä»·äºSQLä¸­ä¸¤ä¸ªè¡¨è¿›è¡Œç¬›å¡å°”ç§¯å…¨åŒ¹é…å¾—åˆ°çš„ç»“æœAXB</li></ul></li><li><p>è‡ªç„¶è¿æ¥</p><ul><li>ç›¸å½“äºSQLè¯­å¥ä¸­çš„natural joinï¼ŒAâ‹ˆB</li></ul></li><li><p>é™¤</p></li></ul></li><li><p>æ•°æ®çš„è§„èŒƒåŒ–</p><ul><li><p>ç¬¬ä¸€èŒƒå¼</p><ul><li>å±æ€§å…·æœ‰åŸå­æ€§ï¼Œä¸å¯å†åˆ†</li></ul></li><li><p>ç¬¬äºŒèŒƒå¼</p><ul><li>è®°å½•çš„å”¯ä¸€æ€§ï¼Œæ¶ˆé™¤éä¸»é”®ä¾èµ–</li></ul></li><li><p>ç¬¬ä¸‰èŒƒå¼</p><ul><li>å­—æ®µçš„å†—ä½™ï¼Œæ¶ˆé™¤ä¼ é€’ä¾èµ–</li></ul></li><li><p>BCNF</p><ul><li>é²å°”æ–¯-ç§‘å¾—èŒƒå¼</li></ul></li></ul></li><li><p>åèŒƒå¼åŒ–</p><ul><li>æ²¡æœ‰å†—ä½™çš„æ•°æ®åº“æœªå¿…æ˜¯æœ€å¥½çš„æ•°æ®åº“ï¼Œå¢åŠ å†—ä½™ï¼Œä»¥ç©ºé—´æ¢æ—¶é—´</li><li>å¢åŠ å†—ä½™åˆ—</li><li>å¢åŠ æ´¾ç”Ÿåˆ—</li><li>é‡æ–°ä¸»è¡¨</li></ul></li></ul><h3 id="æ•°æ®åº“è®¾è®¡">æ•°æ®åº“è®¾è®¡</h3><ul><li><p>æ•°æ®åº“è®¾è®¡æ–¹å¼</p><ul><li><p>ç›´è§‚è®¾è®¡æ³•</p><ul><li>åˆç§°å•æ­¥é€»è¾‘è®¾è®¡æ³•ï¼Œä¾èµ–äºè®¾è®¡è€…çš„çŸ¥è¯†ã€ç»éªŒå’ŒæŠ€å·§</li></ul></li><li><p>è§„èŒƒè®¾è®¡æ³•</p><ul><li>æ•°æ®åº“è®¾è®¡è§„èŒƒï¼ŒæŠŠæ•°æ®è®¾è®¡åˆ†ä¸ºéœ€æ±‚åˆ†æï¼Œæ¦‚å¿µç»“æ„è®¾è®¡ï¼Œé€»è¾‘ç»“æ„è®¾è®¡å’Œç‰©ç†è®¾è®¡4ä¸ªé˜¶æ®µ</li></ul></li><li><p>è‡ªåŠ¨åŒ–è®¾è®¡æ³•</p></li></ul></li><li><p>æ•°æ®è®¾è®¡çš„åŸºæœ¬æ­¥éª¤</p><ul><li><p>éœ€æ±‚åˆ†æ</p><ul><li><p>æ”¶é›†å’Œåˆ†æç”¨æˆ·å¯¹ç³»ç»Ÿçš„ä¿¡æ¯éœ€æ±‚å’Œå¤„ç†éœ€æ±‚ï¼Œéœ€æ±‚è¯´æ˜æ–‡æ¡£</p></li><li><p>æ•°æ®å­—å…¸</p><ul><li>æ•°æ®é¡¹</li><li>æ•°æ®ç»“æ„</li><li>æ•°æ®æµ</li><li>æ•°æ®å­˜å‚¨</li><li>å¤„ç†è¿‡ç¨‹</li></ul></li></ul></li><li><p>æ¦‚å¿µç»“æ„è®¾è®¡</p><ul><li>å¯¹éœ€æ±‚è¯´æ˜ä¹¦æä¾›çš„æ‰€æœ‰æ•°æ®å’Œå¤„ç†è¦æ±‚è¿›è¡ŒæŠ½è±¡ä¸ç»¼åˆå¤„ç†ã€‚E-Ræ¨¡å‹ï¼Œä¸DBMSæ— å…³</li></ul></li><li><p>é€»è¾‘ç»“æ„è®¾è®¡</p><ul><li>å°†æ¦‚å¿µæ•°æ®æ¨¡å‹è½¬æ¢æˆDBMSæ”¯æŒçš„æ•°æ®æ¨¡å‹ï¼ŒE-Rå›¾å‘å…³ç³»æ¨¡å‹è½¬æ¢</li></ul></li><li><p>ç‰©ç†ç»“æ„è®¾è®¡</p><ul><li>é€»è¾‘æ¨¡å‹åœ¨ç‰©ç†ä¸Šå®ç°</li></ul></li></ul></li></ul><h3 id="äº‹ç‰©ç®¡ç†">äº‹ç‰©ç®¡ç†</h3><ul><li>å¹¶å‘æ§åˆ¶</li><li>æ•…éšœä¸æ¢å¤</li></ul><h3 id="å¤‡ä»½ä¸æ¢å¤">å¤‡ä»½ä¸æ¢å¤</h3><ul><li>äº‹ç‰©æ•…éšœ</li><li>ç³»ç»Ÿæ•…éšœ</li><li>ä»‹è´¨æ•…éšœ</li><li>è®¡ç®—æœºç—…æ¯’</li></ul><h3 id="åˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿ">åˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿ</h3><ul><li><p>åˆ†å¸ƒå¼æ•°æ®åº“çš„æ¦‚å¿µ</p><ul><li>åˆ†æ•£çš„å¤šä¸ªæ•°æ®åº“å•å…ƒè¿æ¥èµ·æ¥ç»„æˆçš„ä¸€ä¸ªé€»è¾‘ä¸Šç»Ÿä¸€çš„æ•°æ®åº“</li></ul></li><li><p>åˆ†å¸ƒå¼æ•°æ®çš„æ¶æ„</p></li></ul><h3 id="æ•°æ®ä»“åº“">æ•°æ®ä»“åº“</h3><ul><li><p>æ•°æ®ä»“åº“çš„æ¦‚å¿µ</p><ul><li>ä¸»è¦ç”¨äºæ•°æ®åˆ†æ</li></ul></li><li><p>æ•°æ®ä»“åº“çš„æ­¥éª¤</p><ul><li><p>æŠ½å–</p></li><li><p>è½¬æ¢</p><ul><li>åˆ‡ç‰‡ã€åˆ‡å—</li><li>æ—‹è½¬</li><li>ä¸Šå·å’Œä¸‹é’»</li></ul></li><li><p>åŠ è½½</p></li></ul></li><li><p>æ•°æ®ä»“åº“çš„å®ç°æ–¹æ³•</p><ul><li>MOLAP</li><li>ROLAP</li><li>HOLAP</li></ul></li></ul><h3 id="æ•°æ®æŒ–æ˜">æ•°æ®æŒ–æ˜</h3><ul><li><p>æ•°æ®æŒ–æ˜çš„æ¦‚å¿µ</p><ul><li>ä»å¤§é‡çš„æ•°æ®ä¸­ï¼ŒæŒ–æ˜å‡ºæœªçŸ¥çš„ä¸”å…·æœ‰ä»·å€¼çš„ä¿¡æ¯å’ŒçŸ¥è¯†çš„è¿‡ç¨‹</li></ul></li><li><p>æ•°æ®æŒ–æ˜çš„åŠŸèƒ½</p></li><li><p>æ•°æ®æŒ–æ˜çš„å¸¸ç”¨æŠ€æœ¯</p><ul><li>å…³è”åˆ†æ</li><li>åºåˆ—åˆ†æ</li><li>åˆ†ç±»</li><li>é¢„æµ‹</li><li>èšç±»åˆ†æ</li><li>æ—¶é—´åºåˆ—åˆ†æ</li></ul></li><li><p>æ•°æ®æŒ–æ˜çš„æµç¨‹</p><ul><li>é—®é¢˜å®šä¹‰</li><li>å»ºç«‹æ•°æ®æŒ–æ˜åº“</li><li>è°ƒæ•´æ•°æ®</li><li>æ¨¡å‹åŒ–</li><li>è¯„ä»·å’Œè§£æ</li></ul></li></ul><h3 id="NoSQL">NoSQL</h3><ul><li>Not only SQLï¼Œæ³›æŒ‡éå…³ç³»å‹æ•°æ®åº“</li><li>è§£å†³å¤§è§„æ¨¡æ•°æ®é›†åˆå¤šé‡æ•°æ®ç§ç±»å¸¦æ¥çš„æŒ‘æˆ˜ï¼Œå°¤å…¶æ˜¯å¤§æ•°æ®åº”ç”¨éš¾é¢˜</li></ul><h3 id="å¤§æ•°æ®">å¤§æ•°æ®</h3><ul><li>æ— æ³•åœ¨ä¸€å®šæ—¶é—´å†…ç”¨å¸¸è§„è½¯ä»¶å·¥å…·å¯¹å…¶å†…å®¹è¿›è¡ŒæŠ“å–ã€ç®¡ç†å’Œå¤„ç†çš„æ•°æ®é›†åˆ</li></ul><h2 id="è®¡ç®—æœºç½‘ç»œ">è®¡ç®—æœºç½‘ç»œ</h2><h3 id="ç½‘ç»œæ¶æ„ä¸åè®®">ç½‘ç»œæ¶æ„ä¸åè®®</h3><ul><li><p>ç½‘ç»œäº’è”æ¨¡å‹</p><ul><li><p>OSI/RMæ¨¡å‹</p><ul><li>åº”ç”¨å±‚</li><li>è¡¨ç¤ºå±‚</li><li>ä¼šè¯å±‚</li><li>ä¼ è¾“å±‚ - æ•°æ®æ®µ</li><li>ç½‘ç»œå±‚ - åˆ†ç»„æ•°æ®åŒ…</li><li>æ•°æ®é“¾è·¯å±‚ - æ•°æ®å¸§(Frame)</li><li>ç‰©ç†å±‚ - æ¯”ç‰¹(bit)</li></ul></li><li><p>TCP/IPç»“æ„æ¨¡å‹</p><ul><li>åº”ç”¨å±‚</li><li>ä¼ è¾“å±‚</li><li>ç½‘ç»œäº’è”å±‚</li><li>ç½‘ç»œæ¥å£å±‚</li></ul></li></ul></li><li><p>å¸¸è§çš„ç½‘ç»œåè®®</p><ul><li><p>åº”ç”¨å±‚åè®®</p><ul><li>HTTPã€FTPã€TELNETã€SMTP</li><li>DNSã€RIPã€DHCP</li></ul></li><li><p>ä¼ è¾“å±‚åè®®</p><ul><li>TCPã€UDP</li></ul></li><li><p>ç½‘ç»œå±‚åè®®</p><ul><li>IPã€ARP</li></ul></li></ul></li><li><p>IPV6</p><ul><li>128ä½ï¼Œåˆ†ä¸º8ç»„ï¼Œæ¯ç»„4ä½ï¼Œ2001:0DB8:02de:0000:0000:0000:0000:0e13</li><li>æ¯ç»„çš„å‰å¯¼0ï¼Œå¯ä»¥çœç•¥ã€‚2001:DB8:2de:0:0:0:0:e130:0e13 -&gt; 2001:DB8:2de::e13</li></ul></li></ul><h3 id="å±€åŸŸç½‘ä¸å¹¿åŸŸç½‘">å±€åŸŸç½‘ä¸å¹¿åŸŸç½‘</h3><ul><li><p>å±€åŸŸç½‘åŸºç¡€çŸ¥è¯†</p></li><li><p>æ— çº¿å±€åŸŸç½‘LAN</p></li><li><p>å¹¿åŸŸç½‘æŠ€æœ¯WAN</p></li><li><p>ç½‘ç»œæ¥å…¥æŠ€æœ¯</p><ul><li><p>PSTNæ¥å…¥</p></li><li><p>ISDNæ¥å…¥</p></li><li><p>ADSLæ¥å…¥</p></li><li><p>FTTx+LANæ¥å…¥</p></li><li><p>åŒè½´ç”µç¼†</p></li><li><p>å…‰çº¤æ¥å…¥</p><ul><li>å¤šæ¨¡å…‰çº¤</li><li>å•æ¨¡å…‰çº¤ï¼Œå¤§å®¹é‡é•¿è·ç¦»</li></ul></li></ul></li></ul><h3 id="ç½‘ç»œäº’è¿ä¸å¸¸ç”¨è®¾å¤‡">ç½‘ç»œäº’è¿ä¸å¸¸ç”¨è®¾å¤‡</h3><h3 id="ç½‘ç»œå·¥ç¨‹">ç½‘ç»œå·¥ç¨‹</h3><ul><li>ç½‘ç»œè§„åˆ’</li><li>ç½‘ç»œè®¾è®¡</li><li>ç½‘ç»œå®æ–½</li></ul><h3 id="ç½‘ç»œå­˜å‚¨æŠ€æœ¯">ç½‘ç»œå­˜å‚¨æŠ€æœ¯</h3><ul><li><p>ç›´è¿å¼å­˜å‚¨ DAS</p><ul><li>ç›´æ¥ä¸ä¸»æœºç³»ç»Ÿç›¸è¿çš„å­˜å‚¨è®¾å¤‡</li></ul></li><li><p>ç½‘ç»œå­˜å‚¨è®¾å¤‡ NAS</p><ul><li>é‡‡ç”¨ç›´æ¥ä¸ç½‘ç»œä»‹è´¨ç›¸è¿çš„ç‰¹æ®Šè®¾å¤‡å®ç°æ•°æ®å­˜å‚¨æœºåˆ¶ã€‚è·¨å¹³å°çš„æ–‡ä»¶å…±äº«åŠŸèƒ½</li></ul></li><li><p>å­˜å‚¨åŒºåŸŸç½‘ SAN</p><ul><li>é€šè¿‡ä¸“ç”¨é«˜é€Ÿç½‘å°†ä¸€ä¸ªæˆ–å¤šä¸ªç½‘ç»œå­˜å‚¨è®¾å¤‡(å¦‚ç£ç›˜é˜µåˆ—RAID)å’ŒæœåŠ¡å™¨è¿æ¥èµ·æ¥çš„ä¸“ç”¨å­˜å‚¨ç³»ç»Ÿ</li></ul></li></ul><h3 id="ç»¼åˆå¸ƒçº¿">ç»¼åˆå¸ƒçº¿</h3><ul><li>å·¥ä½œåŒº</li><li>é…çº¿å­ç³»ç»Ÿ</li><li>å¹²çº¿ç³»ç»Ÿ</li><li>å»ºç­‘ç¾¤å­ç³»ç»Ÿ</li><li>è®¾å¤‡é—´</li><li>ç®¡ç†</li></ul><h2 id="ç³»ç»Ÿæ€§èƒ½ä¸è¯„ä»·">ç³»ç»Ÿæ€§èƒ½ä¸è¯„ä»·</h2><h3 id="æ€§èƒ½æŒ‡æ ‡">æ€§èƒ½æŒ‡æ ‡</h3><ul><li><p>è®¡ç®—æœº</p><ul><li>æ—¶é’Ÿé¢‘ç‡</li><li>é«˜é€Ÿç¼“å­˜</li><li>è¿ç®—é€Ÿåº¦</li><li>è¿ç®—ç²¾åº¦</li><li>å†…å­˜çš„å­˜å‚¨å®¹é‡</li><li>å­˜å‚¨å™¨çš„å­˜å–å‘¨æœŸ</li><li>æ•°æ®å¤„ç†é€Ÿç‡</li><li>å“åº”æ—¶é—´</li><li>RASISç‰¹æ€§</li><li>å¹³å‡æ•…éšœå“åº”æ—¶é—´</li><li>å…¼å®¹æ€§</li></ul></li><li><p>ç½‘ç»œ</p><ul><li>è®¾å¤‡çº§æ€§èƒ½æŒ‡æ ‡</li><li>ç½‘ç»œçº§æ€§èƒ½æŒ‡æ ‡</li><li>åº”ç”¨çº§æ€§èƒ½æŒ‡æ ‡</li><li>ç”¨æˆ·çº§æ€§èƒ½æŒ‡æ ‡</li><li>ååé‡</li></ul></li><li><p>æ“ä½œç³»ç»Ÿ</p><ul><li>ç³»ç»Ÿçš„å¯é æ€§</li><li>ç³»ç»Ÿçš„ååé‡</li><li>ç³»ç»Ÿçš„ç›¸åº”æ—¶é—´</li><li>ç³»ç»Ÿçš„èµ„æºåˆ©ç”¨ç‡</li><li>å¯ç§»æ¤æ€§</li></ul></li><li><p>æ•°æ®ç®¡ç†ç³»ç»Ÿ</p></li><li><p>webæœåŠ¡å™¨</p></li></ul><h3 id="æ€§èƒ½è®¡ç®—">æ€§èƒ½è®¡ç®—</h3><h3 id="æ€§èƒ½è®¾è®¡">æ€§èƒ½è®¾è®¡</h3><ul><li><p>é˜¿æœ¨è¾¾å°”å®šå¾‹</p><ul><li>åœ¨å¹¶è¡Œè®¡ç®—ä¸­ç”¨å¤šå¤„ç†å™¨çš„åº”ç”¨åŠ é€Ÿå—é™äºç¨‹åºæ‰€éœ€çš„ä¸²è¡Œæ—¶é—´ç™¾åˆ†æ¯”</li></ul></li><li><p>è´Ÿè½½å‡è¡¡</p></li></ul><h3 id="æ€§èƒ½è¯„ä¼°">æ€§èƒ½è¯„ä¼°</h3><ul><li><p>webæœåŠ¡å™¨æ€§èƒ½è¯„ä¼°</p></li><li><p>åŸºå‡†æµ‹è¯•ç¨‹åº</p><ul><li>æŠŠåº”ç”¨ç¨‹åºä¸­ç”¨å¾—æœ€å¤šã€æœ€é¢‘ç¹çš„æ ¸å¿ƒç¨‹åºä½œä¸ºè¯„ä»·è®¡ç®—æœºæ€§èƒ½çš„æ ‡å‡†ç¨‹åºã€‚</li></ul></li><li><p>ç³»ç»Ÿç›‘è§†</p></li></ul><h2 id="å¼€å‘æ–¹æ³•">å¼€å‘æ–¹æ³•</h2><h3 id="è½¯ä»¶çš„ç”Ÿå‘½å‘¨æœŸ">è½¯ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</h3><ul><li>è½¯ä»¶ç”Ÿå‘½å‘¨æœŸåˆ†ä¸ºå…«ä¸ªé˜¶æ®µï¼šå¯è¡Œæ€§ç ”ç©¶ä¸è®¡åˆ’ã€éœ€æ±‚åˆ†æã€æ¦‚è¦è®¾è®¡ã€è¯¦ç»†è®¾è®¡ã€å®ç°ã€é›†æˆæµ‹è¯•ã€ç¡®è®¤æµ‹è¯•ã€ä½¿ç”¨å’Œç»´æŠ¤</li></ul><h3 id="è½¯ä»¶å¼€å‘æ–¹æ³•">è½¯ä»¶å¼€å‘æ–¹æ³•</h3><ul><li><p>ç»“æ„åŒ–æ–¹æ³•SP</p><ul><li><p>ä»‹ç»</p><ul><li>ç»“æ„åŒ–æ–¹æ³•æ˜¯ä¸€ç§ä¼ ç»Ÿçš„è½¯ä»¶å¼€å‘æ–¹æ³•ï¼Œå®ƒæ˜¯ç”±ç»“æ„åŒ–åˆ†æã€ç»“æ„åŒ–è®¾è®¡å’Œç»“æ„åŒ–ç¨‹åºè®¾è®¡ä¸‰éƒ¨åˆ†æœ‰æœºç»“åˆè€Œæˆã€‚</li><li>è‡ªé¡¶å‘ä¸‹ã€é€æ­¥æ±‚ç²¾ã€é‡‡ç”¨æ¨¡å—åŒ–æŠ€æœ¯å’ŒåŠŸèƒ½æŠ½è±¡å°†ç³»ç»ŸæŒ‰åŠŸèƒ½åˆ†è§£ä¸ºè‹¥å¹²æ¨¡å—</li></ul></li><li><p>ç»“æ„åŒ–åˆ†æ</p><ul><li>ç€çœ¼äºæ•°æ®æµï¼Œè‡ªé¡¶å‘ä¸‹ï¼Œé€å±‚åˆ†è§£ï¼Œå»ºç«‹ç³»ç»Ÿçš„å¤„ç†æµç¨‹ï¼Œä»¥æ•°æ®æµå›¾å’Œæ•°æ®å­—å…¸ä¸ºä¸»è¦å·¥å…·ï¼Œå»ºç«‹ç³»ç»Ÿçš„é€»è¾‘æ¨¡å‹</li><li><ol><li>åˆ†æå½“å‰æƒ…å†µï¼Œåˆ¶ä½œååº”å½“å‰ç‰©ç†æ¨¡å‹çš„æ•°æ®æµå›¾DFD(dataflow diagram)</li></ol></li><li>2.æ¨åˆ°å‡ºç­‰ä»·çš„é€»è¾‘æ¨¡å‹DFD</li><li><ol start="3"><li>è®¾è®¡æ–°çš„é€»è¾‘ç³»ç»Ÿã€ç”Ÿæˆæ•°æ®å­—å…¸å’ŒåŸºå…ƒæè¿°</li></ol></li><li><ol start="4"><li>å»ºç«‹äººæœºæ¥å£ï¼Œæä¾›å¯ä¾›é€‰æ‹©çš„ç›®æ ‡ç³»ç»Ÿçš„ç‰©ç†DFD</li></ol></li><li><ol start="5"><li>å»ºç«‹å„ç§æ–¹æ¡ˆçš„æˆæœ¬å’Œé£é™©ç­‰çº§ï¼Œå¹¶æ®æ­¤åˆ†æ</li></ol></li><li><ol start="6"><li>é€‰æ‹©ä¸€ç§æ–¹æ¡ˆ</li></ol></li><li><ol start="7"><li>å»ºç«‹å®Œæˆçš„éœ€æ±‚è§„çº¦</li></ol></li></ul></li><li><p>ç»“æ„åŒ–è®¾è®¡</p><ul><li><p>SDæ–¹æ³•æ­¥éª¤</p><ul><li><ol><li>è¯„å®¡å’Œç»†åŒ–æ•°æ®æµå›¾</li></ol></li><li><ol start="2"><li>ç¡®å®šæ•°æ®æµå›¾çš„ç±»å‹</li></ol></li><li><ol start="3"><li>æ•°æ®æµå›¾æ˜ å°„åˆ°è½¯ä»¶æ¨¡å—ç»“æ„ï¼Œè®¾è®¡æ¨¡å—ç»“æ„çš„ä¸Šå±‚</li></ol></li><li><ol start="4"><li>åŸºäºæ•°æ®æµå›¾é€æ­¥åˆ†æé«˜å±‚æ¨¡å—ï¼Œè®¾è®¡ä¸­ä¸‹å±‚æ¨¡å—</li></ol></li><li><ol start="5"><li>å¯¹æ¨¡å—ç»“æ„è¿›è¡Œä¼˜åŒ–ï¼Œå¾—åˆ°æ›´åˆç†çš„è½¯ä»¶ç»“æ„</li></ol></li></ul></li><li><p>SDæ–¹æ³•è®¾è®¡åŸåˆ™</p><ul><li><ol><li>æ¯ä¸ªæ¨¡å—æ‰§è¡Œä¸€ä¸ªåŠŸèƒ½</li></ol></li><li><ol start="2"><li>æ¨¡å—ä½¿ç”¨è¿‡ç¨‹è¯­å¥æˆ–å‡½æ•°æ–¹å¼è°ƒç”¨å…¶ä»–æ¨¡å—</li></ol></li><li><ol start="3"><li>æ¨¡å—é—´ä¼ é€å‚æ•°ä½œä¸ºæ•°æ®ä½¿ç”¨</li></ol></li><li>4.å°½é‡å‡å°‘æ¨¡å—é—´å…±ç”¨ä¿¡æ¯</li></ul></li></ul></li><li><p>ç¼ºç‚¹</p><ul><li><ol><li>å¼€å‘å‘¨æœŸé•¿</li></ol></li><li><ol start="2"><li>æ—©æœŸç»“æ„åŒ–æ–¹æ³•æ³¨é‡ç³»ç»ŸåŠŸèƒ½ï¼Œå¯¹æ•°æ®ç»“æ„å…¼é¡¾è¾ƒå°‘</li></ol></li><li><ol start="3"><li>ç»“æ„åŒ–ç¨‹åº¦è¾ƒä½çš„ç³»ç»Ÿï¼Œåœ¨å¼€å‘åˆæœŸéš¾äºé”å®šåŠŸèƒ½è¦æ±‚</li></ol></li></ul></li></ul></li><li><p>é¢å‘å¯¹è±¡æ–¹æ³•</p><ul><li><p>Coad/Yourdonæ–¹æ³•ï¼ˆObject-Oriented Analysis and Disignï¼‰</p><ul><li><p>Coad/Yourdonçš„æ–¹æ³•æ˜¯å»ºç«‹åœ¨ä¿¡æ¯æ¨¡å‹åŒ–ã€é¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡å’ŒçŸ¥è¯†åº“ç³»ç»ŸåŸºç¡€ä¹‹ä¸Šçš„ã€‚</p></li><li><p>é¢å‘å¯¹è±¡çš„åˆ†æ(OOA)</p><ul><li>é¡¶å±‚æ¶æ„å›¾ã€ç”¨ä¾‹å’Œç”¨ä¾‹å›¾ã€é¢†åŸŸæ¦‚å¿µæ¨¡å‹å›¾æ„æˆ</li><li>ç¡®å®šç±»ä¸å¯¹è±¡</li><li>æ ‡è¯†ç»“æ„</li><li>å®šä¹‰ä¸»é¢˜</li><li>å®šä¹‰å±æ€§</li><li>å®šä¹‰æœåŠ¡</li></ul></li><li><p>é¢å‘å¯¹è±¡çš„è®¾è®¡(OOD)</p><ul><li>è®¾è®¡é—®é¢˜åŸŸï¼ˆç»†åŒ–åˆ†æç»“æœï¼‰</li><li>è®¾è®¡äººæœºäº¤äº’éƒ¨åˆ†ï¼ˆè®¾è®¡ç”¨æˆ·ç•Œé¢ï¼‰</li><li>è®¾è®¡ä»»åŠ¡ç®¡ç†éƒ¨åˆ†ï¼ˆç¡®å®šç³»ç»Ÿèµ„æºçš„åˆ†é…ï¼‰</li><li>è®¾è®¡æ•°æ®ç®¡ç†éƒ¨åˆ†ï¼ˆç¡®å®šæŒä¹…å¯¹è±¡çš„å­˜å‚¨ï¼‰</li></ul></li></ul></li><li><p>Boochæ–¹æ³•ï¼ˆObject Oriented Designï¼‰</p><ul><li>é¢å‘å¯¹è±¡çš„è®¾è®¡ä¸­ä¸»è¦å¼ºè°ƒå¤šæ¬¡é‡å¤å’Œå¼€å‘è€…çš„åˆ›é€ æ€§ã€‚æ–¹æ³•æœ¬èº«æ˜¯ä¸€ç»„å¯å‘æ€§çš„è¿‡ç¨‹å¼å»ºè®®</li><li>åœ¨ä¸€å®šæŠ½è±¡å±‚æ¬¡ä¸Šè¡¨ç¤ºç±»ä¸å¯¹è±¡</li><li>è¡¨ç¤ºç±»ä¸å¯¹è±¡çš„è¯­ä¹‰</li><li>è¡¨ç¤ºç±»ä¸å¯¹è±¡ä¹‹é—´çš„å…³ç³»(ç»§æ‰¿ã€å®ä¾‹åŒ–ã€ä½¿ç”¨ç­‰)</li><li>å®ç°ç±»ä¸å¯¹è±¡</li></ul></li><li><p>OMTæ–¹æ³•-å¯¹è±¡å»ºæ¨¡æŠ€æœ¯ï¼ˆObject Modeling Techniqueï¼‰</p><ul><li>4ä¸ªæ´»åŠ¨ï¼šåˆ†æã€ç³»ç»Ÿè®¾è®¡ã€å¯¹è±¡è®¾è®¡å’Œå®ç°</li></ul></li><li><p>OOSE-é¢å‘å¯¹è±¡çš„è½¯ä»¶å·¥ç¨‹ï¼ˆObject-Oriented Software Engineeringï¼‰</p><ul><li><p>ä½¿ç”¨äº‹ä¾‹é©±åŠ¨çš„é¢å‘å¯¹è±¡å¼€å‘æ–¹æ³•ã€‚OOSEæ–¹æ³•é‡‡ç”¨5ç±»æ¨¡å‹æ¥å»ºç«‹ç›®æ ‡ç³»ç»Ÿ</p></li><li><ol><li>éœ€æ±‚æ¨¡å‹</li></ol><ul><li>é¢†åŸŸå¯¹è±¡æ¨¡å‹å’Œç•Œé¢æè¿°æ”¯æŒ</li></ul></li><li><ol start="2"><li>åˆ†ææ¨¡å‹</li></ol><ul><li>åœ¨éœ€æ±‚æ¨¡å‹åŸºç¡€ä¸Šå»ºç«‹çš„ï¼Œå»ºç«‹åœ¨ç³»ç»Ÿç”Ÿå‘½æœŸä¸­å¯ç»´æŠ¤ã€æœ‰é€»è¾‘ã€å¥å£®çš„ç»“æ„</li></ul></li><li><ol start="3"><li>è®¾è®¡æ¨¡å‹</li></ol><ul><li>ç²¾åŒ–åˆ†ææ¨¡å‹å¹¶è€ƒè™‘å½“å‰çš„å®ç°ç¯å¢ƒ</li></ul></li><li><ol start="4"><li>å®ç°æ¨¡å‹</li></ol><ul><li>å®ç°å—çš„ä»£ç </li></ul></li><li><ol start="5"><li>æµ‹è¯•æ¨¡å‹</li></ol><ul><li>ä»åº•å±‚çš„å•å…ƒæµ‹è¯•å»¶ç”³åˆ°é«˜å±‚çš„ç³»ç»Ÿæµ‹è¯•</li></ul></li></ul></li></ul></li><li><p>åŸå‹æ–¹æ³•</p><ul><li>æ˜ç¡®å¹¶å®Œå–„éœ€æ±‚ã€æ¢ç´¢è®¾è®¡é€‰æ‹©æ–¹æ¡ˆã€å‘å±•ä¸ºæœ€ç»ˆçš„äº§å“</li></ul></li><li><p>é€†å‘å·¥ç¨‹</p><ul><li><p>é€†å‘å·¥ç¨‹ï¼š</p><ul><li><p>åˆ†æç¨‹åºï¼ŒåŠ›å›¾åœ¨æ¯”æºä»£ç æ›´é«˜çš„æŠ½è±¡å±‚æ¬¡ä¸Šå»ºç«‹ç¨‹åºçš„è¡¨ç¤ºè¿‡ç¨‹</p></li><li><p>å®ç°çº§</p><ul><li>ç¨‹åºçš„æŠ½è±¡è¯­æ³•æ ‘ã€ç¬¦å·è¡¨ç­‰ä¿¡æ¯</li></ul></li><li><p>ç»“æ„çº§</p><ul><li>ç¨‹åºé—´çš„å…³ç³»ï¼Œè°ƒç”¨å›¾ã€ç»“æ„å›¾ã€è§†å›¾ç­‰</li></ul></li><li><p>åŠŸèƒ½çº§</p><ul><li>åŠŸèƒ½åŠç¨‹åºæ®µä¹‹é—´å…³ç³»çš„ä¿¡æ¯</li></ul></li><li><p>é¢†åŸŸçº§</p><ul><li>å®ä½“ä¸åº”ç”¨é¢†åŸŸæ¦‚å¿µä¹‹é—´å…³ç³»</li></ul></li></ul></li><li><p>å†å·¥ç¨‹</p><ul><li>ä¿®å¤å’Œæ”¹é€ å·¥ç¨‹</li></ul></li><li><p>è½¯ä»¶é‡æ„</p><ul><li>ä¸æ”¹å˜è½¯ä»¶çš„åŠŸèƒ½å’Œå¤–éƒ¨å¯è§æ€§çš„æƒ…å†µä¸‹ï¼Œæ”¹å–„è½¯ä»¶çš„ç»“æ„ï¼Œæé«˜è½¯ä»¶çš„æ¸…æ™°æ€§ã€å¯æ‹“å±•æ€§å’Œå¯é‡ç”¨æ€§</li></ul></li></ul></li></ul><h3 id="è½¯ä»¶å¼€å‘æ¨¡å‹">è½¯ä»¶å¼€å‘æ¨¡å‹</h3><ul><li><p>ç€‘å¸ƒæ¨¡å‹</p><ul><li><p>ä»ä¸€ä¸ªç‰¹å®šé˜¶æ®µæµå‘ä¸‹ä¸€ä¸ªé˜¶æ®µ</p></li><li><p>é€‚åˆäºéœ€æ±‚æ˜ç¡®çš„é¡¹ç›®</p></li><li><p>ç¼ºç‚¹ï¼š</p><ul><li><ol><li>ä¸Šä¸€ä¸ªé˜¶æ®µçš„é”™è¯¯ä¼šæµè½¬åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µï¼Œæ”¾å¤§é”™è¯¯</li></ol></li><li><ol start="2"><li>éš¾ä»¥é€‚åº”å˜åŒ–</li></ol></li><li><ol start="3"><li>ç»“æœéœ€è¦ç­‰æ‰€æœ‰é˜¶æ®µå®Œæˆåæ‰çŸ¥é“</li></ol></li></ul></li></ul></li><li><p>æ¼”åŒ–æ¨¡å‹</p><ul><li>æ¼”åŒ–æ¨¡å‹å¯ä»¥çœ‹åšè‹¥å¹²ä¸ªç€‘å¸ƒæ¨¡å‹çš„è¿­ä»£</li></ul></li><li><p>èºæ—‹æ¨¡å‹</p><ul><li><p>èºæ—‹æ¨¡å‹åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼šéœ€æ±‚å®šä¹‰ï¼Œé£é™©åˆ†æï¼ŒåŠŸèƒ½å®ç°å’Œè¯„å®¡</p></li><li><p>é€‚åˆç”¨äºåºå¤§è€Œå¤æ‚ã€å…·æœ‰é«˜é£é™©çš„ç³»ç»Ÿ</p></li><li><p>ç¼ºç‚¹</p><ul><li><ol><li>éœ€è¦å…·æœ‰æƒ³å½“ä¸°å¯Œçš„é£é™©è¯„ä¼°ç»éªŒå’Œä¸“ä¸šçŸ¥è¯†</li></ol></li><li><ol start="2"><li>è¿‡å¤šçš„è¿­ä»£æ¬¡æ•°ä¼šå¢åŠ å¼€å‘æˆæœ¬ï¼Œå»¶æ—¶äº¤ä»˜æ—¶é—´</li></ol></li></ul></li></ul></li><li><p>å¢é‡æ¨¡å‹</p><ul><li><p>é€‚ç”¨</p><ul><li>åœ¨ç³»ç»Ÿæ¶æ„æˆç†Ÿï¼Œé£é™©è¾ƒä½çš„é€‚åˆï¼Œå¯ä»¥ç”¨å¢é‡çš„æ–¹å¼è¿›è¡Œç³»ç»Ÿå¼€å‘ã€‚</li></ul></li><li><p>ä»‹ç»</p><ul><li>å¢é‡å¼€å‘æ¨¡å‹å¼€å‘ä¸­ï¼Œæ¯ä¸€ä¸ªç‰ˆæœ¬éƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç‰ˆæœ¬ï¼Œç‰ˆæœ¬çš„æ—¶é—´å¢é‡è¦å‡åŒ€</li></ul></li></ul></li><li><p>åŸå‹æ³•</p><ul><li><p>é€‚ç”¨</p><ul><li>ç”¨æˆ·éœ€æ±‚ä¸æ˜ç¡®æˆ–è€…æŠ€æœ¯æ¶æ„ä¸­å­˜åœ¨å¾ˆå¤šä¸å¯çŸ¥å› ç´ çš„é€‚åˆ</li></ul></li><li><p>ä»‹ç»</p><ul><li>æ¯ä¸€ä¸ªè¿­ä»£éƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸ</li></ul></li></ul></li><li><p>æ„ä»¶ç»„è£…æ¨¡å‹</p><ul><li><p>é€‚ç”¨</p></li><li><p>ä»‹ç»</p><ul><li><p>æ„ä»¶çš„å¼€å‘è¿‡ç¨‹</p><ul><li>éœ€æ±‚åˆ†æå’Œå®šä¹‰</li><li>ä½“ç³»ç»“æ„è®¾è®¡</li><li>æ„ä»¶åº“å»ºç«‹</li><li>åº”ç”¨è½¯ä»¶æ„å»º</li><li>æµ‹è¯•å’Œå‘å¸ƒ</li></ul></li></ul></li><li><p>ä¼˜ç‚¹</p><ul><li>æ„ä»¶è®©ç³»ç»Ÿçš„æ‹“å±•å˜å¾—æ›´åŠ å®¹æ˜“ï¼›è®¾è®¡è‰¯å¥½çš„æ„ä»¶å®¹æ˜“è¢«é‡ç”¨ï¼Œé™ä½è½¯ä»¶å¼€å‘æˆæœ¬</li></ul></li><li><p>ç¼ºç‚¹</p><ul><li>å¯¹æ„ä»¶çš„è®¾è®¡éœ€è¦ç»éªŒä¸°å¯Œçš„æ¶æ„å¸ˆï¼›è€ƒè™‘è½¯ä»¶é‡ç”¨æ—¶å¾€å¾€åœ¨å…¶ä»–æ–¹é¢åšå‡ºè®©æ­¥ï¼Œå¦‚æ€§èƒ½ã€‚</li></ul></li></ul></li></ul><h3 id="ç»Ÿä¸€è¿‡ç¨‹UP">ç»Ÿä¸€è¿‡ç¨‹UP</h3><ul><li><p>UPäºŒç»´æ¨¡å‹</p><ul><li>4ä¸ªé˜¶æ®µï¼Œåˆå§‹ã€ç»†åŒ–ã€æ„å»ºã€äº¤ä»˜</li></ul></li><li><p>UPç”Ÿå‘½å‘¨æœŸ</p><ul><li>4ä¸ªé‡Œç¨‹ç¢‘ï¼šç›®æ ‡é‡Œç¨‹ç¢‘ã€æ¶æ„é‡Œç¨‹ç¢‘ã€èƒ½åŠ›é‡Œç¨‹ç¢‘ã€å‘å¸ƒé‡Œç¨‹ç¢‘</li></ul></li><li><p>UPçš„ ç‰¹ç‚¹</p><ul><li><ol><li>UPæ—¶ä¸€ä¸ªè¿­ä»£çš„äºŒç»´æ¨¡å‹ï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸçš„æ¯ä¸€ä¸ªé˜¶æ®µéƒ½å¯ä»¥è¿›è¡Œéœ€æ±‚ã€è®¾è®¡ç­‰æ´»åŠ¨</li></ol></li><li><ol start="2"><li>å¯ä»¥é‡‡ç”¨æ¼”åŒ–æ¨¡å‹æˆ–è€…å¢é‡æ¨¡å‹</li></ol></li><li><ol start="3"><li>UPçš„è¿­ä»£å®¹æ˜“æ§åˆ¶å¼€å‘é£é™©</li></ol></li><li><ol start="4"><li>è™½ç„¶UPæ—¶ä¸€ä¸ªè¿­ä»£å¼€å‘æ¨¡å‹ï¼Œä½†æ˜¯æœ¬èº«ä¸å±äºæ•æ·å¼€å‘</li></ol></li><li><ol start="5"><li>åœ¨å®è·µåº”ç”¨ä¸­å¯ä»¥æ ¹æ®å…·ä½“é—®é¢˜å¯¹UPè¿›è¡Œè£å‰ªï¼Œä»è€Œé€‚åº”å„ç§è½¯ä»¶è§„æ¨¡å’Œå¼€å‘å›¢é˜Ÿ</li></ol></li><li>æœ€æ ¸å¿ƒï¼šç”¨ä¾‹é©±åŠ¨ï¼Œä»¥æ¶æ„ä¸ºä¸­å¿ƒï¼Œè¿­ä»£å’Œå¢é‡</li></ul></li></ul><h3 id="æ•æ·å¼€å‘">æ•æ·å¼€å‘</h3><ul><li><p>æé™ç¼–ç¨‹</p><ul><li>ä»·å€¼è§‚ï¼šæ²Ÿé€šã€ç®€å•ã€åé¦ˆã€å‹‡æ°”</li></ul></li><li><p>æ°´æ™¶æ–¹æ³•Crystal</p><ul><li>å¼ºè°ƒä¸åŒçš„é¡¹ç›®ï¼Œé‡‡ç”¨ä¸åŒçš„ç­–ç•¥</li></ul></li><li><p>Scrumå¹¶åˆ—äº‰çƒ</p><ul><li>è¿­ä»£ï¼Œ30å¤©ä¸€ä¸ªè¿­ä»£å‘¨æœŸï¼ŒæŒ‰éœ€æ±‚ä¼˜å…ˆçº§å®ç°</li><li>äº§å“ä»£åŠäº‹é¡¹åˆ—è¡¨æ¢³ç†ï¼ŒSprintè®¡åˆ’ä¼šè®®ã€æ¯æ—¥scrumä¼šè®®ã€Srpintè¯„å®¡ä¼šè®®ã€Sprintå›é¡¾ä¼šè®®</li></ul></li><li><p>åŠŸèƒ½é©±åŠ¨å¼€å‘FDD</p><ul><li>å°†å¼€å‘äººå‘˜åˆ†ç±»</li></ul></li></ul><h3 id="è½¯ä»¶é‡ç”¨">è½¯ä»¶é‡ç”¨</h3><ul><li><p>æ¨ªå‘é‡ç”¨</p><ul><li><p>ä¸åŒåº”ç”¨é¢†åŸŸä¸­çš„è½¯ä»¶å…ƒç´ </p><ul><li>æ ‡å‡†å‡½æ•°åº“</li></ul></li></ul></li><li><p>çºµå‘é‡ç”¨</p><ul><li>å…±æ€§åº”ç”¨é¢†åŸŸé—´çš„è½¯éƒ¨åˆ†</li></ul></li></ul><h3 id="åŸºäºæ¶æ„çš„è½¯ä»¶è®¾è®¡ABSD">åŸºäºæ¶æ„çš„è½¯ä»¶è®¾è®¡ABSD</h3><ul><li><p>ABSDï¼ˆArchitecture-Based Software Designï¼‰æ–¹æ³•</p><ul><li>å¼ºè°ƒç”±å•†ä¸šã€è´¨é‡å’ŒåŠŸèƒ½éœ€æ±‚çš„ç»„åˆé©±åŠ¨è½¯ä»¶æ¶æ„è®¾è®¡</li><li>ABSDè‡ªé¡¶å‘ä¸‹ã€é€’å½’ç»†åŒ–çš„è½¯ä»¶å¼€å‘æ–¹æ³•ï¼Œä»¥è½¯ä»¶ç³»ç»ŸåŠŸèƒ½çš„åˆ†è§£ä¸ºåŸºç¡€ï¼Œé€šè¿‡é€‰æ‹©æ¶æ„é£æ ¼å®ç°è´¨é‡å’Œå•†ä¸šéœ€æ±‚ï¼Œå¹¶å¼ºè°ƒåœ¨æ¶æ„è®¾è®¡è¿‡ç¨‹ä¸­ä½¿ç”¨è½¯ä»¶æ¶æ„æ¨¡æ¿</li></ul></li><li><p>åŸºäºæ¶æ„çš„è½¯ä»¶å¼€å‘æ¨¡å‹</p><ul><li><p>æ¶æ„éœ€æ±‚</p><ul><li>æ˜ç¡®ç”¨æˆ·å¯¹ç›®æ ‡è½¯ä»¶ç³»ç»Ÿåœ¨åŠŸèƒ½ã€è¡Œä¸ºã€æ€§èƒ½ã€è®¾è®¡çº¦æŸç­‰æ–¹é¢çš„æœŸæœ›</li><li><ol><li>éœ€æ±‚è·å–</li></ol></li><li><ol start="2"><li>æ ‡è¯†æ„ä»¶æ´»åŠ¨ï¼Œè·å¾—ç³»ç»ŸåŸºæœ¬ç»“æ„ï¼Œåˆ†ç»„ï¼Œæ‰“åŒ…æˆæ„ä»¶</li></ol></li><li><ol start="3"><li>æ¶æ„éœ€æ±‚è¯„å®¡</li></ol></li></ul></li><li><p>æ¶æ„è®¾è®¡</p><ul><li>è¿­ä»£çš„è¿‡ç¨‹ï¼Œåˆ©ç”¨æ¶æ„éœ€æ±‚ç”Ÿæˆå¹¶è°ƒæ•´æ¶æ„ç­–ç•¥</li><li><ol><li>æå‡ºæ¶æ„æ¨¡å‹</li></ol></li><li><ol start="2"><li>å°†å·²æ ‡è¯†çš„æ„ä»¶æ˜ å°„åˆ°æ¶æ„ä¸­</li></ol></li><li><ol start="3"><li>åˆ†ææ„ä»¶ä¹‹é—´çš„ç›¸äº’ä½œç”¨</li></ol></li><li><ol start="4"><li>äº§ç”Ÿç³»ç»Ÿæ¶æ„</li></ol></li><li><ol start="5"><li>è®¾è®¡è¯„å®¡</li></ol></li></ul></li><li><p>æ¶æ„æ–‡æ¡£åŒ–</p><ul><li>æ¶æ„è§„æ ¼è¯´æ˜ä¹¦</li><li>æµ‹è¯•æ¶æ„éœ€æ±‚çš„è´¨é‡è®¾è®¡è¯´æ˜ä¹¦</li></ul></li><li><p>æ¶æ„å¤å®¡</p><ul><li>è¯„ä»·æ¶æ„æ˜¯å¦èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚ã€è´¨é‡å±æ€§éœ€æ±‚æ˜¯å¦åœ¨æ¶æ„ä¸­å¾—ä»¥ä½“ç°ï¼Œå±‚æ¬¡æ˜¯å¦æ¸…æ™°ï¼Œæ„ä»¶åˆ’åˆ†æ˜¯å¦åˆç†ç­‰ã€‚ï¼ˆå®¢æˆ·ä»£è¡¨å’Œé¢†åŸŸä¸“å®¶ï¼‰</li></ul></li><li><p>æ¶æ„å®ç°</p><ul><li>æ¶æ„åˆ†æå’Œè®¾è®¡</li><li>æ„ä»¶å®ç°</li><li>æ„ä»¶ç»„è£…</li><li>ç³»ç»Ÿæµ‹è¯•</li></ul></li><li><p>æ¼”åŒ–</p><ul><li>è§£å†³ç”¨æˆ·åœ¨ç³»ç»Ÿå¼€å‘è¿‡ç¨‹ä¸­å‘ç”Ÿçš„éœ€æ±‚å˜æ›´é—®é¢˜</li><li><ol><li>æ¶æ„æ¼”åŒ–è®¡åˆ’</li></ol></li><li><ol start="2"><li>æ„ä»¶å˜åŠ¨</li></ol></li><li><ol start="3"><li>æ›´æ–°æ„ä»¶çš„ç›¸äº’ä½œç”¨</li></ol></li><li><ol start="4"><li>æ„ä»¶çš„ç»„è£…ä¸æµ‹è¯•å’ŒæŠ€æœ¯è¯„å®¡</li></ol></li></ul></li></ul></li></ul><h3 id="å½¢å¼åŒ–æ–¹æ³•">å½¢å¼åŒ–æ–¹æ³•</h3><ul><li>å½¢å¼åŒ–æ–¹æ³•å¼å€ŸåŠ©æ•°æ®çš„æ–¹æ³•æ¥è§£å†³è½¯ä»¶å·¥ç¨‹é¢†åŸŸé—®é¢˜ï¼Œä¸»è¦åŒ…æ‹¬å»ºç«‹ç²¾ç¡®çš„æ•°å­¦æ¨¡å‹ä»¥åŠå¯¹æ¨¡å‹çš„åˆ†ææ´»åŠ¨ã€‚</li><li><ol><li>åŸºç¡€æ¦‚å¿µ</li></ol></li><li><ol start="2"><li>å½¢å¼åŒ–æ–¹æ³•ä¸é¢å‘å¯¹è±¡æ–¹çš„ç»“åˆ</li></ol></li><li><ol start="3"><li>å·¥å…·å¼€å‘</li></ol></li></ul><h2 id="ç³»ç»Ÿè§„åˆ’">ç³»ç»Ÿè§„åˆ’</h2><h3 id="é¡¹ç›®çš„æå‡ºä¸é€‰æ‹©">é¡¹ç›®çš„æå‡ºä¸é€‰æ‹©</h3><ul><li><p>é¡¹ç›®çš„ç«‹é¡¹ç›®æ ‡å’ŒåŠ¨æœº</p><ul><li><ol><li>åŸºç¡€ç ”ç©¶å¹¶è·å–æŠ€æœ¯</li></ol></li><li><ol start="2"><li>è¿›è¡Œåº”ç”¨ç ”å‘å¹¶è·å–äº§å“</li></ol></li><li><ol start="3"><li>æä¾›æŠ€æœ¯æœåŠ¡</li></ol></li><li><ol start="4"><li>ä¿¡æ¯æŠ€æœ¯äº§å“çš„ä½¿ç”¨è€…</li></ol></li></ul></li><li><p>é¡¹ç›®çš„é€‰æ‹©å’Œç¡®å®š</p></li><li><p>é¡¹ç›®çš„æå‡ºå’Œé€‰æ‹©ç»“æœ</p></li></ul><h3 id="å¯è¡Œæ€§ç ”ç©¶å’Œæ•ˆç›Šåˆ†æ">å¯è¡Œæ€§ç ”ç©¶å’Œæ•ˆç›Šåˆ†æ</h3><ul><li><p>å¯è¡Œæ€§ç ”ç©¶å†…å®¹</p><ul><li>ç»æµå¯è¡Œæ€§</li><li>æŠ€æœ¯å¯è¡Œæ€§</li><li>æ³•å¾‹å¯è¡Œæ€§</li><li>æ‰§è¡Œå¯è¡Œæ€§</li><li>æ–¹æ¡ˆé€‰æ‹©</li></ul></li><li><p>æˆæœ¬æ•ˆç›Šåˆ†æ</p></li><li><p>å¯è¡Œæ€§åˆ†ææŠ¥å‘Š</p></li></ul><h3 id="æ–¹æ¡ˆçš„åˆ¶å®šå’Œæ”¹è¿›">æ–¹æ¡ˆçš„åˆ¶å®šå’Œæ”¹è¿›</h3><h3 id="æ–°æ—§ç»§ç»­çš„åˆ†æå’Œæ¯”è¾ƒ">æ–°æ—§ç»§ç»­çš„åˆ†æå’Œæ¯”è¾ƒ</h3><ul><li><p>é—ç•™ç³»ç»Ÿçš„è¯„ä»·æ–¹æ³•</p><ul><li>å•†ä¸šä»·å€¼è¯„ä»·</li><li>å¤–éƒ¨ç¯å¢ƒè¯„ä»·</li><li>åº”ç”¨è½¯ä»¶è¯„ä»·</li></ul></li><li><p>é—ç•™ç³»ç»Ÿçš„æ¼”åŒ–ç­–ç•¥</p><ul><li><ol><li>æ·˜æ±°ç­–ç•¥ - ä½æ°´å¹³ä½ä»·å€¼</li></ol></li><li><ol start="2"><li>ç»§æ‰¿ç­–ç•¥ - ä½æ°´å¹³é«˜ä»·å€¼</li></ol></li><li><ol start="3"><li>æ”¹é€ ç­–ç•¥ - é«˜æ°´å¹³é«˜ä»·å€¼</li></ol></li><li><ol start="4"><li>é›†æˆç­–ç•¥ - é«˜æ°´å¹³ä½ä»·å€¼</li></ol></li></ul></li></ul><h2 id="ç³»ç»Ÿåˆ†æä¸è®¾è®¡æ–¹æ³•">ç³»ç»Ÿåˆ†æä¸è®¾è®¡æ–¹æ³•</h2><h3 id="å®šä¹‰é—®é¢˜ä¸å½’ç»“æ¨¡å‹">å®šä¹‰é—®é¢˜ä¸å½’ç»“æ¨¡å‹</h3><ul><li><p>é—®é¢˜åˆ†æ</p><ul><li><p>ç›®æ ‡æ˜¯åœ¨å¼€å‘ä¹‹å‰å¯¹è¦è§£å†³çš„é—®é¢˜æœ‰ä¸€ä¸ªæ›´é€å½»çš„ç†è§£</p></li><li><p>åœ¨é—®é¢˜å®šä¹‰ä¸Šè¾¾æˆå…±è¯†</p><ul><li><ol><li>é—®é¢˜æ¦‚è¿°</li></ol></li><li><ol start="2"><li>é—®é¢˜å½±å“</li></ol></li><li><ol start="3"><li>é—®é¢˜ç»“æœ</li></ol></li><li><ol start="4"><li>é—®é¢˜ä¼˜ç‚¹</li></ol></li></ul></li><li><p>ç†è§£é—®é¢˜æœ¬è´¨</p><ul><li>é±¼éª¨å›¾</li><li>å¸•ç´¯æ‰˜å›¾åˆ†æé—®é¢˜çš„æœ¬è´¨</li></ul></li><li><p>ç¡®å®šé¡¹ç›®å¹²ç³»äººå’Œç”¨æˆ·</p></li><li><p>å®šä¹‰ç³»ç»Ÿçš„è¾¹ç•Œ</p><ul><li><p>ç³»ç»Ÿçš„è¾¹ç•ŒæŒ‡è§£å†³æ–¹æ¡ˆç³»ç»Ÿå’Œç°å®ä¸–ç•Œä¹‹é—´çš„è¾¹ç•Œ</p></li><li><ol><li>ä¸Šä¸‹æ–‡èŒƒå›´å›¾</li></ol><ul><li>æ•°æ®æµå›¾ä¸­çš„é¡¶å±‚å›¾ï¼Œååº”é¢†åŸŸä¿¡æ¯æ¨¡å‹ï¼Œèƒ½å¤Ÿè®©è¯»è€…å®è§‚çš„äº†è§£ç³»ç»Ÿ</li></ul></li><li><ol start="2"><li>ç”¨ä¾‹æ¨¡å‹</li></ol></li></ul></li><li><p>ç¡®å®šç³»ç»Ÿå®ç°çš„çº¦æŸ</p></li></ul></li><li><p>é—®é¢˜å®šä¹‰</p><ul><li><p>ç›®æ ‡</p><ul><li>ç›®æ ‡æ˜¯æ„å»ºç³»ç»Ÿçš„åŸå› ï¼Œä»–æ˜¯æœ€é«˜å±‚çš„ç”¨æˆ·éœ€æ±‚ï¼Œæ˜¯ä¸šåŠ¡ä¸Šçš„éœ€è¦</li></ul></li><li><p>åŠŸèƒ½éœ€æ±‚</p><ul><li>æŒ‡æ˜ç³»ç»Ÿå¿…é¡»è¦åšçš„äº‹æƒ…ï¼Œåªæœ‰è¿™äº›è¡Œä¸ºçš„å­˜åœ¨ï¼Œæ‰æœ‰ç³»ç»Ÿçš„å­˜åœ¨çš„ä»·å€¼</li></ul></li><li><p>éåŠŸèƒ½éœ€æ±‚</p><ul><li>æŒ‡è§‚æ„Ÿéœ€æ±‚ã€æ˜“ç”¨æ€§éœ€æ±‚ã€æ€§èƒ½éœ€æ±‚ã€å¯æ“ä½œæ€§éœ€æ±‚ã€å¯ç»´æŠ¤æ€§å’Œå¯ç§»æ¤æ€§éœ€æ±‚ã€å®‰å…¨æ€§éœ€æ±‚ã€æ–‡åŒ–å’Œæ­£å¸¸éœ€æ±‚ã€æ³•å¾‹éœ€æ±‚</li></ul></li></ul></li></ul><h3 id="éœ€æ±‚åˆ†æä¸è½¯ä»¶è®¾è®¡">éœ€æ±‚åˆ†æä¸è½¯ä»¶è®¾è®¡</h3><ul><li><p>éœ€æ±‚åˆ†æçš„ä»»åŠ¡ä¸è¿‡ç¨‹</p><ul><li><p>é—®é¢˜è¯†åˆ«</p><ul><li>å‘ç°éœ€æ±‚ã€æè¿°éœ€æ±‚</li></ul></li><li><p>åˆ†æä¸ç»¼åˆ</p><ul><li>å¯¹é—®é¢˜ä»Šæ˜”åˆ†æï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šæ•´åˆå‡ºè§£å†³æ–¹æ¡ˆ</li></ul></li><li><p>ç¼–åˆ¶éœ€æ±‚åˆ†ææ–‡æ¡£</p><ul><li>éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦ï¼šå¯¹å·²ç¡®å®šçš„éœ€æ±‚è¿›è¡Œç¨³å®šåŒ–æè¿°</li></ul></li><li><p>éœ€æ±‚åˆ†æè¯„å®¡</p><ul><li>å¯¹åŠŸèƒ½çš„æ­£ç¡®æ€§ã€å®Œæ•´æ€§å’Œæ¸…æ™°æ€§ï¼Œä»¥åŠå…¶ä»–éœ€æ±‚è¿›è¡Œè¯„ä»·</li></ul></li></ul></li><li><p>éœ€æ±‚è·å–æ–¹æ³•</p><ul><li>ç”¨æˆ·è®¿è°ˆ</li><li>ç”¨æˆ·è°ƒæŸ¥</li><li>ç°åœºè§‚æ‘©</li><li>é˜…è¯»å†å²æ–‡æ¡£</li><li>è”åˆè®¨è®ºä¼š</li></ul></li><li><p>éœ€æ±‚å®šä¹‰</p><ul><li><p>ä¸¥æ ¼å®šä¹‰æ–¹æ³•</p></li><li><p>åŸå‹æ–¹æ³•</p><ul><li>å…ˆå®ç°ä¸€ä¸ªæ»¡è¶³ç”¨æˆ·åŸºæœ¬éœ€æ±‚çš„åŸå‹ï¼Œå†ç”±ç”¨æˆ·åœ¨å¼€å‘è¿‡ç¨‹ä¸­æå‡ºæ›´å¥½çš„éœ€æ±‚ï¼Œæ ¹æ®ç”¨æˆ·è¦æ±‚ä¸æ–­å¯¹ç³»ç»Ÿè¿›è¡Œæ”¹è¿›ã€‚è¿™é‡Œé¢æœ‰è¿­ä»£çš„æ€æƒ³</li></ul></li><li><p>ç¼–å†™è½¯ä»¶éœ€æ±‚è¯´æ˜ä¹¦SRS</p></li></ul></li><li><p>å¦‚ä½•è¿›è¡Œç³»ç»Ÿè®¾è®¡</p><ul><li>ç»„ä»¶çš„ç‹¬ç«‹æ€§ï¼šä¾‹å¤–çš„è¯†åˆ«å’Œå¤„ç†ï¼›é˜²é”™å’Œå®¹é”™</li></ul></li><li><p>è½¯ä»¶è®¾è®¡çš„ä»»åŠ¡ä¸æ´»åŠ¨</p><ul><li>æ¦‚è¦è®¾è®¡ã€è¯¦ç»†è®¾è®¡</li></ul></li></ul><h3 id="å¸¸ç”¨çš„åˆ†ææ–¹æ³•">å¸¸ç”¨çš„åˆ†ææ–¹æ³•</h3><ul><li><p>é¢å‘æ•°æ®æµ - ç»“æ„åŒ–åˆ†æä¸è®¾è®¡</p><ul><li><p>ä¸€ç§é¢å‘æ•°æ®æµçš„éœ€æ±‚åˆ†æå’Œè®¾è®¡æ–¹æ³•ï¼Œé€‚ç”¨äºåˆ†æå’Œè®¾è®¡å¤§å‹æ•°æ®å¤„ç†ç³»ç»Ÿï¼Œæ˜¯ä¸€ç§ç®€å•çš„æ–¹æ³•</p></li><li><p>ç»“æ„åŒ–åˆ†æ</p><ul><li>åŸºæœ¬æ€æƒ³æ˜¯è‡ªé¡¶å‘ä¸‹é€å±‚åˆ†è§£</li></ul></li><li><p>ç»“æ„åŒ–è®¾è®¡</p><ul><li>æ¶æ„è®¾è®¡</li><li>æ¥å£è®¾è®¡</li><li>æ•°æ®è®¾è®¡</li><li>è¿‡ç¨‹è®¾è®¡</li></ul></li><li><p>æ¨¡å—è®¾è®¡</p><ul><li>æ¨¡å—ç‹¬ç«‹åŒ–åŸåˆ™</li><li>ä¿¡æ¯éšè—åŸåˆ™</li></ul></li></ul></li><li><p>é¢å‘å¯¹è±¡ - é¢å‘å¯¹è±¡çš„åˆ†æä¸è®¾è®¡</p><ul><li><p>é¢å‘å¯¹è±¡çš„åŸºæœ¬æ¦‚å¿µ</p><ul><li><p>å¯¹è±¡å’Œç±»</p><ul><li>å®ä½“ç±»ï¼šæ˜ å°„éœ€æ±‚ä¸­çš„æ¯ä¸ªå®ä½“</li><li>è¾¹ç•Œç±»ï¼šç”¨äºå°è£…ç”¨ä¾‹å†…ã€å¤–çš„ä¿¡æ¯æˆ–æ•°æ®æµ</li><li>æ§åˆ¶ç±»ï¼šç”¨äºæ§åˆ¶ç”¨ä¾‹å·¥ä½œçš„ç±»</li></ul></li><li><p>ç»§æ‰¿å’ŒèŒƒåŒ–</p></li><li><p>å¤šæ€</p></li><li><p>æ¨¡æ¿ç±»</p><ul><li>ç±»å±ç±»ï¼Œç”¨æ¥å®ç°å‚æ•°å¤šæ€æœºåˆ¶</li></ul></li><li><p>æ¶ˆæ¯å’Œæ¶ˆæ¯é€šä¿¡</p><ul><li>æ¶ˆæ¯ï¼šå‘å¯¹è±¡å‘å‡ºçš„æœåŠ¡è¯·æ±‚</li></ul></li></ul></li><li><p>é¢å‘å¯¹è±¡åˆ†æ</p><ul><li><p>ä»‹ç»</p><ul><li>é¢å‘å¯¹è±¡åˆ†æçš„ç›®æ ‡æ˜¯å¼€å‘ä¸€ç³»åˆ—æ¨¡å‹ï¼Œè¿™äº›æ¨¡å‹æè¿°è®¡ç®—æœºè½¯ä»¶ï¼Œå½“å®ƒå·¥ä½œæ—¶ä»¥æ»¡è¶³ä¸€ç»„å®¢æˆ·å®šä¹‰çš„éœ€æ±‚</li></ul></li><li><p>OOA/OODæ–¹æ³•</p></li><li><p>Boochæ–¹æ³•</p></li><li><p>OMTæ–¹æ³•</p></li><li><p>OOSEæ–¹æ³•</p></li></ul></li><li><p>ç»Ÿä¸€å»ºæ¨¡è¯­è¨€UML</p><ul><li><p>ç”¨ä¾‹å›¾</p><ul><li>ä»ç”¨æˆ·è§’åº¦æè¿°äº†ç³»ç»Ÿçš„åŠŸèƒ½ï¼Œå¹¶æŒ‡å‡ºå„ä¸ªåŠŸèƒ½çš„æ‰§è¡Œè€…</li></ul></li><li><p>ç±»å›¾</p><ul><li>ç”¨ä¾‹å›¾æŠ½è±¡æˆç±»ï¼Œæè¿°ç±»çš„å†…éƒ¨ç»“æ„å’Œç±»ä¸ç±»ä¹‹é—´çš„å…³ç³»</li><li>æ³›åŒ–ï¼šç»§æ‰¿å…³ç³»</li><li>å®ç°ï¼šç±»ä¸æ¥å£</li><li>å…³è”ï¼šæ‹¥æœ‰å…³ç³»</li><li>èšåˆï¼šæ•´ä½“ä¸éƒ¨åˆ†ï¼Œéƒ¨åˆ†ç¦»å¼€æ•´ä½“è€Œå•ç‹¬å­˜åœ¨</li><li>ç»„åˆï¼šæ•´ä½“ä¸éƒ¨åˆ†ï¼Œéƒ¨åˆ†ä¸èƒ½ç¦»å¼€æ•´ä½“</li><li>ä¾èµ–</li></ul></li><li><p>å¯¹è±¡å›¾</p><ul><li>å„ä¸ªå¯¹è±¡åœ¨äº¤äº’è¿‡ç¨‹ä¸­æŸä¸€æ—¶åˆ»çš„çŠ¶æ€</li></ul></li><li><p>åºåˆ—å›¾</p><ul><li>äº¤äº’å›¾çš„ä¸€ç§ï¼Œå¯¹è±¡ä¹‹é—´æ¶ˆæ¯å‘é€çš„å…ˆåé¡ºåº</li></ul></li><li><p>åä½œå›¾</p><ul><li>äº¤äº’å›¾çš„ä¸€ç§ï¼Œæ”¶å‘æ¶ˆæ¯çš„å¯¹è±¡çš„ç»„ç»‡å…³ç³»</li></ul></li><li><p>çŠ¶æ€å›¾</p><ul><li>ä¸€ç§ç”±çŠ¶æ€ã€å˜è¿ã€äº‹ä»¶å’Œæ´»åŠ¨ç»„æˆçš„çŠ¶æ€æœº</li></ul></li><li><p>æ´»åŠ¨å›¾</p><ul><li>çŠ¶æ€å›¾çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µ</li></ul></li><li><p>æ„ä»¶å›¾</p><ul><li>ç³»ç»Ÿä¸­æ„ä»¶ä¸æ„ä»¶ä¹‹é—´ï¼Œç±»æˆ–æ¥å£ä¸æ„ä»¶ä¹‹é—´çš„å…³ç³»å›¾</li></ul></li><li><p>éƒ¨ç½²å›¾</p><ul><li>ç‰©ç†è®¾å¤‡ä»¥åŠä¹‹é—´çš„è¿æ¥å…³ç³»</li></ul></li></ul></li></ul></li><li><p>é¢å‘æ•°æ®ç»“æ„ - jacksonæ–¹æ³•</p></li><li><p>ç»“æ„åŒ–æ•°æ®ç³»ç»Ÿå¼€å‘ - DSSDæ–¹æ³•</p></li></ul><h3 id="ç”¨æˆ·ç•Œé¢è®¾è®¡">ç”¨æˆ·ç•Œé¢è®¾è®¡</h3><ul><li>ç”¨æˆ·ç•Œé¢è®¾è®¡åŸåˆ™</li><li>ç”¨æˆ·ç•Œé¢è®¾è®¡è¿‡ç¨‹</li></ul><h3 id="å·¥ä½œæµè®¾è®¡">å·¥ä½œæµè®¾è®¡</h3><ul><li><p>å·¥ä½œæµè®¾è®¡æ¦‚å¿µ</p><ul><li>å·¥ä½œæµæ˜¯ä¸€ç±»èƒ½å¤Ÿå®Œå…¨æˆ–è€…éƒ¨åˆ†è‡ªåŠ¨æ‰§è¡Œçš„è¿‡ç¨‹ï¼Œæ ¹æ®ä¸€ç³»åˆ—è¿‡ç¨‹è§„åˆ™ã€æ–‡æ¡£ã€ä¿¡æ¯æˆ–ä»»åŠ¡åœ¨ä¸åŒçš„æ‰§è¡Œè€…ä¹‹é—´ä¼ é€’ã€æ‰§è¡Œ</li></ul></li><li><p>å·¥ä½œæµç®¡ç†ç³»ç»Ÿ WFMC</p><ul><li>åœ¨å·¥ä½œæµå½¢å¼åŒ–è¡¨ç¤ºçš„é©±åŠ¨ä¸‹ï¼Œé€šè¿‡è½¯ä»¶çš„æ‰§è¡Œè€Œå®Œæˆå·¥ä½œæµå®šä¹‰ã€ç®¡ç†åŠæ‰§è¡Œçš„ç³»ç»Ÿï¼Œå…¶ä¸»è¦ç›®æ ‡æ˜¯å¯¹ä¸šåŠ¡è¿‡ç¨‹ä¸­å„æ´»åŠ¨å‘ç”Ÿçš„å…ˆåæ¬¡åºåŠä¸æ´»åŠ¨ç›¸å…³çš„ç›¸åº”äººåŠ›æˆ–ä¿¡æ¯èµ„æºçš„è°ƒç”¨è¿›è¡Œç®¡ç†ï¼Œè€Œå®ç°ä¸šåŠ¡è¿‡ç¨‹çš„è‡ªåŠ¨åŒ–</li></ul></li></ul><h3 id="ç®€å•åˆ†å¸ƒå¼è®¡ç®—æœºåº”ç”¨ç³»ç»Ÿè®¾è®¡">ç®€å•åˆ†å¸ƒå¼è®¡ç®—æœºåº”ç”¨ç³»ç»Ÿè®¾è®¡</h3><h3 id="ç³»ç»Ÿè¿è¡Œç¯å¢ƒçš„é›†æˆä¸è®¾è®¡">ç³»ç»Ÿè¿è¡Œç¯å¢ƒçš„é›†æˆä¸è®¾è®¡</h3><ul><li><p>é›†ä¸­å¼ç³»ç»Ÿ</p><ul><li>æ‰€æœ‰çš„æ“ä½œéƒ½é›†ä¸­äºä¸€å°ä¸»æœºä¸­ï¼Œè€Œæ“ä½œå‘˜å¿…é¡»åœ¨ä¸»æœºçš„é™„è¿‘æ“ä½œï¼Œç»“æœä¹Ÿåœ¨é™„è¿‘ç»™å‡º</li></ul></li><li><p>åˆ†å¸ƒå¼ç³»ç»Ÿ</p></li><li><p>C/Sç»“æ„</p></li><li><p>å¤šå±‚ç»“æ„</p></li></ul><h3 id="ç³»ç»Ÿè¿‡æ¸¡è®¡åˆ’">ç³»ç»Ÿè¿‡æ¸¡è®¡åˆ’</h3><ul><li>ç›´æ¥è¿‡æ¸¡</li><li>å¹¶è¡Œè¿‡æ¸¡</li><li>é˜¶æ®µè¿‡æ¸¡</li></ul><h2 id="è½¯ä»¶æ¶æ„è®¾è®¡">è½¯ä»¶æ¶æ„è®¾è®¡</h2><h3 id="è½¯ä»¶æ¶æ„æ¦‚è¿°">è½¯ä»¶æ¶æ„æ¦‚è¿°</h3><ul><li><p>è½¯ä»¶æ¶æ„çš„å®šä¹‰</p><ul><li>è½¯ä»¶æ¶æ„æ˜¯æŒ‡ä¸€ä¸ªç³»ç»Ÿçš„åŸºç¡€ç»„ç»‡ï¼Œå®ƒå…·ä½“ä½“ç°åœ¨ï¼šç³»ç»Ÿçš„æ„ä»¶ï¼Œæ„ä»¶ä¹‹é—´ã€æ„ä»¶ä¸ç¯å¢ƒä¹‹é—´çš„å…³ç³»ï¼Œä»¥åŠæŒ‡å¯¼å…¶è®¾è®¡å’Œæ¼”åŒ–çš„åŸåˆ™</li></ul></li><li><p>è½¯ä»¶æ¶æ„çš„é‡è¦æ€§</p><ul><li><ol><li>é¡¹ç›®å…³ç³»äººä¹‹é—´çš„äº¤æµå¹³å°</li></ol></li><li><ol start="2"><li>æ—©æœŸè®¾è®¡å†³ç­–</li></ol></li><li><ol start="3"><li>åœ¨è¾ƒé«˜å±‚é¢å®ç°è½¯ä»¶å¤ç”¨</li></ol></li><li><ol start="4"><li>æ¶æ„å¯¹å¼€å‘çš„æŒ‡å¯¼ä¸è§„èŒƒæ„ä¹‰</li></ol></li></ul></li><li><p>æ¶æ„çš„æ¨¡å‹</p><ul><li><p>ç»“æ„æ¨¡å‹</p><ul><li>è¿™ç§æ–¹æ³•ä»¥æ¶æ„çš„æ„ä»¶ã€è¿æ¥ä»¶å’Œå…¶ä»–æ¦‚å¿µæ¥åˆ»ç”»ç»“æ„ï¼Œå¹¶åŠ›å›¾é€šè¿‡ç»“æ„æ¥åæ˜ ç³»ç»Ÿçš„é‡è¦è¯­ä¹‰å†…å®¹ï¼ŒåŒ…æ‹¬ç³»ç»Ÿçš„é…ç½®ã€çº¦æŸã€éšå«çš„å‡è®¾æ¡ä»¶ã€é£æ ¼ã€æ€§è´¨</li></ul></li><li><p>æ¡†æ¶æ¨¡å‹</p><ul><li>æ¡†æ¶æ¨¡å‹ä¸ç»“æ„æ¨¡å‹ç±»ä¼¼ï¼Œä½†å®ƒä¸å¤ªä¾§é‡æè¿°ç»“æ„çš„ç»†èŠ‚è€Œæ›´ä¾§é‡äºæ•´ä½“çš„ç»“æ„</li></ul></li><li><p>åŠ¨æ€æ¨¡å‹</p><ul><li>åŠ¨æ€æ¨¡å‹æ˜¯å¯¹ç»“æ„æˆ–æ¡†æ¶æ¨¡å‹çš„è¡¥å……ï¼Œç ”ç©¶ç³»ç»Ÿâ€å¤§é¢—ç²’â€œçš„è¡Œä¸ºæ€§è´¨</li></ul></li><li><p>è¿‡ç¨‹æ¨¡å‹</p><ul><li>è¿‡ç¨‹æ¨¡å‹ç ”ç©¶æ„é€ ç³»ç»Ÿçš„æ­¥éª¤å’Œè¿‡ç¨‹</li></ul></li><li><p>åŠŸèƒ½æ¨¡å‹</p><ul><li>åŠŸèƒ½æ¨¡å‹ï¼šæ¶æ„ç”±ä¸€ç»„åŠŸèƒ½æ„ä»¶æŒ‰å±‚æ¬¡ç»„æˆï¼Œä¸”ä¸‹å±‚å‘ä¸Šå±‚æä¾›æœåŠ¡</li></ul></li><li><p>4+1è§†å›¾æ¨¡å‹</p><ul><li><p>åœºæ™¯è§†å›¾</p><ul><li>ä»ç”¨æˆ·è§’åº¦ã€è¯†åˆ«ä¸šåŠ¡éœ€æ±‚ï¼Œæè¿°ä¸šåŠ¡åœºæ™¯ï¼Œæ˜¯æ¶æ„è®¾è®¡çš„èµ·ç‚¹å’Œç»ˆç‚¹</li></ul></li><li><p>é€»è¾‘è§†å›¾</p><ul><li>ä»å¯¹è±¡è§’åº¦ï¼Œæ„å»ºå¯¹è±¡æ¨¡å‹ï¼Œç”¨ä»¥ç¡®ç«‹é€»è¾‘åˆ†å±‚ã€æ¨¡å—åˆ’åˆ†ã€æ¨¡å—åŠŸèƒ½ã€æ¨¡å—é—´ä¾èµ–å…³ç³»ç­‰</li></ul></li><li><p>å¼€å‘/å®ç°è§†å›¾</p><ul><li>ä»å¼€å‘è§’åº¦ï¼Œæè¿°è½¯ä»¶åœ¨å¼€å‘ç¯å¢ƒä¸‹çš„é™æ€ç»„ç»‡(ç¨‹åºåŒ…ã€åº”ç”¨çš„ç»Ÿä¸€æ¡†æ¶ï¼Œå¼•ç”¨çš„ç±»åº“ã€SDKå’Œä¸­é—´ä»¶ç­‰)ï¼Œå¹¶è§„èŒƒå’Œçº¦æŸå¼€å‘ç¯å¢ƒçš„ç»“æ„</li></ul></li><li><p>è¿‡ç¨‹/è¿›ç¨‹è§†å›¾</p><ul><li>ä»è¿›ç¨‹è§’åº¦ï¼Œæè¿°ç³»ç»Ÿçš„å¹¶å‘å’ŒåŒæ­¥è®¾è®¡ã€‚æ—¨åœ¨è§£å†³è¿›ç¨‹ã€çº¿ç¨‹ã€å¹¶å‘ã€åŒæ­¥ã€é€šä¿¡ç­‰æ–¹é¢çš„é—®é¢˜</li></ul></li><li><p>ç‰©ç†è§†å›¾</p><ul><li>ä»éƒ¨ç½²çš„è§’åº¦ï¼Œæè¿°è½¯ç¡¬ä»¶çš„æ˜ å°„å…³ç³»ï¼Œä»¥åŠç³»ç»Ÿåœ¨åˆ†å¸ƒ/éƒ¨ç½²ä¸Šçš„è®¾è®¡</li></ul></li></ul></li></ul></li></ul><h3 id="æ¶æ„éœ€æ±‚ä¸è½¯ä»¶è´¨é‡å±æ€§">æ¶æ„éœ€æ±‚ä¸è½¯ä»¶è´¨é‡å±æ€§</h3><ul><li><p>è½¯ä»¶è´¨é‡å±æ€§</p></li><li><p>6ä¸ªè´¨é‡å±æ€§åŠå®ç°</p><ul><li><p>å¯ç”¨æ€§</p><ul><li>é”™è¯¯æ£€æµ‹ï¼šå‘½ä»¤/å“åº”ï¼›å¿ƒè·³ï¼›å¼‚å¸¸</li><li>é”™è¯¯æ¢å¤ï¼šè¡¨å†³ï¼›ä¸»åŠ¨å†—ä½™</li><li>é”™è¯¯é¢„é˜²ï¼šä»æœåŠ¡ä¸­åˆ é™¤ï¼›äº‹åŠ¡ï¼›è¿›ç¨‹ç›‘è§†</li></ul></li><li><p>å¯ä¿®æ”¹æ€§</p><ul><li>å±€éƒ¨åŒ–ä¿®æ”¹</li><li>é˜²æ­¢è¿é”ååº”ï¼›ä¿¡æ¯éšè—ã€é™åˆ¶é€šä¿¡è·¯å¾„ï¼›ä»²è£è€…ä½¿ç”¨</li></ul></li><li><p>æ€§èƒ½</p><ul><li>èµ„æºéœ€æ±‚ï¼šæ§åˆ¶èµ„æºä½¿ç”¨</li><li>èµ„æºç®¡ç†ï¼šå¼•å…¥å¹¶å‘ï¼Œå¢åŠ å¯ç”¨èµ„æº</li><li>èµ„æºä»²è£ï¼šå›ºå®šä¼˜å…ˆçº§èµ„æºè°ƒåº¦ã€åŠ¨æ€ä¼˜åŒ–çº§è°ƒåº¦</li></ul></li><li><p>å®‰å…¨æ€§</p><ul><li>æŠµæŠ—æ”»å‡»ï¼šå¯¹ç”¨æˆ·èº«ä»½éªŒè¯ã€å¯¹ç”¨æˆ·è¿›è¡Œæˆæƒã€ç»´æŠ¤æ•°æ®çš„æœºå¯†æ€§ã€ç»´æŠ¤å®Œæ•´æ€§ã€‚</li><li>æ£€æµ‹æ”»å‡»</li><li>ä»æ”»å‡»ä¸­æ¢å¤</li></ul></li><li><p>å¯æµ‹è¯•æ€§</p></li><li><p>æ˜“ç”¨æ€§</p></li></ul></li></ul><h3 id="è½¯ä»¶æ¶æ„é£æ ¼">è½¯ä»¶æ¶æ„é£æ ¼</h3><ul><li><p>è½¯ä»¶æ¶æ„é£æ ¼åˆ†ç±»</p></li><li><p>æ•°æ®æµé£æ ¼</p><ul><li><p>æ‰¹å¤„ç†é£æ ¼</p><ul><li>æ‰¹å¤„ç†é£æ ¼ï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸”æ¯ä¸€æ­¥éƒ½æ˜¯é¡ºåºæ‰§è¡Œçš„ã€‚ä¾‹å¦‚BATç¨‹åº</li></ul></li><li><p>ç®¡é“-è¿‡æ»¤å™¨é£æ ¼</p><ul><li>UNIX Sheelç¨‹åº</li></ul></li></ul></li><li><p>è°ƒç”¨è¿”å›é£æ ¼</p><ul><li>ä¸»ç¨‹åº-å­ç¨‹åº</li><li>é¢å‘å¯¹è±¡é£æ ¼</li><li>å±‚æ¬¡ç»“æ„é£æ ¼</li></ul></li><li><p>ç‹¬ç«‹æ„ä»¶é£æ ¼</p><ul><li><p>è¿›ç¨‹é€šä¿¡</p><ul><li>æ„ä»¶æ˜¯ç‹¬ç«‹çš„ï¼Œè¿æ¥ä»¶ä¼ é€’æ¶ˆæ¯</li></ul></li><li><p>äº‹ä»¶é©±åŠ¨</p><ul><li>æ„ä»¶ä¸ç›´æ¥è°ƒç”¨ä¸€ä¸ªè¿‡ç¨‹ï¼Œè€Œæ˜¯è§¦å‘æˆ–è€…å¹¿æ’­ä¸€ä¸ªæˆ–å¤šä¸ªäº‹ä»¶é©±åŠ¨</li></ul></li></ul></li><li><p>è™šæ‹Ÿæœºé£æ ¼</p><ul><li><p>è§£é‡Šå™¨</p><ul><li>é€šå¸¸åŒ…æ‹¬è§£æå·¥ä½œçš„è§£æå¼•æ“ï¼Œä¸€ä¸ªåŒ…å«è¢«è§£æçš„ä»£ç å­˜å‚¨åŒºï¼Œä¸€ä¸ªè®°å½•è§£æå¼•æ“å½“å‰å·¥ä½œçŠ¶æ€å’Œæ•°æ®ç»“æ„ï¼Œä»¥åŠè®°å½•æºä»£ç è¢«è§£ææ‰§è¡Œçš„è¿›åº¦çš„æ•°æ®ç»“æ„</li></ul></li><li><p>åŸºäºè§„åˆ™</p></li></ul></li><li><p>ä»“åº“é£æ ¼</p><ul><li><p>æ•°æ®åº“ç³»ç»Ÿ</p><ul><li><ol><li>é‡è¦æ•°æ®å…±äº«ï¼Œä¿å­˜å½“å‰ç³»ç»Ÿçš„æ•°æ®çŠ¶æ€</li></ol></li><li><ol start="2"><li>å¤šä¸ªç‹¬ç«‹å¤„ç†å…ƒç´ ï¼Œå¤„ç†å…ƒç´ å¯¹æ•°æ®è¿›è¡Œæ“ä½œ</li></ol></li></ul></li><li><p>è¶…æ–‡æœ¬ç³»ç»Ÿ</p></li><li><p>é»‘æ¿é£æ ¼</p><ul><li>ä¸»è¦åº”ç”¨ä¸ä¿¡å·å¤„ç†é¢†åŸŸæˆ–è€…æ¾è€¦åˆä»£ç†æ•°æ®å…±äº«å­˜å–</li></ul></li></ul></li></ul><h3 id="å±‚æ¬¡ç³»ç»Ÿæ¶æ„é£æ ¼">å±‚æ¬¡ç³»ç»Ÿæ¶æ„é£æ ¼</h3><ul><li><p>äºŒå±‚åŠä¸‰å±‚C/Sæ¶æ„é£æ ¼</p></li><li><p>B/Sæ¶æ„é£æ ¼</p></li><li><p>MVCæ¶æ„é£æ ¼</p><ul><li><p>Model</p><ul><li>åº”ç”¨çŠ¶æ€å’Œä¸šåŠ¡åŠŸèƒ½çš„å°è£…ï¼Œå¯ä»¥è£‚è§£ä¸ºåŒæ—¶åŒ…å«æ•°æ®å’Œè¡Œä¸ºçš„é¢†åŸŸæ¨¡å‹</li></ul></li><li><p>View</p><ul><li>å®ç°å¯è§†åŒ–ç•Œé¢çš„å‘ˆç°ï¼Œå¹¶æ•æ‰æœ€ç»ˆç”¨æˆ·çš„äº¤äº’é€»è¾‘</li></ul></li><li><p>Controller</p><ul><li>å®Œæˆå“åº”çš„UIé€»è¾‘ï¼Œè®¾è®¡ä¸šåŠ¡åŠŸèƒ½çš„è°ƒç”¨ï¼Œè°ƒç”¨å¯¹åº”çš„Model</li></ul></li></ul></li></ul><h3 id="é¢å‘æœåŠ¡çš„æ¶æ„">é¢å‘æœåŠ¡çš„æ¶æ„</h3><ul><li><p>SOA(Service Oriented Architecture)æ¦‚è¿°</p><ul><li><p>æ‰€æœ‰çš„åŠŸèƒ½éƒ½å®šä¹‰æˆäº†ç‹¬ç«‹çš„æœåŠ¡ã€‚æ‰€æœ‰çš„æœåŠ¡é€šè¿‡æœåŠ¡æ€»çº¿æˆ–è€…æµç¨‹ç®¡ç†å™¨æ¥è¿æ¥ã€‚SOAæ˜¯ä¸€ç§æ¶æ„è®¾è®¡æ¨¡å¼</p></li><li><p>è®¾è®¡åŸåˆ™</p><ul><li><ol><li>æ˜ç¡®å®šä¹‰çš„æ¥å£</li></ol></li><li><ol start="2"><li>æ¨¡å—åŒ–</li></ol></li><li>3â€¦ ç²—ç²’åº¦</li><li><ol start="4"><li>æ¾è€¦åˆ</li></ol></li><li><ol start="5"><li>äº’æ“ä½œæ€§ï¼Œå…¼å®¹å’Œç­–ç•¥å£°æ˜</li></ol></li></ul></li></ul></li><li><p>SOAå…³é”®æŠ€æœ¯</p><ul><li><p>UDDI</p><ul><li><p>UDDI(Universal Description and Integration)ç»Ÿä¸€æè¿°ã€å‘ç°å’Œé›†æˆã€‚</p><ul><li>æ³¨å†Œå’ŒæŸ¥æ‰¾æœåŠ¡</li></ul></li></ul></li><li><p>WSDL</p><ul><li><p>WebæœåŠ¡æè¿°è¯­è¨€</p><ul><li>WSDLæ˜¯ä¸€ä¸ªXMLæ–‡æ¡£ï¼Œç”¨äºè¯´æ˜ä¸€ç»„SOAPæ¶ˆæ¯ä»¥åŠå¦‚ä½•äº¤æ¢è¿™äº›æ¶ˆæ¯</li></ul></li></ul></li><li><p>SOAP</p><ul><li><p>ç®€å•å¯¹è±¡è®¿é—®åè®®(http+xml)</p><ul><li>SOAPæ˜¯Web serviceçš„é€šä¿¡åè®®ï¼Œç”¨äºåœ¨ç½‘ç»œåº”ç”¨ç¨‹åºä¹‹é—´è¿›è¡Œç»“æ„åŒ–æ•°æ®äº¤æ¢</li></ul></li></ul></li><li><p>REST</p><ul><li>http+jsonï¼šè¡¨ç¤ºçŠ¶æ€è½¬ç§»ï¼›æ˜¯ä¸€ç§ç”¨httpå’Œxmlè¿›è¡ŒåŸºäºwebé€šä¿¡çš„æŠ€æœ¯ï¼Œé™ä½å¼€å‘çš„å¤æ‚æ€§ã€æä¾›å¯ä¼¸ç¼©æ€§ã€‚</li></ul></li></ul></li><li><p>SOAçš„å®ç°æ–¹æ³•</p><ul><li>Web Service</li><li>ä¼ä¸šæœåŠ¡æ€»çº¿ESB</li><li>æœåŠ¡æ³¨å†Œè¡¨</li></ul></li><li><p>å¾®æœåŠ¡</p><ul><li>å¾®æœåŠ¡æ¶æ„æ˜¯ä¸€ç§æ¶æ„æ¨¡å¼æˆ–è€…è¯´æ˜¯ä¸€ç§æ¶æ„é£æ ¼ï¼Œå®ƒæå€¡å°†å•ä¸€åº”ç”¨ç¨‹åºåˆ’åˆ†æˆä¸€ç»„å°çš„æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡è¿è¡Œç‹¬ç«‹çš„è‡ªå·±çš„è¿›ç¨‹ä¸­ï¼ŒæœåŠ¡ä¹‹é—´äº’ç›¸åè°ƒã€äº’ç›¸é…åˆï¼Œä¸ºç”¨æˆ·æä¾›æœ€ç»ˆä»·å€¼</li></ul></li></ul><h3 id="æ¶æ„è®¾è®¡">æ¶æ„è®¾è®¡</h3><h3 id="è½¯ä»¶æ¶æ„æ–‡æ¡£åŒ–">è½¯ä»¶æ¶æ„æ–‡æ¡£åŒ–</h3><ul><li>è®°å½•è½¯ä»¶æ¶æ„çš„æ´»åŠ¨ï¼Œæ¶æ„ç¼–æ¡£çš„è¿‡ç¨‹</li></ul><h3 id="è½¯ä»¶æ¶æ„è¯„ä¼°">è½¯ä»¶æ¶æ„è¯„ä¼°</h3><ul><li><p>ç®€ä»‹</p><ul><li>å¯¹æ¶æ„åˆ†æã€è¯„ä¼°çš„æŠ€æœ¯ï¼Œå¯¹æ¶æ„ç­–ç•¥çš„é€‰å–å’Œå†³ç­–</li></ul></li><li><p>æ¶æ„è¯„ä¼°çš„æ–¹æ³•</p><ul><li>åŸºäºè°ƒæŸ¥åˆ—è¡¨</li><li>åŸºäºåœºæ™¯çš„æ–¹å¼</li><li>åŸºäºåº¦é‡çš„æ–¹å¼</li></ul></li><li><p>æ¶æ„çš„æƒè¡¡åˆ†ææ³•ATAM</p><ul><li><p>3ä¸ªæ¦‚å¿µ</p><ul><li><ol><li>è½¯ä»¶è´¨é‡å±æ€§</li></ol><ul><li>æ€§èƒ½</li><li>å¯é æ€§</li><li>å¯ç”¨æ€§</li><li>å®‰å…¨æ€§</li><li>å¯ä¿®æ”¹æ€§</li></ul></li><li><ol start="2"><li>æ•æ„Ÿç‚¹å’Œæƒè¡¡ç‚¹</li></ol></li><li><ol start="3"><li>é£é™©æ‰¿æ‹…è€…</li></ol></li></ul></li><li><p>æ­¥éª¤</p><ul><li><ol><li>æè¿°ATAMæ–¹æ³•</li></ol></li><li><ol start="2"><li>æè¿°å•†ä¸šåŠ¨æœº</li></ol></li><li><ol start="3"><li>æè¿°æ¶æ„ä½“ç³»ç»“æ„</li></ol></li><li><ol start="4"><li>ç¡®å®šæ¶æ„ä½“ç³»ç»“æ„æ–¹æ³•</li></ol></li><li><ol start="5"><li>ç”Ÿæˆè´¨é‡å±æ€§æ•ˆç”¨æ ‘</li></ol></li><li><ol start="6"><li>åˆ†ææ¶æ„æ–¹æ³•</li></ol><ul><li>ç¡®å®šæ¶æ„ä¸Šçš„æœ‰é£é™©å†³ç­–ï¼Œæ— é£é™©å†³ç­–ã€æ•æ„Ÿç‚¹å’Œæƒè¡¡ç‚¹</li></ul></li><li><ol start="7"><li>é›†ä½“è®¨è®ºï¼Œç¡®å®šåœºæ™¯ä¼˜å…ˆçº§</li></ol></li><li><ol start="8"><li>åˆ†ææ¶æ„æ–¹æ³•ï¼Œé‡å¤6</li></ol></li><li><ol start="9"><li>ç»“æœæè¿°</li></ol></li></ul></li></ul></li><li><p>æˆæœ¬æ•ˆç›Šåˆ†ææ³•</p></li></ul><h3 id="æ„ä»¶åŠå¤ç”¨">æ„ä»¶åŠå¤ç”¨</h3><ul><li><p>å•†ç”¨æ„ä»¶æ ‡å‡†åŒ–è§„èŒƒ</p><ul><li>ä¸‰å¤§ä¸»æµä¸­é—´ä»¶æŠ€æœ¯å¹³å°</li><li>CORBA</li><li>J2EE</li><li>DNA</li></ul></li><li><p>åº”ç”¨ç³»ç»Ÿç°‡ä¸æ„ä»¶ç³»ç»Ÿ</p></li><li><p>åŸºäºå¤ç”¨å¼€å‘çš„ç»„ç»‡ç»“æ„</p></li></ul><h3 id="äº§å“çº¿åŠç³»ç»Ÿæ¼”åŒ–">äº§å“çº¿åŠç³»ç»Ÿæ¼”åŒ–</h3><ul><li><p>å¤ç”¨ä¸äº§å“çº¿</p></li><li><p>åŸºç¡€äº§å“çº¿çš„æ¶æ„</p></li><li><p>äº§å“çº¿çš„å¼€å‘æ¨¡å‹</p></li><li><p>ç‰¹å®šé¢†åŸŸçš„è½¯ä»¶æ¶æ„DSSA</p><ul><li><p>é¢†åŸŸåˆ†æ</p><ul><li>è·å¾—é¢†åŸŸæ¨¡å‹</li></ul></li><li><p>é¢†åŸŸè®¾è®¡</p><ul><li>è·å¾—DSSA</li></ul></li><li><p>é¢†åŸŸå®ç°</p><ul><li>ä¾æ®é¢†åŸŸæ¨¡å‹å’ŒDSSAå¼€å‘äºç»„ç»‡å¯å¤ç”¨ä¿¡æ¯</li></ul></li></ul></li><li><p>è½¯ä»¶åŠç³»ç»Ÿçš„æ¼”åŒ–</p><ul><li><ol><li>éœ€æ±‚å˜åŠ¨å½’ç±»</li></ol></li><li>2.åˆ¶å®šæ¶æ„æ¼”åŒ–è®¡åˆ’</li><li><ol start="3"><li>ä¿®æ”¹ã€å¢åŠ æˆ–åˆ é™¤æ„ä»¶</li></ol></li><li><ol start="4"><li>æ›´æ–°æ„ä»¶çš„ç›¸äº’ä½œç”¨</li></ol></li><li><ol start="5"><li>æ„ä»¶ç»„è£…ä¸æµ‹è¯•</li></ol></li><li><ol start="6"><li>æŠ€æœ¯è¯„å®¡</li></ol></li><li><ol start="7"><li>äº§ç”Ÿæ¼”åŒ–åçš„æ¶æ„</li></ol></li></ul></li></ul><h3 id="è½¯ä»¶æ¶æ„è§†å›¾">è½¯ä»¶æ¶æ„è§†å›¾</h3><ul><li>è½¯ä»¶è§†å›¾çš„åˆ†ç±»</li><li>æ¨¡å—è§†å›¾ç±»å‹</li><li>C&amp;Sè§†å›¾åŠå…¶é£æ ¼</li><li>åˆ†é…è§†å›¾ç±»åŠå…¶é£æ ¼</li><li>å„è§†å›¾ç±»å‹é—´çš„æ˜ å°„å…³ç³»</li></ul><h2 id="è®¾è®¡æ¨¡å¼23ç§">è®¾è®¡æ¨¡å¼23ç§</h2><h3 id="åˆ›å»ºå‹">åˆ›å»ºå‹</h3><ul><li><p>å·¥å‚æ–¹æ³• Factroy</p><ul><li>åŠ¨æ€ç”Ÿäº§å¯¹è±¡</li></ul></li><li><p>æŠ½è±¡å·¥å‚ Abstract Factory</p><ul><li>ç”Ÿäº§æˆç³»åˆ—å¯¹è±¡</li></ul></li><li><p>æ„å»ºå™¨/ç”Ÿæˆå™¨ Builder</p><ul><li>å¤æ‚å¯¹è±¡æ„é€ </li></ul></li><li><p>åŸå‹æ¨¡å¼ Prototype</p><ul><li>å…‹éš†å¯¹è±¡</li></ul></li><li><p>å•ä¾‹æ¨¡å¼ Singleton</p><ul><li>å•å®ä¾‹</li></ul></li></ul><h3 id="ç»“æ„å‹">ç»“æ„å‹</h3><ul><li><p>é€‚é…å™¨ Adapter</p><ul><li>è½¬æ¢æ¥å£</li></ul></li><li><p>æ¡¥æ¥æ¨¡å¼ Bridge</p><ul><li>å°†æŠ½è±¡éƒ¨åˆ†å’Œå®ƒçš„å®ç°éƒ¨åˆ†åˆ†ç¦»</li></ul></li><li><p>ç»„åˆæ¨¡å¼ Composite</p><ul><li>è¡¨ç¤ºâ€œæ•´ä½“-éƒ¨åˆ†â€çš„å±‚æ¬¡ç»“æ„</li></ul></li><li><p>è£…é¥°å™¨ Decorator</p><ul><li>åŠ¨æ€é™„åŠ èŒè´£</li></ul></li><li><p>å¤–è§‚æ¨¡å¼ Facade</p><ul><li>å¯¹å¤–ç»Ÿä¸€æ¥å£</li></ul></li><li><p>äº«å…ƒæ¨¡å¼ Flyweight</p><ul><li>æä¾›å¤§é‡ç»†ç²’åº¦å¯¹è±¡å…±äº«çš„æ–¹å¼</li></ul></li><li><p>ä»£ç†æ¨¡å¼ Proxy</p><ul><li>å¿«æ·æ–¹å¼</li></ul></li></ul><h3 id="è¡Œä¸ºå‹">è¡Œä¸ºå‹</h3><ul><li><p>è´£ä»»é“¾ Chain of Responsibility</p><ul><li>ä¼ é€’èŒè´£</li></ul></li><li><p>å‘½ä»¤æ¨¡å¼ Command</p><ul><li>è¯·æ±‚å°è£…æˆå¯¹è±¡ï¼Œæ—¥å¿—è®°å½•</li></ul></li><li><p>è§£é‡Šå™¨ Interpreter</p><ul><li>è™šæ‹Ÿæœºæœºåˆ¶ï¼Œæ ¹æ®æ–‡æ³•è¡¨ç¤ºæ¥è§£é‡Šè¯­è¨€ä¸­å¥å­</li></ul></li><li><p>è¿­ä»£å™¨ Iterator</p><ul><li>é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ </li></ul></li><li><p>ä¸­ä»‹è€… Mediator</p><ul><li>ç”¨ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—çš„å¯¹è±¡äº¤äº’</li></ul></li><li><p>å¤‡å¿˜å½•Memento</p><ul><li>åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œæ¸¸æˆå­˜æ¡£</li></ul></li><li><p>è§‚å¯Ÿè€… Observer</p><ul><li>å½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œæ‰€æœ‰ä¾èµ–å®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°</li></ul></li><li><p>çŠ¶æ€æ¨¡å¼ State</p><ul><li>å…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸º</li></ul></li><li><p>ç­–ç•¥æ¨¡å¼ Strategy</p><ul><li>å¤šæ–¹æ¡ˆåˆ‡æ¢</li></ul></li><li><p>æ¨¡æ¿æ–¹æ³• Template</p><ul><li>å­ç±»ä¸æ”¹å˜ç®—æ³•ç»“æ„ï¼Œå³å¯é‡æ–°å®šä¹‰</li></ul></li><li><p>è®¿é—®è€… Visitor</p><ul><li>æ•°æ®ä¸æ“ä½œåˆ†ç¦»ï¼Œä½¿å¾—åœ¨ä¸æ”¹å˜ä¸ªå…ƒç´ çš„ç±»çš„å‰æä¸‹å®šä¹‰ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°æ“ä½œ</li></ul></li></ul><h2 id="æµ‹è¯•è¯„å®¡æ–¹æ³•">æµ‹è¯•è¯„å®¡æ–¹æ³•</h2><h3 id="å®Œå…¨è¯„å®¡">å®Œå…¨è¯„å®¡</h3><ul><li>å¯¹æ•´ä¸ªé¡¹ç›®ä¸­çš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹è¿›è¡Œè¯„å®¡</li></ul><h3 id="æœ‰é€‰æ‹©æ€§çš„è¯„å®¡">æœ‰é€‰æ‹©æ€§çš„è¯„å®¡</h3><ul><li>åªå¯¹éƒ¨åˆ†æµ‹è¯•ç”¨ä¾‹è¿›è¡Œè¯„å®¡</li></ul><h3 id="æŒ‡æ ‡è¯„å®¡æ³•">æŒ‡æ ‡è¯„å®¡æ³•</h3><ul><li>æµ‹è¯•ç”¨ä¾‹çš„è¯„å®¡è¦†ç›–ç‡è¾¾åˆ°å¤šå°‘</li></ul><h2 id="åµŒå…¥å¼ç³»ç»Ÿè®¾è®¡">åµŒå…¥å¼ç³»ç»Ÿè®¾è®¡</h2><h2 id="å¼€å‘ç®¡ç†">å¼€å‘ç®¡ç†</h2><h3 id="é¡¹ç›®ç®¡ç†">é¡¹ç›®ç®¡ç†</h3><ul><li>æ¦‚å¿µé˜¶æ®µ</li><li>å¼€å‘é˜¶æ®µ</li><li>å®æ–½é˜¶æ®µ</li><li>ç»“æŸé˜¶æ®µ</li></ul><h3 id="èŒƒå›´ç®¡ç†">èŒƒå›´ç®¡ç†</h3><ul><li><p>åˆ›å»ºå·¥ä½œåˆ†è§£ç»“æ„(WBS)</p><ul><li>ç®¡ç†å±‚</li><li>æŠ€æœ¯å±‚</li></ul></li></ul><h3 id="æˆæœ¬ç®¡ç†">æˆæœ¬ç®¡ç†</h3><ul><li><p>æˆæœ¬ä¼°ç®—</p><ul><li>è‡ªé¡¶å‘ä¸‹çš„ä¼°ç®—æ³•</li><li>è‡ªåº•å‘ä¸Šçš„ä¼°ç®—æ³•</li><li>å·®åˆ«ä¼°ç®—æ³•</li></ul></li><li><p>æˆæœ¬é¢„ç®—</p></li><li><p>å‡€å€¼åˆ†æ</p></li></ul><h3 id="æ—¶é—´ç®¡ç†">æ—¶é—´ç®¡ç†</h3><ul><li><p>æ´»åŠ¨æ’åº</p></li><li><p>æ´»åŠ¨å†æ—¶ä¼°ç®—</p><ul><li>è½¯ä»¶é¡¹ç›®çš„å·¥ä½œé‡</li><li>å¾·å°”è²æ³•</li><li>ç±»æ¯”ä¼°ç®—æ³•</li><li>åŠŸèƒ½ç‚¹ä¼°ç®—æ³•</li></ul></li><li><p>å…³é”®è·¯å¾„æ³•</p></li><li><p>è®¡åˆ’è¯„å®¡æŠ€æœ¯</p></li><li><p>ç”˜ç‰¹å›¾å’Œæ—¶é—´ç½‘ç»œå›¾</p></li><li><p>è¿›åº¦æ§åˆ¶</p></li></ul><h3 id="é…ç½®ç®¡ç†">é…ç½®ç®¡ç†</h3><h3 id="è´¨é‡ç®¡ç†">è´¨é‡ç®¡ç†</h3><h3 id="é£é™©ç®¡ç†">é£é™©ç®¡ç†</h3><h3 id="è½¯ä»¶è¿è¡Œä¸è¯„ä»·">è½¯ä»¶è¿è¡Œä¸è¯„ä»·</h3><h3 id="è½¯ä»¶è¿‡ç¨‹æ”¹è¿›">è½¯ä»¶è¿‡ç¨‹æ”¹è¿›</h3><ul><li><p>CMM-è½¯ä»¶è¿‡ç¨‹èƒ½åŠ›æˆç†Ÿæ¨¡å‹</p><ul><li><p>åˆå§‹çº§</p><ul><li>è½¯ä»¶å·¥ç¨‹ç®¡ç†åˆ¶åº¦ç¼ºä¹ï¼Œè¿‡ç¨‹ç¼ºä¹å®šä¹‰ã€æ··è®ºæ— åº</li></ul></li><li><p>å¯é‡å¤çº§</p><ul><li>åŸºäºç±»ä¼¼çš„é¡¹ç›®ç»éªŒï¼Œå»ºç«‹äº†åŸºæœ¬çš„é¡¹ç›®ç®¡ç†åˆ¶åº¦ï¼Œé‡‡å–äº†ä¸€å®šçš„èµ„æºæ§åˆ¶æ‰‹æ®µ</li></ul></li><li><p>å·²å®šä¹‰çº§</p><ul><li>è½¯ä»¶è¿‡ç¨‹æ–‡æ¡£åŒ–ã€æ ‡å‡†åŒ–ã€å¯æŒ‰ç…§éœ€æ±‚æ”¹è¿›å¼€å‘è¿‡ç¨‹ï¼Œé‡‡ç”¨è¯„å®¡æ–¹æ³•ä¿è¯è½¯ä»¶è´¨é‡</li></ul></li><li><p>å·²ç®¡ç†çº§</p><ul><li>æ‰€æœ‰è¿‡ç¨‹å»ºç«‹ç›¸åº”çš„åº¦é‡æ–¹å¼å’Œæ˜ç¡®çš„åº¦é‡æŒ‡æ ‡ï¼Œåº¦é‡å¼è¯¦å°½ä¸”å¯ç”¨äºç†è§£å’Œæ§åˆ¶è½¯ä»¶è¿‡ç¨‹çš„</li></ul></li><li><p>ä¼˜åŒ–çº§</p><ul><li>å¯æ ¹æ®æ‰§è¡Œè¿‡ç¨‹çš„åé¦ˆæ¥æ”¹å–„ä¸‹ä¸€æ­¥çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä¼˜åŒ–æ‰§è¡Œæ­¥éª¤ï¼ŒæŒ‡ä»¤å’Œæ•ˆç‡ç¨³æ­¥æå‡å’Œæ”¹è¿›</li></ul></li></ul></li><li><p>CMMI-èƒ½åŠ›æˆç†Ÿæ¨¡å‹é›†æˆ</p></li></ul><h2 id="ä¿¡æ¯ç³»ç»Ÿçš„åŸºç¡€çŸ¥è¯†">ä¿¡æ¯ç³»ç»Ÿçš„åŸºç¡€çŸ¥è¯†</h2><h2 id="åŸºäºä¸­é—´ä»¶çš„å¼€å‘">åŸºäºä¸­é—´ä»¶çš„å¼€å‘</h2><h3 id="ä¸­é—´ä»¶æ˜¯åŸºç¡€è½¯ä»¶çš„ä¸€å¤§ç±»ï¼Œå±äºå¯å¤ç”¨è½¯ä»¶çš„èŒƒç•´ã€‚æ“ä½œç³»ç»Ÿ-ç½‘ç»œ-æ•°æ®-ä¸­é—´ä»¶-åº”ç”¨ç¨‹åº">ä¸­é—´ä»¶æ˜¯åŸºç¡€è½¯ä»¶çš„ä¸€å¤§ç±»ï¼Œå±äºå¯å¤ç”¨è½¯ä»¶çš„èŒƒç•´ã€‚æ“ä½œç³»ç»Ÿ/ç½‘ç»œ/æ•°æ® -&gt; ä¸­é—´ä»¶ -&gt; åº”ç”¨ç¨‹åº</h3><h3 id="RPC-è¿œç¨‹è°ƒç”¨è¿‡ç¨‹">RPC-è¿œç¨‹è°ƒç”¨è¿‡ç¨‹</h3><ul><li>ä½¿åº”ç”¨ç¨‹åºä¸­çš„è¿‡ç¨‹ï¼Œè°ƒç”¨è¿œç¨‹åº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ï¼Œå°±åƒæœ¬åœ°è°ƒç”¨ä¸€æ ·</li></ul><h3 id="MOM-é¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶">MOM-é¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶</h3><ul><li>ä½¿åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡å‘é€å’Œæ¥æ”¶æ¶ˆæ¯æ¥è¿›è¡Œé€šä¿¡å’Œäº¤æ¢æ•°æ®</li></ul><h3 id="ORB-å¯¹è±¡è¯·æ±‚ä»£ç†">ORB-å¯¹è±¡è¯·æ±‚ä»£ç†</h3><ul><li>ä½¿åº”ç”¨ç¨‹åºçš„å¯¹è±¡èƒ½å¤Ÿåœ¨å¼‚ç±»ç½‘ç»œä¹‹é—´åˆ†å¸ƒå’Œå…±äº«</li></ul><h2 id="å®‰å…¨æ€§å’Œä¿å¯†æ€§è®¾è®¡">å®‰å…¨æ€§å’Œä¿å¯†æ€§è®¾è®¡</h2><h3 id="ä¿¡æ¯ç³»ç»Ÿå®‰å…¨ä½“ç³»">ä¿¡æ¯ç³»ç»Ÿå®‰å…¨ä½“ç³»</h3><ul><li><p>å®‰å…¨ç³»ç»Ÿæ¶æ„</p><ul><li><p>å®‰å…¨æœåŠ¡</p><ul><li>è®¤è¯</li><li>è®¿é—®æ§åˆ¶</li><li>æ•°æ®æœºå¯†æ€§</li><li>æ•°æ®å®Œæ•´æ€§</li><li>ä¸å¯å¦è®¤æœåŠ¡</li></ul></li><li><p>ç‰¹å®šçš„å®‰å…¨æœºåˆ¶</p><ul><li>æœºå¯†æœºåˆ¶</li><li>æ•°å­—ç­¾å</li><li>è®¿é—®æ§åˆ¶æœºåˆ¶</li><li>æ•°æ®å®Œæ•´æ€§</li><li>è®¤è¯äº¤æ¢æœºåˆ¶</li><li>æµé‡å¡«å……æœºåˆ¶</li><li>è·¯ç”±æ§åˆ¶æœºåˆ¶</li><li>å…¬è¯æœºåˆ¶</li></ul></li><li><p>æ™®éæ€§çš„å®‰å…¨æœºåˆ¶</p><ul><li>å¯ä¿¡åŠŸèƒ½åº¦</li><li>å®‰å…¨æ ‡è®°</li><li>äº‹ä»¶æ£€æµ‹</li><li>å®‰å…¨å®¡è®¡è·Ÿè¸ª</li><li>å®‰å…¨æ¢å¤</li></ul></li></ul></li><li><p>å®‰å…¨ä¿æŠ¤ç­‰çº§</p><ul><li>ç”¨æˆ·è‡ªä¸»ä¿æŠ¤çº§</li><li>ç³»ç»Ÿå®¡è®¡ä¿æŠ¤çº§</li><li>å®‰å…¨æ ‡è®°ä¿æŠ¤çº§</li><li>ç»“æ„åŒ–ä¿æŠ¤çº§</li><li>è®¿é—®éªŒè¯ä¿æŠ¤çº§</li></ul></li><li><p>ä¿¡æ¯å®‰å…¨ä¿éšœç³»ç»Ÿ</p><ul><li>MIS+Sç³»ç»Ÿ</li><li>S-MISç³»ç»Ÿ</li><li>S2-MISç³»ç»Ÿ</li></ul></li><li><p>å¯ä¿¡è®¡ç®—æœºç³»ç»Ÿ</p><ul><li><p>Dç±»</p><ul><li>æœ€å°ä¿æŠ¤</li></ul></li><li><p>Cç±»</p><ul><li>è‡ªä¸»ä¿æŠ¤ï¼Œè‡ªä¸»è®¿é—®æ§åˆ¶å’Œå®¡è®¡è·Ÿè¸ª</li></ul></li><li><p>Bç±»</p><ul><li>å¼ºåˆ¶å®‰å…¨ä¿æŠ¤</li></ul></li><li><p>Aç±»</p><ul><li>éªŒè¯è®¾è®¡</li></ul></li></ul></li></ul><h3 id="æ•°æ®å®‰å…¨ä¸ä¿å¯†">æ•°æ®å®‰å…¨ä¸ä¿å¯†</h3><ul><li><p>åŠ å¯†ä½“åˆ¶</p><ul><li><p>å¯¹ç§°åŠ å¯†</p><ul><li>FEALã€IDEAã€DES</li></ul></li><li><p>éå¯¹ç§°åŠ å¯†</p><ul><li>RSA</li></ul></li></ul></li><li><p>PKIä¸æ•°å­—ç­¾å</p></li><li><p>æ•°å­—ä¿¡å°</p></li><li><p>PGP</p></li><li><p>æ•°å­—æ°´å°</p></li></ul><h3 id="è®¡ç®—æœºç½‘ç»œå®‰å…¨">è®¡ç®—æœºç½‘ç»œå®‰å…¨</h3><ul><li><p>ç½‘ç»œå®‰å…¨è®¾è®¡</p><ul><li>æœ¨æ¡¶åŸåˆ™</li><li>æ•´ä½“æ€§å®‰å…¨</li><li>å®‰å…¨æ€§è¯„ä»·ä¸å¹³è¡¡åŸåˆ™</li><li>æ ‡å‡†åŒ–ä¸ä¸€è‡´æ€§åŸåˆ™</li><li>æŠ€æœ¯ä¸ç®¡ç†ç›¸ç»“åˆåŸåˆ™</li><li>ç­¹åˆ’è§„åˆ’</li><li>ç­‰çº§æ€§åŸåˆ™</li><li>åŠ¨æ€å‘å±•åŸåˆ™</li><li>æ˜“æ“ä½œæ€§åŸåˆ™</li></ul></li><li><p>å•ç‚¹ç™»å½•æŠ€æœ¯</p></li><li><p>æ— çº¿è®¾å¤‡å®‰å…¨æ€§</p></li><li><p>é˜²ç«å¢™</p><ul><li>ç½‘ç»œçº§é˜²ç«å¢™</li><li>åº”ç”¨çº§é˜²ç«å¢™</li></ul></li><li><p>å…¥ä¾µæ£€æµ‹</p></li><li><p>è™šæ‹Ÿä¸“ç”¨ç½‘(VPN)</p><ul><li>å®‰å…¨éš§é“æŠ€æœ¯</li><li>åŠ è§£å¯†æŠ€æœ¯</li><li>å¯†é’¥ç®¡ç†æŠ€æœ¯</li><li>èº«ä»½è®¤è¯æŠ€æœ¯</li><li>è®¿é—®æ§åˆ¶æŠ€æœ¯</li></ul></li></ul><h3 id="ç”µå­å•†åŠ¡å®‰å…¨">ç”µå­å•†åŠ¡å®‰å…¨</h3><ul><li>SSL-ä¼ è¾“å±‚å®‰å…¨åè®®</li><li>SET-å®‰å…¨ç”µå­äº¤æ˜“åè®®</li></ul><h3 id="å®‰å…¨ç®¡ç†">å®‰å…¨ç®¡ç†</h3><ul><li><p>å®‰å…¨ç­–ç•¥</p></li><li><p>å®‰å…¨ä½“ç³»</p><ul><li>ç—…æ¯’ä¸æœ¨é©¬æ‰«æ</li><li>å®‰å…¨æ‰«æ</li><li>æ—¥å¿—å®¡è®¡ç³»ç»Ÿ</li><li>å®‰å…¨å®¡è®¡</li><li>ä¸ªäººä¿¡æ¯æ§åˆ¶</li><li>å®‰å…¨ç®¡ç†åˆ¶åº¦</li></ul></li></ul><h3 id="è®¡ç®—æœºæ“ä½œå®‰å…¨">è®¡ç®—æœºæ“ä½œå®‰å…¨</h3><h3 id="ç³»ç»Ÿå¤‡ä»½ä¸æ¢å¤">ç³»ç»Ÿå¤‡ä»½ä¸æ¢å¤</h3><ul><li><p>ä¸šåŠ¡æŒç»­è§„åˆ’</p><ul><li>ç¾éš¾æ¢å¤è§„åˆ’</li><li>ä¸šåŠ¡æ¢å¤è§„åˆ’</li><li>å±æœºç®¡ç†è§„åˆ’</li></ul></li></ul><h2 id="ç³»ç»Ÿå¯é æ€§åˆ†æä¸è®¾è®¡">ç³»ç»Ÿå¯é æ€§åˆ†æä¸è®¾è®¡</h2><h3 id="å¯é æ€§å®šä¹‰">å¯é æ€§å®šä¹‰</h3><ul><li>ç³»ç»Ÿåœ¨è§„å®šçš„æ—¶é—´åŠè§„å®šçš„ç¯å¢ƒæ¡ä»¶ä¸‹ï¼Œå®Œæˆè§„å®šåŠŸèƒ½çš„èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯ç³»ç»Ÿæ— æ•…éšœè¿è¡Œçš„æ¦‚ç‡</li></ul><h3 id="å¯é æ€§æŒ‡æ ‡">å¯é æ€§æŒ‡æ ‡</h3><ul><li>å¹³å‡æ— æ•…éšœæ—¶é—´(MTTF)</li><li>å¹³å‡æ•…éšœä¿®å¤æ—¶é—´(MTTR)</li><li>å¹³å‡æ•…éšœé—´éš”æ—¶é—´(MTBF)</li><li>ç³»ç»Ÿå¯ç”¨æ€§</li></ul><h3 id="å¯é æ€§è®¡ç®—">å¯é æ€§è®¡ç®—</h3><ul><li><p>ä¸²è”ç³»ç»Ÿ</p><ul><li>R1xR2XR3</li></ul></li><li><p>å¹¶è”ç³»ç»Ÿ</p><ul><li>1-(1-R1)(1-R2)</li></ul></li></ul><h3 id="å¯é æ€§è®¾è®¡">å¯é æ€§è®¾è®¡</h3><ul><li><p>å†—ä½™è®¾è®¡</p><ul><li><p>ç»“æ„å†—ä½™</p><ul><li><p>é™æ€å†—ä½™</p><ul><li>è¡¨å†³å’Œæ¯”è¾ƒæ¥å±è”½ç³»ç»Ÿä¸­å‡ºç°çš„é”™è¯¯</li></ul></li><li><p>åŠ¨æ€å†—ä½™</p><ul><li>å¤šæ¨¡å—å¾…æœºå‚¨å¤‡ï¼Œæ£€æŸ¥åˆ°å·¥ä½œæ¨¡å—å‡ºé—®é¢˜ï¼Œå°±å¤‡ç”¨æ¨¡å—æ¥é¡¶æ›¿</li></ul></li><li><p>æ··åˆå†—ä½™</p></li></ul></li><li><p>ä¿¡æ¯å†—ä½™</p><ul><li>é™¤æ­£å¸¸åŠŸèƒ½æ‰€éœ€ä¿¡æ¯å¤–ï¼Œæ·»åŠ ä¸€äº›ä¿¡æ¯ä¿è¯ä¿¡æ¯å®Œæ•´æ€§</li></ul></li><li><p>æ—¶é—´å†—ä½™</p><ul><li>é‡å¤æ‰§è¡ŒæŒ‡ä»¤æˆ–ç¨‹åº</li></ul></li></ul></li><li><p>è½¯ä»¶å®¹é”™</p><ul><li><p>æ¢å¤å—æ–¹æ³•</p><ul><li>ä¸€ç§åŠ¨æ€çš„æ•…éšœå±è”½æŠ€æœ¯ï¼Œé‡‡ç”¨åå‘æ¢å¤ç­–ç•¥</li></ul></li><li><p>Nç‰ˆæœ¬ç¨‹åºè®¾è®¡</p><ul><li>ä¸€ç§é™æ€çš„æ•…éšœå±è”½æŠ€æœ¯ï¼Œé‡‡ç”¨å‘å‰æ¢å¤æµ‹ç‡ï¼ˆè¡¨å†³ï¼‰</li></ul></li><li><p>é˜²å«å¼ç¨‹åºè®¾è®¡</p><ul><li>ç¨‹åºä¸­åŒ…å«é”™è¯¯æ£€æŸ¥ä»£ç å’Œé”™è¯¯æ¢å¤ä»£ç </li></ul></li></ul></li><li><p>é›†ç¾¤æŠ€æœ¯</p><ul><li>ä¸¤å°ä»¥ä¸Šçš„èŠ‚ç‚¹æœº(æœåŠ¡å™¨)æ„æˆçš„ä¸€ç§æ¾æ•£è€¦åˆçš„è®¡ç®—èŠ‚ç‚¹é›†åˆ</li></ul></li></ul><h2 id="è½¯ä»¶çŸ¥è¯†äº§æƒä¸æ³•å¾‹æ³•è§„">è½¯ä»¶çŸ¥è¯†äº§æƒä¸æ³•å¾‹æ³•è§„</h2><h3 id="è‘—ä½œæƒæ³•">è‘—ä½œæƒæ³•</h3><h3 id="è®¡ç®—æœºè½¯ä»¶ä¿æŠ¤æ¡ä¾‹">è®¡ç®—æœºè½¯ä»¶ä¿æŠ¤æ¡ä¾‹</h3><h3 id="æ‹›æŠ•æ ‡æ³•">æ‹›æŠ•æ ‡æ³•</h3><h3 id="ä¸“åˆ©æƒ">ä¸“åˆ©æƒ</h3><h3 id="ä¸æ­£å½“ç«äº‰">ä¸æ­£å½“ç«äº‰</h3><h3 id="å•†æ ‡æ³•">å•†æ ‡æ³•</h3><h2 id="æ ‡å‡†åŒ–çŸ¥è¯†">æ ‡å‡†åŒ–çŸ¥è¯†</h2><h3 id="å›½é™…æ ‡å‡†IECã€ISO">å›½é™…æ ‡å‡†IECã€ISO</h3><h3 id="å›½å®¶æ ‡å‡†GB">å›½å®¶æ ‡å‡†GB</h3><h3 id="è¡Œä¸šæ ‡å‡†ï¼ˆNYå†œä¸šï¼ŒJCå»ºæï¼‰">è¡Œä¸šæ ‡å‡†ï¼ˆNYå†œä¸šï¼ŒJCå»ºæï¼‰</h3><h3 id="åœ°æ–¹æ ‡å‡†">åœ°æ–¹æ ‡å‡†</h3><h3 id="ä¼ä¸šæ ‡å‡†-Q">ä¼ä¸šæ ‡å‡† Q</h3><h2 id="åº”ç”¨æ•°å­¦">åº”ç”¨æ•°å­¦</h2><h3 id="å›¾è®º">å›¾è®º</h3><ul><li><p>æœ€å°ç”Ÿæˆæ ‘</p><ul><li>æ™®åˆ©å§†ç®—æ³•</li><li>å…‹é²æ–¯å¡å°”ç®—æ³•</li></ul></li><li><p>æœ€çŸ­è·¯å¾„</p></li><li><p>å…³é”®è·¯å¾„</p></li></ul><h3 id="è¿ç­¹å­¦">è¿ç­¹å­¦</h3><ul><li>çº¿æ€§è§„åˆ’</li><li>å¯¹ç­–è®º(ç«èµ›è®º/åšå¼ˆè®º)</li><li>å†³ç­–è®º</li></ul><h2 id="è™šæ‹ŸåŒ–ã€äº‘è®¡ç®—ã€ç‰©è”ç½‘">è™šæ‹ŸåŒ–ã€äº‘è®¡ç®—ã€ç‰©è”ç½‘</h2>]]></content>
    
    
    <summary type="html">æœ¬æ–‡å°†å›´ç»•è½¯è€ƒæ¶æ„å¸ˆä¸Šåˆé¢˜çš„ç›¸å…³çŸ¥è¯†ç‚¹è¿›è¡Œè®²è§£å’Œç»Ÿè®¡</summary>
    
    
    
    <category term="æ¶æ„å¸ˆ" scheme="https://luoxiaohei520.github.io/categories/%E6%9E%B6%E6%9E%84%E5%B8%88/"/>
    
    
    <category term="æ¶æ„å¸ˆ" scheme="https://luoxiaohei520.github.io/tags/%E6%9E%B6%E6%9E%84%E5%B8%88/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®ç»“æ„ä¸ç®—æ³•</title>
    <link href="https://luoxiaohei520.github.io/posts/4b0178e0.html"/>
    <id>https://luoxiaohei520.github.io/posts/4b0178e0.html</id>
    <published>2023-11-09T02:50:23.343Z</published>
    <updated>2023-11-09T02:50:23.343Z</updated>
    
    <content type="html"><![CDATA[<h1>æ•°æ®ç»“æ„ä¸ç®—æ³•</h1><h2 id="1-çº¿æ€§å­˜å‚¨ä¸éçº¿æ€§å­˜å‚¨">1 çº¿æ€§å­˜å‚¨ä¸éçº¿æ€§å­˜å‚¨</h2><h3 id="1-1-çº¿æ€§ç»“æ„">1.1 çº¿æ€§ç»“æ„</h3><ol><li><strong>çº¿æ€§ç»“æ„</strong>ï¼šç‰¹ç‚¹æ•°æ®å…ƒç´ ç›´æ¥å­˜åœ¨ä¸€å¯¹ä¸€çš„çº¿æ€§å…³ç³»</li><li>çº¿æ€§ç»“æ„æœ‰ä¸¤ç§ä¸åŒçš„å­˜å‚¨ç»“æ„ï¼Œé¡ºåºå­˜å‚¨ï¼ˆæ•°ç»„ï¼‰å’Œé“¾å¼å­˜å‚¨ç»“æ„ï¼ˆé“¾è¡¨ï¼‰ã€‚é¡ºåºå­˜å‚¨çš„çº¿æ€§è¡¨ç§°ä¸ºé¡ºåºè¡¨ï¼Œé¡ºåºè¡¨ä¸­çš„å­˜å‚¨å…ƒç´ æ˜¯è¿ç»­çš„ã€‚</li><li>é“¾å¼å­˜å‚¨çš„çº¿æ€§è¡¨ç§°ä¸ºé“¾è¡¨ï¼Œé“¾è¡¨ä¸­çš„å­˜å‚¨å…ƒç´ ä¸ä¸€å®šæ˜¯è¿ç»­çš„ï¼Œå…ƒç´ èŠ‚ç‚¹ä¸­å­˜æ–¹çš„æ•°æ®å…ƒç´ ä»¥åŠç›¸é‚»å…ƒç´ çš„åœ°å€ä¿¡æ¯ã€‚</li><li>çº¿æ€§ç»“æ„å¸¸è§çš„æœ‰ï¼šæ•°ç»„ï¼Œé˜Ÿåˆ—ï¼Œé“¾è¡¨å’Œæ ˆã€‚</li></ol><h3 id="1-2-éçº¿æ€§ç»“æ„">1.2 éçº¿æ€§ç»“æ„</h3><p>éçº¿æ€§ç»“æ„ï¼šäºŒç»´æ•°ç»„ï¼Œå¤šç»´æ•°ç»„ï¼Œå¹¿ä¹‰è¡¨ï¼Œæ ‘ç»“æ„ï¼Œå›¾ç»“æ„ã€‚</p><h2 id="2-æ•°ç»„">2 æ•°ç»„</h2><h3 id="2-1-ç¨€ç–æ•°ç»„">2.1 ç¨€ç–æ•°ç»„</h3><p>å½“ä¸€ä¸ªæ•°ç»„ä¸­å¤§éƒ¨åˆ†å…ƒç´ ä¸º0çš„æ—¶å€™ï¼Œæˆ–è€…ä¸ºåŒä¸€ä¸ªå€¼çš„æ•°ç»„æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç¨€ç–æ•°ç»„æ¥ä¿å­˜è¯¥æ•°ç»„ã€‚</p><p>ç¨€ç–æ•°ç»„å¤„ç†çš„æ–¹å¼ï¼š</p><ol><li>è®°å½•æ•°ç»„ä¸€å…±æœ‰<strong>å‡ è¡Œå‡ åˆ—ï¼Œæœ‰å¤šå°‘ä¸ªä¸åŒ</strong>çš„å€¼ã€‚</li><li>æŠŠå…·æœ‰ä¸åŒçš„å…ƒç´ çš„è¡Œåˆ—åŠå€¼è®°å½•åœ¨ä¸€ä¸ªå°è§„æ¨¡æ•°ç»„ä¸­ï¼Œä»è€Œç¼©å°ç¨‹åºçš„è§„æ¨¡ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> class ç¨€ç–æ•°ç»„ &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªåŸå§‹çš„äºŒç»´æ•°ç»„</span></span><br><span class="line"><span class="comment">//0 ï¼šè¡¨ç¤ºæ²¡æœ‰æ£‹å­ï¼Œ1è¡¨ç¤ºé»‘å­ï¼Œ2è¡¨ç¤ºç™½å­—</span></span><br><span class="line"><span class="type">int</span> chessArr1[][] = <span class="keyword">new</span> <span class="title class_">int</span> [<span class="number">11</span>][<span class="number">11</span>];</span><br><span class="line">chessArr1[<span class="number">1</span>][<span class="number">2</span>] =<span class="number">1</span>;</span><br><span class="line">chessArr1[<span class="number">2</span>][<span class="number">3</span>] = <span class="number">2</span>;</span><br><span class="line"><span class="comment">//è¾“å‡ºåŸå§‹æ•°ç»„</span></span><br><span class="line">System.out.println(<span class="string">&quot;åŸå§‹çš„äºŒç»´ä¸ºï¼š&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> [] row : chessArr1) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> data: row) &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;%d   &quot;</span>,data);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†äºŒç»´æ•°ç»„è½¬ç¨€ç–æ•°ç»„</span></span><br><span class="line"><span class="comment">// 1å…ˆéå†äºŒç»´æ•°ç»„å¾—åˆ°0æ•°æ®çš„ä¸ªæ•°</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">11</span> ; i++) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">11</span> ; j++) &#123;</span><br><span class="line"><span class="keyword">if</span>(chessArr1[i][j] != <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">sum ++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºå¯¹åº”çš„ç¨€ç–æ•°ç»„</span></span><br><span class="line"><span class="type">int</span> sparseArr[][] = <span class="keyword">new</span> <span class="title class_">int</span> [sum +<span class="number">1</span>][<span class="number">3</span>];</span><br><span class="line"><span class="comment">//ç»™ç¨€ç–æ•°ç»„èµ‹å€¼</span></span><br><span class="line">sparseArr[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">11</span>;</span><br><span class="line">sparseArr[<span class="number">0</span>][<span class="number">1</span>] = <span class="number">11</span>;</span><br><span class="line">sparseArr[<span class="number">0</span>][<span class="number">2</span>] = sum;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">//éå†äºŒç»´æ•°ç»„ï¼Œå°†é0çš„å€¼å­˜æ”¾åˆ°sparseArrä¸­</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">11</span>; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">11</span>; j++) &#123;</span><br><span class="line"><span class="keyword">if</span>(chessArr1[i][j] != <span class="number">0</span>) &#123;</span><br><span class="line">count ++;</span><br><span class="line">sparseArr[count][<span class="number">0</span>] = i; </span><br><span class="line">sparseArr[count][<span class="number">1</span>] = j;</span><br><span class="line">sparseArr[count][<span class="number">2</span>] = chessArr1[i][j];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¾“å‡ºç¨€ç–æ•°ç»„çš„å½¢å¼</span></span><br><span class="line">System.out.println();</span><br><span class="line">System.out.println(<span class="string">&quot;å¾—åˆ°çš„ç¨€ç–æ•°ç»„&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; sparseArr.length ; i++) &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;%d\t%d\t%d\t\n&quot;</span>,sparseArr[i][<span class="number">0</span>],sparseArr[i][<span class="number">1</span>],sparseArr[i][<span class="number">2</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†ç¨€ç–æ•°ç»„å›å¤ä¸ºåŸæ¥çš„æ•°ç»„</span></span><br><span class="line"><span class="comment">//ç¬¬ä¸€æ­¥ï¼Œå…ˆè¯»å–ç¨€ç–æ•°ç»„çš„ç¬¬ä¸€è¡Œï¼Œæ ¹æ®ç¬¬ä¸€è¡Œçš„æ•°æ®åˆ›å»ºåŸå§‹çš„äºŒç»´æ•°ç»„</span></span><br><span class="line"><span class="type">int</span> chessArr2[][] = <span class="keyword">new</span> <span class="title class_">int</span> [sparseArr[<span class="number">0</span>][<span class="number">0</span>]][sparseArr[<span class="number">0</span>][<span class="number">1</span>]];</span><br><span class="line"><span class="comment">//ç¬¬äºŒéƒ¨ï¼Œåœ¨ç¨€ç–æ•°ç»„åçš„å‡ è¡Œçš„æ•°æ®ä»ç¬¬äºŒè¡Œå¼€å§‹ï¼Œå¹¶èµ‹å€¼ç»™åŸå§‹çš„äºŒç»´æ•°ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">1</span>; i &lt; sparseArr.length; i++) &#123;</span><br><span class="line"> chessArr2[sparseArr[i][<span class="number">0</span>]][sparseArr[i][<span class="number">1</span>]] = sparseArr[i][<span class="number">2</span>];</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¾“å‡ºæ¢å¤åçš„äºŒç»´æ•°ç»„</span></span><br><span class="line">System.out.println();</span><br><span class="line">System.out.println(<span class="string">&quot;æ¢å¤åçš„äºŒç»´æ•°ç»„&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> [] row : chessArr2) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> data: row) &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;%d   &quot;</span>,data);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-é˜Ÿåˆ—">3 é˜Ÿåˆ—</h2><h3 id="3-1-é˜Ÿåˆ—">3.1 é˜Ÿåˆ—</h3><ol><li><p>é˜Ÿåˆ—æ˜¯ä¸€æœ‰åºåˆ—è¡¨ï¼Œå¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–è€…æ˜¯é“¾è¡¨æ¥å®ç°.</p></li><li><p>éµå¾ªå…ˆå…¥å…ˆä»çš„åŸåˆ™ã€‚</p><p>==ä¸€èˆ¬æˆ‘ä»¬é‡‡ç”¨rear æŒ‡é’ˆå’ŒfrontæŒ‡é’ˆè¿›è¡Œæ“ä½œã€‚==</p></li></ol><h3 id="3-2é˜Ÿåˆ—çš„æ¨¡æ‹Ÿ">3.2é˜Ÿåˆ—çš„æ¨¡æ‹Ÿ</h3><p>é˜Ÿåˆ—æ˜¯æœ‰åºåˆ—è¡¨ï¼Œä½¿ç”¨æ•°ç»„ç»“æ„æ¥å­˜å‚¨é˜Ÿåˆ—çš„æ•°æ®ã€‚</p><p>é˜Ÿåˆ—çš„å…¥é˜Ÿä¸€èˆ¬ä½¿ç”¨addQueue,addQueueçš„å¤„ç†éœ€è¦ä¸¤ä¸ªæ­¥éª¤ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayQueueDemo</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">ArrayQueue  aq=<span class="keyword">new</span> <span class="title class_">ArrayQueue</span>(<span class="number">3</span>);</span><br><span class="line"><span class="type">char</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&#x27; &#x27;</span>;<span class="comment">//ç”¨äºæ¥æ”¶ç”¨æˆ·æ•°æ®</span></span><br><span class="line"><span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"><span class="type">boolean</span> <span class="variable">loop</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"><span class="comment">//è¾“å‡ºä¸€ä¸ªèœå•</span></span><br><span class="line"><span class="keyword">while</span>(loop) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;s(show):æ˜¾ç¤ºé˜Ÿåˆ—&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;e(exit):é€€å‡ºé˜Ÿåˆ—&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;a(add):æ·»åŠ æ•°æ®åˆ°é˜Ÿåˆ—&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;g(get):ä»é˜Ÿåˆ—å–å‡ºæ•°æ®&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;h(head):æŸ¥çœ‹é˜Ÿåˆ—å¤´çš„æ•°æ®&quot;</span>);</span><br><span class="line">key = sc.next().charAt(<span class="number">0</span>);<span class="comment">//æ¥å»ç¬¬ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="keyword">switch</span>(key) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:  <span class="comment">//å±•ç¤ºé˜Ÿåˆ—æ•°æ®</span></span><br><span class="line">aq.showQueue();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;a&#x27;</span>: <span class="comment">//å‘é˜Ÿåˆ—æ·»åŠ æ•°æ®</span></span><br><span class="line">System.out.println(<span class="string">&quot;è¯·è¾“å…¥ä¸€ä¸ªæ•°&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> sc.nextInt();</span><br><span class="line">aq.addQueue(value);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;g&#x27;</span>: <span class="comment">//è·å¾—é˜Ÿåˆ—çš„æ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> aq.getQueue();</span><br><span class="line">System.out.printf(<span class="string">&quot;å–å‡ºçš„æ•°æ®å®%d\n&quot;</span>,res);</span><br><span class="line">aq.getQueue();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">System.out.println(e.getMessage());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;h&#x27;</span>: <span class="comment">//æŸ¥çœ‹é˜Ÿåˆ—å¤´çš„æ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> aq.headQueue();</span><br><span class="line">System.out.printf(<span class="string">&quot;å–å‡ºçš„æ•°æ®å®%d\n&quot;</span>,res);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">System.out.println(e.getMessage());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;e&#x27;</span>: <span class="comment">//ä»£è¡¨è¦é€€å‡º</span></span><br><span class="line">sc.close();</span><br><span class="line">loop = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;ç¨‹åºé€€å‡º&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨æ•°ç»„æ¨¡æ‹Ÿé˜Ÿåˆ—ï¼Œç¼–å†™ä¸€ä¸ªArrayQueueç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ArrayQueue</span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> maxSize;<span class="comment">//è®¾ç½®æ•°ç»„çš„æœ€å¤§å®¹é‡</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> front;<span class="comment">//é˜Ÿåˆ—å¤´</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> rear;<span class="comment">//é˜Ÿåˆ—å°¾éƒ¨</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> [] arr;<span class="comment">//è¯¥æ•°æ®ç”¨äºå­˜æ”¾æ•°æ®ï¼Œæ¨¡æ‹Ÿé˜Ÿåˆ—</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºé˜Ÿåˆ—çš„æ„é€ å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayQueue</span><span class="params">(<span class="type">int</span> arrMaxSize)</span> &#123;</span><br><span class="line">maxSize = arrMaxSize;</span><br><span class="line">arr = <span class="keyword">new</span> <span class="title class_">int</span> [maxSize];</span><br><span class="line">front  = -<span class="number">1</span>;  <span class="comment">//æŒ‡å‘é˜Ÿåˆ—å¤´éƒ¨ï¼ŒæŒ‡å‘é˜Ÿåˆ—å¤´çš„å‰ä¸€ä¸ªä½ç½®</span></span><br><span class="line">rear = -<span class="number">1</span>; <span class="comment">//æŒ‡å‘é˜Ÿåˆ—å°¾éƒ¨ï¼Œé˜Ÿåˆ—å°¾éƒ¨åŒ…å«å¯¹è±¡æœ€åä¸€ä¸ªæ•°æ®ï¼Œé€šä¿—çš„è®²å°±æ˜¯é˜Ÿåˆ—æœ€åä¸€ä¸ªä½ç½®</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦æ»¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> rear == maxSize - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isNull</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> rear == front;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ•°æ®æ˜¯å¦æ·»åŠ åˆ°é˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addQueue</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="comment">//åˆ¤è¯»é˜Ÿåˆ—æ˜¯å¦æ»¡</span></span><br><span class="line"><span class="keyword">if</span>(isFull()) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;é˜Ÿåˆ—æ»¡ï¼Œä¸èƒ½åŠ å…¥æ•°æ®&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">rear ++ ; <span class="comment">//è®©rear åç§»åŠ¨</span></span><br><span class="line">arr[rear] = n;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ¤è¯»é˜Ÿåˆ—çš„æ•°æ®ï¼Œå‡ºé˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getQueue</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//åˆ¤è¯»é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="keyword">if</span>(isNull()) &#123;</span><br><span class="line"><span class="comment">//æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;é˜Ÿåˆ—ä¸ºç©ºï¼Œä¸èƒ½è·å–æ•°æ®&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">front ++;</span><br><span class="line"><span class="keyword">return</span> arr[front];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ˜¾ç¤ºé˜Ÿåˆ—æ‰€æœ‰æ•°æ®</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showQueue</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//å°†æ•°ç»„æ•°æ®éå†</span></span><br><span class="line"><span class="keyword">if</span>(isNull()) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;é˜Ÿåˆ—ä¸ºç©ºï¼Œæ²¡æœ‰æ•°æ®&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++ ) &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;arr[%d]=%d\n&quot;</span>,i,arr[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ˜¾ç¤ºé˜Ÿåˆ—çš„å¤´æ•°æ®ï¼Œæ³¨æ„ä¸æ˜¯å–å‡ºæ•°æ®</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">headQueue</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//åˆ¤æ–­</span></span><br><span class="line"><span class="keyword">if</span>(isNull()) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;é˜Ÿåˆ—ç©ºï¼Œæ²¡æœ‰æ•°æ®&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> arr[front + <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤å¤„å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œæ— æ³•å¯¹é˜Ÿåˆ—è¿›è¡Œå¤šæ¬¡ä½¿ç”¨ã€‚</p><p>å°†è¿™ä¸ªæ•°ç»„ä½¿ç”¨ç®—æ³•æ”¹å˜æˆä¸ºä¸€ä¸ªç¯å½¢é˜Ÿåˆ— æ–¹å¼ï¼Œé‡‡ç”¨å–æ¨¡çš„æ–¹å¼ã€‚</p><h3 id="3-3-åˆ¤æ–­é˜Ÿåˆ—ä¸ºç©ºé˜Ÿåˆ—ä¸ºæ»¡">3.3 åˆ¤æ–­é˜Ÿåˆ—ä¸ºç©ºé˜Ÿåˆ—ä¸ºæ»¡</h3><p>==front == rear ä»£è¡¨é˜Ÿåˆ—ä¸ºç©ºã€‚==</p><p>å½“æŒ‡é’ˆrear å°äºé˜Ÿåˆ—çš„æœ€å¤§ä¸‹æ ‡maxSize - 1,åˆ™å°†æ•°æ®å­˜å…¥rearé”æŒ‡å‘çš„æ•°ç»„å…ƒç´ ä¸­ï¼Œå¦åˆ™æ— æ³•å­˜å…¥æ•°æ®</p><p>==rear == maxSize -1 ä»£è¡¨é˜Ÿåˆ—å·²æ»¡==</p><h3 id="3-4-ä½¿ç”¨æ•°ç»„æ¨¡æ‹Ÿç¯å½¢é˜Ÿåˆ—">3.4 ä½¿ç”¨æ•°ç»„æ¨¡æ‹Ÿç¯å½¢é˜Ÿåˆ—</h3><p>æ€è·¯ï¼š</p><ol><li><p>front å˜é‡çš„å«ä¹‰åšä¸€ä¸ªè°ƒæ•´ï¼šfrontå°±æŒ‡å‘é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯è¯´arr[front]å°±æ˜¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</p><p>frontçš„åˆå§‹å€¼ä¸º0ï¼›</p></li><li><p>rearå˜é‡çš„å«ä¹‰åšä¸€ä¸ªè°ƒæ•´ï¼šrearæŒ‡å‘é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ çš„åä¸€ä¸ªä½ç½®ï¼Œå› ä¸ºå¸Œæœ›ç©ºå‡ºä¸€ä¸ªç©ºé—´ä½œä¸ºçº¦å®šã€‚rear çš„åˆå§‹å€¼ä¸º0ï¼›</p></li><li><p>å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œæ¡ä»¶æ˜¯<code>(rear + 1)%maxSize == front</code> æ­¤æ—¶æ»¡ã€‚</p></li><li><p>å½“é˜Ÿåˆ—ä¸ºç©ºçš„æ¡ä»¶ï¼Œrear == front ç©º</p></li><li><p>å½“è¿™æ ·åˆ†æåï¼Œæ­¤æ—¶é˜Ÿåˆ—ä¸­æœ‰æ•ˆçš„æ•°æ®çš„ä¸ªæ•°æ˜¯ <code>(rear + maxSize - front)%maxSize //rear=1 front=0</code></p></li><li><p>ä»¥ä¸Šæˆ‘ä»¬å°±å¯ä»¥æŒ‰ç…§æˆ‘ä»¬çš„æ€è·¯å¯¹åŸæ¥çš„ä»£ç è¿›è¡Œä¿®æ”¹ã€‚</p></li></ol><h2 id="4-é“¾è¡¨">4. é“¾è¡¨</h2><p>é“¾è¡¨æ˜¯æœ‰åºçš„åˆ—è¡¨ï¼š</p><ol><li>é“¾è¡¨æ˜¯ä»¥<strong>èŠ‚ç‚¹</strong>çš„æ–¹å¼æ¥å­˜å‚¨çš„ï¼Œæ˜¯ä¸€<strong>ç§é“¾å¼å­˜å‚¨çš„</strong>æ–¹æ³•å­˜å‚¨ã€‚</li><li>æ¯ä¸ªèŠ‚ç‚¹åŒ…<strong>å«dataåŸŸï¼ŒnextåŸŸ</strong>ï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li><li>é“¾è¡¨çš„<strong>å„ä¸ªèŠ‚ç‚¹ä¸ä¸€å®šæ˜¯è¿ç»­å­˜å‚¨</strong></li><li>é“¾è¡¨åˆ†<strong>å¸¦å¤´èŠ‚ç‚¹çš„é“¾è¡¨å’Œä¸å¸¦å¤´ç»“ç‚¹</strong>çš„é“¾è¡¨ï¼Œæ ¹æ®å®é™…çš„éœ€æ±‚æ¥ç¡®å®šã€‚</li></ol><h3 id="4-1-å•å‘é“¾è¡¨">4.1 å•å‘é“¾è¡¨</h3><p>head èŠ‚ç‚¹</p><h5 id="å•å‘é“¾è¡¨çš„å®ç°">å•å‘é“¾è¡¨çš„å®ç°</h5><ol><li>ä¸å­˜æ”¾å…·ä½“çš„æ•°æ®</li><li>ä½œç”¨å°±æ˜¯è¡¨ç¤ºå•é“¾è¡¨å¤´next</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingleLinkedListDemo</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//æµ‹è¯•</span></span><br><span class="line"><span class="comment">//åˆ›å»ºèŠ‚ç‚¹</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">1</span>,<span class="string">&quot;æ¾æ±Ÿ&quot;</span>,<span class="string">&quot;åŠæ—¶é›¨&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">2</span>,<span class="string">&quot;å¢ä¿Šä¹‰&quot;</span>,<span class="string">&quot;ç‰éº’éºŸ&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">3</span>,<span class="string">&quot;å´ç”¨&quot;</span>,<span class="string">&quot;æ™ºå¤šæ˜Ÿ&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">4</span>,<span class="string">&quot;æ—å†²&quot;</span>,<span class="string">&quot;è±¹å­å¤´&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºé“¾è¡¨</span></span><br><span class="line"><span class="type">SingleLinkedList</span> <span class="variable">singleLinkedList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleLinkedList</span>();</span><br><span class="line">singleLinkedList.add(hero1);</span><br><span class="line">singleLinkedList.add(hero2);</span><br><span class="line">singleLinkedList.add(hero3);</span><br><span class="line">singleLinkedList.add(hero4);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ˜¾ç¤ºé“¾è¡¨</span></span><br><span class="line">singleLinkedList.list();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªSingleLinkedListæ¥ç®¡ç†æˆ‘ä»¬çš„è‹±é›„</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingleLinkedList</span>&#123;</span><br><span class="line"><span class="comment">//å…ˆåˆå§‹åŒ–ä¸€ä¸ªå¤´ç»“ç‚¹ï¼Œä¸€èˆ¬ä¸Šå¤´ç»“ç‚¹ä¸è¦åŠ¨</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">HeroNode</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">0</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ·»åŠ èŠ‚ç‚¹åˆ°å•å‘é“¾è¡¨</span></span><br><span class="line"><span class="comment">//æ€è·¯ï¼Œå½“ä¸è€ƒè™‘ç¼–å·é¡ºåºæ—¶</span></span><br><span class="line"><span class="comment">//1 æ‰¾åˆ°å½“å‰é“¾è¡¨çš„æœ€åèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">//2,å°†æœ€åè¿™ä¸ªèŠ‚ç‚¹çš„nexæŒ‡å‘æ–°èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(HeroNode heroNode)</span> &#123;</span><br><span class="line"><span class="comment">//å› ä¸ºheadèŠ‚ç‚¹ä¸èƒ½åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¾…åŠ©éå†temo</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="comment">//éå†é“¾è¡¨ï¼Œæ‰¾åˆ°æœ€å</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//æ‰¾åˆ°é“¾è¡¨çš„æœ€å</span></span><br><span class="line"><span class="keyword">if</span>(temp.next == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¦‚æœæ²¡æœ‰æ‰¾åˆ°æœ€åï¼Œå°†tempåç§»</span></span><br><span class="line">temp = temp.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å½“é€€å‡ºwhileå¾ªç¯åï¼Œtempå°±æŒ‡å‘é“¾è¡¨çš„æœ€å</span></span><br><span class="line"><span class="comment">//å°†æœ€åè¿™ä¸ªèŠ‚ç‚¹çš„nextæŒ‡å‘æ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">temp.next = heroNode;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ˜¾ç¤ºé“¾è¡¨ã€éå†ã€‘</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//åˆ¤è¯»æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;é“¾è¡¨ä¸ºç©º&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å› ä¸ºå¤´ç»“ç‚¹ï¼Œä¸èƒ½åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¾…åŠ©å˜é‡æ¥éå†</span></span><br><span class="line"><span class="type">HeroNode</span>  <span class="variable">temp</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦æ˜¯å¦é“¾è¡¨æœ€å</span></span><br><span class="line"><span class="keyword">if</span>(temp == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¾“å‡ºèŠ‚ç‚¹çš„ä¿¡æ¯</span></span><br><span class="line">System.out.println(temp);</span><br><span class="line"><span class="comment">//å°†nextåç§»,å¦‚æœä¸åç§»å°†è¿›å…¥æ­»å¾ªç¯</span></span><br><span class="line">temp = temp.next ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªheroNode ,æ¯ä¸ªHeroNodeå¯¹è±¡å°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeroNode</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> no;</span><br><span class="line"><span class="keyword">public</span> String name;</span><br><span class="line"><span class="keyword">public</span> String nickName;</span><br><span class="line"><span class="keyword">public</span> HeroNode next;<span class="comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ„é€ å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode</span><span class="params">(<span class="type">int</span> no, String name, String nickName)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line"><span class="built_in">this</span>.no = no;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line"><span class="built_in">this</span>.nickName = nickName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;HeroNode [no=&quot;</span> + no + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;, nickName=&quot;</span> + nickName + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›®å‰ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ç›¸å…³èŠ‚ç‚¹çš„è¿›è¡Œæœ‰åºæ·»åŠ ã€‚</p><h5 id="æœ‰åºæ·»åŠ ">æœ‰åºæ·»åŠ </h5><p>éœ€è¦æŒ‰ç…§ç¼–å·çš„é¡ºåºæ·»åŠ ï¼š</p><ol><li>é¦–å…ˆæ‰¾åˆ°æ–°å¤©èŠ‚ç‚¹çš„èŠ‚ç‚¹çš„ä½ç½®ï¼Œæ˜¯é€šè¿‡è¾…åŠ©å˜é‡(æŒ‡é’ˆ)ï¼Œé€šè¿‡éå†æ¥æå®š</li><li>æ–°çš„èŠ‚ç‚¹ <code>next=temp.next</code></li><li>å°†<code>temp.next=æ–°èŠ‚ç‚¹</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingleLinkedListDemo</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//æµ‹è¯•</span></span><br><span class="line"><span class="comment">//åˆ›å»ºèŠ‚ç‚¹</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">1</span>,<span class="string">&quot;æ¾æ±Ÿ&quot;</span>,<span class="string">&quot;åŠæ—¶é›¨&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">2</span>,<span class="string">&quot;å¢ä¿Šä¹‰&quot;</span>,<span class="string">&quot;ç‰éº’éºŸ&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">3</span>,<span class="string">&quot;å´ç”¨&quot;</span>,<span class="string">&quot;æ™ºå¤šæ˜Ÿ&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">4</span>,<span class="string">&quot;æ—å†²&quot;</span>,<span class="string">&quot;è±¹å­å¤´&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºé“¾è¡¨</span></span><br><span class="line"><span class="type">SingleLinkedList</span> <span class="variable">singleLinkedList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleLinkedList</span>();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero1);</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero2);</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero3);</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero4);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">singleLinkedList.addByOrder(hero3);</span><br><span class="line">singleLinkedList.addByOrder(hero1);</span><br><span class="line">singleLinkedList.addByOrder(hero4);</span><br><span class="line">singleLinkedList.addByOrder(hero2);</span><br><span class="line">singleLinkedList.addByOrder(hero2);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ˜¾ç¤ºé“¾è¡¨</span></span><br><span class="line">singleLinkedList.list();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªSingleLinkedListæ¥ç®¡ç†æˆ‘ä»¬çš„è‹±é›„</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingleLinkedList</span>&#123;</span><br><span class="line"><span class="comment">//å…ˆåˆå§‹åŒ–ä¸€ä¸ªå¤´ç»“ç‚¹ï¼Œä¸€èˆ¬ä¸Šå¤´ç»“ç‚¹ä¸è¦åŠ¨</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">HeroNode</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">0</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ·»åŠ èŠ‚ç‚¹åˆ°å•å‘é“¾è¡¨</span></span><br><span class="line"><span class="comment">//æ€è·¯ï¼Œå½“ä¸è€ƒè™‘ç¼–å·é¡ºåºæ—¶</span></span><br><span class="line"><span class="comment">//1 æ‰¾åˆ°å½“å‰é“¾è¡¨çš„æœ€åèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">//2,å°†æœ€åè¿™ä¸ªèŠ‚ç‚¹çš„nexæŒ‡å‘æ–°èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(HeroNode heroNode)</span> &#123;</span><br><span class="line"><span class="comment">//å› ä¸ºheadèŠ‚ç‚¹ä¸èƒ½åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¾…åŠ©éå†temo</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="comment">//éå†é“¾è¡¨ï¼Œæ‰¾åˆ°æœ€å</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//æ‰¾åˆ°é“¾è¡¨çš„æœ€å</span></span><br><span class="line"><span class="keyword">if</span>(temp.next == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¦‚æœæ²¡æœ‰æ‰¾åˆ°æœ€åï¼Œå°†tempåç§»</span></span><br><span class="line">temp = temp.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å½“é€€å‡ºwhileå¾ªç¯åï¼Œtempå°±æŒ‡å‘é“¾è¡¨çš„æœ€å</span></span><br><span class="line"><span class="comment">//å°†æœ€åè¿™ä¸ªèŠ‚ç‚¹çš„nextæŒ‡å‘æ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">temp.next = heroNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬äºŒç§æ–¹å¼æ·»åŠ è‹±é›„æ—¶ï¼Œæ ¹æ®æ’åå°†è‹±é›„æ’å…¥åˆ°æŒ‡å®šä½ç½®</span></span><br><span class="line"><span class="comment">//å¦‚æœæœ‰è¿™ä¸ªæ’åï¼Œåˆ™æ·»åŠ å¤±è´¥ï¼Œå¹¶ç»™å‡ºæç¤º</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addByOrder</span><span class="params">(HeroNode heroNode)</span> &#123;</span><br><span class="line"><span class="comment">//å› ä¸ºå¤´ç»“ç‚¹ä¸èƒ½åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬ä»ç„¶é€šè¿‡ä¸€ä¸ªè¾…åŠ©æŒ‡é’ˆï¼ˆå˜é‡ï¼‰æ¥å¸®åŠ©æ‰¾åˆ°æ·»åŠ çš„ä½ç½®</span></span><br><span class="line"><span class="comment">//å› ä¸ºå•é“¾è¡¨ï¼Œå› ä¸ºæˆ‘ä»¬æ‰¾çš„tempæ˜¯ä½äºæ·»åŠ ä½ç½®çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦åˆ™æ’å…¥ä¸äº†</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;  <span class="comment">//falseæ ‡è®°æ·»åŠ çš„ç¼–å·æ˜¯å¦å­˜åœ¨ï¼Œé»˜è®¤ä¸ºfalse</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(temp.next == <span class="literal">null</span>) &#123; <span class="comment">//è¯´æ˜æ­¤æ—¶tempå¤„äºé“¾è¡¨çš„æœ€å</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(temp.next.no &gt; heroNode.no) &#123;</span><br><span class="line"><span class="comment">//æ­¤æ—¶ä½ç½®æ‰¾åˆ°ï¼Œå°±åœ¨tempçš„åè¾¹æ’å…¥</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(temp.next.no == heroNode.no) </span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//è¯´æ˜å¸Œæœ›æ·»åŠ çš„heroNodeçš„ç¼–å·å·²ç„¶å­˜åœ¨</span></span><br><span class="line">flag = <span class="literal">true</span>;  <span class="comment">//è¯´æ˜ç¼–å·å­˜åœ¨</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">temp = temp.next;  <span class="comment">//åç§»ï¼Œå˜é‡å½“å‰é“¾è¡¨</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ¤æ–­flagçš„å€¼</span></span><br><span class="line"><span class="keyword">if</span>(flag) &#123;<span class="comment">//ä¸èƒ½æ·»åŠ ï¼Œè¯´æ˜ç¼–å·å­˜åœ¨</span></span><br><span class="line">System.out.printf(<span class="string">&quot;å‡†å¤‡æ’å…¥çš„è‹±é›„çš„ç¼–å·%dï¼Œå·²ç»å­˜åœ¨,æ— æ³•æ·»åŠ \n&quot;</span>,heroNode.no);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//æ’å…¥åˆ°é“¾è¡¨ä¸­ï¼Œtempåè¾¹</span></span><br><span class="line">heroNode.next = temp.next;</span><br><span class="line">temp.next = heroNode;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ˜¾ç¤ºé“¾è¡¨ã€éå†ã€‘</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//åˆ¤è¯»æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;é“¾è¡¨ä¸ºç©º&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å› ä¸ºå¤´ç»“ç‚¹ï¼Œä¸èƒ½åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¾…åŠ©å˜é‡æ¥éå†</span></span><br><span class="line"><span class="type">HeroNode</span>  <span class="variable">temp</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦æ˜¯å¦é“¾è¡¨æœ€å</span></span><br><span class="line"><span class="keyword">if</span>(temp == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¾“å‡ºèŠ‚ç‚¹çš„ä¿¡æ¯</span></span><br><span class="line">System.out.println(temp);</span><br><span class="line"><span class="comment">//å°†nextåç§»,å¦‚æœä¸åç§»å°†è¿›å…¥æ­»å¾ªç¯</span></span><br><span class="line">temp = temp.next ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªheroNode ,æ¯ä¸ªHeroNodeå¯¹è±¡å°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeroNode</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> no;</span><br><span class="line"><span class="keyword">public</span> String name;</span><br><span class="line"><span class="keyword">public</span> String nickName;</span><br><span class="line"><span class="keyword">public</span> HeroNode next;<span class="comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ„é€ å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode</span><span class="params">(<span class="type">int</span> no, String name, String nickName)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line"><span class="built_in">this</span>.no = no;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line"><span class="built_in">this</span>.nickName = nickName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;HeroNode [no=&quot;</span> + no + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;, nickName=&quot;</span> + nickName + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ä¿®æ”¹é“¾è¡¨ä¸­çš„å‚æ•°">ä¿®æ”¹é“¾è¡¨ä¸­çš„å‚æ•°</h5><ol><li>å…ˆæ‰¾åˆ°è¯¥èŠ‚ç‚¹ï¼Œé€šè¿‡éå†ã€‚</li><li><code>temp.name = newHeroNode.name;temp.nickName=newHeroNode.nickName;</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingleLinkedListDemo</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//æµ‹è¯•</span></span><br><span class="line"><span class="comment">//åˆ›å»ºèŠ‚ç‚¹</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">1</span>,<span class="string">&quot;æ¾æ±Ÿ&quot;</span>,<span class="string">&quot;åŠæ—¶é›¨&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">2</span>,<span class="string">&quot;å¢ä¿Šä¹‰&quot;</span>,<span class="string">&quot;ç‰éº’éºŸ&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">3</span>,<span class="string">&quot;å´ç”¨&quot;</span>,<span class="string">&quot;æ™ºå¤šæ˜Ÿ&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">4</span>,<span class="string">&quot;æ—å†²&quot;</span>,<span class="string">&quot;è±¹å­å¤´&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºé“¾è¡¨</span></span><br><span class="line"><span class="type">SingleLinkedList</span> <span class="variable">singleLinkedList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleLinkedList</span>();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero1);</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero2);</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero3);</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero4);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">singleLinkedList.addByOrder(hero3);</span><br><span class="line">singleLinkedList.addByOrder(hero1);</span><br><span class="line">singleLinkedList.addByOrder(hero4);</span><br><span class="line">singleLinkedList.addByOrder(hero2);</span><br><span class="line">singleLinkedList.addByOrder(hero2);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;ä¿®æ”¹ä¹‹å‰çš„&quot;</span>);</span><br><span class="line">singleLinkedList.list();</span><br><span class="line"></span><br><span class="line"><span class="comment">//æµ‹è¯•ä¿®æ”¹èŠ‚ç‚¹çš„ä»£ç </span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">newHeroNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">2</span>,<span class="string">&quot;å°å¢&quot;</span>,<span class="string">&quot;ç‰éº’éºŸÂ·Â·Â·&quot;</span>);</span><br><span class="line">singleLinkedList.update(newHeroNode);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;ä¿®æ”¹ä¹‹åçš„çš„é“¾è¡¨æƒ…å†µ&quot;</span>);</span><br><span class="line"><span class="comment">//æ˜¾ç¤ºé“¾è¡¨</span></span><br><span class="line">singleLinkedList.list();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªSingleLinkedListæ¥ç®¡ç†æˆ‘ä»¬çš„è‹±é›„</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingleLinkedList</span>&#123;</span><br><span class="line"><span class="comment">//å…ˆåˆå§‹åŒ–ä¸€ä¸ªå¤´ç»“ç‚¹ï¼Œä¸€èˆ¬ä¸Šå¤´ç»“ç‚¹ä¸è¦åŠ¨</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">HeroNode</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">0</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ·»åŠ èŠ‚ç‚¹åˆ°å•å‘é“¾è¡¨</span></span><br><span class="line"><span class="comment">//æ€è·¯ï¼Œå½“ä¸è€ƒè™‘ç¼–å·é¡ºåºæ—¶</span></span><br><span class="line"><span class="comment">//1 æ‰¾åˆ°å½“å‰é“¾è¡¨çš„æœ€åèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">//2,å°†æœ€åè¿™ä¸ªèŠ‚ç‚¹çš„nexæŒ‡å‘æ–°èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(HeroNode heroNode)</span> &#123;</span><br><span class="line"><span class="comment">//å› ä¸ºheadèŠ‚ç‚¹ä¸èƒ½åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¾…åŠ©éå†temo</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="comment">//éå†é“¾è¡¨ï¼Œæ‰¾åˆ°æœ€å</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//æ‰¾åˆ°é“¾è¡¨çš„æœ€å</span></span><br><span class="line"><span class="keyword">if</span>(temp.next == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¦‚æœæ²¡æœ‰æ‰¾åˆ°æœ€åï¼Œå°†tempåç§»</span></span><br><span class="line">temp = temp.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å½“é€€å‡ºwhileå¾ªç¯åï¼Œtempå°±æŒ‡å‘é“¾è¡¨çš„æœ€å</span></span><br><span class="line"><span class="comment">//å°†æœ€åè¿™ä¸ªèŠ‚ç‚¹çš„nextæŒ‡å‘æ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">temp.next = heroNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬äºŒç§æ–¹å¼æ·»åŠ è‹±é›„æ—¶ï¼Œæ ¹æ®æ’åå°†è‹±é›„æ’å…¥åˆ°æŒ‡å®šä½ç½®</span></span><br><span class="line"><span class="comment">//å¦‚æœæœ‰è¿™ä¸ªæ’åï¼Œåˆ™æ·»åŠ å¤±è´¥ï¼Œå¹¶ç»™å‡ºæç¤º</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addByOrder</span><span class="params">(HeroNode heroNode)</span> &#123;</span><br><span class="line"><span class="comment">//å› ä¸ºå¤´ç»“ç‚¹ä¸èƒ½åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬ä»ç„¶é€šè¿‡ä¸€ä¸ªè¾…åŠ©æŒ‡é’ˆï¼ˆå˜é‡ï¼‰æ¥å¸®åŠ©æ‰¾åˆ°æ·»åŠ çš„ä½ç½®</span></span><br><span class="line"><span class="comment">//å› ä¸ºå•é“¾è¡¨ï¼Œå› ä¸ºæˆ‘ä»¬æ‰¾çš„tempæ˜¯ä½äºæ·»åŠ ä½ç½®çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦åˆ™æ’å…¥ä¸äº†</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;  <span class="comment">//falseæ ‡è®°æ·»åŠ çš„ç¼–å·æ˜¯å¦å­˜åœ¨ï¼Œé»˜è®¤ä¸ºfalse</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(temp.next == <span class="literal">null</span>) &#123; <span class="comment">//è¯´æ˜æ­¤æ—¶tempå¤„äºé“¾è¡¨çš„æœ€å</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(temp.next.no &gt; heroNode.no) &#123;</span><br><span class="line"><span class="comment">//æ­¤æ—¶ä½ç½®æ‰¾åˆ°ï¼Œå°±åœ¨tempçš„åè¾¹æ’å…¥</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(temp.next.no == heroNode.no) </span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//è¯´æ˜å¸Œæœ›æ·»åŠ çš„heroNodeçš„ç¼–å·å·²ç„¶å­˜åœ¨</span></span><br><span class="line">flag = <span class="literal">true</span>;  <span class="comment">//è¯´æ˜ç¼–å·å­˜åœ¨</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">temp = temp.next;  <span class="comment">//åç§»ï¼Œå˜é‡å½“å‰é“¾è¡¨</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ¤æ–­flagçš„å€¼</span></span><br><span class="line"><span class="keyword">if</span>(flag) &#123;<span class="comment">//ä¸èƒ½æ·»åŠ ï¼Œè¯´æ˜ç¼–å·å­˜åœ¨</span></span><br><span class="line">System.out.printf(<span class="string">&quot;å‡†å¤‡æ’å…¥çš„è‹±é›„çš„ç¼–å·%dï¼Œå·²ç»å­˜åœ¨,æ— æ³•æ·»åŠ \n&quot;</span>,heroNode.no);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//æ’å…¥åˆ°é“¾è¡¨ä¸­ï¼Œtempåè¾¹</span></span><br><span class="line">heroNode.next = temp.next;</span><br><span class="line">temp.next = heroNode;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¿®è¯¥èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œæ ¹æ®noç¼–å·æ¥ä¿®æ”¹ï¼Œå³noç¼–å·ä¸èƒ½æ›´æ”¹</span></span><br><span class="line"><span class="comment">//è¯´æ˜</span></span><br><span class="line"><span class="comment">//1 æ ¹æ®newHeroNodeçš„noæ¥ä¿®æ”¹ä¾¿å¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(HeroNode newHeroNode)</span> &#123;</span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;é“¾è¡¨ä¸ºç©ºã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰¾åˆ°éœ€è¦ä¿®æ”¹çš„èŠ‚ç‚¹ï¼Œæ ¹æ®noç¼–å·</span></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªè¾…åŠ©å˜é‡</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;<span class="comment">//è¡¨ç¤ºæ˜¯å¦æ‰¾åˆ°è¯¥èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(temp == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;<span class="comment">//å·²ç»å˜é‡å®Œé“¾è¡¨</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(temp.no == newHeroNode.no) &#123;</span><br><span class="line"><span class="comment">//æ‰¾åˆ°äº†</span></span><br><span class="line">flag = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">temp = temp.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ ¹æ®flagåˆ¤æ–­æ˜¯å¦æ‰¾åˆ°è¦ä¿®æ”¹çš„èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">if</span>(flag) &#123;</span><br><span class="line">temp.name = newHeroNode.name;</span><br><span class="line">temp.nickName = newHeroNode.nickName;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//æ²¡æœ‰æ‰¾åˆ°</span></span><br><span class="line">System.out.printf(<span class="string">&quot;æ²¡æœ‰æ‰¾åˆ°ç¼–å·%dçš„èŠ‚ç‚¹ï¼Œä¸èƒ½ä¿®æ”¹\n&quot;</span>,newHeroNode.no);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ˜¾ç¤ºé“¾è¡¨ã€éå†ã€‘</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//åˆ¤è¯»æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;é“¾è¡¨ä¸ºç©º&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å› ä¸ºå¤´ç»“ç‚¹ï¼Œä¸èƒ½åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¾…åŠ©å˜é‡æ¥éå†</span></span><br><span class="line"><span class="type">HeroNode</span>  <span class="variable">temp</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦æ˜¯å¦é“¾è¡¨æœ€å</span></span><br><span class="line"><span class="keyword">if</span>(temp == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¾“å‡ºèŠ‚ç‚¹çš„ä¿¡æ¯</span></span><br><span class="line">System.out.println(temp);</span><br><span class="line"><span class="comment">//å°†nextåç§»,å¦‚æœä¸åç§»å°†è¿›å…¥æ­»å¾ªç¯</span></span><br><span class="line">temp = temp.next ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªheroNode ,æ¯ä¸ªHeroNodeå¯¹è±¡å°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeroNode</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> no;</span><br><span class="line"><span class="keyword">public</span> String name;</span><br><span class="line"><span class="keyword">public</span> String nickName;</span><br><span class="line"><span class="keyword">public</span> HeroNode next;<span class="comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ„é€ å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode</span><span class="params">(<span class="type">int</span> no, String name, String nickName)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line"><span class="built_in">this</span>.no = no;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line"><span class="built_in">this</span>.nickName = nickName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;HeroNode [no=&quot;</span> + no + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;, nickName=&quot;</span> + nickName + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="åˆ é™¤èŠ‚ç‚¹">åˆ é™¤èŠ‚ç‚¹</h5><p>ä»å•é“¾è¡¨ä¸­åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹çš„æ€è·¯</p><ol><li>åˆ é™¤èŠ‚ç‚¹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å°†æœ‰å…³èŠ‚ç‚¹å…ˆæ‰¾åˆ°éœ€è¦åˆ é™¤çš„è¿™ä¸ªèŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹temp</li><li><code>temp.next = temp.next.next;</code></li><li>è¢«åˆ é™¤çš„èŠ‚ç‚¹å°†ä¸ä¼šæœ‰å…¶ä»–çš„æŒ‡å‘ï¼Œä¼šè¢«JVMåƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ã€‚</li></ol><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingleLinkedListDemo</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//æµ‹è¯•</span></span><br><span class="line"><span class="comment">//åˆ›å»ºèŠ‚ç‚¹</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">1</span>,<span class="string">&quot;æ¾æ±Ÿ&quot;</span>,<span class="string">&quot;åŠæ—¶é›¨&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">2</span>,<span class="string">&quot;å¢ä¿Šä¹‰&quot;</span>,<span class="string">&quot;ç‰éº’éºŸ&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">3</span>,<span class="string">&quot;å´ç”¨&quot;</span>,<span class="string">&quot;æ™ºå¤šæ˜Ÿ&quot;</span>);</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">hero4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">4</span>,<span class="string">&quot;æ—å†²&quot;</span>,<span class="string">&quot;è±¹å­å¤´&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºé“¾è¡¨</span></span><br><span class="line"><span class="type">SingleLinkedList</span> <span class="variable">singleLinkedList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleLinkedList</span>();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero1);</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero2);</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero3);</span></span><br><span class="line"><span class="comment">singleLinkedList.add(hero4);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">singleLinkedList.addByOrder(hero3);</span><br><span class="line">singleLinkedList.addByOrder(hero1);</span><br><span class="line">singleLinkedList.addByOrder(hero4);</span><br><span class="line">singleLinkedList.addByOrder(hero2);</span><br><span class="line">singleLinkedList.addByOrder(hero2);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;ä¿®æ”¹ä¹‹å‰çš„&quot;</span>);</span><br><span class="line">singleLinkedList.list();</span><br><span class="line"></span><br><span class="line"><span class="comment">//æµ‹è¯•ä¿®æ”¹èŠ‚ç‚¹çš„ä»£ç </span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">newHeroNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">2</span>,<span class="string">&quot;å°å¢&quot;</span>,<span class="string">&quot;ç‰éº’éºŸÂ·Â·Â·&quot;</span>);</span><br><span class="line">singleLinkedList.update(newHeroNode);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;ä¿®æ”¹ä¹‹åçš„çš„é“¾è¡¨æƒ…å†µ&quot;</span>);</span><br><span class="line"><span class="comment">//æ˜¾ç¤ºé“¾è¡¨</span></span><br><span class="line">singleLinkedList.list();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">singleLinkedList.del(<span class="number">4</span>);</span><br><span class="line">singleLinkedList.del(<span class="number">1</span>);</span><br><span class="line">singleLinkedList.del(<span class="number">1</span>);</span><br><span class="line"><span class="comment">//åˆ é™¤åçš„é“¾è¡¨æƒ…å†µ</span></span><br><span class="line">System.out.println(<span class="string">&quot;åˆ é™¤åçš„é“¾è¡¨æƒ…å†µã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line">singleLinkedList.list();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªSingleLinkedListæ¥ç®¡ç†æˆ‘ä»¬çš„è‹±é›„</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SingleLinkedList</span>&#123;</span><br><span class="line"><span class="comment">//å…ˆåˆå§‹åŒ–ä¸€ä¸ªå¤´ç»“ç‚¹ï¼Œä¸€èˆ¬ä¸Šå¤´ç»“ç‚¹ä¸è¦åŠ¨</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">HeroNode</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">0</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ·»åŠ èŠ‚ç‚¹åˆ°å•å‘é“¾è¡¨</span></span><br><span class="line"><span class="comment">//æ€è·¯ï¼Œå½“ä¸è€ƒè™‘ç¼–å·é¡ºåºæ—¶</span></span><br><span class="line"><span class="comment">//1 æ‰¾åˆ°å½“å‰é“¾è¡¨çš„æœ€åèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">//2,å°†æœ€åè¿™ä¸ªèŠ‚ç‚¹çš„nexæŒ‡å‘æ–°èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(HeroNode heroNode)</span> &#123;</span><br><span class="line"><span class="comment">//å› ä¸ºheadèŠ‚ç‚¹ä¸èƒ½åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¾…åŠ©éå†temo</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="comment">//éå†é“¾è¡¨ï¼Œæ‰¾åˆ°æœ€å</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//æ‰¾åˆ°é“¾è¡¨çš„æœ€å</span></span><br><span class="line"><span class="keyword">if</span>(temp.next == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¦‚æœæ²¡æœ‰æ‰¾åˆ°æœ€åï¼Œå°†tempåç§»</span></span><br><span class="line">temp = temp.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å½“é€€å‡ºwhileå¾ªç¯åï¼Œtempå°±æŒ‡å‘é“¾è¡¨çš„æœ€å</span></span><br><span class="line"><span class="comment">//å°†æœ€åè¿™ä¸ªèŠ‚ç‚¹çš„nextæŒ‡å‘æ–°çš„èŠ‚ç‚¹</span></span><br><span class="line">temp.next = heroNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬äºŒç§æ–¹å¼æ·»åŠ è‹±é›„æ—¶ï¼Œæ ¹æ®æ’åå°†è‹±é›„æ’å…¥åˆ°æŒ‡å®šä½ç½®</span></span><br><span class="line"><span class="comment">//å¦‚æœæœ‰è¿™ä¸ªæ’åï¼Œåˆ™æ·»åŠ å¤±è´¥ï¼Œå¹¶ç»™å‡ºæç¤º</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addByOrder</span><span class="params">(HeroNode heroNode)</span> &#123;</span><br><span class="line"><span class="comment">//å› ä¸ºå¤´ç»“ç‚¹ä¸èƒ½åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬ä»ç„¶é€šè¿‡ä¸€ä¸ªè¾…åŠ©æŒ‡é’ˆï¼ˆå˜é‡ï¼‰æ¥å¸®åŠ©æ‰¾åˆ°æ·»åŠ çš„ä½ç½®</span></span><br><span class="line"><span class="comment">//å› ä¸ºå•é“¾è¡¨ï¼Œå› ä¸ºæˆ‘ä»¬æ‰¾çš„tempæ˜¯ä½äºæ·»åŠ ä½ç½®çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦åˆ™æ’å…¥ä¸äº†</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;  <span class="comment">//falseæ ‡è®°æ·»åŠ çš„ç¼–å·æ˜¯å¦å­˜åœ¨ï¼Œé»˜è®¤ä¸ºfalse</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(temp.next == <span class="literal">null</span>) &#123; <span class="comment">//è¯´æ˜æ­¤æ—¶tempå¤„äºé“¾è¡¨çš„æœ€å</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(temp.next.no &gt; heroNode.no) &#123;</span><br><span class="line"><span class="comment">//æ­¤æ—¶ä½ç½®æ‰¾åˆ°ï¼Œå°±åœ¨tempçš„åè¾¹æ’å…¥</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(temp.next.no == heroNode.no) </span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//è¯´æ˜å¸Œæœ›æ·»åŠ çš„heroNodeçš„ç¼–å·å·²ç„¶å­˜åœ¨</span></span><br><span class="line">flag = <span class="literal">true</span>;  <span class="comment">//è¯´æ˜ç¼–å·å­˜åœ¨</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">temp = temp.next;  <span class="comment">//åç§»ï¼Œå˜é‡å½“å‰é“¾è¡¨</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ¤æ–­flagçš„å€¼</span></span><br><span class="line"><span class="keyword">if</span>(flag) &#123;<span class="comment">//ä¸èƒ½æ·»åŠ ï¼Œè¯´æ˜ç¼–å·å­˜åœ¨</span></span><br><span class="line">System.out.printf(<span class="string">&quot;å‡†å¤‡æ’å…¥çš„è‹±é›„çš„ç¼–å·%dï¼Œå·²ç»å­˜åœ¨,æ— æ³•æ·»åŠ \n&quot;</span>,heroNode.no);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//æ’å…¥åˆ°é“¾è¡¨ä¸­ï¼Œtempåè¾¹</span></span><br><span class="line">heroNode.next = temp.next;</span><br><span class="line">temp.next = heroNode;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¿®è¯¥èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œæ ¹æ®noç¼–å·æ¥ä¿®æ”¹ï¼Œå³noç¼–å·ä¸èƒ½æ›´æ”¹</span></span><br><span class="line"><span class="comment">//è¯´æ˜</span></span><br><span class="line"><span class="comment">//1 æ ¹æ®newHeroNodeçš„noæ¥ä¿®æ”¹ä¾¿å¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(HeroNode newHeroNode)</span> &#123;</span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;é“¾è¡¨ä¸ºç©ºã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰¾åˆ°éœ€è¦ä¿®æ”¹çš„èŠ‚ç‚¹ï¼Œæ ¹æ®noç¼–å·</span></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªè¾…åŠ©å˜é‡</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;<span class="comment">//è¡¨ç¤ºæ˜¯å¦æ‰¾åˆ°è¯¥èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(temp == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;<span class="comment">//å·²ç»å˜é‡å®Œé“¾è¡¨</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(temp.no == newHeroNode.no) &#123;</span><br><span class="line"><span class="comment">//æ‰¾åˆ°äº†</span></span><br><span class="line">flag = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">temp = temp.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ ¹æ®flagåˆ¤æ–­æ˜¯å¦æ‰¾åˆ°è¦ä¿®æ”¹çš„èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">if</span>(flag) &#123;</span><br><span class="line">temp.name = newHeroNode.name;</span><br><span class="line">temp.nickName = newHeroNode.nickName;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//æ²¡æœ‰æ‰¾åˆ°</span></span><br><span class="line">System.out.printf(<span class="string">&quot;æ²¡æœ‰æ‰¾åˆ°ç¼–å·%dçš„èŠ‚ç‚¹ï¼Œä¸èƒ½ä¿®æ”¹\n&quot;</span>,newHeroNode.no);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">//TODO æ€è·¯</span></span><br><span class="line"><span class="comment">//1. headä¸åŠ¨ï¼Œæ•…è€Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªtempè¾…åŠ©èŠ‚ç‚¹æ‰¾åˆ°ç­‰å¾…åˆ é™¤èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">//2.æˆ‘ä»¬åœ¨æ¯”è¾ƒçš„æ—¶å€™ï¼Œæ˜¯temp.next.noå’Œéœ€è¦åˆ é™¤çš„èŠ‚ç‚¹çš„noæ¯”è¾ƒ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">del</span><span class="params">(<span class="type">int</span> no)</span> &#123;</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">temp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;<span class="comment">//æ ‡å¿—æ˜¯å¦æ‰¾åˆ°å¾…åˆ é™¤èŠ‚ç‚¹çš„</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(temp.next == <span class="literal">null</span>) &#123;<span class="comment">//å·²ç»åˆ°é“¾è¡¨çš„æœ€å</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(temp.next.no == no) &#123;</span><br><span class="line"><span class="comment">//æ‰¾åˆ°å¾…åˆ é™¤èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹temp</span></span><br><span class="line">flag = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">temp = temp.next;<span class="comment">//tempåç§»ï¼Œéå†</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ¤æ–­flag</span></span><br><span class="line"><span class="keyword">if</span>(flag) &#123;<span class="comment">//æ‰¾åˆ°</span></span><br><span class="line"><span class="comment">//å¯ä»¥åˆ é™¤</span></span><br><span class="line">temp.next = temp.next.next;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;è¦åˆ é™¤çš„èŠ‚ç‚¹%dä¸å­˜åœ¨\n&quot;</span>,no);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ˜¾ç¤ºé“¾è¡¨ã€éå†ã€‘</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//åˆ¤è¯»æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;é“¾è¡¨ä¸ºç©º&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å› ä¸ºå¤´ç»“ç‚¹ï¼Œä¸èƒ½åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¾…åŠ©å˜é‡æ¥éå†</span></span><br><span class="line"><span class="type">HeroNode</span>  <span class="variable">temp</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦æ˜¯å¦é“¾è¡¨æœ€å</span></span><br><span class="line"><span class="keyword">if</span>(temp == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¾“å‡ºèŠ‚ç‚¹çš„ä¿¡æ¯</span></span><br><span class="line">System.out.println(temp);</span><br><span class="line"><span class="comment">//å°†nextåç§»,å¦‚æœä¸åç§»å°†è¿›å…¥æ­»å¾ªç¯</span></span><br><span class="line">temp = temp.next ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªheroNode ,æ¯ä¸ªHeroNodeå¯¹è±¡å°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeroNode</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> no;</span><br><span class="line"><span class="keyword">public</span> String name;</span><br><span class="line"><span class="keyword">public</span> String nickName;</span><br><span class="line"><span class="keyword">public</span> HeroNode next;<span class="comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ„é€ å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode</span><span class="params">(<span class="type">int</span> no, String name, String nickName)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line"><span class="built_in">this</span>.no = no;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line"><span class="built_in">this</span>.nickName = nickName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;HeroNode [no=&quot;</span> + no + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;, nickName=&quot;</span> + nickName + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="é“¾è¡¨é¢è¯•é¢˜ï¼š">é“¾è¡¨é¢è¯•é¢˜ï¼š</h5><p>é¢è¯•é¢˜ï¼Œè·å–å•é“¾è¡¨çš„èŠ‚ç‚¹ä¸ªæ•°(å¦‚æœæ˜¯å¸¦å¤´ç»“ç‚¹çš„é“¾è¡¨ï¼Œéœ€æ±‚ä¸ç»Ÿè®¡å¤´ç»“ç‚¹)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> head é“¾è¡¨çš„å¤´èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> è¿”å›çš„å°±æ˜¯æœ‰æ•ˆèŠ‚ç‚¹çš„ä¸ªæ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getLength</span><span class="params">(HeroNode head)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123; <span class="comment">//ç©ºé“¾è¡¨</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªè¾…åŠ©çš„å˜é‡,è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰ç»Ÿè®¡å¤´ç»“ç‚¹</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">cur</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="keyword">while</span>(cur != <span class="literal">null</span>) &#123;</span><br><span class="line">length ++ ;</span><br><span class="line">cur = cur.next; <span class="comment">//éå†</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> length;</span><br><span class="line">&#125;</span><br><span class="line">main:</span><br><span class="line"><span class="comment">//æµ‹è¯•ä¸€ä¸‹å¤´èŠ‚ç‚¹çš„ä¸ªæ•°</span></span><br><span class="line">System.out.println(<span class="string">&quot;æœ‰æ•ˆçš„èŠ‚ç‚¹ä¸ªæ•°ä¸ºï¼š &quot;</span>+getLength(singleLinkedList.getHead()));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾å•é“¾è¡¨ä¸­çš„å€’æ•°ç¬¬kä¸ªèŠ‚ç‚¹ã€æ–°æµªé¢è¯•é¢˜ã€‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ€è·¯ï¼š</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œæ¥å—headèŠ‚ç‚¹ï¼ŒåŒæ—¶æ¥å—ä¸€ä¸ªindex</span></span><br><span class="line"><span class="comment"> * indexè¡¨ç¤ºå€’æ•°ç¬¬indexä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> * å…ˆå°†é“¾è¡¨ä»å¤´åˆ°å°¾éå†ï¼Œå¾—åˆ°é“¾è¡¨çš„æ€»çš„é•¿åº¦getLength</span></span><br><span class="line"><span class="comment"> * å¾—åˆ°sizeåï¼Œæˆ‘ä»¬ä»é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå¼€å§‹éå†ï¼ˆsize-indexï¼‰ä¸ªï¼Œå°±å¯ä»¥å¾—åˆ°</span></span><br><span class="line"><span class="comment"> * å¦‚æœæ‰¾åˆ°äº†ï¼Œåˆ™è¿”å›è¯¥èŠ‚ç‚¹ï¼Œå¦åˆ™è¿”å›null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> HeroNode <span class="title function_">findLastIndexNode</span><span class="params">(HeroNode head,<span class="type">int</span> index)</span> </span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//åˆ¤æ–­å¦‚æœé“¾è¡¨ä¸ºç©ºï¼Œåˆ™è¿”å›null</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç¬¬ä¸€ä¸ªéå†å¾—åˆ°çš„é“¾è¡¨çš„é•¿åº¦çš„ä¸ªæ•°(èŠ‚ç‚¹ä¸ªæ•°)</span></span><br><span class="line"><span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> getLength(head);</span><br><span class="line"><span class="comment">//ç¬¬äºŒæ¬¡éå†size-indexä½ç½®ï¼Œå°±æ˜¯æˆ‘ä»¬å€’æ•°çš„ç¬¬kä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">//å…ˆåšä¸€ä¸ªindexçš„æ ¡éªŒ</span></span><br><span class="line"><span class="keyword">if</span>(index &lt;= <span class="number">0</span> || index &gt; size) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å®šä¹‰ç»™è¾…åŠ©å˜é‡ forå¾ªç¯å®šä½å€’æ•°çš„index</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">cur</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size - index; i++) &#123;</span><br><span class="line">cur = cur.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> cur;</span><br><span class="line">&#125;</span><br><span class="line">main:</span><br><span class="line"><span class="comment">//æµ‹è¯•ä¸€äº›çœ‹æ˜¯å¦å¾—åˆ°å€’æ•°ç¬¬kä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">res</span> <span class="operator">=</span> findLastIndexNode(singleLinkedList.getHead(), <span class="number">1</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;res=&quot;</span> + res);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å•é“¾è¡¨çš„åè½¬ã€è…¾è®¯é¢è¯•ï¼Œéš¾åº¦é€‚ä¸­ã€‘</p><ol><li>å…ˆå®šä¹‰ä¸€ä¸ªèŠ‚ç‚¹<code>reverseHead = new HeroNodeHead</code>çš„æœ€å‰ç«¯ã€‚</li><li>ä»å¤´åˆ°å°¾ä¾¿åˆ©åŸæ¥çš„æŒ‡é’ˆï¼Œæ¯éå†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±å°†å…¶å–å‡ºï¼Œå¹¶æ”¾åœ¨æ–°çš„é“¾è¡¨reverseHeadçš„æœ€å‰ç«¯ã€‚</li><li>åŸæ¥çš„é“¾è¡¨<code>head.next = reverseHead.next</code>ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å°†å•é“¾è¡¨åè½¬</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">reverseList</span><span class="params">(HeroNode head)</span> &#123;</span><br><span class="line"><span class="comment">//å¦‚æœå½“å‰é“¾è¡¨ä¸ºç©ºï¼Œæˆ–è€…åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ— éœ€åè½¬ï¼Œç›´æ¥è¿”å›å°±è¡Œã€‚</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span> || head.next.next == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªè¾…åŠ©çš„æŒ‡é’ˆ(å˜é‡)ï¼Œå¸®åŠ©æˆ‘ä»¬éå†åŸæ¥çš„é“¾è¡¨</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">cur</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">next</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">//æŒ‡å‘å½“å‰èŠ‚ç‚¹[cur]çš„ä¸‹ä¸€èŠ‚ç‚¹</span></span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">reverseHead</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode</span>(<span class="number">0</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="comment">//éå†åŸæ¥çš„é“¾è¡¨ï¼Œæ¯éå†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±å°†å…¶å–å‡ºï¼Œå¹¶åœ¨æ–°çš„é“¾è¡¨reverseHeadçš„æœ€å‰ç«¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//TODO æ€è€ƒ</span></span><br><span class="line"><span class="keyword">while</span>(cur != <span class="literal">null</span>) &#123;</span><br><span class="line">next = cur.next; <span class="comment">//å…ˆæš‚æ—¶ä¿å­˜å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€èŠ‚ç‚¹ï¼Œå› ä¸ºåé¢éœ€è¦ä½¿ç”¨</span></span><br><span class="line">cur.next = reverseHead.next; <span class="comment">//å°†curçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘æ–°çš„é“¾è¡¨çš„æœ€å‰ç«¯</span></span><br><span class="line">reverseHead.next = cur; <span class="comment">//å°†curé“¾æ¥åˆ°æ–°çš„é“¾è¡¨ä¸Š</span></span><br><span class="line">cur = next; <span class="comment">//è®©curåç§»</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å°†head.nextæŒ‡å‘reverseHead.nextï¼Œæ­¤æ—¶å°±å®ç°å•é“¾è¡¨çš„åè½¬</span></span><br><span class="line">head.next = reverseHead.next;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main:</span><br><span class="line"><span class="comment">//æµ‹è¯•ä¸€ä¸‹å•é“¾è¡¨çš„åè½¬åŠŸèƒ½</span></span><br><span class="line">System.out.println(<span class="string">&quot;æ­¤æ—¶è¿™ä¸ªæ—¶å€™æ˜¯åŸå…ˆé“¾è¡¨&quot;</span>);</span><br><span class="line">singleLinkedList.list();</span><br><span class="line"></span><br><span class="line"><span class="comment">//åè½¬é“¾è¡¨</span></span><br><span class="line">System.out.println(<span class="string">&quot;åè½¬åçš„å•é“¾è¡¨&quot;</span>);</span><br><span class="line">reverseList(singleLinkedList.getHead());</span><br><span class="line">singleLinkedList.list();</span><br></pre></td></tr></table></figure><p>ä»å°¾åˆ°å¤´æ‰“å°å•é“¾è¡¨ ã€æ–¹å¼1ï¼Œåå‘éå†ï¼Œæ–¹å¼2ï¼šstackæ ˆã€‘</p><p>æ€è·¯ï¼š</p><ol><li><p>ä¸Šé¢çš„é¢˜è¦æ±‚å°±æ˜¯é€†åºæ‰“å°å•é“¾è¡¨ã€‚</p></li><li><p>æ–¹å¼1ï¼šå…ˆå°†å•é“¾è¡¨è¿›è¡Œåè½¬ï¼Œç„¶ååœ¨éå†å°±è¡Œï¼Œä½†æ˜¯è¿™æ ·ä¼šç ´ååŸæ¥çš„å•é“¾è¡¨çš„ç»“æ„ï¼Œ<strong>ä¸å¯å–</strong>ã€‚</p></li><li><p>æ–¹å¼2ï¼šå¯ä»¥åˆ©ç”¨æ ˆè¿™ä¸ªæ•°æ®ç»“æ„ï¼Œå°†å„ä¸ªèŠ‚ç‚¹å‹å…¥æ ˆä¸­ï¼Œç„¶ååˆ©ç”¨æ ˆçš„<strong>å…ˆè¿›åå‡º</strong>çš„ç‰¹ç‚¹ï¼Œå®ç°é€†åºæ‰“å°çš„æ•ˆæœã€‚æ­¤æ–¹å¼ä¸ä¼šå½±å“é“¾è¡¨çš„ç»“æ„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»å°¾åˆ°å¤´æ‰“å°å•é“¾è¡¨</span></span><br><span class="line"><span class="comment">//ä½¿ç”¨æ–¹å¼2ï¼šä¹Ÿå°±æ˜¯å°†é“¾è¡¨ä¸­æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°æ ˆä¸­ï¼Œç„¶åé€šè¿‡æ ˆå°†æ‰€æœ‰å…ƒç´ åè½¬ï¼Œåˆ©ç”¨æ ˆçš„ç‰¹ç‚¹ï¼Œå®ç°é€†åºæ‰“å°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">reversePrint</span><span class="params">(HeroNode head)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> ; <span class="comment">//ç©ºé“¾è¡¨ï¼Œä¸èƒ½æ‰“å°</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ›å»ºè¦ç»™çš„ä¸€ä¸ªæ ˆï¼Œå°†å„ä¸ªèŠ‚ç‚¹å‹å…¥æ ˆä¾¿å¯ã€‚</span></span><br><span class="line">Stack&lt;HeroNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;HeroNode&gt;();</span><br><span class="line"><span class="type">HeroNode</span> <span class="variable">cur</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="comment">//å°†é“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹å‹å…¥æ ˆä¸­</span></span><br><span class="line"><span class="keyword">while</span>(cur != <span class="literal">null</span>) &#123;</span><br><span class="line">stack.push(cur);</span><br><span class="line">cur = cur.next; <span class="comment">// curåç§»ï¼Œè¿™æ ·å°±å¯ä»¥å‹å…¥ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å°†æ ˆä¸­çš„èŠ‚ç‚¹è¿›è¡Œæ‰“å°ï¼Œpop å‡ºæ ˆ</span></span><br><span class="line"><span class="keyword">while</span>(stack.size() &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">System.out.println(stack.pop());  <span class="comment">//stackçš„ç‰¹ç‚¹æ˜¯å…ˆè¿›åå‡ºçš„ç‰¹ç‚¹</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main:</span><br><span class="line">System.out.println(<span class="string">&quot;é€†åºæ‰“å°å•é“¾è¡¨,æ­¤æ—¶æ²¡æœ‰æ”¹å˜é“¾è¡¨çš„ç»“æ„ã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line">reversePrint(singleLinkedList.getHead());</span><br></pre></td></tr></table></figure></li></ol><p>åˆå¹¶ä¸¤ä¸ªæœ‰åºçš„å•é“¾è¡¨ï¼Œåˆå¹¶ä¹‹åçš„é“¾è¡¨ä»ç„¶äº•ç„¶æœ‰åºã€ä¹ é¢˜ã€‘</p><p>å•é“¾è¡¨å­˜åœ¨çš„é—®é¢˜ï¼š</p><ol><li>å•é“¾è¡¨ä¸èƒ½å®ç°è‡ªæˆ‘åˆ é™¤ï¼Œå…¶æŸ¥æ‰¾çš„æ–¹å‘åªèƒ½æ˜¯ä¸€ä¸ªæ–¹å‘è€ŒåŒå‘é“¾è¡¨å¯ä»¥å‘å‰æˆ–è€…å‘åæŸ¥æ‰¾</li><li>å•å‘é“¾è¡¨ä¸èƒ½è‡ªæˆ‘åˆ é™¤ï¼Œéœ€è¦é è¾…åŠ©èŠ‚ç‚¹ï¼Œè€ŒåŒå‘é“¾è¡¨ï¼Œå¯ä»¥è‡ªæˆ‘åˆ é™¤ï¼Œæ‰€ä»¥å‰é¢æˆ‘ä»¬å•é“¾è¡¨åˆ é™¤æ—¶èŠ‚ç‚¹ï¼Œæ€»æ˜¯æ‰¾åˆ°tempçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ¥åˆ é™¤ã€‚</li></ol><h3 id="4-2-åŒå‘é“¾è¡¨">4.2 åŒå‘é“¾è¡¨</h3><p>åŒå‘é“¾è¡¨ï¼š</p><p>æ‰€è°“åŒå‘é“¾è¡¨</p><p>é€šä¿—çš„è®²å°±æ˜¯å¯ä»¥ä»ä¸¤ç«¯è¿›è¡ŒæŸ¥æ‰¾ã€‚</p><p>åˆ†æåŒå‘é“¾è¡¨çš„éå†ï¼Œæ·»åŠ ï¼Œä¿®æ”¹ï¼Œåˆ é™¤çš„æ“ä½œæ€è·¯</p><ol><li>éå†çš„æ–¹å¼å’Œå•é“¾è¡¨ä¸€æ ·ï¼Œåªæ˜¯å¯ä»¥å‘å‰æŸ¥æ‰¾ï¼Œä¹Ÿå¯ä»¥å‘åæŸ¥æ‰¾ã€‚</li><li>æ·»åŠ ï¼ˆé»˜è®¤æ·»åŠ æ­é…åŒå‘é“¾è¡¨çš„æœ€åï¼‰<ol><li>å…ˆæ‰¾åˆ°åŒå‘é“¾è¡¨çš„æœ€åè¿™ä¸ªèŠ‚ç‚¹</li><li><code>temp.next = newHeroNode</code></li><li><code>newHeroNode.pre = temp;</code></li></ol></li><li>ä¿®æ”¹çš„æ€è·¯å’ŒåŸç†çš„å•å‘é“¾è¡¨ä¸€æ ·</li><li>åˆ é™¤<ol><li>å› ä¸ºæ˜¯åŒå‘é“¾è¡¨ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å®ç°è‡ªæˆ‘åˆ é™¤æŸä¸ªèŠ‚ç‚¹</li><li>ç›´æ¥æ‰¾åˆ°è¦åˆ é™¤çš„è¿™ä¸ªèŠ‚ç‚¹ï¼Œæ¯”å¦‚temp</li><li><code>temp.pre.next = temp.next;</code></li><li><code>temp.next.pre = temp.pre;</code></li></ol></li></ol><p>ä»£ç å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DoubleLinkListDemo</span> &#123;</span><br><span class="line"><span class="comment">//åŒå‘é“¾è¡¨çš„æµ‹è¯•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;åŒå‘é“¾è¡¨çš„æµ‹è¯•ï¼š&quot;</span>);</span><br><span class="line"><span class="comment">//å…ˆåˆ›å»ºèŠ‚ç‚¹</span></span><br><span class="line"><span class="type">HeroNode2</span> <span class="variable">hero1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode2</span>(<span class="number">1</span>,<span class="string">&quot;å¼ ä¸‰&quot;</span>,<span class="string">&quot;é»‘è„¸éº»ç“œ&quot;</span>);</span><br><span class="line"><span class="type">HeroNode2</span> <span class="variable">hero2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode2</span>(<span class="number">2</span>,<span class="string">&quot;æå››&quot;</span>,<span class="string">&quot;çº¢è„¸å ‡ç“œ&quot;</span>);</span><br><span class="line"><span class="type">HeroNode2</span> <span class="variable">hero3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode2</span>(<span class="number">3</span>,<span class="string">&quot;ç‹äº”&quot;</span>,<span class="string">&quot;ç™½è„¸å†¬ç“œ&quot;</span>);</span><br><span class="line"><span class="type">HeroNode2</span> <span class="variable">hero4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode2</span>(<span class="number">4</span>,<span class="string">&quot;èµµå…­&quot;</span>,<span class="string">&quot;ç»¿è„¸è¥¿ç“œ&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">DoubleLinkList</span> <span class="variable">doubleLinkList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DoubleLinkList</span>();</span><br><span class="line">doubleLinkList.add(hero1);</span><br><span class="line">doubleLinkList.add(hero2);</span><br><span class="line">doubleLinkList.add(hero3);</span><br><span class="line">doubleLinkList.add(hero4);</span><br><span class="line"></span><br><span class="line"><span class="comment">//éå†</span></span><br><span class="line">doubleLinkList.list();</span><br><span class="line"><span class="comment">//ä¿®æ”¹</span></span><br><span class="line"><span class="type">HeroNode2</span> <span class="variable">newHeroNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode2</span>(<span class="number">2</span>,<span class="string">&quot;å¾—åŠ›&quot;</span>,<span class="string">&quot;è‡ªç ”è²äºš&quot;</span>);</span><br><span class="line">doubleLinkList.update(newHeroNode);</span><br><span class="line">System.out.println(<span class="string">&quot;ä¿®æ”¹åçš„ç»“æœï¼š&quot;</span>);</span><br><span class="line">doubleLinkList.list();</span><br><span class="line"><span class="comment">//åˆ é™¤</span></span><br><span class="line">doubleLinkList.del(<span class="number">2</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;åˆ é™¤åçš„ç»“æœï¼š&quot;</span>);</span><br><span class="line">doubleLinkList.list();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªåŒå‘é“¾è¡¨çš„ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DoubleLinkList</span>&#123;</span><br><span class="line"><span class="comment">//é€šå•å‘é“¾è¡¨ä¸€æ ·,åˆ›å»ºä¸€ä¸ªå¤´èŠ‚ç‚¹ï¼Œå¤´ç»“ç‚¹ä¸è¦åŠ¨ï¼Œä¸å­˜æ”¾å…·ä½“æ•°æ®</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">HeroNode2</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeroNode2</span>(<span class="number">0</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> HeroNode2 <span class="title function_">getHead</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//éå†åŒå‘é“¾è¡¨çš„æ–¹æ³•å’Œå•å‘é“¾è¡¨ä¸€æ ·ã€‚</span></span><br><span class="line"><span class="comment">//æ˜¾ç¤ºé“¾è¡¨ã€éå†ã€‘</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//åˆ¤è¯»æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;é“¾è¡¨ä¸ºç©º&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å› ä¸ºå¤´ç»“ç‚¹ï¼Œä¸èƒ½åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¾…åŠ©å˜é‡æ¥éå†</span></span><br><span class="line"><span class="type">HeroNode2</span>  <span class="variable">temp</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦æ˜¯å¦é“¾è¡¨æœ€å</span></span><br><span class="line"><span class="keyword">if</span>(temp == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¾“å‡ºèŠ‚ç‚¹çš„ä¿¡æ¯</span></span><br><span class="line">System.out.println(temp);</span><br><span class="line"><span class="comment">//å°†nextåç§»,å¦‚æœä¸åç§»å°†è¿›å…¥æ­»å¾ªç¯</span></span><br><span class="line">temp = temp.next ;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹åˆ°åŒå‘é“¾è¡¨çš„æœ€å</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(HeroNode2 heroNode)</span> &#123;</span><br><span class="line"><span class="comment">//å› ä¸ºheadèŠ‚ç‚¹ä¸èƒ½åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¾…åŠ©éå†temo</span></span><br><span class="line"><span class="type">HeroNode2</span> <span class="variable">temp</span> <span class="operator">=</span> head;</span><br><span class="line"><span class="comment">//éå†é“¾è¡¨ï¼Œæ‰¾åˆ°æœ€å</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//æ‰¾åˆ°é“¾è¡¨çš„æœ€å</span></span><br><span class="line"><span class="keyword">if</span>(temp.next == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¦‚æœæ²¡æœ‰æ‰¾åˆ°æœ€åï¼Œå°†tempåç§»</span></span><br><span class="line">temp = temp.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å½“é€€å‡ºwhileå¾ªç¯åï¼Œtempå°±æŒ‡å‘é“¾è¡¨çš„æœ€å</span></span><br><span class="line"><span class="comment">//æ­¤æ—¶å½¢æˆä¸€ä¸ªåŒå‘é“¾è¡¨</span></span><br><span class="line">temp.next = heroNode;</span><br><span class="line">heroNode.pre = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¿®æ”¹ä¸€ä¸ªèŠ‚ç‚¹çš„å†…å®¹</span></span><br><span class="line"><span class="comment">//åŒå‘é“¾è¡¨çš„èŠ‚ç‚¹å†…å®¹ä¿®æ”¹å’Œå•å‘é“¾è¡¨å‡ ä¹ä¸€æ ·</span></span><br><span class="line"><span class="comment">//åªæ˜¯èŠ‚ç‚¹çš„ç±»å‹æ”¹æˆäº†HeroNode2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(HeroNode2 newHeroNode)</span> &#123;</span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;é“¾è¡¨ä¸ºç©ºã€‚ã€‚ã€‚&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰¾åˆ°éœ€è¦ä¿®æ”¹çš„èŠ‚ç‚¹ï¼Œæ ¹æ®noç¼–å·</span></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªè¾…åŠ©å˜é‡</span></span><br><span class="line"><span class="type">HeroNode2</span> <span class="variable">temp</span> <span class="operator">=</span> head.next;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;<span class="comment">//è¡¨ç¤ºæ˜¯å¦æ‰¾åˆ°è¯¥èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(temp == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;<span class="comment">//å·²ç»å˜é‡å®Œé“¾è¡¨</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(temp.no == newHeroNode.no) &#123;</span><br><span class="line"><span class="comment">//æ‰¾åˆ°äº†</span></span><br><span class="line">flag = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">temp = temp.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ ¹æ®flagåˆ¤æ–­æ˜¯å¦æ‰¾åˆ°è¦ä¿®æ”¹çš„èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">if</span>(flag) &#123;</span><br><span class="line">temp.name = newHeroNode.name;</span><br><span class="line">temp.nickName = newHeroNode.nickName;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//æ²¡æœ‰æ‰¾åˆ°</span></span><br><span class="line">System.out.printf(<span class="string">&quot;æ²¡æœ‰æ‰¾åˆ°ç¼–å·%dçš„èŠ‚ç‚¹ï¼Œä¸èƒ½ä¿®æ”¹\n&quot;</span>,newHeroNode.no);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»åŒå‘é“¾è¡¨ä¸­åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">//è¯´æ˜</span></span><br><span class="line"><span class="comment">//1 å¯¹äºåŒå‘é“¾è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ‰¾åˆ°è¦åˆ é™¤çš„è¿™ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">//2 æ‰¾åˆ°åï¼Œè‡ªæˆ‘åˆ é™¤å³å¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">del</span><span class="params">(<span class="type">int</span> no)</span> &#123;</span><br><span class="line"><span class="comment">//åˆ¤æ–­å½“å‰é“¾è¡¨æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="keyword">if</span>(head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;é“¾è¡¨ä¸ºç©ºï¼Œæ— æ³•åˆ é™¤&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">HeroNode2</span> <span class="variable">temp</span> <span class="operator">=</span> head.next; <span class="comment">//è¾…åŠ©å˜é‡(æŒ‡é’ˆ)</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;<span class="comment">//æ ‡å¿—æ˜¯å¦æ‰¾åˆ°å¾…åˆ é™¤èŠ‚ç‚¹çš„</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(temp == <span class="literal">null</span>) &#123;<span class="comment">//å·²ç»åˆ°é“¾è¡¨çš„æœ€å</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(temp.no == no) &#123;</span><br><span class="line"><span class="comment">//æ‰¾åˆ°å¾…åˆ é™¤èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹temp</span></span><br><span class="line">flag = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">temp = temp.next;<span class="comment">//tempåç§»ï¼Œéå†</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ¤æ–­flag</span></span><br><span class="line"><span class="keyword">if</span>(flag) &#123;<span class="comment">//æ‰¾åˆ°</span></span><br><span class="line"><span class="comment">//å¯ä»¥åˆ é™¤</span></span><br><span class="line"><span class="comment">//temp.next = temp.next.next; ã€å•å‘é“¾è¡¨çš„åˆ é™¤æ–¹å¼ã€‘</span></span><br><span class="line">temp.pre.next = temp.next;</span><br><span class="line"><span class="comment">//æ­¤æ—¶ä»¥ä¸‹ä»£ç å­˜åœ¨é—®é¢˜ï¼Œå¦‚æœæ˜¯ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±ä¸éœ€è¦æ‰§è¡Œä¸‹è¾¹è¯­å¥ï¼Œå¦åˆ™å°†ä¼šäº§ç”Ÿç©ºæŒ‡é’ˆé—®é¢˜ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(temp.next != <span class="literal">null</span>) &#123;</span><br><span class="line">temp.next.pre = temp.pre;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;è¦åˆ é™¤çš„èŠ‚ç‚¹%dä¸å­˜åœ¨\n&quot;</span>,no);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HeroNode2</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> no;</span><br><span class="line"><span class="keyword">public</span> String name;</span><br><span class="line"><span class="keyword">public</span> String nickName;</span><br><span class="line"><span class="keyword">public</span> HeroNode2 next; <span class="comment">//æŒ‡å‘åä¸€ä¸ªèŠ‚ç‚¹ï¼Œé»˜è®¤ä¸ºnull</span></span><br><span class="line"><span class="keyword">public</span> HeroNode2 pre; <span class="comment">//æŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹,é»˜è®¤ä¸ºnull</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode2</span><span class="params">(<span class="type">int</span> no, String name, String nickName)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line"><span class="built_in">this</span>.no = no;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line"><span class="built_in">this</span>.nickName = nickName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">HeroNode2</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;HeroNode2 [no=&quot;</span> + no + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;, nickName=&quot;</span> + nickName </span><br><span class="line">+ <span class="string">&quot;]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹ é¢˜ï¼š</p><p>åŒå‘é“¾è¡¨çš„ç¬¬äºŒç§æ·»åŠ æ–¹å¼ï¼ŒæŒ‰ç…§ç¼–å·é¡ºåºï¼ˆæç¤ºï¼ŒæŒ‰ç…§å•é“¾è¡¨çš„é¡ºåºè¿›è¡Œæ·»åŠ å³å¯ï¼Œç¨ä½œä¿®æ”¹ï¼‰;</p><h3 id="4-3-å•å‘ç¯å½¢é“¾è¡¨ï¼š">4.3 å•å‘ç¯å½¢é“¾è¡¨ï¼š</h3><p>çº¦ç‘Ÿå¤«é—®é¢˜ï¼šè®¾ç¼–å·ä¸º1,2,â€¦n,çš„nä¸ªäººå›´ååœ¨ä¸€åœˆï¼Œçº¦å®šç¼–å·ä¸ºk(1&lt;= k &lt;=m)çš„äººä»1å¼€å§‹æŠ¥æ•°ï¼Œæ•°åˆ°ä»1å¼€å§‹æŠ¥æ•°ï¼Œæ•°åˆ°mçš„é‚£ä¸ªäººå‡ºåˆ—ï¼Œä»–çš„ä¸‹ä¸€ä½åˆä»1å¼€å§‹æŠ¥æ•°ï¼Œæ•°åˆ°mçš„é‚£ä¸ªäººåˆå‡ºåˆ—ï¼Œä¾æ¬¡ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰äººå‡ºåˆ—ä¸ºæ­¢ï¼Œç”±æ­¤äº§ç”Ÿä¸€ä¸ªå‡ºé˜Ÿç¼–å·çš„åºåˆ—ã€‚</p><blockquote><p>n = 5,å³æœ‰5ä¸ªäºº</p><p>k =1ï¼Œä»ç¬¬ä¸€ä¸ªäººå¼€å§‹æŠ¥æ•°</p><p>m=2,æ•°2ä¸‹ã€‚</p></blockquote><p>æ€è·¯ï¼š</p><ol><li>å…ˆåˆ›å»ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè®©firstæŒ‡å‘è¯¥èŠ‚ç‚¹ï¼Œå¹¶å½¢æˆç¯å½¢</li><li>åé¢å½“æˆ‘ä»¬æ²¡åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ï¼Œå°±å°†è¯¥èŠ‚ç‚¹åŠ å…¥åˆ°å·²æœ‰çš„ç¯å½¢é“¾è¡¨å³å¯ã€‚</li></ol><p>éå†ç¯å½¢é“¾è¡¨ï¼š</p><ol><li><p>å…ˆè®©ä¸€ä¸ªè¾…åŠ©æŒ‡é’ˆï¼ˆå˜é‡ï¼‰ curBoyï¼ŒæŒ‡å‘firstèŠ‚ç‚¹</p></li><li><p>ç„¶åé€šè¿‡ä¸€ä¸ªwhileå¾ªç¯è¯¥ç¯å½¢é“¾è¡¨å³å¯ï¼Œ<code>curBoy.next == first;</code></p></li><li><p>æ ¹æ®ç”¨æˆ·çš„è¾“å…¥ï¼Œç”Ÿæˆä¸€ä¸ªå°å­©å‡ºåœˆçš„é¡ºåºï¼Œäº‹å…ˆåº”è¯¥æŒ‡å‘ç¯å½¢é“¾è¡¨çš„æœ€åè¿™ä¸ªèŠ‚ç‚¹ã€‚</p><p>â€‹è¡¥å……ï¼šå°å­©æŠ¥æ•°ä¹‹å‰ï¼Œå…ˆè®©firstå’Œhelperç§»åŠ¨ k -1 æ¬¡</p></li><li><p>å½“å°å­©æŠ¥æ•°æ—¶ï¼Œè®©firstå’ŒhelperæŒ‡é’ˆåŒæ—¶ç§»åŠ¨m -1æ¬¡</p></li><li><p>è¿™ä¸ªæ—¶å€™å°±å¯ä»¥å°†firstæŒ‡å‘çš„å°å­©èŠ‚ç‚¹å‡ºåœˆï¼›</p><ol><li>first = first.next</li><li>helper.next =first;</li></ol><p>åŸæ¥firstæŒ‡å‘çš„èŠ‚ç‚¹å°±æ²¡æœ‰ä»»ä½•å¼•ç”¨ï¼Œå°±ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Josepfu</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//æµ‹è¯•çœ‹æ„å»ºç¯å½¢é˜Ÿåˆ—å’Œéå†æ˜¯å¦æ­£ç¡®</span></span><br><span class="line"><span class="type">CircleSinglelinkedList</span> <span class="variable">circleSinglelinkedList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CircleSinglelinkedList</span>();</span><br><span class="line">circleSinglelinkedList.addBoy(<span class="number">10</span>); <span class="comment">//åŠ å…¥5ä¸ªå°å­©èŠ‚ç‚¹</span></span><br><span class="line">circleSinglelinkedList.showBoy();</span><br><span class="line"></span><br><span class="line"><span class="comment">//æµ‹è¯•å°å­©å‡ºåœˆæ˜¯å¦æ­£ç¡®</span></span><br><span class="line">circleSinglelinkedList.countBoy(<span class="number">1</span>, <span class="number">2</span>, <span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªç¯å½¢çš„å•å‘é“¾è¡¨</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CircleSinglelinkedList</span>&#123;</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªfirstèŠ‚ç‚¹ï¼Œå½“å‰æ²¡æœ‰ç¼–å·</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">Boy</span> <span class="variable">first</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Boy</span>(-<span class="number">1</span>);</span><br><span class="line"><span class="comment">//æ·»åŠ å°å­©èŠ‚ç‚¹ï¼Œæ„å»ºä¸€ä¸ªç¯å½¢çš„é“¾è¡¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addBoy</span><span class="params">(<span class="type">int</span> nums)</span> &#123;</span><br><span class="line"><span class="comment">//nums åšä¸€ä¸ªæ•°æ®æ ¡éªŒ</span></span><br><span class="line"><span class="keyword">if</span>(nums &lt; <span class="number">1</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;numsçš„å€¼ä¸æ­£ç¡®&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">Boy</span> <span class="variable">curBoy</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">// è¾…åŠ©æŒ‡é’ˆï¼Œå¸®åŠ©æ„å»ºç¯å½¢é“¾è¡¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨foræ¥åˆ›å»ºæˆ‘ä»¬çš„ç¯å½¢é“¾è¡¨</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= nums; i++) &#123;</span><br><span class="line"><span class="comment">//æ ¹æ®ç¼–å·åˆ›å»ºå°å­©èŠ‚ç‚¹</span></span><br><span class="line"><span class="type">Boy</span> <span class="variable">boy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Boy</span>(i);</span><br><span class="line"><span class="comment">//å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªå°å­©</span></span><br><span class="line"><span class="keyword">if</span>(i == <span class="number">1</span>) &#123;</span><br><span class="line">first = boy;</span><br><span class="line">first.setNext(first); <span class="comment">//æ„æˆå¾ªç¯</span></span><br><span class="line">curBoy = first; <span class="comment">// è®©curBoyæŒ‡å‘ç¬¬ä¸€ä¸ªå°å­©</span></span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">curBoy.setNext(boy);<span class="comment">//</span></span><br><span class="line">boy.setNext(first);</span><br><span class="line">curBoy = boy;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//éå†å½“å‰ç¯å¢ƒ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showBoy</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//åˆ¤æ–­é“¾è¡¨æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="keyword">if</span>(first == <span class="literal">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;æ²¡æœ‰ä»»ä½•å°å­©...&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å› ä¸ºfirstä¸èƒ½åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬ä»ç„¶ä½¿ç”¨ä¸€ä¸ªè¾…åŠ©æŒ‡é’ˆå®Œæˆéå†</span></span><br><span class="line"><span class="type">Boy</span> <span class="variable">curBoy</span> <span class="operator">=</span> first;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;å°å­©çš„ç¼–å· %d \n&quot;</span>,curBoy.getNo());</span><br><span class="line"><span class="keyword">if</span>(curBoy.getNext() == first) &#123; <span class="comment">//è¯´æ˜å·²ç»éå†å®Œæˆ</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">curBoy = curBoy.getNext(); <span class="comment">//å°†curBoyåç§»</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ¹æ®ç”¨æˆ·çš„è¾“å…¥ï¼Œè®¡ç®—å‡ºå°å­©å‡ºåœˆçš„é¡ºåº</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> startNo è¡¨ç¤ºç¬¬å‡ ä¸ªå°å­©å¼€å§‹è®¡æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> countNum è¡¨ç¤ºæ•°å¤šå°‘ä¸‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> nums è¡¨ç¤ºæœ€åˆæœ‰å¤šå°‘ä¸ªå°å­©å­åœ¨åœˆä¸­</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">countBoy</span><span class="params">(<span class="type">int</span> startNo,<span class="type">int</span> countNum, <span class="type">int</span> nums)</span> &#123;</span><br><span class="line"><span class="comment">//å…ˆå¯¹æ•°æ®è¿›è¡Œæ ¡éªŒ</span></span><br><span class="line"><span class="keyword">if</span>(first == <span class="literal">null</span> || startNo &lt; <span class="number">1</span> || startNo &gt; nums) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;å‚æ•°è¾“å…¥é”™è¯¯ï¼Œè¯·é‡å†™è¾“å…¥ï¼š&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ›å»ºè¦ç»™è¾…åŠ©æŒ‡é’ˆï¼Œå¸®åŠ©å®Œæˆå°å­©å‡ºåœˆ</span></span><br><span class="line"><span class="type">Boy</span> <span class="variable">helper</span> <span class="operator">=</span> first;</span><br><span class="line"><span class="comment">//éœ€æ±‚åˆ›å»ºä¸€ä¸ªè¾…åŠ©æŒ‡é’ˆ(å˜é‡) helperï¼Œäº‹å…ˆåº”è¯¥æŒ‡å‘ç¯å½¢é“¾è¡¨çš„æœ€åè¿™ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(helper.getNext() == first) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">helper = helper.getNext();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å°å­©æŠ¥æ•°å‰ï¼Œå…ˆè®©firstå’Œhelperç§»åŠ¨ k - 1æ¬¡</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; startNo - <span class="number">1</span>; j++) &#123;</span><br><span class="line">first = first.getNext();</span><br><span class="line">helper = helper.getNext();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å½“å°å­©æŠ¥æ•°çš„æ—¶å€™ï¼Œè®©firstå’ŒhelperæŒ‡é’ˆåŒæ—¶ç§»åŠ¨ m - 1æ¬¡ï¼Œç„¶åå‡ºåœˆ</span></span><br><span class="line"><span class="comment">//è¿™é‡Œæ˜¯ä¸€ä¸ªå¾ªç¯æ“ä½œï¼ŒçŸ¥é“åœˆä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(helper == first) &#123;</span><br><span class="line"><span class="comment">//è¯´æ˜åœˆä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è®©firstå’ŒhelperæŒ‡é’ˆåŒæ—¶ç§»åŠ¨countNum - 1;</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; countNum -<span class="number">1</span>; j++ ) &#123;</span><br><span class="line">first = first.getNext();</span><br><span class="line">helper = helper.getNext();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¿™æ—¶firstæŒ‡å‘çš„èŠ‚ç‚¹ï¼Œå°±æ˜¯è¦å‡ºåœˆçš„å°å­©èŠ‚ç‚¹</span></span><br><span class="line">System.out.printf(<span class="string">&quot;å°å­©%då‡ºåœˆ\n&quot;</span>,first.getNo());</span><br><span class="line"><span class="comment">//æ­¤æ—¶å°†firstæŒ‡å‘çš„å°å­©èŠ‚ç‚¹å‡ºåœˆ</span></span><br><span class="line">first = first.getNext();</span><br><span class="line">helper.setNext(first); <span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line">System.out.printf(<span class="string">&quot;æœ€åç•™åœ¨åœˆä¸­çš„å°å­©ç¼–å·%d\n&quot;</span>,first.getNo());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Boy</span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> no;<span class="comment">//ç¼–å·</span></span><br><span class="line"><span class="keyword">private</span> Boy next; <span class="comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé»˜è®¤ä¸ºnull</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">Boy</span><span class="params">(<span class="type">int</span> no)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>();</span><br><span class="line"><span class="built_in">this</span>.no = no;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getNo</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> no;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNo</span><span class="params">(<span class="type">int</span> no)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.no = no;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> Boy <span class="title function_">getNext</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNext</span><span class="params">(Boy next)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.next = next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;Boy [no=&quot;</span> + no + <span class="string">&quot;, next=&quot;</span> + next + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-æ ˆ">5.æ ˆ</h2><ol><li><p>æ ˆçš„è‹±æ–‡Stack</p></li><li><p>æ ˆæ˜¯ä¸€ç§<strong>å…ˆå…¥åå‡º</strong>(FILO - First in Last Out)çš„æœ‰åºåˆ—è¡¨</p></li><li><p>æ ˆæ˜¯é™åˆ¶çº¿æ€§è¡¨ä¸­å…ƒç´ çš„æ’å…¥å’Œåˆ é™¤<strong>åªèƒ½åœ¨çº¿æ€§è¡¨çš„åŒä¸€ç«¯</strong>è¿›è¡Œç‰¹æ®Šçº¿æ€§è¡¨ã€‚å…è®¸æ’å…¥å’Œåˆ é™¤çš„ä¸€ç«¯ï¼Œä¸ºå˜åŒ–çš„ä¸€ç«¯ç§°ä¸º<strong>æ ˆé¡¶</strong>ï¼ˆTopï¼‰,å¦ä¸€ç«¯ä¸ºå›ºå®šçš„ä¸€ç«¯ï¼Œç§°ä¸º<strong>æ ˆåº•</strong>ï¼ˆBottomï¼‰;</p></li><li><p>æ ¹æ®æ ˆçš„å®šä¹‰å¯çŸ¥ï¼Œæœ€å…ˆæ”¾å…¥æ ˆä¸­å…ƒç´ åœ¨æ ˆåº•ï¼Œæœ€åæ”¾å…¥çš„å…ƒç´ åœ¨æ ˆé¡¶ï¼Œè€Œåˆ é™¤å…ƒç´ åˆšå¥½ç›¸åï¼Œæœ€åæ”¾å…¥çš„å…ƒç´ æœ€å…ˆåˆ é™¤ï¼Œæœ€åæ”¾å…¥çš„å…ƒç´ æœ€ååˆ é™¤ã€‚</p></li><li><p>å…¥æ ˆ<strong>push</strong>,å‡ºæ ˆ<strong>pop</strong>ã€‚</p><ol><li>å­ç¨‹åºçš„è°ƒç”¨ï¼šåœ¨è·³å¾€å­ç¨‹åºå‰ï¼Œä¼šå…ˆåŠ ä¸ªä¸‹ä¸€ä¸ªæŒ‡ä»¤çš„åœ°å€å­˜æ”¾åˆ°å †æ ˆä¸­ï¼Œç›´åˆ°å­ç¨‹åºæ‰§è¡Œå®Œåå†å°†åœ°å€å–å‡ºï¼Œä»¥å›åˆ°åŸæ¥çš„ç¨‹åºä¸­ã€‚</li><li>å¤„ç†é€’å½’è°ƒç”¨ï¼Œæ‰€è°“é€’å½’ï¼Œå°±æ˜¯æ–¹æ³•è‡ªå·±è°ƒç”¨è‡ªå·±æœ¬èº«ã€‚ä¸å­ç¨‹åºçš„è°ƒç”¨ç±»ä¼¼ï¼Œåªæ˜¯é™¤äº†å­˜å‚¨ä¸‹ä¸€ä¸ªæŒ‡ä»¤çš„åœ°å€å¤–ï¼Œä¹Ÿå°†å‚æ•°ï¼ŒåŒºåŸŸå˜é‡ç­‰æ•°æ®å­˜å…¥å †æ ˆä¸­ã€‚</li><li>è¡¨è¾¾å¼çš„è½¬æ¢[ä¸­ç¼€è¡¨è¾¾å¼è½¬åç¼€è¡¨è¾¾å¼]ä¸æ±‚å€¼ã€‚</li><li>äºŒå‰æ ‘çš„å˜é‡</li><li>å›¾å½¢çš„æ·±åº¦ä¼˜å…ˆ(depth-first)æœç´¢æ³•ã€‚</li></ol></li></ol><h3 id="5-1-æ ˆçš„æ¨¡æ‹Ÿå®ç°">5.1 æ ˆçš„æ¨¡æ‹Ÿå®ç°</h3><p>å®ç°æ ˆçš„æ€è·¯ï¼š</p><ol><li>ä½¿ç”¨æ•°ç»„æ¥æ¨¡æ‹Ÿæ ˆ</li><li>å®šä¹‰ä¸€ä¸ªtopæ¥æ¨¡æ‹Ÿæ ˆé¡¶ï¼Œåˆå§‹åŒ–ä¸º -1ï¼›</li><li>å…¥æ ˆçš„æ“ä½œï¼Œå½“æœ‰æ•°æ®åŠ å…¥æ ˆæ—¶ï¼Œ<code>top++ ; stack[top] = data;</code></li><li>å‡ºæ ˆçš„æ“ä½œï¼Œ<code>int value = stack[top]; top -- ;return value;</code></li></ol><p>åæ­£æœ‰é”™è¯¯ï¼Œbugä¸€ç›´éƒ½æœ‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayStackDemo</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//æµ‹è¯•ä¸€ä¸‹ArrayStackæ˜¯å¦æ­£ç¡®</span></span><br><span class="line"><span class="comment">//å…ˆåˆ›å»ºä¸€ä¸ªArrayStackå¯¹è±¡ï¼Œè¡¨ç¤ºæ ˆ</span></span><br><span class="line"><span class="type">ArrayStack</span> <span class="variable">stack</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayStack</span>(<span class="number">4</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">loop</span> <span class="operator">=</span> <span class="literal">true</span>; <span class="comment">//æ§åˆ¶æ˜¯å¦é€€å‡ºèœå•</span></span><br><span class="line"><span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"><span class="keyword">while</span>(loop) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;showï¼šè¡¨ç¤ºå±•ç¤ºæ ˆ&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;exitï¼šè¡¨ç¤ºé€€å‡ºæ ˆ&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;pushï¼šè¡¨ç¤ºæ·»åŠ æ•°æ®åˆ°æ ˆ&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;popï¼šè¡¨ç¤ºä»æ ˆå–å‡ºæ•°æ®&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;è¯·è¾“å…¥ä½ çš„æ“ä½œ&quot;</span>);</span><br><span class="line">key = sc.next();</span><br><span class="line"><span class="keyword">switch</span>(key) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;show&quot;</span>:</span><br><span class="line">stack.list();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;push&quot;</span>:</span><br><span class="line">System.out.println(<span class="string">&quot;è¯·è¾“å…¥ä¸€ä¸ªæ•°&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> sc.nextInt();</span><br><span class="line">stack.push(value);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;pop&quot;</span>:</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">System.out.printf(<span class="string">&quot;å‡ºæ ˆçš„æ•°æ®æ˜¯%d\n&quot;</span>,res);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">System.out.println(e.getMessage());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;exit&quot;</span>:</span><br><span class="line">sc.close();</span><br><span class="line">loop = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;ç¨‹åºé€€å‡ºäº†&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªArrayStackè¡¨ç¤ºæ ˆ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ArrayStack</span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> maxSize;<span class="comment">//æ ˆçš„å¤§å°</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span>[] stack;<span class="comment">//æ•°ç»„ï¼Œæ•°ç»„æ¨¡æ‹Ÿæ ˆï¼Œæ•°æ®å°±æˆ¿å­è¯¥æ•°ç»„</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">top</span> <span class="operator">=</span>-<span class="number">1</span>; <span class="comment">//topè¡¨ç¤ºæ ˆé¡¶ï¼Œåˆå§‹åŒ–ä¸º-1;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ„é€ å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayStack</span><span class="params">(<span class="type">int</span> maxSize)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.maxSize = maxSize;</span><br><span class="line">stack = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="built_in">this</span>.maxSize];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å †æ»¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> top == maxSize -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ˆç©º</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> top == -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å…¥æ ˆ-push</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line"><span class="comment">//å…ˆåˆ¤æ–­æ ˆæ˜¯å¦æ»¡</span></span><br><span class="line"><span class="keyword">if</span>(isFull()) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;æ ˆæ»¡&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line">top ++;</span><br><span class="line">stack[top] = value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å‡ºæ ˆ-pop,å°†æ ˆé¡¶çš„æ•°æ®è¿›è¡Œè¿”å›</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//å…ˆåˆ¤æ–­æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="keyword">if</span>(isEmpty()) &#123;</span><br><span class="line"><span class="comment">//æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ ˆç©ºï¼Œæ²¡æœ‰æ•°æ®Â·Â·Â·&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> stack[top];</span><br><span class="line">top --;</span><br><span class="line"><span class="keyword">return</span> value;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ˜¾ç¤ºæ ˆçš„æƒ…å†µã€éå†æ ˆã€‘ï¼Œéå†æ˜¯éœ€è¦ä»æ ˆé¡¶å¼€å§‹æ˜¾ç¤ºæ•°æ®</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(isEmpty()) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;æ ˆç©ºï¼Œæ²¡æœ‰æ•°æ®Â·Â·Â·&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//éœ€è¦ä»æ ˆé¡¶å¼€å§‹æ˜¾ç¤ºæ•°æ®</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> top; i &gt;= <span class="number">0</span> ; i--) &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;stack[%d]=%d\n&quot;</span>,i,stack[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-ä½¿ç”¨æ ˆå®ç°è®¡ç®—æœº">5.2 ä½¿ç”¨æ ˆå®ç°è®¡ç®—æœº</h3><p>è¯•é¢˜ï¼š ä½¿ç”¨æ ˆå®Œæˆè¡¨è¾¾å¼7 * 2 * 2 - 5  + 1 - 5 + 3 - 4 =ï¼Ÿ</p><p>æ€è·¯ï¼š</p><ol><li>é€šè¿‡ä¸€ä¸ªindexå€¼(ç´¢å¼•).æ¥å˜é‡æˆ‘ä»¬çš„è¡¨è¾¾å¼</li><li>å¦‚æœæˆ‘ä»¬å‘ç°æ˜¯ä¸€ä¸ªæ•°å­—å°±ç›´æ¥å…¥æ ˆ</li><li>å¦‚æœå‘ç°æ‰«æåˆ°çš„æ˜¯ä¸€ä¸ªç¬¦å·ï¼Œå°±åˆ†å¦‚ä¸‹æƒ…å†µè¿›è¡Œåˆ†æ<ol><li>å¦‚æœå‘ç°å½“å‰ç¬¦å·ä¸ºç©ºï¼Œåˆ™ç›´æ¥å…¥æ ˆ</li><li>å¦‚æœç¬¦å·æ ˆæœ‰æ“ä½œç¬¦ï¼Œå°±è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå½“å‰çš„æ“ä½œç¬¦çš„ä¼˜å…ˆçº§å°äºæˆ–è€…ç­‰äºæ ˆä¸­çš„æ“ä½œç¬¦ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦ä»æ•°æ ˆä¸­popå‡ºä¸¤ä¸ªæ•°ï¼Œåœ¨ä»ç¬¦å·æ ˆä¸­popå‡ºä¸€ä¸ªç¬¦å·ï¼Œè¿›è¡Œè¿ç®—ï¼Œå°†å¾—åˆ°ç»“æœï¼Œå…¥æ•°æ ˆï¼Œç„¶åå°†å½“å‰çš„æ“ä½œç¬¦æ’å…¥ç¬¦å·æ ˆ</li><li>å¦‚æœå½“å‰ç¬¦å·æ ˆä¸­æœ‰æ“ä½œç¬¦ï¼Œå°±è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå½“å‰æ“ä½œç¬¦çš„ä¼˜å…ˆçº§å°äºæˆ–è€…ç­‰äºæ ˆä¸­çš„æ“ä½œç¬¦ï¼Œå°±éœ€è¦ä»æ•°æ ˆä¸­popå‡ºä¸¤ä¸ªæ•°ï¼Œåœ¨ä»ç¬¦å·æ ˆä¸­popä¸€ä¸ªç¬¦å·ï¼Œè¿›è¡Œè¿ç®—ï¼Œå°†å¾—åˆ°ç»“æœï¼Œå…¥æ•°æ ˆï¼Œç„¶åå°†å½“å‰çš„æ“ä½œç¬¦å…¥ç¬¦å·æ ˆï¼Œå¦‚æœå½“å‰çš„æ“ä½œç¬¦çš„ä¼˜å…ˆçº§å¤§äºæ ˆä¸­çš„æ“ä½œç¬¦ï¼Œå°±ç›´æ¥å…¥ç¬¦å·æ ˆã€‚</li></ol></li><li>å½“è¡¨è¾¾å¼æ‰«æå®Œæ¯•ï¼Œå°±é¡ºåºçš„ä»æ•°æ ˆå’Œç¬¦å·æ ˆä¸­popå‡ºç›¸åº”çš„æ•°å’Œç¬¦å·ï¼Œå¹¶è¿è¡Œã€‚</li><li>æœ€ååœ¨æ•°æ ˆåªæœ‰ä¸€ä¸ªæ•°å­ï¼Œå°±æ˜¯è¡¨è¾¾å¼çš„ç»“æœã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Calculator1</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//æ ¹æ®å‰é¢è€å¸ˆæ€è·¯ï¼Œå®Œæˆè¡¨è¾¾å¼çš„è¿ç®—</span></span><br><span class="line"><span class="type">String</span> <span class="variable">expression</span> <span class="operator">=</span> <span class="string">&quot;3-2*1+1&quot;</span>; <span class="comment">// //å¦‚ä½•å¤„ç†å¤šä½æ•°çš„é—®é¢˜ï¼Ÿ</span></span><br><span class="line"><span class="comment">//åˆ›å»ºä¸¤ä¸ªæ ˆï¼Œæ•°æ ˆï¼Œä¸€ä¸ªç¬¦å·æ ˆ</span></span><br><span class="line"><span class="type">ArrayStack2</span> <span class="variable">numStack</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayStack2</span>(<span class="number">10</span>);</span><br><span class="line"><span class="type">ArrayStack2</span> <span class="variable">operStack</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayStack2</span>(<span class="number">10</span>);</span><br><span class="line"><span class="comment">//å®šä¹‰éœ€è¦çš„ç›¸å…³å˜é‡</span></span><br><span class="line"><span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;<span class="comment">//ç”¨äºæ‰«æ</span></span><br><span class="line"><span class="type">int</span> <span class="variable">num1</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">num2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">oper</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">char</span> <span class="variable">ch</span> <span class="operator">=</span> <span class="string">&#x27; &#x27;</span>; <span class="comment">//å°†æ¯æ¬¡æ‰«æå¾—åˆ°charä¿å­˜åˆ°ch</span></span><br><span class="line"><span class="type">String</span> <span class="variable">keepNum</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>; <span class="comment">//ç”¨äºæ‹¼æ¥ å¤šä½æ•°</span></span><br><span class="line"><span class="comment">//å¼€å§‹whileå¾ªç¯çš„æ‰«æexpression</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//ä¾æ¬¡å¾—åˆ°expression çš„æ¯ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line">ch = expression.substring(index, index+<span class="number">1</span>).charAt(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//åˆ¤æ–­chæ˜¯ä»€ä¹ˆï¼Œç„¶ååšç›¸åº”çš„å¤„ç†</span></span><br><span class="line"><span class="keyword">if</span>(operStack.isOper(ch)) &#123;<span class="comment">//å¦‚æœæ˜¯è¿ç®—ç¬¦</span></span><br><span class="line"><span class="comment">//åˆ¤æ–­å½“å‰çš„ç¬¦å·æ ˆæ˜¯å¦ä¸ºç©º</span></span><br><span class="line"><span class="keyword">if</span>(!operStack.isEmpty()) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœç¬¦å·æ ˆæœ‰æ“ä½œç¬¦ï¼Œå°±è¿›è¡Œæ¯”è¾ƒ,å¦‚æœå½“å‰çš„æ“ä½œç¬¦çš„ä¼˜å…ˆçº§å°äºæˆ–è€…ç­‰äºæ ˆä¸­çš„æ“ä½œç¬¦,å°±éœ€è¦ä»æ•°æ ˆä¸­popå‡ºä¸¤ä¸ªæ•°,</span></span><br><span class="line"><span class="comment">//åœ¨ä»ç¬¦å·æ ˆä¸­popå‡ºä¸€ä¸ªç¬¦å·ï¼Œè¿›è¡Œè¿ç®—ï¼Œå°†å¾—åˆ°ç»“æœï¼Œå…¥æ•°æ ˆï¼Œç„¶åå°†å½“å‰çš„æ“ä½œç¬¦å…¥ç¬¦å·æ ˆ</span></span><br><span class="line"><span class="keyword">if</span>(operStack.priority(ch) &lt;= operStack.priority(operStack.peek())) &#123;</span><br><span class="line">num1 = numStack.pop();</span><br><span class="line">num2 = numStack.pop();</span><br><span class="line">oper = operStack.pop();</span><br><span class="line">res = numStack.cal(num1, num2, oper);</span><br><span class="line"><span class="comment">//æŠŠè¿ç®—çš„ç»“æœå¦‚æ•°æ ˆ</span></span><br><span class="line">numStack.push(res);</span><br><span class="line"><span class="comment">//ç„¶åå°†å½“å‰çš„æ“ä½œç¬¦å…¥ç¬¦å·æ ˆ</span></span><br><span class="line">operStack.push(ch);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//å¦‚æœå½“å‰çš„æ“ä½œç¬¦çš„ä¼˜å…ˆçº§å¤§äºæ ˆä¸­çš„æ“ä½œç¬¦ï¼Œ å°±ç›´æ¥å…¥ç¬¦å·æ ˆ.</span></span><br><span class="line">operStack.push(ch);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//å¦‚æœä¸ºç©ºç›´æ¥å…¥ç¬¦å·æ ˆ..</span></span><br><span class="line">operStack.push(ch); <span class="comment">// 1 + 3</span></span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123; <span class="comment">//å¦‚æœæ˜¯æ•°ï¼Œåˆ™ç›´æ¥å…¥æ•°æ ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//numStack.push(ch - 48); //? &quot;1+3&quot; &#x27;1&#x27; =&gt; 1</span></span><br><span class="line"><span class="comment">//åˆ†ææ€è·¯</span></span><br><span class="line"><span class="comment">//1. å½“å¤„ç†å¤šä½æ•°æ—¶ï¼Œä¸èƒ½å‘ç°æ˜¯ä¸€ä¸ªæ•°å°±ç«‹å³å…¥æ ˆï¼Œå› ä¸ºä»–å¯èƒ½æ˜¯å¤šä½æ•°</span></span><br><span class="line"><span class="comment">//2. åœ¨å¤„ç†æ•°ï¼Œéœ€è¦å‘expressionçš„è¡¨è¾¾å¼çš„index åå†çœ‹ä¸€ä½,å¦‚æœæ˜¯æ•°å°±è¿›è¡Œæ‰«æï¼Œå¦‚æœæ˜¯ç¬¦å·æ‰å…¥æ ˆ</span></span><br><span class="line"><span class="comment">//3. å› æ­¤æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªå˜é‡ å­—ç¬¦ä¸²ï¼Œç”¨äºæ‹¼æ¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¤„ç†å¤šä½æ•°</span></span><br><span class="line">keepNum += ch;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¦‚æœchå·²ç»æ˜¯expressionçš„æœ€åä¸€ä½ï¼Œå°±ç›´æ¥å…¥æ ˆ</span></span><br><span class="line"><span class="keyword">if</span> (index == expression.length() - <span class="number">1</span>) &#123;</span><br><span class="line">numStack.push(Integer.parseInt(keepNum));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">//åˆ¤æ–­ä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯ä¸æ˜¯æ•°å­—ï¼Œå¦‚æœæ˜¯æ•°å­—ï¼Œå°±ç»§ç»­æ‰«æï¼Œå¦‚æœæ˜¯è¿ç®—ç¬¦ï¼Œåˆ™å…¥æ ˆ</span></span><br><span class="line"><span class="comment">//æ³¨æ„æ˜¯çœ‹åä¸€ä½ï¼Œä¸æ˜¯index++</span></span><br><span class="line"><span class="keyword">if</span> (operStack.isOper(expression.substring(index+<span class="number">1</span>,index+<span class="number">2</span>).charAt(<span class="number">0</span>))) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœåä¸€ä½æ˜¯è¿ç®—ç¬¦ï¼Œåˆ™å…¥æ ˆ keepNum = &quot;1&quot; æˆ–è€… &quot;123&quot;</span></span><br><span class="line">numStack.push(Integer.parseInt(keepNum));</span><br><span class="line"><span class="comment">//é‡è¦çš„!!!!!!, keepNumæ¸…ç©º</span></span><br><span class="line">keepNum = <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è®©index + 1, å¹¶åˆ¤æ–­æ˜¯å¦æ‰«æåˆ°expressionæœ€å.</span></span><br><span class="line">index++;</span><br><span class="line"><span class="keyword">if</span> (index &gt;= expression.length()) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å½“è¡¨è¾¾å¼æ‰«æå®Œæ¯•ï¼Œå°±é¡ºåºçš„ä» æ•°æ ˆå’Œç¬¦å·æ ˆä¸­popå‡ºç›¸åº”çš„æ•°å’Œç¬¦å·ï¼Œå¹¶è¿è¡Œ.</span></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœç¬¦å·æ ˆä¸ºç©ºï¼Œåˆ™è®¡ç®—åˆ°æœ€åçš„ç»“æœ, æ•°æ ˆä¸­åªæœ‰ä¸€ä¸ªæ•°å­—ã€ç»“æœã€‘</span></span><br><span class="line"><span class="keyword">if</span>(operStack.isEmpty()) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">num1 = numStack.pop();</span><br><span class="line">num2 = numStack.pop();</span><br><span class="line">oper = operStack.pop();</span><br><span class="line">res = numStack.cal(num1, num2, oper);</span><br><span class="line">numStack.push(res);<span class="comment">//å…¥æ ˆ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å°†æ•°æ ˆçš„æœ€åæ•°ï¼Œpopå‡ºï¼Œå°±æ˜¯ç»“æœ</span></span><br><span class="line"><span class="type">int</span> <span class="variable">res2</span> <span class="operator">=</span> numStack.pop();</span><br><span class="line">System.out.printf(<span class="string">&quot;è¡¨è¾¾å¼ %s = %d&quot;</span>, expression, res2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å…ˆåˆ›å»ºä¸€ä¸ªæ ˆ,ç›´æ¥ä½¿ç”¨å‰é¢åˆ›å»ºå¥½</span></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ª ArrayStack2 è¡¨ç¤ºæ ˆ, éœ€è¦æ‰©å±•åŠŸèƒ½</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ArrayStack3</span> &#123;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> maxSize; <span class="comment">// æ ˆçš„å¤§å°</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span>[] stack; <span class="comment">// æ•°ç»„ï¼Œæ•°ç»„æ¨¡æ‹Ÿæ ˆï¼Œæ•°æ®å°±æ”¾åœ¨è¯¥æ•°ç»„</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">top</span> <span class="operator">=</span> -<span class="number">1</span>;<span class="comment">// topè¡¨ç¤ºæ ˆé¡¶ï¼Œåˆå§‹åŒ–ä¸º-1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ„é€ å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ArrayStack3</span><span class="params">(<span class="type">int</span> maxSize)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.maxSize = maxSize;</span><br><span class="line">stack = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="built_in">this</span>.maxSize];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¢åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è¿”å›å½“å‰æ ˆé¡¶çš„å€¼, ä½†æ˜¯ä¸æ˜¯çœŸæ­£çš„pop</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> stack[top];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ˆæ»¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> top == maxSize - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ ˆç©º</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> top == -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å…¥æ ˆ-push</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line"><span class="comment">//å…ˆåˆ¤æ–­æ ˆæ˜¯å¦æ»¡</span></span><br><span class="line"><span class="keyword">if</span>(isFull()) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;æ ˆæ»¡&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">top++;</span><br><span class="line">stack[top] = value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å‡ºæ ˆ-pop, å°†æ ˆé¡¶çš„æ•°æ®è¿”å›</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//å…ˆåˆ¤æ–­æ ˆæ˜¯å¦ç©º</span></span><br><span class="line"><span class="keyword">if</span>(isEmpty()) &#123;</span><br><span class="line"><span class="comment">//æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ ˆç©ºï¼Œæ²¡æœ‰æ•°æ®~&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> stack[top];</span><br><span class="line">top--;</span><br><span class="line"><span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ˜¾ç¤ºæ ˆçš„æƒ…å†µ[éå†æ ˆ]ï¼Œ éå†æ—¶ï¼Œéœ€è¦ä»æ ˆé¡¶å¼€å§‹æ˜¾ç¤ºæ•°æ®</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(isEmpty()) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;æ ˆç©ºï¼Œæ²¡æœ‰æ•°æ®~~&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//éœ€è¦ä»æ ˆé¡¶å¼€å§‹æ˜¾ç¤ºæ•°æ®</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> top; i &gt;= <span class="number">0</span> ; i--) &#123;</span><br><span class="line">System.out.printf(<span class="string">&quot;stack[%d]=%d\n&quot;</span>, i, stack[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¿”å›è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§æ˜¯ç¨‹åºå‘˜æ¥ç¡®å®š, ä¼˜å…ˆçº§ä½¿ç”¨æ•°å­—è¡¨ç¤º</span></span><br><span class="line"><span class="comment">//æ•°å­—è¶Šå¤§ï¼Œåˆ™ä¼˜å…ˆçº§å°±è¶Šé«˜.</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">priority</span><span class="params">(<span class="type">int</span> oper)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(oper == <span class="string">&#x27;*&#x27;</span> || oper == <span class="string">&#x27;/&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (oper == <span class="string">&#x27;+&#x27;</span> || oper == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> -<span class="number">1</span>; <span class="comment">// å‡å®šç›®å‰çš„è¡¨è¾¾å¼åªæœ‰ +, - , * , /</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯ä¸æ˜¯ä¸€ä¸ªè¿ç®—ç¬¦</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isOper</span><span class="params">(<span class="type">char</span> val)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> val == <span class="string">&#x27;+&#x27;</span> || val == <span class="string">&#x27;-&#x27;</span> || val == <span class="string">&#x27;*&#x27;</span> || val == <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è®¡ç®—æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">cal</span><span class="params">(<span class="type">int</span> num1, <span class="type">int</span> num2, <span class="type">int</span> oper)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// res ç”¨äºå­˜æ”¾è®¡ç®—çš„ç»“æœ</span></span><br><span class="line"><span class="keyword">switch</span> (oper) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">res = num1 + num2;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">res = num2 - num1;<span class="comment">// æ³¨æ„é¡ºåº</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">res = num1 * num2;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">res = num2 / num1;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-3-å‰ç¼€ã€ä¸­ç¼€ã€åç¼€è¡¨è¾¾å¼ï¼ˆé€†æ³¢å…°è¡¨è¾¾å¼ï¼‰">5.3 å‰ç¼€ã€ä¸­ç¼€ã€åç¼€è¡¨è¾¾å¼ï¼ˆé€†æ³¢å…°è¡¨è¾¾å¼ï¼‰</h3><p>ä»å³å¾€å·¦æ‰«æè¡¨è¾¾å¼ï¼Œé‡åˆ°æ•°å­æ—¶ï¼Œå°†æ•°å­—å‹å…¥æ ˆä¸­ï¼Œé‡åˆ°è¿ç®—ç¬¦æ—¶ï¼Œå¼¹å‡ºæ ˆé¡¶çš„ä¸¤ä¸ªæ•°ï¼Œç”¨è¿ç®—ç¬¦å¯¹ä»–ä»¬åšç›¸åº”çš„è®¡ç®—ã€‚ä¸€èˆ¬æƒ…å†µä¸­ç¼€è¡¨è¾¾å¼æ˜¯æˆ‘ä»¬äººä¸ºç¡®å®šçš„è¡¨è¾¾å¼ï¼Œä½†æ˜¯è®¡ç®—æœºæ— æ³•è¯†åˆ«ï¼Œæ•…è€Œæˆ‘ä»¬éœ€è¦å°†ä¸­ç¼€è¡¨è¾¾å¼è°ƒæ•´ä¸ºåç¼€è¡¨è¾¾å¼ã€‚</p><p>ä»å·¦åˆ°å³è¡¨è¾¾å¼æœ€å³ç«¯ï¼Œæœ€åè¿ç®—å¾—å‡ºçš„å€¼å³ä¸ºè¡¨è¾¾å¼çš„ç»“æœã€‚</p><blockquote><p>â€‹ * æ€è·¯ï¼š</p><ul><li>1.ä»å·¦åˆ°å³æ‰«æï¼Œå°†3å’Œ4å‹å…¥æ ˆä¸­</li><li>2.é‡åˆ° + è¿ç®—ç¬¦ï¼Œå› æ­¤å¼¹å‡º4å’Œ3(4ä¸ºæ ˆé¡¶å…ƒç´ ï¼Œ3ä¸ºæ¬¡é¡¶å…ƒç´ )ï¼Œè®¡ç®—å‡º3+4çš„å€¼ï¼Œå¾—åˆ°7ï¼Œåœ¨å°†7å‹å…¥æ ˆä¸­</li><li>3.å°†5å…¥æ ˆ</li><li>4.æ¥ä¸‹æ¥æ˜¯<em>è¿ç®—ç¬¦ï¼Œå› æ­¤å¼¹å‡º5å’Œ7ï¼Œè®¡ç®—7</em>5=35ï¼Œå°†35å…¥æ ˆã€‚</li><li>5.å°†6å…¥æ ˆ</li><li>6.æœ€åæ˜¯ - è¿ç®—ç¬¦ï¼Œè®¡ç®—å‡º35 -6 çš„å€¼ï¼Œå³29ï¼Œç”±æ­¤å¾—å‡ºæœ€ç»ˆç»“æœ</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> class é€†æ³¢å…°è¡¨è¾¾å¼ &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//å…ˆå®šä¹‰ç»™é€†æ³¢å…°è¡¨è¾¾å¼</span></span><br><span class="line"><span class="comment">//(3+4)*5-6 =&gt; 3 4 + 5 * 6 -</span></span><br><span class="line"><span class="comment">//è¯´æ˜ä¸ºäº†æ–¹ä¾¿ï¼Œé€†æ³¢å…°è¡¨è¾¾å¼çš„æ•°å­—å’Œç¬¦å·ä½¿ç”¨ç©ºæ ¼éš”å¼€</span></span><br><span class="line"><span class="type">String</span> <span class="variable">suffixExpression</span> <span class="operator">=</span> <span class="string">&quot;15 4 + 5 * 6 -&quot;</span>;</span><br><span class="line"><span class="comment">//æ€è·¯</span></span><br><span class="line"><span class="comment">// 1. å…ˆå°† 3 4 + 5 * 6 -  =&gt; æ”¾åˆ°ArrayListä¸­</span></span><br><span class="line"><span class="comment">// 2 å°† ArrayList ä¼ é€’ç»™ä¸€ä¸ªæ–¹æ³•ï¼Œéå†ArrayList é…åˆæ ˆå®Œæˆè®¡ç®—</span></span><br><span class="line">List&lt;String&gt; rpnList = getListString(suffixExpression);</span><br><span class="line">System.out.println(<span class="string">&quot;é€†æ³¢å…°è¡¨è¾¾å¼ï¼š&quot;</span> + rpnList);</span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> calculate(rpnList);</span><br><span class="line">System.out.println(<span class="string">&quot;è®¡ç®—çš„ç»“æœä¸ºï¼š&quot;</span> + res);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å°†ä¸€ä¸ªé€†æ³¢å…°è¡¨è¾¾å¼ï¼Œä¾æ¬¡å°†æ•°æ®å’Œè¿ç®—ç¬¦æ”¾åˆ°ArrayListä¸­</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">getListString</span><span class="params">(String suffixExpression)</span>&#123;</span><br><span class="line"><span class="comment">//å°†suffixExpression åˆ†å‰²</span></span><br><span class="line">String [] split = suffixExpression.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line"><span class="keyword">for</span>(String ele : split) &#123;</span><br><span class="line">list.add(ele);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å®Œæˆå¯¹é€†æ³¢å…°è¡¨è¾¾å¼çš„è¿ç®—ã€‚</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ€è·¯ï¼š</span></span><br><span class="line"><span class="comment"> * 1.ä»å·¦åˆ°å³æ‰«æï¼Œå°†3å’Œ4å‹å…¥æ ˆä¸­</span></span><br><span class="line"><span class="comment"> * 2.é‡åˆ° + è¿ç®—ç¬¦ï¼Œå› æ­¤å¼¹å‡º4å’Œ3(4ä¸ºæ ˆé¡¶å…ƒç´ ï¼Œ3ä¸ºæ¬¡é¡¶å…ƒç´ )ï¼Œè®¡ç®—å‡º3+4çš„å€¼ï¼Œå¾—åˆ°7ï¼Œåœ¨å°†7å‹å…¥æ ˆä¸­</span></span><br><span class="line"><span class="comment"> * 3.å°†5å…¥æ ˆ</span></span><br><span class="line"><span class="comment"> * 4.æ¥ä¸‹æ¥æ˜¯*è¿ç®—ç¬¦ï¼Œå› æ­¤å¼¹å‡º5å’Œ7ï¼Œè®¡ç®—7*5=35ï¼Œå°†35å…¥æ ˆã€‚</span></span><br><span class="line"><span class="comment"> * 5.å°†6å…¥æ ˆ</span></span><br><span class="line"><span class="comment"> * 6.æœ€åæ˜¯ - è¿ç®—ç¬¦ï¼Œè®¡ç®—å‡º35 -6 çš„å€¼ï¼Œå³29ï¼Œç”±æ­¤å¾—å‡ºæœ€ç»ˆç»“æœ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">calculate</span><span class="params">(List&lt;String&gt; ls)</span> &#123;</span><br><span class="line"><span class="comment">//åˆ›å»ºç»™æ ˆï¼Œåªéœ€è¦ä¸€ä¸ªæ ˆå³å¯</span></span><br><span class="line">Stack&lt;String&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line"><span class="comment">//éå† ls</span></span><br><span class="line"><span class="keyword">for</span>(String item : ls) &#123;</span><br><span class="line"><span class="comment">//è¿™é‡Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥è¯»å–æ•°</span></span><br><span class="line"><span class="keyword">if</span>(item.matches(<span class="string">&quot;\\d+&quot;</span>)) &#123; <span class="comment">//åŒ¹é…çš„æ˜¯å¤šä½æ•°</span></span><br><span class="line"><span class="comment">//å…¥æ ˆ</span></span><br><span class="line">stack.push(item);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//popå‡ºä¸¤ä½æ•°ï¼Œå¹¶è¿ç®—ï¼Œå†å…¥æ ˆ</span></span><br><span class="line"><span class="type">int</span> <span class="variable">num2</span> <span class="operator">=</span> Integer.parseInt(stack.pop());</span><br><span class="line"><span class="type">int</span> <span class="variable">num1</span> <span class="operator">=</span> Integer.parseInt(stack.pop());</span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(item.equals(<span class="string">&quot;+&quot;</span>)) &#123;</span><br><span class="line">res = num1 + num2;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.equals(<span class="string">&quot;-&quot;</span>)) &#123;</span><br><span class="line">res = num1 - num2;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.equals(<span class="string">&quot;*&quot;</span>)) &#123;</span><br><span class="line">res = num1 * num2;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.equals(<span class="string">&quot;/&quot;</span>)) &#123;</span><br><span class="line">res = num1 / num2;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;è¿ç®—ç¬¦æœ‰è¯¯&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æŠŠreså…¥æ ˆ</span></span><br><span class="line">stack.push(<span class="string">&quot;&quot;</span> + res);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æœ€åç•™åœ¨stackä¸­çš„æ•°æ®æ˜¯è¿ç®—ç»“æœ</span></span><br><span class="line"><span class="keyword">return</span> Integer.parseInt(stack.pop());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5-4-ä¸­ç¼€è¡¨è¾¾å¼è½¬æ¢ä¸ºåç¼€è¡¨è¾¾å¼">5.4 ä¸­ç¼€è¡¨è¾¾å¼è½¬æ¢ä¸ºåç¼€è¡¨è¾¾å¼</h3><p>å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸­ç¼€è¡¨è¾¾å¼è½¬æ¢ä¸ºåç¼€è¡¨è¾¾å¼</p><p>ä¸­ç¼€è¡¨è¾¾å¼è½¬åç¼€è¡¨è¾¾å¼çš„æ€è·¯æ­¥éª¤</p><ol><li>åˆå§‹åŒ–ä¸¤ä¸ªæ ˆï¼Œè¿ç®—ç¬¦s1å’Œå­˜å‚¨ä¸­é—´ç»“æœçš„æ ˆs2</li><li>ä»å·¦åˆ°å³æ‰«æä¸­ç¼€è¡¨è¾¾å¼ï¼›</li><li>é‡åˆ°æ“ä½œè¿ç®—ç¬¦æ—¶ï¼Œå°†å…¶å‹s2;</li><li>é‡åˆ°è¿ç®—ç¬¦æ—¶ï¼Œæ¯”è¾ƒå…¶ä¸s1æ ˆé¡¶è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§<ol><li>å¦‚æœs1ä¸ºç©ºï¼Œæˆ–æ ˆé¡¶è¿ç®—ç¬¦ä¸ºå·¦æ‹¬å·â€œ(â€ï¼Œåˆ™ç›´æ¥å°†æ¬¡è¿ç®—ç¬¦å…¥æ ˆï¼›</li><li>å¦åˆ™ï¼Œè‹¥ä¼˜å…ˆçº§æ¯”æ ˆé¡¶è¿ç®—ç¬¦çš„é«˜ï¼Œä¹Ÿå°†è¿ç®—ç¬¦å‹å…¥s1</li><li>å¦åˆ™å°†s1æ ˆé¡¶çš„è¿ç®—ç¬¦å¼¹å‡ºå¹¶å‹å…¥åˆ°s2ä¸­ï¼Œå†æ¬¡è½¬åˆ°ï¼ˆ4-1ï¼‰ä¸s1ä¸­æ–°çš„æ ˆé¡¶è¿ç®—ç¬¦ç›¸æ¯”è¾ƒï¼›</li></ol></li><li>é‡åˆ°æ‹¬å·<ol><li>å¦‚æœæ˜¯å·¦æ‹¬å·â€œï¼ˆâ€,åˆ™ç›´æ¥å‹å…¥s1</li><li>å¦‚æœæ˜¯å³æ‹¬å·â€œï¼‰â€,åˆ™ä¾æ¬¡å¼¹å‡ºs1æ ˆé¡¶çš„è¿ç®—ç¬¦ï¼Œå¹¶å‹å…¥s2ï¼Œç›´åˆ°é‡åˆ°å·¦æ‹¬å·ä¸ºæ­¢ï¼Œæ­¤æ—¶å°†è¿™ä¸€å¯¹æ‹¬å·ä¸¢å¼ƒã€‚</li></ol></li><li>é‡å¤æ­¥éª¤2è‡³5ï¼Œç›´åˆ°è¡¨è¾¾å¼çš„æœ€å³è¾¹</li><li>å°†s1ä¸­å‰©ä½™çš„è¿ç®—ç¬¦ä¾æ¬¡å¼¹å‡ºå¹¶å‹å…¥s2</li><li>ä¾æ¬¡å¼¹å‡ºs2ä¸­å…ƒç´ å¹¶è¾“å‡ºï¼Œç»“æœçš„é€†åºå³ä¸ºä¸­ç¼€è¡¨è¾¾å¼å¯¹åº”çš„åç¼€è¡¨è¾¾å¼ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> class é€†æ³¢å…°è¡¨è¾¾å¼ &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å…ˆå®šä¹‰ç»™é€†æ³¢å…°è¡¨è¾¾å¼</span></span><br><span class="line"><span class="comment">//(3+4)*5-6 =&gt; 3 4 + 5 * 6 -</span></span><br><span class="line"><span class="comment">//è¯´æ˜ä¸ºäº†æ–¹ä¾¿ï¼Œé€†æ³¢å…°è¡¨è¾¾å¼çš„æ•°å­—å’Œç¬¦å·ä½¿ç”¨ç©ºæ ¼éš”å¼€</span></span><br><span class="line"><span class="type">String</span> <span class="variable">suffixExpression</span> <span class="operator">=</span> <span class="string">&quot;15 4 + 5 * 6 -&quot;</span>;</span><br><span class="line"><span class="comment">//æ€è·¯</span></span><br><span class="line"><span class="comment">// 1. å…ˆå°† 3 4 + 5 * 6 -  =&gt; æ”¾åˆ°ArrayListä¸­</span></span><br><span class="line"><span class="comment">// 2 å°† ArrayList ä¼ é€’ç»™ä¸€ä¸ªæ–¹æ³•ï¼Œéå†ArrayList é…åˆæ ˆå®Œæˆè®¡ç®—</span></span><br><span class="line"></span><br><span class="line">List&lt;String&gt; rpnList = getListString(suffixExpression);</span><br><span class="line">System.out.println(<span class="string">&quot;é€†æ³¢å…°è¡¨è¾¾å¼ï¼š&quot;</span> + rpnList);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> calculate(rpnList);</span><br><span class="line">System.out.println(<span class="string">&quot;è®¡ç®—çš„ç»“æœä¸ºï¼š&quot;</span> + res);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;=========================ä»¥ä¸Šæ˜¯ä¸­ç¼€è¡¨è¾¾å¼====================&quot;</span>);</span><br><span class="line"><span class="comment">//æ­¤æ—¶æˆ‘ä»¬å®Œæˆä¸€ä¸ªä¸­ç¼€è¡¨è¾¾å¼è½¬æˆåç¼€è¡¨è¾¾å¼çš„åŠŸèƒ½</span></span><br><span class="line"><span class="comment">//è¯´æ˜</span></span><br><span class="line"><span class="comment">//1.  1+((2+3)*4)-5 =&gt; 1 2 3 + 4 * + 5 -</span></span><br><span class="line"><span class="comment">//2 å› ä¸ºç›´æ¥å¯¹strè¿›è¡Œæ“ä½œï¼Œä¸æ–¹ä¾¿ï¼Œå› æ­¤å°†1+((2+3)*4)-5 ä¸­ç¼€è¡¨è¾¾å¼è½¬æ¢ä¸ºå¯¹åº”çš„List</span></span><br><span class="line"><span class="comment">// å³&quot;1+((2+3)*4)-5&quot; =&gt; ArrayList[1,+,(,(,2,+,3),*,4),-,5]</span></span><br><span class="line"><span class="comment">//3 å°† å¾—åˆ°çš„ä¸­ç¼€è¡¨è¾¾å¼å¯¹åº”çš„List =&gt;åç¼€è¡¨è¾¾å¼å¯¹åº”çš„List</span></span><br><span class="line"><span class="comment">//å³ArrayList[1, +, (, (, 2, +, 3, ), *, 4, ), -, 5]=&gt;ArrayList[1,2,3,+,4,*,+,5,-]</span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">experssion</span> <span class="operator">=</span> <span class="string">&quot;1+((2+3)*4)-5&quot;</span>;</span><br><span class="line">List&lt;String&gt; infixExpressionList = toInfixExpressionList(experssion);</span><br><span class="line">System.out.println(<span class="string">&quot;ä¸­ç¼€è¡¨è¾¾å¼å¯¹åº”çš„List &quot;</span> + infixExpressionList);</span><br><span class="line">List&lt;String&gt; parseSuffixExpressionList = parseSuffixExpressionList(infixExpressionList);</span><br><span class="line">System.out.println(<span class="string">&quot;åç¼€è¡¨è¾¾å¼å¯¹åº”çš„List&quot;</span> + parseSuffixExpressionList);</span><br><span class="line"></span><br><span class="line">System.out.printf(<span class="string">&quot;expression=%d&quot;</span>,calculate(parseSuffixExpressionList));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å°† å¾—åˆ°çš„ä¸­ç¼€è¡¨è¾¾å¼å¯¹åº”çš„List =&gt;åç¼€è¡¨è¾¾å¼å¯¹åº”çš„List</span></span><br><span class="line"><span class="comment">//å³ArrayList[1, +, (, (, 2, +, 3, ), *, 4, ), -, 5]=&gt;ArrayList[1,2,3,+,4,*,+,5,-]</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">parseSuffixExpressionList</span><span class="params">(List&lt;String&gt; ls)</span>&#123;</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸¤ä¸ªæ ˆ</span></span><br><span class="line">Stack&lt;String&gt; s1 = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;String&gt;(); <span class="comment">//ç¬¦å·æ ˆ</span></span><br><span class="line"><span class="comment">//è¯´æ˜ï¼šå› ä¸ºs2è¿™ä¸ªæ ˆï¼Œåœ¨æ•´ä¸ªè½¬æ¢è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰pop()æ“ä½œï¼Œåé¢æˆ‘ä»¬è¿˜éœ€è¦é€†åºæ’åº</span></span><br><span class="line"><span class="comment">//å› æ­¤è¿™æ ·æ¯”è¾ƒéº»çƒ¦ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±ä¸åŒStack&lt;String&gt; ç›´æ¥ä½¿ç”¨List&lt;String&gt; s2</span></span><br><span class="line"><span class="comment">//Stack&lt;String&gt; s2  = new Stack&lt;String&gt;();//å­˜å‚¨ä¸­é—´ç»“æœçš„æ ˆS2</span></span><br><span class="line">List&lt;String&gt; s2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();<span class="comment">//å­˜å‚¨ä¸­é—´ç»“æœçš„List2</span></span><br><span class="line"><span class="comment">//éå†ls</span></span><br><span class="line"><span class="keyword">for</span>(String item : ls) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœæ˜¯ä¸€ä¸ªæ•°ï¼ŒåŠ å…¥s2</span></span><br><span class="line"><span class="keyword">if</span>(item.matches(<span class="string">&quot;\\d+&quot;</span>)) &#123;</span><br><span class="line">s2.add(item);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.equals(<span class="string">&quot;(&quot;</span>)) &#123;</span><br><span class="line">s1.push(item);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.equals(<span class="string">&quot;)&quot;</span>)) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœæ˜¯å³æ‹¬å·&quot;)&quot;ï¼Œåˆ™ä¾æ¬¡å¼¹å‡ºs1æ ˆé¡¶çš„è¿ç®—ç¬¦ï¼Œå¹¶å‹å…¥s2,ç›´åˆ°é‡åˆ°å·¦æ‹¬å·ä¸ºæ­¢ï¼Œæ­¤æ—¶å°†è¿™ä¸€å¯¹æ‹¬å·ä¸¢å¼ƒ</span></span><br><span class="line"><span class="keyword">while</span>(!s1.peek().equals(<span class="string">&quot;(&quot;</span>)) &#123;</span><br><span class="line">s2.add(s1.pop());</span><br><span class="line">&#125;</span><br><span class="line">s1.pop();  <span class="comment">//å°†ï¼ˆå¼¹å‡ºs1æ ˆï¼Œæ¶ˆé™¤å°æ‹¬å·</span></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//å½“itemçš„ä¼˜å…ˆçº§å°äºæ ˆé¡¶è¿ç®—ç¬¦ï¼Œå°†s1æ ˆé¡¶çš„è¿ç®—ç¬¦å¼¹å‡ºå¹¶åŠ å…¥åˆ°s2ä¸­ï¼Œå†æ¬¡è½¬åˆ°ï¼ˆ4.1ï¼‰ä¸s1ä¸­æ–°çš„æ ˆé¡¶è¿ç®—ç¬¦ç›¸æ¯”è¾ƒ</span></span><br><span class="line"><span class="keyword">while</span>(s1.size() != <span class="number">0</span> &amp;&amp; Operation.getValue(s1.peek()) &gt;= Operation.getValue(item)) &#123;</span><br><span class="line">s2.add(s1.pop());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¿˜éœ€è¦å°†itemå‹å…¥æ ˆ</span></span><br><span class="line">s1.push(item);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å°†s1ä¸­å‰©ä½™çš„è¿ç®—ç¬¦ä¾æ¬¡å¼¹å‡ºå¹¶åŠ å…¥s2</span></span><br><span class="line"><span class="keyword">while</span>(s1.size() != <span class="number">0</span>) &#123;</span><br><span class="line">s2.add(s1.pop());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s2;  <span class="comment">//æ³¨æ„æ˜¯å› ä¸ºå­˜æ”¾åˆ°Listï¼Œå› æ­¤æŒ‰é¡ºåºè¾“å‡º</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–¹æ³•ï¼šå°†ä¸­ç¼€è¡¨è¾¾å¼è½¬æ¢ä¸ºå¯¹åº”çš„List</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> s</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">toInfixExpressionList</span><span class="params">(String s)</span>&#123;</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªList,å­˜æ”¾ä¸­ç¼€è¡¨è¾¾å¼ å¯¹åº”çš„å†…å®¹</span></span><br><span class="line">List&lt;String&gt; ls = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//è¿™ä¸ªæ˜¯ä¸ªæŒ‡é’ˆï¼Œç”¨äºéå†ä¸­ç¼€è¡¨è¾¾å¼å­—ç¬¦ä¸²</span></span><br><span class="line">String str;<span class="comment">//å¯¹å¤šä½æ•°çš„æ‹¼æ¥åˆ°ä¸€ä¸ªå­—ç¬¦ï¼Œå°±æ”¾å…¥åˆ°c</span></span><br><span class="line"><span class="type">char</span> c; <span class="comment">//æ¯éå†åˆ°ä¸€ä¸ªå­—ç¬¦ï¼Œå°±æ”¾å…¥åˆ°c</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line"><span class="comment">//å¦‚æœcæ˜¯ä¸€ä¸ªéæ•°å­—ï¼Œåˆ™éœ€è¦åŠ å…¥çš„lsä¸­</span></span><br><span class="line"><span class="keyword">if</span>((c=s.charAt(i)) &lt; <span class="number">48</span> || (c=s.charAt(i))&gt; <span class="number">57</span>)&#123;</span><br><span class="line">ls.add(<span class="string">&quot;&quot;</span>+c );</span><br><span class="line">i++;<span class="comment">//iéœ€è¦åç§»</span></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//å¦‚æœæ˜¯ä¸€ä¸ªæ•°ï¼Œéœ€è¦è€ƒè™‘å¤šä½æ•°é—®é¢˜</span></span><br><span class="line">str = <span class="string">&quot;&quot;</span>;<span class="comment">//å…ˆå°†strç½®æˆ&quot;&quot; &#x27;0&#x27;[48]-&gt; &#x27;9&#x27;[57]</span></span><br><span class="line"><span class="keyword">while</span>(i &lt; s.length() &amp;&amp; (c=s.charAt(i)) &gt;= <span class="number">48</span> &amp;&amp; (c=s.charAt(i)) &lt;= <span class="number">57</span>) &#123;</span><br><span class="line">str += c; <span class="comment">//æ‹¼æ¥</span></span><br><span class="line">i++;</span><br><span class="line">&#125;</span><br><span class="line">ls.add(str);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">while</span>(i &lt; s.length());</span><br><span class="line"><span class="keyword">return</span> ls;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†ä¸€ä¸ªé€†æ³¢å…°è¡¨è¾¾å¼ï¼Œä¾æ¬¡å°†æ•°æ®å’Œè¿ç®—ç¬¦æ”¾åˆ°ArrayListä¸­</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title function_">getListString</span><span class="params">(String suffixExpression)</span>&#123;</span><br><span class="line"><span class="comment">//å°†suffixExpression åˆ†å‰²</span></span><br><span class="line">String [] split = suffixExpression.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line"><span class="keyword">for</span>(String ele : split) &#123;</span><br><span class="line">list.add(ele);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®Œæˆå¯¹é€†æ³¢å…°è¡¨è¾¾å¼çš„è¿ç®—ã€‚</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ€è·¯ï¼š</span></span><br><span class="line"><span class="comment"> * 1.ä»å·¦åˆ°å³æ‰«æï¼Œå°†3å’Œ4å‹å…¥æ ˆä¸­</span></span><br><span class="line"><span class="comment"> * 2.é‡åˆ° + è¿ç®—ç¬¦ï¼Œå› æ­¤å¼¹å‡º4å’Œ3(4ä¸ºæ ˆé¡¶å…ƒç´ ï¼Œ3ä¸ºæ¬¡é¡¶å…ƒç´ )ï¼Œè®¡ç®—å‡º3+4çš„å€¼ï¼Œå¾—åˆ°7ï¼Œåœ¨å°†7å‹å…¥æ ˆä¸­</span></span><br><span class="line"><span class="comment"> * 3.å°†5å…¥æ ˆ</span></span><br><span class="line"><span class="comment"> * 4.æ¥ä¸‹æ¥æ˜¯*è¿ç®—ç¬¦ï¼Œå› æ­¤å¼¹å‡º5å’Œ7ï¼Œè®¡ç®—7*5=35ï¼Œå°†35å…¥æ ˆã€‚</span></span><br><span class="line"><span class="comment"> * 5.å°†6å…¥æ ˆ</span></span><br><span class="line"><span class="comment"> * 6.æœ€åæ˜¯ - è¿ç®—ç¬¦ï¼Œè®¡ç®—å‡º35 -6 çš„å€¼ï¼Œå³29ï¼Œç”±æ­¤å¾—å‡ºæœ€ç»ˆç»“æœ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">calculate</span><span class="params">(List&lt;String&gt; ls)</span> &#123;</span><br><span class="line"><span class="comment">//åˆ›å»ºç»™æ ˆï¼Œåªéœ€è¦ä¸€ä¸ªæ ˆå³å¯</span></span><br><span class="line">Stack&lt;String&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line"><span class="comment">//éå† ls</span></span><br><span class="line"><span class="keyword">for</span>(String item : ls) &#123;</span><br><span class="line"><span class="comment">//è¿™é‡Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥è¯»å–æ•°</span></span><br><span class="line"><span class="keyword">if</span>(item.matches(<span class="string">&quot;\\d+&quot;</span>)) &#123; <span class="comment">//åŒ¹é…çš„æ˜¯å¤šä½æ•°</span></span><br><span class="line"><span class="comment">//å…¥æ ˆ</span></span><br><span class="line">stack.push(item);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//popå‡ºä¸¤ä½æ•°ï¼Œå¹¶è¿ç®—ï¼Œå†å…¥æ ˆ</span></span><br><span class="line"><span class="type">int</span> <span class="variable">num2</span> <span class="operator">=</span> Integer.parseInt(stack.pop());</span><br><span class="line"><span class="type">int</span> <span class="variable">num1</span> <span class="operator">=</span> Integer.parseInt(stack.pop());</span><br><span class="line"><span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(item.equals(<span class="string">&quot;+&quot;</span>)) &#123;</span><br><span class="line">res = num1 + num2;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.equals(<span class="string">&quot;-&quot;</span>)) &#123;</span><br><span class="line">res = num1 - num2;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.equals(<span class="string">&quot;*&quot;</span>)) &#123;</span><br><span class="line">res = num1 * num2;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.equals(<span class="string">&quot;/&quot;</span>)) &#123;</span><br><span class="line">res = num1 / num2;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;è¿ç®—ç¬¦æœ‰è¯¯&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æŠŠreså…¥æ ˆ</span></span><br><span class="line">stack.push(<span class="string">&quot;&quot;</span> + res);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æœ€åç•™åœ¨stackä¸­çš„æ•°æ®æ˜¯è¿ç®—ç»“æœ</span></span><br><span class="line"><span class="keyword">return</span> Integer.parseInt(stack.pop());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–å†™ä¸€ä¸ªç±»æ¥è¿”å›ä¸€ä¸ªè¿ç®—ç¬¦å¯¹åº”çš„ä¼˜å…ˆçº§</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Operation</span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">ADD</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">SUB</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MUL</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">DIV</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å†™ä¸€ä¸ªæ–¹æ³•ï¼Œè¿”å›å¯¹åº”çš„ä¼˜å…ˆçº§æ•°å­—</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">(String operation)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span>  <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span>(operation) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;+&quot;</span>:</span><br><span class="line">result = ADD;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;-&quot;</span>:</span><br><span class="line">result = SUB;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;*&quot;</span>:</span><br><span class="line">result = MUL;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;/&quot;</span>:</span><br><span class="line">result = DIV;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">System.out.println(<span class="string">&quot;ä¸å­˜åœ¨è¯¥è¿ç®—ç¬¦&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-é€’å½’">6.é€’å½’</h2><ol><li><p>é€’å½’å°±æ˜¯æ–¹æ³•è‡ªå·±è°ƒç”¨è‡ªå·±</p></li><li><p>é€’å½’è°ƒç”¨è§„åˆ™ï¼š</p><ol><li>å½“ç¨‹åºæ‰§è¡Œåˆ°ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå°±ä¼šå¼€è¾Ÿä¸€ä¸ªç‹¬ç«‹çš„ç©ºé—´ï¼ˆæ ˆï¼‰</li><li>æ–¹æ³•çš„å±€éƒ¨å˜é‡æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šç›¸äº’å½±å“ï¼Œæ¯”å¦‚nå˜é‡</li><li>å¦‚æœæ–¹æ³•ä¸­ä½¿ç”¨çš„æ˜¯å¼•ç”¨ç±»å‹å˜é‡(æ¯”å¦‚è¯´æ•°ç»„)ï¼Œå°±ä¼šå…±äº«è¯¥å¼•ç”¨ç±»å‹çš„æ•°æ®</li><li>é€’å½’å¿…é¡»å‘é€€å‡ºé€’å½’çš„æ¡ä»¶é€¼è¿‘ï¼Œå¦åˆ™å°±æ˜¯æ— é™é€’å½’ï¼Œå‡ºç°æ ˆæº¢å‡ºä¹Ÿå°±æ˜¯<code>StackOverFlowError</code>ã€‚</li><li>å½“ä¸€ä¸ªæ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œæˆ–è€…é‡åˆ°return,å°±ä¼šè¿”å›ï¼Œéµå¾ªè°è°ƒç”¨ï¼Œå°±å°†ç»“æœè¿”å›ç»™è°ï¼ŒåŒæ—¶å½“æ–¹æ³•æ‰§è¡Œå®Œæ¯•åè¿”å›æ—¶ï¼Œè¯¥æ–¹æ³•ä¹Ÿå°±æ‰§è¡Œå®Œæ¯•ã€‚</li></ol></li></ol><h3 id="6-1-ä½¿ç”¨é€’å½’è§£å†³è¿·å®«é—®é¢˜ï¼š">6.1 ä½¿ç”¨é€’å½’è§£å†³è¿·å®«é—®é¢˜ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MiGong</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªäºŒç»´æ•°ç»„æ¨¡æ‹Ÿè¿·å®«</span></span><br><span class="line"><span class="comment">//åœ°å›¾</span></span><br><span class="line"><span class="type">int</span> [][] map = <span class="keyword">new</span> <span class="title class_">int</span> [<span class="number">8</span>][<span class="number">7</span>];</span><br><span class="line"><span class="comment">//ä½¿ç”¨1è¡¨ç¤ºå¢™</span></span><br><span class="line"><span class="comment">//ä¸Šä¸‹å…¨æ˜¯å¢™å£</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">7</span>; i++) &#123;</span><br><span class="line">map[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">map[<span class="number">7</span>][i] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å·¦å³å…¨æ˜¯å¢™å£</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">8</span>; i++ ) &#123;</span><br><span class="line">map[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">map[i][<span class="number">6</span>] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">map[<span class="number">3</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">map[<span class="number">3</span>][<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¾“å‡ºåœ°å›¾</span></span><br><span class="line">System.out.println(<span class="string">&quot;å½“å‰åœ°å›¾ä¸ºï¼š&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">8</span> ; i ++) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span> ;j &lt; <span class="number">7</span>; j++) &#123;</span><br><span class="line">System.out.print(map[i][j] + <span class="string">&quot; &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">//ä½¿ç”¨é€’å½’å›æº¯ç»™å°çƒæ‰¾è·¯</span></span><br><span class="line"><span class="comment">setWay(map, 1, 1);</span></span><br><span class="line"><span class="comment">//è¾“å‡ºåœ°å›¾</span></span><br><span class="line"><span class="comment">System.out.println(&quot;å°çƒèµ°è¿‡ï¼Œå¹¶æ ‡è¯†ï¼š&quot;);</span></span><br><span class="line"><span class="comment">//è¾“å‡ºæ–°çš„åœ°å›¾ï¼Œå°çƒèµ°è¿‡ï¼Œå¹¶æ ‡è¯†</span></span><br><span class="line"><span class="comment">for(int i = 0; i &lt; 8 ; i ++) &#123;</span></span><br><span class="line"><span class="comment">for(int j = 0 ;j &lt; 7; j++) &#123;</span></span><br><span class="line"><span class="comment">System.out.print(map[i][j] + &quot; &quot;);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println();</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨é€’å½’å›æº¯ç»™å°çƒæ‰¾è·¯</span></span><br><span class="line">setWay1(map, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="comment">//è¾“å‡ºåœ°å›¾</span></span><br><span class="line">System.out.println(<span class="string">&quot;å°çƒæ”¹å˜æ–¹å¼ï¼Œå¹¶æ ‡è¯†ï¼š&quot;</span>);</span><br><span class="line"><span class="comment">//è¾“å‡ºæ–°çš„åœ°å›¾ï¼Œå°çƒèµ°è¿‡ï¼Œå¹¶æ ‡è¯†</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">8</span> ; i ++) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span> ;j &lt; <span class="number">7</span>; j++) &#123;</span><br><span class="line">System.out.print(map[i][j] + <span class="string">&quot; &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨é€’å½’å›æº¯æ¥ç»™å°çƒæ‰¾è·¯</span></span><br><span class="line"><span class="comment">//è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">//1.å¦‚æœå°çƒèƒ½åˆ°map[6][5]çš„ä½ç½®è¯´æ˜é€šè·¯æ‰¾åˆ°äº†ã€‚</span></span><br><span class="line"><span class="comment">//å½“map[i][j]ä¸º0è¯´æ˜è¯¥ç‚¹æ²¡æœ‰èµ°è¿‡   å½“ä¸º1ï¼Œè¡¨ç¤ºå¢™;2 è¡¨ç¤ºé€šè·¯å¯ä»¥èµ°ï¼Œ3è¡¨ç¤ºè¯¥ä½ç½®ä»¥åŠèµ°è¿‡ï¼Œä½†æ˜¯èµ°ä¸é€š</span></span><br><span class="line"><span class="comment">//åœ¨èµ°è¿·å®«çš„æ—¶å€™ï¼Œéœ€è¦ç¡®å®šä¸€ä¸ªç­–ç•¥(æ–¹æ³•)ä¸‹ -&gt;å³ -&gt;ä¸Š-&gt;å·¦è¾¹ï¼Œå¦‚æœæ”¹ç‚¹èµ°ä¸é€šï¼Œåœ¨å›æº¯</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> map è¡¨ç¤ºä¼ å¦‚çš„åœ°å›¾</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> i è¡¨ç¤ºä»å“ªä¸ªä½ç½®å¼€å§‹æ‰¾ï¼Œè¡¨ç¤ºæ¨ªåæ ‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> j è¡¨ç¤ºåæ ‡ï¼Œè¡¨ç¤ºçºµåæ ‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> å¦‚æœæ‰¾åˆ°é€šè·¯ï¼Œå°±è¿”å›ä¸ºtrueï¼Œå¦åˆ™è¿”å›false</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">setWay</span><span class="params">(<span class="type">int</span> [][] map,<span class="type">int</span> i , <span class="type">int</span> j)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(map[<span class="number">6</span>][<span class="number">5</span>] == <span class="number">2</span>) &#123; <span class="comment">//é€šè·¯å·²ç»æ‰¾åˆ°</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(map[i][j] == <span class="number">0</span>) &#123;  <span class="comment">//å¦‚æœå½“å‰è¿™ä¸ªç‚¹è¿˜æ²¡æœ‰èµ°è¿‡</span></span><br><span class="line"><span class="comment">//æŒ‰ç…§ç­–ç•¥ ä¸‹ -&gt; å³ -&gt;ä¸Š-&gt;å·¦èµ°</span></span><br><span class="line">map[i][j] = <span class="number">2</span>;<span class="comment">//å‡å®šè¯¥ç‚¹æ˜¯å¯ä»¥èµ°é€š</span></span><br><span class="line"><span class="keyword">if</span>(setWay(map,i+<span class="number">1</span>,j)) &#123; <span class="comment">//å¾€ä¸‹èµ°</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(setWay(map, i, j + <span class="number">1</span>)) &#123;<span class="comment">//å‘å³</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(setWay(map, i - <span class="number">1</span>, j)) &#123;<span class="comment">//å‘ä¸Š</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(setWay(map, i, j -<span class="number">1</span>)) &#123;  <span class="comment">//å‘å·¦èµ°</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//è¯´æ˜è¯¥ç‚¹èµ°ä¸é€š</span></span><br><span class="line">map[i][j] = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//å¦‚æœmap[i][j] != 0,å¯èƒ½æ˜¯ 1,2,3</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨é€’å½’å›æº¯æ¥ç»™å°çƒæ‰¾è·¯</span></span><br><span class="line"><span class="comment">//è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">//1.å¦‚æœå°çƒèƒ½åˆ°map[6][5]çš„ä½ç½®è¯´æ˜é€šè·¯æ‰¾åˆ°äº†ã€‚</span></span><br><span class="line"><span class="comment">//å½“map[i][j]ä¸º0è¯´æ˜è¯¥ç‚¹æ²¡æœ‰èµ°è¿‡   å½“ä¸º1ï¼Œè¡¨ç¤ºå¢™;2 è¡¨ç¤ºé€šè·¯å¯ä»¥èµ°ï¼Œ3è¡¨ç¤ºè¯¥ä½ç½®ä»¥åŠèµ°è¿‡ï¼Œä½†æ˜¯èµ°ä¸é€š</span></span><br><span class="line"><span class="comment">//åœ¨èµ°è¿·å®«çš„æ—¶å€™ï¼Œéœ€è¦ç¡®å®šä¸€ä¸ªç­–ç•¥(æ–¹æ³•)ä¸Š -&gt;å³ -&gt;ä¸‹-&gt;å·¦è¾¹ï¼Œå¦‚æœæ”¹ç‚¹èµ°ä¸é€šï¼Œåœ¨å›æº¯</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> map è¡¨ç¤ºä¼ å¦‚çš„åœ°å›¾</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> i è¡¨ç¤ºä»å“ªä¸ªä½ç½®å¼€å§‹æ‰¾ï¼Œè¡¨ç¤ºæ¨ªåæ ‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> j è¡¨ç¤ºåæ ‡ï¼Œè¡¨ç¤ºçºµåæ ‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> å¦‚æœæ‰¾åˆ°é€šè·¯ï¼Œå°±è¿”å›ä¸ºtrueï¼Œå¦åˆ™è¿”å›false</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">setWay1</span><span class="params">(<span class="type">int</span> [][] map,<span class="type">int</span> i , <span class="type">int</span> j)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(map[<span class="number">6</span>][<span class="number">5</span>] == <span class="number">2</span>) &#123; <span class="comment">//é€šè·¯å·²ç»æ‰¾åˆ°</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(map[i][j] == <span class="number">0</span>) &#123;  <span class="comment">//å¦‚æœå½“å‰è¿™ä¸ªç‚¹è¿˜æ²¡æœ‰èµ°è¿‡</span></span><br><span class="line"><span class="comment">//æŒ‰ç…§ç­–ç•¥ ä¸Š -&gt; å³ -&gt;ä¸‹-&gt;å·¦èµ°</span></span><br><span class="line">map[i][j] = <span class="number">2</span>;<span class="comment">//å‡å®šè¯¥ç‚¹æ˜¯å¯ä»¥èµ°é€š</span></span><br><span class="line"><span class="keyword">if</span>(setWay1(map, i - <span class="number">1</span>,j)) &#123; <span class="comment">//å¾€ä¸Šèµ°</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(setWay1(map, i, j + <span class="number">1</span>)) &#123;<span class="comment">//å‘å³</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(setWay1(map, i + <span class="number">1</span>, j)) &#123;<span class="comment">//å‘ä¸‹</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(setWay1(map, i, j -<span class="number">1</span>)) &#123;  <span class="comment">//å‘å·¦èµ°</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//è¯´æ˜è¯¥ç‚¹èµ°ä¸é€š</span></span><br><span class="line">map[i][j] = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//å¦‚æœmap[i][j] != 0,å¯èƒ½æ˜¯ 1,2,3</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-å…«çš‡åé—®é¢˜é€’å½’æ€è·¯å’Œå®ç°">6.2 å…«çš‡åé—®é¢˜é€’å½’æ€è·¯å’Œå®ç°</h3><p>å…«çš‡åé—®é¢˜ç®—æ³•æ€è·¯åˆ†æï¼š</p><p>1ï¼‰ç¬¬ä¸€ä¸ªçš‡åå…ˆæ”¾ç¬¬ä¸€è¡Œç¬¬ä¸€åˆ—</p><p>2ï¼‰ç¬¬äºŒä¸ªçš‡åæ”¾åœ¨ç¬¬äºŒè¡Œç¬¬ä¸€åˆ—ã€ç„¶ååˆ¤æ–­æ˜¯å¦OKï¼Œå¦‚æœä¸OKï¼Œç»§ç»­æ”¾åœ¨ç¬¬äºŒåˆ—ã€ç¬¬ä¸‰åˆ—ã€ä¾æ¬¡æŠŠæ‰€æœ‰åˆ—éƒ½æ”¾å®Œï¼Œæ‰¾åˆ°ä¸€ä¸ªåˆé€‚</p><p>3ï¼‰ç»§ç»­ç¬¬ä¸‰ä¸ªçš‡åï¼Œè¿˜æ˜¯ç¬¬ä¸€åˆ—ã€ç¬¬äºŒåˆ—â€¦â€¦.ç›´åˆ°ç¬¬8ä¸ªçš‡åä¹Ÿèƒ½æ”¾åœ¨ä¸€ä¸ªä¸å†²çªçš„ä½ç½®ï¼Œç®—æ˜¯æ‰¾åˆ°äº†ä¸€ä¸ªæ­£ç¡®è§£</p><p>4ï¼‰å½“å¾—åˆ°ä¸€ä¸ªæ­£ç¡®è§£æ—¶ï¼Œåœ¨æ ˆå›é€€åˆ°ä¸Šä¸€ä¸ªæ ˆæ—¶ï¼Œå°±ä¼šå¼€å§‹å›æº¯ï¼Œå³å°†ç¬¬ä¸€ä¸ªçš‡åï¼Œæ”¾åˆ°ç¬¬ä¸€åˆ—çš„æ‰€æœ‰æ­£ç¡®è§£ï¼Œå…¨éƒ¨å¾—åˆ°.</p><p>5ï¼‰ç„¶åå›å¤´ç»§ç»­ç¬¬ä¸€ä¸ªçš‡åæ”¾ç¬¬äºŒåˆ—ï¼Œåé¢ç»§ç»­å¾ªç¯æ‰§è¡Œ1ï¼Œ2ï¼Œ3ï¼Œ4çš„æ­¥éª¤</p><p>è¯´æ˜ï¼šç†è®ºä¸Šåº”è¯¥åˆ›å»ºä¸€ä¸ªäºŒç»´æ•°ç»„æ¥è¡¨ç¤ºæ£‹ç›˜ï¼Œä½†æ˜¯å®é™…ä¸Šå¯ä»¥é€šè¿‡ç®—æ³•ï¼Œç”¨ä¸€ä¸ªä¸€ç»´æ•°ç»„å³å¯è§£å†³é—®é¢˜.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…«çš‡åé—®é¢˜</span></span><br><span class="line"><span class="comment"> * æè¿°ï¼Œè¦æ±‚æ¯ä¸ªçš‡åä¸åœ¨åŒä¸€è¡Œï¼ŒåŒä¸€åˆ—ï¼Œå¹¶ä¸”ä¸åœ¨åŒä¸€æ–œçº¿ä¸Š</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> è€èƒ¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023å¹´4æœˆ8æ—¥</span></span><br><span class="line"><span class="comment"> * Company æš‚æ— </span></span><br><span class="line"><span class="comment"> * Email 2844135670@qq.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EightQueenQuestions</span> &#123;</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªmaxè¡¨ç¤ºæœ‰å¤šå°‘ä¸ªçš‡å</span></span><br><span class="line"><span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line"><span class="comment">//å®šä¹‰æ•°ç»„array,ä¿å­˜çš‡åä½ç½®æ”¾ç½®çš„ç»“æœï¼Œæ¯”å¦‚arr=&#123;0,4,7,5,2,6,1,3&#125;</span></span><br><span class="line"><span class="type">int</span> [] array = <span class="keyword">new</span> <span class="title class_">int</span>[max];</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€å…±æœ‰å¤šå°‘ç§è§£æ³•</span></span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span> ; </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//æµ‹è¯•ä¸€æŠŠï¼Œ8çš‡åæ˜¯å¦æ­£ç¡®</span></span><br><span class="line"><span class="type">EightQueenQuestions</span> <span class="variable">queue8</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EightQueenQuestions</span>();</span><br><span class="line">System.out.println(<span class="string">&quot;å“ªè¡Œå“ªåˆ—ä»£è¡¨æ•°å­—,&quot;</span></span><br><span class="line">+ <span class="string">&quot;æ¯”å¦‚0 4 7 5 2 6 1 3ï¼Œ&quot;</span></span><br><span class="line">+ <span class="string">&quot;0è¡¨ç¤ºç¬¬0è¡Œ0åˆ—ï¼Œ&quot;</span></span><br><span class="line">+<span class="string">&quot;4è¡¨ç¤ºç¬¬1è¡Œ4åˆ—ï¼Œ&quot;</span></span><br><span class="line">+<span class="string">&quot;5è¡¨ç¤ºç¬¬2è¡Œ6åˆ—ï¼Œ&quot;</span></span><br><span class="line">+<span class="string">&quot;ä»¥æ­¤ç±»æ¨ã€‚&quot;</span>);</span><br><span class="line">queue8.check(<span class="number">0</span>);</span><br><span class="line">System.out.printf(<span class="string">&quot;å…±è®¡æœ‰%dç§è§£æ³•&quot;</span>,count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œæ”¾ç½®ç¬¬nä¸ªçš‡å</span></span><br><span class="line"><span class="comment">//æ³¨æ„åˆ°ï¼šcheckæ˜¯æ¯ä¸€æ¬¡é€’å½’æ—¶ï¼Œè¿›å…¥checkä¸­éƒ½æœ‰for(int i = 0; i &lt; max ; i ++)ï¼Œå› æ­¤ä¼šæœ‰å›æº¯</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">check</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(n == max ) &#123;</span><br><span class="line"><span class="comment">//n = 8 ï¼Œå…¶å®æ˜¯8ä¸ªçš‡åå°±æ”¾å¥½äº†</span></span><br><span class="line">print();</span><br><span class="line"><span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¾æ¬¡æ”¾å…¥çš‡åï¼Œå¹¶åˆ¤æ–­æ˜¯å¦å†²çª</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; max; i ++) &#123;<span class="comment">//ä¸å†²çª</span></span><br><span class="line"><span class="comment">//å…ˆæŠŠå½“å‰è¿™ä¸ªçš‡ån,æ”¾åˆ°è¯¥è¡Œçš„ç¬¬1åˆ—</span></span><br><span class="line">array[n] = i;</span><br><span class="line"><span class="keyword">if</span>(judge(n)) &#123;</span><br><span class="line"><span class="comment">//æ¥ç€æ”¾ç½®n + 1çš‡åï¼Œå³å¼€å§‹é€’å½’</span></span><br><span class="line">check(n+<span class="number">1</span>); <span class="comment">//å¦‚æœæœ‰8ä¸ªçš‡åï¼Œæˆ‘ä»¬å°†è°ƒç”¨8æ¬¡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¦‚æœæ˜¯å†²çªå°±ç»§ç»­æ‰§è¡Œarray[n] = i; å³å°†ç¬¬nä¸ªçš‡åæ”¾ç½®åœ¨æœ¬è¡Œçš„åç§»ä¸€ä¸ªä½ç½®</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŸ¥çœ‹å½“æˆ‘ä»¬æ”¾ç½®ç¬¬nä¸ªçš‡åï¼Œå°±å»æ£€æµ‹è¯¥çš‡åæ˜¯å¦å’Œå‰é¢å·²ç»æ‘†æ”¾çš„çš‡åå†²çª</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> n è¡¨ç¤ºç¬¬nä¸ªçš‡å</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">judge</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; n ; i ++) &#123;</span><br><span class="line"><span class="comment">//è¯´æ˜ä¸€ä¸‹</span></span><br><span class="line"><span class="comment">//array[i] == array[n] è¡¨ç¤ºåˆ¤æ–­ç¬¬nä¸ªçš‡åæ˜¯å¦å’Œå‰é¢çš„n-1ä¸ªçš‡ååœ¨åŒä¸€åˆ—</span></span><br><span class="line"><span class="comment">//Math.abs(n-i) == Math.abs(array[n] -  array[i]) è¡¨ç¤ºåˆ¤æ–­ç¬¬nä¸ªçš‡åæ—¶å€™å’Œç¬¬iä¸ªçš‡åæ˜¯å¦åœ¨åŒä¸€æ–œçº¿</span></span><br><span class="line"><span class="comment">// n = 1 æ”¾ç½®ç¬¬2åˆ— n = 1 array[1] = 1</span></span><br><span class="line"><span class="comment">//Math.abs(1 - 0)  == 1 Math.abs(array[n] - array[i]) = Math.abs(1-0) = 1;</span></span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦åœ¨åŒä¸€è¡Œï¼Œå…¶å®æ²¡æœ‰å¿…è¦ï¼Œå› ä¸ºæ¯æ¬¡éƒ½åœ¨é€’å¢</span></span><br><span class="line"><span class="keyword">if</span>(array[i] == array[n] || Math.abs(n-i) == Math.abs(array[n] -  array[i])) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å†™ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥å°†çš‡åæ‘†æ”¾çš„ä½ç½®è¾“å‡º</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">count ++;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; array.length; i++) &#123;</span><br><span class="line">System.out.print(array[i] + <span class="string">&quot; &quot;</span> );</span><br><span class="line">&#125;</span><br><span class="line">System.out.println();</span><br><span class="line">System.out.println(<span class="string">&quot;===============&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="7-æ’åº">7. æ’åº</h2><h3 id="7-1-8ç§åŸºæœ¬æ’åº">7.1 8ç§åŸºæœ¬æ’åº</h3><ol><li>æ’åºä¹Ÿç§°ä¸ºæ’åºç®—æ³•ï¼Œæ’åºæ˜¯ä¸€ç»„æ•°æ®ï¼ŒæŒ‰ç…§æŒ‡å®šçš„é¡ºåºè¿›è¡Œæ’åˆ—çš„è¿‡ç¨‹ã€‚</li><li>æ’åºçš„åˆ†ç±»ï¼š<ol><li>å†…éƒ¨æ’åºï¼šå°†éœ€è¦å¤„ç†çš„æ‰€æœ‰æ•°æ®éƒ½åŠ è½½åˆ°å†…éƒ¨å­˜å‚¨å™¨ä¸­è¿›è¡Œæ’åº</li><li>å¤–éƒ¨æ’åºï¼šæ•°æ®é‡è¿‡å¤§ï¼Œæ— æ³•å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œéœ€è¦å€ŸåŠ©å¤–éƒ¨å­˜å‚¨è¿›è¡Œæ’åº</li></ol></li><li>å¸¸è§çš„æ’åºç®—æ³•çš„åˆ†ç±»ï¼š<ol><li>å†…éƒ¨æ’åºï¼š<ol><li>æ’å…¥æ’åºï¼š<ol><li>ç›´æ¥æ’å…¥æ’åº</li><li>å¸Œå°”æ’åº</li></ol></li><li>é€‰æ‹©æ’åº<ol><li>ç®€å•é€‰æ‹©æ’åº</li><li>å †æ’åº</li></ol></li><li>äº¤æ¢æ’åº<ol><li>å†’æ³¡æ’åº</li><li>å¿«é€Ÿæ’åº</li></ol></li><li>å½’å¹¶æ’åº</li><li>åŸºæ•°æ’åº</li></ol></li><li>å¤–éƒ¨æ’åºï¼šå†…å­˜å’Œå¤–å­˜æ’åº</li></ol></li></ol><h3 id="7-2æ—¶é—´å¤æ‚åº¦">7.2æ—¶é—´å¤æ‚åº¦</h3><p>ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦</p><p>ä¸€èˆ¬æˆ‘ä»¬åº¦é‡ä¸€ä¸ªç¨‹åºæ‰§è¡Œæ—¶é—´çš„ä¸¤ç§æ–¹æ³•</p><ol><li><p>äº‹åç»Ÿè®¡ï¼šè¿™ç§æ–¹æ³•å¯è¡Œï¼Œä½†æ˜¯å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€æ˜¯æƒ³è¦å¯¹è®¾è®¡çš„ç®—æ³•çš„è¿è¡Œæ€§èƒ½è¿›è¡Œè¯„æµ‹ï¼Œéœ€è¦å®é™…è¿è¡Œè¯¥ç¨‹åºï¼ŒäºŒæ˜¯æ‰€å¾—æ—¶é—´çš„ç»Ÿè®¡é‡ä¾èµ–äºè®¡ç®—æœºçš„ç¡¬ä»¶ï¼Œè½¯ä»¶ç­‰ç¯å¢ƒå› ç´ ï¼Œè¿™ç§æ–¹å¼è¦æ±‚åœ¨åŒä¸€å°è®¡ç®—æœºçš„ç›¸åŒçŠ¶æ€ä¸‹è¿è¡Œï¼Œæ‰èƒ½æ¯”è¾ƒé‚£ä¸ªç®—æ³•é€Ÿåº¦æ›´å¿«ã€‚</p></li><li><p>äº‹å‰ä¼°ç®—æ³•ï¼šé€šè¿‡åˆ†ææŸä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ¥åˆ¤æ–­å“ªä¸ªç®—æ³•æ›´ä¼˜ã€‚</p></li></ol><p>1ï¼‰ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç®—æ³•ä¸­çš„åŸºæœ¬æ“ä½œè¯­å¥çš„é‡å¤æ‰§è¡Œæ¬¡æ•°æ˜¯é—®é¢˜è§„æ¨¡nçš„æŸä¸ªå‡½æ•°ï¼Œç”¨f(nï¼‰è¡¨ç¤ºï¼Œè‹¥æœ‰æŸä¸ªè¾…åŠ©å‡½æ•°f(nï¼‰ï¼Œä¾¿å¾—å½“nè¶‹è¿‘äºæ— ç©·å¤§æ—¶ï¼ŒT(n)/f(n)çš„æé™å€¼ä¸ºä¸ç­‰äºé›¶çš„å¸¸æ•°ï¼Œåˆ™ç§°fï¼ˆnï¼‰æ˜¯Tï¼ˆnï¼‰çš„åŒæ•°é‡çº§å‡½æ•°ã€‚è®°ä½œTï¼ˆnï¼‰=O(f(n))ï¼Œç§°O(f(n))ä¸ºç®—æ³•çš„æ¸è¿›é—´å¤æ‚åº¦ï¼Œç®€ç§°æ—¶é—´å¤æ‚åº¦ã€‚</p><p>2ï¼‰Tï¼ˆnï¼‰ä¸åŒï¼Œä½†æ—¶é—´å¤æ‚åº¦å¯èƒ½ç›¸åŒã€‚å¦‚ï¼šTï¼ˆnï¼‰=n^2+7n+6ä¸Tï¼ˆnï¼‰=3n^2+2n+2å®ƒä»¬çš„ï¼ˆnï¼‰ä¸åŒï¼Œä½†æ—¶é—´å¤æ‚åº¦ç›¸åŒï¼Œéƒ½ä¸ºO(n^2)ã€‚</p><p>3ï¼‰è®¡ç®—æ—¶é—´å¤æ‚åº¦çš„æ–¹æ³•ï¼š</p><ul><li><p>ç”¨å¸¸æ•°1ä»£æ›¿è¿è¡Œæ—¶é—´ä¸­çš„æ‰€æœ‰åŠ æ³•å¸¸æ•° T(n) = n^2 + 7n + 6; =&gt;T(n) = n^2 + 7n + 1</p></li><li><p>ä¿®æ”¹åçš„è¿è¡Œæ¬¡æ•°å‡½æ•°ä¸­ï¼Œåªä¿ç•™æœ€é«˜é˜¶é¡¹</p><p>T(n) = n^2 + 7n + 1 =&gt; T(n) = n^2</p></li><li><p>å»é™¤æœ€é«˜é˜¶é¡¹çš„ç³»æ•°T(n) =3n^2 =&gt;O(n^2)</p></li></ul><ol><li><p>å¸¸æ•°é˜¶O(1)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">++ i;</span><br><span class="line">j++ ;</span><br><span class="line"><span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> i + j;</span><br></pre></td></tr></table></figure></li><li><p>å¯¹æ•°é˜¶O(log2n)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">i</span>  <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(i&lt;n)&#123;</span><br><span class="line">    i=i*<span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>çº¿æ€§é˜¶O(n)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n ; ++ i)&#123;</span><br><span class="line">    j = i;</span><br><span class="line">    j ++;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></li><li><p>çº¿æ€§å¯¹æ•°é˜¶O(nlog2n)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; m &lt; n; m++ )&#123;</span><br><span class="line">    i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(i &lt; n)&#123;</span><br><span class="line">        i *= <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¹³æ–¹é˜¶O(n^2)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>( <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i&lt;= n; i ++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span> ; j &lt;= n; j++)&#123;</span><br><span class="line">        j = i;</span><br><span class="line">        j ++ ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç«‹æ–¹é˜¶O(n^3)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>()&#123;</span><br><span class="line">    <span class="keyword">for</span>()&#123;</span><br><span class="line">        <span class="keyword">for</span>()&#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>kæ¬¡æ–¹é˜¶O(n^k)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nå±‚<span class="keyword">for</span>()&#123;</span><br><span class="line">    <span class="keyword">for</span>()&#123;</span><br><span class="line">        <span class="keyword">for</span>()&#123;</span><br><span class="line">            ......</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æŒ‡æ•°é˜¶O(2^n)</p></li></ol><p>ä¾æ¬¡å¾€ä¸‹æ—¶é—´å¤æ‚åº¦å¢é•¿</p><table><thead><tr><th>æ’åºæ³•</th><th>å¹³å‡æ—¶é—´</th><th>æœ€å·®æƒ…å†µ</th><th>ç¨³å®šåº¦</th><th>ç©ºé—´å¤æ‚åº¦</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>å†’æ³¡</td><td>O(n^2)</td><td>O(n^2)</td><td>ç¨³å®š</td><td>1</td><td>nå°æ¯”è¾ƒå¥½</td></tr><tr><td>äº¤æ¢</td><td>O(n^2)</td><td>O(n^2)</td><td>ä¸ç¨³å®š</td><td>1</td><td>nå°æ¯”è¾ƒå¥½</td></tr><tr><td>é€‰æ‹©</td><td>O(n^2)</td><td>O(n^2)</td><td>ä¸ç¨³å®š</td><td>1</td><td>nå°æ¯”è¾ƒå¥½</td></tr><tr><td>æ’å…¥</td><td>O(n^2)</td><td>O(n^2)</td><td>ç¨³å®š</td><td>1</td><td>å¤§éƒ¨åˆ†å·²æ’åºçš„è¾ƒå¥½</td></tr><tr><td>åŸºæ•°</td><td>O(logRB)</td><td>O(logRB)</td><td>ç¨³å®š</td><td>1</td><td>Bæ˜¯çœŸæ•°(0-9),Ræ˜¯åŸºæ•°ï¼ˆä¸ªåç™¾ï¼‰</td></tr><tr><td>shell</td><td>O(nlogn)</td><td>O(n^s)  1&lt;s&lt;2</td><td>ä¸ç¨³å®š</td><td>1</td><td>sæ˜¯æ‰€é€‰åˆ†ç»„</td></tr><tr><td>å¿«é€Ÿ</td><td>O(nlogn)</td><td>O(n^2)</td><td>ä¸ç¨³å®š</td><td>O(nlogn)</td><td>nå¤§æ—¶è¾ƒå¥½</td></tr><tr><td>å½’å¹¶</td><td>O(nlogn)</td><td>O(nlogn)</td><td>ç¨³å®š</td><td>O(1)</td><td>nå¤§æ—¶è¾ƒå¥½</td></tr><tr><td>å †</td><td>O(nlogn)</td><td>O(nlogn)</td><td>ä¸ç¨³å®š</td><td>O(1)</td><td>nå¤§æ—¶å€™è¾ƒå¥½</td></tr></tbody></table><h3 id="7-3-æ’åºç®—æ³•çš„å®ç°ä¸è®¾è®¡">7.3 æ’åºç®—æ³•çš„å®ç°ä¸è®¾è®¡</h3><h4 id="7-3-1-å†’æ³¡æ’åº">7.3.1 å†’æ³¡æ’åº</h4><p>æ€æƒ³ï¼š</p><p>å†’æ³¡æ’åºé€šè¿‡å¯¹æ’åºåºåˆ—ä»å‰å¾€å(ä»ä¸‹æ ‡è¾ƒå°çš„å…ƒç´ å¼€å§‹)ï¼Œä¾æ¬¡æ¯”è¾ƒç›¸é‚»å…ƒç´ çš„å€¼ï¼Œè‹¥å‘ç°é€†åºåˆ™äº¤æ¢ï¼Œä½¿å€¼è¾ƒå¤§å¤§å…ƒç´ æ…¢æ…¢ä»å‰å¾€åç§»ï¼Œå°±åƒæ°´åº•æ°”æ³¡ä¸€æ ·æ…¢æ…¢å¾€ä¸Šå†’ã€‚</p><p>ä¼˜åŒ–ï¼š</p><p>å› ä¸ºæ’åºçš„è¿‡ç¨‹ä¸­ï¼Œå„å…ƒç´ ä¸æ–­æ¥è¿‘è‡ªå·±çš„ä½ç½®ï¼Œå¦‚æœä¸€è¶Ÿæ¯”è¾ƒä¸‹æ¥æ²¡æœ‰è¿›è¡Œè¿‡äº¤æ¢ï¼Œå°±è¯´æ˜åºåˆ—æœ‰åºï¼Œå› æ­¤è¦åœ¨æ’åºè¿‡ç¨‹ä¸­è®¾ç½®ä¸€ä¸ªæ ‡å¿—flagåˆ¤æ–­å…ƒç´ æ˜¯å¦è¿›è¡Œè¿‡äº¤æ¢ã€‚ä»è€Œå‡å°‘ä¸å¿…è¦çš„æ¯”è¾ƒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BubbleSort</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">int</span> arr[] = &#123;<span class="number">3</span>,<span class="number">9</span>,-<span class="number">1</span>,<span class="number">10</span>,-<span class="number">2</span>&#125;;</span><br><span class="line"><span class="comment">//å†’æ³¡æ’åºçš„è¿‡ç¨‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬ä¸€è¶Ÿæ’åºï¼Œå°±æ˜¯å°†æœ€å¤§çš„æ•°æ’åœ¨æœ€å</span></span><br><span class="line"><span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//ä¸´æ—¶å˜é‡</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; arr.length -<span class="number">1</span> ; i ++ ) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span> ; j &lt; arr.length -<span class="number">1</span> -i; j ++) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœå‰é¢è¿™ä¸ªæ•°æ¯”åé¢çš„æ•°æ›´å¤§ï¼Œåˆ™äº¤æ¢</span></span><br><span class="line"><span class="keyword">if</span>(arr[j]&gt;arr[j+<span class="number">1</span>]) &#123;</span><br><span class="line">temp = arr[j];</span><br><span class="line">arr[j] = arr[j+<span class="number">1</span>];</span><br><span class="line">arr[j+<span class="number">1</span>] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br><span class="line"><span class="comment">/*System.out.println(&quot;ç¬¬ä¸€å›æ’åºåçš„æ•°ç»„&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//ç¬¬äºŒä¼šæ’åºï¼Œå°±æ˜¯å°†ç¬¬äºŒå¤§çš„æ•°æ’åœ¨å€’æ•°ç¬¬äºŒä½</span></span><br><span class="line"><span class="comment">for(int j = 0 ; j &lt; arr.length -1 - 1; j ++ ) &#123;</span></span><br><span class="line"><span class="comment">//å¦‚æœå‰é¢è¿™ä¸ªæ•°æ¯”åé¢çš„æ•°æ›´å¤§ï¼Œåˆ™äº¤æ¢</span></span><br><span class="line"><span class="comment">if(arr[j]&gt;arr[j+1]) &#123;</span></span><br><span class="line"><span class="comment">temp = arr[j];</span></span><br><span class="line"><span class="comment">arr[j] = arr[j+1];</span></span><br><span class="line"><span class="comment">arr[j+1] = temp;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;ç¬¬äºŒå›æ’åºåçš„æ•°ç»„&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//ç¬¬ä¸‰ä¼šæ’åºï¼Œå°±æ˜¯å°†ç¬¬ä¸‰å¤§çš„æ•°æ’åœ¨å€’æ•°ç¬¬ä¸‰ä½</span></span><br><span class="line"><span class="comment">for(int j = 0 ; j &lt; arr.length -1 - 2; j ++ ) &#123;</span></span><br><span class="line"><span class="comment">//å¦‚æœå‰é¢è¿™ä¸ªæ•°æ¯”åé¢çš„æ•°æ›´å¤§ï¼Œåˆ™äº¤æ¢</span></span><br><span class="line"><span class="comment">if(arr[j]&gt;arr[j+1]) &#123;</span></span><br><span class="line"><span class="comment">temp = arr[j];</span></span><br><span class="line"><span class="comment">arr[j] = arr[j+1];</span></span><br><span class="line"><span class="comment">arr[j+1] = temp;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;ç¬¬ä¸‰å›æ’åºåçš„æ•°ç»„&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment">//ç¬¬å››ä¼šæ’åºï¼Œå°±æ˜¯å°†ç¬¬å››å¤§çš„æ•°æ’åœ¨å€’æ•°ç¬¬å››ä½</span></span><br><span class="line"><span class="comment">for(int j = 0 ; j &lt; arr.length -1 - 3; j ++ ) &#123;</span></span><br><span class="line"><span class="comment">//å¦‚æœå‰é¢è¿™ä¸ªæ•°æ¯”åé¢çš„æ•°æ›´å¤§ï¼Œåˆ™äº¤æ¢</span></span><br><span class="line"><span class="comment">if(arr[j]&gt;arr[j+1]) &#123;</span></span><br><span class="line"><span class="comment">temp = arr[j];</span></span><br><span class="line"><span class="comment">arr[j] = arr[j+1];</span></span><br><span class="line"><span class="comment">arr[j+1] = temp;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;ç¬¬å››å›æ’åºåçš„æ•°ç»„&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>å†’æ³¡æ’åºçš„ä¼˜åŒ–ï¼š</p><p>å› ä¸ºåœ¨æ’åºè¿‡ç¨‹ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BubbleSortOptimize</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">int arr[] = &#123;3,9,-1,10,-2&#125;;</span></span><br><span class="line"><span class="comment">//å†’æ³¡æ’åºçš„è¿‡ç¨‹</span></span><br><span class="line"><span class="comment">System.out.println(&quot;æ’åºå‰çš„æ•°ç»„ï¼š&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment">System.out.println(&quot;=============================&quot;);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æµ‹è¯•ä¸€ä¸‹å†’æ³¡æ’åºçš„é€Ÿåº¦O(n^2),ç»™8ä¸‡ä¸ªæ•°æ®ï¼Œæµ‹è¯•</span></span><br><span class="line"><span class="comment">//åˆ›å»ºè¦ç»™80000ä¸ªæ•°æ®</span></span><br><span class="line"><span class="type">int</span> [] arr = <span class="keyword">new</span> <span class="title class_">int</span> [<span class="number">80000</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; <span class="number">80000</span> ; i ++) &#123;</span><br><span class="line">arr[i] = (<span class="type">int</span>)(Math.random() * <span class="number">80000</span>); <span class="comment">//ç”Ÿæˆä¸€ä¸ª[0,80000)çš„éšæœºæ•°</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">Date</span> <span class="variable">date1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="comment">//è¾“å‡ºä¸€ä¸ªæ—¥æœŸæ ¼å¼</span></span><br><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">dateStr</span> <span class="operator">=</span> simpleDateFormat.format(date1);</span><br><span class="line">System.out.println(<span class="string">&quot;æ’åºå‰çš„æ—¶é—´ä¸º=&quot;</span> + dateStr);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æµ‹è¯•å†’æ³¡æ’åº</span></span><br><span class="line">bubbleSort(arr);</span><br><span class="line"><span class="type">Date</span> <span class="variable">date2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="type">String</span> <span class="variable">dateStr2</span> <span class="operator">=</span> simpleDateFormat.format(date2);</span><br><span class="line">System.out.println(<span class="string">&quot;è¾“å‡ºæ’åºåçš„æ—¶é—´&quot;</span> + dateStr2);</span><br><span class="line"><span class="comment">//System.out.println(Arrays.toString(arr));</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†å‰é¢å†’æ³¡æ’åºç®—æ³•å°è£…æˆä¸€ä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">bubbleSort</span><span class="params">(<span class="type">int</span> [] arr)</span> &#123;</span><br><span class="line"><span class="comment">//ç¬¬ä¸€è¶Ÿæ’åºï¼Œå°±æ˜¯å°†æœ€å¤§çš„æ•°æ’åœ¨æœ€å</span></span><br><span class="line"><span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//ä¸´æ—¶å˜é‡</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>; <span class="comment">//å®šä¹‰ä¸€ä¸ªæ ‡è¯†ç¬¦</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; arr.length -<span class="number">1</span> ; i ++ ) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span> ; j &lt; arr.length -<span class="number">1</span> -i; j ++) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœå‰é¢è¿™ä¸ªæ•°æ¯”åé¢çš„æ•°æ›´å¤§ï¼Œåˆ™äº¤æ¢</span></span><br><span class="line"><span class="keyword">if</span>(arr[j]&gt;arr[j+<span class="number">1</span>]) &#123;</span><br><span class="line">flag = <span class="literal">true</span>;</span><br><span class="line">temp = arr[j];</span><br><span class="line">arr[j] = arr[j+<span class="number">1</span>];</span><br><span class="line">arr[j+<span class="number">1</span>] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//System.out.println(&quot;ç¬¬&quot;+(i+1)+&quot;èººæ’åºåçš„æ•°ç»„&quot;);</span></span><br><span class="line"><span class="comment">//System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="keyword">if</span>(flag == <span class="literal">false</span>) &#123; <span class="comment">//åœ¨ä¸€è¶Ÿæ’åºä¸­ä¸€æ¬¡äº¤æ¢éƒ½æ²¡å‘ç”Ÿè¿‡</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">flag = <span class="literal">false</span>; <span class="comment">//é‡ç½®flagï¼ï¼ï¼ï¼Œè¿›è¡Œä¸‹æ¬¡åˆ¤æ–­</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//ä¸´æ—¶å˜é‡</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; arr.length -<span class="number">1</span> ; i ++ ) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span> ; j &lt; arr.length -<span class="number">1</span> -i; j ++) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœå‰é¢è¿™ä¸ªæ•°æ¯”åé¢çš„æ•°æ›´å¤§ï¼Œåˆ™äº¤æ¢</span></span><br><span class="line"><span class="keyword">if</span>(arr[j]&gt;arr[j+<span class="number">1</span>]) &#123;</span><br><span class="line">temp = arr[j];</span><br><span class="line">arr[j] = arr[j+<span class="number">1</span>];</span><br><span class="line">arr[j+<span class="number">1</span>] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br></pre></td></tr></table></figure><h4 id="7-3-2-é€‰æ‹©æ’åº">7.3.2 é€‰æ‹©æ’åº</h4><p>é€‰æ‹©æ’åºä¹Ÿæ˜¯ä¸€ç§ç®€å•çš„æ’åºæ–¹å¼ï¼Œå…¶åŸºæœ¬æ€æƒ³åœ¨äºï¼šç¬¬ä¸€æ¬¡ä»æ•°ç»„(arr[0]-arr[n-1])ä¸­é€‰æ‹©æœ€å°çš„å€¼ï¼Œç„¶åä¸æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ (arr[0])è¿›è¡Œäº¤æ¢ï¼Œç¬¬äºŒæ¬¡ä»<code>arr[1]-arr[n-1</code>]ä¸­é€‰å–æœ€å°å€¼ï¼Œä¸arr[1]äº¤æ¢,â€¦,çŸ¥é“å°†æ•°ç»„æ’åºå¥½ï¼Œæ€»å…±é€šè¿‡<code>n-1</code>æ¬¡ï¼Œå¾—åˆ°ä¸€ä¸ªæŒ‰ç…§æ’åºç ä»å°åˆ°å¤§çš„æœ‰åºåºåˆ—ã€‚</p><p>æ€è·¯ï¼š</p><p>åŸå§‹æ•°ç»„ ï¼š 101,34,119,1ï¼›</p><p>ç¬¬ä¸€è½®æ’åºï¼š1,34,119,101ï¼›</p><p>ç¬¬äºŒè½®æ’åºï¼š1,34,119,101ï¼›</p><p>ç¬¬ä¸‰è½®æ’åºï¼š1,34,101,119;</p><ol><li>é€‰åˆ™æ’åºä¸€å…±æœ‰æ•°ç»„å¤§å°-1è½®æ’åº</li><li>æ¯1è½®æ’åºï¼Œåˆæ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œå¾ªç¯çš„è§„åˆ™ã€‚<ol><li>å‡å®šå½“å‰è¿™ä¸ªæ•°æ˜¯æœ€å°æ•°</li><li>ç„¶åå’Œåé¢çš„æ¯ä¸ªæ•°è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå‘ç°æœ‰æ¯”å½“å‰æ•°æ›´å°çš„æ•°ï¼Œå°±é‡æ–°ç¡®å®šæœ€å°æ•°ï¼Œå¹¶å¾—åˆ°ä¸‹æ ‡</li><li>å½“éå†åˆ°æ•°ç»„çš„æœ€åï¼Œå°±å¾—åˆ°æœ¬è½®æœ€å°æ•°å’Œä¸‹æ ‡</li><li>äº¤æ¢æ•°ç»„çš„ä½ç½®</li></ol></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SelectSort</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//int [] arr =  &#123;101,34,119,1&#125;;</span></span><br><span class="line"><span class="comment">//åˆ›å»ºè¦ç»™80000ä¸ªæ•°æ®</span></span><br><span class="line"><span class="type">int</span> [] arr = <span class="keyword">new</span> <span class="title class_">int</span> [<span class="number">80000</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; <span class="number">80000</span> ; i ++) &#123;</span><br><span class="line">arr[i] = (<span class="type">int</span>)(Math.random() * <span class="number">80000</span>); <span class="comment">//ç”Ÿæˆä¸€ä¸ª[0,80000)çš„éšæœºæ•°</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">Date</span> <span class="variable">date1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="comment">//è¾“å‡ºä¸€ä¸ªæ—¥æœŸæ ¼å¼</span></span><br><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">dateStr</span> <span class="operator">=</span> simpleDateFormat.format(date1);</span><br><span class="line">System.out.println(<span class="string">&quot;æ’åºå‰çš„æ—¶é—´ä¸º=&quot;</span> + dateStr);</span><br><span class="line">selectSort(arr);</span><br><span class="line"><span class="comment">//æµ‹è¯•å†’æ³¡æ’åº</span></span><br><span class="line"><span class="type">Date</span> <span class="variable">date2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="type">String</span> <span class="variable">dateStr2</span> <span class="operator">=</span> simpleDateFormat.format(date2);</span><br><span class="line">System.out.println(<span class="string">&quot;è¾“å‡ºæ’åºåçš„æ—¶é—´&quot;</span> + dateStr2);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">System.out.println(&quot;æ’åºå‰ï¼š&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment">selectSort(arr);</span></span><br><span class="line"><span class="comment">System.out.println(&quot;æ’åºå&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//é€‰æ‹©æ’åº</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">selectSort</span><span class="params">(<span class="type">int</span> [] arr)</span> &#123;</span><br><span class="line"><span class="comment">//åœ¨æ¨åˆ°çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°è§„å¾‹ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨foræ¥è§£å†³</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; arr.length ; i ++ ) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">minIndex</span> <span class="operator">=</span> i;</span><br><span class="line"><span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> arr[i];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i +<span class="number">1</span> ; j &lt; arr.length ; j++) &#123;</span><br><span class="line"><span class="keyword">if</span>(min &gt; arr[j]) &#123; <span class="comment">//è¯´æ˜å‡å®šçš„æœ€å°å€¼ï¼Œå¹¶éæœ€å°</span></span><br><span class="line">min = arr[j]; <span class="comment">//é‡ç½®min</span></span><br><span class="line">minIndex = j ;  <span class="comment">//é‡ç½®minInde</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(minIndex != i) &#123;</span><br><span class="line">arr[minIndex] = arr[i];</span><br><span class="line">arr[i] = min;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * System.out.println(&quot;ç¬¬&quot;+(i+1)+&quot;è½®å~~&quot;);</span></span><br><span class="line"><span class="comment"> * System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä½¿ç”¨é€æ­¥æ¨å¯¼ï¼Œè¿›è¡Œé€‰æ‹©æ’åºy</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * åŸå§‹çš„æ•°ç»„ï¼š 101,34,119,1</span></span><br><span class="line"><span class="comment"> * ç¬¬ä¸€è½®æ’åºï¼š1,34,119,101ï¼›</span></span><br><span class="line"><span class="comment">      ç¬¬äºŒè½®æ’åºï¼š1,34,119,101ï¼›</span></span><br><span class="line"><span class="comment">      ç¬¬ä¸‰è½®æ’åºï¼š1,34,101,119;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">int minIndex = 0;</span></span><br><span class="line"><span class="comment">int min = arr[0];</span></span><br><span class="line"><span class="comment">for(int j = 0 +1 ; j &lt; arr.length ; j++) &#123;</span></span><br><span class="line"><span class="comment">if(min &gt; arr[j]) &#123; //è¯´æ˜å‡å®šçš„æœ€å°å€¼ï¼Œå¹¶éæœ€å°</span></span><br><span class="line"><span class="comment">min = arr[j]; //é‡ç½®min</span></span><br><span class="line"><span class="comment">minIndex = j ;  //é‡ç½®minInde</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">//æ­¤æ—¶å°†æœ€å°å€¼ï¼Œæ”¾åœ¨arr[0]ä¸­ï¼Œæ­¤æ—¶å°±æ˜¯äº¤æ¢</span></span><br><span class="line"><span class="comment">if(minIndex != 0) &#123;</span></span><br><span class="line"><span class="comment">arr[minIndex] = arr[0];</span></span><br><span class="line"><span class="comment">arr[0] = min;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;ç¬¬ä¸€è½®å~~&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment">//ç¬¬äºŒè½®</span></span><br><span class="line"><span class="comment">minIndex = 1;</span></span><br><span class="line"><span class="comment">min = arr[1];</span></span><br><span class="line"><span class="comment">for(int j = 0 +1 ; j &lt; arr.length ; j++) &#123;</span></span><br><span class="line"><span class="comment">if(min &gt; arr[j]) &#123; //è¯´æ˜å‡å®šçš„æœ€å°å€¼ï¼Œå¹¶éæœ€å°</span></span><br><span class="line"><span class="comment">min = arr[j]; //é‡ç½®min</span></span><br><span class="line"><span class="comment">minIndex = j ;  //é‡ç½®minInde</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">//æ­¤æ—¶å°†æœ€å°å€¼ï¼Œæ”¾åœ¨arr[0]ä¸­ï¼Œæ­¤æ—¶å°±æ˜¯äº¤æ¢</span></span><br><span class="line"><span class="comment">if(minIndex != 1) &#123;</span></span><br><span class="line"><span class="comment">arr[minIndex] = arr[1];</span></span><br><span class="line"><span class="comment">arr[1] = min;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;ç¬¬äºŒè½®å~~&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment">//ç¬¬ä¸‰è½®</span></span><br><span class="line"><span class="comment">minIndex = 2;</span></span><br><span class="line"><span class="comment">min = arr[2];</span></span><br><span class="line"><span class="comment">for(int j = 0 +1 ; j &lt; arr.length ; j++) &#123;</span></span><br><span class="line"><span class="comment">if(min &gt; arr[j]) &#123; //è¯´æ˜å‡å®šçš„æœ€å°å€¼ï¼Œå¹¶éæœ€å°</span></span><br><span class="line"><span class="comment">min = arr[j]; //é‡ç½®min</span></span><br><span class="line"><span class="comment">minIndex = j ;  //é‡ç½®minInde</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">//æ­¤æ—¶å°†æœ€å°å€¼ï¼Œæ”¾åœ¨arr[0]ä¸­ï¼Œæ­¤æ—¶å°±æ˜¯äº¤æ¢</span></span><br><span class="line"><span class="comment">if(minIndex != 2) &#123;</span></span><br><span class="line"><span class="comment">arr[minIndex] = arr[2];</span></span><br><span class="line"><span class="comment">arr[2] = min;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;ç¬¬ä¸‰è½®å~~&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹æ¯”å†’æ³¡æ’åºå‘ç°ï¼Œé€‰æ‹©æ’åºé€Ÿåº¦æ¯”å†’æ³¡æ’åºå¿«ã€‚</p><p>æ ¸å¿ƒä»£ç å±‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é€‰æ‹©æ’åº</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">selectSort</span><span class="params">(<span class="type">int</span> [] arr)</span> &#123;</span><br><span class="line"><span class="comment">//åœ¨æ¨åˆ°çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°è§„å¾‹ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨foræ¥è§£å†³</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; arr.length ; i ++ ) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">minIndex</span> <span class="operator">=</span> i;</span><br><span class="line"><span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> arr[i];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i +<span class="number">1</span> ; j &lt; arr.length ; j++) &#123;</span><br><span class="line"><span class="keyword">if</span>(min &gt; arr[j]) &#123; <span class="comment">//è¯´æ˜å‡å®šçš„æœ€å°å€¼ï¼Œå¹¶éæœ€å°</span></span><br><span class="line">min = arr[j]; <span class="comment">//é‡ç½®min</span></span><br><span class="line">minIndex = j ;  <span class="comment">//é‡ç½®minInde</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(minIndex != i) &#123;</span><br><span class="line">arr[minIndex] = arr[i];</span><br><span class="line">arr[i] = min;</span><br><span class="line">&#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h4 id="7-3-3-æ’å…¥æ’åº">7.3.3 æ’å…¥æ’åº</h4><p>æ’å…¥æ’åºçš„åŸºæœ¬æ€æƒ³ï¼š æŠŠnä¸ªå¾…æ’åºçš„å…ƒç´ çœ‹æˆä¸€ä¸ªæœ‰åºè¡¨å’Œä¸€ä¸ªæ— åºè¡¨ï¼Œå¼€å§‹æ—¶ï¼Œæœ‰åºè¡¨åªåŒ…å«ä¸€ä¸ªå…ƒç´ ï¼Œæ— åºè¡¨ä¸­åŒ…å«æœ‰n-1ä¸ªå…ƒç´ ï¼Œæ’åºè¿‡ç¨‹ä¸­æ¯æ¬¡ä»æ— åºè¡¨ä¸­å–å‡ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼ŒæŠŠä»–çš„æ’åºç ä¾æ¬¡ä¸æœ‰åºå…ƒç´ çš„æ’åºç è¿›è¡Œæ¯”è¾ƒï¼Œå°†ä»–æ’å…¥åˆ°æœ‰åºè¡¨ä¸­çš„é€‚å½“ä½ç½®ï¼Œä½¿ä¹‹æˆä¸ºæ–°çš„æœ‰åºè¡¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InsertSort</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">int</span> arr [] = &#123;<span class="number">101</span>,<span class="number">34</span>,-<span class="number">1</span>,<span class="number">119</span>,<span class="number">1</span>,<span class="number">89</span>&#125;;</span><br><span class="line">insertSort(arr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ’å…¥æ’åº</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">insertSort</span><span class="params">(<span class="type">int</span> [] arr)</span> &#123;</span><br><span class="line"><span class="comment">//ä½¿ç”¨forå¾ªç¯æ¥å°†ä»£ç ç®€åŒ–</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span> ; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="comment">//ä½¿ç”¨é€æ­¥æ¨åˆ°çš„æ–¹å¼æ¥</span></span><br><span class="line"><span class="comment">//å®šä¹‰å¾…æ’å…¥çš„æ•°æ®</span></span><br><span class="line"><span class="type">int</span> <span class="variable">insertVal</span> <span class="operator">=</span> arr[i];</span><br><span class="line"><span class="type">int</span> <span class="variable">insertIndex</span> <span class="operator">=</span> i - <span class="number">1</span>; <span class="comment">//ä¹Ÿå°±æ˜¯arr[1]çš„å‰é¢è¿™ä¸ªæ•°çš„ä¸‹æ ‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»™insertValæ‰¾åˆ°æ’å…¥çš„ä½ç½®</span></span><br><span class="line"><span class="comment">//è¯´æ˜ insertIndex &gt;= 0 ä¿è¯åœ¨ç»™insertVal æ‰¾æ’å…¥ä½ç½®ï¼Œä¸è¶Šç•Œ</span></span><br><span class="line"><span class="comment">//insertVal &lt; arr[insertIndex]å¾…æ’å…¥çš„æ•°ï¼Œè¿˜æ²¡æœ‰æ‰¾åˆ°æ’å…¥ä½ç½®</span></span><br><span class="line"><span class="comment">//éœ€è¦å°†arr[insertIndex]</span></span><br><span class="line"><span class="keyword">while</span>(insertIndex &gt;= <span class="number">0</span> &amp;&amp; insertVal &lt; arr[insertIndex]) &#123;</span><br><span class="line">arr[insertIndex +  <span class="number">1</span>] = arr[insertIndex];</span><br><span class="line">insertIndex -- ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å½“é€€å‡ºwhileå¾ªç¯æ—¶å€™ï¼Œè¯´æ˜æ’å…¥çš„ä½ç½®æ‰¾åˆ°ï¼ŒinsertIndex + 1;</span></span><br><span class="line">arr[insertIndex + <span class="number">1</span>] = insertVal;</span><br><span class="line">System.out.println(<span class="string">&quot;ç¬¬&quot;</span>+i+<span class="string">&quot;è½®&quot;</span>);</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">//ä½¿ç”¨é€æ­¥æ¨åˆ°çš„æ–¹å¼æ¥</span></span><br><span class="line"><span class="comment">//å®šä¹‰å¾…æ’å…¥çš„æ•°æ®</span></span><br><span class="line"><span class="comment">int insertVal = arr[1];</span></span><br><span class="line"><span class="comment">int insertIndex = 1 - 1; //ä¹Ÿå°±æ˜¯arr[1]çš„å‰é¢è¿™ä¸ªæ•°çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//ç»™insertValæ‰¾åˆ°æ’å…¥çš„ä½ç½®</span></span><br><span class="line"><span class="comment">//è¯´æ˜ insertIndex &gt;= 0 ä¿è¯åœ¨ç»™insertVal æ‰¾æ’å…¥ä½ç½®ï¼Œä¸è¶Šç•Œ</span></span><br><span class="line"><span class="comment">//insertVal &lt; arr[insertIndex]å¾…æ’å…¥çš„æ•°ï¼Œè¿˜æ²¡æœ‰æ‰¾åˆ°æ’å…¥ä½ç½®</span></span><br><span class="line"><span class="comment">//éœ€è¦å°†arr[insertIndex]</span></span><br><span class="line"><span class="comment">while(insertIndex &gt;= 0 &amp;&amp; insertVal &lt; arr[insertIndex]) &#123;</span></span><br><span class="line"><span class="comment">arr[insertIndex +  1] = arr[insertIndex];</span></span><br><span class="line"><span class="comment">insertIndex -- ;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">//å½“é€€å‡ºwhileå¾ªç¯æ—¶å€™ï¼Œè¯´æ˜æ’å…¥çš„ä½ç½®æ‰¾åˆ°ï¼ŒinsertIndex + 1;</span></span><br><span class="line"><span class="comment">arr[insertIndex + 1] = insertVal;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;ç¬¬ä¸€è½®&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//ç¬¬äºŒè½®</span></span><br><span class="line"><span class="comment">insertVal = arr[2];</span></span><br><span class="line"><span class="comment">insertIndex = 2 -1;</span></span><br><span class="line"><span class="comment">while(insertIndex &gt;= 0 &amp;&amp; insertVal &lt; arr[insertIndex]) &#123;</span></span><br><span class="line"><span class="comment">arr[insertIndex +  1] = arr[insertIndex];</span></span><br><span class="line"><span class="comment">insertIndex -- ;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">arr[insertIndex + 1] = insertVal;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;ç¬¬äºŒè½®&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//ç¬¬äºŒè½®</span></span><br><span class="line"><span class="comment">insertVal = arr[3];</span></span><br><span class="line"><span class="comment">insertIndex = 3 -1;</span></span><br><span class="line"><span class="comment">while(insertIndex &gt;= 0 &amp;&amp; insertVal &lt; arr[insertIndex]) &#123;</span></span><br><span class="line"><span class="comment">arr[insertIndex +  1] = arr[insertIndex];</span></span><br><span class="line"><span class="comment">insertIndex -- ;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">arr[insertIndex + 1] = insertVal;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;ç¬¬ä¸‰è½®&quot;);</span></span><br><span class="line"><span class="comment">System.out.println(Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨forå¾ªç¯æ¥å°†ä»£ç ç®€åŒ–</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span> ; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="comment">//ä½¿ç”¨é€æ­¥æ¨åˆ°çš„æ–¹å¼æ¥</span></span><br><span class="line"><span class="comment">//å®šä¹‰å¾…æ’å…¥çš„æ•°æ®</span></span><br><span class="line"><span class="type">int</span> <span class="variable">insertVal</span> <span class="operator">=</span> arr[i];</span><br><span class="line"><span class="type">int</span> <span class="variable">insertIndex</span> <span class="operator">=</span> i - <span class="number">1</span>; <span class="comment">//ä¹Ÿå°±æ˜¯arr[1]çš„å‰é¢è¿™ä¸ªæ•°çš„ä¸‹æ ‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç»™insertValæ‰¾åˆ°æ’å…¥çš„ä½ç½®</span></span><br><span class="line"><span class="comment">//è¯´æ˜ insertIndex &gt;= 0 ä¿è¯åœ¨ç»™insertVal æ‰¾æ’å…¥ä½ç½®ï¼Œä¸è¶Šç•Œ</span></span><br><span class="line"><span class="comment">//insertVal &lt; arr[insertIndex]å¾…æ’å…¥çš„æ•°ï¼Œè¿˜æ²¡æœ‰æ‰¾åˆ°æ’å…¥ä½ç½®</span></span><br><span class="line"><span class="comment">//éœ€è¦å°†arr[insertIndex]</span></span><br><span class="line"><span class="keyword">while</span>(insertIndex &gt;= <span class="number">0</span> &amp;&amp; insertVal &lt; arr[insertIndex]) &#123;</span><br><span class="line">arr[insertIndex +  <span class="number">1</span>] = arr[insertIndex];</span><br><span class="line">insertIndex -- ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å½“é€€å‡ºwhileå¾ªç¯æ—¶å€™ï¼Œè¯´æ˜æ’å…¥çš„ä½ç½®æ‰¾åˆ°ï¼ŒinsertIndex + 1;</span></span><br><span class="line"><span class="keyword">if</span>(insertIndex + <span class="number">1</span> != i) &#123;</span><br><span class="line">arr[insertIndex + <span class="number">1</span>] = insertVal;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//System.out.println(&quot;ç¬¬&quot;+i+&quot;è½®&quot;);</span></span><br><span class="line"><span class="comment">//System.out.println(Arrays.toString(arr));</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ—¶é—´æ¯”è¾ƒï¼Œæˆ‘ä»¬å‘ç°æ’å…¥æ’åºæ¯”é€‰æ‹©æ’åºæ—¶é—´æ›´çŸ­ï¼Œä¹Ÿå°±æ˜¯è¯´æ’å…¥æ’åºçš„æ•ˆç‡é«˜äºé€‰æ‹©æ’åºã€‚</p><p>ç¼ºç‚¹ï¼š å½“æ’å…¥çš„æ•°æ˜¯æœ€å°çš„æ•°æ—¶ï¼Œåç§»çš„æ¬¡æ•°æ˜æ˜¾å¢å¤šï¼Œå¯¹æ•ˆç‡æœ‰å½±å“ã€‚</p><h4 id="7-3-4-å¸Œå°”æ’åº">7.3.4 å¸Œå°”æ’åº</h4><p>ä¹Ÿæ˜¯ä¸€ç§æ’å…¥æ’åºï¼Œå…¶æ˜¯åœ¨æ’å…¥æ’åºçš„ä¸€ç§ä¼˜åŒ–ã€‚å¸Œå°”æ’åºæ˜¯åœ¨æ’å…¥æ’åºä¸Šçš„ç¼ºç‚¹çš„ä¸€ç§è§£å†³åŠæ³•ï¼Œå…¶å®Œç¾è§£å†³äº†æ’å…¥æ’åºçš„ç¼ºç‚¹ã€‚</p><p>åŸºæœ¬æ€æƒ³æ˜¯å¯¹æ•°ç»„è¿›è¡Œåˆ†ç»„ï¼ŒæŒ‰ç…§åˆ†ç»„æ’åºåå†æ’åº</p><p>ç¬¬ä¸€ç§æ€è·¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShellSort</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//å¸Œå°”æ’åºï¼Œå¯¹æœ‰åºåºåˆ—åœ¨æ’å…¥æ—¶é‡‡ç”¨äº¤æ¢æ³•ï¼Œå¹¶æµ‹è¯•æ’åºé€Ÿåº¦</span></span><br><span class="line"><span class="comment">//å¯¹æœ‰åºåºåˆ—åœ¨æ’å…¥å¼é‡‡ç”¨ç§»åŠ¨æ³•ï¼Œå¹¶æµ‹è¯•æ’åºé€Ÿåº¦</span></span><br><span class="line"><span class="type">int</span> []arr = &#123;<span class="number">8</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">0</span>&#125;;</span><br><span class="line">shellSort(arr);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªç®—æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">shellSort</span><span class="params">(<span class="type">int</span> [] arr)</span> &#123;</span><br><span class="line"><span class="comment">//ä½¿ç”¨forå¾ªç¯ç®€åŒ–ä»£ç </span></span><br><span class="line"><span class="comment">//å¸Œå°”æ’åºçš„ç¬¬ä¸€è½®æ’åº</span></span><br><span class="line"><span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">gap</span> <span class="operator">=</span> arr.length / <span class="number">2</span>; gap &gt; <span class="number">0</span> ;gap /=<span class="number">2</span> ) &#123;</span><br><span class="line"><span class="comment">//å› ä¸ºæ˜¯ç¬¬ä¸€è½®æ’åºï¼Œå°†nä¸ªæ•°æ®åˆ†æˆgapç»„</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> gap; i &lt; arr.length ; i++) &#123;</span><br><span class="line"><span class="comment">//éå†å„ç»„ä¸­æ‰€æœ‰çš„å…ƒç´ ï¼ˆå…±è®¡gapç»„ï¼Œæ¯ç»„n/gapä¸ªå…ƒç´ ï¼‰æ­¥é•¿ä¸ºgap</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i -gap ; j &gt;= <span class="number">0</span>; j -= gap) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœå½“å‰å…ƒç´ å¤§äºåŠ ä¸Šæ­¥é•¿åçš„é‚£ä¸ªå…ƒç´ ï¼Œè¯´æ˜è¦äº¤æ¢</span></span><br><span class="line"><span class="keyword">if</span>(arr[j] &gt; arr[j + gap]) &#123;</span><br><span class="line">temp = arr[j];</span><br><span class="line">arr[j] = arr[j + gap];</span><br><span class="line">arr[j + gap] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;å¸Œå°”æ’åºåçš„ç¬¬&quot;</span>+(++count)+<span class="string">&quot;è½®ç»“æœä¸ºï¼š&quot;</span> + Arrays.toString(arr));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">//å¸Œå°”æ’åºçš„ç¬¬ä¸€è½®æ’åº</span></span><br><span class="line"><span class="comment">int temp;</span></span><br><span class="line"><span class="comment">//å› ä¸ºæ˜¯ç¬¬ä¸€è½®æ’åºï¼Œå°†10ä¸ªæ•°æ®åˆ†æˆ5ç»„</span></span><br><span class="line"><span class="comment">for(int i = 5; i &lt; arr.length ; i++) &#123;</span></span><br><span class="line"><span class="comment">//éå†å„ç»„ä¸­æ‰€æœ‰çš„å…ƒç´ ï¼ˆå…±è®¡5ç»„ï¼Œæ¯ç»„2ä¸ªå…ƒç´ ï¼‰æ­¥é•¿ä¸º5</span></span><br><span class="line"><span class="comment">for(int j = i -5 ; j &gt;= 0; j -= 5) &#123;</span></span><br><span class="line"><span class="comment">//å¦‚æœå½“å‰å…ƒç´ å¤§äºåŠ ä¸Šæ­¥é•¿åçš„é‚£ä¸ªå…ƒç´ ï¼Œè¯´æ˜è¦äº¤æ¢</span></span><br><span class="line"><span class="comment">if(arr[j] &gt; arr[j + 5]) &#123;</span></span><br><span class="line"><span class="comment">temp = arr[j];</span></span><br><span class="line"><span class="comment">arr[j] = arr[j + 5];</span></span><br><span class="line"><span class="comment">arr[j + 5] = temp;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;å¸Œå°”æ’åºåçš„ç¬¬ä¸€è½®ç»“æœä¸ºï¼š&quot; + Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//å› ä¸ºæ˜¯ç¬¬äºŒè½®æ’åºï¼Œå°†10ä¸ªæ•°æ®åˆ†æˆ5/2 = 2ç»„</span></span><br><span class="line"><span class="comment">for(int i = 2; i &lt; arr.length ; i++) &#123;</span></span><br><span class="line"><span class="comment">//éå†å„ç»„ä¸­æ‰€æœ‰çš„å…ƒç´ ï¼ˆå…±è®¡5ç»„ï¼Œæ¯ç»„2ä¸ªå…ƒç´ ï¼‰æ­¥é•¿ä¸º5</span></span><br><span class="line"><span class="comment">for(int j = i -2 ; j &gt;= 0; j -= 2) &#123;</span></span><br><span class="line"><span class="comment">//å¦‚æœå½“å‰å…ƒç´ å¤§äºåŠ ä¸Šæ­¥é•¿åçš„é‚£ä¸ªå…ƒç´ ï¼Œè¯´æ˜è¦äº¤æ¢</span></span><br><span class="line"><span class="comment">if(arr[j] &gt; arr[j + 2]) &#123;</span></span><br><span class="line"><span class="comment">temp = arr[j];</span></span><br><span class="line"><span class="comment">arr[j] = arr[j + 2];</span></span><br><span class="line"><span class="comment">arr[j + 2] = temp;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;å¸Œå°”æ’åºåçš„ç¬¬2è½®ç»“æœä¸ºï¼š&quot; + Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">//å› ä¸ºæ˜¯ç¬¬ä¸‰è½®æ’åºï¼Œå°†10ä¸ªæ•°æ®åˆ†æˆ5/2/2 = 1ç»„</span></span><br><span class="line"><span class="comment">for(int i = 1; i &lt; arr.length ; i++) &#123;</span></span><br><span class="line"><span class="comment">//éå†å„ç»„ä¸­æ‰€æœ‰çš„å…ƒç´ ï¼ˆå…±è®¡5ç»„ï¼Œæ¯ç»„2ä¸ªå…ƒç´ ï¼‰æ­¥é•¿ä¸º5</span></span><br><span class="line"><span class="comment">for(int j = i -1 ; j &gt;= 0; j -= 1) &#123;</span></span><br><span class="line"><span class="comment">//å¦‚æœå½“å‰å…ƒç´ å¤§äºåŠ ä¸Šæ­¥é•¿åçš„é‚£ä¸ªå…ƒç´ ï¼Œè¯´æ˜è¦äº¤æ¢</span></span><br><span class="line"><span class="comment">if(arr[j] &gt; arr[j + 1]) &#123;</span></span><br><span class="line"><span class="comment">temp = arr[j];</span></span><br><span class="line"><span class="comment">arr[j] = arr[j + 1];</span></span><br><span class="line"><span class="comment">arr[j + 1] = temp;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;å¸Œå°”æ’åºåçš„ç¬¬3è½®ç»“æœä¸ºï¼š&quot; + Arrays.toString(arr));</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§æ–¹å¼ç§»ä½æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¯¹å¸Œå°”æ’åºè¿›è¡Œä¼˜åŒ–ï¼Œæˆ‘ä»¬ä½¿ç”¨ä½ç§»æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">shellSort2</span><span class="params">(<span class="type">int</span> [] arr)</span> &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">gap</span> <span class="operator">=</span> arr.length / <span class="number">2</span> ; gap &gt; <span class="number">0</span> ; gap /= <span class="number">2</span>) &#123;</span><br><span class="line"><span class="comment">//ä»ç¬¬gapä¸ªå…ƒç´ ï¼Œé€ä¸ªå¯¹å…¶æ‰€åœ¨çš„ç»„è¿›è¡Œç›´æ¥æ’å…¥æ’åº</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> gap ; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i;</span><br><span class="line"><span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr[j];</span><br><span class="line"><span class="keyword">if</span>(arr[j] &lt; arr[j - gap]) &#123;</span><br><span class="line"><span class="keyword">while</span>(j - gap &gt;= <span class="number">0</span> &amp;&amp; temp &lt; arr[j - gap]) &#123;</span><br><span class="line"><span class="comment">//ç§»åŠ¨</span></span><br><span class="line">arr[j] = arr[j-gap];</span><br><span class="line">j -= gap;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å½“é€€å‡ºwhileåï¼Œå°±ç»™tempæ‰¾åˆ°æ’å…¥çš„ä½ç½®</span></span><br><span class="line">arr[j] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//System.out.println(Arrays.toString(arr));</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç§»ä½æ³•åï¼Œæˆ‘ä»¬å‘ç°æ—¶é—´å¿«äº†å¾ˆå¤šå€ã€‚</p><h4 id="7-3-5-å¿«é€Ÿæ’åº">7.3.5 å¿«é€Ÿæ’åº</h4><p>å¿«é€Ÿæ’åºæ˜¯å¯¹å†’æ³¡æ’åºçš„ä¸€ç§æ”¹è¿›ï¼Œå…¶<strong>åŸºæœ¬æ€æƒ³è®¾è®¡</strong>:é€šè¿‡ä¸€è¶Ÿæ’åºå°†è¦æ’åºçš„æ•°æ®åˆ†å‰²æˆç‹¬ç«‹çš„ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†çš„æ‰€æœ‰æ•°æ®éƒ½æ¯”å¦ä¸€éƒ¨åˆ†çš„æ‰€æœ‰æ•°æ®éƒ½è¦å°ï¼Œç„¶åæŒ‰ç…§æ¬¡æ–¹æ³•å¯¹è¿™ä¸¤éƒ¨åˆ†æ•°æ®åˆ†åˆ«è¿›è¡Œå¿«é€Ÿæ’åºï¼Œæ•´ä¸ªæ’åºè¿‡ç¨‹éƒ½å¯ä»¥é€’å½’è¿›è¡Œï¼Œä¾æ­¤è¾¾åˆ°æ•´ä¸ªæ•°æ®å˜æˆæœ‰åºåºåˆ—ã€‚</p><ol><li>å¿«é€Ÿæ’åºï¼Œåœ¨åºåˆ—ä¸­æ‰¾ä¸€ä¸ªåŸºå‡†æ•°ï¼Œç„¶åå°†æ‰€æœ‰æ¯”åŸºæ•°å°çš„æ”¾åˆ°åŸºæ•°çš„å·¦è¾¹ï¼Œæ‰€æœ‰æ¯”åŸºæ•°å¤§çš„æ•°æ”¾åˆ°åŸºå‡†æ•°çš„å³è¾¹ã€‚ç„¶åå†å¯¹å·¦å³ä¸¤ä¸ªå­åºåˆ—é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼ŒçŸ¥é“åºåˆ—ä¸­æ‰€æœ‰çš„æ•°éƒ½æ’åºå¥½ã€‚</li><li>æˆ‘çš„ç†è§£ï¼Œæ‰¾åˆ°ä¸€ä¸ªä¸­ä½æ•°ï¼Œæ¯”ä¸­ä½æ•°å°çš„æ”¾å·¦è¾¹ï¼Œæ¯”ä¸­ä½æ•°å¤§çš„æ”¾å³è¾¹ï¼Œç›´åˆ°æ‰€æœ‰çš„æ•°éƒ½æ’å¥½åºä¸ºæ­¢ã€‚</li></ol><p>å¿«é€Ÿæ’åºçš„æ€è·¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuickSort</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//int [] arr = &#123;-9,78,0,23,-567,70&#125;;</span></span><br><span class="line"><span class="type">int</span> [] arr = <span class="keyword">new</span> <span class="title class_">int</span> [<span class="number">80000</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; <span class="number">80000</span> ; i ++) &#123;</span><br><span class="line">arr[i] = (<span class="type">int</span>)(Math.random() * <span class="number">80000</span>); <span class="comment">//ç”Ÿæˆä¸€ä¸ª[0,80000)çš„éšæœºæ•°</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">Date</span> <span class="variable">date1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="comment">//è¾“å‡ºä¸€ä¸ªæ—¥æœŸæ ¼å¼</span></span><br><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">dateStr</span> <span class="operator">=</span> simpleDateFormat.format(date1);</span><br><span class="line">System.out.println(<span class="string">&quot;æ’åºå‰çš„æ—¶é—´ä¸º=&quot;</span> + dateStr);</span><br><span class="line"></span><br><span class="line">quickSort(arr, <span class="number">0</span>,arr.length - <span class="number">1</span>);</span><br><span class="line"><span class="comment">//shellSort(arr);</span></span><br><span class="line"><span class="comment">//æµ‹è¯•å†’æ³¡æ’åº</span></span><br><span class="line"><span class="type">Date</span> <span class="variable">date2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="type">String</span> <span class="variable">dateStr2</span> <span class="operator">=</span> simpleDateFormat.format(date2);</span><br><span class="line">System.out.println(<span class="string">&quot;è¾“å‡ºæ’åºåçš„æ—¶é—´&quot;</span> + dateStr2);</span><br><span class="line"><span class="comment">//System.out.println(&quot;arr:&quot; + Arrays.toString(arr));</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¿«é€Ÿæ’åºæ€»ä»£ç </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">quickSort</span><span class="params">(<span class="type">int</span> [] arr ,<span class="type">int</span> left,<span class="type">int</span> right)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span> left;<span class="comment">//å·¦ä¸‹æ ‡</span></span><br><span class="line"><span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> right ;<span class="comment">// å³ä¸‹æ ‡</span></span><br><span class="line"><span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">// pivot ä¸­å€¼</span></span><br><span class="line"><span class="type">int</span> <span class="variable">pivot</span> <span class="operator">=</span> arr[(left + right) /<span class="number">2</span> ];</span><br><span class="line"><span class="comment">//whileå¾ªç¯çš„ç›®çš„æ˜¯è®©pivotå€¼å°æ”¾åˆ°å³è¾¹</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(l &lt; r) &#123;</span><br><span class="line"><span class="keyword">while</span>(arr[l] &lt; pivot) &#123;</span><br><span class="line">l += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åœ¨pivotçš„å³è¾¹ä¸€ç›´æ‰¾ï¼Œæ‰¾åˆ°å°äºç­‰äºpivotå€¼ï¼Œæ‰é€€å‡º</span></span><br><span class="line"><span class="keyword">while</span>(arr[r] &gt; pivot) &#123;</span><br><span class="line">r -= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¦‚æœ l &gt;= r è¯´æ˜pivotçš„å·¦å³ä¸¤è¾¹çš„å€¼,å·²ç»æŒ‰ç…§å·¦è¾¹å…¨éƒ¨æ˜¯</span></span><br><span class="line"><span class="comment">//å°äºç­‰äºpivotå€¼ï¼Œå³è¾¹å…¨éƒ¨æ˜¯å¤§äºç­‰äºpivotçš„å€¼</span></span><br><span class="line"><span class="keyword">if</span>( l &gt;= r) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//äº¤æ¢</span></span><br><span class="line">temp = arr[l];</span><br><span class="line">arr[l] = arr[r];</span><br><span class="line">arr[r] = temp;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¦‚æœäº¤æ¢å®Œåï¼Œå‘ç°è¿™ä¸ªarr[l] == pivotå€¼ç›¸ç­‰ -- ï¼Œå‰ç§»</span></span><br><span class="line"><span class="keyword">if</span>(arr[l] == pivot) &#123;</span><br><span class="line">r -= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¦‚æœäº¤æ¢å®Œåï¼Œå‘ç°è¿™ä¸ªarr[r] == pivotå€¼ç›¸ç­‰ l ++ ,åç§»</span></span><br><span class="line"><span class="keyword">if</span>(arr[r] == pivot) &#123;</span><br><span class="line">l += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¦‚æœl == r,å¿…é¡»l++,r-- ,å¦åˆ™å‡ºç°æ ˆæº¢å‡º</span></span><br><span class="line"><span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">l += <span class="number">1</span>;</span><br><span class="line">r -= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å‘å·¦é€’å½’</span></span><br><span class="line"><span class="keyword">if</span>(left &lt; r) &#123;</span><br><span class="line">quickSort(arr, left, r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å‘å³é€’å½’</span></span><br><span class="line"><span class="keyword">if</span>(right &gt; l) &#123;</span><br><span class="line">quickSort(arr, l, right);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="7-3-6-å½’å¹¶æ’åº">7.3.6 å½’å¹¶æ’åº</h4><p>å½’å¹¶æ’åºæ˜¯ä¸€ç§åˆ†æ²»ç®—æ³•ã€‚</p><p>å®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯å°†ä¸¤ä¸ªå·²ç»æ’åºçš„åºåˆ—åˆå¹¶æˆä¸€ä¸ªåºåˆ—ã€‚å…·ä½“æ¥è¯´ï¼Œ<strong>å°±æ˜¯å°†ä¸€ä¸ªåºåˆ—åˆ†æˆä¸¤ä¸ªå­åºåˆ—ï¼Œç„¶åå¯¹è¿™ä¸¤ä¸ªå­åºåˆ—åˆ†åˆ«è¿›è¡Œæ’åºï¼Œæœ€åå°†æ’å¥½åºçš„ä¸¤ä¸ªå­åºåˆ—åˆå¹¶æˆä¸€ä¸ªæœ‰åºåºåˆ—ã€‚</strong></p><p>å½’å¹¶æ’åºçš„è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š<strong>åˆ†è§£å’Œåˆå¹¶</strong>ã€‚</p><p>åœ¨åˆ†è§£æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å°†åºåˆ—ä¸æ–­åˆ†è§£æˆæ›´å°çš„å­åºåˆ—ï¼Œç›´åˆ°æ¯ä¸ªå­åºåˆ—åªåŒ…å«ä¸€ä¸ªå…ƒç´ ã€‚è¿™æ—¶ï¼Œæ¯ä¸ªå­åºåˆ—éƒ½æ˜¯æœ‰åºçš„ã€‚</p><p>åœ¨åˆå¹¶æ­¥éª¤ä¸­ï¼Œ<strong>æˆ‘ä»¬å°†ä¸¤ä¸ªæœ‰åºçš„å­åºåˆ—åˆå¹¶æˆä¸€ä¸ªæœ‰åºçš„åºåˆ—</strong>ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬ä»ä¸¤ä¸ªå­åºåˆ—çš„å¼€å¤´å¼€å§‹æ¯”è¾ƒå®ƒä»¬çš„å…ƒç´ ï¼Œæ¯æ¬¡å–å‡ºè¾ƒå°çš„å…ƒç´ æ”¾å…¥ç»“æœåºåˆ—ä¸­ï¼Œå¹¶å°†æŒ‡å‘è¯¥å…ƒç´ çš„æŒ‡é’ˆåç§»ä¸€ä½ã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°å…¶ä¸­ä¸€ä¸ªå­åºåˆ—ä¸ºç©ºã€‚ç„¶åå†å°†å¦ä¸€ä¸ªå­åºåˆ—ä¸­å‰©ä½™çš„å…ƒç´ å…¨éƒ¨æ”¾å…¥ç»“æœåºåˆ—ä¸­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MergetSort</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">System.out.println();</span><br><span class="line"><span class="type">int</span> arr [] = &#123;<span class="number">8</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">2</span>&#125;;</span><br><span class="line"><span class="type">int</span> temp [] = <span class="keyword">new</span> <span class="title class_">int</span> [arr.length] ;<span class="comment">//å½’å¹¶æ’åºéœ€è¦ä¸€ä¸ªé¢å¤–ç©ºé—´</span></span><br><span class="line">mergeSort(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>, temp);</span><br><span class="line">System.out.println(<span class="string">&quot;å½’å¹¶æ’åºå = &quot;</span> + Arrays.toString(arr));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ†+å’Œçš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">mergeSort</span><span class="params">(<span class="type">int</span> [] arr,<span class="type">int</span> left, <span class="type">int</span> right, <span class="type">int</span> [] temp)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(left &lt; right) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (left + right) /<span class="number">2</span> ;<span class="comment">//ä¸­é—´ç´¢å¼•</span></span><br><span class="line"><span class="comment">//å‘å·¦é€’å½’è¿›è¡Œåˆ†è§£</span></span><br><span class="line">mergeSort(arr, left, mid, temp);</span><br><span class="line"><span class="comment">//å‘å³é€’å½’è¿›è¡Œåˆ†è§£</span></span><br><span class="line">mergeSort(arr, mid+<span class="number">1</span>, right, temp);</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ°åˆå¹¶</span></span><br><span class="line">merget(arr, left, mid, right, temp);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå¹¶çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> arr æ’åºçš„åŸå§‹æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> left å·¦è¾¹æœ‰åºåºåˆ—çš„åˆå§‹ç´¢å¼•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> mid ä¸­é—´ç´¢å¼•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> right å³è¾¹ç´¢å¼•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> temp åšä¸­è½¬çš„æ•°ç»„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">merget</span><span class="params">(<span class="type">int</span> [] arr, <span class="type">int</span> left , <span class="type">int</span> mid, <span class="type">int</span> right, <span class="type">int</span> [] temp)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> left; <span class="comment">//åˆå§‹åŒ–i,å·¦è¾¹æœ‰åºåºåˆ—çš„åˆå§‹ç´¢å¼•</span></span><br><span class="line"><span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> mid + <span class="number">1</span>;  <span class="comment">//åˆå§‹åŒ–j,å³è¾¹æœ‰åºåºåˆ—çš„åˆå§‹ç´¢å¼•</span></span><br><span class="line"><span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//æŒ‡å‘tempæ•°ç»„çš„å½“å‰ç´¢å¼•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ï¼ˆ1ï¼‰</span></span><br><span class="line"><span class="comment">//å…ˆæŠŠå·¦å³ä¸¤è¾¹çš„(æœ‰åº)çš„æ•°æ®æŒ‰ç…§è§„åˆ™å¡«å……åˆ°tempæ•°ç»„</span></span><br><span class="line"><span class="comment">//ç›´åˆ°å·¦å³ä¸¤è¾¹çš„æœ‰åºåºåˆ—ï¼Œæœ‰ä¸€è¾¹å¤„ç†å®Œæ¯•ä¸ºæ­¢</span></span><br><span class="line"><span class="keyword">while</span>(i &lt;= mid &amp;&amp; j &lt;= right) &#123;  <span class="comment">//ç»§ç»­</span></span><br><span class="line"><span class="comment">//å¦‚æœå·¦è¾¹çš„æœ‰åºåºåˆ—çš„å½“å‰å…ƒç´ ï¼Œå°äºç­‰äºå³è¾¹æœ‰åºåºåˆ—çš„å½“å‰å…ƒç´ </span></span><br><span class="line"><span class="comment">//å³å°†å·¦è¾¹çš„å½“å‰å…ƒç´ ï¼Œæ‹·è´åˆ°tempæ•°ç»„</span></span><br><span class="line"><span class="comment">//ç„¶å</span></span><br><span class="line"><span class="keyword">if</span>(arr[i] &lt;= arr[j]) &#123;</span><br><span class="line">temp [t] = arr[i];</span><br><span class="line">t += <span class="number">1</span>;</span><br><span class="line">i += <span class="number">1</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//åä¹‹ï¼Œå°†å³è¾¹çš„æœ‰åºåºåˆ—çš„å½“å‰å…ƒç´ ï¼Œå¡«å……åˆ°tempæ•°ç»„</span></span><br><span class="line">temp[t] = arr[j];</span><br><span class="line">t += <span class="number">1</span>;</span><br><span class="line">j += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//(2) æŠŠæœ‰å‰©ä½™æ•°æ®çš„ä¸€è¾¹çš„æ•°æ®ä¾æ¬¡å…¨éƒ¨å¡«å……åˆ°temp</span></span><br><span class="line"><span class="keyword">while</span>(i &lt;= mid) &#123; <span class="comment">//å·¦è¾¹çš„æœ‰åºåºåˆ—è¿˜æœ‰å‰©ä½™çš„å…ƒç´ ï¼Œå°±å…¨éƒ¨å¡«å……åˆ°temp</span></span><br><span class="line">temp[t]  = arr[i];</span><br><span class="line">t += <span class="number">1</span>;</span><br><span class="line">i += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(j &lt;= right) &#123; <span class="comment">//å³è¾¹çš„æœ‰åºåºåˆ—è¿˜æœ‰å‰©ä½™çš„å…ƒç´ ï¼Œå°±å…¨éƒ¨å¡«å……åˆ°tempä¸­</span></span><br><span class="line">temp[t] = arr[j];</span><br><span class="line">t += <span class="number">1</span>;</span><br><span class="line">j += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//(3)å°†tempæ•°ç»„çš„å…ƒç´ æ‹·è´åˆ°arr</span></span><br><span class="line"><span class="comment">//æ³¨æ„ï¼Œå¹¶éæ¯æ¬¡éƒ½æ‹·è´æ‰€æœ‰</span></span><br><span class="line"> t = <span class="number">0</span>;</span><br><span class="line"> <span class="type">int</span> <span class="variable">tempLeft</span> <span class="operator">=</span> left;</span><br><span class="line"> System.out.println(<span class="string">&quot;tempLeft=&quot;</span> + tempLeft + <span class="string">&quot;,right=&quot;</span> + right);</span><br><span class="line"> <span class="keyword">while</span>(tempLeft &lt;= right) &#123;  </span><br><span class="line"> <span class="comment">////ç¬¬ä¸€æ¬¡åˆå¹¶tempLeft = 0,right = 1// tempLeft = 2  right = 3;// tL = 0,right = 3</span></span><br><span class="line"> <span class="comment">//æœ€åä¸€æ¬¡ï¼ŒtL = 0,right = 7;</span></span><br><span class="line"> arr[tempLeft] = temp[t];</span><br><span class="line"> t += <span class="number">1</span>;</span><br><span class="line"> tempLeft += <span class="number">1</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç»è¿‡æ—¶é—´æµ‹è¯•æˆ‘ä»¬å‘ç°å…¶é€Ÿåº¦å¾ˆå¿«ã€‚</p><h4 id="7-3-7-åŸºæ•°æ’åº">7.3.7 åŸºæ•°æ’åº</h4><ol><li>åŸºæ•°æ’åºå±äºä¸€ç§åˆ†é…å¼æ’åºï¼Œåˆç§°ä¸ºæ¡¶å­æ³•ï¼Œbin sort ï¼Œé¡¾åæ€æ„ï¼Œæ˜¯é€šè¿‡é”®å€¼çš„å„ä¸ªä½çš„å€¼ï¼Œå°†è¦æ’åºçš„å…ƒç´ åˆ†é…åˆ°æŸäº›æ¡¶ä¸­ï¼Œè¾¾åˆ°æ’åºçš„ä½œç”¨ã€‚</li><li>åŸºæ•°æ’åºæ˜¯ä¸€ç§ç¨³å®šçš„æ’åºï¼ŒåŸºæ•°æ’åºæ³•çš„æ˜¯æ•ˆç‡é«˜çš„ç¨³å®šæ€§æ’åºæ³•</li><li>åŸºæ•°æ’åºæ˜¯æ¡¶æ’åºçš„æ‰©å±•</li><li>åŸºæ•°æ’åºèµ·æºäº1887å¹´èµ«å°”æ›¼.ä½•ä¹ç¤¼å‘æ˜çš„ï¼Œå°†æ•´æ•°æŒ‰ç…§ä½æ•°åˆ‡å‰²æˆä¸åŒçš„æ•°å­—ï¼Œç„¶åæŒ‰æ¯ä¸ªä½æ•°åˆ†åˆ«æ¯”è¾ƒã€‚</li><li>æ‰€æœ‰å¾…æ¯”è¾ƒæ•°å€¼ç»Ÿä¸€ä¸ºåŒæ ·çš„æ•°ä½é•¿åº¦ï¼Œ<strong>æ•°ä½è¾ƒçŸ­çš„æ•°å‰é¢è¡¥é›¶</strong>ã€‚ç„¶åï¼Œ<strong>ä»æœ€ä½ä½å¼€å§‹</strong>ï¼Œä¾æ¬¡è¿›è¡Œä¸€æ¬¡æ’åºã€‚è¿™æ ·ä»<strong>æœ€ä½ä½æ’åºä¸€ç›´åˆ°æœ€é«˜ä½æ’åºå®Œæˆä»¥å</strong>, æ•°åˆ—å°±å˜æˆä¸€ä¸ªæœ‰åºåºåˆ—</li></ol><p>æ€è·¯ï¼š</p><ol><li>ä½¿ç”¨åŸºæ•°æ’åºï¼Œè¿›è¡Œå‡åºæ’åº</li><li>å°†æ¯ä¸ªå…ƒç´ çš„å„ä½æ•°å–å‡ºï¼Œç„¶åçœ‹è¿™ä¸ªæ•°åº”è¯¥æ”¾åœ¨å“ªä¸ªå¯¹åº”çš„æ¡¶</li><li>æŒ‰ç…§è¿™ä¸ªæ¡¶çš„é¡ºåº(ä¸€ç»´æ•°ç»„çš„ä¸‹æ ‡å–å‡ºæ•°æ®ï¼Œæ”¾å…¥åŸæ¥æ•°ç»„ï¼‰</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RadixSort</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">int</span>[] arr=&#123;<span class="number">53</span>, <span class="number">3</span>, <span class="number">542</span>, <span class="number">748</span>, <span class="number">14</span>, <span class="number">214</span>&#125;;</span><br><span class="line">bucketSort(arr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">bucketSort</span><span class="params">(<span class="type">int</span>[] arr)</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œå¾—åˆ°æ¯ä¸ªä¸‹æ ‡ä¸‹çš„ä¸ªæ•°</span></span><br><span class="line"><span class="type">int</span>[] bucketRecord=<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>];</span><br><span class="line"><span class="comment">//å®šä¹‰æ¡¶ç©ºé—´ï¼Œåˆå§‹åŒ–äºŒç»´æ•°ç»„</span></span><br><span class="line"><span class="type">int</span>[][] bucket=<span class="keyword">new</span> <span class="title class_">int</span>[arr.length][<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="comment">//ä¸ªä½æ•°çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="type">int</span> sub=arr[i]/<span class="number">1</span>%<span class="number">10</span>;</span><br><span class="line"><span class="comment">//ç»™æ¡¶é‡Œé¢èµ‹å€¼</span></span><br><span class="line">bucket[bucketRecord[sub]][sub]=arr[i];</span><br><span class="line"><span class="comment">//å¹¶ä¸”è®°å½•å½“å‰æ¡¶é‡Œé¢å…ƒç´ ä¸ªæ•°ï¼ŒåŠ 1</span></span><br><span class="line">bucketRecord[sub]= bucketRecord[sub]+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ’åˆ—å„ä¸ªæ¡¶ï¼Œä»ç¬¬ä¸€åˆ—å¼€å§‹</span></span><br><span class="line"><span class="comment">//ç¬¬1è½®</span></span><br><span class="line"><span class="type">int</span> index=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; bucketRecord.length; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (bucketRecord[i]&gt;<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; bucketRecord[i]; j++) &#123;</span><br><span class="line">arr[index++]=bucket[j][i];</span><br><span class="line">bucket[j][i]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">bucketRecord[i]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">index=<span class="number">0</span>;</span><br><span class="line">System.out.println(<span class="string">&quot;ç¬¬1æ¬¡æ’åºåå¾—åˆ°çš„ç»“æœï¼š&quot;</span>+ Arrays.toString(arr));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬2è½®</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="comment">//åä½æ•°çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="type">int</span> sub=arr[i]/<span class="number">10</span>%<span class="number">10</span>;</span><br><span class="line"><span class="comment">//ç»™æ¡¶é‡Œé¢èµ‹å€¼</span></span><br><span class="line">bucket[bucketRecord[sub]][sub]=arr[i];</span><br><span class="line"><span class="comment">//å¹¶ä¸”è®°å½•å½“å‰æ¡¶é‡Œé¢å…ƒç´ ä¸ªæ•°ï¼ŒåŠ 1</span></span><br><span class="line">bucketRecord[sub]= bucketRecord[sub]+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ’åˆ—å„ä¸ªæ¡¶ï¼Œä»ç¬¬ä¸€åˆ—å¼€å§‹</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; bucketRecord.length; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (bucketRecord[i]&gt;<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; bucketRecord[i]; j++) &#123;</span><br><span class="line">arr[index++]=bucket[j][i];</span><br><span class="line">bucket[j][i]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">bucketRecord[i]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">index=<span class="number">0</span>;</span><br><span class="line">System.out.println(<span class="string">&quot;ç¬¬2æ¬¡æ’åºåå¾—åˆ°çš„ç»“æœï¼š&quot;</span>+ Arrays.toString(arr));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬3è½®</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="comment">//ç™¾ä½æ•°çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="type">int</span> sub=arr[i]/<span class="number">100</span>%<span class="number">10</span>;</span><br><span class="line"><span class="comment">//ç»™æ¡¶é‡Œé¢èµ‹å€¼</span></span><br><span class="line">bucket[bucketRecord[sub]][sub]=arr[i];</span><br><span class="line"><span class="comment">//å¹¶ä¸”è®°å½•å½“å‰æ¡¶é‡Œé¢å…ƒç´ ä¸ªæ•°ï¼ŒåŠ 1</span></span><br><span class="line">bucketRecord[sub]= bucketRecord[sub]+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ’åˆ—å„ä¸ªæ¡¶ï¼Œä»ç¬¬ä¸€åˆ—å¼€å§‹</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; bucketRecord.length; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (bucketRecord[i]&gt;<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; bucketRecord[i]; j++) &#123;</span><br><span class="line">arr[index++]=bucket[j][i];</span><br><span class="line">bucket[j][i]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">bucketRecord[i]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">index=<span class="number">0</span>;</span><br><span class="line">System.out.println(<span class="string">&quot;ç¬¬3æ¬¡æ’åºåå¾—åˆ°çš„ç»“æœï¼š&quot;</span>+ Arrays.toString(arr));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨forå¾ªç¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RadixSort2</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">int</span>[] arr=&#123;<span class="number">53</span>, <span class="number">3</span>, <span class="number">542</span>, <span class="number">78</span>, <span class="number">14</span>, <span class="number">214</span>,<span class="number">12</span>,<span class="number">24</span>,<span class="number">56</span>,<span class="number">66</span>,<span class="number">70</span>&#125;;</span><br><span class="line">bucket(arr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">maxLength</span><span class="params">(<span class="type">int</span>[] arr)</span>&#123;</span><br><span class="line"><span class="type">int</span> max=arr[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (max&lt;arr[i])&#123;</span><br><span class="line">max=arr[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> length=(max+<span class="string">&quot;&quot;</span>).length();</span><br><span class="line"><span class="keyword">return</span> length;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">bucket</span><span class="params">(<span class="type">int</span>[] arr)</span>&#123;</span><br><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªäºŒç»´æ•°ç»„ä½œä¸ºæ¡¶</span></span><br><span class="line"><span class="type">int</span>[][] bucket=<span class="keyword">new</span> <span class="title class_">int</span>[arr.length][<span class="number">10</span>];</span><br><span class="line"><span class="comment">//æ¯ä¸€ä¸ªæ¡¶é‡Œé¢æœ‰å‡ ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="type">int</span>[] bucketRecord=<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>];</span><br><span class="line"><span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> maxLength(arr);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">z</span> <span class="operator">=</span> <span class="number">0</span>, n=<span class="number">1</span>; z &lt; length; n=n*<span class="number">10</span>,z++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="comment">//ä¸ªä½æ•°çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="type">int</span> sub=arr[i]/n%<span class="number">10</span>;</span><br><span class="line"><span class="comment">//ç»™æ¡¶é‡Œé¢èµ‹å€¼</span></span><br><span class="line">bucket[bucketRecord[sub]][sub]=arr[i];</span><br><span class="line"><span class="comment">//å¹¶ä¸”è®°å½•å½“å‰æ¡¶é‡Œé¢å…ƒç´ ä¸ªæ•°ï¼ŒåŠ 1</span></span><br><span class="line">bucketRecord[sub]= bucketRecord[sub]+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ’åˆ—å„ä¸ªæ¡¶ï¼Œä»ç¬¬ä¸€åˆ—å¼€å§‹</span></span><br><span class="line"><span class="type">int</span> index=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; bucketRecord.length; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (bucketRecord[i]&gt;<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; bucketRecord[i]; j++) &#123;</span><br><span class="line">arr[index++]=bucket[j][i];</span><br><span class="line">bucket[j][i]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">bucketRecord[i]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;ç¬¬&quot;</span>+z+<span class="string">&quot;æ¬¡æ’åºåå¾—åˆ°çš„ç»“æœï¼š&quot;</span>+Arrays.toString(arr));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸºæ•°æ’åºæ˜¯å¯¹ä¼ ç»Ÿæ¡¶æ’åºçš„æ‰©å±•ï¼Œ<strong>é€Ÿåº¦å¾ˆå¿«</strong>.</p><p>åŸºæ•°æ’åºæ˜¯ç»å…¸çš„ç©ºé—´æ¢æ—¶é—´çš„æ–¹å¼ï¼Œ<strong>å ç”¨å†…å­˜å¾ˆå¤§</strong>, å½“å¯¹æµ·é‡æ•°æ®æ’åºæ—¶ï¼Œå®¹æ˜“é€ <strong>OutOfMemoryError</strong> åŸºæ•°æ’åº<strong>æ—¶ç¨³å®šçš„</strong>ã€‚</p><p>[æ³¨:å‡å®šåœ¨å¾…æ’åºçš„è®°å½•åºåˆ—ä¸­ï¼Œå­˜åœ¨å¤šä¸ªå…·æœ‰ç›¸åŒçš„å…³é”®å­—çš„è®°å½•ï¼Œè‹¥ç»è¿‡æ’åºï¼Œè¿™äº›è®°å½•çš„ç›¸å¯¹æ¬¡åºä¿æŒä¸å˜ï¼Œå³åœ¨åŸåºåˆ—ä¸­ï¼Œr[i]=r[j]ï¼Œä¸”r[i]åœ¨r[j]ä¹‹å‰ï¼Œè€Œåœ¨æ’åºåçš„åºåˆ—ä¸­ï¼Œr[i]ä»åœ¨r[j]ä¹‹å‰ï¼Œåˆ™ç§°è¿™ç§æ’åºç®—æ³•æ˜¯ç¨³å®šçš„ï¼›å¦åˆ™ç§°ä¸ºä¸ç¨³å®šçš„] æœ‰è´Ÿæ•°çš„æ•°ç»„</p><h4 id="7-3-8-å †æ’åº">7.3.8 å †æ’åº</h4><h2 id="8-æŸ¥æ‰¾">8. æŸ¥æ‰¾</h2><h3 id="8-1-çº¿æ€§æŸ¥æ‰¾">8. 1 çº¿æ€§æŸ¥æ‰¾</h3><p>å¾ˆç®€å•çš„æŸ¥æ‰¾æ–¹å¼,é€šè¿‡é€ä¸€æ¯”å¯¹ï¼Œå¾—åˆ°ç›®æ ‡å€¼ï¼Œç„¶åå‘¢è¿”å›ä¸‹æ ‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SeqSearch</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String [] args)</span>&#123;</span><br><span class="line">        <span class="type">int</span> [] arr = &#123;<span class="number">7</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">11</span>,<span class="number">434</span>,<span class="number">55</span>,<span class="number">0</span>,<span class="number">23</span>&#125;;</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> seqSearch(arr,<span class="number">55</span>);</span><br><span class="line">        <span class="keyword">if</span>(index == -<span class="number">1</span>)&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;æ²¡æœ‰æŸ¥æ‰¾åˆ°&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ‰¾åˆ°äº†ï¼Œä¸‹æ ‡ä¸ºï¼š&quot;</span> + index);</span><br><span class="line">System.out.println(<span class="string">&quot;æ­¤æ—¶è¾“å‡ºçš„ç»“æœä¸ºï¼š&quot;</span> + arr[index]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">seqSearch</span><span class="params">(<span class="type">int</span> [] arr ,<span class="type">int</span> value)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span> ; i &lt; arr.length ; i ++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(value == arr[i])&#123;</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-2-äºŒåˆ†æŸ¥æ‰¾">8.2 äºŒåˆ†æŸ¥æ‰¾</h3><ol><li>ç¡®å®šæ•°ä¸­é—´çš„ä¸‹æ ‡ mid = (right + left) / 2;</li><li>ç„¶åè®©éœ€è¦æŸ¥æ‰¾çš„æ•°findValueå’Œarr[mid] æ¯”è¾ƒ<ol><li>findVal &gt; arr[mid]ï¼Œè¯´æ˜ä½ è¦æŸ¥æ‰¾çš„æ•°ï¼Œåœ¨midçš„å³è¾¹ï¼Œå› æ­¤éœ€è¦é€’å½’çš„å‘å³æŸ¥æ‰¾</li><li>å¦‚æœfindVal &lt; arr[mid],è¯´æ˜ä½ è¦æŸ¥æ‰¾çš„æ•°åœ¨midçš„å·¦è¾¹ï¼Œå› æ­¤éœ€è¦é€’å½’çš„å‘å·¦è¾¹æŸ¥æ‰¾</li><li>findVal == arr[mid] è¯´æ˜æ‰¾åˆ°ï¼Œå°±è¿”å›</li></ol></li><li>ä»€ä¹ˆæ—¶å€™æˆ‘ä»¬éœ€è¦ç»“æŸé€’å½’<ol><li>æ‰¾åˆ°å°±ç»“æŸé€’å½’</li><li>é€’å½’å®Œæ•´æ•´ä¸ªæ•°ç»„ï¼Œä»ç„¶æ²¡æœ‰æ‰¾åˆ°findValï¼Œä¹Ÿéœ€è¦ç»“æŸé€’å½’ï¼Œå½“left &gt; rightå°±éœ€è¦é€€å‡º</li></ol></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BinarySearch</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">int</span> [] arr = &#123;<span class="number">1</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">24</span>,<span class="number">56</span>,<span class="number">78</span>&#125;;</span><br><span class="line"><span class="type">int</span> <span class="variable">resIndex</span> <span class="operator">=</span> binarySearch(arr, <span class="number">0</span>, arr.length -<span class="number">1</span>, <span class="number">78</span>);</span><br><span class="line"><span class="keyword">if</span>(resIndex == -<span class="number">1</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;æ­¤æ—¶æ²¡æ‰¾åˆ°&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;æ‰¾åˆ°äº†ï¼Œå…¶ä¸‹æ ‡ä¸ºï¼š&quot;</span> + resIndex);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//äºŒåˆ†æŸ¥æ‰¾ç®—æ³•</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> arr æ•°ç»„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> left  å·¦è¾¹çš„ç´¢å¼•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> right å³è¾¹çš„ç´¢å¼•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> findVal è¦æŸ¥è¯¢çš„å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> å¦‚æœæ‚æ‰¾åˆ°å°±è¿”å›ä¸‹æ ‡ï¼Œå¦‚æœæ²¡æ‰¾åˆ°å°±è¿”å›-1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearch</span><span class="params">(<span class="type">int</span> [] arr ,<span class="type">int</span> left,<span class="type">int</span> right,<span class="type">int</span> findVal)</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™é‡Œæœ‰ä¸ªbug ï¼Œå¦‚æœæ‰¾ä¸åˆ°å€¼ï¼Œé‚£ä¹ˆé€’å½’å°±ä¸ä¼šç§æ¤å¯¼è‡´å¼‚å¸¸</span></span><br><span class="line"><span class="keyword">if</span>(left &gt; right) &#123;</span><br><span class="line"><span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (left + right) / <span class="number">2</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">midVal</span> <span class="operator">=</span> arr[mid];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(findVal &gt; midVal) &#123;  <span class="comment">//å‘å³é€’å½’</span></span><br><span class="line"><span class="keyword">return</span> binarySearch(arr, mid +<span class="number">1</span>, right, findVal);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(findVal &lt; midVal)&#123; <span class="comment">//å‘å·¦é€’å½’</span></span><br><span class="line"><span class="keyword">return</span> binarySearch(arr, left, mid - <span class="number">1</span>, findVal);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> mid;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹é¢˜ï¼š</p><p>å½“ä¸€ä¸ªæœ‰åºæ•°ç»„ä¸­ï¼Œæœ‰å¤šä¸ªç›¸åŒçš„æ•°æ®æ—¶ï¼Œå¦‚æœå°†æ‰€æœ‰çš„æ•°å€¼éƒ½æŸ¥æ‰¾åˆ°ï¼Œæ¯”å¦‚è¿™é‡Œçš„1000</p><p>arr={12,23,34,44,45,46,46,46,47,48};</p><ol><li>åœ¨æ‰¾åˆ°midç´¢å¼•å€¼ï¼Œä¸è¦é©¬ä¸Šè¿”å›</li><li>å‘midç´¢å¼•å€¼çš„å·¦è¾¹æ‰«æï¼Œå°†æ‰€æœ‰æ»¡è¶³46çš„å…ƒç´ çš„ä¸‹æ ‡ï¼ŒåŠ å…¥åˆ°arrayList</li><li>å‘midç´¢å¼•å€¼çš„å³è¾¹æ‰«æï¼Œå°†æ‰€æœ‰æ»¡è¶³46çš„å…ƒç´ çš„ä¸‹æ ‡ï¼ŒåŠ å…¥åˆ°arrayList</li><li>å°†ArrayListè¿”å›</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BinarySearch</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">int</span> [] arr = &#123;<span class="number">1</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">12</span>,<span class="number">24</span>,<span class="number">56</span>,<span class="number">78</span>&#125;;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">int resIndex = binarySearch(arr, 0, arr.length -1, 12);</span></span><br><span class="line"><span class="comment">if(resIndex == -1) &#123;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;æ­¤æ—¶æ²¡æ‰¾åˆ°&quot;);</span></span><br><span class="line"><span class="comment">&#125;else &#123;</span></span><br><span class="line"><span class="comment">System.out.println(&quot;æ‰¾åˆ°äº†ï¼Œå…¶ä¸‹æ ‡ä¸ºï¼š&quot; + resIndex);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">BinarySearch2(arr, <span class="number">0</span>, arr.length -<span class="number">1</span>, <span class="number">12</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//äºŒåˆ†æŸ¥æ‰¾ç®—æ³•</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> arr æ•°ç»„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> left  å·¦è¾¹çš„ç´¢å¼•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> right å³è¾¹çš„ç´¢å¼•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> findVal è¦æŸ¥è¯¢çš„å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> å¦‚æœæ‚æ‰¾åˆ°å°±è¿”å›ä¸‹æ ‡ï¼Œå¦‚æœæ²¡æ‰¾åˆ°å°±è¿”å›-1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">binarySearch</span><span class="params">(<span class="type">int</span> [] arr ,<span class="type">int</span> left,<span class="type">int</span> right,<span class="type">int</span> findVal)</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿™é‡Œæœ‰ä¸ªbug ï¼Œå¦‚æœæ‰¾ä¸åˆ°å€¼ï¼Œé‚£ä¹ˆé€’å½’å°±ä¸ä¼šç§æ¤å¯¼è‡´å¼‚å¸¸</span></span><br><span class="line"><span class="keyword">if</span>(left &gt; right) &#123;</span><br><span class="line"><span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (left + right) / <span class="number">2</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">midVal</span> <span class="operator">=</span> arr[mid];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(findVal &gt; midVal) &#123;  <span class="comment">//å‘å³é€’å½’</span></span><br><span class="line"><span class="keyword">return</span> binarySearch(arr, mid +<span class="number">1</span>, right, findVal);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(findVal &lt; midVal)&#123; <span class="comment">//å‘å·¦é€’å½’</span></span><br><span class="line"><span class="keyword">return</span> binarySearch(arr, left, mid - <span class="number">1</span>, findVal);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> mid;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŸ¥æ‰¾æœ‰å¤šä¸ªç›¸åŒæ•°å€¼çš„å…¨éƒ¨è¿”å›</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">BinarySearch2</span><span class="params">(<span class="type">int</span>[] array,<span class="type">int</span> left,<span class="type">int</span> right, <span class="type">int</span> value)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (left + right)/<span class="number">2</span>;</span><br><span class="line">ArrayList&lt;Integer&gt; resIndexlist = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(value &lt; array[mid]) &#123;</span><br><span class="line">BinarySearch2(array,left,mid-<span class="number">1</span>,value);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(value &gt; array[mid]) &#123;</span><br><span class="line">BinarySearch2(array,mid+<span class="number">1</span>,right,value);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(mid);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> mid -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(temp &lt; <span class="number">0</span> ||array[temp]!= value) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">resIndexlist.add(temp);</span><br><span class="line">temp--;</span><br><span class="line">&#125;</span><br><span class="line">resIndexlist.add(mid);</span><br><span class="line"></span><br><span class="line">temp = mid + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(array[temp]!= value || temp &gt; array.length-<span class="number">1</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">resIndexlist.add(temp);</span><br><span class="line">temp++;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">System.out.println(resIndexlist.toString());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//return resIndexlist.toString();</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="8-3-å·®å€¼æŸ¥æ‰¾">8.3  å·®å€¼æŸ¥æ‰¾</h3><p>å·®å€¼æŸ¥æ‰¾ç®—æ³•æ˜¯åœ¨äºŒåˆ†æŸ¥æ‰¾ç®—æ³•çš„åŸºç¡€ä¸Šè¿›è¡Œè¿›ä¸€æ­¥è¿›è¡Œçš„ï¼Œå…¶æ˜¯åœ¨äºŒåˆ†æŸ¥æ‰¾çš„åŸºç¡€ä¸Šåšäº†ä¸€ç‚¹å°å°çš„ä¼˜åŒ–ï¼Œå…¶åŸºæœ¬æ€è·¯æ˜¯å°†åŸå…ˆå…¬å¼1çš„æ–¹å¼å˜æˆå…¬å¼2çš„æ–¹å¼ï¼Œç”±äºå…¶å–ä¸­ç‚¹å€¼çš„æ–¹å¼ä¸åŒï¼Œé€ æˆå…¶æ•ˆç‡ä¹Ÿä¸åŒï¼Œ</p><p>$$<br>å…¬å¼1 ï¼š mid = (low+hight)/2 = low + (hight - low)/2<br>$$</p><p>$$<br>å…¬å¼2ï¼š mid = low + (high - low)*( (key - a[low]))/(a[hight] - a[low])<br>$$</p><p>ç”±äºäºŒåˆ†æŸ¥æ‰¾éœ€è¦çš„æ¡ä»¶å°†æ•°ç»„è¿›è¡Œæœ‰åºæ’åˆ—ï¼Œæ•…è€Œå†åœ¨æ­¤lowä»£è¡¨å·¦è¾¹ï¼Œhightä»£è¡¨å³è¾¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InterpolationSearch</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;======== å·®å€¼æŸ¥æ‰¾åˆ†å¸ƒç•¥å¾®ä¸å‡åŒ€æ•°ç»„ ===========&quot;</span>);</span><br><span class="line"><span class="type">int</span> arr[] = &#123;<span class="number">1</span> ,<span class="number">4</span>, <span class="number">9</span>, <span class="number">15</span>, <span class="number">27</span>, <span class="number">49</span>, <span class="number">128</span>, <span class="number">157</span>&#125;;</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> interpolationSearch(arr, <span class="number">9</span>, <span class="number">0</span>, arr.length - <span class="number">1</span>);</span><br><span class="line">System.out.println(result==-<span class="number">1</span>?<span class="string">&quot;æœªæ‰¾åˆ°å…ƒç´ ï¼&quot;</span>:<span class="string">&quot;æŸ¥æ‰¾æˆåŠŸï¼&quot;</span> + <span class="number">9</span> + <span class="string">&quot;å¯¹åº”ä¸‹æ ‡ï¼š &quot;</span> + result);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;======== å·®å€¼æŸ¥æ‰¾åˆ†å¸ƒå‡åŒ€æ•°ç»„ ===========&quot;</span>);</span><br><span class="line"><span class="type">int</span> arr1[] = &#123;<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">16</span>, <span class="number">18</span> ,<span class="number">20</span>&#125;;</span><br><span class="line"><span class="type">int</span> <span class="variable">target</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">result1</span> <span class="operator">=</span> interpolationSearch(arr1, target, <span class="number">0</span>, arr1.length - <span class="number">1</span>);</span><br><span class="line">System.out.println(result1==-<span class="number">1</span>?<span class="string">&quot;æœªæ‰¾åˆ°å…ƒç´ ï¼&quot;</span>:<span class="string">&quot;æŸ¥æ‰¾æˆåŠŸï¼&quot;</span> + target + <span class="string">&quot;å¯¹åº”ä¸‹æ ‡ï¼š &quot;</span> + result1);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;======== å·®å€¼æŸ¥æ‰¾åˆ†å¸ƒæå…¶ä¸å‡åŒ€æ•°ç»„ ===========&quot;</span>);</span><br><span class="line"><span class="type">int</span> arr2[] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>,<span class="number">99999</span>&#125;;</span><br><span class="line"><span class="type">int</span> <span class="variable">target2</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">result2</span> <span class="operator">=</span> interpolationSearch(arr2, target2, <span class="number">0</span>, arr2.length - <span class="number">1</span>);</span><br><span class="line">System.out.println(result2==-<span class="number">1</span>?<span class="string">&quot;æœªæ‰¾åˆ°å…ƒç´ ï¼&quot;</span>:<span class="string">&quot;æŸ¥æ‰¾æˆåŠŸï¼&quot;</span> + target2 + <span class="string">&quot;å¯¹åº”ä¸‹æ ‡ï¼š &quot;</span> + result2);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">interpolationSearch</span><span class="params">(<span class="type">int</span> []arr, <span class="type">int</span> target ,<span class="type">int</span> left , <span class="type">int</span> right)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(target &lt; arr[left] || target &gt; arr[right] || left &gt; right) &#123;</span><br><span class="line"><span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">leftToTarget</span> <span class="operator">=</span> target - arr[left];</span><br><span class="line"><span class="type">int</span> <span class="variable">rightToLeft</span> <span class="operator">=</span> arr[right] - arr[left];</span><br><span class="line"><span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> right - left;</span><br><span class="line"><span class="comment">//ä¸­é—´çš„å€¼çš„ä¸‹æ ‡ï¼Œæ³¨æ„æ­¤è¡Œä¸äºŒåˆ†æŸ¥æ‰¾çš„åŒºåˆ«</span></span><br><span class="line"><span class="type">int</span> <span class="variable">mid</span>  <span class="operator">=</span> left + (leftToTarget * num) /rightToLeft;</span><br><span class="line">System.out.println(<span class="string">&quot;æ‰¾äº†ä¸€æ¬¡ï¼Œä¸­é—´å€¼ä¸ºï¼š&quot;</span> + mid);</span><br><span class="line"><span class="comment">//ç›®æ ‡å€¼å°äºä¸­é—´å€¼ï¼Œ å–å¾—å·¦ä¾§</span></span><br><span class="line"><span class="keyword">if</span>(arr[mid] &gt; target &amp;&amp; left &lt;= right) &#123;</span><br><span class="line"><span class="comment">//é€’å½’å·¦ä¾§</span></span><br><span class="line"><span class="keyword">return</span> interpolationSearch(arr, target, left, mid - <span class="number">1</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(arr[mid] &lt; target &amp;&amp; left &lt;= right) &#123;</span><br><span class="line"><span class="comment">//ç›®æ ‡å€¼å¤§äºä¸­é—´çš„å€¼å–å¾—å³ä¾§ï¼Œå¹¶ä¸”é€’å½’</span></span><br><span class="line"><span class="keyword">return</span> interpolationSearch(arr, target, mid + <span class="number">1</span>, right);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//ä¸å¤§äºä¹Ÿä¸å°äº åˆ™æ˜¯ç­‰äº</span></span><br><span class="line"><span class="keyword">return</span> mid;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-4-æ–æ³¢é‚£å¥‘æŸ¥æ‰¾">8.4 æ–æ³¢é‚£å¥‘æŸ¥æ‰¾</h3><p>æ–æ³¢é‚£å¥‘æŸ¥æ‰¾ç®—æ³•ï¼Œåˆè¢«ç§°ä¸ºé»„é‡‘åˆ†å‰²æ³•ï¼Œæ˜¯ä¸€ç§æœ‰åºçš„æŸ¥æ‰¾ç®—æ³•ã€‚æ–æ³¢é‚£å¥‘æ•°åˆ—è¢«ç§°ä¸ºé»„é‡‘åˆ†å‰²æ•°åˆ—ï¼Œå…¶æ•°åˆ—å¦‚ï¼š 1,1,2,3,5,8,13,31â€¦ã€‚åœ¨æ•°å­¦ä¸Šï¼Œå…¶é€’å½’æ–¹æ³•è¢«å®šä¹‰ä¸º<br>$$<br>F(n) = F(n-1) + F(n - 2) (n&gt;=2).<br>$$<br>è¯¥æ•°åˆ—è¶Šå¾€åçš„ä¸¤ä¸ªæ•°çš„æ¯”å€¼è¶‹å‘äºé»„é‡‘æ¯”ä¾‹0.618</p><p><strong>æ–æ³¢é‚£å¥‘æŸ¥æ‰¾æ˜¯åœ¨äºŒåˆ†æŸ¥æ‰¾çš„åŸºç¡€ä¸Šæ ¹æ®æ–æ³¢é‚£å¥‘æ•°åˆ—è¿›è¡Œåˆ†å‰²</strong>ã€‚åœ¨æ–æ³¢é‚£å¥‘æ•°åˆ—æ‰¾ä¸€ä¸ªç­‰äºå¤§äºæŸ¥æ‰¾è¡¨ä¸­å…ƒç´ ä¸ªæ•°çš„æ•°F(n),å°†åŸæŸ¥æ‰¾è¡¨æ‰©å±•ä¸ºé•¿åº¦ä¸ºF(n)(å¦‚æœè¦è¡¥å……å…ƒç´ ï¼Œåˆ™è¡¥å……é‡å¤æœ€åä¸€ä¸ªå…ƒç´ ï¼Œç›´åˆ°æ»¡è¶³F(n)ä¸ªå…ƒç´ )ï¼Œå®Œæˆåè¿›è¡Œæ–æ³¢é‚£å¥‘åˆ†å‰²ï¼Œ<strong>å³F[n]ä¸ªå…ƒç´ åˆ†å‰²ä¸ºå‰åŠéƒ¨åˆ†F(n-1)ä¸ªå…ƒç´ ï¼ŒååŠéƒ¨åˆ†F(n-2)ä¸ªå…ƒç´ ï¼Œæ‰¾å‡ºè¦æŸ¥æ‰¾çš„å…ƒç´ åœ¨é‚£ä¸€éƒ¨åˆ†å¹¶é€’å½’</strong>ï¼Œç›´åˆ°æ‰¾åˆ°ã€‚<strong>æ–æ³¢é‚£å¥‘æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(log2n)</strong>ã€‚</p><blockquote><p>1ï¼‰ç”±æ–æ³¢é‚£å¥‘æ•°åˆ— F[k]=F[k-1]+F[k-2] çš„æ€§è´¨ï¼Œå¯ä»¥å¾—åˆ° ï¼ˆF[k]-1ï¼‰=ï¼ˆF[k-1]-1ï¼‰+ï¼ˆF[k-2]-1ï¼‰+1 ã€‚è¯¥å¼è¯´æ˜ï¼šåªè¦é¡ºåºè¡¨çš„é•¿åº¦ä¸ºF[k]-1ï¼Œåˆ™å¯ä»¥å°†è¯¥è¡¨åˆ†æˆé•¿åº¦ä¸ºF[k-1]-1å’ŒF[k-2]-1çš„ä¸¤æ®µï¼Œå³å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚ä»è€Œä¸­é—´ä½ç½®ä¸ºmid=low+F(k-1)-1ï¼›</p><p>2ï¼‰æ¯ä¸€å­æ®µä¹Ÿå¯ä»¥ç”¨ç›¸åŒçš„æ–¹å¼åˆ†å‰²ï¼›</p><p>3ï¼‰è‹¥é¡ºåºè¡¨é•¿åº¦nä¸ä¸€å®šåˆšå¥½ç­‰äºF[k]-1ï¼Œåˆ™éœ€è¦å°†åŸæ¥çš„é¡ºåºè¡¨é•¿åº¦nå¢åŠ è‡³F[k]-1ã€‚è¿™é‡Œçš„kå€¼åªè¦èƒ½ä½¿å¾—F[k]-1æ°å¥½å¤§äºæˆ–ç­‰äºnå³å¯ã€‚</p></blockquote><p>ä¾‹å¦‚ï¼šåŸæ•°ç»„ä¸º{1,5,6,33,55,233,455}ï¼Œé•¿åº¦nä¸º7ï¼Œè‹¥ F[ k ] - 1ç­‰äº9ï¼Œåˆ™åº”è¯¥å°†åŸæ•°ç»„æ‰©å®¹åˆ°9ï¼Œå¤šå‡ºçš„ä½ç½®ä½¿ç”¨highä½ç½®çš„455å¡«å……ï¼Œå³å¾—åˆ°{1,5,6,33,55,233,455,455,455}ã€‚</p><p>ä»£ç å®ç°</p><blockquote><p>ï¼ˆ1ï¼‰æˆ‘ä»¬éœ€è¦å…ˆé€’å½’å®ç°æ–æ³¢æ‹‰å¥‘æ•°åˆ—ï¼Œç„¶åæ ¹æ®åŸæ•°ç»„çš„å¤§å°è®¡ç®—æ–æ³¢æ‹‰å¥‘æ•°åˆ—çš„kå€¼ï¼›</p><p>ï¼ˆ2ï¼‰æ•°ç»„æ‰©å®¹æ¡ä»¶æ˜¯ï¼š<strong>å¢å¤§ k å€¼ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ï¼Œä½¿å¾—æ•°ç»„é•¿åº¦åˆšå¥½å¤§äºæˆ–è€…ç­‰äºæ–æ³¢é‚£å¥‘æ•°åˆ—ä¸­çš„ F[k]-1 ï¼Œæˆ‘ä»¬å®šä¹‰ä¸´æ—¶æ•°ç»„ temp ï¼Œtemp åé¢ä¸º 0 çš„å…ƒç´ éƒ½æŒ‰ç…§æ•°ç»„æœ€å¤§å…ƒç´ å€¼å¡«å……</strong>ï¼›</p><p>ï¼ˆ3ï¼‰midå€¼çš„ç¡®å®šï¼š<strong>mid = low + f[k - 1] - 1</strong>Â ï¼Œå³ç”¨é»„é‡‘åˆ†å‰²ç‚¹ç¡®å®š mid çš„å€¼ï¼›</p><p>ï¼ˆ4ï¼‰<strong>value&lt;temp[mid]</strong>Â ï¼šç›®æ ‡å€¼åœ¨é»„é‡‘åˆ†å‰²ç‚¹çš„å·¦è¾¹ï¼Œå› ä¸ºå…¨éƒ¨å…ƒç´  = å‰é¢çš„å…ƒç´  + åè¾¹å…ƒç´ å³ f[k] = f[k-1] + f[k-2]ï¼Œåˆå‰é¢æœ‰ f[k-1]ä¸ªå…ƒç´ ,æ‰€ä»¥å¯ä»¥ç»§ç»­æ‹†åˆ† f[k-1] = f[k-2] + f[k-3]ï¼Œå³ä¸‹æ¬¡å¾ªç¯æœ‰mid=low+f[k-1-1]+1ï¼Œå³éœ€è¦<strong>k-=1</strong>ï¼›</p><p><strong>value&gt; temp[mid]</strong>Â ï¼šç›®æ ‡å€¼åœ¨é»„é‡‘åˆ†å‰²ç‚¹çš„å³è¾¹ã€‚å› ä¸ºå…¨éƒ¨å…ƒç´  = å‰é¢çš„å…ƒç´  + åè¾¹å…ƒç´ å³ f[k] = f[k-1] + f[k-2]ï¼Œåˆå‰é¢æœ‰ f[k-2]ä¸ªå…ƒç´ ,æ‰€ä»¥å¯ä»¥ç»§ç»­æ‹†åˆ† f[k-1] = f[k-3] + f[k-4]ï¼Œå³ä¸‹æ¬¡å¾ªç¯æœ‰mid=low+f[k-1-2]+1ï¼Œå³éœ€è¦<strong>k-=2</strong>ï¼›</p><p>**value== temp[mid] ï¼š**æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œå› ä¸ºæ•°ç»„ç»å†è¿‡æ‰©å®¹ï¼Œåé¢çš„å€¼å…¶å®æœ‰äº›æ˜¯å¤šä½™çš„ï¼Œmid å¯èƒ½ä¼šè¶Šç•Œï¼ˆç›¸å¯¹äºåŸæ•°ç»„æ¥è¯´ï¼‰åˆ™æœ‰ï¼š 1ï¼‰<strong>mid &lt;= high ï¼šè¯æ˜ mid ç´¢å¼•åœ¨åŸæ•°ç»„ä¸­ï¼Œè¿”å› mid</strong>ï¼› 2ï¼‰<strong>mid &gt; high æ—¶ï¼Œè¯æ˜ mid ç´¢å¼•å·²ç»è¶Šç•Œï¼ˆç›¸å¯¹äºåŸæ•°ç»„æ¥è¯´ï¼‰ï¼Œè¿”å› high</strong>ï¼›</p><p>ï¼ˆ5ï¼‰è‹¥æ²¡æœ‰æ‰¾åˆ°åˆ™è¿”å›-1ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FibonacciSearch</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">int</span> arr[] = &#123;<span class="number">1</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">33</span>,<span class="number">55</span>,<span class="number">233</span>,<span class="number">455</span>&#125;;</span><br><span class="line">Arrays.sort(arr); <span class="comment">//æ—¢ç„¶æ˜¯äºŒåˆ†æŸ¥æ‰¾è¡ç”Ÿå‡ºæ¥çš„ï¼Œé‚£ä¹ˆå°±éœ€è¦å…ˆå¯¹æ•°ç»„æ’åºï¼Œæ— è®ºæ•°ç»„æ˜¯å¦æ’å¥½åºï¼Œè¿™æ ·åšæ€»å…±æ˜¯ä¸€ç§æ–¹å¼</span></span><br><span class="line"><span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">55</span>;<span class="comment">//è¦æŸ¥æ‰¾çš„å€¼</span></span><br><span class="line"><span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> fibonacciSearch(arr, value);</span><br><span class="line">System.out.println(temp == -<span class="number">1</span> ? <span class="string">&quot;æ²¡æ‰¾åˆ°ä½ æ‰€è¦çš„å€¼ï¼Œå¯èƒ½ä½ è¦æŸ¥æ‰¾çš„å€¼å¹¶ä¸åœ¨æ–æ³¢é‚£å¥‘æ•°åˆ—ä¹‹ä¸­,ä½ è¦æŸ¥æ‰¾çš„å€¼ä¸º:&quot;</span>+value :<span class="string">&quot;æ‚¨æŸ¥æ‰¾çš„å€¼ä¸º&quot;</span>+value+<span class="string">&quot;å…¶ä¸‹æ ‡ä¸º&quot;</span>+temp );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">maxSize</span> <span class="operator">=</span> <span class="number">20</span>; <span class="comment">//æ–æ³¢é‚£å¥‘æ•°åˆ—çš„å¤§å°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> [] fibonacci() &#123; <span class="comment">//æ„å»ºä¸€ä¸ªæ–æ³¢é‚£å¥‘æ•°åˆ—</span></span><br><span class="line"><span class="type">int</span>[] fib = <span class="keyword">new</span> <span class="title class_">int</span> [maxSize];</span><br><span class="line">fib[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">fib[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt; maxSize ; i++ ) &#123;</span><br><span class="line">fib[i] = fib[i - <span class="number">1</span>] + fib [i -<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> fib;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">fibonacciSearch</span><span class="params">(<span class="type">int</span> [] arr ,<span class="type">int</span> value )</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//æŒ‡é’ˆlowè¡¨ç¤ºå¾…æŸ¥å…ƒç´ æ‰€åœ¨èŒƒå›´çš„ä¸‹ç•Œï¼Œä¸‹ç•Œç´¢å¼•ä»0å¼€å§‹</span></span><br><span class="line"><span class="type">int</span> <span class="variable">high</span> <span class="operator">=</span> arr.length - <span class="number">1</span> ; <span class="comment">//æŒ‡é’ˆhighè¡¨ç¤ºå¾…æŸ¥å…ƒç´ æ‰€åœ¨èŒƒå›´çš„ä¸Šç•Œ</span></span><br><span class="line"><span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span> ;<span class="comment">// è¡¨ç¤ºæ–æ³¢é‚£å¥‘åˆ†å‰²æ•°å€¼çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> fib[] = fibonacci(); <span class="comment">//è·å–åˆ°æ–æ³¢é‚£å¥‘æ•°åˆ—</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(high &gt; fib[k] - <span class="number">1</span>) &#123;<span class="comment">//è·å–åˆ°æ–æ³¢é‚£å¥‘åˆ†å‰²æ•°å€¼çš„ä¸‹æ ‡</span></span><br><span class="line">k ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å› ä¸ºf[k]å€¼ï¼Œå¯èƒ½å¤§äºaçš„é•¿åº¦ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨Arrays.copyOfæ–¹æ³•ï¼Œæ„é€ ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå¹¶æŒ‡å‘temp[]</span></span><br><span class="line"><span class="type">int</span> [] temp = Arrays.copyOf(arr, fib[k]);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> high + <span class="number">1</span>; i &lt; temp.length ; i++ ) &#123;</span><br><span class="line"><span class="comment">//ä½¿ç”¨arræ•°ç»„æœ€åçš„æ•°å¡«å……temp</span></span><br><span class="line">temp[i] = arr[high];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(low &lt; high) &#123;</span><br><span class="line">mid = low + fib[k - <span class="number">1</span>] -<span class="number">1</span>; <span class="comment">//æ–æ³¢é‚£å¥‘ä¸­å€¼å…¬å¼</span></span><br><span class="line"><span class="keyword">if</span>(value &lt; temp[mid]) &#123;</span><br><span class="line"><span class="comment">//å…³é”®å­å€¼å°äºä¸­é—´å€¼ï¼Œåº”è¯¥å‘å·¦æ‰«æå³ä½¿high = mid - 1</span></span><br><span class="line">high = mid - <span class="number">1</span>;</span><br><span class="line">k -= <span class="number">1</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(value &gt; temp[mid]) &#123; <span class="comment">//å…³é”®å­—å€¼å¤§äºä¸­é—´å€¼ï¼Œåº”è¯¥å‘å³æ‰«æï¼Œå³ä½¿low = mid + 1</span></span><br><span class="line">low = mid + <span class="number">1</span>;</span><br><span class="line">k -= <span class="number">2</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123; <span class="comment">//æ‰¾åˆ°æ—¶éœ€è¦è¿”å›å“ªä¸ªä¸‹æ ‡</span></span><br><span class="line"><span class="keyword">if</span>(mid &lt;= high) &#123; <span class="comment">//è¯æ˜midç´¢å¼•åœ¨åŸæ•°ç»„ä¸­ï¼Œè¿”å›mid</span></span><br><span class="line"><span class="keyword">return</span> mid;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//è¯æ˜midç´¢å¼•å·²ç»è¶Šç•Œï¼ˆç›¸å¯¹äºåŸæ•°ç»„æ¥è¯´ï¼‰ï¼Œè¿”å›high</span></span><br><span class="line"><span class="keyword">return</span> high;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> - <span class="number">1</span>; <span class="comment">//æ²¡æœ‰æ‰¾åˆ°å³è¿”å› - 1</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬æ–‡ä¸»è¦æ˜¯ç¬”è€…åœ¨å­¦ä¹ javaæ•°æ®ç»“æ„å’Œç®—æ³•çš„ç¬”è®°</summary>
    
    
    
    <category term="javaå­¦ä¹ " scheme="https://luoxiaohei520.github.io/categories/java%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="javaå­¦ä¹ " scheme="https://luoxiaohei520.github.io/tags/java%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>å®‰è£…çºªå½•</title>
    <link href="https://luoxiaohei520.github.io/posts/c0b97cce.html"/>
    <id>https://luoxiaohei520.github.io/posts/c0b97cce.html</id>
    <published>2023-11-09T02:50:23.341Z</published>
    <updated>2023-11-09T02:50:23.341Z</updated>
    
    <content type="html"><![CDATA[<h1>Vueå®‰è£…å’Œå­¦ä¹ </h1><p><code>npm install</code></p><p><code>npm run  dev</code></p><h2 id="å…‹éš†é¡¹ç›®">å…‹éš†é¡¹ç›®</h2><p>git clone <a href="https://github.com/daxiongYang/renren-fast-vue.git">https://github.com/daxiongYang/renren-fast-vue.git</a></p><h2 id="å®‰è£…ä¾èµ–">å®‰è£…ä¾èµ–</h2><ol><li><p>npm install -g cnpm --registry=https://registry.npm.taobao.org</p></li><li><p>cnpm install</p></li></ol><h2 id="å¯åŠ¨æœåŠ¡">å¯åŠ¨æœåŠ¡</h2><p>npm run dev</p><hr><p>é¡¹ç›®é…ç½®  ï¼š  1 é“¾æ¥æ•°æ®åº“  å¼€å¯è™šæ‹Ÿæœº<br>2 å¼€å¯nocas<br>3 å¼€å¯ vue åç«¯ç®¡ç†ç•Œé¢ npm run dev<br>4</p><p>vue å‰ç«¯ç™»å½•  admin admin</p><p>nacos  ç™»å½•  nacos  nacos</p><h2 id="Vueå¸è½½">Vueå¸è½½</h2><blockquote><p>å®˜æ–¹è§£é‡Š<br>å…³äºæ—§ç‰ˆæœ¬</p><p>Vue CLI çš„åŒ…åç§°ç”± vue-cli æ”¹æˆäº† @vue/cliã€‚ å¦‚æœä½ å·²ç»å…¨å±€å®‰è£…äº†æ—§ç‰ˆæœ¬çš„ vue-cli (1.x æˆ– 2.x)ï¼Œä½ éœ€è¦å…ˆé€šè¿‡ npm uninstall vue-cli -g æˆ– yarn global remove vue-cli å¸è½½å®ƒã€‚</p><p>è¿™æ˜¯vue-cli 3.0ç‰ˆæœ¬çš„å¸è½½</p><p>å°ç¼–ä¹‹å‰æ²¡æ³¨æ„ æ¯æ¬¡å¸è½½ ä¸çŸ¥é“æ€ä¹ˆå›äº‹è€æ˜¯å¸è½½ä¸äº†ï¼Œå› ä¸ºå°ç¼–ä¸€å¼€å§‹å°±å®‰è£…çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå‡ ä¹éƒ½æ˜¯4.xxçš„</p><p>åæ¥å„ç§ç™¾åº¦ ç»ˆäºçŸ¥é“äº†</p><p><a href="//xn--3-zx8au75p.xn--0-bs6a41kww2ajwm24f">//å¸è½½3.0ä¹‹å‰çš„ç‰ˆæœ¬</a><br><code>npm uninstall -g vue-cli</code><br><code>yarn global remove vue-cli</code></p><p><a href="//xn--3-zx8au75p.xn--0-bs6a77pl5wjwm24f">//å¸è½½3.0ä¹‹åçš„ç‰ˆæœ¬</a>ï¼ˆå¯ä»¥ç»Ÿä¸€ä½¿ç”¨æ­¤æŒ‡ä»¤å¸è½½ï¼‰<br><code>npm uninstall -g @vue/cli</code><br><code>yarn global remove @vue/cli</code></p><p>å®‰è£…<br>ç„¶åæ˜¯å®‰è£…ï¼Œå°ç¼–æ˜¯çœ‹æ•™ç¨‹åœ¨å­¦ä¹  ä¹‹å‰æ²¡æ³¨æ„ç‰ˆæœ¬å·ï¼Œå„ç§å¯¹ä¸ä¸Šæ•™ç¨‹ã€‚ç»ˆäºæ³¨æ„åˆ°äº† æ•™ç¨‹æ˜¯3.3.0 ä¹Ÿæ˜¯å„ç§ç™¾åº¦ æ€ä¹ˆéƒ½å®‰è£…ä¸ä¸Š<br>ä¹‹å‰ç™¾åº¦åˆ°è¿™ä¸ªï¼š</p><p><a href="//xn--2-zb2b494k.9.xn--6-856b314a">//å®‰è£…2.9.6ç‰ˆæœ¬</a><br>npm install -g vue-cli@2.9.6<br>yarn global add vue-cli</p></blockquote><p>Vueæ¨¡å—åŒ–å¼€å‘:</p><ol><li><pre><code class="language-vue">npm install webpack -g<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    å…¨å±€å®‰è£…</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. ```</span><br><span class="line">   npm install -g @vue/cli-init</span><br></pre></td></tr></table></figure>å…¨å±€å®‰è£…vueè„šæ‰‹æ¶</code></pre></li><li><p>åˆå§‹åŒ–vueé¡¹ç›®</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue init webpack appname : <span class="type">vue</span> è„šæ‰‹æ¶ä½¿ç”¨webpackæ¨¡å—åˆå§‹åŒ–ä¸€ä¸ªappname(è‡ªå·±å®šä¹‰çš„)é¡¹ç›®</span><br></pre></td></tr></table></figure></li><li><p><code>cd vue-demo</code></p></li><li><p><code>npm run dev </code></p></li></ol><h2 id="vueå¼•å…¥Element-uiè·å–æœ€æ–°ç‰ˆæœ¬çš„èµ„æºï¼Œåœ¨é¡µé¢ä¸Šå¼•å…¥jså’Œcssæ–‡ä»¶å³å¯å¼€å§‹ä½¿ç”¨">vueå¼•å…¥Element-uiè·å–æœ€æ–°ç‰ˆæœ¬çš„èµ„æºï¼Œåœ¨é¡µé¢ä¸Šå¼•å…¥jså’Œcssæ–‡ä»¶å³å¯å¼€å§‹ä½¿ç”¨</h2><blockquote><p>npm  i element-ui -s</p></blockquote><p>ç„¶åmain.jså¯¼å…¥</p><p><code>import ElementUI from 'element-ui'</code>   //å¯¼å…¥vueå‰ç«¯Elementæ¡†æ¶</p><p><code>import 'element-ui/lib/theme-chalk/index.css';</code></p><p>Vue.use(ElementUI);</p><p><code>alt + shift + fè‡ªåŠ¨å¯¹é½ï¼ˆVSCodeï¼‰</code></p><h1>Dockerå®‰è£…å’Œç›¸å…³é…ç½®</h1><p>åœ¨å®‰è£…dockerä¹‹å‰æˆ‘ä»¬éœ€è¦å‡†å¤‡yumå·¥å…·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils \</span><br><span class="line">           device-mapper-persistent-data \</span><br><span class="line">           lvm2 --skip-broken</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ›´æ–°æœ¬åœ°é•œåƒæº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è®¾ç½®dockeré•œåƒæº</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">    </span><br><span class="line">sed -i &#x27;s/download.docker.com/mirrors.aliyun.com\/docker-ce/g&#x27; /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"></span><br><span class="line">yum makecache fast</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¹‹åè¾“å…¥å®‰è£…dockerå‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y docker-ce</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…³é—­é˜²ç«å¢™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å…³é—­</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¦æ­¢å¼€æœºå¯åŠ¨é˜²ç«å¢™</span></span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure><p>é€šè¿‡å‘½ä»¤å¯åŠ¨docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker  # å¯åŠ¨dockeræœåŠ¡</span><br><span class="line"></span><br><span class="line">systemctl stop docker  # åœæ­¢dockeræœåŠ¡</span><br><span class="line"></span><br><span class="line">systemctl restart docker  # é‡å¯dockeræœåŠ¡</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="é…ç½®é•œåƒåŠ é€Ÿ">é…ç½®é•œåƒåŠ é€Ÿ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">æ‚¨å¯ä»¥é€šè¿‡ä¿®æ”¹daemoné…ç½®æ–‡ä»¶/etc/docker/daemon.jsonæ¥ä½¿ç”¨åŠ é€Ÿå™¨</span><br><span class="line"></span><br><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://vwesipli.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>s</p><blockquote><p>docker -v  --æŸ¥çœ‹dockerç‰ˆæœ¬<br>docker images --æŸ¥çœ‹å½“å‰dockerè¿è¡Œ<br>sudo systemctl start docker --å¯åŠ¨docker åœ¨è™šæ‹Ÿæœºé‡Œè¾¹<br>docker images  --æœ‰æ—¶å€™æƒé™ä¸è¶³   æˆ‘ä»¬å˜ä¸º  sudo  docker images æ£€æŸ¥æˆ‘ä»¬è™šæ‹Ÿæœºé‡Œè¾¹æœ‰æ— ä¸‹è½½é•œåƒ<br>sudo systemctl enable docker      --è®¾ç½®å¼€æœºè‡ªå¯åŠ¨<br>docker é…ç½®é•œåƒåŠ é€Ÿ<br>1sudo mkdir -p /etc/docker<br>2sudo tee /etc/docker/daemon.json &lt;&lt;-â€˜EOFâ€™<br>{<br>â€œregistry-mirrorsâ€: [â€œ<a href="https://dcyzi7af.mirror.aliyuncs.com">https://dcyzi7af.mirror.aliyuncs.com</a>â€]<br>}<br>EOF<br>3sudo systemctl daemon-reload<br>4sudo systemctl restart docker</p><p>dockeræŒ‡ä»¤å®‰è£…mysql<br>1sudo docker pull mysql  --å®‰è£…æœ€æ–°çš„mysql<br>2sudo docker pull mysql:ç‰ˆæœ¬å·   æˆ‘ä½¿ç”¨çš„æ˜¯ mysql 8.0.2 --å®‰è£…æŒ‡å®šçš„ç‰ˆæœ¬å·</p><h3 id="å¯åŠ¨å®‰è£…çš„é•œåƒ">å¯åŠ¨å®‰è£…çš„é•œåƒ</h3><p>æ¯”å¦‚å¯åŠ¨ mysql:<br>docker run -p 3306:3306 --name mysql <br>-v /mydata/mysql/log:/var/log/mysql <br>-v /mydata/mysql/data:/var/lib/mysql <br>-v /mydata/mysql/conf:/etc/mysql <br>-e MYSQL_ROOT_PASSWORD=a <br>-d mysql:5.7</p></blockquote><p>è¿è¡Œmysql:</p><blockquote><p>docker run -p 3306:3306 --name mysql \</p><h2 id="v-mydata-mysql-log-var-log-mysql-v-mydata-mysql-data-var-lib-mysql-v-mydata-mysql-conf-etc-mysql-e-MYSQL-ROOT-PASSWORD-a-d-mysql-5-7">-v /mydata/mysql/log:/var/log/mysql <br>-v /mydata/mysql/data:/var/lib/mysql \<br>-v /mydata/mysql/conf:/etc/mysql \<br>-e MYSQL_ROOT_PASSWORD=a \<br>-d mysql:5.7</h2><h2 id="ä¸Šè¾¹æ˜¯mysql5-7çš„å¯åŠ¨æ–¹å¼-d-ä»£è¡¨ä»¥åå°æ–¹å¼è¿è¡Œ-p-3306-3306-å°†å®¹å™¨çš„3306ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„3306">ä¸Šè¾¹æ˜¯mysql5.7çš„å¯åŠ¨æ–¹å¼<br>-d ä»£è¡¨ä»¥åå°æ–¹å¼è¿è¡Œ<br>-p 3306:3306 å°†å®¹å™¨çš„3306ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„3306</h2><pre><code>  -p 3306ï¼š3306ï¼› å°†å®¹å™¨çš„3306ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„3306ç«¯å£  -v/mydata/mysgl/conf:/etc/mysgl  ï¼šå°†é…ç½®æ–‡ä»¶å¤«æŒ‚è½½åˆ°ä¸»æœº  -v/mydata/mysgl/log:/var/log/mysgl  ï¼šå°†æ—¥å¿—æ–‡ä»¶å¤¹æŒ‚è½½åˆ°ä¸»æœº  -w/mydata/mysgl/data:/var/lib/mysgl/  ï¼Œå°†é…ç½®æ–‡ä»¶å¤¹æŒ‚è½½åˆ°ä¸»æœº  -e MYSQL_ROOT_PASSWORD=root           ï¼šåˆå§‹åŒ–rootç”¨æˆ·çš„å¯†ç </code></pre><hr><p>æœ‰æ—¶å€™åˆ‡æ¢æƒé™éº»çƒ¦ æ‰€æœ‰æˆ‘ä»¬åˆ‡æ¢åˆ°<br>su root   --æƒé™æœ€é«˜<br>docker ps --æŸ¥çœ‹å½“å‰dockeræ­£åœ¨è¿è¡Œä¸­çš„ç¨‹åº</p><p>docker run -dit -p 3306:3306 mysql:8.0.2 bash  --å¯åŠ¨mysql 8.0.2</p><p>service mysql status     --æŸ¥çœ‹mysqlçš„çŠ¶æ€<br>service mysql start      --å¯åŠ¨mys</p><p>docker exec -it mysql /bin/bash  --è¿›å…¥mysqlå†…éƒ¨</p><p>whereis mysql<br>mysql: /usr/bin/mysql /usr/lib64/mysql /usr/share/mysql  /usr/share/man/man1/mysql.1.gz</p><hr></blockquote><p>docokeræŒ‡ä»¤</p><blockquote><p>ä¸€ã€æŸ¥çœ‹å®¹å™¨ï¼Œå¤åˆ¶å®¹å™¨id å³container id  <br>docker ps -a<br>äºŒã€åœæ­¢å®¹å™¨<br>docker stop ä½ çš„å®¹å™¨id<br>ä¸‰ã€åˆ é™¤å®¹å™¨<br>docker rm å®¹å™¨id<br>å››ã€æŸ¥çœ‹é•œåƒï¼Œå¤åˆ¶é•œåƒidå³images id<br>docker images<br>äº”ã€‚åˆ é™¤é•œåƒ</p><p>docker rmi é•œåƒid</p></blockquote><blockquote><p>è¿™æ˜¯æˆ‘è£…çš„<br>Mysql8.0å®‰è£…</p></blockquote><blockquote><p>1ã€æ‹‰å–mysqlé•œåƒ</p><p>docker pull mysql:8.0</p></blockquote><blockquote><p>2.docker run -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql</p><p>docker run -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=a -d mysql</p></blockquote><blockquote><p>3.docker exec -it mysql /bin/bash</p></blockquote><blockquote><p>4.mysql -uroot -p123456</p></blockquote><blockquote><p>5.use mysql;</p></blockquote><blockquote><p>6.ALTER USER â€˜rootâ€™@â€˜%â€™ IDENTIFIED BY â€˜123456â€™ PASSWORD EXPIRE NEVER;</p></blockquote><blockquote><p>7.ALTER USER â€˜rootâ€™@â€˜%â€™ IDENTIFIED WITH mysql_native_password BY â€˜123456â€™;</p></blockquote><blockquote><p>8.FLUSH PRIVILEGES;</p></blockquote><blockquote><p>9.ä¿®æ”¹å¯†ç <br>mysqladmin -uroot -pæ—§å¯†ç  password æ–°å¯†ç    --å¯†ç ä¸º 123456<br>æ³¨æ„ä¸€ä¸‹æˆ‘è£…çš„è™šæ‹Ÿæœºç«¯å£å·mysqlä¸º 3307</p></blockquote><blockquote><p>29adbe537c3e   mysql     â€œdocker-entrypoint.sâ€¦â€   52 minutes ago   Up 52 minutes   33060/tcp, 0.0.0.0:3307-&gt;3306/tcp, :::3307-&gt;3306/tcp   mysql</p><hr><p>é¦–å…ˆè¿›å…¥</p><p>1ã€docker exec -it mysql bash      //mysqlæ˜¯mysqlå®¹å™¨çš„åˆ«å</p><p>2ã€mysql -uroot -p</p><p>3ã€è¾“å…¥å¯†ç </p><p>4ã€è¿›å…¥mysql&gt;å‘½ä»¤è¡Œç•Œé¢</p><p>1,å®¹å™¨ä¸­ç™»å½•mysql,æŸ¥çœ‹mysqlçš„ç‰ˆæœ¬</p><p>mysql&gt; status;</p><hr><p>mysql  Ver 8.0.11 for Linux on x86_64 (MySQL Community Server - GPL)</p><p>2,è¿›è¡Œæˆæƒè¿œç¨‹è¿æ¥(æ³¨æ„mysql 8.0è·Ÿä¹‹å‰çš„æˆæƒæ–¹å¼ä¸åŒ)</p><p>æˆæƒ</p><p>GRANT ALL ON <em>.</em> TO â€˜rootâ€™@â€˜%â€™;</p><p>åˆ·æ–°æƒé™</p><p>flush privileges;</p><p>æ­¤æ—¶,è¿˜ä¸èƒ½è¿œç¨‹è®¿é—®,å› ä¸ºNavicatåªæ”¯æŒæ—§ç‰ˆæœ¬çš„åŠ å¯†,éœ€è¦æ›´æ”¹mysqlçš„åŠ å¯†è§„åˆ™</p><p>3,æ›´æ”¹åŠ å¯†è§„åˆ™</p><p>ALTER USER â€˜rootâ€™@â€˜localhostâ€™ IDENTIFIED BY â€˜aâ€™ PASSWORD EXPIRE NEVER;</p><p>4,æ›´æ–°rootç”¨æˆ·å¯†ç </p><p>ALTER USER â€˜rootâ€™@â€˜%â€™ IDENTIFIED WITH mysql_native_password BY â€˜aâ€™;</p><p>åˆ·æ–°æƒé™</p><p>flush privileges;</p><p>OKï¼Œè®¾ç½®å®Œæˆï¼Œå†æ¬¡ä½¿ç”¨ Navicat è¿æ¥æ•°æ®åº“</p></blockquote><h3 id="ä¸‹è½½redis">ä¸‹è½½redis</h3><p><code>docker pull redis</code></p><p>åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨<br><code>mkdir -p /mydata/redis/conf     </code></p><p><code>touch redis.conf</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 6379:6379 --name redis -v /mydata/redis/data:/data \</span><br><span class="line"></span><br><span class="line">   -v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line"></span><br><span class="line">   -d redis redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ls   æŸ¥çœ‹å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶<br><code> cat redis.conf</code></p><p>æµ‹è¯•redis</p><p><code>docker exec -it redis redis-cli</code></p><hr><p>ç”±äºä»¥å‰çš„æ•°æ®å…¨å­˜åœ¨å†…å­˜ä¸­ï¼Œä»è€Œæˆ‘ä»¬é‡å¤è¯»å–get açš„æ—¶å€™ä¼šå¯¼è‡´å¤±è´¥<br>[root@localhost conf]# <code>cat redis.conf</code><br>[root@localhost conf]# <code>docker exec -it redis redis-cli</code><br>127.0.0.1:6379&gt;<code> set a b</code><br>OK<br>127.0.0.1:6379&gt; <code>get a</code><br>â€œbâ€   //ä»è€Œåœ¨ä¸€æ¬¡ä¸Šæ¥çš„æ—¶å€™è¿™å—æ˜¯null<br>127.0.0.1:6379&gt; exit</p><p>â€“è®©redis æŒä¹…åŒ–  â€”&gt; pwd<br>127.0.0.1:6379&gt; exit<br>[root@localhost conf]# <code>pwd</code><br>/mydata/redis/conf<br>[root@localhost conf]# <code>ls</code><br>redis.conf<br>[root@localhost conf]# <code>vi redis.conf </code><br>æŒ‰  <code>i</code><br>è¾“å…¥<code>appendonly yes</code><br>æŒ‰<code>esc</code>  è¾“å…¥<code>:wq</code></p><p><code>docker restart redis  //é‡å¯redis</code><br>â€“è®¾ç½®å¼€æœºè‡ªå¯åŠ¨docker é‡Œè¾¹å®¹å™¨<br><code>sudo docker update &lt;å®¹å™¨å&gt; --restart=always</code></p><h1>LinuxæŒ‡ä»¤</h1><p>whoami  --è°çš„è´¦å·</p><p>ls /    ----æŸ¥çœ‹çš„å½“å‰è¿è¡Œçš„</p><p>~ å½“å‰ç”¨æˆ·ç›®å½•   /æ ¹ç›®å½•    . å½“å‰ç›®å½•   â€¦ ä¸Šä¸€çº§ç›®å½•<br>$ å½“å‰ç›®å½•   # root  ç”¨æˆ·ç›®å½•<br>åˆ›å»ºç›®å½• ï¼š mkdir &lt;ç›®å½•å&gt;<br>åˆ é™¤ç›®å½• ï¼š rmdir &lt;ç›®å½•å&gt;<br>åˆ é™¤ ï¼š rm  -rf  &lt;ç›®å½•æˆ–æ–‡ä»¶&gt;<br>ç§»åŠ¨ ï¼š mv<br>åˆ›å»ºæ–‡ä»¶ï¼štouch<br>æ‰“å¼€æ–‡ä»¶ï¼š vi  è¿›å…¥æ–‡ä»¶ç¼–è¾‘å æŒ‰ESC ç„¶åè¾“å…¥ï¼šwqå­˜å¹¶é€€å‡º  ï¼šq,ä¸ä¿å­˜é€€å‡º<br>æŸ¥çœ‹æ–‡ä»¶å†…å®¹ ï¼š cat</p><p>exit;   â€” é€€å‡º</p><p>whoamis --å½“å‰æ˜¯ä»€ä¹ˆç”¨æˆ·åœ¨ä½¿ç”¨</p><p>whereis mysql   --æŸ¥çœ‹åº”ç”¨å®‰è£…çš„ç›®å½• æ ¼å¼ï¼š  whereis åº”ç”¨å</p><p>æƒé™  äºŒè¿›åˆ¶<br>r(4 100)  w(2  010)  x(1 001) è¯» å†™ æ‰§è¡Œ<br>chmod æˆæƒç»™  ä¾‹å¦‚ chmod  775  software</p><p>//å®‰è£…ssh<br>sudo apt-get install openssh-server  sudo spt-get install ssh</p><h1>æˆ‘çš„Spring Cloudçš„é¡¹ç›®é…ç½®æ–‡ä»¶æŒ‡ä»¤ï¼š</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-machine -s &quot;E:\SoftWaves\dicker&quot; create --engine-registry-mirror=https://dcyzi7af.mirror.aliyuncs.com -d virtualbox default</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 6379:6379 redis:latest</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --hostname navy-rabbit -p 5672:5672 -p 15672:15672 rabbitmq:3.8.8-management</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æµè§ˆå™¨è¾“å…¥ipåœ°å€ï¼Œè¿›å…¥rabbitç®¡ç†ç•Œé¢ï¼š 192.168.99.100:15672</span><br></pre></td></tr></table></figure><p>rabbit è´¦å·å¯†ç ï¼š guest  guest</p>]]></content>
    
    
    <summary type="html">å®‰è£…è¿è¡Œç¯å¢ƒå’Œè½¯ä»¶çš„ç›¸å…³çºªå½•</summary>
    
    
    
    <category term="é”™è¯¯è®°å½•" scheme="https://luoxiaohei520.github.io/categories/%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="è¸©å‘è®°å½•" scheme="https://luoxiaohei520.github.io/tags/%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>Hexoçš„å¯åŠ¨æ–¹å¼</title>
    <link href="https://luoxiaohei520.github.io/posts/9b1154cd.html"/>
    <id>https://luoxiaohei520.github.io/posts/9b1154cd.html</id>
    <published>2023-11-09T02:50:23.341Z</published>
    <updated>2023-11-09T02:50:23.341Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start">Quick Start</h2><h3 id="Create-a-new-post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server">Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br><span class="line"></span><br><span class="line">hexo clean &amp;&amp; hexo generate &amp;&amp; hexo deploy  // Git BASHç»ˆç«¯</span><br><span class="line">hexo clean; hexo generate; hexo deploy  // VSCODEç»ˆç«¯</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">hexoçš„å¯åŠ¨æ–¹å¼</summary>
    
    
    
    <category term="æ¼”ç¤º" scheme="https://luoxiaohei520.github.io/categories/%E6%BC%94%E7%A4%BA/"/>
    
    
    <category term="æ¼”ç¤º" scheme="https://luoxiaohei520.github.io/tags/%E6%BC%94%E7%A4%BA/"/>
    
  </entry>
  
  <entry>
    <title>javaåŸºç¡€é¢è¯•é¢˜</title>
    <link href="https://luoxiaohei520.github.io/posts/df71ed7b.html"/>
    <id>https://luoxiaohei520.github.io/posts/df71ed7b.html</id>
    <published>2023-11-09T02:50:23.341Z</published>
    <updated>2023-11-09T02:50:23.341Z</updated>
    
    <content type="html"><![CDATA[<h3 id="javaè¯­è¨€æœ‰å“ªäº›ç‰¹å¾ï¼š">javaè¯­è¨€æœ‰å“ªäº›ç‰¹å¾ï¼š</h3><ol><li>ç®€å•æ˜“å­¦ï¼Œæœ‰ä¸°å¯Œçš„ç±»åº“</li><li>é¢å‘å¯¹è±¡ï¼Œé«˜å†…èšä½è€¦åˆ</li><li>å’Œå¹³å°æ— å…³æ€§ï¼Œå¯ä»¥åšåˆ°ä¸€æ¬¡ç¼–å†™æ°¸ä¹…ä½¿ç”¨ï¼ˆjvmåˆ™æ˜¯javaè·¨å¹³å°çš„æ ¹æœ¬ï¼‰</li><li>å®‰å…¨å¯é </li><li>æ”¯æŒå¤šçº¿ç¨‹</li></ol><h3 id="é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹">é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹</h3><p>**é¢å‘è¿‡ç¨‹ï¼š**åˆ†æè§£å†³é—®é¢˜çš„æ­¥éª¤ï¼Œç„¶åé€šè¿‡å‡½æ•°æŠŠè¿™äº›æ­¥éª¤ä¸€æ­¥ä¸€æ­¥åœ°å®ç°ï¼Œç„¶ååœ¨ä½¿ç”¨çš„æ—¶å€™ä¸€ä¸€è°ƒç”¨ï¼Œæ€§èƒ½æï¼Œæ‰€æœ‰å•ç‰‡æœºï¼ŒåµŒå…¥å¼å¼€å‘ä¸€èˆ¬é‡‡ç”¨é¢å‘è¿‡ç¨‹å¼€å‘ã€‚</p><p>**é¢å‘å¯¹è±¡ï¼š**ä¸–ä¸Šçš„ä¸‡äº‹ä¸‡ç‰©çš†å¯çœ‹åšå¯¹è±¡ï¼Œå°†æ„æˆé—®é¢˜çš„äº‹åŠ¡åˆ†è§£æˆä¸ºå„ä¸ªå¯¹è±¡ï¼Œè€Œå»ºç«‹å¯¹è±¡çš„ç›®çš„ä¹Ÿä¸æ˜¯å®Œæˆä¸€ä¸ªä¸ªæ­¥éª¤ï¼Œè€Œæ˜¯æè¿°æŸäº‹ç‰©åœ¨è§£å†³æ•´ä¸ªé—®é¢˜è¿‡ç¨‹ä¸­æ‰€å‘ç”Ÿçš„è¡Œä¸ºã€‚é¢å‘å¯¹è±¡æœ‰ä¸‰å¤§ç‰¹å¾ï¼Œå°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€ã€‚æ•…è€Œæ›´åŠ å®¹æ˜“ç»´æŠ¤ï¼Œå®¹æ˜“å¤ç”¨ï¼Œå®¹æ˜“æ‹“å±•ã€‚å¯ä»¥è®¾è®¡å‡ºä½è€¦åˆçš„ç³»ç»Ÿï¼Œä½†ä»æ€§èƒ½ä¸Šè®²ï¼Œæ¯”é¢å‘è¿‡ç¨‹è¦ä½ã€‚</p><h3 id="java8ç§æ•°æ®ç±»å‹">java8ç§æ•°æ®ç±»å‹</h3><hr><p>â€‹int short byte long</p><p>å­—èŠ‚                4                2                     1             8</p><p>é»˜è®¤å€¼             0               0                     0             0L</p><p>å°è£…ç±» Integer      Short           Byte Long</p><hr><p>â€‹float double</p><p>å­—èŠ‚               4                                 8</p><p>é»˜è®¤å€¼             0.0f                           0.0d</p><p>å°è£…ç±»            Float                           Double</p><hr><p>â€‹      boolean</p><p>å­—èŠ‚            -</p><p>é»˜è®¤å€¼          false</p><p>å°è£…ç±»          Boolean</p><hr><p>â€‹       char</p><p>å­—èŠ‚2</p><p>é»˜è®¤å€¼                null</p><p>å°è£…ç±»      Character</p><p><strong>æ³¨æ„ï¼š</strong></p><ol><li>int æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼ŒIntegeræ˜¯intçš„å°è£…ç±»ï¼Œæ˜¯å¼•ç”¨ç±»å‹ï¼Œinté»˜è®¤å€¼æ˜¯0ï¼Œè€ŒIntegeré»˜è®¤å€¼æ˜¯null,æ‰€ä»¥Integerèƒ½åŒºåˆ†å‡º0å’Œnullçš„æƒ…å†µï¼Œä¸€æ—¦javaçœ‹åˆ°nullï¼Œè¿™ä¸ªå¼•ç”¨è¿˜ä¹ˆæŒ‡å‘æŸä¸ªå¯¹è±¡ï¼Œåœ¨ä»»ä½•å¼•ç”¨ä½¿ç”¨å‰ï¼Œå¿…é¡»ä¸ºå…¶æŒ‡å®šä¸€ä¸ªå¯¹è±¡ï¼Œå¦åˆ™æŠ¥é”™</li><li>åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåœ¨å£°æ˜ä¹‹å‰ç³»ç»Ÿä¼šè‡ªåŠ¨ç»™ä»–åˆ†ç©ºé—´è€Œå¼•ç”¨ç±»å‹å£°æ˜æ—¶çŸ¥è¯†åˆ†é…äº†å¼•ç”¨ç©ºé—´ï¼Œå¿…é¡»é€šè¿‡è¯¥å®ä¾‹åŒ–å¼€è¾Ÿå¯¹è±¡ä¹‹åæ‰èƒ½èµ‹å€¼ï¼Œæ•°æ®å¯¹è±¡ä¹Ÿæ˜¯ä¸€ä¸ªå¼•ç”¨å¯¹è±¡ï¼Œå°†ä¸€ä¸ªæ•°ç»„èµ‹å€¼ç»™å¦ä¸€ä¸ªæ•°ç»„æ—¶åªæ˜¯å¤åˆ¶äº†ä¸€ä¸ªå¼•ç”¨ï¼Œæ‰€ä»¥é€šè¿‡æŸä¸€ä¸ªæ•°ç»„æ‰€åšçš„ä¿®æ”¹åœ¨å¦ä¸€ä¸ªæ•°ç»„ä¸­ä¹Ÿçœ‹å¾—è§ã€‚</li><li>è™½ç„¶å®šä¹‰äº†booleanè¿™ç§æ•°æ®ç±»å‹ï¼Œä½†æ˜¯åªå¯¹å®ƒæä¾›äº†éå¸¸æœ‰é™çš„æ”¯æŒã€‚åœ¨Javaè™šæ‹Ÿæœºä¸­æ²¡æœ‰ ä»»ä½•ä¾›booleanå€¼ä¸“ç”¨çš„å­—èŠ‚ç æŒ‡ä»¤ï¼ŒJavaè¯­è¨€è¡¨è¾¾å¼æ‰€æ“ä½œçš„booleanå€¼ï¼Œåœ¨ç¼–è¯‘ä¹‹åéƒ½ä½¿ç”¨Java è™šæ‹Ÿæœºä¸­çš„intæ•°æ®ç±»å‹æ¥ä»£æ›¿ï¼Œè€Œbooleanæ•°ç»„å°†ä¼šè¢«ç¼–ç æˆJavaè™šæ‹Ÿæœºçš„byteæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´  booleanå…ƒç´ å 8ä½ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥å¾—å‡ºbooleanç±»å‹å äº†å•ç‹¬ä½¿ç”¨æ˜¯4ä¸ªå­—èŠ‚ï¼Œåœ¨æ•°ç»„ä¸­åˆæ˜¯1ä¸ªå­— èŠ‚ã€‚ä½¿ç”¨intçš„åŸå› æ˜¯ï¼Œå¯¹äºå½“ä¸‹32ä½çš„å¤„ç†å™¨ï¼ˆCPUï¼‰æ¥è¯´ï¼Œä¸€æ¬¡å¤„ç†æ•°æ®æ˜¯32ä½ï¼ˆè¿™é‡Œä¸æ˜¯æŒ‡çš„ æ˜¯32/64ä½ç³»ç»Ÿï¼Œè€Œæ˜¯æŒ‡CPUç¡¬ä»¶å±‚é¢ï¼‰ï¼Œå…·æœ‰é«˜æ•ˆå­˜å–çš„ç‰¹ç‚¹ã€‚</li></ol><h3 id="instanceofå…³é”®å­—çš„ä½œç”¨">instanceofå…³é”®å­—çš„ä½œç”¨</h3><p>ç”¨æ¥æµ‹è¯•ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºä¸€ä¸ªç±»çš„å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> obj <span class="keyword">instanceof</span> Class;</span><br></pre></td></tr></table></figure><p>objä¸ºå¯¹è±¡ï¼ŒClassè¡¨ç¤ºä¸€ä¸ªç±»æˆ–è€…æ¥å£ã€‚å½“objä¸ºClasså¯¹è±¡æˆ–è€…æ˜¯å…¶ç›´æ¥æˆ–é—´æ¥å­ç±»ï¼Œæˆ–è€…æ˜¯å…¶æ¥å£çš„å®ç°ç±»ï¼Œç»“æœéƒ½æ˜¯resultè¿”å›ä¸ºtrueï¼Œå¦åˆ™false;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">System.out.println(i <span class="keyword">instanceof</span> Integer);<span class="comment">//ç¼–è¯‘ä¸é€šè¿‡ iå¿…é¡»æ˜¯å¼•ç”¨ç±»å‹ï¼Œä¸èƒ½æ˜¯åŸºæœ¬ç±»å‹</span></span><br><span class="line">System.out.println(i <span class="keyword">instanceof</span> Object);<span class="comment">//ç¼–è¯‘ä¸é€šè¿‡</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">1</span>);</span><br><span class="line">System.out.println(integer <span class="keyword">instanceof</span> Integer);<span class="comment">//true</span></span><br><span class="line"><span class="comment">//false ,åœ¨ JavaSEè§„èŒƒ ä¸­å¯¹ instanceof è¿ç®—ç¬¦çš„è§„å®šå°±æ˜¯ï¼šå¦‚æœ obj ä¸º nullï¼Œé‚£ä¹ˆå°†è¿”å› falseã€‚</span></span><br><span class="line">System.out.println(<span class="literal">null</span> <span class="keyword">instanceof</span> Object);</span><br></pre></td></tr></table></figure><h3 id="javaè‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±">javaè‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±</h3><p>è£…ç®±æ˜¯è‡ªåŠ¨å°†åŸºæœ¬æ•°æ®ç±»å‹è½¬æ¢ä¸ºåŒ…è£…ç±»å‹ï¼ˆint -&gt; Integer ï¼‰;è°ƒç”¨æ–¹æ³•ï¼š Integerçš„valueOf(int)æ–¹æ³•</p><p>æ‹†ç®±å°±æ˜¯è‡ªåŠ¨å°†åŒ…è£…å™¨æ•°æ®ç±»å‹è½¬æ¢ä¸ºåŸºæœ¬ç±»å‹ï¼ˆInteger-&gt;intï¼‰ã€‚è°ƒç”¨æ–¹æ³•ï¼šIntegerçš„intValueæ–¹æ³•ã€‚</p><p>åœ¨javaSE5ä¹‹å‰ï¼Œå¦‚æœè¦ç”Ÿæˆä¸€ä¸ªæ•°å€¼ä¸º10çš„Integerå¯¹è±¡ï¼Œå¿…é¡»è¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">i</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">10</span>);</span><br></pre></td></tr></table></figure><p>è€Œåœ¨ä»java SE5å¼€å§‹å°±æä¾›äº†è‡ªåŠ¨è£…ç®±çš„ç‰¹æ€§ï¼Œå¦‚æœè¦ç”Ÿæˆä¸€ä¸ªæ•°å€¼ä¸º10çš„Integerå¯¹è±¡ï¼Œåˆ™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i1</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i3</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i4</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line">sout(i1 == i2);<span class="comment">//true;</span></span><br><span class="line">sout(i3 == i4);<span class="comment">//true;</span></span><br></pre></td></tr></table></figure><p>å½’æ ¹ç»“åº•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title function_">valueOf</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line"> <span class="keyword">if</span>(i &gt;= -<span class="number">128</span> &amp;&amp; i &lt;= IntegerCache.high)</span><br><span class="line"> <span class="keyword">return</span> IntegerCache.cache[i + <span class="number">128</span>];</span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(i);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>IntegerCache</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">IntegerCache</span> &#123;</span><br><span class="line"> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> high;</span><br><span class="line"> <span class="keyword">static</span> <span class="keyword">final</span> Integer cache[];</span><br><span class="line"> <span class="keyword">static</span> &#123;</span><br><span class="line"> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> -<span class="number">128</span>;</span><br><span class="line"> <span class="comment">// high value may be configured by property</span></span><br><span class="line"> <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> <span class="number">127</span>;</span><br><span class="line"> <span class="keyword">if</span> (integerCacheHighPropValue != <span class="literal">null</span>) &#123;</span><br><span class="line"> <span class="comment">// Use Long.decode here to avoid invoking methods that</span></span><br><span class="line"> <span class="comment">// require Integer&#x27;s autoboxing cache to be initialized</span></span><br><span class="line"> <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> Long.decode(integerCacheHighPropValue).intValue();</span><br><span class="line"> i = Math.max(i, <span class="number">127</span>);</span><br><span class="line"> <span class="comment">// Maximum array size is Integer.MAX_VALUE</span></span><br><span class="line"> h = Math.min(i, Integer.MAX_VALUE - -low);</span><br><span class="line"> &#125;</span><br><span class="line"> high = h;</span><br><span class="line"> cache = <span class="keyword">new</span> <span class="title class_">Integer</span>[(high - low) + <span class="number">1</span>];</span><br><span class="line"> <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> low;</span><br><span class="line"> <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; cache.length; k++)</span><br><span class="line"> cache[k] = <span class="keyword">new</span> <span class="title class_">Integer</span>(j++);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">private</span> <span class="title function_">IntegerCache</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>ä»è¿™ä¸¤æ®µä»£ç ä¸Šå¯ä»¥çœ‹å‡ºï¼Œåœ¨é€šè¿‡valueOfæ–¹æ³•åˆ›å»ºIntegerå¯¹è±¡çš„æ—¶å€™ï¼Œå¦‚æœæ•°å€¼åœ¨[-128,127],ä¹‹é—´ä¾¿è¿”å›æŒ‡å‘Integer.cacheä¸­å·²ç»å­˜åœ¨çš„å¯¹è±¡çš„å¼•ç”¨ï¼Œå¦åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„Integerå¯¹è±¡ã€‚</p><p>ä¸Šè¾¹çš„ä»£ç ä¸­i1å’Œi2çš„æ•°å€¼ä¸º100ï¼Œå› æ­¤ä¼šä»cacheä¸­è¯»å–å·²ç»å­˜åœ¨çš„å¯¹è±¡ã€‚æ‰€æœ‰i1å’Œi2æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œi3å’Œi4ï¼Œåˆ†åˆ«æŒ‡å‘çš„æ˜¯ä¸åŒçš„å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line"><span class="type">Double</span> <span class="variable">i1</span> <span class="operator">=</span> <span class="number">100.0</span>ï¼›</span><br><span class="line"><span class="type">Double</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">100.0</span>ï¼›</span><br><span class="line"><span class="type">Double</span> <span class="variable">i3</span> <span class="operator">=</span> <span class="number">200.0</span>ï¼›</span><br><span class="line"><span class="type">Double</span> <span class="variable">i4</span> <span class="operator">=</span> <span class="number">200.0</span>ï¼›</span><br><span class="line">sout(i1 == i2);   <span class="comment">//false</span></span><br><span class="line">sout(i3 == i4);   <span class="comment">//false</span></span><br></pre></td></tr></table></figure><p>åŸå› åœ¨äºåœ¨æŸä¸ªèŒƒå›´å†…çš„æ•´å‹æ•°å€¼çš„ä¸ªæ•°æ˜¯æœ‰é™çš„ï¼Œè€Œæµ®ç‚¹æ•°ä¸æ˜¯ã€‚</p><h3 id="é‡è½½å’Œé‡å†™">é‡è½½å’Œé‡å†™</h3><p><strong>é‡å†™ï¼ˆOverrideï¼‰</strong>ï¼šé¡¾åæ€ä¹‰ï¼Œé‡å†™å°±æ˜¯é‡æ–°å†™ä¸€éçš„æ„æ€ï¼Œå…¶å®æ€¥é€Ÿåœ¨å­ç±»ä¸­æŠŠçˆ¶ç±»æœ¬èº«æœ‰çš„æ–¹æ³•é‡å†™å†™ä¸€éï¼Œå­ç±»ç»§æ‰¿äº†çˆ¶ç±»çš„åŸæœ‰çš„æ–¹æ³•ï¼Œå•æœ‰æ—¶å€™å­ç±»å¹¶ä¸æƒ³åŸå°ä¸åŠ¨çš„ç»§æ‰¿çˆ¶ç±»çš„æŸä¸ªæ–¹æ³•æ‰€ä»¥åœ¨æ–¹æ³•åï¼Œå‚æ•°åˆ—è¡¨ï¼Œè¿”å›ç±»å‹ï¼ˆé™¤å»å­ç±»ä¸­æ–¹æ³•çš„è¿”å›å€¼æ˜¯çˆ¶ç±»ä¸­æ–¹æ³•è¿”å›å€¼çš„å­ç±»æ—¶ï¼‰éƒ½åœ¨ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œå¯¹æ–¹æ³•ä½“è¿›è¡Œä¿®æ”¹æˆ–è€…é‡å†™ï¼Œä½†æ˜¯æ³¨æ„ï¼Œå­ç±»å‡½æ•°çš„æ–¹æ³•çš„è®¿é—®ä¿®é¥°æƒé™ä¸èƒ½å°‘äºçˆ¶ç±»çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Father</span>()&#123;</span><br><span class="line">    main:&#123;</span><br><span class="line">    <span class="type">Son</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Son</span>();</span><br><span class="line">    s.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">            sout(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Son</span> <span class="keyword">extends</span> <span class="title class_">Father</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">        sout(<span class="string">&quot;Hello --by&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»ä¹‹ï¼Œé‡å†™</p><ol><li>å‘ç”Ÿåœ¨çˆ¶ç±»å’Œå­ç±»ä¹‹é—´.</li><li>æ–¹æ³•åï¼Œå‚æ•°ï¼Œè¿”å›ç±»å‹ï¼ˆé™¤å»å­ç±»æ–¹æ³•çš„è¿”å›ç±»å‹æ˜¯çˆ¶ç±»ä¸­è¿”å›ç±»å‹çš„å­ç±»ï¼‰å¿…é¡»ç›¸åŒ</li><li>è®¿é—®ä¿®é¥°ç¬¦çš„é™åˆ¶ä¸€å®šè¦å¤§äºè¢«é‡å†™æ–¹æ³•çš„è®¿é—®ä¿®é¥°ç¬¦ï¼ˆpublic &gt; protected &gt; default &gt; private ï¼‰</li><li>é‡å†™æ–¹æ³•ä¸€å®šä¸èƒ½æŠ›å‡ºæ–°çš„æ£€æŸ¥å¼‚å¸¸æˆ–è€…æ¯”è¢«é‡å†™çš„æ–¹æ³•ç”³æ˜æ›´åŠ å®½æ³›çš„æ£€æŸ¥å‹å¼‚å¸¸ã€‚</li></ol><p><strong>é‡è½½ï¼ˆOverloadï¼‰</strong> ï¼šåŒä¸€ä¸ªç±»ä¸‹ï¼ŒåŒåçš„æ–¹æ³•å¦‚æœæœ‰ä¸åŒçš„å‚æ•°ç±»å‹åˆ—è¡¨**ï¼ˆå‚æ•°ç±»å‹ä¸åŒï¼Œå‚æ•°ä¸ªæ•°ä¸åŒç”šè‡³å‚æ•°é¡ºåºä¸åŒï¼‰**åˆ™è§†ä¸ºé‡è½½ï¼ŒåŒæ—¶ï¼Œé‡è½½å¯¹è¿”å›ç±»å‹æ²¡æœ‰è¦æ±‚ï¼Œå¯ä»¥ç›¸åŒä¹Ÿå¯ä»¥ä¸åŒï¼Œ<strong>ä½†ä¸èƒ½é€šè¿‡è¿”å›ç±»å‹æ˜¯å¦ç›¸åŒæ¥åˆ¤æ–­é‡è½½</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Father</span> &#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"> <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line"> <span class="type">Father</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Father</span>();</span><br><span class="line"> s.sayHello();</span><br><span class="line"> s.sayHello(<span class="string">&quot;wintershii&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span> &#123;</span><br><span class="line"> System.out.println(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">(String name)</span> &#123;</span><br><span class="line"> System.out.println(<span class="string">&quot;Hello&quot;</span> + <span class="string">&quot; &quot;</span> + name);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é‡è½½ï¼š</strong></p><ol><li>é‡è½½æ˜¯ä¸€ä¸ªç±»ä¸­å¤šæ€æ€§çš„ä¸€ç§è¡¨ç°</li><li>é‡è½½è¦å»æ–¹æ³•åç›¸åŒå‚æ•°åˆ—è¡¨ä¸åŒï¼ˆå‚æ•°ç±»å‹ï¼Œå‚æ•°ä¸ªæ•°ï¼Œç”šè‡³å‚æ•°é¡ºåºï¼‰</li><li>é‡è½½çš„æ—¶å€™ï¼Œè¿”å›å€¼ç±»å‹å¯ä»¥ç›¸åŒä¹Ÿå¯ä»¥ä¸åŒï¼Œæ— æ³•ä»¥è¿”å›å‹ä½œä¸ºé‡è½½å‡½æ•°çš„åŒºåˆ†æ ‡å‡†ã€‚</li></ol><h3 id="equals-ä¸-çš„åŒºåˆ«">equals ä¸ == çš„åŒºåˆ«</h3><p><strong>==æ¯”è¾ƒçš„æ˜¯å˜é‡ï¼ˆæ ˆï¼‰å†…å­˜ä¸­å­˜æ”¾å¯¹è±¡çš„ï¼ˆå †ï¼‰å†…å­˜åœ°å€ï¼Œç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„åœ°å€æ˜¯å¦ç›¸åŒ</strong>ï¼Œä¹Ÿå°±æ˜¯æ˜¯å¦æ¯”è¾ƒç›¸åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ¯”è¾ƒçš„çœŸæ­£æ„ä¹‰ä¸Šçš„æŒ‡é’ˆæ“ä½œã€‚</p><ol><li><p>æ¯”è¾ƒçš„æ˜¯æ“ä½œç¬¦ä¸¤ç«¯çš„æ“ä½œæ•°æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡</p></li><li><p>ä¸¤è¾¹çš„æ“ä½œæ•°å¿…é¡»æ˜¯ç»Ÿä¸€ç±»å‹çš„ï¼ˆå¯ä»¥æ˜¯çˆ¶å­ç±»ä¹‹é—´ï¼‰æ‰èƒ½ç¼–è¯‘é€šè¿‡ã€‚</p></li><li><p>æ¯”è¾ƒçš„æ˜¯åœ°å€ï¼Œå¦‚æœæ˜¯å…·ä½“çš„é˜¿æ‹‰ä¼¯æ•°å­—çš„æ¯”è¾ƒï¼Œå€¼ç›¸ç­‰å°±æ˜¯true,å¦‚ int  a = 10 ,long b=10.0L ,double c = 10.0 éƒ½æ˜¯ç›¸åŒçš„ï¼Œå› ä¸ºä»–ä»¬éƒ½æŒ‡å‘åœ°å€ä¸º10çš„å †ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Father</span> &#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"> <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"> <span class="type">long</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">10L</span>;</span><br><span class="line"> <span class="type">double</span> <span class="variable">c</span> <span class="operator">=</span> <span class="number">10.0</span>;</span><br><span class="line">System.out.println(a == b); <span class="comment">//true</span></span><br><span class="line"> System.out.println(b==c);   <span class="comment">//true</span></span><br><span class="line">  System.out.println(a==c);  <span class="comment">//true</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>equals</strong>:<strong>ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å®¹æ˜¯å¦ç›¸ç­‰</strong>ï¼Œç”±äºæ‰€æœ‰çš„ç±»éƒ½æ˜¯ç»§æ‰¿java.lang.Objectç±»çš„ï¼Œæ‰€ä»¥é€‚ç”¨äºæ‰€æœ‰å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å¯¹è¯¥æ–¹æ³•è¿›è¡Œè¦†ç›–çš„è¯ï¼Œè°ƒç”¨çš„ä»ç„¶æ˜¯Objectä¸­çš„æ–¹æ³•ï¼Œè€ŒObjectä¸­çš„equalsæ–¹æ³•çš„è¿”å›ç¡®å®==çš„åˆ¤æ–­ã€‚</p></li></ol><p><strong>æ€»ç»“</strong></p><p>æ‰€æœ‰çš„æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰æ—¶ï¼Œéƒ½æ˜¯ç”¨equalså¹¶ä¸”å¯¹å¸¸é‡ç›¸æ¯”è¾ƒæ—¶ï¼ŒæŠŠå¸¸é‡å†™åœ¨å‰é¢ï¼Œå› ä¸ºä½¿ç”¨objectçš„equals object å¯èƒ½ä¸ºnullåˆ™ç©ºæŒ‡é’ˆã€‚åœ¨é˜¿é‡Œçš„ä»£ç è§„èŒƒä¸­åªä½¿ç”¨equals ï¼Œé˜¿é‡Œæ’ä»¶é»˜è®¤ä¼šè¯†åˆ«ï¼Œå¹¶å¯ä»¥å¿«é€Ÿä¿®æ”¹ï¼Œæ¨èå®‰è£…é˜¿é‡Œæ’ä»¶æ¥ æ’æŸ¥è€ä»£ç ä½¿ç”¨â€œ==â€ï¼Œæ›¿æ¢æˆequals</p><h3 id="Hashcodeçš„ä½œç”¨">Hashcodeçš„ä½œç”¨</h3><p>javaé›†åˆæœ‰ä¸¤ä¸ªç±»ï¼Œä¸€ç±»æ˜¯Listï¼Œä¸€ç±»æ˜¯Setï¼Œå‰è€…æœ‰åºå¯é‡å¤ï¼Œåè€…æ— åºä¸é‡å¤ï¼Œå½“æˆ‘ä»¬åœ¨setä¸­æ’å…¥çš„æ—¶å€™æ€ä¹ˆåˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨è¯¥å…ƒç´ å‘¢ï¼Ÿå¯ä»¥é€šè¿‡equalsæ–¹æ³•ï¼Œå¦‚æœå…ƒç´ å¤ªå¤šï¼Œè¿™æ ·çš„æ–¹æ³•æ¯”è¾ƒæ»¡ã€‚</p><p>äºæ˜¯æœ‰äººå‘æ˜äº†å“ˆå¸Œç®—æ³•æ¥æé«˜é›†åˆä¸­æŸ¥æ‰¾å…ƒç´ çš„æ•ˆç‡ï¼Œè¿™ç§æ–¹å¼å°†é›†åˆåˆ†æˆè‹¥å¹²ä¸ªå­˜å‚¨åŒºåŸŸï¼Œæ¯ä¸ªå¯¹è±¡å¯ä»¥è®¡ç®—å‡ºä¸€ä¸ªå“ˆå¸Œç ï¼Œå¯ä»¥å°†å“ˆå¸Œç åˆ†ç»„ï¼Œæ¯ç»„åˆ†åˆ«å¯¹åº”æŸä¸ªå­˜å‚¨åŒºåŸŸï¼Œæ ¹æ®ä¸€ä¸ªå¯¹è±¡çš„å“ˆå¸Œç å°±å¯ä»¥ç¡®å®šè¯¥å¯¹è±¡åº”è¯¥å­˜å‚¨çš„é‚£ä¸ªåŒºåŸŸã€‚</p><p>hashCodeæ–¹æ³•å¯ä»¥è¿™æ ·ç†è§£ï¼Œä»–è¿”å›çš„å°±æ˜¯æ›´åŠ å¯¹è±¡çš„å†…å­˜åœ°å€æ¢ç®—å‡ºçš„ä¸€ä¸ªå€¼ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå½“é›†åˆè¦æ·»åŠ æ–°çš„å…ƒç´ çš„æ—¶ï¼Œå…ˆè°ƒç”¨è¿™ä¸ªå…ƒç´ çš„hashCodeæ–¹æ³•ï¼Œå°±ä¸€ä¸‹èƒ½å®šä½åˆ°ä»–åº”è¯¥æ”¾ç½®çš„ç‰©ç†ä½ç½®ï¼Œå¦‚æœè¿™ä¸ªä½ç½®ä¸Šæ²¡æœ‰å…ƒç´ ï¼Œå°±ç›´æ¥å­˜å‚¨åœ¨è¿™ä¸ªä½ç½®ä¸Šï¼Œä¸éœ€è¦åœ¨è¿›è¡Œä»»ä½•æ¯”è¾ƒï¼›å¦‚æœè¿™ä¸ªä½ç½®ä¸Šå·²ç»å­˜åœ¨å…ƒç´ ï¼Œå°±è°ƒç”¨equalsæ–¹æ³•ä¸æ–°å…ƒç´ æ¯”è¾ƒï¼Œç›¸åŒå°±ä¸å­˜ï¼Œä¸ç›¸åŒå°±æ•£åˆ—åˆ°å…¶ä»–åœ°å€ï¼Œè¿™æ ·ä¸€æ¥å®é™…è°ƒç”¨equalsæ–¹æ³•çš„æ¬¡æ•°å°±å¤§å¤§é™ä½äº†å‡ ä¹åªéœ€è¦ä¸€ä¸¤æ¬¡ã€‚</p><h3 id="String-StringBufferå’ŒStringBuilderçš„åŒºåˆ«">String,StringBufferå’ŒStringBuilderçš„åŒºåˆ«</h3><p>String æ˜¯åªè¯»å­—ç¬¦ä¸²ï¼Œç”±äºè¢«finalä¿®é¥°ï¼Œæ•…stringä¸èƒ½è¢«ç»§æ‰¿ï¼Œä»–ä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸”åº•å±‚æºç æ˜¯ä¸€ä¸ªè¢«finalä¿®é¥°çš„å­—ç¬¦æ•°ç»„ï¼Œæ‰€å¼•ç”¨çš„å­—ç¬¦ä¸²ä¸èƒ½è¢«æ”¹å˜ï¼Œä¸€ç»å®šä¹‰ï¼Œæ— æ³•å†å¢åˆ æ”¹ï¼Œæ¯æ¬¡å¯¹stringçš„æ“ä½œéƒ½ä¼šé€ æˆä¸€ä¸ªæ–°çš„stringå¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">string</span> <span class="variable">a</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>;</span><br><span class="line"><span class="type">string</span> <span class="variable">b</span> <span class="operator">=</span> <span class="string">&quot;b&quot;</span>;</span><br><span class="line"><span class="type">string</span> <span class="variable">c</span> <span class="operator">=</span> a + b;<span class="comment">//å°†ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„String c ,è€ŒString a,String bçš„å€¼ä¿æŒä¸å˜ã€‚</span></span><br></pre></td></tr></table></figure><p>æ¯æ¬¡+æ“ä½œåï¼šéšå¼åœ¨å †ä¸Šnewäº†ä¸€ä¸ªè·ŸåŸå­—ç¬¦ä¸²ç›¸åŒçš„StringBuilderå¯¹è±¡ï¼Œåœ¨è°ƒç”¨appendæ–¹æ³•æ‹¼æ¥+åè¾¹çš„å­—ç¬¦ã€‚</p><p>StringBufferå’ŒStringBuilderä»–ä»¬ä¸¤ä¸ªéƒ½ç»§æ‰¿äº†AbstractStringBuilderå¯¹è±¡ã€‚ä»–ä»¬çš„åº•å±‚éƒ½æ˜¯å¯å˜çš„å­—ç¬¦æ•°ç»„ï¼Œå¦å¤–StringBufferå¯¹æ–¹æ³•åŠ äº†åŒæ­¥æ‰€æˆ–è€…å¯¹è°ƒç”¨çš„æ–¹æ³•åŠ äº†åŒæ­¥é”ï¼Œæ‰€ä»¥çº¿ç¨‹æ˜¯å®‰å…¨çš„ï¼ŒStringBuilderå¹¶æ²¡æœ‰å¯¹æ–¹æ³•è¿›è¡ŒåŒæ­¥é”ï¼Œæ•…è€Œçº¿ç¨‹ä¸å®‰å…¨çš„ã€‚</p><h3 id="ArrayListå’ŒLinkedListçš„åŒºåˆ«">ArrayListå’ŒLinkedListçš„åŒºåˆ«</h3><p>Array(æ•°ç»„)æ˜¯åŸºäºç´¢å¼•ï¼ˆindexï¼‰çš„æ•°æ®ç»“æ„ï¼Œå®ƒä½¿ç”¨ç´¢å¼•åœ¨æ•°ç»„ä¸­æœç´¢å’Œè¯»å–æ•°æ®æ˜¯å¾ˆå¿«çš„ã€‚</p><p>Arrayè·<strong>å–æ•°æ®çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(1),ä½†æ˜¯åˆ é™¤æ•°æ®å¼€é”€å´å¾ˆå¤§</strong>ï¼Œå› ä¸ºè¿™éœ€è¦é‡æ’æ•°ç»„ä¸­æ‰€æœ‰çš„æ•°æ®ï¼Œï¼ˆå› ä¸ºåˆ é™¤æ•°æ®ä»¥åï¼Œéœ€è¦æŠŠåè¾¹çš„æ‰€æœ‰æ•°æ®å‰ç§»ï¼‰</p><p><strong>ç¼ºç‚¹ï¼šæ•°ç»„åˆå§‹åŒ–å¿…é¡»æŒ‡å®šåˆå§‹åŒ–é•¿åº¦ï¼Œå¦åˆ™æŠ¥é”™ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] a = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">4</span>];<span class="comment">//æ¨ä»‹ä½¿ç”¨int[] è¿™ç§æ–¹å¼åˆå§‹åŒ–</span></span><br><span class="line"><span class="type">int</span> c[] = &#123;<span class="number">23</span>,<span class="number">43</span>,<span class="number">56</span>,<span class="number">78</span>&#125;;<span class="comment">//é•¿åº¦ï¼š4ï¼Œç´¢å¼•èŒƒå›´ï¼š[0,3]</span></span><br></pre></td></tr></table></figure><p><strong>Listæ˜¯ä¸€ä¸ªæœ‰åºçš„é›†åˆ</strong>ï¼Œå¯ä»¥åŒ…å«é‡å¤çš„å…ƒç´ ï¼Œæä¾›äº†æŒ‰ç´¢å¼•è®¿é—®çš„æ–¹å¼ï¼Œå®ƒç»§æ‰¿Collectionã€‚</p><blockquote><p>Listæœ‰ä¸¤ä¸ªé‡è¦çš„å®ç°ç±»ï¼š<strong>ArrayListå’ŒLinkedList</strong></p><p><strong>ArrayList: å¯ä»¥çœ‹ä½œæ˜¯èƒ½å¤Ÿè‡ªåŠ¨å¢é•¿å®¹é‡çš„æ•°ç»„</strong></p><p><strong>ArrayListçš„toArrayæ–¹æ³•è¿”å›ä¸€ä¸ªæ•°ç»„</strong></p><p><strong>ArrayListçš„asListæ–¹æ³•è¿”å›ä¸€ä¸ªåˆ—è¡¨</strong></p><p><strong>ArrayListåº•å±‚çš„å®ç°æ˜¯Array, æ•°ç»„æ‰©å®¹å®ç°</strong></p></blockquote><p><strong>LinkListæ˜¯ä¸€ä¸ªåŒé“¾è¡¨ï¼Œåœ¨æ·»åŠ å’Œåˆ é™¤å…ƒç´ æ—¶å…·æœ‰æ¯”ArrayListæ›´å¥½çš„æ€§èƒ½ï¼Œä½†åœ¨getå’Œsetæ–¹é¢å¼±äºArrayList.å½“ç„¶è¿™äº›éƒ½æ˜¯å¯¹æ¯”æ•°æ®äº®å¾ˆå¤§æˆ–è€…æ“ä½œå¾ˆé¢‘ç¹çš„æƒ…å†µä¸‹çš„ã€‚</strong></p><h3 id="Stringç±»å¸¸ç”¨å¯¹è±¡æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ">Stringç±»å¸¸ç”¨å¯¹è±¡æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ</h3><blockquote><p>indexOf(): è¿”å›æŒ‡å®šå­—ç¬¦çš„ç´¢å¼•</p><p>charAt():è¿”å›æŒ‡å®šç´¢å¼•å¤„çš„å­—ç¬¦</p><p>replace():å­—ç¬¦ä¸²æ›¿æ¢</p><p>trim():å»é™¤å­—ç¬¦ä¸²ç«¯ç©ºç™½</p><p>split():åˆ†å‰²å­—ç¬¦ä¸²ï¼Œè¿”å›ä¸€ä¸ªåˆ†å‰²åçš„å­—ç¬¦ä¸²æ•°ç»„</p><p>getBytes():è¿”å›å­—ç¬¦ä¸²çš„byteç±»å‹æ•°ç»„</p><p>length():è¿”å›å­—ç¬¦ä¸²é•¿åº¦</p><p>toLowerCase(): å°†å­—ç¬¦ä¸²è½¬æˆå°å†™å­—æ¯</p><p>toUpperCase():å°†å­—ç¬¦ä¸²è½¬æˆå¤§å†™å­—æ¯</p><p>substring():æˆªå–å­—ç¬¦ä¸²</p><p>equals():å­—ç¬¦ä¸²æ¯”è¾ƒ</p></blockquote>]]></content>
    
    
    <summary type="html">æœ¬æ–‡ä¸»è¦ä»‹ç»å¯¹å¤šjavaåŸºç¡€é¢è¯•é¢˜çš„æ€»ç»“</summary>
    
    
    
    <category term="é¢è¯•é¢˜" scheme="https://luoxiaohei520.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    
    
    <category term="javaé¢è¯•é¢˜" scheme="https://luoxiaohei520.github.io/tags/java%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>Vue3å­¦ä¹ ç¬”è®°å’Œå®ä¾‹</title>
    <link href="https://luoxiaohei520.github.io/posts/174c6ef5.html"/>
    <id>https://luoxiaohei520.github.io/posts/174c6ef5.html</id>
    <published>2023-11-09T02:50:23.340Z</published>
    <updated>2023-11-09T02:50:23.340Z</updated>
    
    <content type="html"><![CDATA[<h1>Vue3å­¦ä¹ </h1><p>ç¬¬ä¸€ä¸ªvue é¡¹ç›®</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…node.jsè‡ªè¡Œé€‰æ‹©è‡ªå·±éœ€è¦çš„ç‰ˆæœ¬ã€‚æ¨èä½¿ç”¨node.js 16.0</p><p>æ‰“å¼€ä½ çš„ç›®æ ‡æ–‡ä»¶å¤¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init vue@latest  //æˆ–è€…æŒ‡å®šç‰ˆæœ¬å·</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æŒ‡ä»¤å°†ä¼šå®‰è£…å¹¶æ‰§è¡ŒÂ <a href="https://github.com/vuejs/create-vue">create-vue</a>ï¼Œå®ƒæ˜¯ Vue å®˜æ–¹çš„é¡¹ç›®è„šæ‰‹æ¶å·¥å…·ã€‚ä½ å°†ä¼šçœ‹åˆ°ä¸€äº›è¯¸å¦‚ TypeScript å’Œæµ‹è¯•æ”¯æŒä¹‹ç±»çš„å¯é€‰åŠŸèƒ½æç¤ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">âœ” Project name: â€¦ &lt;your-project-name&gt;</span><br><span class="line">âœ” Add TypeScript? â€¦ No / Yes</span><br><span class="line">âœ” Add JSX Support? â€¦ No / Yes</span><br><span class="line">âœ” Add Vue Router for Single Page Application development? â€¦ No / Yes</span><br><span class="line">âœ” Add Pinia for state management? â€¦ No / Yes</span><br><span class="line">âœ” Add Vitest for Unit testing? â€¦ No / Yes</span><br><span class="line">âœ” Add Cypress for both Unit and End-to-End testing? â€¦ No / Yes</span><br><span class="line">âœ” Add ESLint for code quality? â€¦ No / Yes</span><br><span class="line">âœ” Add Prettier for code formatting? â€¦ No / Yes</span><br><span class="line"></span><br><span class="line">Scaffolding project in ./&lt;your-project-name&gt;...</span><br><span class="line">Done.</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸ç¡®å®šæ˜¯å¦è¦å¼€å¯æŸä¸ªåŠŸèƒ½ï¼Œä½ å¯ä»¥ç›´æ¥æŒ‰ä¸‹å›è½¦é”®é€‰æ‹©Â <code>No</code>ã€‚åœ¨é¡¹ç›®è¢«åˆ›å»ºåï¼Œé€šè¿‡ä»¥ä¸‹æ­¥éª¤å®‰è£…ä¾èµ–å¹¶å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">cd</span> &lt;your-project-name&gt;</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">npm install</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">npm run dev</span></span><br></pre></td></tr></table></figure><p>ä½ ç°åœ¨åº”è¯¥å·²ç»è¿è¡Œèµ·æ¥äº†ä½ çš„ç¬¬ä¸€ä¸ª Vue é¡¹ç›®ï¼è¯·æ³¨æ„ï¼Œç”Ÿæˆçš„é¡¹ç›®ä¸­çš„ç¤ºä¾‹ç»„ä»¶ä½¿ç”¨çš„æ˜¯<a href="https://cn.vuejs.org/guide/introduction.html#composition-api">ç»„åˆå¼ API</a> å’Œ <code>&lt;script setup&gt;</code>ï¼Œè€Œé<a href="https://cn.vuejs.org/guide/introduction.html#options-api">é€‰é¡¹å¼ API</a>ã€‚ä¸‹é¢æ˜¯ä¸€äº›è¡¥å……æç¤ºï¼š</p><ul><li>æ¨èçš„ IDE é…ç½®æ˜¯ <a href="https://code.visualstudio.com/">Visual Studio Code</a> + <a href="https://marketplace.visualstudio.com/items?itemName=Vue.volar">Volar æ‰©å±•</a>ã€‚å¦‚æœä½¿ç”¨å…¶ä»–ç¼–è¾‘å™¨ï¼Œå‚è€ƒ <a href="https://cn.vuejs.org/guide/scaling-up/tooling.html#ide-support">IDE æ”¯æŒç« èŠ‚</a>ã€‚</li><li>æ›´å¤šå·¥å…·ç»†èŠ‚ï¼ŒåŒ…æ‹¬ä¸åç«¯æ¡†æ¶çš„æ•´åˆï¼Œæˆ‘ä»¬ä¼šåœ¨<a href="https://cn.vuejs.org/guide/scaling-up/tooling.html">å·¥å…·é“¾æŒ‡å—</a>è¿›è¡Œè®¨è®ºã€‚</li><li>è¦äº†è§£æ„å»ºå·¥å…· Vite æ›´å¤šèƒŒåçš„ç»†èŠ‚ï¼Œè¯·æŸ¥çœ‹ <a href="https://cn.vitejs.dev/">Vite æ–‡æ¡£</a>ã€‚</li><li>å¦‚æœä½ é€‰æ‹©ä½¿ç”¨ TypeScriptï¼Œè¯·é˜…è¯» <a href="https://cn.vuejs.org/guide/typescript/overview.html">TypeScript ä½¿ç”¨æŒ‡å—</a>ã€‚</li></ul><p>å½“ä½ å‡†å¤‡å°†åº”ç”¨å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œè¯·è¿è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">npm run build</span></span><br></pre></td></tr></table></figure><p>æ­¤å‘½ä»¤ä¼šåœ¨Â <code>./dist</code>Â æ–‡ä»¶å¤¹ä¸­ä¸ºä½ çš„åº”ç”¨åˆ›å»ºä¸€ä¸ªç”Ÿäº§ç¯å¢ƒçš„æ„å»ºç‰ˆæœ¬ã€‚å…³äºå°†åº”ç”¨ä¸Šçº¿ç”Ÿäº§ç¯å¢ƒçš„æ›´å¤šå†…å®¹ï¼Œè¯·é˜…è¯»<a href="https://cn.vuejs.org/guide/best-practices/production-deployment.html">ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—</a>ã€‚</p><h2 id="é€šè¿‡-CDN-ä½¿ç”¨-Vue">é€šè¿‡ CDN ä½¿ç”¨ Vue</h2><p>ä½ å¯ä»¥å€ŸåŠ© script æ ‡ç­¾ç›´æ¥é€šè¿‡ CDN æ¥ä½¿ç”¨ Vueï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/vue@3/dist/vue.global.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† <a href="https://unpkg.com/">unpkg</a>ï¼Œä½†ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä»»ä½•æä¾› npm åŒ…æœåŠ¡çš„ CDNï¼Œä¾‹å¦‚ <a href="https://www.jsdelivr.com/package/npm/vue">jsdelivr</a> æˆ– <a href="https://cdnjs.com/libraries/vue">cdnjs</a>ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ä¸‹è½½æ­¤æ–‡ä»¶å¹¶è‡ªè¡Œæä¾›æœåŠ¡ã€‚</p><p>é€šè¿‡ CDN ä½¿ç”¨ Vue æ—¶ï¼Œä¸æ¶‰åŠâ€œæ„å»ºæ­¥éª¤â€ã€‚è¿™ä½¿å¾—è®¾ç½®æ›´åŠ ç®€å•ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºå¢å¼ºé™æ€çš„ HTML æˆ–ä¸åç«¯æ¡†æ¶é›†æˆã€‚ä½†æ˜¯ï¼Œä½ å°†æ— æ³•ä½¿ç”¨å•æ–‡ä»¶ç»„ä»¶ (SFC) è¯­æ³•ã€‚</p><h3 id="ä½¿ç”¨å…¨å±€æ„å»ºç‰ˆæœ¬">ä½¿ç”¨å…¨å±€æ„å»ºç‰ˆæœ¬</h3><p>ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨äº†<em>å…¨å±€æ„å»ºç‰ˆæœ¬</em>çš„ Vueï¼Œè¯¥ç‰ˆæœ¬çš„æ‰€æœ‰é¡¶å±‚ API éƒ½ä»¥å±æ€§çš„å½¢å¼æš´éœ²åœ¨äº†å…¨å±€çš„ <code>Vue</code> å¯¹è±¡ä¸Šã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä½¿ç”¨å…¨å±€æ„å»ºç‰ˆæœ¬çš„ä¾‹å­ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/vue@3/dist/vue.global.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> &#123; createApp &#125; = <span class="title class_">Vue</span></span></span><br><span class="line"><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">createApp</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">message</span>: <span class="string">&#x27;Hello Vue!&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-ES-æ¨¡å—æ„å»ºç‰ˆæœ¬">ä½¿ç”¨ ES æ¨¡å—æ„å»ºç‰ˆæœ¬</h3><p>åœ¨æœ¬æ–‡æ¡£çš„å…¶ä½™éƒ¨åˆ†æˆ‘ä»¬ä½¿ç”¨çš„ä¸»è¦æ˜¯Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules">ES æ¨¡å—</a>è¯­æ³•ã€‚ç°ä»£æµè§ˆå™¨å¤§å¤šéƒ½å·²åŸç”Ÿæ”¯æŒ ES æ¨¡å—ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·é€šè¿‡ CDN ä»¥åŠåŸç”Ÿ ES æ¨¡å—ä½¿ç”¨ Vueï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;https://unpkg.com/vue@3/dist/vue.esm-browser.js&#x27;</span></span></span><br><span class="line"><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">createApp</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">message</span>: <span class="string">&#x27;Hello Vue!&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨æ„æˆ‘ä»¬ä½¿ç”¨äº†Â <code>&lt;script type=&quot;module&quot;&gt;</code>ï¼Œä¸”å¯¼å…¥çš„ CDN URL æŒ‡å‘çš„æ˜¯ Vue çš„Â <strong>ES æ¨¡å—æ„å»ºç‰ˆæœ¬</strong>ã€‚</p><h3 id="å¯ç”¨-Import-maps">å¯ç”¨ Import maps</h3><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å®Œæ•´çš„ CDN URL æ¥å¯¼å…¥ï¼Œä½†åœ¨æ–‡æ¡£çš„å…¶ä½™éƒ¨åˆ†ä¸­ï¼Œä½ å°†çœ‹åˆ°å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a href="https://caniuse.com/import-maps">å¯¼å…¥æ˜ å°„è¡¨ (Import Maps)</a>Â æ¥å‘Šè¯‰æµè§ˆå™¨å¦‚ä½•å®šä½åˆ°å¯¼å…¥çš„Â <code>vue</code>ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;importmap&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="string">&quot;imports&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="string">&quot;vue&quot;</span>: <span class="string">&quot;https://unpkg.com/vue@3/dist/vue.esm-browser.js&quot;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">createApp</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">message</span>: <span class="string">&#x27;Hello Vue!&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://jsfiddle.net/yyx990803/2ke1ab0z/">JSFiddle ä¸­çš„ç¤ºä¾‹</a></p><p>ä½ ä¹Ÿå¯ä»¥åœ¨æ˜ å°„è¡¨ä¸­æ·»åŠ å…¶ä»–çš„ä¾èµ–â€”â€”ä½†è¯·åŠ¡å¿…ç¡®ä¿ä½ ä½¿ç”¨çš„æ˜¯è¯¥åº“çš„ ES æ¨¡å—ç‰ˆæœ¬ã€‚</p><blockquote><p>å¯¼å…¥æ˜ å°„è¡¨çš„æµè§ˆå™¨æ”¯æŒæƒ…å†µ</p><p>ç›®å‰åªæœ‰åŸºäº Chromium çš„æµè§ˆå™¨æ”¯æŒå¯¼å…¥æ˜ å°„è¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¨èä½ åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ä½¿ç”¨ Chrome æˆ– Edgeã€‚</p><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Firefox æµè§ˆå™¨ï¼Œåˆ™è¯¥åŠŸèƒ½é»˜è®¤åœ¨ 108+ ç‰ˆæœ¬æˆ–é€šè¿‡å¯ç”¨ <code>about:config</code> ä¸­çš„ <code>dom.importMaps.enabled</code> é€‰é¡¹æ”¯æŒã€‚</p><p>å¦‚æœä½ æ›´å–œæ¬¢é‚£äº›è¿˜ä¸æ”¯æŒå¯¼å…¥æ˜ å°„è¡¨çš„æµè§ˆå™¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ <a href="https://github.com/guybedford/es-module-shims">es-module-shims</a> æ¥è¿›è¡Œ polyfill.</p><p>ç”Ÿäº§ç¯å¢ƒä¸­çš„æ³¨æ„äº‹é¡¹</p><p>åˆ°ç›®å‰ä¸ºæ­¢ç¤ºä¾‹ä¸­ä½¿ç”¨çš„éƒ½æ˜¯ Vue çš„å¼€å‘æ„å»ºç‰ˆæœ¬â€”â€”å¦‚æœä½ æ‰“ç®—åœ¨ç”Ÿäº§ä¸­é€šè¿‡ CDN ä½¿ç”¨ Vueï¼Œè¯·åŠ¡å¿…æŸ¥çœ‹<a href="https://cn.vuejs.org/guide/best-practices/production-deployment.html#without-build-tools">ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—</a>ã€‚</p></blockquote><h3 id="æ‹†åˆ†æ¨¡å—">æ‹†åˆ†æ¨¡å—</h3><p>éšç€å¯¹è¿™ä»½æŒ‡å—çš„é€æ­¥æ·±å…¥ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å°†ä»£ç åˆ†å‰²æˆå•ç‹¬çš„ JavaScript æ–‡ä»¶ï¼Œä»¥ä¾¿æ›´å®¹æ˜“ç®¡ç†ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> <span class="title class_">MyComponent</span> <span class="keyword">from</span> <span class="string">&#x27;./my-component.js&#x27;</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">createApp</span>(<span class="title class_">MyComponent</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// my-component.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`&lt;div&gt;count is &#123;&#123; count &#125;&#125;&lt;/div&gt;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚æœç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€äº†ä¸Šé¢çš„ <code>index.html</code>ï¼Œä½ ä¼šå‘ç°å®ƒæŠ›å‡ºäº†ä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸º ES æ¨¡å—ä¸èƒ½é€šè¿‡ <code>file://</code> åè®®å·¥ä½œã€‚ä¸ºäº†ä½¿å…¶å·¥ä½œï¼Œä½ éœ€è¦ä½¿ç”¨æœ¬åœ° HTTP æœåŠ¡å™¨é€šè¿‡ <code>http://</code> åè®®æä¾› <code>index.html</code>ã€‚</p><p>è¦å¯åŠ¨ä¸€ä¸ªæœ¬åœ°çš„ HTTP æœåŠ¡å™¨ï¼Œè¯·å…ˆå®‰è£… <a href="https://nodejs.org/zh/">Node.js</a>ï¼Œç„¶åé€šè¿‡å‘½ä»¤è¡Œåœ¨ HTML æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹ä¸‹è¿è¡Œ <code>npx serve</code>ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ä»»ä½•å¯ä»¥åŸºäºæ­£ç¡®çš„ MIME ç±»å‹æœåŠ¡é™æ€æ–‡ä»¶çš„ HTTP æœåŠ¡å™¨ã€‚</p><p>å¯èƒ½ä½ ä¹Ÿæ³¨æ„åˆ°äº†ï¼Œè¿™é‡Œå¯¼å…¥çš„ç»„ä»¶æ¨¡æ¿æ˜¯å†…è”çš„ JavaScript å­—ç¬¦ä¸²ã€‚å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ VSCodeï¼Œä½ å¯ä»¥å®‰è£… <a href="https://marketplace.visualstudio.com/items?itemName=Tobermory.es6-string-html">es6-string-html</a> æ‰©å±•ï¼Œç„¶ååœ¨å­—ç¬¦ä¸²å‰åŠ ä¸Šä¸€ä¸ªå‰ç¼€æ³¨é‡Š <code>/*html*/</code> ä»¥é«˜äº®è¯­æ³•ã€‚</p><h3 id="æ— éœ€æ„å»ºçš„ç»„åˆå¼-API-ç”¨æ³•">æ— éœ€æ„å»ºçš„ç»„åˆå¼ API ç”¨æ³•</h3><p>ç»„åˆå¼ API çš„è®¸å¤šç¤ºä¾‹å°†ä½¿ç”¨Â <code>&lt;script setup&gt;</code>Â è¯­æ³•ã€‚å¦‚æœä½ æƒ³åœ¨æ— éœ€æ„å»ºçš„æƒ…å†µä¸‹ä½¿ç”¨ç»„åˆå¼ APIï¼Œè¯·å‚é˜…Â <a href="https://cn.vuejs.org/api/composition-api-setup.html"><code>setup()</code>Â é€‰é¡¹</a>ã€‚</p><h2 id="è¿›å…¥vueå¯åŠ¨é¡µé¢">è¿›å…¥vueå¯åŠ¨é¡µé¢</h2><p><a href="http://127.0.0.1">http://127.0.0.1</a>:ç«¯å£å·/</p><p>router/index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HomeView</span> <span class="keyword">from</span> <span class="string">&#x27;../views/HomeView.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createRouter</span>(&#123;  <span class="comment">//å®šä¹‰ä¸å¯å˜çš„è·¯ç”±</span></span><br><span class="line">  <span class="attr">history</span>: <span class="title function_">createWebHistory</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">BASE_URL</span>),</span><br><span class="line"><span class="comment">//åˆ›å»ºè·¯ç”±å¯¹è±¡ï¼Œjsonçš„å½¢å¼</span></span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">HomeView</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;about&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/AboutView.vue&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/learn1&#x27;</span>,  <span class="comment">//urlè·¯å¾„æŒ‡å‘</span></span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;learn1&#x27;</span>,  </span><br><span class="line">      <span class="comment">//è·¯ç”±ï¼ŒæŒ‡å‘ç›®æ ‡é¡µé¢</span></span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/Learn1.vue&#x27;</span>) </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å£°æ˜å¼æ¸²æŸ“">å£°æ˜å¼æ¸²æŸ“</h3><p>ä½ åœ¨ç¼–è¾‘å™¨ä¸­çœ‹åˆ°çš„æ˜¯ä¸€ä¸ª Vue å•æ–‡ä»¶ç»„ä»¶ (Single-File Componentï¼Œç¼©å†™ä¸º SFC)ã€‚SFC æ˜¯ä¸€ç§å¯å¤ç”¨çš„ä»£ç ç»„ç»‡å½¢å¼ï¼Œå®ƒå°†ä»å±äºåŒä¸€ä¸ªç»„ä»¶çš„ HTMLã€CSS å’Œ JavaScript å°è£…åœ¨ä½¿ç”¨Â <code>.vue</code>Â åç¼€çš„æ–‡ä»¶ä¸­ã€‚</p><p>Vue çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯<strong>å£°æ˜å¼æ¸²æŸ“</strong>ï¼šé€šè¿‡æ‰©å±•äºæ ‡å‡† HTML çš„æ¨¡æ¿è¯­æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ® JavaScript çš„çŠ¶æ€æ¥æè¿° HTML åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚å½“çŠ¶æ€æ”¹å˜æ—¶ï¼ŒHTML ä¼šè‡ªåŠ¨æ›´æ–°ã€‚</p><p>èƒ½åœ¨æ”¹å˜æ—¶è§¦å‘æ›´æ–°çš„çŠ¶æ€è¢«ç§°ä½œæ˜¯<strong>å“åº”å¼</strong>çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Vue çš„ <code>reactive()</code> API æ¥å£°æ˜å“åº”å¼çŠ¶æ€ã€‚ç”± <code>reactive()</code> åˆ›å»ºçš„å¯¹è±¡éƒ½æ˜¯ JavaScript <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy</a>ï¼Œå…¶è¡Œä¸ºä¸æ™®é€šå¯¹è±¡ä¸€æ ·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; reactive &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const counter = reactive(&#123;</span><br><span class="line">  count: 0</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">console.log(counter.count) // 0</span><br><span class="line">counter.count++</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>reactive()</code>Â åªé€‚ç”¨äºå¯¹è±¡ (åŒ…æ‹¬æ•°ç»„å’Œå†…ç½®ç±»å‹ï¼Œå¦‚Â <code>Map</code>Â å’ŒÂ <code>Set</code>)ã€‚è€Œå¦ä¸€ä¸ª APIÂ <code>ref()</code>Â åˆ™å¯ä»¥æ¥å—ä»»ä½•å€¼ç±»å‹ã€‚<code>ref</code>Â ä¼šè¿”å›ä¸€ä¸ªåŒ…è£¹å¯¹è±¡ï¼Œå¹¶åœ¨Â <code>.value</code>Â å±æ€§ä¸‹æš´éœ²å†…éƒ¨å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const message = ref(&#x27;Hello World!&#x27;)</span><br><span class="line"></span><br><span class="line">console.log(message.value) // &quot;Hello World!&quot;</span><br><span class="line">message.value = &#x27;Changed&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>reactive()</code> å’Œ <code>ref()</code> çš„ç»†èŠ‚åœ¨<a href="https://cn.vuejs.org/guide/essentials/reactivity-fundamentals.html">æŒ‡å— - å“åº”å¼åŸºç¡€</a>ä¸€èŠ‚ä¸­æœ‰è¿›ä¸€æ­¥è®¨è®ºã€‚</p><p>åœ¨ç»„ä»¶çš„ <code>&lt;script setup&gt;</code> å—ä¸­å£°æ˜çš„å“åº”å¼çŠ¶æ€ï¼Œå¯ä»¥ç›´æ¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ã€‚ä¸‹é¢å±•ç¤ºäº†æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨åŒèŠ±æ‹¬å·è¯­æ³•ï¼Œæ ¹æ® <code>counter</code> å¯¹è±¡å’Œ <code>message</code> ref çš„å€¼æ¸²æŸ“åŠ¨æ€æ–‡æœ¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;&#123;&#123; message &#125;&#125;&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;count is: &#123;&#123; counter.count &#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure><p>æ³¨æ„æˆ‘ä»¬åœ¨æ¨¡æ¿ä¸­è®¿é—®çš„ <code>message</code> ref æ—¶ä¸éœ€è¦ä½¿ç”¨ <code>.value</code>ï¼šå®ƒä¼šè¢«è‡ªåŠ¨è§£åŒ…ï¼Œè®©ä½¿ç”¨æ›´ç®€å•ã€‚</p><p>åœ¨åŒèŠ±æ‹¬å·ä¸­çš„å†…å®¹å¹¶ä¸åªé™äºæ ‡è¯†ç¬¦æˆ–è·¯å¾„â€”â€”æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»ä½•æœ‰æ•ˆçš„ JavaScript è¡¨è¾¾å¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;&#123;&#123; message.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;) &#125;&#125;&lt;/h1&gt;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œè¯•ç€è‡ªå·±åˆ›å»ºä¸€äº›å“åº”å¼çŠ¶æ€ï¼Œç”¨å®ƒæ¥ä¸ºæ¨¡æ¿ä¸­çš„Â <code>&lt;h1&gt;</code>Â æ¸²æŸ“åŠ¨æ€çš„æ–‡æœ¬å†…å®¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; reactive, ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const counter = reactive(&#123; count: 0 &#125;)</span><br><span class="line">const message = ref(&#x27;Hello World!&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;h1&gt;&#123;&#123; message &#125;&#125;&lt;/h1&gt;</span><br><span class="line">  &lt;p&gt;Count is: &#123;&#123; counter.count &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>app.vueé¡µé¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; RouterLink, RouterView &#125; from &#x27;vue-router&#x27;</span><br><span class="line">import HelloWorld from &#x27;./components/HelloWorld.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;header&gt;</span><br><span class="line">    &lt;img alt=&quot;Vue logo&quot; class=&quot;logo&quot; src=&quot;@/assets/logo.svg&quot; width=&quot;125&quot; height=&quot;125&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;wrapper&quot;&gt;</span><br><span class="line">      &lt;HelloWorld msg=&quot;You did it!&quot; /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;nav&gt;</span><br><span class="line">        &lt;RouterLink to=&quot;/&quot;&gt;Home&lt;/RouterLink&gt;</span><br><span class="line">        &lt;RouterLink to=&quot;/about&quot;&gt;About&lt;/RouterLink&gt;</span><br><span class="line">        &lt;RouterLink to=&quot;/learn1&quot;&gt;å­¦ä¹ 1&lt;/RouterLink&gt;</span><br><span class="line">      &lt;/nav&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/header&gt;</span><br><span class="line">  &lt;RouterView /&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>learn1.vue</p><h3 id="Attribute-ç»‘å®š">Attribute ç»‘å®š</h3><p>åœ¨ Vue ä¸­ï¼Œmustache è¯­æ³• (å³åŒå¤§æ‹¬å·) åªèƒ½ç”¨äºæ–‡æœ¬æ’å€¼ã€‚ä¸ºäº†ç»™ attribute ç»‘å®šä¸€ä¸ªåŠ¨æ€å€¼ï¼Œéœ€è¦ä½¿ç”¨ <code>v-bind</code> æŒ‡ä»¤ï¼š</p><p>å®ä¾‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div v-bind:id=&quot;dynamicId&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure><p><strong>æŒ‡ä»¤</strong>æ˜¯ç”± <code>v-</code> å¼€å¤´çš„ä¸€ç§ç‰¹æ®Š attributeã€‚å®ƒä»¬æ˜¯ Vue æ¨¡æ¿è¯­æ³•çš„ä¸€éƒ¨åˆ†ã€‚å’Œæ–‡æœ¬æ’å€¼ç±»ä¼¼ï¼ŒæŒ‡ä»¤çš„å€¼æ˜¯å¯ä»¥è®¿é—®ç»„ä»¶çŠ¶æ€çš„ JavaScript è¡¨è¾¾å¼ã€‚å…³äº <code>v-bind</code> å’ŒæŒ‡ä»¤è¯­æ³•çš„å®Œæ•´ç»†èŠ‚è¯·è¯¦é˜…<a href="https://cn.vuejs.org/guide/essentials/template-syntax.html">æŒ‡å— - æ¨¡æ¿è¯­æ³•</a>ã€‚</p><p>å†’å·åé¢çš„éƒ¨åˆ† (<code>:id</code>) æ˜¯æŒ‡ä»¤çš„â€œå‚æ•°â€ã€‚æ­¤å¤„ï¼Œå…ƒç´ çš„ <code>id</code> attribute å°†ä¸ç»„ä»¶çŠ¶æ€é‡Œçš„ <code>dynamicId</code> å±æ€§ä¿æŒåŒæ­¥ã€‚</p><p>ç”±äº <code>v-bind</code> ä½¿ç”¨åœ°éå¸¸é¢‘ç¹ï¼Œå®ƒæœ‰ä¸€ä¸ªä¸“é—¨çš„ç®€å†™è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div :id=&quot;dynamicId&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œè¯•ç€æŠŠä¸€ä¸ªåŠ¨æ€çš„Â <code>class</code>Â ç»‘å®šæ·»åŠ åˆ°è¿™ä¸ªÂ <code>&lt;h1&gt;</code>Â ä¸Šï¼Œå¹¶ä½¿ç”¨Â <code>titleClass</code>Â çš„Â refÂ ä½œä¸ºå®ƒçš„å€¼ã€‚å¦‚æœç»‘å®šæ­£ç¡®ï¼Œæ–‡å­—å°†ä¼šå˜ä¸ºçº¢è‰²ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; reactive, ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const counter = reactive(&#123; count: 0 &#125;)</span><br><span class="line">const message = ref(&#x27;Hello World!&#x27;)</span><br><span class="line"></span><br><span class="line">const titleClass = ref(&#x27;title&#x27;)  //å®šæ­»titleClass çš„ ref ä½œä¸ºå®ƒçš„å€¼ã€‚å¦‚æœç»‘å®šæ­£ç¡®ï¼Œæ–‡å­—å°†ä¼šå˜ä¸ºçº¢è‰²ã€‚</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;learn1&quot;&gt;</span><br><span class="line">    &lt;h1&gt;ä½ å¥½ä¸–ç•Œ&lt;/h1&gt;</span><br><span class="line">    &lt;h1&gt;&#123;&#123; message &#125;&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;p&gt;Count is: &#123;&#123; counter.count &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;h1 :class=&quot;titleClass&quot;&gt;è®©æˆ‘å˜çº¢&lt;/h1&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">@media (min-width: 1024px) &#123;</span><br><span class="line">  .learn &#123;</span><br><span class="line">    min-height: 100vh;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">.title&#123;</span><br><span class="line">  color: brown;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>å®ä¾‹äºŒ</p><h3 id="äº‹ä»¶ç›‘å¬">äº‹ä»¶ç›‘å¬</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>v-on</code> æŒ‡ä»¤ç›‘å¬ DOM äº‹ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button v-on:click=&quot;increment&quot;&gt;&#123;&#123; count &#125;&#125;&lt;/button&gt;</span><br></pre></td></tr></table></figure><p>å› ä¸ºå…¶ç»å¸¸ä½¿ç”¨ï¼Œ<code>v-on</code>Â ä¹Ÿæœ‰ä¸€ä¸ªç®€å†™è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button @click=&quot;increment&quot;&gt;&#123;&#123; count &#125;&#125;&lt;/button&gt;</span><br></pre></td></tr></table></figure><p>æ­¤å¤„ï¼Œ<code>increment</code>Â å¼•ç”¨äº†ä¸€ä¸ªåœ¨Â <code>&lt;script setup&gt;</code>Â ä¸­å£°æ˜çš„å‡½æ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const count = ref(0)</span><br><span class="line"></span><br><span class="line">function increment() &#123;</span><br><span class="line">  // æ›´æ–°ç»„ä»¶çŠ¶æ€</span><br><span class="line">  count.value++</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹ ref æ¥æ›´æ–°ç»„ä»¶çŠ¶æ€ã€‚</p><p>äº‹ä»¶å¤„ç†å‡½æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨å†…ç½®è¡¨è¾¾å¼ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ä¿®é¥°ç¬¦ç®€åŒ–å¸¸è§ä»»åŠ¡ã€‚è¿™äº›ç»†èŠ‚åŒ…å«åœ¨<a href="https://cn.vuejs.org/guide/essentials/event-handling.html">æŒ‡å— - äº‹ä»¶å¤„ç†</a>ã€‚</p><p>ç°åœ¨ï¼Œå°è¯•è‡ªè¡Œå®ç° <code>increment</code> å‡½æ•°å¹¶é€šè¿‡ä½¿ç”¨ <code>v-on</code> å°†å…¶ç»‘å®šåˆ°æŒ‰é’®ä¸Šã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const count = ref(0)</span><br><span class="line"></span><br><span class="line">function increment()&#123;</span><br><span class="line">  count.value ++ ;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- ä½¿æ­¤æŒ‰é’®ç”Ÿæ•ˆ --&gt;</span><br><span class="line">  &lt;button @click=&quot;increment()&quot;&gt;count is: &#123;&#123; count &#125;&#125;&lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="è¡¨å•ç»‘å®š">è¡¨å•ç»‘å®š</h3><p>æˆ‘ä»¬å¯ä»¥åŒæ—¶ä½¿ç”¨Â <code>v-bind</code>Â å’ŒÂ <code>v-on</code>Â æ¥åœ¨è¡¨å•çš„è¾“å…¥å…ƒç´ ä¸Šåˆ›å»ºåŒå‘ç»‘å®šï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input :value=&quot;text&quot; @input=&quot;onInput&quot;&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">onInput</span>(<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="comment">// v-on å¤„ç†å‡½æ•°ä¼šæ¥æ”¶åŸç”Ÿ DOM äº‹ä»¶</span></span><br><span class="line">  <span class="comment">// ä½œä¸ºå…¶å‚æ•°ã€‚</span></span><br><span class="line">  text.<span class="property">value</span> = e.<span class="property">target</span>.<span class="property">value</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯•ç€åœ¨æ–‡æœ¬æ¡†é‡Œè¾“å…¥â€”â€”ä½ ä¼šçœ‹åˆ° <code>&lt;p&gt;</code> é‡Œçš„æ–‡æœ¬ä¹Ÿéšç€ä½ çš„è¾“å…¥æ›´æ–°äº†ã€‚</p><p>ä¸ºäº†ç®€åŒ–åŒå‘ç»‘å®šï¼ŒVue æä¾›äº†ä¸€ä¸ª <code>v-model</code> æŒ‡ä»¤ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸Šè¿°æ“ä½œçš„è¯­æ³•ç³–ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input v-model=&quot;text&quot;&gt;</span><br></pre></td></tr></table></figure><p><code>v-model</code> ä¼šå°†è¢«ç»‘å®šçš„å€¼ä¸ <code>&lt;input&gt;</code> çš„å€¼è‡ªåŠ¨åŒæ­¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸å¿…å†ä½¿ç”¨äº‹ä»¶å¤„ç†å‡½æ•°äº†ã€‚</p><p><code>v-model</code> ä¸ä»…æ”¯æŒæ–‡æœ¬è¾“å…¥æ¡†ï¼Œä¹Ÿæ”¯æŒè¯¸å¦‚å¤šé€‰æ¡†ã€å•é€‰æ¡†ã€ä¸‹æ‹‰æ¡†ä¹‹ç±»çš„è¾“å…¥ç±»å‹ã€‚æˆ‘ä»¬åœ¨<a href="https://cn.vuejs.org/guide/essentials/forms.html">æŒ‡å— - è¡¨å•ç»‘å®š</a>ä¸­è®¨è®ºäº†æ›´å¤šçš„ç»†èŠ‚ã€‚</p><p>ç°åœ¨ï¼Œè¯•ç€ç”¨ <code>v-model</code> æŠŠä»£ç é‡æ„ä¸€ä¸‹å§ã€‚</p><p>å®ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const text = ref(&#x27;&#x27;)</span><br><span class="line">function onInput(e) &#123;</span><br><span class="line">  text.value = e.target.value</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;input :value=&quot;text&quot; @input=&quot;onInput&quot; placeholder=&quot;Type here&quot;&gt;</span><br><span class="line">  &lt;p&gt;&#123;&#123; text &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>å˜åŒ–ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const text = ref(&#x27;&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;input v-model=&quot;text&quot; placeholder=&quot;Type here&quot;&gt;</span><br><span class="line">  &lt;p&gt;&#123;&#123; text &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="æ¡ä»¶æ¸²æŸ“">æ¡ä»¶æ¸²æŸ“</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Â <code>v-if</code>Â æŒ‡ä»¤æ¥æœ‰æ¡ä»¶åœ°æ¸²æŸ“å…ƒç´ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1 v-if=&quot;awesome&quot;&gt;Vue is awesome!&lt;/h1&gt;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªÂ <code>&lt;h1&gt;</code>Â æ ‡ç­¾åªä¼šåœ¨Â <code>awesome</code>Â çš„å€¼ä¸º<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Truthy">çœŸå€¼ (Truthy)</a>Â æ—¶æ¸²æŸ“ã€‚è‹¥Â <code>awesome</code>Â æ›´æ”¹ä¸º<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Falsy">å‡å€¼ (Falsy)</a>ï¼Œå®ƒå°†è¢«ä» DOM ä¸­ç§»é™¤ã€‚</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨Â <code>v-else</code>Â å’ŒÂ <code>v-else-if</code>Â æ¥è¡¨ç¤ºå…¶ä»–çš„æ¡ä»¶åˆ†æ”¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1 v-if=&quot;awesome&quot;&gt;Vue is awesome!&lt;/h1&gt;</span><br><span class="line">&lt;h1 v-else&gt;Oh no ğŸ˜¢&lt;/h1&gt;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œç¤ºä¾‹ç¨‹åºåŒæ—¶å±•ç¤ºäº†ä¸¤ä¸ª <code>&lt;h1&gt;</code> æ ‡ç­¾ï¼Œå¹¶ä¸”æŒ‰é’®ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚å°è¯•ç»™å®ƒä»¬æ·»åŠ  <code>v-if</code> å’Œ <code>v-else</code> æŒ‡ä»¤ï¼Œå¹¶å®ç° <code>toggle()</code> æ–¹æ³•ï¼Œè®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŒ‰é’®åœ¨å®ƒä»¬ä¹‹é—´åˆ‡æ¢ã€‚</p><p>æ›´å¤šç»†èŠ‚è¯·æŸ¥é˜… <code>v-if</code>ï¼š<a href="https://cn.vuejs.org/guide/essentials/conditional.html">æŒ‡å— - æ¡ä»¶æ¸²æŸ“</a></p><p>å®ä¾‹ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const awesome = ref(true)</span><br><span class="line">function toggle() &#123;</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button @click=&quot;toggle&quot;&gt;toggle&lt;/button&gt;</span><br><span class="line">  &lt;h1&gt;Vue is awesome!&lt;/h1&gt;</span><br><span class="line">  &lt;h1&gt;Oh no ğŸ˜¢&lt;/h1&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>ç­”æ¡ˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const awesome = ref(true)</span><br><span class="line">function toggle() &#123;</span><br><span class="line">  awesome.value = !awesome.value;//å¦‚æœç‚¹å‡»é€šè¿‡è§¦å‘å‡½æ•°æ”¹å˜å€¼</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;button @click=&quot;toggle&quot;&gt;toggle&lt;/button&gt;</span><br><span class="line">  &lt;h1 v-if=&quot;awesome&quot;&gt;Vue is awesome!&lt;/h1&gt; &lt;!-- å€¼ä¹‹å‰é‚£æ²¡æœ‰æ”¹å˜çš„å€¼--&gt;</span><br><span class="line">  &lt;h1 v-else&gt;Oh no ğŸ˜¢&lt;/h1&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="åˆ—è¡¨æ¸²æŸ“">åˆ—è¡¨æ¸²æŸ“</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Â <code>v-for</code>Â æŒ‡ä»¤æ¥æ¸²æŸ“ä¸€ä¸ªåŸºäºæºæ•°ç»„çš„åˆ—è¡¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">  &lt;li v-for=&quot;todo in todos&quot; :key=&quot;todo.id&quot;&gt;</span><br><span class="line">    &#123;&#123; todo.text &#125;&#125;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>todo</code> æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œè¡¨ç¤ºå½“å‰æ­£åœ¨è¿­ä»£çš„æ•°ç»„å…ƒç´ ã€‚å®ƒåªèƒ½åœ¨ <code>v-for</code> æ‰€ç»‘å®šçš„å…ƒç´ ä¸Šæˆ–æ˜¯å…¶å†…éƒ¨è®¿é—®ï¼Œå°±åƒå‡½æ•°çš„ä½œç”¨åŸŸä¸€æ ·ã€‚</p><p>æ³¨æ„ï¼Œæˆ‘ä»¬è¿˜ç»™æ¯ä¸ª todo å¯¹è±¡è®¾ç½®äº†å”¯ä¸€çš„ <code>id</code>ï¼Œå¹¶ä¸”å°†å®ƒä½œä¸º<a href="https://cn.vuejs.org/api/built-in-special-attributes.html#key">ç‰¹æ®Šçš„ <code>key</code> attribute</a> ç»‘å®šåˆ°æ¯ä¸ª <code>&lt;li&gt;</code>ã€‚<code>key</code> ä½¿å¾— Vue èƒ½å¤Ÿç²¾ç¡®çš„ç§»åŠ¨æ¯ä¸ª <code>&lt;li&gt;</code>ï¼Œä»¥åŒ¹é…å¯¹åº”çš„å¯¹è±¡åœ¨æ•°ç»„ä¸­çš„ä½ç½®ã€‚</p><p>æ›´æ–°åˆ—è¡¨æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li><p>åœ¨æºæ•°ç»„ä¸Šè°ƒç”¨<a href="https://stackoverflow.com/questions/9009879/which-javascript-array-functions-are-mutating">å˜æ›´æ–¹æ³•</a>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">todos.<span class="property">value</span>.<span class="title function_">push</span>(newTodo)</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨æ–°çš„æ•°ç»„æ›¿ä»£åŸæ•°ç»„ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">todos.<span class="property">value</span> = todos.<span class="property">value</span>.<span class="title function_">filter</span>(<span class="comment">/* ... */</span>)</span><br></pre></td></tr></table></figure></li></ol><p>è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„ todo åˆ—è¡¨â€”â€”è¯•ç€å®ç°ä¸€ä¸‹ <code>addTodo()</code> å’Œ <code>removeTodo()</code> è¿™ä¸¤ä¸ªæ–¹æ³•çš„é€»è¾‘ï¼Œä½¿åˆ—è¡¨èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼</p><p>å…³äº <code>v-for</code> çš„æ›´å¤šç»†èŠ‚ï¼š<a href="https://cn.vuejs.org/guide/essentials/list.html">æŒ‡å— - åˆ—è¡¨æ¸²æŸ“</a></p><p>vueå®ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">// ç»™æ¯ä¸ª todo å¯¹è±¡ä¸€ä¸ªå”¯ä¸€çš„ id</span><br><span class="line">let id = 0  //åˆå§‹idä¸º0</span><br><span class="line">const newTodo = ref(&#x27;&#x27;)</span><br><span class="line">const todos = ref([</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn HTML&#x27; &#125;,</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn JavaScript&#x27; &#125;,</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn Vue&#x27; &#125;</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">function addTodo() &#123;</span><br><span class="line">  // ...</span><br><span class="line">  newTodo.value = &#x27;&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function removeTodo(todo) &#123;</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;form @submit.prevent=&quot;addTodo&quot;&gt;</span><br><span class="line">    &lt;input v-model=&quot;newTodo&quot;&gt;</span><br><span class="line">    &lt;button&gt;Add Todo&lt;/button&gt;    </span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">      &lt;!--å¾ªç¯å˜é‡--&gt;</span><br><span class="line">    &lt;li v-for=&quot;todo in todos&quot; :key=&quot;todo.id&quot;&gt;</span><br><span class="line">      &#123;&#123; todo.text &#125;&#125;</span><br><span class="line">      &lt;button @click=&quot;removeTodo(todo)&quot;&gt;X&lt;/button&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>ç­”æ¡ˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">// ç»™æ¯ä¸ª todo å¯¹è±¡ä¸€ä¸ªå”¯ä¸€çš„ id</span><br><span class="line">let id = 0</span><br><span class="line">//å®šä¹‰æ–°çš„æ•°ç»„newTodo</span><br><span class="line">//è¿™è¡Œä»£ç ä½¿ç”¨äº† Vue 3 ä¸­çš„å“åº”å¼ï¼ˆreactiveï¼‰åŠŸèƒ½ï¼Œåˆ›å»ºäº†ä¸€ä¸ªåä¸º newTodo çš„å˜é‡ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºç©ºå­—ç¬¦ä¸²ã€‚å…¶ä¸­ const å…³é”®å­—è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œè€Œ ref åˆ™è¡¨ç¤ºè¿™ä¸ªå˜é‡æ˜¯å¯å“åº”çš„ï¼ˆreactiveï¼‰ã€‚</span><br><span class="line">const newTodo = ref(&#x27;&#x27;)</span><br><span class="line">//åˆå§‹åŒ–todosçš„æ•°æ®ï¼Œä½œä¸ºæ•°ç»„</span><br><span class="line">const todos = ref([</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn HTML&#x27; &#125;,</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn JavaScript&#x27; &#125;,</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn Vue&#x27; &#125;</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">//é€‰æ‹©æ·»åŠ æ–°çš„æ•°æ®è¿›å…¥æ•°ç»„</span><br><span class="line">function addTodo() &#123;</span><br><span class="line">  todos.value.push(&#123; id: id++, text: newTodo.value &#125;)</span><br><span class="line">  newTodo.value = &#x27;&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function removeTodo(todo) &#123;</span><br><span class="line">  todos.value = todos.value.filter((t) =&gt; t !== todo)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;form @submit.prevent=&quot;addTodo&quot;&gt;</span><br><span class="line">    &lt;input v-model=&quot;newTodo&quot;&gt;</span><br><span class="line">    &lt;button&gt;Add Todo&lt;/button&gt;    </span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &lt;li v-for=&quot;todo in todos&quot; :key=&quot;todo.id&quot;&gt;</span><br><span class="line">      &#123;&#123; todo.text &#125;&#125;</span><br><span class="line">      &lt;button @click=&quot;removeTodo(todo)&quot;&gt;X&lt;/button&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="è®¡ç®—å±æ€§">è®¡ç®—å±æ€§</h3><p>è®©æˆ‘ä»¬åœ¨ä¸Šä¸€æ­¥çš„ todo åˆ—è¡¨åŸºç¡€ä¸Šç»§ç»­ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ç»™æ¯ä¸€ä¸ª todo æ·»åŠ äº†åˆ‡æ¢åŠŸèƒ½ã€‚è¿™æ˜¯é€šè¿‡ç»™æ¯ä¸€ä¸ª todo å¯¹è±¡æ·»åŠ Â <code>done</code>Â å±æ€§æ¥å®ç°çš„ï¼Œå¹¶ä¸”ä½¿ç”¨äº†Â <code>v-model</code>Â å°†å…¶ç»‘å®šåˆ°å¤é€‰æ¡†ä¸Šï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;li v-for=&quot;todo in todos&quot;&gt;</span><br><span class="line">  &lt;input type=&quot;checkbox&quot; v-model=&quot;todo.done&quot;&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;/li&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸‹ä¸€ä¸ªå¯ä»¥æ·»åŠ çš„æ”¹è¿›æ˜¯éšè—å·²ç»å®Œæˆçš„ todoã€‚æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªèƒ½å¤Ÿåˆ‡æ¢ <code>hideCompleted</code> çŠ¶æ€çš„æŒ‰é’®ã€‚ä½†æ˜¯åº”è¯¥å¦‚ä½•åŸºäºçŠ¶æ€æ¸²æŸ“ä¸åŒçš„åˆ—è¡¨é¡¹å‘¢ï¼Ÿ</p><p>ä»‹ç»ä¸€ä¸ªæ–° APIï¼š<a href="https://cn.vuejs.org/guide/essentials/computed.html"><code>computed()</code></a>ã€‚å®ƒå¯ä»¥è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè®¡ç®—å±æ€§ refï¼Œè¿™ä¸ª ref ä¼šåŠ¨æ€åœ°æ ¹æ®å…¶ä»–å“åº”å¼æ•°æ®æºæ¥è®¡ç®—å…¶ <code>.value</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ref, computed &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const hideCompleted = ref(false)</span><br><span class="line">const todos = ref([</span><br><span class="line">  /* ... */</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">const filteredTodos = computed(() =&gt; &#123;</span><br><span class="line">  // æ ¹æ® `todos.value` &amp; `hideCompleted.value`</span><br><span class="line">  // è¿”å›è¿‡æ»¤åçš„ todo é¡¹ç›®</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;todo in todos&quot;</span>&gt;</span></span><br><span class="line">+ <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;todo in filteredTodos&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è®¡ç®—å±æ€§ä¼šè‡ªåŠ¨è·Ÿè¸ªå…¶è®¡ç®—ä¸­æ‰€ä½¿ç”¨çš„åˆ°çš„å…¶ä»–å“åº”å¼çŠ¶æ€ï¼Œå¹¶å°†å®ƒä»¬æ”¶é›†ä¸ºè‡ªå·±çš„ä¾èµ–ã€‚è®¡ç®—ç»“æœä¼šè¢«ç¼“å­˜ï¼Œå¹¶åªæœ‰åœ¨å…¶ä¾èµ–å‘ç”Ÿæ”¹å˜æ—¶æ‰ä¼šè¢«è‡ªåŠ¨æ›´æ–°ã€‚</p><p>ç°åœ¨ï¼Œè¯•ç€æ·»åŠ  <code>filteredTodos</code> è®¡ç®—å±æ€§å¹¶å®ç°è®¡ç®—é€»è¾‘ï¼å¦‚æœå®ç°æ­£ç¡®ï¼Œåœ¨éšè—å·²å®Œæˆé¡¹ç›®çš„çŠ¶æ€ä¸‹å‹¾é€‰ä¸€ä¸ª todoï¼Œå®ƒä¹Ÿåº”å½“è¢«ç«‹å³éšè—ã€‚</p><p>å®ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">let id = 0</span><br><span class="line">const newTodo = ref(&#x27;&#x27;)</span><br><span class="line">const hideCompleted = ref(false)</span><br><span class="line">const todos = ref([</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn HTML&#x27;, done: true &#125;,</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn JavaScript&#x27;, done: true &#125;,</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn Vue&#x27;, done: false &#125;</span><br><span class="line">])</span><br><span class="line">function addTodo() &#123;</span><br><span class="line">  todos.value.push(&#123; id: id++, text: newTodo.value, done: false &#125;)</span><br><span class="line">  newTodo.value = &#x27;&#x27;</span><br><span class="line">&#125;</span><br><span class="line">function removeTodo(todo) &#123;</span><br><span class="line">  todos.value = todos.value.filter((t) =&gt; t !== todo)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;form @submit.prevent=&quot;addTodo&quot;&gt;</span><br><span class="line">    &lt;input v-model=&quot;newTodo&quot;&gt;</span><br><span class="line">    &lt;button&gt;Add Todo&lt;/button&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &lt;li v-for=&quot;todo in todos&quot; :key=&quot;todo.id&quot;&gt;</span><br><span class="line">      &lt;input type=&quot;checkbox&quot; v-model=&quot;todo.done&quot;&gt;</span><br><span class="line">      &lt;span :class=&quot;&#123; done: todo.done &#125;&quot;&gt;&#123;&#123; todo.text &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;button @click=&quot;removeTodo(todo)&quot;&gt;X&lt;/button&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">  &lt;button @click=&quot;hideCompleted = !hideCompleted&quot;&gt;</span><br><span class="line">    &#123;&#123; hideCompleted ? &#x27;Show all&#x27; : &#x27;Hide completed&#x27; &#125;&#125;</span><br><span class="line">  &lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">.done &#123;</span><br><span class="line">  text-decoration: line-through;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>ç­”æ¡ˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, computed &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">let id = 0</span><br><span class="line"></span><br><span class="line">const newTodo = ref(&#x27;&#x27;)</span><br><span class="line">//è®¾ç½®hideCompleytedä¸ºfalse</span><br><span class="line">const hideCompleted = ref(false)</span><br><span class="line">//ä»æ—§æ˜¯å®šä¹‰ä¸€ä¸ªæ•°ç»„</span><br><span class="line">const todos = ref([</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn HTML&#x27;, done: true &#125;,</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn JavaScript&#x27;, done: true &#125;,</span><br><span class="line">  &#123; id: id++, text: &#x27;Learn Vue&#x27;, done: false &#125;</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">const filteredTodos = computed(() =&gt; &#123;</span><br><span class="line">    //è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯è¿”å›ä¸€ä¸ªæ ¹æ®hideCompleted.valueæ¥ç­›é€‰çš„todosæ•°ç»„ã€‚å¦‚æœhideCompleted.valueä¸ºtrueï¼Œåˆ™è¿”å›æœªå®Œæˆçš„ä»»åŠ¡æ•°ç»„ï¼ˆå³doneå±æ€§ä¸ºfalseï¼‰ï¼Œå¦åˆ™è¿”å›æ‰€æœ‰ä»»åŠ¡æ•°ç»„ã€‚</span><br><span class="line">  return hideCompleted.value</span><br><span class="line">    ? todos.value.filter((t) =&gt; !t.done)</span><br><span class="line">    : todos.value</span><br><span class="line">&#125;)</span><br><span class="line">function addTodo() &#123;</span><br><span class="line">  todos.value.push(&#123; id: id++, text: newTodo.value, done: false &#125;)</span><br><span class="line">  newTodo.value = &#x27;&#x27;</span><br><span class="line">&#125;</span><br><span class="line">function removeTodo(todo) &#123;</span><br><span class="line">  todos.value = todos.value.filter((t) =&gt; t !== todo)</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;form @submit.prevent=&quot;addTodo&quot;&gt;</span><br><span class="line">    &lt;input v-model=&quot;newTodo&quot;&gt;</span><br><span class="line">    &lt;button&gt;Add Todo&lt;/button&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &lt;li v-for=&quot;todo in filteredTodos&quot; :key=&quot;todo.id&quot;&gt;</span><br><span class="line">      &lt;input type=&quot;checkbox&quot; v-model=&quot;todo.done&quot;&gt;</span><br><span class="line">      &lt;span :class=&quot;&#123; done: todo.done &#125;&quot;&gt;&#123;&#123; todo.text &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;button @click=&quot;removeTodo(todo)&quot;&gt;X&lt;/button&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">  &lt;button @click=&quot;hideCompleted = !hideCompleted&quot;&gt;</span><br><span class="line">    &#123;&#123; hideCompleted ? &#x27;Show all&#x27; : &#x27;Hide completed&#x27; &#125;&#125;</span><br><span class="line">  &lt;/button&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">.done &#123;</span><br><span class="line">  text-decoration: line-through;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿå‘½å‘¨æœŸå’Œæ¨¡ç‰ˆå¼•ç”¨">ç”Ÿå‘½å‘¨æœŸå’Œæ¨¡ç‰ˆå¼•ç”¨</h3><p>ç›®å‰ä¸ºæ­¢ï¼ŒVue ä¸ºæˆ‘ä»¬å¤„ç†äº†æ‰€æœ‰çš„ DOM æ›´æ–°ï¼Œè¿™è¦å½’åŠŸäºå“åº”æ€§å’Œå£°æ˜å¼æ¸²æŸ“ã€‚ç„¶è€Œï¼Œæœ‰æ—¶æˆ‘ä»¬ä¹Ÿä¼šä¸å¯é¿å…åœ°éœ€è¦æ‰‹åŠ¨æ“ä½œ DOMã€‚</p><blockquote><p>â€œvarâ€ã€&quot;let&quot;å’Œ&quot;const&quot;åœ¨JavaScriptä¸­æ˜¯ç”¨äºå£°æ˜å˜é‡çš„å…³é”®å­—ã€‚&quot;var&quot;å£°æ˜çš„å˜é‡æ˜¯å‡½æ•°çº§ä½œç”¨åŸŸï¼Œå®ƒçš„ä½œç”¨èŒƒå›´åœ¨æ•´ä¸ªå‡½æ•°ä¸­ï¼›</p><p>è€Œ&quot;let&quot;å’Œ&quot;const&quot;å£°æ˜çš„å˜é‡æ˜¯å—çº§ä½œç”¨åŸŸï¼Œå®ƒä»¬çš„ä½œç”¨èŒƒå›´åœ¨å£°æ˜çš„ä»£ç å—å†…ã€‚</p><p><strong>ä¸åŒä¹‹å¤„åœ¨äº</strong>ï¼Œ&quot;let&quot;å£°æ˜çš„å˜é‡å¯ä»¥è¢«é‡æ–°èµ‹å€¼ï¼Œè€Œ&quot;const&quot;å£°æ˜çš„å˜é‡æ˜¯å¸¸é‡ï¼Œä¸èƒ½è¢«æ›´æ”¹ã€‚åœ¨é¢è¯•ä¸­å¸¸å¸¸æ¶‰åŠåˆ°è¿™äº›å…³é”®å­—çš„ä½¿ç”¨åŠå…¶åŒºåˆ«ã€‚</p></blockquote><p>è¿™æ—¶æˆ‘ä»¬éœ€è¦ä½¿ç”¨<strong>æ¨¡æ¿å¼•ç”¨</strong>â€”â€”ä¹Ÿå°±æ˜¯æŒ‡å‘æ¨¡æ¿ä¸­ä¸€ä¸ª DOM å…ƒç´ çš„ refã€‚æˆ‘ä»¬éœ€è¦é€šè¿‡<a href="https://cn.vuejs.org/api/built-in-special-attributes.html#ref">è¿™ä¸ªç‰¹æ®Šçš„ <code>ref</code> attribute</a> æ¥å®ç°æ¨¡æ¿å¼•ç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p ref=&quot;p&quot;&gt;hello&lt;/p&gt;</span><br></pre></td></tr></table></figure><p>è¦è®¿é—®è¯¥å¼•ç”¨ï¼Œæˆ‘ä»¬éœ€è¦å£°æ˜ä¸€ä¸ªåŒåçš„ refï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const p = ref(null)</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™ä¸ª ref ä½¿ç”¨ <code>null</code> å€¼æ¥åˆå§‹åŒ–ã€‚è¿™æ˜¯å› ä¸ºå½“ <code>&lt;script setup&gt;</code> æ‰§è¡Œæ—¶ï¼ŒDOM å…ƒç´ è¿˜ä¸å­˜åœ¨ã€‚æ¨¡æ¿å¼•ç”¨ ref åªèƒ½åœ¨ç»„ä»¶<strong>æŒ‚è½½</strong>åè®¿é—®ã€‚</p><p>è¦åœ¨æŒ‚è½½ä¹‹åæ‰§è¡Œä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>onMounted()</code> å‡½æ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import &#123; onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  // æ­¤æ—¶ç»„ä»¶å·²ç»æŒ‚è½½ã€‚</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™è¢«ç§°ä¸º<strong>ç”Ÿå‘½å‘¨æœŸé’©å­</strong>â€”â€”å®ƒå…è®¸æˆ‘ä»¬æ³¨å†Œä¸€ä¸ªåœ¨ç»„ä»¶çš„ç‰¹å®šç”Ÿå‘½å‘¨æœŸè°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚è¿˜æœ‰ä¸€äº›å…¶ä»–çš„é’©å­å¦‚ <code>onUpdated</code> å’Œ <code>onUnmounted</code>ã€‚æ›´å¤šç»†èŠ‚è¯·æŸ¥é˜…<a href="https://cn.vuejs.org/guide/essentials/lifecycle.html#lifecycle-diagram">ç”Ÿå‘½å‘¨æœŸå›¾ç¤º</a>ã€‚</p><p>ç°åœ¨ï¼Œå°è¯•æ·»åŠ ä¸€ä¸ª <code>onMounted</code> é’©å­ï¼Œç„¶åé€šè¿‡ <code>p.value</code> è®¿é—® <code>&lt;p&gt;</code>ï¼Œå¹¶ç›´æ¥å¯¹å…¶æ‰§è¡Œä¸€äº› DOM æ“ä½œã€‚(ä¾‹å¦‚ä¿®æ”¹å®ƒçš„ <code>textContent</code>)ã€‚</p><p>å®ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">const p = ref(null)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;p ref=&quot;p&quot;&gt;hello&lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>ç­”æ¡ˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">const p = ref(null)</span><br><span class="line">onMounted(() =&gt; &#123;</span><br><span class="line">  p.value.textContent = &#x27;mounted!&#x27;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;p ref=&quot;p&quot;&gt;hello&lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="ä¾¦å¬å™¨">ä¾¦å¬å™¨</h3><p>æœ‰æ—¶æˆ‘ä»¬éœ€è¦å“åº”æ€§åœ°æ‰§è¡Œä¸€äº›â€œå‰¯ä½œç”¨â€â€”â€”ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªæ•°å­—æ”¹å˜æ—¶å°†å…¶è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¾¦å¬å™¨æ¥å®ç°å®ƒï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ref, watch &#125; from &#x27;vue&#x27;</span><br><span class="line">const count = ref(0)</span><br><span class="line">watch(count, (newCount) =&gt; &#123;</span><br><span class="line">  // æ²¡é”™ï¼Œconsole.log() æ˜¯ä¸€ä¸ªå‰¯ä½œç”¨</span><br><span class="line">  console.log(`new count is: $&#123;newCount&#125;`)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>watch()</code>Â å¯ä»¥ç›´æ¥ä¾¦å¬ä¸€ä¸ª refï¼Œå¹¶ä¸”åªè¦Â <code>count</code>Â çš„å€¼æ”¹å˜å°±ä¼šè§¦å‘å›è°ƒã€‚<code>watch()</code>Â ä¹Ÿå¯ä»¥ä¾¦å¬å…¶ä»–ç±»å‹çš„æ•°æ®æºâ€”â€”æ›´å¤šè¯¦æƒ…è¯·å‚é˜…<a href="https://cn.vuejs.org/guide/essentials/watchers.html">æŒ‡å— - ä¾¦å¬å™¨</a>ã€‚</p><p>ä¸€ä¸ªæ¯”åœ¨æ§åˆ¶å°è¾“å‡ºæ›´åŠ å®é™…çš„ä¾‹å­æ˜¯å½“ ID æ”¹å˜æ—¶æŠ“å–æ–°çš„æ•°æ®ã€‚åœ¨å³è¾¹çš„ä¾‹å­ä¸­å°±æ˜¯è¿™æ ·ä¸€ä¸ªç»„ä»¶ã€‚è¯¥ç»„ä»¶è¢«æŒ‚è½½æ—¶ï¼Œä¼šä»æ¨¡æ‹Ÿ API ä¸­æŠ“å– todo æ•°æ®ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªæŒ‰é’®å¯ä»¥æ”¹å˜è¦æŠ“å–çš„ todo çš„ IDã€‚ç°åœ¨ï¼Œå°è¯•å®ç°ä¸€ä¸ªä¾¦å¬å™¨ï¼Œä½¿å¾—ç»„ä»¶èƒ½å¤Ÿåœ¨æŒ‰é’®è¢«ç‚¹å‡»æ—¶æŠ“å–æ–°çš„ todo é¡¹ç›®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const todoId = ref(1)</span><br><span class="line">const todoData = ref(null)</span><br><span class="line"></span><br><span class="line">async function fetchData() &#123;</span><br><span class="line">  todoData.value = null</span><br><span class="line">  const res = await fetch(</span><br><span class="line">    `https://jsonplaceholder.typicode.com/todos/$&#123;todoId.value&#125;`</span><br><span class="line">  )</span><br><span class="line">  todoData.value = await res.json()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fetchData()</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;p&gt;Todo id: &#123;&#123; todoId &#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;button @click=&quot;todoId++&quot;&gt;Fetch next todo&lt;/button&gt;</span><br><span class="line">  &lt;p v-if=&quot;!todoData&quot;&gt;Loading...&lt;/p&gt;</span><br><span class="line">  &lt;pre v-else&gt;&#123;&#123; todoData &#125;&#125;&lt;/pre&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>ç­”æ¡ˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, watch &#125; from &#x27;vue&#x27;</span><br><span class="line"></span><br><span class="line">const todoId = ref(1)</span><br><span class="line">const todoData = ref(null)</span><br><span class="line"></span><br><span class="line">async function fetchData() &#123;</span><br><span class="line">  todoData.value = null</span><br><span class="line">  const res = await fetch(</span><br><span class="line">    `https://jsonplaceholder.typicode.com/todos/$&#123;todoId.value&#125;`</span><br><span class="line">  )</span><br><span class="line">  todoData.value = await res.json()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fetchData()</span><br><span class="line"></span><br><span class="line">watch(todoId, fetchData)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;p&gt;Todo id: &#123;&#123; todoId &#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;button @click=&quot;todoId++&quot;&gt;Fetch next todo&lt;/button&gt;</span><br><span class="line">  &lt;p v-if=&quot;!todoData&quot;&gt;Loading...&lt;/p&gt;</span><br><span class="line">  &lt;pre v-else&gt;&#123;&#123; todoData &#125;&#125;&lt;/pre&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="ç»„ä»¶">ç»„ä»¶</h3><p>ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªä½¿ç”¨äº†å•ä¸ªç»„ä»¶ã€‚çœŸæ­£çš„ Vue åº”ç”¨å¾€å¾€æ˜¯ç”±åµŒå¥—ç»„ä»¶åˆ›å»ºçš„ã€‚</p><p>çˆ¶ç»„ä»¶å¯ä»¥åœ¨æ¨¡æ¿ä¸­æ¸²æŸ“å¦ä¸€ä¸ªç»„ä»¶ä½œä¸ºå­ç»„ä»¶ã€‚è¦ä½¿ç”¨å­ç»„ä»¶ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¯¼å…¥å®ƒï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import ChildComp from &#x27;./ChildComp.vue&#x27;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ç»„ä»¶ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;ChildComp /&gt;</span><br></pre></td></tr></table></figure><p>ç°åœ¨è‡ªå·±å°è¯•ä¸€ä¸‹â€”â€”å¯¼å…¥å­ç»„ä»¶å¹¶åœ¨æ¨¡æ¿ä¸­æ¸²æŸ“å®ƒã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import ChildComp from &#x27;./ChildComp.vue&#x27;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- render child component --&gt;</span><br><span class="line">&lt;ChildComp&gt;&lt;/ChildComp&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="Props">Props</h3><p>å­ç»„ä»¶å¯ä»¥é€šè¿‡Â <strong>props</strong>Â ä»çˆ¶ç»„ä»¶æ¥å—åŠ¨æ€æ•°æ®ã€‚é¦–å…ˆï¼Œéœ€è¦å£°æ˜å®ƒæ‰€æ¥å—çš„ propsï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- ChildComp.vue --&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">const props = defineProps(&#123;</span><br><span class="line">  msg: String</span><br><span class="line">&#125;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨æ„ <code>defineProps()</code> æ˜¯ä¸€ä¸ªç¼–è¯‘æ—¶å®ï¼Œå¹¶ä¸éœ€è¦å¯¼å…¥ã€‚ä¸€æ—¦å£°æ˜ï¼Œ<code>msg</code> prop å°±å¯ä»¥åœ¨å­ç»„ä»¶çš„æ¨¡æ¿ä¸­ä½¿ç”¨ã€‚å®ƒä¹Ÿå¯ä»¥é€šè¿‡ <code>defineProps()</code> æ‰€è¿”å›çš„å¯¹è±¡åœ¨ JavaScript ä¸­è®¿é—®ã€‚</p><p>çˆ¶ç»„ä»¶å¯ä»¥åƒå£°æ˜ HTML attributes ä¸€æ ·ä¼ é€’ propsã€‚è‹¥è¦ä¼ é€’åŠ¨æ€å€¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>v-bind</code> è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;ChildComp :msg=&quot;greeting&quot; /&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import ChildComp from &#x27;./ChildComp.vue&#x27;</span><br><span class="line"></span><br><span class="line">  const props = defineProps(&#123;</span><br><span class="line">    msg:String</span><br><span class="line">  &#125;)</span><br><span class="line">  //é—®å€™å˜é‡</span><br><span class="line">const greeting = ref(&#x27;Hello from parent&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">&lt;!--:msgå¯¼å‘--&gt;</span><br><span class="line">  &lt;ChildComp :msg=&quot;greeting&quot;/&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="Emits">Emits</h3><p>é™¤äº†æ¥å—propsï¼Œå­ç»„ä»¶è¿˜å¯ä»¥å‘çˆ¶ç»„ä»¶è§¦å‘äº‹ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">// å£°æ˜è§¦å‘çš„äº‹ä»¶</span><br><span class="line">const emit = defineEmits([&#x27;response&#x27;])</span><br><span class="line"></span><br><span class="line">// å¸¦å‚æ•°è§¦å‘</span><br><span class="line">emit(&#x27;response&#x27;, &#x27;hello from child&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>emit()</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº‹ä»¶çš„åç§°ã€‚å…¶ä»–æ‰€æœ‰å‚æ•°éƒ½å°†ä¼ é€’ç»™äº‹ä»¶ç›‘å¬å™¨ã€‚</p><p>çˆ¶ç»„ä»¶å¯ä»¥ä½¿ç”¨ <code>v-on</code> ç›‘å¬å­ç»„ä»¶è§¦å‘çš„äº‹ä»¶â€”â€”è¿™é‡Œçš„å¤„ç†å‡½æ•°æ¥æ”¶äº†å­ç»„ä»¶è§¦å‘äº‹ä»¶æ—¶çš„é¢å¤–å‚æ•°å¹¶å°†å®ƒèµ‹å€¼ç»™äº†æœ¬åœ°çŠ¶æ€ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;ChildComp @response=&quot;(msg) =&gt; childMsg = msg&quot; /&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref &#125; from &#x27;vue&#x27;</span><br><span class="line">import ChildComp from &#x27;./ChildComp.vue&#x27;</span><br><span class="line">const childMsg = ref(&#x27;No child msg yet&#x27;)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;ChildComp @response=&quot;(msg) =&gt; childMsg = msg&quot; /&gt;</span><br><span class="line">  &lt;p&gt;&#123;&#123; childMsg &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h3 id="æ’æ§½">æ’æ§½</h3><p>é™¤äº†é€šè¿‡ props ä¼ é€’æ•°æ®å¤–ï¼Œçˆ¶ç»„ä»¶è¿˜å¯ä»¥é€šè¿‡<strong>æ’æ§½</strong>Â (slots) å°†æ¨¡æ¿ç‰‡æ®µä¼ é€’ç»™å­ç»„ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;ChildComp&gt;</span><br><span class="line">  This is some slot content!</span><br><span class="line">&lt;/ChildComp&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨å­ç»„ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨Â <code>&lt;slot&gt;</code>Â å…ƒç´ ä½œä¸ºæ’æ§½å‡ºå£ (slot outlet) æ¸²æŸ“çˆ¶ç»„ä»¶ä¸­çš„æ’æ§½å†…å®¹ (slot content)ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- åœ¨å­ç»„ä»¶çš„æ¨¡æ¿ä¸­ --&gt;</span><br><span class="line">&lt;slot/&gt;</span><br></pre></td></tr></table></figure><p><code>&lt;slot&gt;</code>Â æ’å£ä¸­çš„å†…å®¹å°†è¢«å½“ä½œâ€œé»˜è®¤â€å†…å®¹ï¼šå®ƒä¼šåœ¨çˆ¶ç»„ä»¶æ²¡æœ‰ä¼ é€’ä»»ä½•æ’æ§½å†…å®¹æ—¶æ˜¾ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;slot&gt;Fallback content&lt;/slot&gt;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬æ²¡æœ‰ç»™Â <code>&lt;ChildComp&gt;</code>Â ä¼ é€’ä»»ä½•æ’æ§½å†…å®¹ï¼Œæ‰€ä»¥ä½ å°†çœ‹åˆ°é»˜è®¤å†…å®¹ã€‚è®©æˆ‘ä»¬åˆ©ç”¨çˆ¶ç»„ä»¶çš„Â <code>msg</code>Â çŠ¶æ€ä¸ºå­ç»„ä»¶æä¾›ä¸€äº›æ’æ§½å†…å®¹å§ã€‚</p>]]></content>
    
    
    <summary type="html">æœ¬æ–‡ä¸»è¦è®°å½•å‰ç«¯vueå­¦ä¹ çš„ä¸€äº›ç¬”è®°ï¼Œä»¥åŠå¦‚ä½•å»å¿«é€Ÿæ­å»ºä¸€ä¸ªvueæ¡†æ¶å’Œå¯åŠ¨vueå®ä¾‹ã€‚</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://luoxiaohei520.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="vue3" scheme="https://luoxiaohei520.github.io/tags/vue3/"/>
    
  </entry>
  
  <entry>
    <title>Spring</title>
    <link href="https://luoxiaohei520.github.io/posts/6c92115f.html"/>
    <id>https://luoxiaohei520.github.io/posts/6c92115f.html</id>
    <published>2023-11-09T02:50:23.339Z</published>
    <updated>2023-11-09T02:50:23.339Z</updated>
    
    <content type="html"><![CDATA[<h1>1.Spring</h1><p>spring ï¼š æ˜¥å¤©ç»™â€”â€”ã€‹è½¯ä»¶è¡Œä¸šå¸¦æ¥äº†æ˜¥å¤©ã€‚</p><p>å¼€å‘ç›®çš„ï¼š è§£å†³ä¼ä¸šçº§å¼€å‘çš„å¤æ‚æ€§ã€‚</p><p>ä½¿ç”¨javaBean ä»£æ›¿ EDG</p><p>å®˜ç½‘ï¼š <a href="https://spring.io/">https://spring.io/</a></p><p>spring ç†å¿µï¼š ä½¿å¾—ç°æœ‰çš„æŠ€æœ¯æ›´åŠ å®¹æ˜“ä½¿ç”¨ï¼Œæœ¬èº«å°±æ˜¯ä¸€ä¸ªå¤§æ‚çƒ©ï¼Œæ•´åˆäº†ç°æœ‰çš„æŠ€æœ¯æ¡†æ¶</p><p>SSH ï¼š Struct + Spring + Hibernate</p><p>SSM : Spring + SpringMVC + Maven</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- spring web mvc--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-JDBC<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="1-1-ä¼˜ç‚¹">1.1  ä¼˜ç‚¹</h2><ul><li><h5 id="Spring-æ˜¯ä¸€ä¸ªè½»é‡çº§å…è´¹çš„å¼€æºæ¡†æ¶ï¼ˆå®¹å™¨ï¼‰">Spring æ˜¯ä¸€ä¸ªè½»é‡çº§å…è´¹çš„å¼€æºæ¡†æ¶ï¼ˆå®¹å™¨ï¼‰</h5></li><li><h5 id="Springæ˜¯ä¸€ä¸ªè½»é‡çº§çš„ï¼Œéå…¥ä¾µå¼çš„æ¡†æ¶ï¼">Springæ˜¯ä¸€ä¸ªè½»é‡çº§çš„ï¼Œéå…¥ä¾µå¼çš„æ¡†æ¶ï¼</h5></li><li><h5 id="IOC-æ§åˆ¶åè½¬">IOC:æ§åˆ¶åè½¬</h5></li><li><h5 id="AOP-é¢å‘åˆ‡é¢ç¼–ç¨‹">AOP: é¢å‘åˆ‡é¢ç¼–ç¨‹</h5></li><li><h5 id="æ”¯æŒäº‹åŠ¡å¤„ç†ï¼Œå¯¹æ¡†æ¶æ•´åˆçš„æ”¯æŒ">æ”¯æŒäº‹åŠ¡å¤„ç†ï¼Œå¯¹æ¡†æ¶æ•´åˆçš„æ”¯æŒ</h5><p><em><strong>ä¸€å¥è¯ï¼š Springå°±æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ§åˆ¶åè½¬ï¼ˆIOCï¼‰å’Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰çš„å®¹å™¨</strong></em></p></li></ul><h3 id="1-1-1SpringBeançš„ç”Ÿå‘½å‘¨æœŸï¼š">1.1.1<strong>SpringBeançš„ç”Ÿå‘½å‘¨æœŸï¼š</strong></h3><p>è¯¦ç»†</p><ol><li><p>å®ä¾‹åŒ–beanå¯¹è±¡ï¼šåå°„çš„æ–¹å¼ç”Ÿæˆå¯¹è±¡</p></li><li><p>è®¾ç½®å¯¹è±¡å±æ€§ï¼ˆå¡«å……beançš„å±æ€§ï¼‰ï¼š</p><ol><li>populateBeanï¼ˆï¼‰,å¾ªç¯ä¾èµ–çš„é—®é¢˜</li></ol></li><li><p>æ£€æŸ¥Awareç›¸å…³æ¥å£å¹¶è®¾ç½®ç›¸å…³ä¾èµ–ï¼š</p><ol><li>invokeAwareMethod(å®ŒæˆBeanName,BeanFactory,BeanClassLoaderå¯¹è±¡çš„å±æ€§è®¾ç½®)</li></ol></li><li><p>beanPostProcessorå‰ç½®å¤„ç†ï¼š</p><ol><li>ä½¿ç”¨æ¯”è¾ƒå¤šçš„ï¼ˆApplicationContextPostProcessï¼Œè®¾ç½®ApplicationContextç­‰å¯¹è±¡ï¼‰</li></ol></li><li><p>æ£€æŸ¥æ˜¯å¦initalizingBeanä»¥å†³å®šæ˜¯å¦è°ƒç”¨afterPropertiesSetæ–¹æ³•</p></li><li><p>æ£€æŸ¥æ˜¯å¦é…ç½®æœ‰è‡ªå®šä¹‰çš„init-methodï¼šåˆ¤æ–­æ˜¯å¦å®ç°initalizingbeanæ¥å£ï¼Œå¦‚æœæœ‰ï¼Œè°ƒç”¨AfterPropertiesSetæ–¹æ³•ï¼Œæ²¡æœ‰å°±ä¸è°ƒç”¨</p></li><li><p>BeanPostProcessoråç½®å¤„ç†å¯¹è±¡ï¼š</p><ol><li>Springçš„AOPå°±æ˜¯åœ¨æ­¤å¤„å®ç°çš„ï¼ŒAbstractAutoProxyCreatoræ³¨å†ŒDestuctionç›¸å…³çš„å›è°ƒæ¥å£</li></ol></li><li><p>æ˜¯å¦å®ç°DisposableBeanæ¥å£ï¼Œè°ƒç”¨DestoryMethodæ–¹æ³•</p></li></ol><h2 id="1-2-ç»„æˆ">1.2 ç»„æˆ</h2><table><thead><tr><th>AOP</th><th>ORM</th><th>Spring Web</th><th>Spring Web MVC</th></tr></thead><tbody><tr><td>AOP</td><td>DAO</td><td>Spring Context</td><td>Spring Web MVC</td></tr><tr><td>CORE</td><td>CORE</td><td>CORE</td><td>CORE</td></tr></tbody></table><p><strong>æ ¸å¿ƒå®¹å™¨ï¼ˆSpring Coreï¼‰</strong></p><p>æ ¸å¿ƒå®¹å™¨æä¾›Springæ¡†æ¶çš„åŸºæœ¬åŠŸèƒ½ã€‚Springä»¥beançš„æ–¹å¼ç»„ç»‡å’Œç®¡ç†Javaåº”ç”¨ä¸­çš„å„ä¸ªç»„ä»¶åŠå…¶å…³ç³»ã€‚Springä½¿ç”¨BeanFactoryæ¥äº§ç”Ÿå’Œç®¡ç†Beanï¼Œå®ƒæ˜¯å·¥å‚æ¨¡å¼çš„å®ç°ã€‚BeanFactoryä½¿ç”¨æ§åˆ¶åè½¬(IoC)æ¨¡å¼å°†åº”ç”¨çš„é…ç½®å’Œä¾èµ–æ€§è§„èŒƒä¸å®é™…çš„åº”ç”¨ç¨‹åºä»£ç åˆ†å¼€ã€‚</p><p><strong>åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆSpring Contextï¼‰</strong></p><p>Springä¸Šä¸‹æ–‡æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå‘Springæ¡†æ¶æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚Springä¸Šä¸‹æ–‡åŒ…æ‹¬ä¼ä¸šæœåŠ¡ï¼Œå¦‚JNDIã€EJBã€ç”µå­é‚®ä»¶ã€å›½é™…åŒ–ã€æ ¡éªŒå’Œè°ƒåº¦åŠŸèƒ½ã€‚</p><p><strong>Springé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆSpring AOPï¼‰</strong></p><p>é€šè¿‡é…ç½®ç®¡ç†ç‰¹æ€§ï¼ŒSpring AOP æ¨¡å—ç›´æ¥å°†é¢å‘æ–¹é¢çš„ç¼–ç¨‹åŠŸèƒ½é›†æˆåˆ°äº† Springæ¡†æ¶ä¸­ã€‚æ‰€ä»¥ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°ä½¿ Springæ¡†æ¶ç®¡ç†çš„ä»»ä½•å¯¹è±¡æ”¯æŒ AOPã€‚Spring AOP æ¨¡å—ä¸ºåŸºäº Spring çš„åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡æä¾›äº†äº‹åŠ¡ç®¡ç†æœåŠ¡ã€‚é€šè¿‡ä½¿ç”¨ Spring AOPï¼Œä¸ç”¨ä¾èµ– EJB ç»„ä»¶ï¼Œå°±å¯ä»¥å°†å£°æ˜æ€§äº‹åŠ¡ç®¡ç†é›†æˆåˆ°åº”ç”¨ç¨‹åºä¸­ã€‚</p><p><strong>JDBCå’ŒDAOæ¨¡å—ï¼ˆSpring DAOï¼‰</strong></p><p>JDBCã€DAOçš„æŠ½è±¡å±‚æä¾›äº†æœ‰æ„ä¹‰çš„å¼‚å¸¸å±‚æ¬¡ç»“æ„ï¼Œå¯ç”¨è¯¥ç»“æ„æ¥ç®¡ç†å¼‚å¸¸å¤„ç†ï¼Œå’Œä¸åŒæ•°æ®åº“ä¾›åº”å•†æ‰€æŠ›å‡ºçš„é”™è¯¯ä¿¡æ¯ã€‚å¼‚å¸¸å±‚æ¬¡ç»“æ„ç®€åŒ–äº†é”™è¯¯å¤„ç†ï¼Œå¹¶ä¸”æå¤§çš„é™ä½äº†éœ€è¦ç¼–å†™çš„ä»£ç æ•°é‡ï¼Œæ¯”å¦‚æ‰“å¼€å’Œå…³é—­é“¾æ¥ã€‚</p><p><strong>å¯¹è±¡å®ä½“æ˜ å°„ï¼ˆSpring ORMï¼‰</strong></p><p>Springæ¡†æ¶æ’å…¥äº†è‹¥å¹²ä¸ªORMæ¡†æ¶ï¼Œä»è€Œæä¾›äº†ORMå¯¹è±¡çš„å…³ç³»å·¥å…·ï¼Œå…¶ä¸­åŒ…æ‹¬äº†Hibernateã€JDOå’Œ IBatis SQL Mapç­‰ï¼Œæ‰€æœ‰è¿™äº›éƒ½éµä»Springçš„é€šç”¨äº‹ç‰©å’ŒDAOå¼‚å¸¸å±‚æ¬¡ç»“æ„ã€‚</p><p><strong>Webæ¨¡å—ï¼ˆSpring Webï¼‰</strong></p><p>Webä¸Šä¸‹æ–‡æ¨¡å—å»ºç«‹åœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æ¨¡å—ä¹‹ä¸Šï¼Œä¸ºåŸºäºwebçš„åº”ç”¨ç¨‹åºæä¾›äº†ä¸Šä¸‹æ–‡ã€‚æ‰€ä»¥Springæ¡†æ¶æ”¯æŒä¸Strutsé›†æˆï¼Œwebæ¨¡å—è¿˜ç®€åŒ–äº†å¤„ç†å¤šéƒ¨åˆ†è¯·æ±‚ä»¥åŠå°†è¯·æ±‚å‚æ•°ç»‘å®šåˆ°åŸŸå¯¹è±¡çš„å·¥ä½œã€‚</p><p><strong>MVCæ¨¡å—ï¼ˆSpring Web MVCï¼‰</strong></p><p>MVCæ¡†æ¶æ˜¯ä¸€ä¸ªå…¨åŠŸèƒ½çš„æ„å»ºWebåº”ç”¨ç¨‹åºçš„MVCå®ç°ã€‚é€šè¿‡ç­–ç•¥æ¥å£ï¼ŒMVCæ¡†æ¶å˜æˆä¸ºé«˜åº¦å¯é…ç½®çš„ã€‚MVCå®¹çº³äº†å¤§é‡è§†å›¾æŠ€æœ¯ï¼Œå…¶ä¸­åŒ…æ‹¬JSPã€POIç­‰ï¼Œæ¨¡å‹æ¥æœ‰JavaBeanæ¥æ„æˆï¼Œå­˜æ”¾äºmå½“ä¸­ï¼Œè€Œè§†å›¾æ˜¯ä¸€ä¸ªè¡—å£ï¼Œè´Ÿè´£å®ç°æ¨¡å‹ï¼Œæ§åˆ¶å™¨è¡¨ç¤ºé€»è¾‘ä»£ç ï¼Œç”±cçš„äº‹æƒ…ã€‚Springæ¡†æ¶çš„åŠŸèƒ½å¯ä»¥ç”¨åœ¨ä»»ä½•J2EEæœåŠ¡å™¨å½“ä¸­ï¼Œå¤§å¤šæ•°åŠŸèƒ½ä¹Ÿé€‚ç”¨äºä¸å—ç®¡ç†çš„ç¯å¢ƒã€‚Springçš„æ ¸å¿ƒè¦ç‚¹å°±æ˜¯æ”¯æŒä¸ç»‘å®šåˆ°ç‰¹å®šJ2EEæœåŠ¡çš„å¯é‡ç”¨ä¸šåŠ¡å’Œæ•°æ®çš„è®¿é—®çš„å¯¹è±¡ï¼Œæ¯«æ— ç–‘é—®è¿™æ ·çš„å¯¹è±¡å¯ä»¥åœ¨ä¸åŒçš„J2EEç¯å¢ƒï¼Œç‹¬ç«‹åº”ç”¨ç¨‹åºå’Œæµ‹è¯•ç¯å¢ƒä¹‹é—´é‡ç”¨ã€‚</p><h1>2. IOCç†è®º</h1><ol><li><p>userDao</p></li><li><p>UserDaoImpl</p></li><li><p>UserService</p></li><li><p>UserServiceImpl</p><p>åœ¨æˆ‘ä»¬ä¹‹å‰çš„ä¸šåŠ¡ä¸­ï¼Œç”¨æˆ·çš„éœ€æ±‚å¯èƒ½ä¼šå½±å“æˆ‘ä»¬åŸæ¥çš„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserDao</span>  <span class="variable">userDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserDao</span> <span class="variable">userDao1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserMysqlDaoImpl</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserDao</span> <span class="variable">userDao2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserOracleDaoImpl</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//å½“ç”¨æˆ·éœ€æ±‚æ”¹å˜ï¼Œæˆ‘ä»¬å°†è¦æ¯æ¬¡éƒ½è¦æ”¹å˜ä»£ç ï¼Œå¾ˆéº»çƒ¦ï¼Œä»è€ŒspringIocçš„ç®€å•å°±æ¥äº†ã€‚</span></span><br><span class="line">        userDao1.getUser();<span class="comment">//è¿™æ˜¯æ–°æ·»åŠ çš„éœ€æ±‚ï¼Œæˆ‘è¦æ”¹æºä»£ç </span></span><br><span class="line">        userDao2.getUser();  <span class="comment">//è¿™åˆæ˜¯æ–°æ·»åŠ çš„éœ€æ±‚ï¼Œæˆ‘åˆè¦æ”¹ã€‚</span></span><br><span class="line">        userDao.getUser();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">        userService.getUser();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Hello world!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="2-1-IOCæœ¬è´¨">2.1 IOCæœ¬è´¨</h2><p>æ§åˆ¶åè½¬IOCæ˜¯ä¸€ç§ç¼–ç¨‹æ€æƒ³ï¼ŒDIï¼ˆä¾èµ–æ³¨å…¥ï¼‰å®ç°IOCçš„ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥è¯´Iocæ˜¯æ€æƒ³  DIåˆ™æ˜¯å®ç°æ–¹å¼ã€‚</p><p>IOCå¯ä»¥è¯´æ˜¯ï¼š<strong>æŠŠåˆ›å»ºå’ŒæŸ¥æ‰¾ä¾èµ–å¯¹è±¡çš„æ§åˆ¶æƒäº¤ç»™äº†å®¹å™¨ï¼Œç”±å®¹å™¨è¿›è¡Œæ³¨å…¥ç»„åˆå¯¹è±¡ï¼Œæ‰€ä»¥å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´æ˜¯ æ¾æ•£è€¦åˆï¼Œè¿™æ ·ä¹Ÿæ–¹ä¾¿æµ‹è¯•ï¼Œåˆ©äºåŠŸèƒ½å¤ç”¨ï¼Œæ›´é‡è¦çš„æ˜¯ä½¿å¾—ç¨‹åºçš„æ•´ä¸ªä½“ç³»ç»“æ„å˜å¾—éå¸¸çµæ´»ã€‚</strong></p><p>é‡‡ç”¨XMLçš„æ–¹å¼é…ç½®beanæ—¶å€™ï¼Œbeançš„å®šä¹‰ä¿¡æ¯å’Œå®ç°åˆ†ç¦»çš„ï¼Œè€Œé‡‡ç”¨æ³¨è§£çš„æ–¹å¼å¯ä»¥æŠŠä¸¤è€…åˆä¸ºä¸€ä½“ï¼Œbeançš„å®šä¹‰ç›´æ¥ä»¥æ³¨è§£çš„å½¢å¼å®šä¹‰åœ¨å®ç°ç±»ä¸­ï¼Œä»è€Œè¾¾åˆ°é›¶é…ç½®çš„ç›®çš„ã€‚</p><p>æ§åˆ¶åè½¬æ˜¯ä¸€ç§é€šè¿‡æè¿°ï¼ˆXMLæˆ–æ³¨è§£ï¼‰å¹¶é€šè¿‡ç¬¬ä¸‰æ–¹å»ç”Ÿäº§æˆ–è·å–ç‰¹å®šå¯¹è±¡çš„æ–¹å¼ï¼Œåœ¨springä¸­å®ç°æ§åˆ¶åè½¬çš„æ˜¯IOCå®¹å™¨ï¼Œå…¶å®ç°å®ä¾èµ–æ³¨å…¥ï¼ˆDI)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é»˜è®¤è·å–æ•°æ®&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">getUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*    private UserDao  userDao = new UserDaoImpl();</span></span><br><span class="line"><span class="comment">    private UserDao userDao1 = new UserMysqlDaoImpl();</span></span><br><span class="line"><span class="comment">    private UserDao userDao2 = new UserOracleDaoImpl();*/</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//å½“ç”¨æˆ·éœ€æ±‚æ”¹å˜ï¼Œæˆ‘ä»¬å°†è¦æ¯æ¬¡éƒ½è¦æ”¹å˜ä»£ç ï¼Œå¾ˆéº»çƒ¦ï¼Œä»è€ŒspringIocçš„ç®€å•å°±æ¥äº†ã€‚</span></span><br><span class="line">        <span class="comment">//userDao1.getUser();//è¿™æ˜¯æ–°æ·»åŠ çš„éœ€æ±‚ï¼Œæˆ‘è¦æ”¹æºä»£ç </span></span><br><span class="line">       <span class="comment">// userDao2.getUser();  //è¿™åˆæ˜¯æ–°æ·»åŠ çš„éœ€æ±‚ï¼Œæˆ‘åˆè¦æ”¹ã€‚</span></span><br><span class="line">        userDao.getUser();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;mysqlImpl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.dao.impl.UserMysqlDaoImpl&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;oracleImpl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.dao.impl.UserOracleDaoImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;UserServiceImpl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">             refï¼š å¼•ç”¨springå®¹å™¨ä¸­åˆ›å»ºå¥½çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">             valueï¼š å…·ä½“çš„å€¼ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;mysqlImpl&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--   æˆ‘æ¥æ‹ä¸€æ‹</span></span><br><span class="line"><span class="comment">    UserDaoä½œä¸ºæ¥å£ï¼Œæœ‰ä¸€ä¸ªæ–¹æ³•  UserDaoImpl å®ç°è¯¥æ–¹æ³•</span></span><br><span class="line"><span class="comment">    ç„¶åUserServiceæ¥å£ç±»æ–¹æ³•åŒå UserServiceImplå®ç°æ”¹æ–¹æ³•</span></span><br><span class="line"><span class="comment">    id    = oracle ä¹Ÿå°±æ˜¯context.getBean(&quot;oracle&quot;); æ ‡è¯†ç¬¦</span></span><br><span class="line"><span class="comment">     UserServiceImpl userService1 = (UserServiceImpl) context.getBean(&quot;oracle&quot;);</span></span><br><span class="line"><span class="comment">      &lt;property name=&quot;userDao&quot; ref=&quot;oracleImpl&quot; /&gt;</span></span><br><span class="line"><span class="comment">      userDao ä¹Ÿå°±æ˜¯ setæ–¹æ³•çš„åå­—</span></span><br><span class="line"><span class="comment">      ref æŒ‡å‘  oracleImplä¹Ÿå°±æ˜¯ä¸‹è¾¹è¿™æ¡è¯­å¥</span></span><br><span class="line"><span class="comment">          &lt;bean id=&quot;oracleImpl&quot; class=&quot;com.xh.dao.impl.UserOracleDaoImpl&quot;&gt;</span></span><br><span class="line"><span class="comment">    &lt;/bean&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;oracle&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">             refï¼š å¼•ç”¨springå®¹å™¨ä¸­åˆ›å»ºå¥½çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">             valueï¼š å…·ä½“çš„å€¼ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;oracleImpl&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="2-2-IOCåˆ›å»ºå¯¹è±¡çš„æ–¹å¼">2.2 IOCåˆ›å»ºå¯¹è±¡çš„æ–¹å¼</h2><ol><li><p>ä½¿ç”¨æ— å‚æ„é€ åˆ›å»ºå¯¹è±¡ï¼Œæ²¡æœ‰æ— å‚æ„é€ å°†ä¼šæŠ¥é”™ï¼Œé»˜è®¤</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">  æ— å‚æ„é€ </span></span><br><span class="line"><span class="comment">  &lt;bean id=&quot;main&quot; class=&quot;com.xh.Main&quot;&gt;</span></span><br><span class="line"><span class="comment">       &lt;property name=&quot;user&quot; value=&quot;ä½œè€…&quot;/&gt;</span></span><br><span class="line"><span class="comment">   &lt;/bean&gt;--&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>å‡è®¾æˆ‘ä»¬è¦ä½¿ç”¨æœ‰å‚æ„é€ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Main&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;user=&#x27;&quot;</span> + user + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*  public Main() &#123;</span></span><br><span class="line"><span class="comment">        System.out.println(&quot;æ— å‚æ„é€ &quot;);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Main</span><span class="params">(String user)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUser</span><span class="params">(String user)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span>  <span class="title function_">show</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user:&quot;</span>+user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-----------------------------------------------------</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//springç›¸å½“äºå©šä»‹ç½‘ç«™</span></span><br><span class="line">        ApplicationContext context=  <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Main</span> <span class="variable">main</span> <span class="operator">=</span> (Main) context.getBean(<span class="string">&quot;main&quot;</span>);</span><br><span class="line">        main.show();</span><br><span class="line">      <span class="comment">//  Main main1 = (Main) context.getBean(&quot;main1&quot;);</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ä¸‹æ ‡èµ‹å€¼</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Main&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å°é»‘&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li><p>é€šè¿‡ç±»å‹åˆ›å»ºï¼Œä¸æ¨èä½¿ç”¨</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ç¬¬äºŒç§</span></span><br><span class="line"><span class="comment">       é€šè¿‡ç±»å‹åˆ›å»ºï¼Œä¸æ¨èä½¿ç”¨</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Main&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å°é»‘&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>ç›´æ¥é€šè¿‡å‚æ•°å</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Main&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å°é»‘&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol></li></ol><p>é‡ç‚¹ä½¿ç”¨nameæœ‰å‚æ„é€ å¥½ç”¨ï¼Œæ— å‚æ„é€ ç›´æ¥ç¬¬ä¸€ä¸ªé…ç½®</p><p>æ€»ç»“ï¼šåœ¨é…ç½®æ–‡ä»¶åŠ è½½çš„æ—¶å€™ï¼Œå®¹å™¨ä¸­çš„ç®¡ç†å¯¹è±¡å°±å·²ç»åˆå§‹åŒ–äº†</p><h1>3 Springé…ç½®</h1><h2 id="3-1-åˆ«å">3.1 åˆ«å</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å‚æ•°å--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Main&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å°é»‘&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- alias èµ·åˆ«å  name æ˜¯  Main main = (Main) context.getBean(&quot;main&quot;); --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">alias</span> <span class="attr">name</span>=<span class="string">&quot;main&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;yanliang&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Main</span> <span class="variable">main</span> <span class="operator">=</span> (Main) context.getBean(<span class="string">&quot;yanliang&quot;</span>);</span><br><span class="line"><span class="type">Main</span> <span class="variable">main1</span> <span class="operator">=</span> (Main) context.getBean(<span class="string">&quot;main&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="3-2-Beané…ç½®">3.2 Beané…ç½®</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.UserT&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user2,u2 u3;u4&quot;</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å°é»‘&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--    // åˆ«åå¯æ§åˆ¶ UserT userT = (UserT) context.getBean(&quot;u2&quot;);--&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3-3-Import">3.3 Import</h2><p>ä¸€èˆ¬ç”¨äºå›¢é˜Ÿå¼€å‘ï¼Œå°†å¤šä¸ªæ¨¡å—å¯¼ç¨‹ä¸€ä¸ª</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        ApplicationContext context=  new ClassPathXmlApplicationContext(&quot;application.xml&quot;);</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">application.xml</span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;bean.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;bean2.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;bean1.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>æ— éœ€æ‹…å¿ƒé‡åä»–ä¼šè‡ªå·±é€‰æ‹©ã€‚</p><h1>4 ä¾èµ–æ³¨å…¥(DI)</h1><h3 id="4-1-æ„é€ å™¨æ³¨å…¥">4.1 æ„é€ å™¨æ³¨å…¥</h3><p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„æœ‰å‚æ„é€ å’Œæ— å‚æ„é€ </p><h3 id="4-2-Setæ–¹å¼æ³¨å…¥ã€é‡ç‚¹ã€‘">4.2 Setæ–¹å¼æ³¨å…¥ã€é‡ç‚¹ã€‘</h3><p>ä¾èµ–æ³¨å…¥ï¼šsetæ³¨å…¥</p><p>ä¾èµ–: beanå¯¹è±¡çš„åˆ›å»ºä¾èµ–äºå®¹å™¨</p><p>æ³¨å…¥ï¼š beanå¯¹è±¡ä¸­çš„æ‰€æœ‰å±æ€§ç”±å®¹å™¨æ³¨å…¥</p><p>ç¯å¢ƒæ­å»º</p><ol><li><p>å¤æ‚ç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>  String address;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAddress</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddress</span><span class="params">(String address)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>çœŸå®æµ‹è¯•</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line">    <span class="keyword">private</span> String[] books;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; hobby;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,String&gt; card;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; games;</span><br><span class="line">    <span class="keyword">private</span> String wife;</span><br><span class="line">    <span class="keyword">private</span> Properties info;</span><br></pre></td></tr></table></figure><ol start="3"><li><p>Bean.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;student&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Student&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--ç¬¬ä¸€ç§æ™®é€šå€¼æ³¨å…¥ value--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å°é»‘&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="4"><li><p>Test</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> (Student) context.getBean(<span class="string">&quot;student&quot;</span>);</span><br><span class="line">        System.out.println(student.getName());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ol></li></ol><h3 id="4-3-æ‹“å±•æ–¹å¼æ³¨å…¥">4.3 æ‹“å±•æ–¹å¼æ³¨å…¥</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡på‘½åç©ºé—´æ³¨å…¥</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:c</span>=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--   p set å‘½åç©ºé—´æ³¨å…¥ï¼Œå¯ä»¥ç®€ä»‹æ³¨å…¥ ï¼š property--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.User&quot;</span> <span class="attr">p:uname</span>=<span class="string">&quot;å°é»‘&quot;</span> <span class="attr">p:age</span>=<span class="string">&quot;18&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  Cå‘½åç©ºé—´å¿…é¡»é€šè¿‡æ„é€ å™¨æ³¨å…¥æ‰è¡Œ æœ‰å‚æ— å‚æ„é€  construct-args æ³¨å…¥  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.User&quot;</span> <span class="attr">c:age</span>=<span class="string">&quot;18&quot;</span> <span class="attr">c:uname</span>=<span class="string">&quot;é¢œäº®&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Test</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">P:   </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> (Student) context.getBean(<span class="string">&quot;student&quot;</span>);</span><br><span class="line">        <span class="comment">//System.out.println(student.getName());</span></span><br><span class="line">        System.out.println(student.toString());</span><br><span class="line">    </span><br><span class="line">C:</span><br><span class="line">      <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span></span><br><span class="line">                <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;userBean.xml&quot;</span>);</span><br><span class="line">       <span class="type">User</span>  <span class="variable">user</span> <span class="operator">=</span>  context.getBean(<span class="string">&quot;user2&quot;</span>, User.class);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p>æ³¨æ„p:å‘½åç©ºé—´ä½¿ç”¨Setæ–¹å¼æ³¨å…¥ï¼Œè€ŒC:å‘½åç©ºé—´æ˜¯ä½¿ç”¨æ„é€ å™¨æ³¨å…¥ï¼Œæœ‰å‚æ„é€ ï¼Œæ— å‚æ„é€ éƒ½è¦æœ‰ï¼Œä¸”p,céƒ½éœ€è¦å¯¼å…¥ä¾èµ–æ‰èƒ½ä½¿ç”¨ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">xmlns:c=&quot;http://www.springframework.org/schema/c&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-4-Beanä½œç”¨åŸŸ">4.4 Beanä½œç”¨åŸŸ</h3><p>å•ä¾‹æ¨¡å¼ï¼šï¼ˆSpringé»˜è®¤æœºåˆ¶ï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user3&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.User&quot;</span> <span class="attr">c:age</span>=<span class="string">&quot;18&quot;</span> <span class="attr">c:uname</span>=<span class="string">&quot;é¢œäº®&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span>/&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åŸå‹æ¨¡å¼ï¼šæ¯æ¬¡ä»å®¹å™¨ä¸­getçš„æ—¶å€™éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°å¯¹è±¡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user4&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.User&quot;</span> <span class="attr">c:age</span>=<span class="string">&quot;18&quot;</span> <span class="attr">c:uname</span>=<span class="string">&quot;é¢œäº®&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>/&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…¶ä½™çš„request ,session,applicationè¿™äº›åªèƒ½åœ¨webå¼€å‘ä¸­ä½¿ç”¨ï¼</p><h1>5 beançš„è‡ªåŠ¨è£…é…</h1><p>è‡ªåŠ¨è£…é…æ˜¯springæ»¡è¶³beanä¾èµ–çš„ä¸€ç§æ–¹å¼</p><p>spring ä¼šåœ¨ä¸Šä¸‹æ–‡è‡ªåŠ¨å¯»æ‰¾ï¼Œå¹¶è‡ªåŠ¨ç»™beanè£…é…å±æ€§</p><p>åœ¨springä¸­æœ‰ä¸‰ç§è£…é…æ–¹å¼ï¼š</p><ol><li>åœ¨xmlä¸­æ˜¾ç¤ºçš„é…ç½®</li><li>åœ¨javaä¸­æ˜¾ç¤ºçš„é…ç½®</li><li>éšå¼çš„è‡ªåŠ¨è£…é…beanã€é‡è¦ã€‘</li></ol><h3 id="5-1æµ‹è¯•">5.1æµ‹è¯•</h3><p>ç¯å¢ƒæ­å»ºä¸€ä¸ªäººæœ‰ä¸¤ä¸ªå® ç‰©</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cat</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shout</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è‹—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shout</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä½ çš„ç‹—å«ä»€ä¹ˆï¼Ÿ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">People</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>  Cat cat;</span><br><span class="line">    <span class="keyword">private</span>  Dog dog;</span><br><span class="line">    <span class="keyword">private</span>  String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;People&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;cat=&quot;</span> + cat +</span><br><span class="line">                <span class="string">&quot;, dog=&quot;</span> + dog +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Cat <span class="title function_">getCat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCat</span><span class="params">(Cat cat)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cat = cat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Dog <span class="title function_">getDog</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDog</span><span class="params">(Dog dog)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dog = dog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">    <span class="type">People</span> <span class="variable">people</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;people&quot;</span>,People.class);</span><br><span class="line">    people.getDog().shout();</span><br><span class="line">    people.getCat().shout();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Dog&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Cat&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;people&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.People&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;èƒ¡å°é»‘&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cat&quot;</span>  <span class="attr">ref</span>=<span class="string">&quot;cat&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dog&quot;</span>  <span class="attr">ref</span>=<span class="string">&quot;dog&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="5-2-ByNameè‡ªåŠ¨è£…é…">5.2 ByNameè‡ªåŠ¨è£…é…</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--   ByName:ä¼šè‡ªåŠ¨ åœ¨å®¹å™¨ä¸Šä¸‹æ–‡æŸ¥æ‰¾ï¼Œå’Œè‡ªå·±å¯¹è±¡setæ–¹æ³•åè¾¹å¯¹åº”çš„ bean id --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;people&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.People&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æ˜¯å°èƒ¡å‘€&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Dog&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Cat&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCat</span><span class="params">(Cat cat)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.cat = cat;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDog</span><span class="params">(Dog dog)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.dog = dog;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-3-ByType">5.3 ByType</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    ByType ä¸ä¼šæ ¹æ®idè¿›è¡ŒæŸ¥æ‰¾ï¼Œå’Œè‡ªå·±å¯¹è±¡å±æ€§ç±»å‹ç›¸åŒçš„bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;people&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.People&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æ˜¯å°èƒ¡å‘€&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Dog&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;11cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Cat&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å°ç»“ï¼š</p><p>byNameçš„æ—¶å€™éœ€è¦ä¿è¯beançš„idå”¯ä¸€ï¼Œå¹¶ä¸”è¿™ä¸ªbeanéœ€è¦å’Œè‡ªåŠ¨æ³¨å…¥çš„å±æ€§çš„setæ–¹æ³•çš„å€¼ä¸€è‡´ã€‚</p><p>byTypeçš„æ—¶å€™éœ€è¦ä¿è¯beançš„classå”¯ä¸€ï¼Œå¹¶ä¸”è¿™ä¸ªbeanéœ€è¦å’Œè‡ªåŠ¨æ³¨å…¥çš„å±æ€§çš„ç±»å‹ä¸€è‡´ã€‚</p><h3 id="5-4-æ³¨è§£å®ç°è‡ªåŠ¨é…ç½®">5.4 æ³¨è§£å®ç°è‡ªåŠ¨é…ç½®</h3><p>JDk1.5ä»¥åæ”¯æŒæ³¨è§£ï¼Œspring 2.5æ”¯æŒæ³¨è§£â€˜</p><p>ä½¿ç”¨æ³¨è§£éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p><ol><li><p>å¯¼å…¥çº¦æŸcontextçº¦æŸ</p></li><li><p>é…ç½®æ³¨è§£çš„æ”¯æŒ  <a href="context:annotation-config/">context:annotation-config/</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;example.SimpleMovieCatalog&quot;</span> <span class="attr">primary</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;example.SimpleMovieCatalog&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- inject any dependencies required by this bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;movieRecommender&quot;</span> <span class="attr">class</span>=<span class="string">&quot;example.MovieRecommender&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="5-4-1-Autowired">5.4.1 @Autowired</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å¼€å¯æ³¨è§£çš„æ”¯æŒ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Dog&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.Cat&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;people&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.People&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;bean id=&quot;people&quot; class=&quot;com.xh.People&quot;&gt;</span></span><br><span class="line"><span class="comment">         &lt;property name=&quot;name&quot; value=&quot;èƒ¡å°é»‘&quot;/&gt;</span></span><br><span class="line"><span class="comment">         &lt;property name=&quot;cat&quot;  ref=&quot;cat&quot;/&gt;</span></span><br><span class="line"><span class="comment">         &lt;property name=&quot;dog&quot;  ref=&quot;dog&quot;/&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     &lt;/bean&gt;</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--   ByName:ä¼šè‡ªåŠ¨ åœ¨å®¹å™¨ä¸Šä¸‹æ–‡æŸ¥æ‰¾ï¼Œå’Œè‡ªå·±å¯¹è±¡setæ–¹æ³•åè¾¹å¯¹åº”çš„ beanid--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    &lt;bean id=&quot;people&quot; class=&quot;com.xh.People&quot; autowire=&quot;byName&quot;&gt;</span></span><br><span class="line"><span class="comment">            &lt;property name=&quot;name&quot; value=&quot;æ˜¯å°èƒ¡å‘€&quot;/&gt;</span></span><br><span class="line"><span class="comment">        &lt;/bean&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--    ByType ä¸ä¼šæ ¹æ®idè¿›è¡ŒæŸ¥æ‰¾ï¼Œå’Œè‡ªå·±å¯¹è±¡å±æ€§ç±»å‹ç›¸åŒçš„bean--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;bean id=&quot;people&quot; class=&quot;com.xh.People&quot; autowire=&quot;byType&quot;&gt;</span></span><br><span class="line"><span class="comment">        &lt;property name=&quot;name&quot; value=&quot;æ˜¯å°èƒ¡å‘€&quot;/&gt;</span></span><br><span class="line"><span class="comment">    &lt;/bean&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xh;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">People</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span>  Cat cat;</span><br><span class="line">    <span class="meta">@Autowired</span>  <span class="comment">//ä½¿ç”¨ä¹‹åget setæ–¹æ³•éƒ½ä¸éœ€è¦äº†ã€‚</span></span><br><span class="line">    <span class="keyword">private</span>  Dog dog;</span><br><span class="line">    <span class="keyword">private</span>  String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;People&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;cat=&quot;</span> + cat +</span><br><span class="line">                <span class="string">&quot;, dog=&quot;</span> + dog +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Cat <span class="title function_">getCat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCat</span><span class="params">(Cat cat)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cat = cat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Dog <span class="title function_">getDog</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDog</span><span class="params">(Dog dog)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dog = dog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç›´æ¥åœ¨å±æ€§ä¸Šä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨setæ–¹å¼ä¸Šä½¿ç”¨</p><p>ä½¿ç”¨Autowiredæˆ‘ä»¬è¿setæ–¹æ³•éƒ½ä¸éœ€è¦ä½¿ç”¨äº†ï¼Œå‰ææ¡ä»¶æ˜¯ä½ è¿™ä¸ªè‡ªåŠ¨è£…é…çš„å±æ€§åœ¨IOCï¼ˆSpringï¼‰å®¹å™¨ä¸­å­˜åœ¨ï¼Œä¸”ç¬¦åˆbyName;</p><p>ç§‘æ™®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span> å­—æ®µæ ‡è®°äº†è¿™ä¸ªæ³¨è§£ï¼Œè¯´æ˜å­—æ®µå¯ä»¥ä¸º<span class="literal">null</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Autowired &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">required</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired(required = false)</span> <span class="comment">//å¦‚æœæ˜¾ç¤ºçš„å®šä¹‰äº†Autowiredçš„requiredä¸ºfalseæ ‡å¿—è¿™ä¸ªå€¼å¯ä»¥ä¸ºç©ºå¦åˆ™ä¸å…è®¸ä¸ºç©º</span></span><br><span class="line">   </span><br></pre></td></tr></table></figure><p>å¦‚æœ@Autowiredè‡ªåŠ¨è£…é…ç¯å¢ƒæ¯”è¾ƒå¤æ‚çš„æ—¶å€™è‡ªåŠ¨è£…é…æ— æ³•é€šè¿‡ä¸€ä¸ªæ³¨è§£@Autowiredå®Œæˆçš„æ—¶å€™ï¼Œä½¿ç”¨@Qualifier(value=â€œ***â€)å»é…ç½®@Autowiredçš„ä½¿ç”¨ï¼ŒæŒ‡å®šä¸€ä¸ªå”¯ä¸€çš„beanå¯¹è±¡æ³¨å…¥</p><p>javaè‡ªå¸¦@Resource</p><p>@Resourceæ³¨è§£ï¼Œé¦–å…ˆå»springå®¹å™¨ä¸­æŸ¥æ‰¾idåå­—ï¼Œæ‰¾ä¸åˆ°æŸ¥æ‰¾ç±»å‹ï¼Œåœ¨æ‰¾ä¸åˆ°æŠ¥é”™ã€‚å”¯ä¸€ï¼Œä¸èƒ½æŸ¥æ‰¾é‡å¤çš„.</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Autowired</span><span class="comment">//ä½¿ç”¨ä¹‹åget setæ–¹æ³•éƒ½ä¸éœ€è¦äº†ã€‚</span></span><br><span class="line"><span class="variable">@Qualifier</span>(value = <span class="string">&quot;dog&quot;</span>) <span class="comment">//å¦‚æœå­˜åœ¨å¤šå¯¹ç›¸åŒçš„ï¼Œéœ€è¦ç²¾å‡†æŸ¥æ‰¾åˆ°ä¸€ä¸ªï¼Œå°±éœ€è¦è¿™ä¸ªæ³¨è§£æŒ‡å®šäº†</span></span><br><span class="line">private  Dog dog;</span><br></pre></td></tr></table></figure><p>@Resource</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Resource(name=&quot;cat&quot;)</span></span><br><span class="line">    <span class="keyword">private</span>  Cat cat;</span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span>  Dog dog;</span><br></pre></td></tr></table></figure><p>@Resource å’Œ     @AutowiredåŒºåˆ«</p><ol><li>éƒ½æ˜¯ç”¨æ¥è‡ªåŠ¨è£…é…çš„ï¼Œéƒ½å¯ä»¥æ”¾åˆ°å±æ€§å­—æ®µä¸Š</li><li>@Autowired é€šè¿‡bynameçš„æ–¹å¼å®ç°,è€Œä¸”å¿…é¡»è¦æ±‚è¿™ä¸ªå¯¹è±¡å­˜åœ¨ï¼Œå¦åˆ™æŠ¥é”™</li><li>@Resourceé¦–å…ˆå»springå®¹å™¨ä¸­æŸ¥æ‰¾idåå­—ï¼Œæ‰¾ä¸åˆ°æŸ¥æ‰¾ç±»å‹ï¼ˆByTypeï¼‰ï¼Œåœ¨æ‰¾ä¸åˆ°æŠ¥é”™ã€‚å”¯ä¸€ï¼Œä¸èƒ½æŸ¥æ‰¾é‡å¤çš„.</li><li>æ‰§è¡Œé¡ºåºä¸åŒ @Autowiredé€šè¿‡ByTypeçš„æ–¹å¼å®ç°ï¼Œ@Resourceé»˜è®¤é€šè¿‡byNameçš„æ–¹å¼å®ç°</li></ol></li></ol><h1>6 ä½¿ç”¨æ³¨è§£å¼€å‘</h1><p>åœ¨spring4ä»¥åï¼Œè¦ä½¿ç”¨æ³¨è§£å¼€å‘ï¼Œå¿…é¡»å¯¼å…¥Aopä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--æŒ‡å®šè¦æ‰«æçš„åŒ…ï¼Œè¿™ä¸ªåŒ…ä¸‹é¢çš„æ³¨è§£å°±ä¼šç”Ÿæ•ˆ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.xh&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>&gt;</span><span class="tag">&lt;/<span class="name">context:annotation-config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;bean id=&quot;user&quot; class=&quot;com.xh.dao.User&quot;/&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li><p>beanæ³¨å…¥</p></li><li><p>å±æ€§å¦‚ä½•æ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">// ç»„ä»¶ ç­‰ä»·äº&lt;bean id=&quot;user&quot; class=&quot;com.xh.dao.User&quot;/&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>  String name ; <span class="comment">//= &quot;å°é»‘&quot;;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç›¸å½“äº&lt;property name=&quot;name&quot; value=&quot;å°é»‘&quot;&gt;</span></span><br><span class="line">    <span class="meta">@Value(&quot;å°é»‘&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>è¡ç”Ÿçš„æ³¨è§£</p><p>@Component æœ‰å‡ ä¸ªè¡ç”Ÿæ³¨è§£ï¼Œæˆ‘ä»¬åœ¨webå¼€å‘ä¸­ï¼Œä¼šæŒ‰ç…§mvcä¸‰å±‚æ¶æ„åˆ†å±‚</p><p>dao ã€@Repositoryã€‘</p><p>bean ã€@Serviceã€‘</p><p>service ã€@Controllerã€‘</p><p>è¿™å››ä¸ªæ³¨è§£åŠŸèƒ½éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ä»£è¡¨å°†æŸä¸ªç±»æ³¨å†Œåˆ°springä¸­è£…é…ã€‚</p></li><li><p>è‡ªåŠ¨è£…é…é…ç½®</p><p>@Autowired</p></li><li><p>ä½œç”¨åŸŸ</p><p>@Scope(â€œâ€)  æŒ‡å®šæ¨¡å¼ å•ä¾‹æˆ–è€…åŸå‹æ¨¡å¼</p></li><li><p>æ€»ç»“</p><p>xmlä¸æ³¨è§£</p><ul><li><p>Xmlæ›´åŠ ä¸‡èƒ½ï¼Œé€‚ç”¨äºä»»ä½•åœºæ‰€ï¼ç»´æŠ¤æ–¹ä¾¿ç®€å•</p></li><li><p>æ³¨è§£ ä¸æ˜¯è‡ªå·±çš„ç±»ä½¿ç”¨ä¸äº†ï¼Œç»´æŠ¤ç›¸å¯¹å¤æ‚ï¼</p></li></ul><p>Xmlä¸æ³¨è§£æœ€ä½³å®è·µ</p><ul><li><p>xmlç”¨æ¥ç®¡ç†bean</p></li><li><p>æ³¨è§£åªè´Ÿè´£å®Œæˆå±æ€§çš„æ³¨å…¥</p></li><li><p>æˆ‘ä»¬åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­åªéœ€è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼šåªéœ€è¦å¼€å¯æ³¨è§£çš„æ”¯æŒã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.xh&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>&gt;</span><span class="tag">&lt;/<span class="name">context:annotation-config</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><h1>7 ä½¿ç”¨javaæ–¹å¼é…ç½®spring</h1><p>javaConfig</p><p>å®ä½“ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xh.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>  <span class="comment">//è¿™é‡Œè¿™ä¸ªæ³¨è§£çš„æ„æ€è¯´æ˜è¿™ä¸ªç±»è¢«æ³¨å†Œåˆ°Springä¸­</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Value(&quot;ç½—å°é»‘&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xh.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xh.bean.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">//è¿™ä¸ªä¹Ÿä¼šè¢«Springå®¹å™¨æ‰˜ç®¡ï¼Œæ³¨å†Œåˆ°å®¹å™¨ä¸­</span></span><br><span class="line"><span class="comment">//å› ä¸ºä»–@Configurationä»£è¡¨è¿™ä¸ªæ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œå°±å’Œæˆ‘ä»¬ä¹‹å‰çœ‹çš„bean.xml</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.xh&quot;)</span></span><br><span class="line"><span class="meta">@Import(UserConfig1.class)</span> <span class="comment">//å¯¼å…¥å¦ä¸€ä¸ªé…ç½®ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserConfig</span> &#123;</span><br><span class="line">   <span class="meta">@Bean</span>  <span class="comment">//æ³¨å†Œä¸€ä¸ªbeanå°±ç›¸å½“äºä¸€ä¸ªSpringxmlçš„beanè¡¨æƒ…</span></span><br><span class="line">   <span class="comment">//è¿™ä¸ªåå­—çš„æ–¹æ³•ï¼Œå°±æƒ³å½“ä¸</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span>  <span class="title class_">User</span>();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.xh.bean.User;</span><br><span class="line"><span class="keyword">import</span> com.xh.config.UserConfig;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span>  <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//å¦‚æœå®Œå…¨ä½¿ç”¨äº†é…ç½®ç±»çš„æ–¹å¼å»åšï¼Œæˆ‘ä»¬å°±åªèƒ½é€šè¿‡AnnotationConfig ä¸Šä¸‹æ–‡æ¥è·å–å®¹å™¨</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(UserConfig.class);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;user&quot;</span>,User.class);</span><br><span class="line">        System.out.println(</span><br><span class="line">                user.getName()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ç§çº¯javaçš„é…ç½®åœ¨SringBootéšå¤„å¯è§ã€‚</p><h1>8 AOP ä¹‹å‰ä»£ç†æ¨¡å¼</h1><p>ä¸ºä»€ä¹ˆè¦å­¦ä¹ ä»£ç†æ¨¡å¼ï¼Ÿ</p><p>è¿™å°±æ˜¯SpringAopçš„åº•å±‚ ã€Spring AOP ã€‘ ã€Spring MVCã€‘</p><h3 id="8-1-é™æ€ä»£ç†æ¨¡å¼-ï¼š">8.1 é™æ€ä»£ç†æ¨¡å¼ ï¼š</h3><ul><li><p>é™æ€ä»£ç†æ¨¡å¼ ï¼š</p><ul><li>æŠ½è±¡è§’è‰²ï¼š ä¸€èˆ¬ä½¿ç”¨æ¥å£å’ŒæŠ½è±¡ç±»æ¥è§£å†³</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Rent</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>çœŸå®è§’è‰²ï¼š è¢«ä»£ç†çš„è§’è‰²</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Host</span> <span class="keyword">implements</span> <span class="title class_">Rent</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ¿ä¸œå‡ºç§Ÿæˆ¿å­&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä»£ç†è§’è‰²ï¼š ä»£ç†çœŸå®è§’è‰²ï¼Œä»£ç†çœŸå®è§’è‰²åï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šåšä¸€äº›é™„å±æ“ä½œ</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Proxy</span> <span class="keyword">implements</span> <span class="title class_">Rent</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Host host;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Proxy</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Proxy</span><span class="params">(Host host)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.host = host;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span> &#123;</span><br><span class="line">        host.rent();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸­ä»‹å¸¦ä½ çœ‹æˆ¿</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">seeHouse</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸­ä»‹å¸¦ä½ çœ‹æˆ¿&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ”¶å–ä¸­ä»‹è´¹ç”¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fare</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ”¶å–ä¸­ä»‹è´¹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>å®¢æˆ·:è®¿é—®ä»£ç†è§’è‰²</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="comment">/* Host host = new Host();</span></span><br><span class="line"><span class="comment">        host.rent();*/</span></span><br><span class="line">        <span class="comment">//æˆ¿ä¸œä¸åœ¨ï¼Œæ‰¾ä»£ç†</span></span><br><span class="line">        <span class="type">Host</span> <span class="variable">host</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Host</span>();</span><br><span class="line">        <span class="comment">//ä»£ç† ä¸­ä»‹å¸®æˆ¿ä¸œç§Ÿæˆ¿å­ï¼Œä»£ç†ä¸€èˆ¬æœ‰é™„å±æ¡ä»¶</span></span><br><span class="line">        <span class="type">Proxy</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(host);</span><br><span class="line">        <span class="comment">//ä½ ä¸éœ€è¦é¢å¯¹æˆ¿ä¸œï¼Œç›´æ¥å¯ä»¥ç§Ÿåˆ°æˆ¿å­</span></span><br><span class="line">        proxy.rent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>ä»£ç†æ¨¡å¼çš„å¥½å¤„</p><ul><li><p>å¯ä»¥ä½¿å¾—çœŸå®è§’è‰²çš„æ“ä½œæ›´åŠ çº¯ç²¹ï¼Œä¸ç”¨å»å…³æ³¨ä¸€äº›å…¬å…±çš„ä¸šåŠ¡</p></li><li><p>å…¬å…±ä¹Ÿå°±äº¤ç»™ä»£ç†è§’è‰²ï¼Œå®ç°äº†ä¸šåŠ¡åˆ†å·¥</p></li><li><p>å…¬å…±ä¸šåŠ¡å‘ç”Ÿæ‹“å±•çš„æ—¶å€™ï¼Œæ–¹ä¾¿é›†ä¸­ç®¡ç†</p></li></ul><p>ç¼ºç‚¹</p><p>ä¸€ä¸ªçœŸå®çš„è§’è‰²ä¼šäº§ç”Ÿä¸€ä¸ªä»£ç†è§’è‰²ï¼Œä»£ç é‡ä¼šç¿»å€ï¼Œå¼€å‘æ•ˆç‡ä¼šå˜ä½ã€‚</p></li></ul><h3 id="8-2-å†æ¬¡ç†è§£">8.2 å†æ¬¡ç†è§£</h3><p>å¯¹åº”demo02.</p><h3 id="8-3-åŠ¨æ€ä»£ç†">8.3 åŠ¨æ€ä»£ç†</h3><ul><li><p>åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†ä¸€æ ·</p></li><li><p>åŠ¨æ€ä»£ç†çš„ä»£ç†æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œä¸æ˜¯æˆ‘ä»¬ç›´æ¥å†™å¥½çš„</p></li><li><p>åŠ¨æ€ä»£ç†åº•å±‚æ˜¯åå°„</p></li><li><p>åŠ¨æ€ä»£ç†åˆ†ä¸ºä¸¤å¤§ç±»ï¼š åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†ï¼ŒåŸºäºç±»çš„åŠ¨æ€ä»£ç†</p><ul><li>åŸºäºæ¥å£ â€” JDKå®ç°åŠ¨æ€ä»£ç†</li><li>åŸºäºç±»ï¼š cglib</li><li>javaå­—èŠ‚ç å®ç°ï¼šjavaist</li></ul><p>éœ€è¦äº†è§£ä¸¤ä¸ªç±»Proxyï¼ŒInvocationHandler</p><p>åŠ¨æ€ä»£ç†çš„å¥½å¤„ï¼š</p><ul><li><p>å¯ä»¥ä½¿å¾—çœŸå®è§’è‰²çš„æ“ä½œæ›´åŠ çº¯ç²¹ï¼Œä¸ç”¨å»å…³æ³¨ä¸€äº›å…¬å…±çš„ä¸šåŠ¡ã€‚</p></li><li><p>å…¬å…±ä¸šç»©äº¤ç»™äº†ä»£ç†è§’è‰²ï¼Œå®ç°äº†ä¸šåŠ¡çš„åˆ†å·¥</p></li><li><p>å…¬å…±ä¸šåŠ¡å‘ç”Ÿæ‹“å±•çš„æ—¶å€™ï¼Œæ–¹ä¾¿é›†ä¸­ç®¡ç†</p></li><li><p>ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»ä»£ç†çš„æ˜¯ä¸€ä¸ªæ¥å£ï¼Œä¸€èˆ¬å°±æ˜¯å¯¹åº”ä¸€ç±»æ¥å£ã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//çœŸå®è§’è‰²</span></span><br><span class="line">        <span class="type">Host</span> <span class="variable">host</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Host</span>();</span><br><span class="line">        <span class="comment">//ä»£ç†è§’è‰²ï¼šç°åœ¨æ²¡æœ‰</span></span><br><span class="line">        <span class="type">ProxyInvocationHandler</span> <span class="variable">proxyInvocationHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProxyInvocationHandler</span>();</span><br><span class="line">        proxyInvocationHandler.setRent(host);</span><br><span class="line">        <span class="type">Rent</span> <span class="variable">proxy</span> <span class="operator">=</span> (Rent) proxyInvocationHandler.getProxy();</span><br><span class="line">        proxy.rent();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Host</span> <span class="keyword">implements</span> <span class="title class_">Rent</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ¿ä¸œå‡ºç§Ÿæˆ¿å­&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyInvocationHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="comment">//è¢«ä»£ç†çš„æ¥å£</span></span><br><span class="line">    <span class="keyword">private</span> Rent rent;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Rent <span class="title function_">getRent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> rent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRent</span><span class="params">(Rent rent)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.rent = rent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getProxy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span>  Proxy.newProxyInstance(<span class="built_in">this</span>.getClass().getClassLoader(),rent.getClass().getInterfaces(),<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//åŠ¨æ€ä»£ç†å®ä¾‹ï¼Œå¹¶è¿”å›ç»“æœ</span></span><br><span class="line">        seeHouse();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(rent,args);</span><br><span class="line">        face();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title function_">seeHouse</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸­ä»‹çœ‹æˆ¿å­&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title function_">face</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ”¶å–ä¸­ä»‹è´¹ç”¨&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Rent</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rent</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserServiceImpl</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">        <span class="comment">//ä»£ç†è§’è‰²ä¸å­˜åœ¨</span></span><br><span class="line">        <span class="type">ProxyInvocationHandler</span> <span class="variable">pih</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProxyInvocationHandler</span>();</span><br><span class="line">        pih.setTarget(userService);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">proxy</span> <span class="operator">=</span> (UserService) pih.getProxy();</span><br><span class="line">        proxy.delete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyInvocationHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="comment">//è¢«ä»£ç†çš„æ¥å£</span></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTarget</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getProxy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span>  Proxy.newProxyInstance(<span class="built_in">this</span>.getClass().getClassLoader(),target.getClass().getInterfaces(),<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//åŠ¨æ€ä»£ç†å®ä¾‹ï¼Œå¹¶è¿”å›ç»“æœ</span></span><br><span class="line">        log(method.getName());<span class="comment">//åå°„æ–¹æ³•</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target,args);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œäº†&quot;</span>+ msg + <span class="string">&quot;æ–¹æ³•&quot;</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â€‹</p></li></ul><h1>9 spring Aop(é¢å‘åˆ‡é¢ç¼–ç¨‹)</h1><h3 id="9-1ä»€ä¹ˆæ˜¯Aop">9.1ä»€ä¹ˆæ˜¯Aop</h3><p>aopæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œé€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸåŠ¨æ€å®ç°ç¨‹åºåŠŸèƒ½çš„å”¯ä¸€ç»´æŠ¤çš„ä¸€ç§æŠ€æœ¯ï¼ŒAopæ˜¯OOPçš„å»¶ç»­ï¼Œæ˜¯è½¯ä»¶å¼€å‘ä¸­çš„ä¸€ä¸ªçƒ­ç‚¹ï¼Œä¹Ÿæ˜¯Springæ¡†æ¶ä¸­çš„ä¸€ä¸ªé‡è¦å†…å®¹ï¼Œæ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ç§è¡ç”ŸèŒƒå¼ï¼Œåˆ©ç”¨AOPå¯ä»¥å¯¹ä¸šåŠ¡é€»è¾‘çš„å„ä¸ªéƒ¨åˆ†è¿›è¡Œéš”ç¦»ï¼Œä»è€Œä½¿å¾—ä¸šåŠ¡é€»è¾‘å„ä¸ªéƒ¨åˆ†ä¹‹é—´çš„è€¦åˆåº¦é™ä½ï¼Œæé«˜ç¨‹åºçš„å¯é‡ç”¨æ€§ï¼ŒåŒæ—¶æé«˜å¼€å‘çš„æ•ˆç‡ã€‚</p><h3 id="9-2-Aopåœ¨springçš„ä½œç”¨">9. 2 Aopåœ¨springçš„ä½œç”¨</h3><p><strong>æä¾›å£°æ˜å¼äº‹åŠ¡ï¼›å…è®¸ç”¨æˆ·è‡ªå®šä¹‰åˆ‡é¢</strong></p><ul><li>æ¨ªåˆ‡å…³æ³¨ï¼ˆASPECTï¼‰:æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œè¢«æ¨¡å—åŒ–çš„ç‰¹æ®Šå¯¹è±¡ã€‚ï¼ˆç±»ï¼‰</li><li>åˆ‡é¢ï¼ˆASPECTï¼‰:åˆ‡é¢å¿…é¡»è¦å®Œæˆçš„å·¥ä½œã€‚ï¼ˆç±»çš„æ–¹æ³•ï¼‰</li><li>ç›®æ ‡ï¼ˆAdviceï¼‰: è¢«é€šçŸ¥å¯¹è±¡ã€‚</li><li>ä»£ç†ï¼ˆProxyï¼‰:å‘ç›®æ ‡å¯¹è±¡åº”ç”¨é€šçŸ¥ä¹‹ååˆ›å»ºçš„å¯¹è±¡ã€‚</li><li>åˆ‡å…¥ç‚¹ï¼ˆPointCutï¼‰:åˆ‡é¢é€šçŸ¥æ‰§è¡Œçš„â€œåœ°ç‚¹â€çš„å®šä¹‰</li><li>è¿æ¥ç‚¹ï¼ˆjoinPointï¼‰: ä¸åˆ‡å…¥ç‚¹åŒ¹é…çš„æ‰§è¡Œç‚¹ã€‚</li></ul><p>Spring Aopä¸­æ”¯æŒ5ç§ç±»å‹çš„Advice</p><p>å‰ç½®é€šçŸ¥ï¼š æ–¹æ³•å‰</p><p>åç½®é€šçŸ¥ï¼š æ–¹æ³•å</p><p>ç¯ç»•é€šçŸ¥ï¼šæ–¹æ³•å‰å</p><p>å¼‚å¸¸æŠ›å‡ºé€šçŸ¥ï¼š æ–¹æ³•æŠ›å‡ºå¼‚å¸¸</p><p>å¼•ä»‹é€šçŸ¥ï¼šç±»ä¸­å¢åŠ æ–°çš„æ–¹æ³•å±æ€§</p><h3 id="9-3-Springä¸­ä½¿ç”¨Aop">9.3 Springä¸­ä½¿ç”¨Aop</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!--ä½¿ç”¨springApiå¿…é¡»å¿…é¡»å¯¼å…¥çš„åŒ…--&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- an HTTP Session-scoped bean exposed as a proxy --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userPreferences&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.UserPreferences&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;session&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- instructs the container to proxy the surrounding bean --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:scoped-proxy</span>/&gt;</span> (1)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- a singleton-scoped bean injected with a proxy to the above bean --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.something.SimpleUserService&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- a reference to the proxied userPreferences bean --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userPreferences&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userPreferences&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ–¹å¼ä¸€ï¼šä½¿ç”¨springçš„APIæ¥å£ã€ä¸»è¦SpringAPIæ¥å£å®ç°ã€‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;addä¸€ä¸ªç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;deleteä¸€ä¸ªç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;updateä¸€ä¸ªç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">query</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;queryä¸€ä¸ªç”¨æˆ·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">query</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Log</span> <span class="keyword">implements</span> <span class="title class_">MethodBeforeAdvice</span> &#123;</span><br><span class="line">   <span class="comment">//method:è¦æ‰§è¡Œçš„ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•</span></span><br><span class="line">    <span class="comment">//objects: å‚æ•°</span></span><br><span class="line">    <span class="comment">//target ç›®æ ‡å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(target.getClass().getName()+<span class="string">&quot;çš„&quot;</span>+method.getName()+<span class="string">&quot;è¢«æ‰§è¡Œäº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AfterLog</span> <span class="keyword">implements</span> <span class="title class_">AfterReturningAdvice</span> &#123;</span><br><span class="line">   <span class="comment">//returnValue:è¿”å›å€¼</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">(Object returnValue, Method method, Object[] args, Object target)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œäº†&quot;</span>+ method.getName()+ <span class="string">&quot;æ–¹æ³•ï¼Œè¿”å›ç»“æœä¸º&quot;</span>+returnValue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">     <span class="comment">//æ³¨æ„ï¼ŒåŠ¨æ€ä»£ç†ï¼Œä»£ç†çš„æ˜¯æ¥å£</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) context.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        userService.add();</span><br><span class="line">        userService.query();</span><br><span class="line">        userService.update();</span><br><span class="line">        userService.delete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--        æ³¨å†Œbean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.service.UserServiceImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;log&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.log.Log&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;afterLog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.log.AfterLog&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--   é…ç½®aop--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        åˆ‡å…¥ç‚¹--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pointcut&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.xh.service.UserServiceImpl.*(..))&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--æ‰§è¡Œç¯ç»•å¢åŠ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;log&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointcut&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;afterLog&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointcut&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ–¹å¼äºŒï¼šè‡ªå®šä¹‰æ¥å®ç°AOPã€ä¸»è¦æ˜¯åˆ‡é¢å®šä¹‰ã€‘</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--        æ³¨å†Œbean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.service.UserServiceImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;log&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.log.Log&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;afterLog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.log.AfterLog&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æ–¹å¼ä¸€ï¼šéœ€è¦åŸç”ŸSpringAopæ¥å£</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      é…ç½®aopï¼šéœ€è¦å¯¼å…¥AOpçº¦æŸ--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  &lt;aop:config&gt;</span></span><br><span class="line"><span class="comment">          &amp;lt;!&amp;ndash;åˆ‡å…¥ç‚¹&amp;ndash;&amp;gt;</span></span><br><span class="line"><span class="comment">          &lt;aop:pointcut id=&quot;pointcut&quot; expression=&quot;execution(* com.xh.service.UserServiceImpl.*(..))&quot;/&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">          &amp;lt;!&amp;ndash;æ‰§è¡Œç¯ç»•å¢åŠ &amp;ndash;&amp;gt;</span></span><br><span class="line"><span class="comment">          &lt;aop:advisor advice-ref=&quot;log&quot; pointcut-ref=&quot;pointcut&quot;/&gt;</span></span><br><span class="line"><span class="comment">          &lt;aop:advisor advice-ref=&quot;afterLog&quot; pointcut-ref=&quot;pointcut&quot;/&gt;</span></span><br><span class="line"><span class="comment">      &lt;/aop:config&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ–¹å¼äºŒ  è‡ªå®šä¹‰ç±» --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;diy&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.diy.DiyPointCut&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--è‡ªå®šä¹‰åˆ‡é¢ refè¦å¼•ç”¨çš„ç±»--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;diy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--åˆ‡å…¥ç‚¹--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;point&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.xh.service.UserServiceImpl.*(..))&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--  é€šçŸ¥ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;before&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;point&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;after&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;point&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DiyPointCut</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œå‰&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œå&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;bean.xml&quot;</span>);</span><br><span class="line">     <span class="comment">//æ³¨æ„ï¼ŒåŠ¨æ€ä»£ç†ï¼Œä»£ç†çš„æ˜¯æ¥å£</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) context.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        userService.add();</span><br><span class="line">        userService.query();</span><br><span class="line">        userService.update();</span><br><span class="line">        userService.delete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ–¹æ³•ä¸‰ï¼šä½¿ç”¨æ³¨è§£</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">&lt;!--æ–¹å¼ä¸‰--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;annotationPointCut&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.xh.diy.AnnotationPointCut&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--   å¼€å¯æ³¨è§£æ”¯æŒ  JDKï¼ˆé»˜è®¤ proxy-target-class=&quot;false&quot;ï¼‰ cglib(proxy-target-class=&quot;true&quot;)--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> /&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//æ–¹å¼ä¸‰ä½¿ç”¨æ³¨è§£æ¥å®ç°</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">//æ ‡æ³¨è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªåˆ‡é¢</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnnotationPointCut</span> &#123;</span><br><span class="line">    <span class="meta">@Before(&quot;execution(* com.xh.service.UserServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=====æ–¹æ³•æ‰§è¡Œå‰======&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;execution(* com.xh.service.UserServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=====æ–¹æ³•æ‰§è¡Œå======&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åœ¨ç¯ç»•å¢å¼ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç»™å®šä¸€ä¸ªç±»ï¼Œä»£è¡¨æˆ‘ä»¬è¦å¤„ç†åˆ‡å…¥çš„ç‚¹</span></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.xh.service.UserServiceImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">around</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//  Signature signature = proceedingJoinPoint.getSignature();//è·å¾—ç­¾å</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">//   System.out.println(&quot;signature:&quot; + signature);</span></span><br><span class="line">        <span class="comment">//æ‰§è¡Œæ–¹æ³•</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ç¯ç»•å‰&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">proceed</span> <span class="operator">=</span>  proceedingJoinPoint.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¯ç»•å&quot;</span>);</span><br><span class="line">        System.out.println(proceed);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1>10  springæ•´åˆMybatis</h1><p>å›é¡¾mybatis:</p><ol><li><p>ç¼–å†™å®ä½“ç±»</p></li><li><p>ç¼–å†™æ ¸å¿ƒé…ç½®æ–‡ä»¶</p></li><li><p>ç¼–å†™æ¥å£</p></li><li><p>ç¼–å†™mapper.xml</p></li><li><p>æµ‹è¯•</p></li></ol><h1>11 .Springå£°æ˜äº‹åŠ¡</h1><p>æŠŠä¸€ç»„ä¸šåŠ¡å½“æˆä¸€ä¸ªä¸šåŠ¡æ¥åšï¼Œè¦ä¹ˆæˆåŠŸè¦ä¹ˆå¤±è´¥</p><p>äº‹åŠ¡åœ¨é¡¹ç›®ä¸­ï¼Œååˆ†é‡è¦ï¼Œæ¶‰åŠåˆ°æ•°æ®çš„ä¸€è‡´æ€§é—®é¢˜ï¼Œä¸èƒ½é©¬è™ã€‚</p><p>ç¡®ä¿å®Œæ•´æ€§å’Œä¸€è‡´æ€§</p><h4 id="ACID">ACID:</h4><p>åŸå­æ€§ï¼šè¦ä¹ˆæ‰§è¡Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ</p><p>éš”ç¦»æ€§ï¼šå¤šä¸ªä¸šåŠ¡å¯ä»¥æ“ä½œåŒä¸€ä¸ªèµ„æºé˜²æ­¢æ•°æ®æŸå</p><p>æŒä¹…æ€§ï¼š äº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œæ— è®ºç³»ç»Ÿå‘ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Œç»“æœéƒ½ä¸ä¼šå†è¢«å½±å“ï¼Œè¢«æŒä¹…åŒ–çš„å†™åˆ°å­˜å‚¨å™¨ä¸­ã€‚</p><p>ä¸€è‡´æ€§ï¼š</p><h4 id="Springä¸­äº‹åŠ¡çš„å£°æ˜ï¼š">Springä¸­äº‹åŠ¡çš„å£°æ˜ï¼š</h4><p>AOP ï¼š å£°æ˜å¼äº‹åŠ¡</p><p>ç¼–ç¨‹å¼äº‹åŠ¡ï¼šéœ€è¦åœ¨ä»£ç ä¸­è¿›è¡Œäº‹åŠ¡çš„ç®¡ç†</p><h4 id="ä¸ºä»€ä¹ˆè¦äº‹åŠ¡ï¼Ÿ">ä¸ºä»€ä¹ˆè¦äº‹åŠ¡ï¼Ÿ</h4><blockquote><p>å¦‚æœæ²¡æœ‰äº‹åŠ¡ï¼Œå¯èƒ½å­˜åœ¨æ•°æ®æäº¤ä¸ä¸€è‡´ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä¸åœ¨Springä¸­å»é…ç½®å£°æ˜å¼äº‹åŠ¡ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨ä»£ç ä¸­æ‰‹åŠ¨è®¾ç½®äº‹åŠ¡ã€‚</p><p>äº‹åŠ¡åœ¨é¡¹ç›®çš„å¼€å‘ä¸­å¾ˆé‡è¦ï¼Œæ¶‰åŠåˆ°é¡¹ç›®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚</p><p>åœ¨springä¸­éœ€è¦æ³¨æ„ï¼šåœ¨é…ç½®çš„è¿‡ç¨‹ä¸­éœ€è¦æ³¨æ„ç©ºæ ¼ã€‚</p><p>æœ‰ç©ºæ ¼å’Œæ²¡æœ‰ç©ºæ ¼çš„åŒºåˆ«æ˜¯å¾ˆå¤§çš„ã€‚</p></blockquote>]]></content>
    
    
    <summary type="html">ä½œä¸ºjavaæ¡†æ¶ç•Œæœ€å—æ¬¢è¿çš„æ¡†æ¶ä¹‹ä¸€ï¼ŒSpringçš„IOCå’ŒAOPä¸¤å¤§æ€æƒ³åŠå…¶é‡è¦ï¼Œä»¥è‡³äºä¹‹åè¡ç”Ÿå‡ºæ¥çš„Springæ¡†æ¶éƒ½ä½¿ç”¨äº†è¿™ä¸€æ“ä½œ</summary>
    
    
    
    <category term="javaå­¦ä¹ " scheme="https://luoxiaohei520.github.io/categories/java%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="Spring" scheme="https://luoxiaohei520.github.io/tags/Spring/"/>
    
  </entry>
  
  <entry>
    <title>Vue2å­¦ä¹ ç¬”è®°å’Œå®ä¾‹</title>
    <link href="https://luoxiaohei520.github.io/posts/640a35.html"/>
    <id>https://luoxiaohei520.github.io/posts/640a35.html</id>
    <published>2023-11-09T02:50:23.339Z</published>
    <updated>2023-11-09T02:50:23.339Z</updated>
    
    <content type="html"><![CDATA[<h1>Vue2</h1><h2 id="ä¸€-ä»€ä¹ˆæ˜¯Vue">ä¸€.ä»€ä¹ˆæ˜¯Vue?</h2><p>Vue (è¯»éŸ³ /vjuË/ï¼Œç±»ä¼¼äºÂ <strong>view</strong>) æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„<strong>æ¸è¿›å¼æ¡†æ¶</strong>ã€‚ä¸å…¶å®ƒå¤§å‹æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒVue è¢«è®¾è®¡ä¸ºå¯ä»¥è‡ªåº•å‘ä¸Šé€å±‚åº”ç”¨ã€‚Vue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œä¸ä»…æ˜“äºä¸Šæ‰‹ï¼Œè¿˜ä¾¿äºä¸ç¬¬ä¸‰æ–¹åº“æˆ–æ—¢æœ‰é¡¹ç›®æ•´åˆã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä¸<a href="https://v2.cn.vuejs.org/v2/guide/single-file-components.html">ç°ä»£åŒ–çš„å·¥å…·é“¾</a>ä»¥åŠå„ç§<a href="https://github.com/vuejs/awesome-vue#libraries--plugins">æ”¯æŒç±»åº“</a>ç»“åˆä½¿ç”¨æ—¶ï¼ŒVue ä¹Ÿå®Œå…¨èƒ½å¤Ÿä¸ºå¤æ‚çš„å•é¡µåº”ç”¨æä¾›é©±åŠ¨ã€‚</p><h3 id="1-1-å®‰è£…vue">1.1 å®‰è£…vue</h3><p>å°è¯• Vue.js æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨Â <a href="https://codesandbox.io/s/github/vuejs/v2.vuejs.org/tree/master/src/v2/examples/vue-20-hello-world">Hello World ä¾‹å­</a>ã€‚ä½ å¯ä»¥åœ¨æµè§ˆå™¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€å®ƒï¼Œè·Ÿç€ä¾‹å­å­¦ä¹ ä¸€äº›åŸºç¡€ç”¨æ³•ã€‚æˆ–è€…ä½ ä¹Ÿå¯ä»¥<a href="https://github.com/vuejs/v2.vuejs.org/blob/master/src/v2/examples/vue-20-hello-world/index.html">åˆ›å»ºä¸€ä¸ªÂ <code>.html</code>Â æ–‡ä»¶</a>ï¼Œç„¶åé€šè¿‡å¦‚ä¸‹æ–¹å¼å¼•å…¥ Vueï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼€å‘ç¯å¢ƒç‰ˆæœ¬ï¼ŒåŒ…å«äº†æœ‰å¸®åŠ©çš„å‘½ä»¤è¡Œè­¦å‘Š --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ç”Ÿäº§ç¯å¢ƒç‰ˆæœ¬ï¼Œä¼˜åŒ–äº†å°ºå¯¸å’Œé€Ÿåº¦ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue@2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="1-2-å£°æ˜å¼æ¸²æŸ“">1.2 å£°æ˜å¼æ¸²æŸ“</h3><p>å®é™…ä¸Šè¿™ä¸ªå°±æ˜¯å°†æ•°æ®å¯ä»¥åŠ¨æ€é‡‡ç”¨ç®€ä»‹çš„æ¨¡ç‰ˆè¯­æ³•æ¥å£°æ˜å¼åœ°å°†æ•°æ®æ¸²æŸ“è¿›DOMç³»ç»Ÿä¸­ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123; message &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>:&#123;</span><br><span class="line">        <span class="attr">message</span>:<span class="string">&quot;Miaow.Y.Hu!&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ç¬¬ä¸€ä¸ªvueåº”ç”¨ï¼Œç²—çœ‹å°±æ˜¯æ¸²æŸ“äº†ä¸€ä¸ªå­—ç¬¦ä¸²æ¨¡ç‰ˆï¼Œä½†æ˜¯å…¶å®vueåœ¨èƒŒååšäº†å¤§é‡çš„å·¥ä½œã€‚å…¶æ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯å“åº”å¼çš„ã€‚æˆ‘ä»¬é€šè¿‡ç¡®è®¤çš„æ–¹æ³•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vm.message;</span><br><span class="line">//æˆ–è€…</span><br><span class="line">vm.message = <span class="string">&quot;miao&quot;</span>;</span><br></pre></td></tr></table></figure><p>ä½ å°±å¯ä»¥çœ‹åˆ°ä¸Šä¾‹ç›¸åº”çš„è¿›è¡Œæ›´æ–°ã€‚</p><p>æ³¨æ„æˆ‘ä»¬ä¸å†å’ŒHTMLè¿›è¡Œäº¤äº’å¤„ç†äº†ã€‚ä¸€ä¸ªvueåº”ç”¨å°†ä¼šæŒ‚è½½åˆ°ä¸€ä¸ªDOMå…ƒç´ ä¸Šï¼Œè¿™ä¸ªä¾‹å­æ˜¯<code>#app</code>ç„¶åå¯¹å…¶è¿›è¡Œå®Œå…¨æ§åˆ¶ã€‚</p><p>é™¤äº†æ–‡æœ¬æ’å…¥å€¼ï¼Œè¿˜æœ‰ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app-2&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-bind:title</span>=<span class="string">&quot;message&quot;</span>&gt;</span></span><br><span class="line">    é¼ æ ‡æ‚¬åœå‡ ç§’é’ŸæŸ¥çœ‹æ­¤å¤„åŠ¨æ€ç»‘å®šçš„æç¤ºä¿¡æ¯ï¼</span><br><span class="line">  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app2 = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app-2&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;é¡µé¢åŠ è½½äº &#x27;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toLocaleString</span>()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬é‡åˆ°äº†ä¸€ç‚¹æ–°ä¸œè¥¿ã€‚ä½ çœ‹åˆ°çš„ <code>v-bind</code> attribute è¢«ç§°ä¸º<strong>æŒ‡ä»¤</strong>ã€‚æŒ‡ä»¤å¸¦æœ‰å‰ç¼€ <code>v-</code>ï¼Œä»¥è¡¨ç¤ºå®ƒä»¬æ˜¯ Vue æä¾›çš„ç‰¹æ®Š attributeã€‚å¯èƒ½ä½ å·²ç»çŒœåˆ°äº†ï¼Œå®ƒä»¬ä¼šåœ¨æ¸²æŸ“çš„ DOM ä¸Šåº”ç”¨ç‰¹æ®Šçš„å“åº”å¼è¡Œä¸ºã€‚åœ¨è¿™é‡Œï¼Œè¯¥æŒ‡ä»¤çš„æ„æ€æ˜¯ï¼šâ€œå°†è¿™ä¸ªå…ƒç´ èŠ‚ç‚¹çš„ <code>title</code> attribute å’Œ Vue å®ä¾‹çš„ <code>message</code> property ä¿æŒä¸€è‡´â€ã€‚</p><p>å¦‚æœä½ å†æ¬¡æ‰“å¼€æµè§ˆå™¨çš„ JavaScript æ§åˆ¶å°ï¼Œè¾“å…¥ <code>app2.message = 'æ–°æ¶ˆæ¯'</code>ï¼Œå°±ä¼šå†ä¸€æ¬¡çœ‹åˆ°è¿™ä¸ªç»‘å®šäº† <code>title</code> attribute çš„ HTML å·²ç»è¿›è¡Œäº†æ›´æ–°ã€‚</p><h3 id="1-3-æ¡ä»¶ä¸å¾ªç¯">1.3 æ¡ä»¶ä¸å¾ªç¯</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app-3&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;seen&quot;</span>&gt;</span>ç°åœ¨ä½ çœ‹åˆ°æˆ‘äº†<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app3 = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app-3&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">seen</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ç»§ç»­åœ¨æ§åˆ¶å°è¾“å…¥ <code>app3.seen = false</code>ï¼Œä½ ä¼šå‘ç°ä¹‹å‰æ˜¾ç¤ºçš„æ¶ˆæ¯æ¶ˆå¤±äº†ã€‚</p><p>è¿™ä¸ªä¾‹å­æ¼”ç¤ºäº†æˆ‘ä»¬ä¸ä»…å¯ä»¥æŠŠæ•°æ®ç»‘å®šåˆ° DOM æ–‡æœ¬æˆ– attributeï¼Œè¿˜å¯ä»¥ç»‘å®šåˆ° DOM <strong>ç»“æ„</strong>ã€‚æ­¤å¤–ï¼ŒVue ä¹Ÿæä¾›ä¸€ä¸ªå¼ºå¤§çš„è¿‡æ¸¡æ•ˆæœç³»ç»Ÿï¼Œå¯ä»¥åœ¨ Vue æ’å…¥/æ›´æ–°/ç§»é™¤å…ƒç´ æ—¶è‡ªåŠ¨åº”ç”¨<a href="https://v2.cn.vuejs.org/v2/guide/transitions.html">è¿‡æ¸¡æ•ˆæœ</a>ã€‚</p><p>è¿˜æœ‰å…¶å®ƒå¾ˆå¤šæŒ‡ä»¤ï¼Œæ¯ä¸ªéƒ½æœ‰ç‰¹æ®Šçš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œ<code>v-for</code> æŒ‡ä»¤å¯ä»¥ç»‘å®šæ•°ç»„çš„æ•°æ®æ¥æ¸²æŸ“ä¸€ä¸ªé¡¹ç›®åˆ—è¡¨ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app-4&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;todo in todos&quot;</span>&gt;</span></span><br><span class="line">      &#123;&#123; todo.text &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app4 = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app-4&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">todos</span>: [</span><br><span class="line">      &#123; <span class="attr">text</span>: <span class="string">&#x27;å­¦ä¹  JavaScript&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">text</span>: <span class="string">&#x27;å­¦ä¹  Vue&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">text</span>: <span class="string">&#x27;æ•´ä¸ªç‰›é¡¹ç›®&#x27;</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>åœ¨æ§åˆ¶å°é‡Œï¼Œè¾“å…¥Â <code>app4.todos.push(&#123; text: 'æ–°é¡¹ç›®' &#125;)</code>ï¼Œä½ ä¼šå‘ç°åˆ—è¡¨æœ€åæ·»åŠ äº†ä¸€ä¸ªæ–°é¡¹ç›®ã€‚</p><h3 id="1-4-å¤„ç†ç”¨è¾“å…¥">1.4 å¤„ç†ç”¨è¾“å…¥</h3><p>ä¸ºäº†è®©ç”¨æˆ·å’Œä½ çš„åº”ç”¨è¿›è¡Œäº¤äº’ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨Â <code>v-on</code>Â æŒ‡ä»¤æ·»åŠ ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ï¼Œé€šè¿‡å®ƒè°ƒç”¨åœ¨ Vue å®ä¾‹ä¸­å®šä¹‰çš„æ–¹æ³•ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app-5&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;reverseMessage&quot;</span>&gt;</span>åè½¬æ¶ˆæ¯<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app5 = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app-5&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;Hello Vue.js!&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="attr">reverseMessage</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">message</span> = <span class="variable language_">this</span>.<span class="property">message</span>.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ³¨æ„åœ¨Â <code>reverseMessage</code>Â æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ›´æ–°äº†åº”ç”¨çš„çŠ¶æ€ï¼Œä½†æ²¡æœ‰è§¦ç¢° DOMâ€”â€”æ‰€æœ‰çš„ DOM æ“ä½œéƒ½ç”± Vue æ¥å¤„ç†ï¼Œä½ ç¼–å†™çš„ä»£ç åªéœ€è¦å…³æ³¨é€»è¾‘å±‚é¢å³å¯ã€‚</p><p>Vue è¿˜æä¾›äº†Â <code>v-model</code>Â æŒ‡ä»¤ï¼Œå®ƒèƒ½è½»æ¾å®ç°è¡¨å•è¾“å…¥å’Œåº”ç”¨çŠ¶æ€ä¹‹é—´çš„åŒå‘ç»‘å®šã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app-6&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;message&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app6 = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app-6&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;Hello Vue!&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="1-5-ç»„ä»¶åŒ–åº”ç”¨æ„å»º">1.5 ç»„ä»¶åŒ–åº”ç”¨æ„å»º</h3><p>ç»„ä»¶ç³»ç»Ÿæ˜¯ Vue çš„å¦ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ç§æŠ½è±¡ï¼Œå…è®¸æˆ‘ä»¬ä½¿ç”¨å°å‹ã€ç‹¬ç«‹å’Œé€šå¸¸å¯å¤ç”¨çš„ç»„ä»¶æ„å»ºå¤§å‹åº”ç”¨ã€‚ä»”ç»†æƒ³æƒ³ï¼Œå‡ ä¹ä»»æ„ç±»å‹çš„åº”ç”¨ç•Œé¢éƒ½å¯ä»¥æŠ½è±¡ä¸ºä¸€ä¸ªç»„ä»¶æ ‘ï¼š</p><p><img src="https://v2.cn.vuejs.org/images/components.png" alt="Component Tree"></p><p>åœ¨ Vue é‡Œï¼Œä¸€ä¸ªç»„ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ‹¥æœ‰é¢„å®šä¹‰é€‰é¡¹çš„ä¸€ä¸ª Vue å®ä¾‹ã€‚åœ¨ Vue ä¸­æ³¨å†Œç»„ä»¶å¾ˆç®€å•ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>ç½—å°é»‘<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- åˆ›å»ºä¸€ä¸ªtodo-itemç»„ä»¶çš„ç¤ºä¾‹ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">      ç°åœ¨æˆ‘ä»¬ä¸ºæ¯ä¸ª todo-item æä¾› todo å¯¹è±¡</span></span><br><span class="line"><span class="comment">      todo å¯¹è±¡æ˜¯å˜é‡ï¼Œå³å…¶å†…å®¹å¯ä»¥æ˜¯åŠ¨æ€çš„ã€‚</span></span><br><span class="line"><span class="comment">      æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸ºæ¯ä¸ªç»„ä»¶æä¾›ä¸€ä¸ªâ€œkeyâ€ï¼Œç¨åå†</span></span><br><span class="line"><span class="comment">      ä½œè¯¦ç»†è§£é‡Šã€‚</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">todo-item</span></span></span><br><span class="line"><span class="tag"><span class="attr">v-for</span>=<span class="string">&quot;item in groceryList&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">v-bind:todo</span>=<span class="string">&quot;item&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">v-bind:key</span>=<span class="string">&quot;item.id&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">todo-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">todo-item</span></span></span><br><span class="line"><span class="tag"><span class="attr">v-for</span>=<span class="string">&quot;item in secondList&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">v-bind:todo</span>=<span class="string">&quot;item&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">v-bind:key</span>=<span class="string">&quot;item.id&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">todo-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å¼•å…¥vue.js --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å¼•å…¥element uiæ ·å¼ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../css/element/index.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/element/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> <span class="title class_">TodoItem</span>=&#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">props</span>:[<span class="string">&quot;todo&quot;</span>],</span></span><br><span class="line"><span class="language-javascript"><span class="attr">template</span>:<span class="string">&quot;&lt;li&gt;&#123;&#123;todo.text&#125;&#125;&lt;/li&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> secondItem=&#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">props</span>:[<span class="string">&quot;todo1&quot;</span>],</span></span><br><span class="line"><span class="language-javascript"><span class="attr">template</span>:<span class="string">&quot;&lt;li&gt;&#123;&#123;todo1.text&#125;&#125;&lt;/li&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"><span class="comment">// æ³¨æ„new çš„Vueå¿…é¡»æ˜¯å¤§å†™å­—æ¯å¼€å¤´çš„</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">el</span>: <span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">components</span>:&#123;</span></span><br><span class="line"><span class="language-javascript"><span class="title class_">TodoItem</span>:<span class="title class_">TodoItem</span>,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">secondItem</span>:secondItem</span></span><br><span class="line"><span class="language-javascript">&#125;,</span></span><br><span class="line"><span class="language-javascript"><span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="language-javascript"><span class="attr">groceryList</span>:[</span></span><br><span class="line"><span class="language-javascript">&#123;<span class="attr">id</span>:<span class="number">0</span>,<span class="attr">text</span>:<span class="string">&quot;è”¬èœ&quot;</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">&#123;<span class="attr">id</span>:<span class="number">1</span>,<span class="attr">text</span>:<span class="string">&quot;å¥¶é…ª&quot;</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">&#123;<span class="attr">id</span>:<span class="number">2</span>,<span class="attr">text</span>:<span class="string">&quot;éšä¾¿å…¶ä»–ä»€ä¹ˆäººåƒçš„ä¸œè¥¿&quot;</span>&#125;</span></span><br><span class="line"><span class="language-javascript">],</span></span><br><span class="line"><span class="language-javascript"><span class="attr">secondList</span>:[</span></span><br><span class="line"><span class="language-javascript">&#123;<span class="attr">id</span>:<span class="number">0</span>,<span class="attr">text</span>:<span class="string">&quot;å­¦ä¹ é›·é”‹å¥½æ¦œæ ·&quot;</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">&#123;<span class="attr">id</span>:<span class="number">1</span>,<span class="attr">text</span>:<span class="string">&quot;å¿ äºé©å‘½å¿ äºå…š&quot;</span>&#125;,</span></span><br><span class="line"><span class="language-javascript">&#123;<span class="attr">id</span>:<span class="number">2</span>,<span class="attr">text</span>:<span class="string">&quot;å¤©å¤©å‘ä¸Š&quot;</span>&#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">]</span></span><br><span class="line"><span class="language-javascript">&#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;);</span></span><br><span class="line"><span class="language-javascript"><span class="comment">// è¿™æ ·çš„æ–¹å¼æ˜¯ä¸è¡Œçš„</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// Vue.component(&quot;todo-item&quot;,&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// //todo-item ç»„ä»¶ç°åœ¨æ¥æ”¶ä¸€ä¸ª</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// // &quot;prop&quot; , ç±»ä¼¼äºä¸€ä¸ªè‡ªå®šä¹‰attribute.</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// //è¿™ä¸ªpropåå­—å«åštodo</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// props:[&quot;todo&quot;],</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// template:&quot;&lt;li&gt;è¿™æ˜¯ä¸ªå¾…åŠé¡¹&#123;&#123;todo.text&#125;&#125;&lt;/li&gt;&quot;</span></span></span><br><span class="line"><span class="language-javascript"><span class="comment">// &#125;)</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-6-ä¸è‡ªå®šä¹‰å…ƒç´ çš„å…³ç³»">1.6 ä¸è‡ªå®šä¹‰å…ƒç´ çš„å…³ç³»</h3><p>ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ° Vue ç»„ä»¶éå¸¸ç±»ä¼¼äº<strong>è‡ªå®šä¹‰å…ƒç´ </strong>â€”â€”å®ƒæ˜¯ <a href="https://www.w3.org/wiki/WebComponents/">Web ç»„ä»¶è§„èŒƒ</a>çš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ˜¯å› ä¸º Vue çš„ç»„ä»¶è¯­æ³•éƒ¨åˆ†å‚è€ƒäº†è¯¥è§„èŒƒã€‚ä¾‹å¦‚ Vue ç»„ä»¶å®ç°äº† <a href="https://github.com/w3c/webcomponents/blob/gh-pages/proposals/Slots-Proposal.md">Slot API</a> ä¸ <code>is</code> attributeã€‚ä½†æ˜¯ï¼Œè¿˜æ˜¯æœ‰å‡ ä¸ªå…³é”®å·®åˆ«ï¼š</p><ol><li>Web Components è§„èŒƒå·²ç»å®Œæˆå¹¶é€šè¿‡ï¼Œä½†æœªè¢«æ‰€æœ‰æµè§ˆå™¨åŸç”Ÿå®ç°ã€‚ç›®å‰ Safari 10.1+ã€Chrome 54+ å’Œ Firefox 63+ åŸç”Ÿæ”¯æŒ Web Componentsã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒVue ç»„ä»¶ä¸éœ€è¦ä»»ä½• polyfillï¼Œå¹¶ä¸”åœ¨æ‰€æœ‰æ”¯æŒçš„æµè§ˆå™¨ (IE9 åŠæ›´é«˜ç‰ˆæœ¬) ä¹‹ä¸‹è¡¨ç°ä¸€è‡´ã€‚å¿…è¦æ—¶ï¼ŒVue ç»„ä»¶ä¹Ÿå¯ä»¥åŒ…è£…äºåŸç”Ÿè‡ªå®šä¹‰å…ƒç´ ä¹‹å†…ã€‚</li><li>Vue ç»„ä»¶æä¾›äº†çº¯è‡ªå®šä¹‰å…ƒç´ æ‰€ä¸å…·å¤‡çš„ä¸€äº›é‡è¦åŠŸèƒ½ï¼Œæœ€çªå‡ºçš„æ˜¯è·¨ç»„ä»¶æ•°æ®æµã€è‡ªå®šä¹‰äº‹ä»¶é€šä¿¡ä»¥åŠæ„å»ºå·¥å…·é›†æˆã€‚</li></ol><p>è™½ç„¶ Vue å†…éƒ¨æ²¡æœ‰ä½¿ç”¨è‡ªå®šä¹‰å…ƒç´ ï¼Œä¸è¿‡åœ¨åº”ç”¨ä½¿ç”¨è‡ªå®šä¹‰å…ƒç´ ã€æˆ–ä»¥è‡ªå®šä¹‰å…ƒç´ å½¢å¼å‘å¸ƒæ—¶ï¼Œ<a href="https://custom-elements-everywhere.com/#vue">ä¾ç„¶æœ‰å¾ˆå¥½çš„äº’æ“ä½œæ€§</a>ã€‚Vue CLI ä¹Ÿæ”¯æŒå°† Vue ç»„ä»¶æ„å»ºæˆä¸ºåŸç”Ÿçš„è‡ªå®šä¹‰å…ƒç´ ã€‚</p><h2 id="äºŒã€Vueå®ä¾‹">äºŒã€Vueå®ä¾‹</h2><h3 id="æ¨¡ç‰ˆè¯­æ³•">æ¨¡ç‰ˆè¯­æ³•</h3><p>Vue.js ä½¿ç”¨äº†åŸºäº HTML çš„æ¨¡æ¿è¯­æ³•ï¼Œå…è®¸å¼€å‘è€…å£°æ˜å¼åœ°å°† DOM ç»‘å®šè‡³åº•å±‚ Vue å®ä¾‹çš„æ•°æ®ã€‚æ‰€æœ‰ Vue.js çš„æ¨¡æ¿éƒ½æ˜¯åˆæ³•çš„ HTMLï¼Œæ‰€ä»¥èƒ½è¢«éµå¾ªè§„èŒƒçš„æµè§ˆå™¨å’Œ HTML è§£æå™¨è§£æã€‚</p><p>åœ¨åº•å±‚çš„å®ç°ä¸Šï¼ŒVue å°†æ¨¡æ¿ç¼–è¯‘æˆè™šæ‹Ÿ DOM æ¸²æŸ“å‡½æ•°ã€‚ç»“åˆå“åº”ç³»ç»Ÿï¼ŒVue èƒ½å¤Ÿæ™ºèƒ½åœ°è®¡ç®—å‡ºæœ€å°‘éœ€è¦é‡æ–°æ¸²æŸ“å¤šå°‘ç»„ä»¶ï¼Œå¹¶æŠŠ DOM æ“ä½œæ¬¡æ•°å‡åˆ°æœ€å°‘ã€‚</p><p>æœ€å¸¸è§çš„è¯­æ³•æ˜¯</p><p><code>åªè¦messageçš„ propertyå€¼æ”¹å˜ï¼Œé‚£ä¹ˆä»¥ä¸Šçš„messageçš„å€¼ä¹Ÿä¼šéšä¹‹æ”¹å˜ã€‚</code></p><p>ä½†æ˜¯é€šè¿‡ä½¿ç”¨v-onceæŒ‡ä»¤ï¼Œå¯ä»¥æ‰§è¡Œä¸€æ¬¡æ€§åœ°æ’å€¼ï¼Œå½“æ•°æ®æ”¹å˜çš„æ—¶å€™ï¼Œæ’å€¼å¤„çš„å†…å®¹å¹¶ä¸ä¼šæ›´æ–°</p><p><code>&lt;span v-once&gt;è¿™ä¸ªå€¼ä¸ä¼šè¢«æ”¹å˜ï¼š &#123;&#123;message&#125;&#125; &lt;/span&gt;</code></p><p><strong>v-htmlä¸v-textæœ‰åŒºåˆ«ï¼Œv-htmlä¼šæ¸²æŸ“æˆæˆ‘ä»¬çš„htmlä»£ç ï¼Œå› ä¸ºä¸€èˆ¬åŒå¤§æ‹¬å·å°†æ•°æ®è§£é‡Šä¸ºæ™®é€šæ–‡æœ¬ï¼Œå¹¶éHTMLä»£ç ï¼Œä¸ºäº†æˆä¸ºHTMLä»£ç ï¼Œæˆ‘ä»¬å°†é‡‡ç”¨v-html;</strong></p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Using mustaches: &#123;&#123; rawHtml &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Using v-html directive: <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-html</span>=<span class="string">&quot;rawHtml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Mustache è¯­æ³•ä¸èƒ½ä½œç”¨åœ¨ HTML attribute ä¸Šï¼Œé‡åˆ°è¿™ç§æƒ…å†µåº”è¯¥ä½¿ç”¨ <a href="https://v2.cn.vuejs.org/v2/api/#v-bind"><code>v-bind</code> æŒ‡ä»¤</a>ï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">div</span> v-bind:<span class="built_in">id</span>=<span class="string">&quot;dynamicId&quot;</span>&gt;&lt;/<span class="keyword">div</span>&gt;</span><br></pre></td></tr></table></figure><p>å¯¹äºå¸ƒå°” attribute (å®ƒä»¬åªè¦å­˜åœ¨å°±æ„å‘³ç€å€¼ä¸º <code>true</code>)ï¼Œ<code>v-bind</code> å·¥ä½œèµ·æ¥ç•¥æœ‰ä¸åŒï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">button</span> v-bind:disabled=<span class="string">&quot;isButtonDisabled&quot;</span>&gt;<span class="keyword">Button</span>&lt;/<span class="keyword">button</span>&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æœ <code>isButtonDisabled</code> çš„å€¼æ˜¯ <code>null</code>ã€<code>undefined</code> æˆ– <code>false</code>ï¼Œåˆ™ <code>disabled</code> attribute ç”šè‡³ä¸ä¼šè¢«åŒ…å«åœ¨æ¸²æŸ“å‡ºæ¥çš„ <code>&lt;button&gt;</code> å…ƒç´ ä¸­ã€‚</p><h4 id="ä½¿ç”¨-JavaScript-è¡¨è¾¾å¼">ä½¿ç”¨ JavaScript è¡¨è¾¾å¼</h4><p>è¿„ä»Šä¸ºæ­¢ï¼Œåœ¨æˆ‘ä»¬çš„æ¨¡æ¿ä¸­ï¼Œæˆ‘ä»¬ä¸€ç›´éƒ½åªç»‘å®šç®€å•çš„ property é”®å€¼ã€‚ä½†å®é™…ä¸Šï¼Œå¯¹äºæ‰€æœ‰çš„æ•°æ®ç»‘å®šï¼ŒVue.js éƒ½æä¾›äº†å®Œå…¨çš„ JavaScript è¡¨è¾¾å¼æ”¯æŒã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; number + 1 &#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123; ok ? &#x27;YES&#x27; : &#x27;NO&#x27; &#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123; message.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;) &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-bind:id</span>=<span class="string">&quot;&#x27;list-&#x27; + id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™äº›è¡¨è¾¾å¼ä¼šåœ¨æ‰€å± Vue å®ä¾‹çš„æ•°æ®ä½œç”¨åŸŸä¸‹ä½œä¸º JavaScript è¢«è§£æã€‚æœ‰ä¸ªé™åˆ¶å°±æ˜¯ï¼Œæ¯ä¸ªç»‘å®šéƒ½åªèƒ½åŒ…å«<strong>å•ä¸ªè¡¨è¾¾å¼</strong>ï¼Œæ‰€ä»¥ä¸‹é¢çš„ä¾‹å­éƒ½<strong>ä¸ä¼š</strong>ç”Ÿæ•ˆã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- è¿™æ˜¯è¯­å¥ï¼Œä¸æ˜¯è¡¨è¾¾å¼ --&gt;</span></span><br><span class="line">&#123;&#123; var a = 1 &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æµæ§åˆ¶ä¹Ÿä¸ä¼šç”Ÿæ•ˆï¼Œè¯·ä½¿ç”¨ä¸‰å…ƒè¡¨è¾¾å¼ --&gt;</span></span><br><span class="line">&#123;&#123; if (ok) &#123; return message &#125; &#125;&#125;</span><br></pre></td></tr></table></figure><p>æ¨¡æ¿è¡¨è¾¾å¼éƒ½è¢«æ”¾åœ¨æ²™ç›’ä¸­ï¼Œåªèƒ½è®¿é—®<a href="https://github.com/vuejs/vue/blob/v2.6.10/src/core/instance/proxy.js#L9">å…¨å±€å˜é‡çš„ä¸€ä¸ªç™½åå•</a>ï¼Œå¦‚ <code>Math</code> å’Œ <code>Date</code> ã€‚ä½ ä¸åº”è¯¥åœ¨æ¨¡æ¿è¡¨è¾¾å¼ä¸­è¯•å›¾è®¿é—®ç”¨æˆ·å®šä¹‰çš„å…¨å±€å˜é‡ã€‚</p><h4 id="å‚æ•°">å‚æ•°</h4><p>ä¸€äº›æŒ‡ä»¤èƒ½å¤Ÿæ¥æ”¶ä¸€ä¸ªâ€œå‚æ•°â€ï¼Œåœ¨æŒ‡ä»¤åç§°ä¹‹åä»¥å†’å·è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œ<code>v-bind</code> æŒ‡ä»¤å¯ä»¥ç”¨äºå“åº”å¼åœ°æ›´æ–° HTML attributeï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:href</span>=<span class="string">&quot;url&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œ <code>href</code> æ˜¯å‚æ•°ï¼Œå‘ŠçŸ¥ <code>v-bind</code> æŒ‡ä»¤å°†è¯¥å…ƒç´ çš„ <code>href</code> attribute ä¸è¡¨è¾¾å¼ <code>url</code> çš„å€¼ç»‘å®šã€‚</p><p>å¦ä¸€ä¸ªä¾‹å­æ˜¯ <code>v-on</code> æŒ‡ä»¤ï¼Œå®ƒç”¨äºç›‘å¬ DOM äº‹ä»¶ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-on:click</span>=<span class="string">&quot;doSomething&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="åŠ¨æ€å‚æ•°">åŠ¨æ€å‚æ•°</h4><p>ä» 2.6.0 å¼€å§‹ï¼Œå¯ä»¥ç”¨æ–¹æ‹¬å·æ‹¬èµ·æ¥çš„ JavaScript è¡¨è¾¾å¼ä½œä¸ºä¸€ä¸ªæŒ‡ä»¤çš„å‚æ•°ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">æ³¨æ„ï¼Œå‚æ•°è¡¨è¾¾å¼çš„å†™æ³•å­˜åœ¨ä¸€äº›çº¦æŸï¼Œå¦‚ä¹‹åçš„â€œå¯¹åŠ¨æ€å‚æ•°è¡¨è¾¾å¼çš„çº¦æŸâ€ç« èŠ‚æ‰€è¿°ã€‚</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:</span>[<span class="attr">attributeName</span>]=<span class="string">&quot;url&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ <code>attributeName</code> ä¼šè¢«ä½œä¸ºä¸€ä¸ª JavaScript è¡¨è¾¾å¼è¿›è¡ŒåŠ¨æ€æ±‚å€¼ï¼Œæ±‚å¾—çš„å€¼å°†ä¼šä½œä¸ºæœ€ç»ˆçš„å‚æ•°æ¥ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„ Vue å®ä¾‹æœ‰ä¸€ä¸ª <code>data</code> property <code>attributeName</code>ï¼Œå…¶å€¼ä¸º <code>&quot;href&quot;</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªç»‘å®šå°†ç­‰ä»·äº <code>v-bind:href</code>ã€‚</p><p>åŒæ ·åœ°ï¼Œä½ å¯ä»¥ä½¿ç”¨åŠ¨æ€å‚æ•°ä¸ºä¸€ä¸ªåŠ¨æ€çš„äº‹ä»¶åç»‘å®šå¤„ç†å‡½æ•°ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-on:</span>[<span class="attr">eventName</span>]=<span class="string">&quot;doSomething&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå½“ <code>eventName</code> çš„å€¼ä¸º <code>&quot;focus&quot;</code> æ—¶ï¼Œ<code>v-on:[eventName]</code> å°†ç­‰ä»·äº <code>v-on:focus</code>ã€‚</p><h5 id="å¯¹åŠ¨æ€å‚æ•°çš„å€¼çš„çº¦æŸ">å¯¹åŠ¨æ€å‚æ•°çš„å€¼çš„çº¦æŸ</h5><p>åŠ¨æ€å‚æ•°é¢„æœŸä¼šæ±‚å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¼‚å¸¸æƒ…å†µä¸‹å€¼ä¸º <code>null</code>ã€‚è¿™ä¸ªç‰¹æ®Šçš„ <code>null</code> å€¼å¯ä»¥è¢«æ˜¾æ€§åœ°ç”¨äºç§»é™¤ç»‘å®šã€‚ä»»ä½•å…¶å®ƒéå­—ç¬¦ä¸²ç±»å‹çš„å€¼éƒ½å°†ä¼šè§¦å‘ä¸€ä¸ªè­¦å‘Šã€‚</p><h5 id="å¯¹åŠ¨æ€å‚æ•°è¡¨è¾¾å¼çš„çº¦æŸ">å¯¹åŠ¨æ€å‚æ•°è¡¨è¾¾å¼çš„çº¦æŸ</h5><p>åŠ¨æ€å‚æ•°è¡¨è¾¾å¼æœ‰ä¸€äº›è¯­æ³•çº¦æŸï¼Œå› ä¸ºæŸäº›å­—ç¬¦ï¼Œå¦‚ç©ºæ ¼å’Œå¼•å·ï¼Œæ”¾åœ¨ HTML attribute åé‡Œæ˜¯æ— æ•ˆçš„ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- è¿™ä¼šè§¦å‘ä¸€ä¸ªç¼–è¯‘è­¦å‘Š --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:</span>[&#x27;<span class="attr">foo</span>&#x27; + <span class="attr">bar</span>]=<span class="string">&quot;value&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å˜é€šçš„åŠæ³•æ˜¯ä½¿ç”¨æ²¡æœ‰ç©ºæ ¼æˆ–å¼•å·çš„è¡¨è¾¾å¼ï¼Œæˆ–ç”¨è®¡ç®—å±æ€§æ›¿ä»£è¿™ç§å¤æ‚è¡¨è¾¾å¼ã€‚</p><p>åœ¨ DOM ä¸­ä½¿ç”¨æ¨¡æ¿æ—¶ (ç›´æ¥åœ¨ä¸€ä¸ª HTML æ–‡ä»¶é‡Œæ’°å†™æ¨¡æ¿)ï¼Œè¿˜éœ€è¦é¿å…ä½¿ç”¨å¤§å†™å­—ç¬¦æ¥å‘½åé”®åï¼Œå› ä¸ºæµè§ˆå™¨ä¼šæŠŠ attribute åå…¨éƒ¨å¼ºåˆ¶è½¬ä¸ºå°å†™ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">åœ¨ DOM ä¸­ä½¿ç”¨æ¨¡æ¿æ—¶è¿™æ®µä»£ç ä¼šè¢«è½¬æ¢ä¸º `v-bind:[someattr]`ã€‚</span></span><br><span class="line"><span class="comment">é™¤éåœ¨å®ä¾‹ä¸­æœ‰ä¸€ä¸ªåä¸ºâ€œsomeattrâ€çš„ propertyï¼Œå¦åˆ™ä»£ç ä¸ä¼šå·¥ä½œã€‚</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:</span>[<span class="attr">someAttr</span>]=<span class="string">&quot;value&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ä¿®é¥°ç¬¦">ä¿®é¥°ç¬¦</h4><p>ä¿®é¥°ç¬¦ (modifier) æ˜¯ä»¥åŠè§’å¥å· <code>.</code> æŒ‡æ˜çš„ç‰¹æ®Šåç¼€ï¼Œç”¨äºæŒ‡å‡ºä¸€ä¸ªæŒ‡ä»¤åº”è¯¥ä»¥ç‰¹æ®Šæ–¹å¼ç»‘å®šã€‚ä¾‹å¦‚ï¼Œ<code>.prevent</code> ä¿®é¥°ç¬¦å‘Šè¯‰ <code>v-on</code> æŒ‡ä»¤å¯¹äºè§¦å‘çš„äº‹ä»¶è°ƒç”¨ <code>event.preventDefault()</code>ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">v-on:submit.prevent</span>=<span class="string">&quot;onSubmit&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ç¼©å†™">ç¼©å†™</h4><p><code>v-</code>Â å‰ç¼€ä½œä¸ºä¸€ç§è§†è§‰æç¤ºï¼Œç”¨æ¥è¯†åˆ«æ¨¡æ¿ä¸­ Vue ç‰¹å®šçš„ attributeã€‚å½“ä½ åœ¨ä½¿ç”¨ Vue.js ä¸ºç°æœ‰æ ‡ç­¾æ·»åŠ åŠ¨æ€è¡Œä¸º (dynamic behavior) æ—¶ï¼Œ<code>v-</code>Â å‰ç¼€å¾ˆæœ‰å¸®åŠ©ï¼Œç„¶è€Œï¼Œå¯¹äºä¸€äº›é¢‘ç¹ç”¨åˆ°çš„æŒ‡ä»¤æ¥è¯´ï¼Œå°±ä¼šæ„Ÿåˆ°ä½¿ç”¨ç¹çã€‚åŒæ—¶ï¼Œåœ¨æ„å»ºç”± Vue ç®¡ç†æ‰€æœ‰æ¨¡æ¿çš„<a href="https://en.wikipedia.org/wiki/Single-page_application">å•é¡µé¢åº”ç”¨ç¨‹åº (SPA - single page application)</a>Â æ—¶ï¼Œ<code>v-</code>Â å‰ç¼€ä¹Ÿå˜å¾—æ²¡é‚£ä¹ˆé‡è¦äº†ã€‚å› æ­¤ï¼ŒVue ä¸ºÂ <code>v-bind</code>Â å’ŒÂ <code>v-on</code>Â è¿™ä¸¤ä¸ªæœ€å¸¸ç”¨çš„æŒ‡ä»¤ï¼Œæä¾›äº†ç‰¹å®šç®€å†™ï¼š</p><h5 id="v-bind">v-bind</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å®Œæ•´è¯­æ³• --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:href</span>=<span class="string">&quot;url&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ç¼©å†™ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">:href</span>=<span class="string">&quot;url&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- åŠ¨æ€å‚æ•°çš„ç¼©å†™ (2.6.0+) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">:</span>[<span class="attr">key</span>]=<span class="string">&quot;url&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="v-on">v-on</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å®Œæ•´è¯­æ³• --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-on:click</span>=<span class="string">&quot;doSomething&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ç¼©å†™ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">&quot;doSomething&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- åŠ¨æ€å‚æ•°çš„ç¼©å†™ (2.6.0+) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> @[<span class="attr">event</span>]=<span class="string">&quot;doSomething&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å®ƒä»¬çœ‹èµ·æ¥å¯èƒ½ä¸æ™®é€šçš„ HTML ç•¥æœ‰ä¸åŒï¼Œä½†Â <code>:</code>Â ä¸Â <code>@</code>Â å¯¹äº attribute åæ¥è¯´éƒ½æ˜¯åˆæ³•å­—ç¬¦ï¼Œåœ¨æ‰€æœ‰æ”¯æŒ Vue çš„æµè§ˆå™¨éƒ½èƒ½è¢«æ­£ç¡®åœ°è§£æã€‚è€Œä¸”ï¼Œå®ƒä»¬ä¸ä¼šå‡ºç°åœ¨æœ€ç»ˆæ¸²æŸ“çš„æ ‡è®°ä¸­ã€‚</p><h2 id="ä¸‰ã€è®¡ç®—å±æ€§å’Œä¾¦å¬å™¨">ä¸‰ã€è®¡ç®—å±æ€§å’Œä¾¦å¬å™¨</h2><p>Vueè„šæ‰‹æ¶åˆ›å»ºé¡¹ç›®çš„æ–¹å¼</p><p>è¿™é‡Œæä¾›å‡ ç§æ–¹æ¡ˆï¼š</p><ol><li>å‡çº§ä¸ºvue 3.xç‰ˆæœ¬</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall vue-cli -g</span><br><span class="line">npm install -g @vue/cli</span><br></pre></td></tr></table></figure><p>2.é™çº§ä¸ºvue2.xæ–¹æ³•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall @vue/cli -g</span><br><span class="line">npm install -g vue-cli</span><br></pre></td></tr></table></figure><p>3.vue2.xè„šæ‰‹æ¶çš„å®‰è£…å’Œåˆå§‹åŒ–é¡¹ç›®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºé¡¹ç›®</span></span><br><span class="line">vue init webpack é¡¹ç›®åå­—</span><br></pre></td></tr></table></figure><p>4.vue3.xè„šæ‰‹æ¶çš„å®‰è£…å’Œåˆå§‹åŒ–é¡¹ç›®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºé¡¹ç›®</span></span><br><span class="line">vue create é¡¹ç›®åå­—</span><br></pre></td></tr></table></figure><p>å¦‚ä½•è®©vueé¡¹ç›®è·‘èµ·æ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install dependencies</span></span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line"><span class="comment"># serve with hot reload at localhost:8080</span></span><br><span class="line">npm run dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># build for production with minification</span></span><br><span class="line">npm run build</span><br><span class="line"></span><br><span class="line"><span class="comment"># build for production and view the bundle analyzer report</span></span><br><span class="line">npm run build --report</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æœ¬æ–‡ä¸»è¦è®°å½•å‰ç«¯vue2å­¦ä¹ çš„ä¸€äº›ç¬”è®°</summary>
    
    
    
    <category term="å‰ç«¯" scheme="https://luoxiaohei520.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="vue2" scheme="https://luoxiaohei520.github.io/tags/vue2/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQå­¦ä¹ ç¬”è®°</title>
    <link href="https://luoxiaohei520.github.io/posts/d439760d.html"/>
    <id>https://luoxiaohei520.github.io/posts/d439760d.html</id>
    <published>2023-11-09T02:50:23.338Z</published>
    <updated>2023-11-09T02:50:23.338Z</updated>
    
    <content type="html"><![CDATA[<h1>RabbitMQå­¦ä¹ ç¬”è®°</h1><p>åˆ†å¸ƒå¼æ¶æ„ï¼šä¸€ä¸ªè¯·æ±‚ç”±å¤šä¸ªæœåŠ¡ï¼ˆæœåŠ¡æˆ–è€…ç³»ç»Ÿï¼‰ååŒå¤„ç†å®Œæˆã€‚</p><p>RabbitMQï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæˆ–è€…è¯´æ˜¯ä¸€ä¸ªæ¶ˆæ¯ä¸­é—´é”®ã€‚</p><p>MQåŠŸèƒ½ï¼š</p><ol><li><strong>å‰Šå³°</strong>ï¼šä¸è®©ç³»ç»Ÿç›´æ¥è®¿é—®ç³»ç»Ÿï¼Œè€Œæ˜¯é€šè¿‡MQ,ç„¶åäº¤ç»™MQå»è®¿é—®ç³»ç»Ÿï¼Œä½¿å¾—è®¿é—®çš„äººå‘˜è¿›è¡Œæ’é˜Ÿã€‚ï¼ˆæœ‰æ’é˜Ÿå°±ä¼šå¯¼è‡´æ¯”è¾ƒæ…¢ï¼Œä½†æ˜¯å®‰å…¨æœ‰æ¬¡åºã€‚ï¼‰</li><li><strong>åº”ç”¨è§£è€¦</strong>ï¼šé€šè¿‡é˜Ÿåˆ—å»è®¿é—®ç³»ç»Ÿï¼Œå„ä¸ªç³»ç»Ÿä¹‹é—´é€šè¿‡MQå»å®Œæˆï¼Œä¹Ÿå°±ä¼šä¸ä¼šäº§ç”Ÿè¿‡å¤šæ•…éšœã€‚</li><li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šA-Bï¼Œå¹¶ä¸è¦Aæ”¶åˆ°Bçš„ç¡®å®šæ¶ˆæ¯æ‰ä¼šæ‰§è¡Œæ“ä½œã€‚</li></ol><p>MQçš„åˆ†ç±»ï¼š</p><ol><li><p>RabbitMQ: å’Œspringæ˜¯ä¸€å®¶å…¬å¸çš„ï¼Œä½¿ç”¨AMQP(é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰åŸºç¡€ä¸Šå®Œæˆçš„ï¼Œæ”¯æŒå¤šç§è¯­è¨€ï¼Œç¼ºç‚¹æ˜¯å•†ä¸šç‰ˆè¦ä»˜è´¹ã€‚</p></li><li><p>kafka:ä¸ºå¤§æ•°æ®è€Œç”Ÿï¼Œæœ‰ç™¾ä¸‡çº§TPSçš„ï¼Œå®æ—¶è®¡ç®—ï¼Œååé‡é«˜ï¼Œä½¿ç”¨åœ¨æ—¥å¿—é‡‡é›†ç­‰æ–¹é¢ã€‚ç¼ºç‚¹æ˜¯ï¼Œå•æœºè¶…è¿‡64ä¸ªé˜Ÿåˆ—/åˆ†åŒºï¼Œloadä¼šå‘ç”Ÿæ˜æ˜¾çš„é£™é«˜ç°è±¡ï¼Œé˜Ÿåˆ—è¶Šå¤šï¼Œloadè¶Šé«˜ï¼Œå‘é€å“åº”æ—¶é—´è¶Šé•¿ã€‚æ¶ˆè´¹å¤±è´¥ä¸æ”¯æŒé‡è¯•ï¼Œæ”¯æŒæ¶ˆæ¯é¡ºåºï¼Œä½†ä¸€ä»£ä»£ç†å®•æœºåï¼Œä¼šäº§ç”Ÿæ¶ˆæ¯ä¹±åºï¼Œç¤¾åŒºæ›´æ–°æ…¢ã€‚</p></li><li><p>RocketMQï¼šç”±é˜¿é‡Œå¼€å‘ï¼Œé‡‘èè¡Œä¸šéœ€è¦ï¼Œä½¿ç”¨javaè¯­è¨€å®ç°ï¼Œå‚è€ƒäº†kafka,ä¸€èˆ¬å¸¸ç”¨äºè®¢å•ï¼Œäº¤æ˜“ï¼Œå……å€¼ï¼Œæµè®¡ç®—ï¼Œæ¶ˆæ¯æ¨é€ï¼Œæ—¥å¿—å¤„ç†ï¼Œbingblogåˆ†å‘ç­‰åœºæ™¯ã€‚</p><ol><li>ä¼˜ç‚¹ï¼šå•æœºåå10wçº§åˆ«ï¼Œä¿¡æ¯å¯ä»¥åšåˆ°0ä¸¢å¤±ï¼ŒMQåŠŸèƒ½æ¯”è¾ƒå®Œå–„ï¼Œè¿˜æ˜¯åˆ†å¸ƒå¼ï¼Œæ‹“å±•æ€§å·ï¼Œæ”¯æŒ10äº¿çº§åˆ«çš„æ¶ˆæ¯å †ç§¯ï¼Œä¸ä¼šå› ä¸ºå †ç§¯è€Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</li><li>ç¼ºç‚¹ï¼šè¿™æ¬¡å®¢æˆ·ç«¯è¯­è¨€ä¸å¤šï¼Œç›®å‰æ˜¯javaå’ŒC++,å…¶ä¸­C++è¿˜ä¸æˆç†Ÿï¼Œç¤¾åŒºæ´»è·ƒä¸€èˆ¬ã€‚</li></ol></li></ol><h1>åˆçº§éƒ¨åˆ†ï¼š</h1><p>RabbitMQï¼šæ˜¯ä¸€ä¸ªæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå¯ä»¥å½“åšä¸€ä¸ªå¿«é€’ç«™ï¼Œå¿«é€’å‘˜å‘åŒ…è£¹åˆ°å¿«é€’ç«™ï¼Œç„¶åæœ¬åœ°å¿«é€’å‘˜å°†å¿«é€’å‘ç»™ç”¨æˆ·ã€‚</p><p>ç”Ÿäº§è€…ï¼šç”Ÿäº§è€… - &gt; mq ï¼ˆä¸€ä¸ªäº¤æ¢æœºå¯ä»¥ç»‘å®šå¤šä¸ªé˜Ÿåˆ—ï¼‰ -&gt; æ¶ˆè´¹è€…ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªé˜Ÿåˆ—å¯¹åº”ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå¦‚æœä¸¤ä¸ªä¸€ä¸ªé˜Ÿåˆ—å¯¹åº”ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆå°±åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆæ¯ï¼Œè¿™å°±æƒ³å½“ä¸åªæœ‰ä¸€ä¸ªåŒ…è£¹æ˜¯ä¸å¯èƒ½å‘ç»™ä¸¤ä¸ªäººçš„ã€‚</p><p>æ ¸å¿ƒéƒ¨åˆ†ï¼š</p><ol><li>ç®€å•æ¨¡å¼</li><li>å·¥ä½œæ¨¡å¼</li><li>å‘å¸ƒè®¢é˜…æ¨¡å¼</li><li>è·¯ç”±æ¨¡å¼</li><li>ä¸»é¢˜æ¨¡å¼</li><li>å‘å¸ƒç¡®è®¤æ¨¡å¼</li></ol><p><img src="1666884806286.png" alt="1666884806286"></p><p>**connection:**publisher/consumer å’Œ brokerä¹‹é—´çš„TCPè¿æ¥ã€‚</p><p>**Channel:**å¦‚æœæ¯ä¸€æ¬¡è®¿é—®RabbitMQéƒ½å»ºç«‹ä¸€ä¸ªConnectionï¼Œåœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™å»ºç«‹TCP Connectionçš„å¼€é”€æ˜¯å·¨å¤§çš„ï¼Œæ•ˆç‡ä¹Ÿæ¯”è¾ƒä½ã€‚<strong>channelä½œä¸ºè½»é‡çº§çš„Connectionæå¤§å‡å°‘äº†æ“ä½œç³»ç»Ÿå»ºç«‹TCP connectionçš„å¼€é”€ã€‚</strong></p><h2 id="å®‰è£…rabbitMQï¼š">å®‰è£…rabbitMQï¼š</h2><p>å®˜ç½‘ï¼š<a href="https://www.rabbitmq.com">https://www.rabbitmq.com</a></p><p>ä¸‹è½½é¡µé¢ï¼š<a href="https://www.rabbitmq.com/download.html">https://www.rabbitmq.com/download.html</a></p><p>æˆ‘ä¸€èˆ¬ä½¿ç”¨dockerå®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># latest RabbitMQ 3.10</span></span><br><span class="line">docker run -it --<span class="built_in">rm</span> --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3.10-management</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…¶ä»–å®‰è£…æ–¹å¼ï¼š</p><ol><li><p>é¦–å…ˆç°åœ¨linuxä¸‹çš„å‹ç¼©åŒ…ï¼Œæˆ–è€…ä½¿ç”¨å·¥å…·å°†å®‰è£…åŒ…ä¸Šä¼ åˆ°linuxç³»ç»Ÿã€‚</p></li><li><p>å®‰è£…rabbitMQçš„æ”¯æŒä¾èµ–</p><ol><li><code>rpm  -ivh erlang-21.3-1.el7.x86_64.rpm</code></li><li><code>yml install socat -y</code></li><li><code>rpm -ivh rabbitmq-server-3.8.8-1.el7.noarch.rpm</code></li></ol></li><li><p>æ·»åŠ å¸¸ç”¨å‘½ä»¤ï¼š</p><ol><li><p>æ·»åŠ å¼€æœºå¯åŠ¨<code>chkconfig rabbitmq-server on</code></p></li><li><p>å¯åŠ¨æœåŠ¡</p><ol><li><p>æ‰¾åˆ°å®‰è£…è·¯å¾„</p></li><li><p>sbinä¸‹çš„service é‡Œè¾¹çš„rabbitmq-server start   <code>/sbin/service rabbitmq-server start</code></p></li><li><p>æŸ¥çœ‹æœåŠ¡çŠ¶æ€<code>/sbin/service rabbitmq-server status</code></p></li><li><p>åœæ­¢æœåŠ¡<code>/sbin/service rabbitmq-server stop</code></p></li><li><p>å¼€å¯åå°webç®¡ç†æ’ä»¶<code>rabbitmq-plugins enable rabbitmq_management</code>ï¼ˆdockerå®‰è£…çš„ä¸è¦è¿™ä¹ˆæ“ä½œï¼‰</p></li><li><p>ä½¿ç”¨è´¦å·è®¿é—®ï¼Œä¸€èˆ¬æ˜¯è´¦å·å¯†ç éƒ½æ˜¯guestï¼Œå½“ç„¶ä½ å¿…é¡»ä¿è¯ä½ çš„ç«¯å£å·å¼€æ”¾ï¼Œå¦‚æœäº‘æœåŠ¡å™¨çš„è¯ï¼Œ15972ï¼Œæ³¨æ„ipåœ°å€ï¼Œå¦‚æœæœ‰åŸŸåçš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨åŸŸååæ·»åŠ <code>ï¼š15672</code>ç›´æ¥è®¿é—®.</p></li><li><p>å¦‚æœä¸èƒ½ç›´æ¥è®¿é—®çš„è¯ï¼Œæ£€æŸ¥ä¸€ä¸‹é˜²ç«å¢™ï¼Œ<code>systemctl stop firewalld</code>,è¿™ä¸ªå‘½ä»¤å…³é—­æœ¬æ¬¡é˜²ç«å¢™ï¼Œ<code>systemctl enable firewalld</code>å¯ä»¥ä¸‹æ¬¡å¼€æœºä¹Ÿå…³é—­é˜²ç«å¢™ï¼Œ<code>systemctl status firewalld</code>å¯ä»¥æŸ¥çœ‹å½“å‰ç³»ç»Ÿé˜²æŠ¤å¢™çŠ¶æ€</p></li><li><p>æ·»åŠ ä¸€ä¸ªæ–°ç”¨æˆ·ï¼Œå¦‚æœæ˜¯ä½¿ç”¨è™šæ‹Ÿæœºçš„è¯ï¼Œä¸€èˆ¬æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨guestç™»å½•çš„ï¼Œå½“ç„¶è¿™ä¸ªæˆ‘æ²¡ç¢°åˆ°è¿‡</p><ol><li><p>åˆ›å»ºä¸€ä¸ªè´¦å·<code>rabbitmqctl add_user ç”¨æˆ·å å¯†ç </code></p></li><li><p>è®¾ç½®ç”¨æˆ·è§’è‰² <code>rabbitmqctl set_user_tags admin administractor</code></p></li><li><p>è®¾ç½®ç”¨æˆ·æƒé™</p><p><code>set_permission[-p &lt;vhostpath&gt;] &lt;user&gt; &lt;conf&gt; &lt;write&gt; &lt;read&gt;</code></p><p>ä¸¾ä¾‹ï¼š</p><p><code>rabbitmqctl set_permission -p &quot;/&quot; admin &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</code>ç”¨æˆ·user_adminå…·æœ‰/vhost1è¿™ä¸ªvritual hostä¸­çš„æ‰€æœ‰èµ„æºçš„é…ç½®ï¼Œå†™ï¼Œè¯»æƒé™ã€‚</p></li><li><p>å½“å‰ç”¨æˆ·å’Œè§’è‰²</p><p><code>rabbitmqctl list_user</code></p></li></ol></li></ol></li></ol></li></ol><h2 id="å¦‚ä½•ä½¿ç”¨MQ-javaä»£ç å®ç°">å¦‚ä½•ä½¿ç”¨MQ(javaä»£ç å®ç°)</h2><p>IDEAæ–°å»ºmavenå·¥ç¨‹å¯¼å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æŒ‡å®šjdkç‰ˆæœ¬--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--rabbitmqä¾èµ–å®¢æˆ·ç«¯--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.16.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--æ“ä½œæ–‡ä»¶æµçš„ä¸€ä¸ªä¾èµ–--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼š">ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼š</h2><p>ç”Ÿäº§è€… - æ¶ˆæ¯é˜Ÿåˆ— - æ¶ˆè´¹è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ç”Ÿäº§è€…ï¼Œç›®æ ‡æ˜¯å‘æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span>  String QUEUE_NAME=<span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//å»ºç«‹ä¸€ä¸ªè¿æ¥æ–¹å¼</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        <span class="comment">//å·¥å‚IP è¿æ¥RabbitMQçš„é˜Ÿåˆ—</span></span><br><span class="line">        factory.setHost(<span class="string">&quot;www.littlehei.fun&quot;</span>);</span><br><span class="line">        <span class="comment">//ç”¨æˆ·å</span></span><br><span class="line">        factory.setUsername(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¯†ç </span></span><br><span class="line">        factory.setPassword(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºé“¾æ¥</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.newConnection();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç”Ÿæˆä¸€ä¸ªé˜Ÿåˆ—</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        ç”Ÿæˆé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">        å‚æ•°1ï¼Œé˜Ÿåˆ—åç§°</span></span><br><span class="line"><span class="comment">        å‚æ•°2ï¼Œé˜Ÿåˆ—é‡Œè¾¹çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼ˆç£ç›˜ï¼‰é»˜è®¤æƒ…å†µæ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">        å‚æ•°3ï¼Œè¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ï¼Œæ˜¯å¦è¿›è¡Œæ¶ˆæ¯å…±äº«ï¼Œtrueå¯ä»¥å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹,falseï¼šåªèƒ½ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">        å‚æ•°4ï¼Œæ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œæœ€åä¸€ä¸ªæ¶ˆè´¹è€…æ–­å¼€é“¾æ¥ä»¥åï¼Œè¯¥é˜Ÿæ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œtrueï¼Œè‡ªåŠ¨åˆ é™¤ï¼Œfalseä¸åˆ é™¤</span></span><br><span class="line"><span class="comment">        å‚æ•°5ï¼Œå…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">//å‘æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello world&quot;</span>;<span class="comment">//åˆæ¬¡ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        å‘é€ä¸€ä¸ªæ¶ˆè´¹</span></span><br><span class="line"><span class="comment">        å‚æ•°1ï¼Œå‘é€åˆ°å“ªä¸ªäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">        å‚æ•°2.è·¯ç”±çš„keyå€¼æ˜¯å“ªä¸ªï¼Ÿ  æœ¬æ¬¡æ˜¯é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment">        å‚æ•°3ï¼Œå…¶ä»–å‚æ•°é…ç½®</span></span><br><span class="line"><span class="comment">        å‚æ•°4ï¼Œå‘é€æ¶ˆæ¯çš„æ¶ˆæ¯ä½“</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.basicPublish(<span class="string">&quot;&quot;</span>,QUEUE_NAME,<span class="literal">null</span>,message.getBytes());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="1666959574738.png" alt="1666959574738"></p><p>æ¶ˆè´¹è€…ï¼šç”¨æ¥æ¥å—ç”Ÿæˆè€…äº§ç”Ÿçš„æ¶ˆæ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.rabbitmq.client.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ¶ˆè´¹è€…ï¼Œç”¨æ¥æ¶ˆè´¹ç”Ÿæˆè€…äº§ç”Ÿçš„ä»£ç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—çš„åç§°ï¼š</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span> String QUEUE_NAME=<span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºé“¾æ¥å·¥å‚</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        factory.setHost(<span class="string">&quot;www.littlehei.fun&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span>  factory.newConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span>  connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å£°æ˜</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag,message)-&gt;&#123;</span><br><span class="line">         <span class="comment">//  String message = new String(&quot;è‡ªå·±æ‰‹åŠ¨å»åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯ï¼Œä½†æ˜¯ä¸æ¨è&quot;);</span></span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å–æ¶ˆæ¶ˆæ¯æ—¶çš„å›è°ƒ</span></span><br><span class="line">        <span class="type">CancelCallback</span> <span class="variable">cancelCallback</span> <span class="operator">=</span> consumerTag -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆæ¯æ¶ˆè´¹è¢«ä¸­æ–­&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">        å‚æ•°1ï¼Œæ¶ˆè´¹å“ªä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">        å‚æ•°2ï¼Œæ¶ˆè´¹æˆåŠŸä¹‹åæ˜¯å¦è¦è‡ªåŠ¨åº”ç­”ï¼Œtrueè¡¨ç¤ºè‡ªåŠ¨åº”ç­”ï¼Œfalseè¡¨ç¤ºä¸æ˜¯</span></span><br><span class="line"><span class="comment">        å‚æ•°3ï¼Œæ¶ˆè´¹è€…æœªæˆåŠŸæ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">        å‚æ•°4ï¼Œæ¶ˆè´¹è€…å–å½•æ¶ˆè´¹çš„å›åˆ°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">      channel.basicConsume(QUEUE_NAME,<span class="literal">true</span>,deliverCallback,cancelCallback);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å·¥ä½œé˜Ÿåˆ—">å·¥ä½œé˜Ÿåˆ—</h2><p>ç”Ÿæˆè€… â€”å¤§é‡å‘æ¶ˆæ¯-- é˜Ÿåˆ— â€“ æ¥åˆ°æ¶ˆæ¯â€“å·¥ä½œçº¿ç¨‹1æˆ–è€…å·¥ä½œçº¿ç¨‹2.ã€‚ã€‚ã€‚</p><p>==æ³¨æ„ï¼šä¸€ä¸ªæ¶ˆæ¯åªèƒ½è¢«å¤„ç†ä¸€æ¬¡ä¸èƒ½å¤„ç†å¤šæ¬¡==</p><p>è½®è®­å¤„ç†æ¶ˆæ¯ï¼Œä½ ä¸€ä¸ªï¼Œæˆ‘ä¸‹ä¸€ä¸ªï¼Œä»–ä¸‹ä¸‹ä¸ªã€‚</p><p>ä¸åŒ<strong>å·¥ä½œçº¿ç¨‹</strong>ä¹‹é—´çš„å…³ç³»æ˜¯==ç«äº‰==å…³ç³»</p><p>åˆ›å»ºé“¾æ¥å·¥å…·ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GetConnection</span> &#123;</span><br><span class="line">    <span class="comment">//å»ºç«‹ä¸€ä¸ªå·¥å…·ç±»ï¼Œæ¯æ¬¡éƒ½ç›´æ¥ä½¿ç”¨ï¼Œå‡å°‘ä»£ç é‡å¤é‡</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> Channel <span class="title function_">getChannel</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªé“¾æ¥å·¥å‚</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">&quot;www.littlehei.fun&quot;</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line">        <span class="keyword">return</span> channel;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è½®è®­åˆ†å‘ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ä¸€ä¸ªå·¥ä½œçº¿ç¨‹,å¯ä»¥å¤šä¸ªåˆ›å»ºï¼Œå¯ä»¥å¤šçº¿ç¨‹åˆ›å»ºï¼Œå…·ä½“çœ‹ä½ è‡ªå·±å¦‚ä½•å®šäº</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WorkThread1</span> &#123;</span><br><span class="line">    <span class="comment">//é¦–å…ˆè¿˜æ˜¯åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">final</span>   <span class="type">String</span>  <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">          <span class="comment">/*</span></span><br><span class="line"><span class="comment">        æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">        å‚æ•°1ï¼Œæ¶ˆè´¹å“ªä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">        å‚æ•°2ï¼Œæ¶ˆè´¹æˆåŠŸä¹‹åæ˜¯å¦è¦è‡ªåŠ¨åº”ç­”ï¼Œtrueè¡¨ç¤ºè‡ªåŠ¨åº”ç­”ï¼Œfalseè¡¨ç¤ºä¸æ˜¯</span></span><br><span class="line"><span class="comment">        å‚æ•°3ï¼Œæ¶ˆè´¹è€…æœªæˆåŠŸæ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">        å‚æ•°4ï¼Œæ¶ˆè´¹è€…å–å½•æ¶ˆè´¹çš„å›åˆ°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag,message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä¸º&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">CancelCallback</span> <span class="variable">cancelCallback</span> <span class="operator">=</span> (consumerTag)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆæ¯è¢«å–æ¶ˆæ¶ˆè´¹æ¥å£å›è°ƒ&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(<span class="string">&quot;C1ç­‰å¾…æ¥æ”¶æ¶ˆæ¯...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¶ˆæ¯æ¥æ”¶</span></span><br><span class="line">        channel.basicConsume(QUEUE_NAME,<span class="literal">true</span>,deliverCallback,cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”Ÿäº§è€…ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ç”Ÿäº§è€…ï¼Œå¯ä»¥å‘é€å¤§é‡æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">final</span>  String QUEUE_NAEM=<span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘é€å¤§é‡æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">        <span class="comment">//é˜Ÿåˆ—å£°æ˜</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAEM,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å‘é€æ¶ˆæ¯</span></span><br><span class="line">        <span class="comment">//ä»æ§åˆ¶å°ä¸­è¾“å…¥</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªæ¶ˆæ¯è¾“å…¥</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (sc.hasNext())&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> sc.next();</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>,QUEUE_NAEM,<span class="literal">null</span>,name.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;å‘é€å®Œæˆï¼š &quot;</span>+name);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">----------ç»“æœ----------</span><br><span class="line">nihap</span><br><span class="line">å‘é€å®Œæˆnihap</span><br><span class="line">wp1</span><br><span class="line">å‘é€å®Œæˆwp1</span><br><span class="line">ci1</span><br><span class="line">å‘é€å®Œæˆci1</span><br><span class="line">wooda</span><br><span class="line">å‘é€å®Œæˆwooda</span><br><span class="line">æˆ‘å–œæ¬¢ä½ </span><br><span class="line">å‘é€å®Œæˆæˆ‘å–œæ¬¢ä½ </span><br><span class="line">------------------</span><br><span class="line">C1ç­‰å¾…æ¥æ”¶æ¶ˆæ¯...</span><br><span class="line">æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä¸ºnihap</span><br><span class="line">æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä¸ºci1</span><br><span class="line">æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä¸ºæˆ‘å–œæ¬¢ä½ </span><br><span class="line">--------------------</span><br><span class="line">C2ç­‰å¾…æ¥æ”¶æ¶ˆæ¯...</span><br><span class="line">æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä¸ºwp1</span><br><span class="line">æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä¸ºwooda</span><br></pre></td></tr></table></figure><h2 id="æ¶ˆæ¯åº”ç­”">æ¶ˆæ¯åº”ç­”</h2><p>ä¸ºäº†é˜²æ­¢æ¶ˆæ¯åœ¨å‘é€è¿‡ç¨‹ä¸­ä¸ä¸¢å¤±ï¼Œä»–æ˜¯==æŒ‡æ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆæ¯å¹¶ä¸”å¤„ç†è¯¥æ¶ˆæ¯ä¹‹åï¼Œå‘Šè¯‰rabbitmqä»–å·²ç»å¤„ç†å®Œæˆäº†ï¼Œrabbitmqå¯ä»¥æŠŠæ¶ˆæ¯åˆ é™¤ã€‚==</p><h3 id="è‡ªåŠ¨åº”ç­”ï¼š">è‡ªåŠ¨åº”ç­”ï¼š</h3><p>éœ€è¦åœ¨<strong>é«˜ååé‡å’Œæ•°æ®ä¼ è¾“å®‰å…¨æ€§æ–¹é¢åšæƒè¡¡</strong>ï¼Œè¿™ç§æ¨¡å¼å¦‚æœæ¶ˆæ¯åœ¨æ¥å—åˆ°ä¹‹å‰ï¼Œæ¶ˆè´¹è€…é‚£è¾¹å‡ºç°é“¾æ¥æˆ–è€…channelå…³é—­ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¸¢å¤±äº†ï¼Œå½“ç„¶å¦‚æœå¦ä¸€æ–¹é¢è¿™ç§æ¨¡å¼æ¶ˆè´¹è€…é‚£è¾¹å¯ä»¥ä¼ é€’è¿‡è½½æ¶ˆæ¯ï¼Œæ²¡æœ‰å¯¹ä¼ é€’çš„æ¶ˆæ¯æ•°é‡è¿›è¡Œé™åˆ¶ï¼Œè¿™æ ·æœ‰å¯èƒ½å¯¼è‡´æ¶ˆè´¹è€…ç”±äºæ¥æ”¶å¤ªå¤šè¿˜æ¥ä¸åŠå¤„ç†çš„æ¶ˆæ¯ï¼Œå¯¼è‡´è¿™äº›æ¶ˆæ¯ç§¯å‹ï¼Œæœ€ç»ˆå¯¼è‡´å†…å­˜è€—å°½ï¼Œæœ€ç»ˆè¿™äº›æ¶ˆè´¹è€…çº¿ç¨‹è¢«æ“ä½œç³»ç»Ÿæ€æ­»ï¼Œæ•…è€Œ<strong>è¿™ç§æ¨¡å¼é€‚ç”¨åœ¨æ¶ˆè´¹è€…å¯ä»¥é«˜æ•ˆå¹¶ä»¥æŸç§é€Ÿç‡èƒ½å¤Ÿå¤„ç†è¿™äº›æ¶ˆæ¯çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚</strong>ï¼ˆä¸é è°±ï¼‰</p><h3 id="æ‰‹åŠ¨åº”ç­”">æ‰‹åŠ¨åº”ç­”</h3><p>èƒ½ç”¨æ‰‹åŠ¨åˆ™ç”¨æ‰‹åŠ¨ã€‚æ‰‹åŠ¨æ–¹æ³•</p><ol><li>Channel.basicAck(ç”¨äºè‚¯å®šç¡®è®¤)</li><li>Channel.basicNack(ç”¨äºå¦å®šç¡®è®¤)</li><li>Channel.basicReject(ç”¨äºå¦å®šç¡®è®¤)ï¼Œå¯¹æ¯”nackå°‘äº†ä¸€ä¸ªå‚æ•°ï¼Œä¸å¤„ç†è¯¥æ¶ˆæ¯äº†ç›´æ¥å°±å¯ä»¥æ‹’ç»ï¼Œä¹Ÿå¯ä»¥å°†ä»–ä¸¢å¼ƒã€‚</li></ol><p>æ‰¹é‡åº”ç­”ï¼ˆmultipleï¼‰ï¼š==æ¨èä½¿ç”¨false==,å½“æ¥å—åˆ°ä¸€ä¸ªæ¶ˆæ¯çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯é˜Ÿåˆ—å¾€ä¿¡é“é‡Œè¾¹æ”¾äº†næ¡æ•°æ®ï¼Œé‚£ä¹ˆä»–ä¼šå°†æ­¤ä¿¡é“é‡Œè¾¹çš„æ‰€æœ‰æ¶ˆæ¯éƒ½åº”ç­”ä¸€æ¬¡ã€‚</p><h3 id="æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ">æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ</h3><p>å¦‚æœæ¶ˆè´¹è€…ç”±äºæŸäº›åŸå› å¤±å»è¿æ¥ï¼Œæˆ–è€…è¯´ä»–çš„é€šé“å·²ç»å…³é—­ï¼Œè¿æ¥å·²ç»å…³é—­æˆ–è€…TCPè¿æ¥ä¸¢å¤±ï¼Œå¯¼è‡´æ¶ˆæ¯æœªå‘é€ACKç¡®è®¤ï¼Œ**æ­¤æ—¶RabbitMQå°†äº†è§£åˆ°æ¶ˆæ¯æœªå®Œå…¨å¤„ç†ï¼Œå¹¶å°†å…¶é‡æ–°æ’é˜Ÿï¼Œå¦‚æœæ­¤æ—¶å…¶ä»–æ¶ˆè´¹è€…å¯ä»¥å¤„ç†ï¼Œä»–å°†å¾ˆå¿«å°†å…¶é‡æ–°åˆ†å‘ç»™å¦ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œ**è¿™æ ·å³ä½¿æŸä¸ªæ¶ˆè´¹è€…å¶å°”æ­»äº¡ï¼Œä¹Ÿå¯ä»¥ç¡®ä¿ä¸ä¼šä¸¢å¤±ä»»ä½•ä¿¡æ¯ã€‚</p><p>ä¸ªäººç†è§£ï¼š</p><p>ä¹Ÿå°±æ˜¯æœ¬æ¥åšè¿™ä¸ªä»»åŠ¡çš„å‘˜å·¥æœ‰äº‹è¾èŒäº†ï¼Œå…¬å¸ä¸ºäº†å®Œæˆä»»åŠ¡äº¤ç»™å¦ä¸€ä¸ªè¿˜åœ¨èŒçš„å‘˜å·¥å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œç›´åˆ°è¿™ä¸ªä»»åŠ¡å®Œæˆï¼Œè¿™æ ·ä¿è¯ä»»åŠ¡ä¸è¢«ä¸¢å¤±ã€‚</p><p>ä»£ç å®ç°ï¼š</p><p>æ¶ˆæ¯åœ¨æ‰‹åŠ¨åº”ç­”çš„æ—¶å€™æ˜¯ä¸åº”è¯¥è¢«ä¸¢å¤±çš„ï¼Œä¸”ä¼šé‡æ–°å…¥é˜Ÿã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æˆ‘ä»¬ä¸»è¦å›´ç»•çš„æ˜¯æ‰‹åŠ¨åº”ç­”è¿›è¡Œå¤„ç†ï¼Œè¦æ˜¯æ¶ˆæ¯åº”ç­”ä¸ä¸¢å¤±ï¼Œæ”¾å›é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">é‡æ–°æ¶ˆè´¹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Task</span> &#123;</span><br><span class="line">    <span class="comment">//è€æ ·å­ï¼Œé˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;ack_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å£°åé˜Ÿåˆ—</span></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä»æ§åˆ¶å°ä¸­è·å–</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (sc.hasNext())&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> sc.next();</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>,QUEUE_NAME,<span class="literal">null</span>,message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼š &quot;</span>+ message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Work_Consume1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;ack_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//æ¥å—æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;C1ç­‰å¾…æ¥å—æ¶ˆæ¯å¤„ç†æ—¶é—´è¾ƒçŸ­&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message)-&gt;&#123;</span><br><span class="line">            <span class="comment">//çœ‹æƒ…å†µä½ ç»™ä¸ç»™ä¼‘çœ </span></span><br><span class="line">            SleepUtils.sleep(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥æ”¶åˆ°æ¶ˆæ¯&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            <span class="comment">//è¿›è¡Œæ‰‹åŠ¨åº”ç­”</span></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            å‚æ•°1 ï¼Œ æ¶ˆæ¯çš„æ ‡è®°tag</span></span><br><span class="line"><span class="comment">            å‚æ•°2ï¼Œ æ˜¯å¦æ‰¹é‡åº”ç­”  false ä¸ ï¼Œtrueï¼Œæ‰¹é‡åº”ç­”</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            channel.basicAck(message.getEnvelope().getDeliveryTag(),<span class="literal">false</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//æ‰‹åŠ¨æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//é‡‡ç”¨æ‰‹åŠ¨åº”ç­”</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">autoAck</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        channel.basicConsume(QUEUE_NAME,autoAck,deliverCallback,(consumerTag-&gt;&#123;</span><br><span class="line">            System.out.println(consumerTag + <span class="string">&quot;æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹æ¥å£å›è°ƒé€»è¾‘&quot;</span>);</span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Title ä¼‘çœ å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SleepUtils</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">(<span class="type">int</span> second)</span> &#123;</span><br><span class="line">        <span class="comment">//JUCé‡Œè¾¹çš„å·¥å…·ç±»</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>*second);</span><br><span class="line">            <span class="comment">//TimeUnit.SECONDS.sleep(2);</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="comment">//ä¸­æ–­</span></span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šè¿°æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“æ¶ˆæ¯é˜Ÿåˆ—åœ¨æˆ‘ä»¬åˆ›å»ºå¤šä¸ªæ¶ˆè´¹è€…çš„æ—¶å€™ï¼Œæ˜¯è½®è½¬æ¥çš„ï¼Œå½“ç„¶ï¼Œå‡è®¾æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå®•æœºï¼Œé‚£ä¹ˆæ¶ˆæ¯é˜Ÿåˆ—å°±å°†æœ¬è½®è½¬ç»™æ²¡å®•æœºçš„é‚£ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œ==åªè¦ç”Ÿäº§è€…æœ‰äº§ç”Ÿï¼Œæ— è®ºå¦‚ä½•è¦å°†æ¶ˆæ¯å…¨éƒ¨æ¶ˆè´¹==ï¼Œä¸å¯ä¸¢å¼ƒã€‚</p><h2 id="Rabbitæ¶ˆæ¯æŒä¹…åŒ–">Rabbitæ¶ˆæ¯æŒä¹…åŒ–</h2><p>æ¶ˆæ¯æ˜¯å¯ä»¥æŒä¹…åŒ–ä¿å­˜çš„ï¼ŒæŒä¹…çš„ç›®çš„æ˜¯ä¸ºäº†å¤„ç†ä»»åŠ¡ä¸¢å¤±æƒ…å†µçš„ï¼Œé‡‡ç”¨æŒä¹…åŒ–å¯ä»¥ä¿è¯æ¶ˆæ¯å­˜å‚¨ï¼Œä¸”æ¶ˆæ¯ä¸è¢«ä¸¢å¤±ã€‚</p><h4 id="é˜Ÿåˆ—å¦‚ä½•æŒä¹…åŒ–">é˜Ÿåˆ—å¦‚ä½•æŒä¹…åŒ–</h4><blockquote><p>ä¸¤ä¸ªæŒä¹…åŒ–æ“ä½œéƒ½æ˜¯åœ¨ç”Ÿäº§è€…ä¸­è¿›è¡Œçš„ã€‚</p></blockquote><p>æˆ‘ä»¬éœ€è¦å°†durableå‚æ•°è®¾ç½®ä¸ºæŒä¹…åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®©é˜Ÿåˆ—æŒä¹…åŒ–</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">durable</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">channel.queueDeclare(é˜Ÿåˆ—å,durable,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>)</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ==å°±æ˜¯å¦‚æœä¹‹å‰å£°æ˜çš„é˜Ÿåˆ—ä¸æ˜¯æŒä¹…åŒ–çš„ï¼Œéœ€è¦æŠŠåŸå…ˆé˜Ÿåˆ—å…ˆåˆ é™¤ï¼Œç„¶åé‡æ–°åˆ›å»ºä¸€ä¸ªæŒä¹…åŒ–é˜Ÿåˆ—ï¼Œä¸ç„¶å°±ä¼šå‡ºç°é”™è¯¯==ã€‚</p><p>é”™è¯¯ï¼š</p><blockquote><p>com.rabbitmq.client.ShutdownSignalException: channel error; protocol method: #method&lt;channel.close&gt;(reply-code=406, reply-text=PRECONDITION_FAILED - inequivalent arg â€˜durableâ€™ for queue â€˜ack_queueâ€™ in vhost â€˜/â€™: received â€˜trueâ€™ but current is â€˜falseâ€™, class-id=50, method-id=10)</p></blockquote><p><img src="1667052000268.png" alt="1667052000268"></p><p><img src="1667052068537.png" alt="1667052068537"></p><p><strong>æ³¨æ„ï¼š</strong></p><p>==æŒä¹…åŒ–åçš„rabbitMQé‡å¯ä¹‹åé˜Ÿåˆ—æ¶ˆæ¯è¿˜æ˜¯ä¼šå­˜åœ¨çš„ï¼ŒæœªæŒä¹…åŒ–çš„ï¼Œé‚£ä¹ˆå¯¹ä¸èµ·ï¼Œä»–æ²¡äº†ã€‚==</p><h4 id="æ¶ˆæ¯æŒä¹…åŒ–">æ¶ˆæ¯æŒä¹…åŒ–</h4><p>å°†æ¶ˆæ¯æ ‡è®°ä¸ºæŒä¹…åŒ–å¹¶ä¸èƒ½ä¿è¯ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ï¼Œå°½ç®¡ä»–ä¼šå‘Šè¯‰rabbitMQå°†æ¶ˆæ¯ä¿å­˜åˆ°ç£ç›˜ä¸­ï¼Œä½†æ˜¯è¿™é‡Œä»ç„¶å­˜åœ¨å½“æ¶ˆæ¯åˆšåˆšå­˜å‚¨æ± åœ¨ç£ç›˜çš„æ—¶å€™ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å­˜å‚¨å®Œï¼Œæ¶ˆæ¯è¿˜åœ¨ç¼“å­˜çš„ä¸€ä¸ªé—´éš”ç‚¹ï¼Œæ­¤æ—¶å¹¶æ²¡æœ‰çœŸæ­£å†™å…¥ç£ç›˜ï¼ŒæŒä¹…æ€§ä¿è¯å¹¶ä¸å¼ºï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬ç®€å•ä»»åŠ¡é˜Ÿåˆ—è€Œè¨€ï¼Œè¿™å·²ç»å°±ç»°ç»°æœ‰ä½™äº†ã€‚</p><p><code>MessageProperties.PERSISTENT_TEXT_PLAIN</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Task</span> &#123;</span><br><span class="line">    <span class="comment">//è€æ ·å­ï¼Œé˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;ack_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å£°åé˜Ÿåˆ—</span></span><br><span class="line">        <span class="comment">//è®©é˜Ÿåˆ—æŒä¹…åŒ–</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">durable</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        channel.queueDeclare(QUEUE_NAME,durable,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä»æ§åˆ¶å°ä¸­è·å–</span></span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">while</span> (sc.hasNext())&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> sc.next();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ·»åŠ æŒä¹…åŒ–</span></span><br><span class="line">            <span class="comment">//è®¾ç½®ç”Ÿæˆè€…å‘é€æ¶ˆæ¯ä¸ºæŒä¹…åŒ–ä¿¡æ¯ï¼ˆè¦æ±‚ä¿å­˜åˆ°ç¡¬ç›˜ä¸Šï¼‰ä¿å­˜åœ¨å†…å­˜ä¸­</span></span><br><span class="line">            <span class="comment">//MessageProperties.PERSISTENT_TEXT_PLAIN,æŒ‡ä»¤å®ŒæˆæŒä¹…åŒ–</span></span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>,QUEUE_NAME, MessageProperties.PERSISTENT_TEXT_PLAIN,message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">           <span class="comment">//æœªæŒä¹…åŒ–æ—¶å€™çš„æ˜¯</span></span><br><span class="line">            <span class="comment">// channel.basicPublish(&quot;&quot;,QUEUE_NAME,null,message.getBytes(&quot;UTF-8&quot;));</span></span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼š &quot;</span>+ message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸å…¬å¹³åˆ†å‘ï¼š">ä¸å…¬å¹³åˆ†å‘ï¼š</h3><p>åœ¨æŸäº›æƒ…å†µä¸‹è½®è®­åˆ†å‘å¹¶ä¸å¥½ç”¨ï¼Œå…·ä½“ä¾‹å­ï¼šæœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…åœ¨å¤„ç†ä»»åŠ¡ï¼Œå…¶ä¸­æœ‰ä¸ªæ¶ˆè´¹è€…1å¤„ç†ä»»åŠ¡çš„é€Ÿåº¦éå¸¸å¿«ï¼Œè€Œå¦ä¸€ä¸ªæ¶ˆè´¹è€…2å¤„ç†çš„é€Ÿåº¦å´å¾ˆæ…¢ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿˜é‡‡ç”¨è½®è®­åˆ†å‘å°±ä¼šå¯¼è‡´è¿™ä¸ªå¤„ç†é€Ÿåº¦å¿«çš„å¾ˆå¤§ä¸€éƒ¨åˆ†æ—¶é—´å¤„äºç©ºé—²çŠ¶æ€ï¼Œè€Œå¤„ç†æ…¢çš„é‚£ä¸ªæ¶ˆè´¹è€…å°±ä¸€ç›´åœ¨å¹²æ´»ï¼Œè¿™ç§åˆ†é…æ–¹å¼å°±ä¸æ˜¯å¾ˆå¥½ã€‚</p><p>==èƒ½è€…å¤šåŠ³==ï¼Œå¤šåŠ³å¤šå¾—ã€‚</p><p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬æœ‰é‡‡ç”¨ä¸å…¬å¹³åˆ†å‘æ“ä½œ</p><p>è®¾ç½®å‚æ•°<strong>channel.basicQos(1);</strong></p><blockquote><p>èƒ½è€…å¤šåŠ³æ˜¯åœ¨æ¶ˆè´¹è€…ä¸­è®¾ç½®çš„</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//èƒ½è€…å¤šåŠ³</span></span><br><span class="line"><span class="type">int</span> <span class="variable">prefetchCount</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">channel.basicQos(prefetchCount);</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æˆ‘ä»¬ç”Ÿæ´»ä¸­é‡‡ç”¨çš„å°±æ˜¯ä¸å…¬å¹³åˆ†å‘ã€‚</p><p><strong>é¢„å–å€¼ï¼š</strong></p><p>é¢„å…ˆåˆ†é…ä»»åŠ¡ï¼Œæ¯”å¦‚ç”Ÿäº§è€…ç”Ÿæˆ7æ¡æ•°æ®ï¼Œé€šè¿‡é˜Ÿåˆ—åˆ†å‘ï¼Œé€šè¿‡==é¢„å–å€¼ï¼Œé¢„å–å€¼æ˜¯å¤šå°‘ï¼Œå°±ç»™å±äºé‚£æ¡ä¿¡é“çš„æ¶ˆè´¹è€…åˆ†é…å¤šå°‘æ¶ˆæ¯ã€‚å’Œæ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„å¿«æ…¢æ— å…³ã€‚==</p><p><strong>æ³¨æ„</strong>ï¼š</p><p>é¢„å–å€¼æ¶ˆè€—å®Œæ¯•åï¼Œä¹‹åçš„å€¼å°±æŒ‰ç…§é‚£ä¸ªæ¶ˆè´¹è€…å¿«ç»™ä»–åˆ†é…çš„ä¿¡æ¯å°±å¤šï¼Œè°æ…¢ï¼Œè°åˆ†é…çš„ä¿¡æ¯å°±å°‘ã€‚</p><p>é¢„å–å€¼æ˜¯æ´—å‘äººå‘˜èƒ½é™åˆ¶ç¼“å†²åŒºå¤§å°ï¼Œé¿å…ç¼“å†²åŒºé‡Œè¾¹æ— é™åˆ¶çš„æœªç¡®å®šæ¶ˆæ¯é—®é¢˜ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé¢„å–å€¼å¹¶ä¸æ˜¯ä½ ç›´æ¥è¾“å…¥å¤šå°‘æ¡æ•°æ®ä»–å°±å¯ä»¥ç›´æ¥å †æ»¡çš„æˆ‘ä»¬è®¾ç½®çš„é¢„å–å€¼çš„ï¼Œä»–å¯èƒ½ç”±äºæ¶ˆè´¹è´¹è€…å¤„ç†é€Ÿåº¦å½±å“ï¼Œæ¯”å¦‚ï¼Œä½ è¾“å…¥10æ¡æ•°æ®ï¼Œä½†æ˜¯è®¾ç½®é¢„å–å€¼ä¸º5çš„æœ€åå€¼åªä¼šäº§ç”Ÿ4æ¡æ•°æ®ä¹Ÿè¯´ä¸å‡†ï¼Œå› ä¸ºå¦ä¸€ä¸ªå¤ªå¿«äº†ï¼Œå…¶ä»–çš„æ•°æ®éƒ½è¢«ä»–æ¶ˆè€—å®Œæ¯•äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®éå…¬å¹³åˆ†å‘</span></span><br><span class="line">      <span class="comment">//int i = 1;</span></span><br><span class="line">      <span class="comment">//é¢„å–å€¼</span></span><br><span class="line">      <span class="type">int</span> i= <span class="number">5</span>; <span class="comment">//è®¾ç½®åˆ†å‘5ä¸ªæ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯é¢„å–å€¼ä¸º5</span></span><br><span class="line">      channel.basicQos(i);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®</span></span><br><span class="line">        <span class="comment">//int i = 1; //ä¸å…¬å¹³åˆ†å‘</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>;<span class="comment">//æ­¤æ—¶è®¾ç½®å°±æ˜¯é¢„å–å€¼äº†</span></span><br><span class="line">        channel.basicQos(i);</span><br></pre></td></tr></table></figure><h2 id="å‘å¸ƒå’Œç¡®è®¤">å‘å¸ƒå’Œç¡®è®¤</h2><p>ç”Ÿäº§è€… - - å‘é€æ¶ˆæ¯ â€“ é˜Ÿåˆ—hello         :apple:å¿…é¡»ä¿å­˜åœ¨ç£ç›˜ä¸Šæ‰èƒ½è¾¾åˆ°æŒä¹…åŒ–æ“ä½œã€‚</p><ol><li>è®¾ç½®è¦å»é˜Ÿåˆ—å¿…é¡»æŒä¹…åŒ–</li><li>è®¾ç½®è¦æ±‚é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯å¿…é¡»æŒä¹…åŒ–</li><li>å‘å¸ƒç¡®è®¤</li></ol><h3 id="å¼€å¯å‘å¸ƒç¡®è®¤">å¼€å¯å‘å¸ƒç¡®è®¤</h3><h4 id="å•ä¸ªç¡®è®¤å‘å¸ƒï¼š">å•ä¸ªç¡®è®¤å‘å¸ƒï¼š</h4><p>æ¯æ¬¡ç”Ÿäº§è€…ç”Ÿäº§ä¸€ä¸ªæ¶ˆæ¯ä»–éƒ½ä¼šç¡®è®¤ä¸€æ¬¡ï¼Œè¿™æ ·çš„å¥½å¤„å°±æ˜¯ï¼Œå¦‚æœå‘é€ä¿¡æ¯ä¸¢å¤±å¯ä»¥å¾ˆå®¹æ˜“ç¡®å®šä½ç½®ï¼Œç¼ºç‚¹æ˜¯æ…¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å•ä¸ªç¡®è®¤</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">publicMessageIndividually</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TimeoutException, InterruptedException &#123;</span><br><span class="line">       <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//é˜Ÿåˆ—çš„å£°æ˜</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//ä½¿ç”¨ä¿¡é“å¯¹é˜Ÿåˆ—è¿›è¡Œå£°æ˜</span></span><br><span class="line">       channel.queueDeclare(queueName,<span class="literal">true</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">       <span class="comment">//å¼€å¯å‘å¸ƒç¡®è®¤</span></span><br><span class="line">       channel.confirmSelect();</span><br><span class="line">       <span class="comment">//å¼€å§‹æ—¶é—´</span></span><br><span class="line">       <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//æ‰¹é‡å‘æ¶ˆæ¯</span></span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;</span><br><span class="line">           <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> i + <span class="string">&quot;&quot;</span>;</span><br><span class="line">           channel.basicPublish(<span class="string">&quot;&quot;</span>,queueName,<span class="literal">null</span>,message.getBytes());</span><br><span class="line">           <span class="comment">//å•ä¸ªæ¶ˆæ¯å°±é©¬ä¸Šè¿›è¡Œå‘å¸ƒç¡®è®¤</span></span><br><span class="line">           <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> channel.waitForConfirms();</span><br><span class="line">           <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">               System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€æˆåŠŸ&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//ç»“æŸæ—¶é—´</span></span><br><span class="line">       <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">       System.out.println(<span class="string">&quot;å‘å¸ƒ&quot;</span> + MESSAGE_COUNT + <span class="string">&quot;å•ä¸ªæ¶ˆæ¯&quot;</span> + (end-begin)+<span class="string">&quot;æ¯«ç§’&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰¹é‡ç¡®è®¤å‘å¸ƒï¼š">æ‰¹é‡ç¡®è®¤å‘å¸ƒï¼š</h4><p>æ‰¹é‡å‘å¸ƒå¯¹æ¯”å•ä¸ªå‘å¸ƒé€Ÿåº¦å¿«äº†å¾ˆå¤šï¼Œä½†æ˜¯è¿™ä¸ªç¢°åˆ°é—®é¢˜å»æŸ¥æ‰¾é—®é¢˜çš„æ—¶å€™å°±æ¯”è¾ƒæ…¢äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‰¹é‡å‘å¸ƒ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">publicMessageBatch</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TimeoutException, InterruptedException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é˜Ÿåˆ—çš„å£°æ˜</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä½¿ç”¨ä¿¡é“å¯¹é˜Ÿåˆ—è¿›è¡Œå£°æ˜</span></span><br><span class="line">        channel.queueDeclare(queueName,<span class="literal">true</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">//å¼€å¯å‘å¸ƒç¡®è®¤</span></span><br><span class="line">        channel.confirmSelect();</span><br><span class="line">        <span class="comment">//å¼€å§‹æ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ‰¹é‡ç¡®è®¤æ¶ˆæ¯çš„å¤§å°</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">batchSize</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        <span class="comment">//æœªç¡®è®¤æ¶ˆæ¯ä¸ªæ•°</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ‰¹é‡å‘æ¶ˆæ¯ï¼Œæ‰¹é‡å‘å¸ƒç¡®è®¤</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> i + <span class="string">&quot;&quot;</span>;</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;&quot;</span>,queueName,<span class="literal">null</span>,message.getBytes());</span><br><span class="line">            <span class="comment">//å•ä¸ªæ¶ˆæ¯å°±é©¬ä¸Šè¿›è¡Œå‘å¸ƒç¡®è®¤</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> channel.waitForConfirms();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ¶ˆæ¯è¾¾åˆ°10ç¡®è®¤ä¸€æ¬¡</span></span><br><span class="line">            <span class="keyword">if</span>(i%batchSize == <span class="number">0</span>)&#123;</span><br><span class="line">                channel.waitForConfirms();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//ç»“æŸæ—¶é—´</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘å¸ƒ&quot;</span> + MESSAGE_COUNT + <span class="string">&quot;å‘å¸ƒ100ä¸ªæ¶ˆæ¯&quot;</span> + (end-begin) +<span class="string">&quot;æ¯«ç§’&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="å¼‚æ­¥ç¡®è®¤å‘å¸ƒ">å¼‚æ­¥ç¡®è®¤å‘å¸ƒ</h4><p>å¯¹æ¯”å•æ­¥å’Œæ‰¹é‡è¿™ä¸ªå°±å‰å®³å¤šäº†ï¼Œä»–å¯ä»¥å¼‚å¸¸è¿›è¡Œï¼Œä»–æ˜¯åˆ©ç”¨å›è°ƒå‡½æ•°æ¥è¾¾åˆ°æ¶ˆæ¯å¯é æ€§ä¼ é€’çš„ï¼Œè¿™ä¸ªä¸­é—´ä»¶ä¹Ÿæ˜¯é€šè¿‡å‡½æ•°å›è°ƒæ¥ä¿è¯æ˜¯å¦æŠ•é€’æˆåŠŸã€‚</p><p><img src="1667101171282.png" alt="1667101171282"></p><p>å¯„å¿«ä»¶çš„äººç–¯ç‹‚å‘ï¼Œç„¶ååˆ°brokerä¸­é€‰æ‹©å“ªäº›éœ€è¦ç¡®è®¤çš„è¿›è¡Œç¡®è®¤ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¼‚æ­¥</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">publishMessageAsync</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">      <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//é˜Ÿåˆ—çš„å£°æ˜</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//ä½¿ç”¨ä¿¡é“å¯¹é˜Ÿåˆ—è¿›è¡Œå£°æ˜</span></span><br><span class="line">      channel.queueDeclare(queueName,<span class="literal">true</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">      <span class="comment">//å¼€å¯å‘å¸ƒç¡®è®¤</span></span><br><span class="line">      channel.confirmSelect();</span><br><span class="line">      <span class="comment">//å¼€å§‹æ—¶é—´</span></span><br><span class="line">      <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//æ¶ˆæ¯ç¡®è®¤æˆåŠŸï¼Œå›è°ƒå‡½æ•°</span></span><br><span class="line">      <span class="type">ConfirmCallback</span> <span class="variable">ackCallback</span> <span class="operator">=</span> (delivery,multiple)-&gt;&#123;</span><br><span class="line">          System.out.println(<span class="string">&quot;ç¡®è®¤çš„æ¶ˆæ¯ï¼š&quot;</span> + delivery);</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="comment">//æ¶ˆæ¯ç¡®è®¤å¤±è´¥ï¼Œå›è°ƒå‡½æ•°</span></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        1.æ¶ˆæ¯çš„æ ‡è®°</span></span><br><span class="line"><span class="comment">        2.æ¶ˆæ¯æ˜¯å¦ä¸ºæ‰¹é‡</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="type">ConfirmCallback</span> <span class="variable">nackCallback</span> <span class="operator">=</span> (delivery,multiple)-&gt;&#123;</span><br><span class="line">          System.out.println(<span class="string">&quot;æœªç¡®è®¤çš„æ¶ˆæ¯ï¼š&quot;</span> + delivery);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//åœ¨å‘æ¶ˆæ¯çš„æ—¶å€™ï¼Œä½ éœ€è¦å‡†å¤‡ä¸€ä¸ªç›‘å¬å™¨ï¼Œç›‘å¬å“ªäº›æ¶ˆæ¯æˆåŠŸäº†ï¼Œå“ªäº›æ¶ˆæ¯å¤±æ•ˆäº†</span></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">      1.ç›‘å¬å“ªäº›æ¶ˆæ¯æˆåŠŸäº†</span></span><br><span class="line"><span class="comment">      2.ç›‘å¬å“ªäº›æ¶ˆæ¯å¤±è´¥äº†</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      channel.addConfirmListener(ackCallback,nackCallback);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//æ‰¹é‡å‘é€æ¶ˆæ¯</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;</span><br><span class="line">          <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;æ¶ˆæ¯&quot;</span> + i;</span><br><span class="line">          channel.basicPublish(<span class="string">&quot;&quot;</span>,queueName,<span class="literal">null</span>,message.getBytes());</span><br><span class="line">          <span class="comment">//å‘å¸ƒç¡®è®¤ï¼Œè¿™ä¸ªæ—¶å€™è¦æ˜¯è¿›è¡Œå‘å¸ƒç¡®è®¤å°±æ˜¯åŒæ­¥äº†</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">//ç»“æŸæ—¶é—´</span></span><br><span class="line">      <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span>  System.currentTimeMillis();</span><br><span class="line">      System.out.println(<span class="string">&quot;å‘å¸ƒ&quot;</span> + MESSAGE_COUNT + <span class="string">&quot;å¼‚æ­¥å‘å¸ƒç¡®è®¤æ¶ˆæ¯ï¼Œè€—æ—¶&quot;</span> + (end-begin) +<span class="string">&quot;æ¯«ç§’&quot;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="è¿™å°±å‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•å¤„ç†å¼‚æ­¥æœªç¡®è®¤æ¶ˆæ¯">è¿™å°±å‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•å¤„ç†å¼‚æ­¥æœªç¡®è®¤æ¶ˆæ¯</h4><p>æœ€å¥½çš„è§£å†³çš„è§£å†³æ–¹æ¡ˆï¼Œå°±æ˜¯æŠŠæœªç¡®è®¤çš„æ¶ˆæ¯æ”¾åˆ°ä¸€ä¸ªåŸºäºå†…å­˜çš„èƒ½å‘å¸ƒçº¿ç¨‹è®¿é—®çš„é˜Ÿåˆ—ï¼Œæ¯”å¦‚è¯´ConcurrentLinkedQueueè¿™ä¸ªé˜Ÿåˆ—åœ¨confirm callbacksä¸å‘å¸ƒçº¿ç¨‹ä¹‹é—´è¿›è¡Œæ¶ˆæ¯çš„ä¼ é€’ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¼‚æ­¥</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">publishMessageAsync</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">       <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//é˜Ÿåˆ—çš„å£°æ˜</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//ä½¿ç”¨ä¿¡é“å¯¹é˜Ÿåˆ—è¿›è¡Œå£°æ˜</span></span><br><span class="line">       channel.queueDeclare(queueName,<span class="literal">true</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">       <span class="comment">//å¼€å¯å‘å¸ƒç¡®è®¤</span></span><br><span class="line">       channel.confirmSelect();</span><br><span class="line"></span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">       çº¿ç¨‹å®‰å…¨æœ‰åºçš„ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œé€‚ç”¨äºé«˜å¹¶å‘çš„æƒ…å†µä¸‹çš„</span></span><br><span class="line"><span class="comment">       1.è½»æ¾å°†åºå·å’Œæ¶ˆæ¯è¿›è¡Œå…³è”</span></span><br><span class="line"><span class="comment">       2.è½»æ¾æ‰¹é‡åˆ é™¤æ¡ç›®ï¼Œåªè¦ç»™åˆ°åºå·</span></span><br><span class="line"><span class="comment">       3.æ”¯æŒé«˜å¹¶å‘ï¼ˆå¤šçº¿ç¨‹ï¼‰</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       ConcurrentSkipListMap&lt;Long,String&gt;  outstandingConfirms=</span><br><span class="line">               <span class="keyword">new</span> <span class="title class_">ConcurrentSkipListMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">       <span class="comment">//æ¶ˆæ¯ç¡®è®¤æˆåŠŸï¼Œå›è°ƒå‡½æ•°</span></span><br><span class="line">       <span class="type">ConfirmCallback</span> <span class="variable">ackCallback</span> <span class="operator">=</span> (delivery,multiple)-&gt;&#123;</span><br><span class="line">        <span class="keyword">if</span>(multiple)&#123;</span><br><span class="line">            <span class="comment">//åˆ é™¤å·²ç»ç¡®è®¤çš„æ¶ˆæ¯ï¼Œå‰©ä¸‹çš„å°±æ˜¯ä¸ºç¡®è®¤çš„æ¶ˆæ¯</span></span><br><span class="line">            ConcurrentNavigableMap&lt;Long, String&gt; confirmed =</span><br><span class="line">                     outstandingConfirms.headMap(delivery);</span><br><span class="line">            confirmed.clear();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            outstandingConfirms.remove(delivery);</span><br><span class="line">        &#125;</span><br><span class="line">           System.out.println(<span class="string">&quot;ç¡®è®¤çš„æ¶ˆæ¯ï¼š&quot;</span> + delivery);</span><br><span class="line">       &#125;;</span><br><span class="line">       <span class="comment">//æ¶ˆæ¯ç¡®è®¤å¤±è´¥ï¼Œå›è°ƒå‡½æ•°</span></span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">         1.æ¶ˆæ¯çš„æ ‡è®°</span></span><br><span class="line"><span class="comment">         2.æ¶ˆæ¯æ˜¯å¦ä¸ºæ‰¹é‡</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       <span class="type">ConfirmCallback</span> <span class="variable">nackCallback</span> <span class="operator">=</span> (delivery,multiple)-&gt;&#123;</span><br><span class="line">          <span class="comment">//3.æ‰“å°ä¸€ä¸‹æœªç¡®è®¤çš„æ¶ˆæ¯éƒ½æœ‰å“ªäº›</span></span><br><span class="line">         <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span>  outstandingConfirms.get(delivery);</span><br><span class="line">           System.out.println(<span class="string">&quot;æœªç¡®è®¤çš„æ¶ˆæ¯æ˜¯:&quot;</span> + message+<span class="string">&quot;æœªç¡®è®¤çš„æ ‡è®°ï¼š&quot;</span> + delivery);</span><br><span class="line">       &#125;;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//åœ¨å‘æ¶ˆæ¯çš„æ—¶å€™ï¼Œä½ éœ€è¦å‡†å¤‡ä¸€ä¸ªç›‘å¬å™¨ï¼Œç›‘å¬å“ªäº›æ¶ˆæ¯æˆåŠŸäº†ï¼Œå“ªäº›æ¶ˆæ¯å¤±æ•ˆäº†</span></span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">       1.ç›‘å¬å“ªäº›æ¶ˆæ¯æˆåŠŸäº†</span></span><br><span class="line"><span class="comment">       2.ç›‘å¬å“ªäº›æ¶ˆæ¯å¤±è´¥äº†</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       channel.addConfirmListener(ackCallback,nackCallback); <span class="comment">// å¼‚æ­¥é€šçŸ¥</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//å¼€å§‹æ—¶é—´</span></span><br><span class="line">       <span class="type">long</span> <span class="variable">begin</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="comment">//æ‰¹é‡å‘é€æ¶ˆæ¯</span></span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; MESSAGE_COUNT; i++) &#123;</span><br><span class="line">           <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;æ¶ˆæ¯&quot;</span> + i;</span><br><span class="line">           channel.basicPublish(<span class="string">&quot;&quot;</span>,queueName,<span class="literal">null</span>,message.getBytes());</span><br><span class="line">           <span class="comment">//å‘å¸ƒç¡®è®¤ï¼Œè¿™ä¸ªæ—¶å€™è¦æ˜¯è¿›è¡Œå‘å¸ƒç¡®è®¤å°±æ˜¯åŒæ­¥äº†</span></span><br><span class="line">           <span class="comment">/*</span></span><br><span class="line"><span class="comment">           1ã€‚æ­¤å¤„è®°å½•ä¸‹æ‰€æœ‰è¦å‘é€çš„æ¶ˆæ¯ï¼Œæ¶ˆæ¯çš„æ€»å’Œ</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">      outstandingConfirms.put(channel.getNextPublishSeqNo(),message);</span><br><span class="line">           System.out.println();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//ç»“æŸæ—¶é—´</span></span><br><span class="line">       <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span>  System.currentTimeMillis();</span><br><span class="line">       System.out.println(<span class="string">&quot;å‘å¸ƒ&quot;</span> + MESSAGE_COUNT + <span class="string">&quot;å¼‚æ­¥å‘å¸ƒç¡®è®¤æ¶ˆæ¯ï¼Œè€—æ—¶&quot;</span> + (end-begin) +<span class="string">&quot;æ¯«ç§’&quot;</span>);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="ä»¥ä¸Šä¸‰ç§å‘å¸ƒçš„ç¡®è®¤é€Ÿåº¦å¯¹æ¯”">ä»¥ä¸Šä¸‰ç§å‘å¸ƒçš„ç¡®è®¤é€Ÿåº¦å¯¹æ¯”</h3><p>å•æ­¥å‘å¸ƒæ¶ˆæ¯</p><ul><li>åŒæ­¥ç­‰å¾…ç¡®è®¤ï¼Œç®€å•ï¼Œä½†æ˜¯ååé‡éå¸¸æœ‰é™</li></ul><p>æ‰¹é‡å‘å¸ƒç¡®è®¤</p><ul><li>æ‰¹é‡åŒæ­¥ç­‰å¾…ç¡®è®¤ï¼ŒåŠ å•ï¼Œåˆç†çš„ååé‡ï¼Œä¸€æ—¦å‡ºç°é—®é¢˜ï¼Œä½†å¾ˆéš¾æ¨æ–­å‡ºæ˜¯é‚£æ¡æ¶ˆæ¯å‡ºç°äº†é—®é¢˜ã€‚</li></ul><p>å¼‚æ­¥å‘å¸ƒç¡®è®¤</p><p>æœ€ä½³æ€§èƒ½å’Œèµ„æºä½¿ç”¨ï¼Œåœ¨å‡ºç°é”™è¯¯çš„æƒ…å†µä¸‹å¯ä»¥å¾ˆå¥½çš„æ§åˆ¶ï¼Œä½†æ˜¯å®ç°èµ·æ¥ç¨å¾®éš¾ä¸€ç‚¹ã€‚</p><h2 id="äº¤æ¢æœºï¼ˆexchangesï¼‰">äº¤æ¢æœºï¼ˆexchangesï¼‰</h2><p>å½“ä½¿ç”¨åˆ°äº¤æ¢æœºçš„æ—¶å€™ï¼Œæˆ‘ä»¬ç”¨çš„å°±ä¸æ˜¯æ™®é€šçš„æ¨¡å¼äº†ï¼Œè€Œæ˜¯å‘å¸ƒè®¢é˜…æ¨¡å¼äº†ã€‚</p><p><strong>ç”Ÿäº§è€…ç”Ÿæˆçš„æ¶ˆæ¯ä¸ä¼šç›´æ¥å‘é€åˆ°é˜Ÿåˆ—</strong></p><p>è€Œæ˜¯ç›´æ¥å°†æ¶ˆæ¯å…ˆå‘é€åˆ°äº¤æ¢æœºï¼Œå¹¶ä¸”åªèƒ½å‘é€åˆ°äº¤æ¢æœºï¼Œä¹‹é’±çš„æˆ‘ä»¬å¯ä»¥ç›´æ¥å‘é€åˆ°é˜Ÿåˆ—ï¼ˆäº‹å®ä¸Šæˆ‘ä»¬èµ°çš„æ˜¯é»˜è®¤äº¤æ¢æœºï¼‰ï¼Œç„¶åé˜Ÿåˆ—äº¤ç»™æ¶ˆè´¹è€…ï¼Œç°åœ¨ä¸è¡Œäº†ï¼Œæ”¹æˆå…ˆå‘é€ç»™äº¤æ¢æœºï¼Œäº¤æ¢æœºåœ¨å‘ç»™é˜Ÿåˆ—ã€‚</p><p>äº¤æ¢æœºçš„å·¥ä½œæ–¹å¼å¾ˆç®€å•ï¼Œ<strong>ä»–æ¥æ”¶æ¥è‡ªç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œå¦ä¸€æ–¹é¢å°†ä»–ä»¬æ¨é€åˆ°é˜Ÿåˆ—ã€‚</strong></p><h3 id="äº¤æ¢æœºçš„ç±»å‹">äº¤æ¢æœºçš„ç±»å‹</h3><p>ç›´æ¥ï¼ˆdirectï¼‰,ä¸»é¢˜ï¼ˆtopicï¼‰,æ ‡é¢˜ï¼ˆheadsï¼‰ï¼Œæ‰‡å‡ºï¼ˆfanoutï¼‰</p><h4 id="æ— åexchanges">æ— åexchanges</h4><p>äº‹å®ä¸Šå°±æ˜¯é»˜è®¤ç±»å‹ï¼Œæˆ‘ä»¬é€šè¿‡ç©ºå­—ç¬¦ï¼ˆâ€œâ€ï¼‰ä¸²è¿›è¡Œæ ‡è¯†ã€‚</p><p><code>channel.basicPublic(&quot;&quot;,&quot;hello&quot;,null,message.getBytes());</code></p><p>å®é™…ä¸Šç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯äº¤æ¢æœºçš„åå­—ï¼Œç©ºå­—ç¬¦ä¸²è¡¨ç¤ºé»˜è®¤æˆ–è€…æ— åç§°äº¤æ¢æœºï¼Œæ¶ˆæ¯èƒ½è·¯ç”±å‘é€åˆ°é˜Ÿåˆ—ä¸­ï¼Œå…¶å®æ˜¯ç”±routing(bindingkey)ç»‘å®škeyæŒ‡å®šçš„ï¼Œå¦‚æœå®ƒå­˜åœ¨çš„è¯ã€‚</p><h4 id="ä¸´æ—¶é˜Ÿåˆ—">ä¸´æ—¶é˜Ÿåˆ—</h4><p>å®é™…ä¸Šæ˜¯è‡ªå®šä¹‰çš„ï¼Œä¸€æ—¦æ–­å¼€é“¾æ¥ï¼Œè¿™ä¸ªé˜Ÿåˆ—å°±ä¼šè¢«åˆ é™¤ã€‚</p><h4 id="ç»‘å®š">ç»‘å®š</h4><p>å®é™…ä¸Šå°±æ˜¯äº¤æ¢æœºå’Œé˜Ÿåˆ—çš„æ¡¥æ¢ï¼Œä»–å‘Šè¯‰æˆ‘ä»¬äº¤æ¢æœºå’Œé‚£ä¸ªé˜Ÿåˆ—è¿›è¡Œç»‘å®šå…³ç³»</p><h4 id="Fanout">Fanout</h4><p>fanoutæ˜¯ä¸€ç§äº¤æ¢æœºçš„ç±»å‹ï¼Œè¿™ç§ç±»å‹éå¸¸ç®€å•ï¼Œæ­£å¦‚åç§°ä¸­çŒœæƒ³çš„é‚£æ ·ï¼Œä»–æ˜¯å°†æ¥æ”¶çš„æ‰€æœ‰æ¶ˆæ¯<strong>å¹¿æ’­</strong>åˆ°ä»–çŸ¥é“çš„æ‰€æœ‰é˜Ÿåˆ—ä¸­ï¼Œç³»ç»Ÿä¸­é»˜è®¤æœ‰exchangesäº¤æ¢æœºç±»å‹ã€‚</p><p><img src="1667315273358.png" alt="1667315273358"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å‘æ¶ˆæ¯ äº¤æ¢æœº</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmitLog</span> &#123;</span><br><span class="line">    <span class="comment">//äº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span>  String EXCHANGE_NAME=<span class="string">&quot;logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME,<span class="string">&quot;fanout&quot;</span>);</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (sc.hasNext())&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> sc.next();</span><br><span class="line">            channel.basicPublish(EXCHANGE_NAME,<span class="string">&quot;&quot;</span>,<span class="literal">null</span>,message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼š&quot;</span> + message);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ¶ˆæ¯æ¥æ”¶,å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLog</span> &#123;</span><br><span class="line">    <span class="comment">//äº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span>  String EXCHANG_NAME=<span class="string">&quot;logs&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">        <span class="comment">//å£°æ˜ä¸€ä¸ªäº¤æ¢æœº</span></span><br><span class="line">      channel.exchangeDeclare(EXCHANG_NAME,<span class="string">&quot;fanout&quot;</span>);</span><br><span class="line">        <span class="comment">//å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ¥ä¸€ä¸ªä¸´æ—¶é˜Ÿåˆ—</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        é˜Ÿåˆ—çš„åç§°æ˜¯éšæœºçš„ã€‚</span></span><br><span class="line"><span class="comment">        å½“æ¶ˆè´¹è€…æ–­å¼€ä¸é˜Ÿåˆ—çš„è¿æ¥çš„æ—¶å€™ï¼Œé˜Ÿåˆ—å°±å¯ä»¥è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span>  channel.queueDeclare().getQueue();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        ç»‘å®šäº¤æ¢æœºå’Œé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">      channel.queueBind(queueName,EXCHANG_NAME,<span class="string">&quot;&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥å—æ¶ˆæ¯ï¼ŒæŠŠæ¶ˆæ¯æ˜¾ç¤ºåœ¨å±å¹•ä¸Š&quot;</span>);</span><br><span class="line">        <span class="comment">//æ¥å—æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer,message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Receiveæ§åˆ¶å°æ‰“å°æ¥å—åˆ°çš„æ¶ˆæ¯&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>) );</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆæ¯æ—¶å›è°ƒæ¥å£</span></span><br><span class="line">        channel.basicConsume(queueName,<span class="literal">true</span>,deliverCallback,consumer-&gt;&#123;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Direct">Direct</h4><p><img src="1667315482498.png" alt="1667315482498"></p><p>ä»å›¾ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒXç»‘å®šäº†ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œç»‘å®šç±»å‹æ˜¯direct,é˜Ÿåˆ—Q1ç»‘å®šå»ºä¸ºorangeï¼Œé˜Ÿåˆ—2ç»‘å®šé”®æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªä¸ºblackï¼Œå¦ä¸€ä¸ªä¸ºgreen.</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‘å¸ƒè¿™å‘å¸ƒæ¶ˆæ¯åˆ°exchangeä¸Šï¼Œç»‘å®šé”®ä¸ºorangeçš„æ¶ˆæ¯ä¼šè¢«å‘å¸ƒåˆ°é˜Ÿåˆ—Q1ç»‘å®šé”®ä¸ºblackgreençš„æ¶ˆæ¯ä¼šè¢«å‘å¸ƒåˆ°é˜Ÿåˆ—Q2,å…¶ä»–æ¶ˆæ¯ç±»å‹å°±è¢«ä¸¢å¼ƒã€‚</p><p><strong>å¤šé‡ç»‘å®š</strong></p><p><img src="1667315780121.png" alt="1667315780121"></p><p>å½“ç„¶å¦‚æœexchangeçš„ç»‘å®šç±»å‹æ˜¯directï¼Œä½†æ˜¯ä»–ç»‘å®šçš„å¤šä¸ªé˜Ÿåˆ—çš„keyå¦‚æœå¤šç›¸åŒåœ¨è¿™ç§æƒ…å†µä¸‹è™½ç„¶ç»‘å®šç±»å‹æ˜¯directï¼Œä½†æ˜¯ä»–è¡¨ç°çš„å°±å’Œfanoutæœ‰ç‚¹æƒ³ç±»ä¼¼äº†ï¼Œå°±å’Œå¹¿æ’­å·®ä¸å¤šäº†ã€‚</p><p><img src="1667316127055.png" alt="1667316127055"></p><p>è¿™è¾¹å°±å¯ä»¥æŒ‡å®šå‘ç»™è°äº†ï¼Œæˆ‘ä¸å‘ç»™è°ä»–å°±æ”¶ä¸åˆ°æ¶ˆæ¯ï¼Œåªæœ‰æˆ‘å…è®¸ä»–æ¥æ”¶ä»–æ‰èƒ½å¾—åˆ°æ¥æ”¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DirectLogs</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//äº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span>  String EXCHANGE_NAME=<span class="string">&quot;direct_logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (sc.hasNext())&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> sc.next();</span><br><span class="line">            channel.basicPublish(EXCHANGE_NAME,<span class="string">&quot;info&quot;</span>,<span class="literal">null</span>,message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼š&quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLogDirect01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span><span class="string">&quot;direct_logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class="line">        <span class="comment">//å£°æ˜ä¸€ä¸ªäº¤æ¢æœº</span></span><br><span class="line">        channel.queueDeclare(<span class="string">&quot;console&quot;</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        ç»‘å®šäº¤æ¢æœºå’Œé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueBind(<span class="string">&quot;console&quot;</span>,EXCHANGE_NAME,<span class="string">&quot;info&quot;</span>);</span><br><span class="line">        channel.queueBind(<span class="string">&quot;console&quot;</span>,EXCHANGE_NAME,<span class="string">&quot;warning&quot;</span>);</span><br><span class="line">        <span class="comment">//æ¥å—æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer, message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ReceiveLogsDirect01æ§åˆ¶å°æ‰“å°æ¥å—åˆ°çš„æ¶ˆæ¯&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>) );</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆæ¯æ—¶å›è°ƒæ¥å£</span></span><br><span class="line">        channel.basicConsume(<span class="string">&quot;console&quot;</span>,<span class="literal">true</span>,deliverCallback,consumer-&gt;&#123;&#125;);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLogDirect02</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">EXCHANGE_NAME</span> <span class="operator">=</span><span class="string">&quot;direct_logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME, BuiltinExchangeType.DIRECT);</span><br><span class="line">        <span class="comment">//å£°æ˜ä¸€ä¸ªäº¤æ¢æœº</span></span><br><span class="line">        channel.queueDeclare(<span class="string">&quot;disk&quot;</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        ç»‘å®šäº¤æ¢æœºå’Œé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        channel.queueBind(<span class="string">&quot;disk&quot;</span>,EXCHANGE_NAME,<span class="string">&quot;error&quot;</span>);</span><br><span class="line">        <span class="comment">//æ¥å—æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer, message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ReceiveLogsDirect01æ§åˆ¶å°æ‰“å°æ¥å—åˆ°çš„æ¶ˆæ¯&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>) );</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆæ¯æ—¶å›è°ƒæ¥å£</span></span><br><span class="line">        channel.basicConsume(<span class="string">&quot;disk&quot;</span>,<span class="literal">true</span>,deliverCallback,consumer-&gt;&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Topic">Topic</h4><p>å¯¹æ¯”ä¸Šé¢ä¸¤ç§äº¤æ¢æœºæ›´åŠ å®Œç¾ï¼Œå½“å­˜åœ¨æˆ‘ä»¬è¦æ¥å—æ—¥å¿—ç±»å‹æœ‰info.baseå’Œinfo.advantage,æŸä¸ªé˜Ÿåˆ—åªæƒ³info.baseçš„æ¶ˆæ¯ï¼Œé‚£è¿™ä¸ªÂ·æ—¶å€™ä¸Šè¾¹ä¸¤ç§äº¤æ¢æœºå°±åšä¸åˆ°äº†ã€‚æ­¤æ—¶æˆ‘ä»¬é‡‡ç”¨çš„å°±æ˜¯topicäº¤æ¢æœºç±»å‹äº†ã€‚</p><p><strong>Topic</strong></p><p>å‘é€ç±»å‹æ˜¯topicäº¤æ¢æœºçš„æ¶ˆæ¯çš„routing_keyä¸èƒ½éšæ„å†™ï¼Œ<strong>å¿…é¡»æ»¡è¶³ä¸€å®šçš„è¦æ±‚ï¼Œä»–å¿…é¡»æ˜¯ä¸€ä¸ªå•çº¯åˆ—è¡¨ï¼Œä»¥ç‚¹å·éš”å¼€</strong>ï¼Œè¿™ä¸ªå•æ¬¡å¯ä»¥æ˜¯ä»»æ„å•è¯ã€‚&quot;<a href="http://nysc.xxx">nysc.xxx</a>&quot;ç­‰ã€‚é™åˆ¶è¦æ±‚å•è¯åˆ—è¡¨ä¸èƒ½è¶…è¿‡255ä¸ªå­—èŠ‚ã€‚</p><p><img src="1667397699728.png" alt="1667397699728"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯</p><p>*** ä»£è¡¨çš„æ˜¯ä¸€ä¸ªå•è¯**</p><p><strong>â€˜#â€™ ä»£è¡¨çš„æ˜¯å¯ä»¥æ›¿æ¢é›¶ä¸ªæˆ–å¤šä¸ªå•è¯ã€‚</strong></p><p>ä¸‹å›¾ç»‘å®šå…³ç³»å¦‚ä¸‹</p><p>Q1â€“&gt; ç»‘å®šçš„æ˜¯</p><p>â€‹<em><em>ä¸­é—´ä»£orangeå¸¦3ä¸ªå•è¯çš„å­—ç¬¦ä¸²ï¼ˆ</em> .orange. <em>ï¼‰</em></em></p><p>Q2â€“&gt; ç»‘å®šçš„æ˜¯</p><p>â€‹<em><em>æœ€åä¸€ä¸ªå•è¯æ˜¯rabbitçš„3ä¸ªå•è¯ï¼ˆ</em> . <em>rabbitï¼‰</em></em></p><p>â€‹<strong>ç¬¬ä¸€ä¸ªå•è¯æ˜¯lazyçš„å¤šä¸ªå•è¯ï¼ˆlazy.#ï¼‰</strong></p><p><img src="1667399049266.png" alt="1667399049266"></p><p>ä¸‹è¾¹æˆ‘ä»¬å°†ä¸Šå›¾ä¹‹é—´çš„æ•°æ®æ¥å—æƒ…å†µåˆ—ä¸¾å‡ºæ¥</p><p>quick.<strong>orange</strong>.<strong>rabbit</strong>         è¢«é˜Ÿåˆ—Q1Q2æ¥å—åˆ°</p><p><strong>lazy</strong>.<strong>orange</strong>.elephant è¢«é˜Ÿåˆ—Q1Q2æ¥å—åˆ°</p><p>quick.<strong>orange</strong>.foxè¢«é˜Ÿåˆ—Q1æ¥å—åˆ°</p><p><strong>lazy</strong>.brown.foxè¢«é˜Ÿåˆ—Q2æ¥å—åˆ°</p><p><strong>lazy</strong>.pink.<strong>rabbit</strong>è™½ç„¶æ»¡è¶³ä¸¤ä¸ªç»‘å®šä½†åªè¢«é˜Ÿåˆ—Q2æ¥å—ä¸€æ¬¡</p><p>quick.brown.foxä¸åŒ¹é…ä»»ä½•ç»‘å®šä¸ä¼šè¢«ä»»ä½•é˜Ÿåˆ—æ¥æ”¶åˆ°ä¼šè¢«ä¸¢å¼ƒ</p><p>quick.<strong>orange</strong>.male.rabbitæ˜¯å››ä¸ªå•è¯ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¼šè¢«ä¸¢å¼ƒ</p><p><strong>lazy</strong>.orange.male.rabbit æ˜¯å››ä¸ªå•è¯ä½†åŒ¹é…Q2</p><p>==ä¸Šè¿°åŠ ç²—çš„æ˜¯ç¬¦åˆTOPICç±»å‹äº¤æ¢æœºçš„å•è¯æŒ‡ä»¤==</p><p>==æ˜¯æœ€å¼ºå¤§çš„ï¼Œä¹Ÿæ˜¯ä½¿ç”¨æœ€å¹¿çš„==</p><ul><li>å½“é˜Ÿåˆ—ç»‘å®šå…³ç³»æ˜¯#,é‚£ä¹ˆè¿™ä¸ªé˜Ÿåˆ—å°†æ¥æ”¶æ‰€æœ‰çš„æ•°æ®ï¼Œæœ‰ç‚¹åƒFanoutäº†ã€‚</li><li>å¦‚æœé˜Ÿåˆ—ç»‘å®šçš„é”®ä¸­æ²¡æœ‰#å’Œ*å‡ºç°ï¼Œé‚£ä¹ˆè¯¥é˜Ÿåˆ—ç»‘å®šç±»ç±»å‹å°±æ˜¯directäº†ã€‚</li></ul><p>æ¶ˆè´¹è€…1</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å£°æ˜ä¸»é¢˜äº¤æ¢æœº</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLogsTopic01</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è€æ ·å­å®šä¹‰ä¸€ä¸ªäº¤æ¢æœºå</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span> String EXCHANGE_NAME= <span class="string">&quot;topic_logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¥å—æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">       <span class="comment">//å£°æ˜ä¸€ä¸ªäº¤æ¢æœº</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME,<span class="string">&quot;topic&quot;</span>);</span><br><span class="line">        <span class="comment">//å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;Q1&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»‘å®š</span></span><br><span class="line">        channel.queueBind(queueName,EXCHANGE_NAME,<span class="string">&quot;*.orange.*&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥å—æ¶ˆæ¯&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer,message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥å—é˜Ÿåˆ—ï¼šâ€”â€”&gt; &quot;</span> +queueName +<span class="string">&quot;ç»‘å®šé”®ï¼š&quot;</span>+ message.getEnvelope().getRoutingKey());</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line">        channel.basicConsume(queueName,<span class="literal">true</span>,deliverCallback,consumer-&gt;&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç­‰å¾…æ¥å—æ¶ˆæ¯<br>è¢«é˜Ÿåˆ—Q1Q2æ¥å—åˆ°<br>æ¥å—é˜Ÿåˆ—ï¼šâ€”â€”&gt; Q1ç»‘å®šé”®ï¼šlazy.orange.elephant<br>è¢«é˜Ÿåˆ—Q1Q2æ¥å—åˆ°<br>æ¥å—é˜Ÿåˆ—ï¼šâ€”â€”&gt; Q1ç»‘å®šé”®ï¼šquick.orange.rabbit<br>è¢«é˜Ÿåˆ—Q1æ¥å—åˆ°<br>æ¥å—é˜Ÿåˆ—ï¼šâ€”â€”&gt; Q1ç»‘å®šé”®ï¼šquick.orange.fox</p></blockquote><p>æ¶ˆè´¹è€…2</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å£°æ˜ä¸»é¢˜äº¤æ¢æœº</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReceiveLogsTopic02</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è€æ ·å­å®šä¹‰ä¸€ä¸ªäº¤æ¢æœºå</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span> String EXCHANGE_NAME= <span class="string">&quot;topic_logs&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¥å—æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">       <span class="comment">//å£°æ˜ä¸€ä¸ªäº¤æ¢æœº</span></span><br><span class="line">        channel.exchangeDeclare(EXCHANGE_NAME,<span class="string">&quot;topic&quot;</span>);</span><br><span class="line">        <span class="comment">//å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;Q2&quot;</span>;</span><br><span class="line">        channel.queueDeclare(queueName,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»‘å®š</span></span><br><span class="line">        channel.queueBind(queueName,EXCHANGE_NAME,<span class="string">&quot;*.*.rabbit&quot;</span>);</span><br><span class="line">        channel.queueBind(queueName,EXCHANGE_NAME,<span class="string">&quot;lazy.#&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥å—æ¶ˆæ¯&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer,message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¥å—é˜Ÿåˆ—ï¼šâ€”â€”&gt; &quot;</span> +queueName +<span class="string">&quot;ç»‘å®šé”®ï¼š&quot;</span>+ message.getEnvelope().getRoutingKey());</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line">        channel.basicConsume(queueName,<span class="literal">true</span>,deliverCallback,consumer-&gt;&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç­‰å¾…æ¥å—æ¶ˆæ¯<br>è¢«é˜Ÿåˆ—Q1Q2æ¥å—åˆ°<br>æ¥å—é˜Ÿåˆ—ï¼šâ€”â€”&gt; Q2ç»‘å®šé”®ï¼šlazy.orange.elephant<br>è¢«é˜Ÿåˆ—Q2æ¥å—åˆ°<br>æ¥å—é˜Ÿåˆ—ï¼šâ€”â€”&gt; Q2ç»‘å®šé”®ï¼šlazy.brown.fox<br>è¢«é˜Ÿåˆ—Q1Q2æ¥å—åˆ°<br>æ¥å—é˜Ÿåˆ—ï¼šâ€”â€”&gt; Q2ç»‘å®šé”®ï¼šquick.orange.rabbit<br>è™½ç„¶æ»¡è¶³ä¸¤ä¸ªç»‘å®šä½†åªè¢«é˜Ÿåˆ—Q2æ¥å—ä¸€æ¬¡<br>æ¥å—é˜Ÿåˆ—ï¼šâ€”â€”&gt; Q2ç»‘å®šé”®ï¼šlazy.pink.rabbit<br>æ˜¯å››ä¸ªå•è¯ä½†åŒ¹é…Q2<br>æ¥å—é˜Ÿåˆ—ï¼šâ€”â€”&gt; Q2ç»‘å®šé”®ï¼šlazy.orange.male.rabbit</p></blockquote><p>ç”Ÿäº§è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ç”Ÿäº§è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmitLogTopic</span> &#123;</span><br><span class="line">    <span class="comment">//è€æ ·å­ï¼Œè¿˜æ˜¯å®šä¹‰ä¸€ä¸ªäº¤æ¢æœºåå­—ï¼Œæ³¨æ„è¿™ä¸ªäº¤æ¢</span></span><br><span class="line">    <span class="comment">// æœºåå­—éœ€è¦å’Œæ¶ˆè´¹è€…é‡Œè¾¹å®šä¹‰çš„äº¤æ¢æœºä¸€æ ·ï¼Œé¿å…å‡ºé”™</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span>  String EXCHANGE_NAME=<span class="string">&quot;topic_logs&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//è·å–ä¿¡é“é“¾æ¥</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        Q1--&gt; ç»‘å®šçš„æ˜¯</span></span><br><span class="line"><span class="comment">    ä¸­é—´ä»£orangeå¸¦3ä¸ªå•è¯çš„å­—ç¬¦ä¸²ï¼ˆ* .orange. *ï¼‰</span></span><br><span class="line"><span class="comment">        Q2--&gt; ç»‘å®šçš„æ˜¯</span></span><br><span class="line"><span class="comment">        æœ€åä¸€ä¸ªå•è¯æ˜¯rabbitçš„3ä¸ªå•è¯ï¼ˆ* . *rabbitï¼‰</span></span><br><span class="line"><span class="comment">        ç¬¬ä¸€ä¸ªå•è¯æ˜¯lazyçš„å¤šä¸ªå•è¯ï¼ˆlazy.#ï¼‰</span></span><br><span class="line"><span class="comment">        quick.orange.rabbit         è¢«é˜Ÿåˆ—Q1Q2æ¥å—åˆ°</span></span><br><span class="line"><span class="comment">        lazy.orange.elephant è¢«é˜Ÿåˆ—Q1Q2æ¥å—åˆ°</span></span><br><span class="line"><span class="comment">        quick.orange.foxè¢«é˜Ÿåˆ—Q1æ¥å—åˆ°</span></span><br><span class="line"><span class="comment">        lazy.brown.foxè¢«é˜Ÿåˆ—Q2æ¥å—åˆ°</span></span><br><span class="line"><span class="comment">        lazy.pink.rabbitè™½ç„¶æ»¡è¶³ä¸¤ä¸ªç»‘å®šä½†åªè¢«é˜Ÿåˆ—Q2æ¥å—ä¸€æ¬¡</span></span><br><span class="line"><span class="comment">        quick.brown.foxä¸åŒ¹é…ä»»ä½•ç»‘å®šä¸ä¼šè¢«ä»»ä½•é˜Ÿåˆ—æ¥æ”¶åˆ°ä¼šè¢«ä¸¢å¼ƒ</span></span><br><span class="line"><span class="comment">        quick.orange.male.rabbitæ˜¯å››ä¸ªå•è¯ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¼šè¢«ä¸¢å¼ƒ</span></span><br><span class="line"><span class="comment">        lazy.orange.male.rabbit æ˜¯å››ä¸ªå•è¯ä½†åŒ¹é…Q2</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Map&lt;String,String&gt; map  = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;quick.orange.rabbit&quot;</span>,<span class="string">&quot;è¢«é˜Ÿåˆ—Q1Q2æ¥å—åˆ°&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;lazy.orange.elephant&quot;</span>,<span class="string">&quot;è¢«é˜Ÿåˆ—Q1Q2æ¥å—åˆ°&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;quick.orange.fox&quot;</span>,<span class="string">&quot;è¢«é˜Ÿåˆ—Q1æ¥å—åˆ°&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;lazy.brown.fox&quot;</span>,<span class="string">&quot;è¢«é˜Ÿåˆ—Q2æ¥å—åˆ°&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;lazy.pink.rabbit&quot;</span>,<span class="string">&quot;è™½ç„¶æ»¡è¶³ä¸¤ä¸ªç»‘å®šä½†åªè¢«é˜Ÿåˆ—Q2æ¥å—ä¸€æ¬¡&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;quick.brown.fox&quot;</span>,<span class="string">&quot;ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¸ä¼šè¢«ä»»ä½•é˜Ÿåˆ—æ¥æ”¶åˆ°ä¼šè¢«ä¸¢å¼ƒ&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;quick.orange.male.rabbit&quot;</span>,<span class="string">&quot;æ˜¯å››ä¸ªå•è¯ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¼šè¢«ä¸¢å¼ƒ&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;lazy.orange.male.rabbit&quot;</span>,<span class="string">&quot;æ˜¯å››ä¸ªå•è¯ä½†åŒ¹é…Q2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String,  String&gt; mapEntry : map.entrySet()) &#123;</span><br><span class="line">           <span class="type">String</span> <span class="variable">routingKey</span> <span class="operator">=</span> mapEntry.getKey();</span><br><span class="line">           <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> mapEntry.getValue();</span><br><span class="line">            channel.basicPublish(EXCHANGE_NAME,routingKey,<span class="literal">null</span>,message.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼š &quot;</span> + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼š æ˜¯å››ä¸ªå•è¯ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¼šè¢«ä¸¢å¼ƒ</p><p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼š ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¸ä¼šè¢«ä»»ä½•é˜Ÿåˆ—æ¥æ”¶åˆ°ä¼šè¢«ä¸¢å¼ƒ</p><p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼š è¢«é˜Ÿåˆ—Q1Q2æ¥å—åˆ°</p><p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼š è¢«é˜Ÿåˆ—Q2æ¥å—åˆ°</p><p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼š è¢«é˜Ÿåˆ—Q1Q2æ¥å—åˆ°</p><p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼š è¢«é˜Ÿåˆ—Q1æ¥å—åˆ°</p><p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼š è™½ç„¶æ»¡è¶³ä¸¤ä¸ªç»‘å®šä½†åªè¢«é˜Ÿåˆ—Q2æ¥å—ä¸€æ¬¡</p><p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ï¼š æ˜¯å››ä¸ªå•è¯ä½†åŒ¹é…Q2</p></blockquote><h2 id="æ­»ä¿¡é˜Ÿåˆ—">æ­»ä¿¡é˜Ÿåˆ—</h2><p>æ­»ä¿¡ï¼š<strong>é¡¾åæ€ä¹‰å°±æ˜¯æ— æ³•è¢«æ¶ˆè´¹çš„æ¶ˆæ¯</strong>ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œproductå°†æ¶ˆæ¯æŠ•é€’åˆ°brokeræˆ–è€…ç›´æ¥åˆ°queueé‡Œï¼Œconsumerä»queueå–å‡ºæ¶ˆæ¯ï¼Œè¿›è¡Œæ¶ˆè´¹ï¼Œä½†æŸäº›æ—¶å€™ç”±äºç‰¹å®šçš„<strong>åŸå› å¯¼è‡´queueä¸­çš„æŸäº›æ¶ˆæ¯æ— æ³•è¢«æ¶ˆè´¹</strong>ï¼Œè¿™æ ·çš„æ¶ˆæ¯å¦‚æœæ²¡æœ‰åç»­çš„å¤„ç†ï¼Œå°±å˜æˆæ­»ä¿¡ï¼Œæœ‰æ­»ä¿¡è‡ªç„¶å°±æœ‰æ­»ä¿¡é˜Ÿåˆ—ã€‚</p><p>ä¸€èˆ¬åº”ç”¨åœºæ™¯ï¼šä¸ºäº†ä¿è¯è®¢å•ä¸šåŠ¡ä¸­çš„æ¶ˆæ¯æ•°æ®ä¸ä¸¢å¤±ï¼Œéœ€è¦ä½¿ç”¨rabbitMQçš„æ­»ä¿¡é˜Ÿåˆ—æœºåˆ¶ï¼Œ<strong>å½“æ¶ˆæ¯æ¶ˆè´¹å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™ï¼Œå°†æ¶ˆæ¯æŠ•å…¥æ­»ä¿¡é˜Ÿåˆ—ä¸­</strong>ï¼Œè¿˜æœ‰æ¯”å¦‚è¯´ï¼š<strong>ç”¨æˆ·åœ¨å•†åœºä¸‹å•æˆåŠŸå¹¶ç‚¹å‡»å»æ”¯ä»˜ååœ¨æŒ‡å®šæ—¶é—´æœªæ”¯ä»˜æ—¶è‡ªåŠ¨å¤±æ•ˆã€‚</strong></p><h3 id="æ­»ä¿¡çš„æ¥æº"><strong>æ­»ä¿¡çš„æ¥æº</strong></h3><ul><li>æ¶ˆæ¯TTLè¿‡æœŸ</li><li>é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦ï¼ˆé˜Ÿåˆ—æ»¡äº†ï¼Œæ— æ³•å†æ·»åŠ æ•°æ®åˆ°mqä¸­ï¼‰</li><li>æ¶ˆæ¯è¢«æ‹’ç»ï¼ˆbasic.rejectæˆ–basic.nackï¼‰å¹¶ä¸”requeue= false;</li></ul><h3 id="æ­»ä¿¡å®æˆ˜">æ­»ä¿¡å®æˆ˜</h3><p><img src="1667484959170.png" alt="1667484959170"></p><h4 id="æ¶ˆæ¯TTLè¿‡æœŸ">æ¶ˆæ¯TTLè¿‡æœŸ</h4><p><img src="1667490459734.png" alt="1667490459734"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment"> ä¹‹ç”Ÿäº§è€…ä»£ç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="comment">//æ™®é€šäº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">        <span class="comment">//æ­»ä¿¡æ¶ˆæ¯ï¼Œè®¾ç½®TTLæ—¶é—´</span></span><br><span class="line">        AMQP.<span class="type">BasicProperties</span> <span class="variable">properties</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">AMQP</span>.BasicProperties()</span><br><span class="line">                        .builder().expiration(<span class="string">&quot;10000&quot;</span>).build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">11</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;info &quot;</span>+ i;</span><br><span class="line">            channel.basicPublish(NORMAL_EXCHANGE,<span class="string">&quot;zhangsan&quot;</span>,properties,message.getBytes());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ­»ä¿¡</span></span><br><span class="line"><span class="comment">    æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer01</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ™®é€šäº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//æ­»ä¿¡äº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">static</span>  <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//æ™®é€šé˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">NORMAL_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;normal_queue&quot;</span>;</span><br><span class="line">    <span class="comment">//æ­»ä¿¡é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">DEAD_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;dead_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å£°æ˜æ­»ä¿¡å’Œæ™®é€šäº¤æ¢æœºç±»å‹ direct</span></span><br><span class="line">        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        channel.exchangeDeclare(DEAD_EXCHANGE,BuiltinExchangeType.DIRECT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ™®é€šé˜Ÿåˆ—</span></span><br><span class="line">        Map&lt;String,Object&gt; argument = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//è¿‡æœŸæ—¶é—´10ç§’è¿‡æœŸ   å¯ä»¥ä¸è®¾ç½®ï¼Œå¯ä»¥äº¤ç»™é˜Ÿåˆ—è‡ªåŠ¨å»</span></span><br><span class="line">       <span class="comment">// argument.put(&quot;x-message-ttl&quot;,100000);</span></span><br><span class="line">        <span class="comment">//æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        argument.put(<span class="string">&quot;x-dead-lettle-exchange&quot;</span>,DEAD_EXCHANGE);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ­»ä¿¡RoutingKey</span></span><br><span class="line">        argument.put(<span class="string">&quot;x-dead-lettle-routing-key&quot;</span>,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line"></span><br><span class="line">        channel.queueDeclare(NORMAL_QUEUE,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,argument);</span><br><span class="line"></span><br><span class="line">        <span class="comment">///////////////////////////////////</span></span><br><span class="line">        <span class="comment">//å£°åæ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueDeclare(DEAD_QUEUE,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»‘å®šæ™®é€šäº¤æ¢æœºå’Œæ™®é€šé˜Ÿåˆ—</span></span><br><span class="line">        channel.queueBind(NORMAL_QUEUE,NORMAL_EXCHANGE,<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        <span class="comment">//ç»‘å®šæ­»ä¿¡çš„äº¤æ¢æœºä¸æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueBind(DEAD_QUEUE,DEAD_EXCHANGE,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥å—......&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»‘å®šæ­»ä¿¡çš„äº¤æ¢æœºå’Œæ­»ä¿¡çš„å¯¹åˆ—</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer,message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Consumer 01æ¥å—åˆ°æ¶ˆæ¯æ˜¯ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        channel.basicConsume(NORMAL_QUEUE,<span class="literal">true</span>,deliverCallback,consumer-&gt;&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer02</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ­»ä¿¡é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">DEAD_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;dead_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥å—......&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»‘å®šæ­»ä¿¡çš„äº¤æ¢æœºå’Œæ­»ä¿¡çš„å¯¹åˆ—</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer,message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Consumer 02æ¥å—åˆ°æ¶ˆæ¯æ˜¯ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        channel.basicConsume(DEAD_QUEUE,<span class="literal">true</span>,deliverCallback,consumer-&gt;&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>==è§£å†³è¿›ä¸å»æ­»ä¿¡é˜Ÿåˆ—çš„åŸå› äº†ï¼Œå°±æ˜¯æˆ‘æ²¡ç»™ä»–æŠŠè¿‡æœŸæ—¶é—´å€¼ä¼ è¿›å»ï¼Œå¯¼è‡´å‡ºç°é—®é¢˜ã€‚==</p><h4 id="é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦">é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦</h4><p>æ¶ˆæ¯ç”Ÿæˆè€…ä»£ç å»æ‰TTLå±æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer01</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ™®é€šäº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//æ­»ä¿¡äº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">static</span>  <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//æ™®é€šé˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">NORMAL_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;normal_queue&quot;</span>;</span><br><span class="line">    <span class="comment">//æ­»ä¿¡é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">DEAD_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;dead_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å£°æ˜æ­»ä¿¡å’Œæ™®é€šäº¤æ¢æœºç±»å‹ direct</span></span><br><span class="line">        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        channel.exchangeDeclare(DEAD_EXCHANGE,BuiltinExchangeType.DIRECT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ™®é€šé˜Ÿåˆ—</span></span><br><span class="line">        Map&lt;String,Object&gt; argument = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//è¿‡æœŸæ—¶é—´10ç§’è¿‡æœŸ   å¯ä»¥ä¸è®¾ç½®ï¼Œå¯ä»¥äº¤ç»™é˜Ÿåˆ—è‡ªåŠ¨å»</span></span><br><span class="line">       <span class="comment">// argument.put(&quot;x-message-ttl&quot;,10000);</span></span><br><span class="line">        <span class="comment">//æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        argument.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>,DEAD_EXCHANGE);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ­»ä¿¡RoutingKey</span></span><br><span class="line">        argument.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®æ­£å¸¸é˜Ÿåˆ—çš„é•¿åº¦çš„é™åˆ¶</span></span><br><span class="line">        argument.put(<span class="string">&quot;x-max-length&quot;</span>,<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        channel.queueDeclare(NORMAL_QUEUE,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,argument);</span><br><span class="line"></span><br><span class="line">        <span class="comment">///////////////////////////////////</span></span><br><span class="line">        <span class="comment">//å£°åæ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueDeclare(DEAD_QUEUE,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»‘å®šæ™®é€šäº¤æ¢æœºå’Œæ™®é€šé˜Ÿåˆ—</span></span><br><span class="line">        channel.queueBind(NORMAL_QUEUE,NORMAL_EXCHANGE,<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        <span class="comment">//ç»‘å®šæ­»ä¿¡çš„äº¤æ¢æœºä¸æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueBind(DEAD_QUEUE,DEAD_EXCHANGE,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥å—......&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»‘å®šæ­»ä¿¡çš„äº¤æ¢æœºå’Œæ­»ä¿¡çš„å¯¹åˆ—</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer,message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Consumer 01æ¥å—åˆ°æ¶ˆæ¯æ˜¯ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        channel.basicConsume(NORMAL_QUEUE,<span class="literal">true</span>,deliverCallback,consumer-&gt;&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="comment">//æ™®é€šäº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">        <span class="comment">//æ­»ä¿¡æ¶ˆæ¯ï¼Œè®¾ç½®TTLæ—¶é—´ å•ä½æ˜¯ms</span></span><br><span class="line">     <span class="comment">//   AMQP.BasicProperties properties =</span></span><br><span class="line">      <span class="comment">//          new AMQP.BasicProperties()</span></span><br><span class="line">                        <span class="comment">//.builder().expiration(&quot;10000&quot;).build();</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">11</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;info &quot;</span>+ i;</span><br><span class="line">            channel.basicPublish(NORMAL_EXCHANGE,<span class="string">&quot;zhangsan&quot;</span>,properties,message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯:&quot;</span>+message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="1667535036010.png" alt="1667535036010"></p><h4 id="æ¶ˆæ¯è¢«æ‹’ç»">æ¶ˆæ¯è¢«æ‹’ç»</h4><p>ä¸€æ—¦æ¶ˆè´¹è€…æ‹’ç»æ¥å—ï¼Œå°±ä¼šæˆä¸ºæ­»ä¿¡é˜Ÿåˆ—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="comment">//æ™®é€šäº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">        <span class="comment">//æ­»ä¿¡æ¶ˆæ¯ï¼Œè®¾ç½®TTLæ—¶é—´ å•ä½æ˜¯ms</span></span><br><span class="line">      <span class="comment">//æ¼”ç¤ºé•¿åº¦  AMQP.BasicProperties properties =</span></span><br><span class="line">         <span class="comment">//   new AMQP.BasicProperties()</span></span><br><span class="line">           <span class="comment">//             .builder().expiration(&quot;10000&quot;).build();</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">11</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;info &quot;</span>+ i;                        <span class="comment">//properties</span></span><br><span class="line">            channel.basicPublish(NORMAL_EXCHANGE,<span class="string">&quot;zhangsan&quot;</span>,<span class="literal">null</span>,message.getBytes());</span><br><span class="line">            System.out.println(<span class="string">&quot;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯:&quot;</span>+message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer01</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ™®é€šäº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">NORMAL_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;normal_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//æ­»ä¿¡äº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">static</span>  <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//æ™®é€šé˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">NORMAL_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;normal_queue&quot;</span>;</span><br><span class="line">    <span class="comment">//æ­»ä¿¡é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">DEAD_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;dead_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å£°æ˜æ­»ä¿¡å’Œæ™®é€šäº¤æ¢æœºç±»å‹ direct</span></span><br><span class="line">        channel.exchangeDeclare(NORMAL_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class="line">        channel.exchangeDeclare(DEAD_EXCHANGE,BuiltinExchangeType.DIRECT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ™®é€šé˜Ÿåˆ—</span></span><br><span class="line">        Map&lt;String,Object&gt; argument = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//è¿‡æœŸæ—¶é—´10ç§’è¿‡æœŸ   å¯ä»¥ä¸è®¾ç½®ï¼Œå¯ä»¥äº¤ç»™é˜Ÿåˆ—è‡ªåŠ¨å»</span></span><br><span class="line">       <span class="comment">// argument.put(&quot;x-message-ttl&quot;,10000);</span></span><br><span class="line">        <span class="comment">//æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        argument.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>,DEAD_EXCHANGE);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ­»ä¿¡RoutingKey</span></span><br><span class="line">        argument.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è®¾ç½®æ­£å¸¸é˜Ÿåˆ—çš„é•¿åº¦çš„é™åˆ¶</span></span><br><span class="line">      <span class="comment">//æ¼”ç¤ºæ‹’ç»  argument.put(&quot;x-max-length&quot;,6);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        channel.queueDeclare(NORMAL_QUEUE,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,argument);</span><br><span class="line"></span><br><span class="line">        <span class="comment">///////////////////////////////////</span></span><br><span class="line">        <span class="comment">//å£°åæ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueDeclare(DEAD_QUEUE,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">false</span>,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»‘å®šæ™®é€šäº¤æ¢æœºå’Œæ™®é€šé˜Ÿåˆ—</span></span><br><span class="line">        channel.queueBind(NORMAL_QUEUE,NORMAL_EXCHANGE,<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        <span class="comment">//ç»‘å®šæ­»ä¿¡çš„äº¤æ¢æœºä¸æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line">        channel.queueBind(DEAD_QUEUE,DEAD_EXCHANGE,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥å—......&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»‘å®šæ­»ä¿¡çš„äº¤æ¢æœºå’Œæ­»ä¿¡çš„å¯¹åˆ—</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer,message)-&gt;&#123;</span><br><span class="line">       <span class="comment">//æ‹’ç»æ¶ˆæ¯åœ¨è¿™é‡Œå†™</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">message1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">           <span class="comment">//æŒ‡å®šä½ è¦æ‹’ç»çš„æ¶ˆæ¯</span></span><br><span class="line">            <span class="keyword">if</span>(message1.equals(<span class="string">&quot;info 5&quot;</span>))&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ­¤æ¶ˆæ¯æ˜¯è¢«æ‹’ç»çš„&quot;</span>+ message1);</span><br><span class="line">                <span class="comment">//æ‹’æ¥æ¥æ”¶ï¼Œä¸”ä¸æ”¾å›é˜Ÿåˆ—ï¼Œé¿å…é˜Ÿåˆ—é‡æ–°å‘é€</span></span><br><span class="line">                channel.basicReject(message.getEnvelope().getDeliveryTag(),<span class="literal">false</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">                System.out.println(<span class="string">&quot;Consumer 01æ¥å—åˆ°æ¶ˆæ¯æ˜¯ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">               <span class="comment">//   æ¥æ”¶ä¸”ä¸æ”¾å›</span></span><br><span class="line">                channel.basicAck(message.getEnvelope().getDeliveryTag(),<span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//å¼€å¯æ‰‹åŠ¨åº”ç­”,                      //trueæ˜¯è‡ªåŠ¨åº”ç­”ã€‚</span></span><br><span class="line">        channel.basicConsume(NORMAL_QUEUE,<span class="literal">false</span>,deliverCallback,consumer-&gt;&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer02</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">static</span>  <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEAD_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;dead_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ­»ä¿¡é˜Ÿåˆ—åç§°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">DEAD_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;dead_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> GetConnection.getChannel();</span><br><span class="line">        channel.queueBind(DEAD_QUEUE,DEAD_EXCHANGE,<span class="string">&quot;lisi&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ¥å—......&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç»‘å®šæ­»ä¿¡çš„äº¤æ¢æœºå’Œæ­»ä¿¡çš„å¯¹åˆ—</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumer,message)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Consumer 02æ¥å—åˆ°æ¶ˆæ¯æ˜¯ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody(),<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(DEAD_QUEUE,<span class="literal">true</span>,deliverCallback,consumer-&gt;&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å»¶è¿Ÿé˜Ÿåˆ—">å»¶è¿Ÿé˜Ÿåˆ—</h2><p>å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå¯¹åˆ—å†…éƒ¨æ˜¯æœ‰åºçš„ï¼Œæœ€é‡è¦çš„ç‰¹æ€§å°±æ˜¯ä½“ç°åœ¨ä»–çš„å»¶æ—¶å±æ€§ä¸Šï¼Œå»¶æ—¶é˜Ÿåˆ—ä¸­çš„å…ƒç´ æ—¶å¸Œæœ›åœ¨æŒ‡å®šæ—¶é—´åˆ°äº†ä¹‹åæˆ–è€…ä¹‹å‰å–å‡ºå’Œå¤„ç†ï¼Œç®€å•çš„æ¥è¯´ï¼Œå»¶è¿Ÿé˜Ÿåˆ—å°±æ˜¯ç”¨æ¥å­˜æ”¾éœ€è¦åœ¨æŒ‡å®šæ—¶é—´è¢«å¤„ç†çš„å…ƒç´ çš„é˜Ÿåˆ—ã€‚</p><p><strong>å»¶è¿Ÿé˜Ÿåˆ—çš„ä½¿ç”¨åœºæ™¯</strong></p><ol><li>è®¢å•åœ¨ååˆ†é’Ÿå†…æœªæ”¯ä»˜åˆ™è‡ªåŠ¨å–æ¶ˆ</li><li>æ–°åˆ›å»ºçš„åº—é“ºï¼Œå¦‚æœåœ¨åå¤©å†…æ²¡æœ‰ä¸Šä¼ å•†å“ï¼Œåˆ™è‡ªåŠ¨å‘é€æ¶ˆæ¯æé†’</li><li>ç”¨æˆ·æ³¨å†ŒæˆåŠŸåï¼Œå¦‚æœæ²¡æœ‰åœ¨ä¸‰å¤©å†…ç™»å½•åˆ™å‘é€çŸ­ä¿¡æé†’æ¶ˆæ¯</li><li>ç”¨æˆ·å‘èµ·é€€æ¬¾ï¼Œå¦‚æœåœ¨ä¸‰å¤©å†…æ²¡æœ‰å¾—åˆ°å¤„ç†åˆ™é€šçŸ¥ç›¸å…³è¿è¥äººå‘˜ã€‚</li><li>é¢„å®šä¼šå‘˜åï¼Œéœ€è¦åœ¨é¢„å®šçš„æ—¶é—´ç‚¹å‰ååˆ†é’Ÿé€šçŸ¥å„ä¸ªä¸ä¼šå‘˜äººå‘˜å‚åŠ ä¼šè®®ã€‚</li></ol><h3 id="å»¶è¿Ÿé˜Ÿåˆ—æ•´åˆSpringBoot">å»¶è¿Ÿé˜Ÿåˆ—æ•´åˆSpringBoot</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xh<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>SpringBoot_RabbitMQ<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>SpringBoot_RabbitMQ<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>SpringBoot_RabbitMQ<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>2.3.7.RELEASE<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--rabbitMQä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.83<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.24<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--swagger--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--RabbitMQæµ‹è¯•ä¾èµ– --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.amqp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-rabbit-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.xh.springBoot.SpringBootRabbitMqApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">webApiConfig</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .groupName(<span class="string">&quot;webApi&quot;</span>)</span><br><span class="line">                .apiInfo(webApiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">webApiInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;rabbitMQæ¥å£æ–‡æ¡£&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;æè¿°Rabbitå¾®æœåŠ¡æ¥å£å®šä¹‰&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;æˆ‘å–œæ¬¢&quot;</span>,<span class="string">&quot;127.0.0.1&quot;</span>,<span class="string">&quot;2844****670@qq.com&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="é˜Ÿåˆ—TTL">é˜Ÿåˆ—TTL</h3><p>åˆ›å»ºä¸¤ä¸ªé˜Ÿåˆ—QAå’ŒQBï¼Œä¸¤è€…é˜Ÿåˆ—TTLåˆ†è¢«æ˜¯10sï¼Œ40s,ç„¶ååœ¨åˆ›å»ºä¸€ä¸ªäº¤æ¢æœºXå’Œæ­»ä¿¡äº¤æ¢æœºYï¼Œä»–ä»¬çš„ç±»å‹éƒ½æ˜¯directï¼Œåˆ›å»ºä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ—QDï¼Œä»–ä»¬çš„ç»‘å®šå…³ç³»å¦‚ä¸‹</p><p><img src="1667568947336.png" alt="1667568947336"></p><p>ä»£ç æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">TTL é˜Ÿåˆ—  é…ç½®æ–‡ä»¶ç±»ä»£ç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TtlQueueConfig</span> &#123;</span><br><span class="line">    <span class="comment">//æ™®é€šçš„äº¤æ¢æœºåç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">X_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;X&quot;</span>;</span><br><span class="line">    <span class="comment">//æ­»ä¿¡äº¤æ¢æœºçš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">Y_DEAD_LETTER_EXCHANGE</span> <span class="operator">=</span> <span class="string">&quot;Y&quot;</span>;</span><br><span class="line">    <span class="comment">//æ™®é€šé˜Ÿåˆ—çš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">A_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;QA&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">B_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;QB&quot;</span>;</span><br><span class="line">    <span class="comment">//æ­»ä¿¡é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">Y_DEAD_LETTER_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;QD&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å£°æ˜XCHANGE</span></span><br><span class="line">    <span class="meta">@Bean(&quot;xExchange&quot;)</span>  <span class="comment">//èµ·åˆ«å</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">xExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(X_EXCHANGE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å£°æ˜yExchange åˆ«å</span></span><br><span class="line">    <span class="meta">@Bean(&quot;yExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">yExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line">    <span class="meta">@Bean(&quot;queueA&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queueA</span><span class="params">()</span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map  =<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//è®¾ç½®æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        map.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>,Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ­»ä¿¡RoutingKey</span></span><br><span class="line">        map.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="string">&quot;YD&quot;</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®TTLå•ä½æ˜¯ms  ä»€ä¹ˆæ—¶å€™æ¶ˆæ¯æˆä¸ºæ­»ä¿¡ï¼Œ10ç§’é’Ÿå</span></span><br><span class="line">        map.put(<span class="string">&quot;x-message-ttl&quot;</span>,<span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(A_QUEUE).withArguments(map).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å£°æ˜é˜Ÿåˆ—</span></span><br><span class="line">    <span class="meta">@Bean(&quot;queueB&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queueB</span><span class="params">()</span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map  =<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//è®¾ç½®æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        map.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>,Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ­»ä¿¡RoutingKey</span></span><br><span class="line">        map.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="string">&quot;YD&quot;</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®TTLå•ä½æ˜¯ms  ä»€ä¹ˆæ—¶å€™æ¶ˆæ¯æˆä¸ºæ­»ä¿¡ï¼Œ40ç§’é’Ÿå</span></span><br><span class="line">        map.put(<span class="string">&quot;x-message-ttl&quot;</span>,<span class="number">40000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(B_QUEUE).withArguments(map).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ­»ä¿¡é˜Ÿåˆ—</span></span><br><span class="line">    <span class="meta">@Bean(&quot;queueD&quot;)</span></span><br><span class="line">    <span class="keyword">public</span>  Queue <span class="title function_">QueueD</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(Y_DEAD_LETTER_QUEUE).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç»‘å®š</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueABindingX</span><span class="params">(<span class="meta">@Qualifier(&quot;queueA&quot;)</span> Queue queueA,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange xExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueA).to(xExchange).with(<span class="string">&quot;XA&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç»‘å®š</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueBBindingX</span><span class="params">(<span class="meta">@Qualifier(&quot;queueB&quot;)</span> Queue queueB,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange xExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueB).to(xExchange).with(<span class="string">&quot;XB&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç»‘å®š</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueDBindingX</span><span class="params">(<span class="meta">@Qualifier(&quot;queueD&quot;)</span> Queue queueD,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@Qualifier(&quot;yExchange&quot;)</span> DirectExchange yExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueD).to(yExchange).with(<span class="string">&quot;YD&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å‘é€å»¶è¿Ÿæ¶ˆæ¯</span></span><br><span class="line"><span class="comment">http://åœ°å€/ttl/sendMessage/å­éå¾å–µ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span> <span class="comment">//æ‰“å°æ—¥å¿—</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/ttl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SellMessageController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¼€å§‹å‘é€æ¶ˆæ¯</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendMessage/&#123;message&#125;&quot;)</span></span><br><span class="line">    <span class="comment">//æ³¨æ„@PathVariable å¯ä»¥è‡ªå®šä¹‰ä¼ å€¼åˆ°urlä¸­ï¼Œå‰æç¤ºå˜é‡åå¿…é¡»å’Œurlä¸­çš„ä¸€æ ·</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(<span class="meta">@PathVariable</span> String message)</span>&#123;</span><br><span class="line">        <span class="comment">//åè¾¹çš„è¯­å¥å‚æ•°ä¼šæ›¿æ¢&#123;&#125;ï¼Œè¿™ç”±ç¨‹åºå‘˜æ§åˆ¶</span></span><br><span class="line">        log.info(<span class="string">&quot;å½“å‰æ—¶é—´:&#123;&#125;,å‘é€ä¸€æ¡ä¿¡æ¯ç»™ä¸¤ä¸ªTTLé˜Ÿåˆ—:&#123;&#125;&quot;</span>,<span class="keyword">new</span> <span class="title class_">Date</span>().toString(),message);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;X&quot;</span>,<span class="string">&quot;XA&quot;</span>,<span class="string">&quot;æ¶ˆæ¯æ¥è‡ªttlä¸º10ç§’çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼š&quot;</span> + message);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;X&quot;</span>,<span class="string">&quot;XB&quot;</span>,<span class="string">&quot;æ¶ˆæ¯æ¥è‡ªttlä¸º40ç§’çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼š&quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="http://127.0.0.1:8080/ttl/sendMessage/hello1">http://127.0.0.1:8080/ttl/sendMessage/hello1</a></p><p><a href="http://127.0.0.1:8080/ttl/sendMessage/hello2">http://127.0.0.1:8080/ttl/sendMessage/hello2</a></p><p><img src="1667659942059.png" alt="1667659942059"></p><p>ä¸Šè¿°å­˜åœ¨ä¸€ä¸ªä¸è¶³ä¹‹å¤„ï¼Œå°±æ˜¯æˆ‘ä»¬<strong>æ¯æ¬¡ä½¿ç”¨çš„æ—¶å€™ï¼Œéƒ½éœ€è¦å¢åŠ ä¸€ä¸ªæ–°çš„æ—¶é—´éœ€æ±‚ï¼Œå°±éœ€è¦æ–°å¢ä¸€ä¸ªé˜Ÿåˆ—</strong>ï¼Œè¿™é‡Œåªæ˜¯ç”¨äº†10så’Œ40sä¸¤ä¸ªæ—¶é—´é€‰é¡¹ï¼Œä½†ä¸‡ä¸€æˆ‘è¦ä¸€ä¸ªå°æ—¶å‘¢ï¼Œéš¾ä¸æˆè¿˜åˆè¦æ·»åŠ ï¼Œè¿™æ ·å¤ªéº»çƒ¦äº†ã€‚</p><h3 id="å»¶è¿Ÿé˜Ÿåˆ—ä¼˜åŒ–">å»¶è¿Ÿé˜Ÿåˆ—ä¼˜åŒ–</h3><p><img src="1667660011944.png" alt="1667660011944"></p><p>ä½¿ç”¨QCæ¥è®¾ç½®æ—¶é—´ï¼Œç”¨æˆ·è‡ªå®šä¹‰æ—¶é—´ã€‚</p><p>å…·ä½“ä»£ç å¦‚ä¸‹</p><p>TtlQueueConfig.javaä¸­æ·»åŠ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">C_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;QC&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å£°æ˜QC</span></span><br><span class="line">    <span class="meta">@Bean(&quot;queueC&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">queueC</span><span class="params">()</span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        map.put(<span class="string">&quot;x-dead-letter-exchange&quot;</span>,Y_DEAD_LETTER_EXCHANGE);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ­»ä¿¡RoutingKey</span></span><br><span class="line">        map.put(<span class="string">&quot;x-dead-letter-routing-key&quot;</span>,<span class="string">&quot;YD&quot;</span>);</span><br><span class="line">        <span class="comment">//TTLè®¾ç½®æ—¶é•¿  ms (è¿™é‡Œä¸å†™ï¼Œåˆç”¨æˆ·è‡ªå·±å®šä¹‰)</span></span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(C_QUEUE).withArguments(map).build();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç»‘å®š</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueCBindingX</span><span class="params">(<span class="meta">@Qualifier(&quot;queueC&quot;)</span> Queue queueC,</span></span><br><span class="line"><span class="params">                                  <span class="meta">@Qualifier(&quot;xExchange&quot;)</span> DirectExchange xExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueC).to(xExchange).with(<span class="string">&quot;XC&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>â€‹SellMessageController.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¼€å§‹å‘é€æ¶ˆæ¯ æ¶ˆæ¯ TTL</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendExpirationMsg/&#123;message&#125;/&#123;ttlTime&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@PathVariable</span> String message,<span class="meta">@PathVariable</span> String ttlTime)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;å½“å‰æ—¶é—´ï¼š&#123;&#125;ï¼Œå‘é€ä¸€æ¡æ—¶é•¿&#123;&#125;æ¯«ç§’TTLä¿¡æ¯ç»™é˜Ÿåˆ—QC:&#123;&#125;&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Date</span>().toString(),ttlTime,message);</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;X&quot;</span>,<span class="string">&quot;XC&quot;</span>,message,msg -&gt; &#123;</span><br><span class="line">            <span class="comment">//å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå»¶è¿Ÿæ—¶é•¿</span></span><br><span class="line">            msg.getMessageProperties().setExpiration(ttlTime);</span><br><span class="line">            <span class="keyword">return</span> msg;</span><br><span class="line">        &#125; );</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>==æ³¨æ„æˆ‘åœ¨å†™è¿™ä¸ªä»£ç çš„æ—¶å€™ï¼Œåˆšåˆšå¼€å§‹æ˜¯æ•²é”™äº†ä¸€ä¸ªå­—æ¯ï¼Œå¯¼è‡´è¿è¡Œæ—¶ç”Ÿæˆçš„é˜Ÿåˆ—ï¼Œç„¶åè°ƒé”™çš„æ—¶å€™ï¼Œéœ€è¦ç”Ÿæˆçš„é˜Ÿåˆ—åˆ é™¤ï¼Œç„¶åé‡æ–°åˆ›å»ºï¼Œå¯ä»¥è§£å†³é—®é¢˜ã€‚ã€‚==</p><p><img src="1667661762605.png" alt="1667661762605"></p><pre><code>&gt;http://127.0.0.1:8080/ttl/sendExpirationMsg/hello1/2000&gt;&gt;http://127.0.0.1:8080/ttl/sendExpirationMsg/hello2/20000</code></pre><p>æ­»ä¿¡åœ¨åšå»¶è¿Ÿçš„ä¸€ä¸ªå·¨å¤§ç¼ºé™·ï¼Œæ¶ˆæ¯ä¸ä¼šæŒ‰æ—¶â€œæ­»äº¡â€ï¼Œç”±äº<strong>RabbitMQåªä¼šæ£€æŸ¥ç¬¬ä¸€ä¸ªæ¶ˆæ¯æ˜¯å¦è¿‡æœŸ</strong>ï¼Œå¦‚æœè¿‡æœŸåˆ™ä¸¢åˆ°æ­»ä¿¡é˜Ÿåˆ—ï¼Œ<strong>å¦‚æœç¬¬ä¸€ä¸ªæ¶ˆæ¯çš„å»¶æ—¶æ—¶é•¿å¾ˆé•¿ï¼Œè€Œç¬¬äºŒä¸ªæ¶ˆæ¯çš„å»¶è¿Ÿæ—¶é•¿å¾ˆçŸ­ï¼Œåˆ™ç¬¬äºŒä¸ªæ¶ˆæ¯å¹¶ä¸ä¼šä¼˜å…ˆå¾—åˆ°æ‰§è¡Œã€‚</strong></p><p>è¿™é‡Œå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå½“å‡ºç°ä¸¤æ¡æ¶ˆæ¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬å‘ç°ï¼Œä»–å±…ç„¶æ˜¯æŒ‰ç…§è°å…ˆæ¥çš„ï¼Œå“ªæ€•ä½ æ—¶é—´çŸ­ï¼Œä½†æ˜¯ä½ æ¯”å¦ä¸€ä¸ªé˜Ÿåˆ—æ…¢ä¸€æ­¥ï¼Œä½ å°±åªèƒ½è€è€å®å®æ’é˜Ÿäº†ã€‚<img src="1667661985681.png" alt="1667661985681"></p><h3 id="RabbitMQæ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—">RabbitMQæ’ä»¶å®ç°å»¶è¿Ÿé˜Ÿåˆ—</h3><p>è¿™ä¸ªå°±æ˜¯è§£å†³ä¸Šè¾¹çš„é—®é¢˜çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨æ’ä»¶è§£å†³ã€‚</p><p>åœ¨å®˜ç½‘ä¸Šä¸‹è½½: <a href="https://www/rabbitmq.com/community-plugins.html%EF%BC%8C%E4%B8%8B%E8%BD%BD">https://www/rabbitmq.com/community-plugins.htmlï¼Œä¸‹è½½</a></p><p>rabbitmq_delayed_message_exchange-3.8.0</p><p>æ‹·è´åˆ°</p><p>/usr/lib/rabbitmq/lib/rabbitmq_server-ç‰ˆæœ¬å·/plugs</p><p>å®‰è£…æŒ‡ä»¤</p><p><code>rabbitmq-plugins enable rabbitmq_delayed_message_exchange</code></p><p>ç„¶ååœ¨linuxç³»ç»Ÿä¸‹è§£å‹</p><p>ç„¶åå®‰è£…<code>rabbitmq-plugins enable rabbitmq_delayed_message_exchange</code></p><p>ä¹‹åé‡å¯</p><p><code>systemctl restart rabbitmq-server(è¿™ä¸ªæ˜¯ä½ å®‰è£…æ—¶å€™çš„åå­—)</code></p><p><img src="1667662710885.png" alt="1667662710885"></p><p>è¿™ä¸ªæ—¶å€™ä¸åœ¨æ˜¯é˜Ÿåˆ—ï¼Œè€Œæ˜¯äº¤æ¢æœºäº†ã€‚</p><p><strong>æ²¡æ’ä»¶çš„æ—¶å€™</strong></p><p><img src="1667662791636.png" alt="1667662791636"></p><p><strong>åŸºäºæ’ä»¶çš„</strong></p><p><img src="1667662831411.png" alt="1667662831411"></p><p>==æ³¨æ„ï¼Œç”±äºæˆ‘æ˜¯dockerå®‰è£…çš„ï¼Œæˆ‘æ²¡æ‰¾åˆ°å®‰è£…è¿™ä¸ªæ’ä»¶çš„ä½ç½®ï¼Œæ•…è€Œï¼Œè¿™ä¸€ç‚¹ï¼Œæˆ‘åªèƒ½æ•²ä¸€ä¸‹ä»£ç äº†è§£ä¸€ä¸‹==</p><p>è§£å†³åŠæ³•ï¼š</p><p><a href="https://blog.csdn.net/DZP_dream/article/details/118391439">https://blog.csdn.net/DZP_dream/article/details/118391439</a></p><p><code>docker search rabbitmq </code></p><p>å®‰è£…æ‹‰å–å®¹å™¨ï¼š</p><p><code>docker run -dit --name rabbitmq -e RABBITMQ_DEFAULT_USER=guest -e RABBITMQ_DEFAULT_PASS=guest -p 15672:15672 -p 5672:5672 rabbitmq:management</code></p><p><a href="https://www.rabbitmq.com/community-plugins.html">https://www.rabbitmq.com/community-plugins.html</a></p><p><code>docker cp rabbitmq_delayed_message_exchange-3.8.0.ez  rabbitmq:/plugins</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="built_in">local</span> rabbitmq]<span class="comment"># docker exec -it rabbitmq /bin/bash                                     </span></span><br><span class="line">root@3bb56f68570b:/<span class="comment"># rabbitmq-plugins list</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨æ’ä»¶</p><p><code>root@3bb56f68570b:/# rabbitmq-plugins enable rabbitmq_delayed_message_exchange</code></p><p>DelayedConfig</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶ï¼Œå¯æƒœï¼Œæˆ‘æ²¡æœ‰ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">//å®ä¾‹åŒ–</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelayedQueueConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é˜Ÿåˆ— //</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">DELAYED_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;delayed.queue&quot;</span>;</span><br><span class="line">    <span class="comment">//äº¤æ¢æœº</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">DELAYED_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;delayed.exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//routingKey</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">DELAYED_ROUTING_KEY</span> <span class="operator">=</span> <span class="string">&quot;delayed.routing&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">delayedQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">new</span> <span class="title class_">Queue</span>(DELAYED_QUEUE_NAME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å£°æ˜äº¤æ¢æœº  åŸºäºæ’ä»¶çš„äº¤æ¢æœºå°±æ˜¯è¿™ä¹ˆå®šä¹‰çš„</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">//è‡ªå®šä¹‰äº¤æ¢æœº ç”±äºæ˜¯ä¸å­˜åœ¨rabbité‡Œè¾¹çš„äº¤æ¢æœºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä½¿ç”¨çš„å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> CustomExchange <span class="title function_">delayedExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;x-delayed-type&quot;</span>,<span class="string">&quot;direct&quot;</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        1.äº¤æ¢æœºåç§°</span></span><br><span class="line"><span class="comment">        2.äº¤æ¢æœºç±»å‹</span></span><br><span class="line"><span class="comment">        3.æ˜¯å¦éœ€è¦æŒä¹…åŒ–</span></span><br><span class="line"><span class="comment">        4.æ˜¯å¦éœ€è¦è‡ªåŠ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">        5.å…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomExchange</span>(DELAYED_EXCHANGE_NAME,<span class="string">&quot;x-delayed-message&quot;</span>,</span><br><span class="line">                <span class="literal">true</span>,<span class="literal">false</span>,map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç»‘å®š</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">delayedQueueBingdingDelayedExchange</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@Qualifier(&quot;delayedQueue&quot;)</span> Queue delayedQueue,</span></span><br><span class="line"><span class="params">            <span class="meta">@Qualifier(&quot;delayedExchange&quot;)</span> CustomExchange delayedExchange</span></span><br><span class="line"><span class="params">    )</span>&#123;</span><br><span class="line">        <span class="comment">//ç»‘å®š å°†é˜Ÿåˆ—å’Œäº¤æ¢æœºç›´æ¥è¿›è¡Œç»‘å®š</span></span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(delayedQueue).to(delayedExchange).with(DELAYED_ROUTING_KEY).noargs();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿäº§è€…ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Title  å‘é€æ¶ˆæ¯  åŸºäºæ’ä»¶çš„ æ¶ˆæ¯ä»¥åŠ å»¶è¿Ÿçš„æ—¶é—´</span></span><br><span class="line"><span class="comment"> * @Description å»¶è¿Ÿé˜Ÿåˆ—çš„æ’ä»¶</span></span><br><span class="line"><span class="comment"> * @author  ç½—å°é»‘</span></span><br><span class="line"><span class="comment"> * @date 2022/11/6 11:40</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/sendDelayMsg/&#123;message&#125;/&#123;delayTime&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendDelayedMsg</span><span class="params">(<span class="meta">@PathVariable</span> String message,<span class="meta">@PathVariable</span> Integer delayedTime)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;å½“å‰æ—¶é—´ï¼š&#123;&#125;ï¼Œå‘é€ä¸€æ¡æ—¶é•¿&#123;&#125;æ¯«ç§’ä¿¡æ¯ç»™å»¶è¿Ÿé˜Ÿåˆ—delayedTime:&#123;&#125;&quot;</span>,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Date</span>().toString(),delayedTime,message);</span><br><span class="line">    rabbitTemplate.convertAndSend(DelayedQueueConfig.DELAYED_EXCHANGE_NAME,</span><br><span class="line">            DelayedQueueConfig.DELAYED_ROUTING_KEY,message, msg -&gt; &#123;</span><br><span class="line">        <span class="comment">//å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå»¶è¿Ÿæ—¶é•¿  å•ä½ms</span></span><br><span class="line">        msg.getMessageProperties().setDelay(delayedTime);</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125; );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¶ˆè´¹è€…ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å»¶è¿Ÿé˜Ÿåˆ—æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DelayedQueueConsumer</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        åŸºäºæ’ä»¶çš„å»¶è¿Ÿé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç›‘å¬æ¶ˆæ¯</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues= DelayedQueueConfig.DELAYED_QUEUE_NAME)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveDelayQueue</span><span class="params">(Message message)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody());</span><br><span class="line">        log.info(<span class="string">&quot;å½“å‰æ—¶é—´ï¼š&#123;&#125;ï¼Œæ”¶åˆ°å»¶è¿Ÿé˜Ÿåˆ—çš„æ¶ˆæ¯ï¼š&#123;&#125;&quot;</span>,<span class="keyword">new</span> <span class="title class_">Date</span>().toString(),msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="http://127.0.0.1:8080/ttl/sendDelayMsg/come">http://127.0.0.1:8080/ttl/sendDelayMsg/come</a> on bady1/20000</p><p><a href="http://127.0.0.1:8080/ttl/sendDelayMsg/come">http://127.0.0.1:8080/ttl/sendDelayMsg/come</a> on bady1/2000</p><p><img src="1667706862118.png" alt="1667706862118"></p><p>ç¬¬äºŒä¸ªæ¶ˆæ¯è¢«å…ˆæ¶ˆè´¹æ‰äº†ï¼Œç¬¦åˆé¢„æœŸã€‚</p><h3 id="æ€»ç»“ï¼š">æ€»ç»“ï¼š</h3><p>å»¶è¿Ÿé˜Ÿåˆ—åœ¨éœ€è¦å»¶æ—¶çš„å¤„ç†çš„åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ï¼Œä½¿ç”¨rabbitmqæ¥å®ç°å»¶è¿Ÿé˜Ÿåˆ—å¯ä»¥å¾ˆå¥½çš„åˆ©ç”¨rabbitmqçš„ç‰¹æ€§ï¼Œ<strong>å¦‚æ¶ˆæ¯çš„å¯é å‘é€ï¼Œæ¶ˆæ¯å¯é æŠ•é€’ï¼Œæ­»ä¿¡é˜Ÿåˆ—æ¥ä¿è¯æ¶ˆæ¯è‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡å·²ç»æœªè¢«æ­£å¸¸å¤„ç†çš„æ¶ˆæ¯ä¸ä¼šè¢«ä¸¢å¼ƒ</strong>ï¼Œå¦å¤–ï¼Œé€šè¿‡rabbitMQé›†ç¾¤çš„ç‰¹æ€§ï¼Œå¯ä»¥å¾ˆå¥½çš„è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼Œä¸ä¼šå› ä¸ºå•ä¸ªèŠ‚ç‚¹æŒ‚æ‰å¯¼è‡´å»¶è¿Ÿé˜Ÿåˆ—ä¸å¯ç”¨æˆ–è€…ä¿¡æ¯ä¸¢å¤±</p><p>å½“ç„¶ï¼Œå»¶è¿Ÿé˜Ÿåˆ—è¿˜æœ‰å¾ˆå¤šå…¶ä»–é€‰æ‹©ï¼Œæ¯”å¦‚åˆ©ç”¨javaçš„delayQueue,åˆ©ç”¨Redisçš„zsetï¼Œåˆ©ç”¨Quartzæˆ–è€…åˆ©ç”¨kafkaçš„æ—¶é—´è½®ï¼Œè¿™äº›æ–¹å¼å„æœ‰å„çš„ç‰¹ç‚¹ï¼Œçœ‹éœ€è¦çš„é€‚ç”¨çš„åœºæ™¯ã€‚</p><h1>é«˜çº§éƒ¨åˆ†ï¼š</h1><h2 id="å‘å¸ƒç¡®è®¤é«˜çº§">å‘å¸ƒç¡®è®¤é«˜çº§</h2><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä¸­ç”±äºä¸€äº›ä¸æ˜çš„åŸå› ï¼Œå¯¼è‡´rabbitmqé‡å¯ï¼Œåœ¨rabbitmq é‡å¯æœŸé—´ç”Ÿäº§è€…æ¶ˆæ¯æŠ•é€’å¤±è´¥ï¼Œå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†å’Œæ¢å¤ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¦‚ä½•ä¿è¯rabbitmqçš„æ¶ˆæ¯çš„å¯é æŠ•é€’å‘¢?</p><p><img src="1667707667491.png" alt="1667707667491"></p><p>é«˜çº§å°±æ˜¯ï¼Œå½“ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ç»™äº¤æ¢æœºï¼Œä½†æ˜¯äº¤æ¢æœºæ”¶ä¸åˆ°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†æ¶ˆæ¯æ”¾åˆ°ç¼“å­˜ä¸­ï¼Œå½“äº¤æ¢æœºå¯ä»¥æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±æŠŠæ¶ˆæ¯ä»ç¼“å­˜ä¸­ç§»é™¤ã€‚ä¸€èˆ¬ä¼šå‡ºç°çš„é—®é¢˜æ˜¯ï¼Œäº¤æ¢æœºæ”¶ä¸åˆ°æ¶ˆæ¯ï¼ŒäºŒæ˜¯é˜Ÿåˆ—æ”¶ä¸åˆ°æ¶ˆæ¯ã€‚</p><p><strong>ä»£ç æ¶æ„éƒ¨åˆ†</strong></p><p><img src="1667707750154.png" alt="1667707750154"></p><p><strong>é…ç½®æ–‡ä»¶</strong></p><p>åœ¨spring.rabbitmq.publisher-confirm-type=correlated</p><p>confirm</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å‘å¸ƒç¡®è®¤é…ç½®ç±»</span></span><br><span class="line"><span class="comment"> ç›®çš„æ˜¯ä¸ºäº† å‘å¸ƒç¡®è®¤ ï¼ˆé«˜çº§ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfirmConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//äº¤æ¢æœº</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span> String CONFIRM_EXCHANGE_NAME= <span class="string">&quot;confirm_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;confirm_queue&quot;</span>;</span><br><span class="line">    <span class="comment">//RoutingKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_ROUTING_KEY</span> <span class="operator">=</span> <span class="string">&quot;key1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å£°æ˜ä¸€ä¸ªäº¤æ¢æœº</span></span><br><span class="line">    <span class="meta">@Bean(&quot;confirmExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">confirmExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">new</span> <span class="title class_">DirectExchange</span>(CONFIRM_EXCHANGE_NAME);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—</span></span><br><span class="line">    <span class="meta">@Bean(&quot;confirmQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">confirmQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(CONFIRM_QUEUE_NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç»‘å®š</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueBindingExchange</span><span class="params">(<span class="meta">@Qualifier(&quot;confirmQueue&quot;)</span> Queue confirmQueue,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@Qualifier(&quot;confirmExchange&quot;)</span> DirectExchange confirmExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(confirmQueue).to(confirmExchange).with(CONFIRM_ROUTING_KEY);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¶ˆè´¹è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    Productæ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = ConfirmConfig.CONFIRM_QUEUE_NAME)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveConfirmMessage</span><span class="params">(Message message)</span>&#123;</span><br><span class="line">       <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody());</span><br><span class="line">        log.info(<span class="string">&quot;æ¥å—åˆ°é˜Ÿåˆ—confirm.queueçš„æ¶ˆæ¯ï¼š &#123;&#125; &quot;</span> ,msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿäº§è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/confirm&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘é€æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendMessage/&#123;message&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(<span class="meta">@PathVariable</span> String message)</span>&#123;</span><br><span class="line">        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME,</span><br><span class="line">                ConfirmConfig.CONFIRM_ROUTING_KEY,message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å›è°ƒæ¥å£</p><p>ä¸€æ—¦æ¶ˆæ¯æ²¡æœ‰è¢«æ¥å—æˆ‘ä»¬é‡‡å–å›è°ƒæ¥å£å»ç¡®å®šã€‚</p><p>NONE</p><p>ç¦ç”¨å‘å¸ƒç¡®è®¤æ¨¡å¼ï¼Œæ˜¯é»˜è®¤å€¼</p><p>CORRELATED</p><p>å‘å¸ƒæ¶ˆæ¯æˆåŠŸåˆ°äº¤æ¢å™¨åä¼šè§¦å‘å›è°ƒæ–¹æ³•</p><p>SIMPLE</p><p>ç»è¿‡æµ‹è¯•æœ‰ä¸¤ç§æ•ˆæœï¼Œå…¶ä¸€æ•ˆæœå’ŒCORRELATEDå€¼ä¸€æ ·ä¼šè§¦å‘å›è°ƒæ–¹æ³•ã€‚</p><p>å…¶äºŒåœ¨å‘å¸ƒæ¶ˆæ¯æˆåŠŸåé‡‡ç”¨rabbitTemplateè°ƒç”¨waitForConfirmsæˆ–waitForConfirmsOrDieæ–¹æ³•ï¼Œç­‰å¾…brokerèŠ‚ç‚¹è¿”å›å‘é€ç»“æœï¼Œæ ¹æ®è¿”å›ç»“æœæ¥åˆ¤å®šä¸‹ä¸€æ­¥çš„é€»è¾‘ï¼Œè¦æ³¨æ„çš„ç‚¹æ˜¯waitForConfirmsOrDieæ–¹æ³•ï¼Œå¦‚æœè¿”å›fasleåˆ™ä¼šå…³é—­channelï¼Œåˆ™æ¥ä¸‹æ¥æ— æ³•å‘é€æ¶ˆæ¯åˆ°broker.</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åº”ç”¨åç§°</span></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">SpringBoot_RabbitMQ</span></span><br><span class="line"><span class="attr">spring.rabbitmq.host</span>=<span class="string">114.132.77.86</span></span><br><span class="line"><span class="attr">spring.rabbitmq.publisher-confirm-type</span>=<span class="string">correlated</span></span><br><span class="line"><span class="attr">spring.rabbitmq.port</span>=<span class="string">5672</span></span><br><span class="line"><span class="attr">spring.rabbitmq.username</span>=<span class="string">guest</span></span><br><span class="line"><span class="attr">spring.rabbitmq.password</span>=<span class="string">guest</span></span><br></pre></td></tr></table></figure><p>å®šä¹‰ä¸€ä¸ªå›è°ƒæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å®šä¹‰ä¸€ä¸ªå›è°ƒæ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//1</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCallBack</span> <span class="keyword">implements</span> <span class="title class_">RabbitTemplate</span>.ConfirmCallback&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”±äºæ˜¯å†…éƒ¨æ¥å£ï¼Œæ•…è€Œä¸èƒ½ç›´æ¥æˆ‘ä»¬å®ç°çš„æ¥å£ï¼Œæˆ‘ä»¬éœ€è¦ç›´æ¥æ³¨å…¥</span></span><br><span class="line">    <span class="comment">//æ³¨å…¥</span></span><br><span class="line">    <span class="meta">@Autowired</span>  <span class="comment">//2</span></span><br><span class="line">    <span class="keyword">private</span>  RabbitTemplate rabbitTemplate;</span><br><span class="line">    <span class="meta">@PostConstruct</span>  <span class="comment">//æ³¨å…¥  3 ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œè¿™ä¸ªæ³¨è§£æ˜¯åœ¨å…¶ä»–æ³¨è§£æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰ä¼šæ‰§è¡Œï¼Œåˆ‡è®°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//æ³¨å…¥</span></span><br><span class="line">        rabbitTemplate.setConfirmCallback(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    äº¤æ¢æœºç¡®è®¤å›è°ƒæ–¹æ³•</span></span><br><span class="line"><span class="comment">    1.å‘æ¶ˆæ¯ äº¤æ¢æœºæ¥æ”¶åˆ°äº†æ¶ˆæ¯  å›é¦ˆ</span></span><br><span class="line"><span class="comment">        1.1correlationDataä¿å­˜å›è°ƒæ¶ˆæ¯IDä»¥åŠç›¸å…³ä¿¡æ¯</span></span><br><span class="line"><span class="comment">        1.2äº¤æ¢æœºæ¥æ”¶åˆ°æ¶ˆæ¯  ack  = true</span></span><br><span class="line"><span class="comment">        1.3 cause  null</span></span><br><span class="line"><span class="comment">    2.å‘é€æ¶ˆæ¯ äº¤æ¢æœºæ¥æ”¶å¤±è´¥äº†é—®é¢˜</span></span><br><span class="line"><span class="comment">        2.1 correlationData ä¿å­˜å›è°ƒä¿¡æ¯çš„IDä»¥åŠç›¸å…³ä¿¡æ¯</span></span><br><span class="line"><span class="comment">        2.2 äº¤æ¢æœºæ¥æ”¶åˆ°æ¶ˆæ¯  ack =  false</span></span><br><span class="line"><span class="comment">        2.3 cause å¤±è´¥çš„åŸå› </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(CorrelationData correlationData, <span class="type">boolean</span> ack, String cause)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> correlationData.getId()!=<span class="literal">null</span> ? correlationData.getId() : <span class="string">&quot;&quot;</span> ;</span><br><span class="line">        <span class="keyword">if</span>(ack)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;äº¤æ¢æœºå·²ç»æ”¶åˆ°çš„IDä¸ºï¼š &#123;&#125;çš„æ¶ˆæ¯&quot;</span>,id);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            log.info(<span class="string">&quot;äº¤æ¢æœºè¿˜æœªæ”¶åˆ°IDä¸ºï¼š&#123;&#125;çš„æ¶ˆæ¯,ç”±äºåŸå› ï¼š&#123;&#125;&quot;</span>,id,cause);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">//å¼€å§‹å‘æ¶ˆæ¯ï¼Œæµ‹è¯•ç¡®è®¤</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/confirm&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘é€æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendMessage/&#123;message&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(<span class="meta">@PathVariable</span> String message)</span>&#123;</span><br><span class="line">        <span class="type">CorrelationData</span> <span class="variable">correlationData1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME,</span><br><span class="line">                ConfirmConfig.CONFIRM_ROUTING_KEY,message,correlationData1);</span><br><span class="line">        log.info(<span class="string">&quot;å‘é€æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;&quot;</span>,message + <span class="string">&quot;key1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">CorrelationData</span> <span class="variable">correlationData2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME,</span><br><span class="line">                ConfirmConfig.CONFIRM_ROUTING_KEY,message,correlationData2);</span><br><span class="line">        log.info(<span class="string">&quot;å‘é€æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;&quot;</span>,message + <span class="string">&quot;key2&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å›é€€æ¶ˆæ¯">å›é€€æ¶ˆæ¯</h2><p>åœ¨å¼€å¯äº†ç”Ÿæˆè€…ç¡®è®¤æœºåˆ¶æƒ…å†µä¸‹ï¼Œäº¤æ¢æœºæ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šç›´æ¥å°†æ¶ˆæ¯ç”Ÿäº§è€…å‘é€ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚æœå‘ç°è¯¥æ¶ˆæ¯ä¸å¯è·¯ç”±ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šè¢«ç›´æ¥ä¸¢å¼ƒï¼Œæ­¤æ—¶ç”Ÿäº§è€…æ˜¯ä¸çŸ¥é“æ¶ˆæ¯è¢«ä¸¢å¼ƒè¿™ä¸ªäº‹ä»¶çš„ï¼Œé‚£ä¹ˆå¦‚ä½•è®©æ— æ³•è¢«è·¯ç”±çš„æ¶ˆæ¯å¸®æˆ‘æƒ³åŠæ³•å¤„ç†ä¸€ä¸‹ï¼Ÿæœ€ç®€å•çš„å°±æ˜¯é€šçŸ¥æˆ‘ä¸€ä¸‹ï¼Œæˆ‘å¥½æ–¹ä¾¿å¤„ç†ï¼Œé€šè¿‡è®¾ç½®mandatoryå‚æ•°å°±å¯ä»¥åœ¨å½“æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­ä¸å¯è¾¾ç›®çš„æ—¶å°†æ¶ˆæ¯è¿”å›ç»™ç”Ÿæˆè€…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">//1</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCallBack</span> <span class="keyword">implements</span> <span class="title class_">RabbitTemplate</span>.ConfirmCallback,RabbitTemplate.ReturnCallback&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”±äºæ˜¯å†…éƒ¨æ¥å£ï¼Œæ•…è€Œä¸èƒ½ç›´æ¥æˆ‘ä»¬å®ç°çš„æ¥å£ï¼Œæˆ‘ä»¬éœ€è¦ç›´æ¥æ³¨å…¥</span></span><br><span class="line">    <span class="comment">//æ³¨å…¥</span></span><br><span class="line">    <span class="meta">@Autowired</span>  <span class="comment">//2</span></span><br><span class="line">    <span class="keyword">private</span>  RabbitTemplate rabbitTemplate;</span><br><span class="line">    <span class="meta">@PostConstruct</span>  <span class="comment">//æ³¨å…¥  3 ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œè¿™ä¸ªæ³¨è§£æ˜¯åœ¨å…¶ä»–æ³¨è§£æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰ä¼šæ‰§è¡Œï¼Œåˆ‡è®°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//æ³¨å…¥</span></span><br><span class="line">        rabbitTemplate.setConfirmCallback(<span class="built_in">this</span>);</span><br><span class="line"><span class="comment">//ä¸æ³¨å…¥çš„åŒ–æ²¡æœ‰ç»“æœ</span></span><br><span class="line">        rabbitTemplate.setReturnCallback(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    äº¤æ¢æœºç¡®è®¤å›è°ƒæ–¹æ³•</span></span><br><span class="line"><span class="comment">    1.å‘æ¶ˆæ¯ äº¤æ¢æœºæ¥æ”¶åˆ°äº†æ¶ˆæ¯  å›é¦ˆ</span></span><br><span class="line"><span class="comment">        1.1correlationDataä¿å­˜å›è°ƒæ¶ˆæ¯IDä»¥åŠç›¸å…³ä¿¡æ¯</span></span><br><span class="line"><span class="comment">        1.2äº¤æ¢æœºæ¥æ”¶åˆ°æ¶ˆæ¯  ack  = true</span></span><br><span class="line"><span class="comment">        1.3 cause  null</span></span><br><span class="line"><span class="comment">    2.å‘é€æ¶ˆæ¯ äº¤æ¢æœºæ¥æ”¶å¤±è´¥äº†é—®é¢˜</span></span><br><span class="line"><span class="comment">        2.1 correlationData ä¿å­˜å›è°ƒä¿¡æ¯çš„IDä»¥åŠç›¸å…³ä¿¡æ¯</span></span><br><span class="line"><span class="comment">        2.2 äº¤æ¢æœºæ¥æ”¶åˆ°æ¶ˆæ¯  ack =  false</span></span><br><span class="line"><span class="comment">        2.3 cause å¤±è´¥çš„åŸå› </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">confirm</span><span class="params">(CorrelationData correlationData, <span class="type">boolean</span> ack, String cause)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> correlationData.getId()!=<span class="literal">null</span> ? correlationData.getId() : <span class="string">&quot;&quot;</span> ;</span><br><span class="line">        <span class="keyword">if</span>(ack)&#123;</span><br><span class="line">            log.info(<span class="string">&quot;äº¤æ¢æœºå·²ç»æ”¶åˆ°çš„IDä¸ºï¼š &#123;&#125;çš„æ¶ˆæ¯&quot;</span>,id);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            log.info(<span class="string">&quot;äº¤æ¢æœºè¿˜æœªæ”¶åˆ°IDä¸ºï¼š&#123;&#125;çš„æ¶ˆæ¯,ç”±äºåŸå› ï¼š&#123;&#125;&quot;</span>,id,cause);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å›é€€æ¥å£å®ç°ï¼Œå¯ä»¥åœ¨å½“æ¶ˆæ¯åœ¨ä¼ é€’è¿‡ç¨‹ä¸­ä¸å¯è¾¾</span></span><br><span class="line">    <span class="comment">// ç›®çš„æ—¶å°†æ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€…</span></span><br><span class="line">    <span class="comment">//åªæœ‰å½“æ¶ˆæ¯ä¸å¯è¾¾ç›®çš„åœ°æ—¶å€™æ‰è¿›è¡Œå›é€€</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">returnedMessage</span><span class="params">(Message message, <span class="type">int</span> replyCode, String replyText, String exchange, String routingKey)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;æ¶ˆæ¯ï¼š&#123;&#125;,è¢«äº¤æ¢æœº&#123;&#125; é€€å›äº†ï¼Œé€€å›åŸå› æ˜¯ï¼š&#123;&#125;ï¼Œè·¯ç”±Key:&#123;&#125;&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()),exchange,replyText,routingKey);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/confirm&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘é€æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendMessage/&#123;message&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(<span class="meta">@PathVariable</span> String message)</span>&#123;</span><br><span class="line">        <span class="type">CorrelationData</span> <span class="variable">correlationData1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME,</span><br><span class="line">                ConfirmConfig.CONFIRM_ROUTING_KEY,message,correlationData1);</span><br><span class="line">        log.info(<span class="string">&quot;å‘é€æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;&quot;</span>,message + <span class="string">&quot;key1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">CorrelationData</span> <span class="variable">correlationData2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorrelationData</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        rabbitTemplate.convertAndSend(ConfirmConfig.CONFIRM_EXCHANGE_NAME,</span><br><span class="line">                ConfirmConfig.CONFIRM_ROUTING_KEY + <span class="string">&quot;2&quot;</span> ,message + <span class="string">&quot;key2&quot;</span>,correlationData2);</span><br><span class="line">        log.info(<span class="string">&quot;å‘é€æ¶ˆæ¯å†…å®¹ï¼š&#123;&#125;&quot;</span>,message + <span class="string">&quot;key2&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å›é€€å¤„ç†</p><p><a href="http://127.0.0.1:8080/confirm/sendMessage/%E4%BD%A0%E5%A5%BD">http://127.0.0.1:8080/confirm/sendMessage/ä½ å¥½</a></p><p><img src="1667747118718.png" alt="1667747118718"></p><p><img src="1667747050852.png" alt="1667747050852"></p><h3 id="å¤‡ä»½äº¤æ¢æœº">å¤‡ä»½äº¤æ¢æœº</h3><p><img src="1667748517643.png" alt="1667748517643"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å‘å¸ƒç¡®è®¤é…ç½®ç±»</span></span><br><span class="line"><span class="comment"> ç›®çš„æ˜¯ä¸ºäº† å‘å¸ƒç¡®è®¤ ï¼ˆé«˜çº§ï¼‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfirmConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//äº¤æ¢æœº</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span> String CONFIRM_EXCHANGE_NAME= <span class="string">&quot;confirm_exchange&quot;</span>;</span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;confirm_queue&quot;</span>;</span><br><span class="line">    <span class="comment">//RoutingKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONFIRM_ROUTING_KEY</span> <span class="operator">=</span> <span class="string">&quot;key1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¤‡ä»½äº¤æ¢æœº</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">BACKUP_EXCHANGE_NAME</span> <span class="operator">=</span> <span class="string">&quot;backup_exchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¤‡ä»½é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">BACKUP_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;backup_queue&quot;</span>;</span><br><span class="line">    <span class="comment">//æŠ¥è­¦é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span>  <span class="type">String</span> <span class="variable">WARNING_QUEUE_NAME</span> <span class="operator">=</span> <span class="string">&quot;warning_queue&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å£°æ˜ä¸€ä¸ªäº¤æ¢æœº</span></span><br><span class="line">    <span class="meta">@Bean(&quot;confirmExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DirectExchange <span class="title function_">confirmExchange</span><span class="params">()</span>&#123;                       <span class="comment">//æŒä¹…åŒ–</span></span><br><span class="line">      <span class="keyword">return</span> ExchangeBuilder.directExchange(CONFIRM_EXCHANGE_NAME).durable(<span class="literal">true</span>).withArgument(<span class="string">&quot;alternate-exchange&quot;</span>,BACKUP_EXCHANGE_NAME).build();</span><br><span class="line">    <span class="comment">//    return  new DirectExchange(CONFIRM_EXCHANGE_NAME);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å£°æ˜ä¸€ä¸ªé˜Ÿåˆ—</span></span><br><span class="line">    <span class="meta">@Bean(&quot;confirmQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">confirmQueue</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>  QueueBuilder.durable(CONFIRM_QUEUE_NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç»‘å®š</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueBindingExchange</span><span class="params">(<span class="meta">@Qualifier(&quot;confirmQueue&quot;)</span> Queue confirmQueue,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@Qualifier(&quot;confirmExchange&quot;)</span> DirectExchange confirmExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(confirmQueue).to(confirmExchange).with(CONFIRM_ROUTING_KEY);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆ›å»ºä¸€ä¸ªå¤‡ä»½äº¤æ¢æœº</span></span><br><span class="line">    <span class="meta">@Bean(&quot;backupExchange&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> FanoutExchange <span class="title function_">backupExchange</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">new</span> <span class="title class_">FanoutExchange</span>(BACKUP_EXCHANGE_NAME);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean(&quot;backupQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span>  Queue <span class="title function_">backupQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(BACKUP_QUEUE_NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;warningQueue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span>  Queue <span class="title function_">warningQueue</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(WARNING_QUEUE_NAME).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¤‡ä»½äº¤æ¢æœºé‚¦å®šåˆ°å¤‡ä»½é˜Ÿåˆ—</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueBindingBackupExchange</span><span class="params">(<span class="meta">@Qualifier(&quot;backupQueue&quot;)</span> Queue backupQueue,</span></span><br><span class="line"><span class="params">                                        <span class="meta">@Qualifier(&quot;backupExchange&quot;)</span> FanoutExchange backupExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(backupQueue).to(backupExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŠ¥è­¦äº¤æ¢æœºé‚¦å®šåˆ°æŠ¥è­¦</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Binding <span class="title function_">queueBindingWarningExchange</span><span class="params">(<span class="meta">@Qualifier(&quot;warningQueue&quot;)</span> Queue warningQueue,</span></span><br><span class="line"><span class="params">                                              <span class="meta">@Qualifier(&quot;backupExchange&quot;)</span> FanoutExchange backupExchange)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(warningQueue).to(backupExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¶ˆè´¹è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æŠ¥è­¦æ¶ˆè´¹è€…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WarningConsumer</span> &#123;</span><br><span class="line">    <span class="comment">//æ¥å—æŠ¥è­¦ä¿¡æ¯</span></span><br><span class="line">    <span class="meta">@RabbitListener(queues = ConfirmConfig.WARNING_QUEUE_NAME)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receiveWarningMsg</span><span class="params">(Message message)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(message.getBody());</span><br><span class="line">        log.info(<span class="string">&quot;æŠ¥è­¦å‘ç°ä¸å¯è·¯ç”±æ¶ˆæ¯ï¼š &#123;&#125;&quot;</span> ,msg);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="1667749785943.png" alt="1667749785943"></p><h2 id="å¹‚ç­‰æ€§">å¹‚ç­‰æ€§</h2><p>ç”¨æˆ·å¯¹äºåŒä¸€æ“ä½œå‘èµ·çš„ä¸€æ¬¡è¯·æ±‚æˆ–è€…å¤šæ¬¡è¯·æ±‚çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œä¸ä¼šå› ä¸ºå¤šæ¬¡ç‚¹å‡»è€Œäº§ç”Ÿäº†å‰¯ä½œç”¨ã€‚ä¸¾ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œé‚£å°±æ˜¯æ”¯ä»˜ï¼Œç”¨æˆ·è´­ä¹°å•†å“åæ”¯ä»˜ï¼Œæ”¯ä»˜æ‰£æ¬¾æˆåŠŸï¼Œä½†æ˜¯è¿”å›ç»“æœçš„æ—¶å€™ç½‘ç»œå¼‚å¸¸ï¼Œæ­¤æ—¶é’±å·²ç»æ‰£äº†ï¼Œç”¨æˆ·å†æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œæ­¤æ—¶ä¼šè¿›è¡Œç¬¬äºŒæ¬¡æ‰£æ¬¾ï¼Œè¿”å›ç»“æœæˆåŠŸï¼Œç”¨æˆ·æŸ¥è¯¢ä½™é¢å‘ç°å¤šæ‰£é’±äº†ï¼Œæµæ°´è®°å½•ä¹Ÿå˜æˆäº†ä¸¤æ¡ã€‚åœ¨ä»¥å‰çš„å•åº”ç”¨ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠæ•°æ®æ“ä½œæ”¾å…¥äº‹åŠ¡ä¸­å³å¯ï¼Œå‘ç”Ÿé”™è¯¯ç«‹å³å›æ»šï¼Œä½†æ˜¯å†å“åº”å®¢æˆ·ç«¯çš„æ—¶å€™ä¹Ÿæœ‰å¯èƒ½å‡ºç°ç½‘ç»œä¸­æ–­æˆ–è€…å¼‚å¸¸ç­‰ç­‰</p><p><strong>æ¶ˆæ¯è¢«é‡å¤æ¶ˆè´¹</strong></p><p>æ¶ˆè´¹è€…åœ¨æ¶ˆè´¹MQä¸­çš„æ¶ˆæ¯æ—¶ï¼ŒMQå·²æŠŠæ¶ˆæ¯å‘é€ç»™æ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…åœ¨ç»™MQè¿”å›ackæ—¶ç½‘ç»œä¸­æ–­ï¼Œæ•…MQæœªæ”¶åˆ°ç¡®è®¤ä¿¡æ¯ï¼Œè¯¥æ¡æ¶ˆæ¯ä¼šé‡æ–°å‘ç»™å…¶ä»–çš„æ¶ˆè´¹è€…ï¼Œæˆ–è€…åœ¨ç½‘ç»œé‡è¿åå†æ¬¡å‘é€ç»™è¯¥æ¶ˆè´¹è€…ï¼Œä½†å®é™…ä¸Šè¯¥æ¶ˆè´¹è€…å·²æˆåŠŸæ¶ˆè´¹äº†è¯¥æ¡æ¶ˆæ¯ï¼Œé€ æˆæ¶ˆè´¹è€…æ¶ˆè´¹äº†é‡å¤çš„æ¶ˆæ¯ã€‚</p><p><strong>è§£å†³æ€è·¯</strong></p><p>MQæ¶ˆè´¹è€…çš„å¹‚ç­‰æ€§çš„è§£å†³ä¸€èˆ¬ä½¿ç”¨å…¨å±€IDæˆ–è€…å†™ä¸ªå”¯ä¸€æ ‡è¯†æ¯”å¦‚æ—¶é—´æˆ³æˆ–è€…UUIDæˆ–è€…è®¢å•æ¶ˆè´¹è€…æ¶ˆè´¹MQä¸­çš„æ¶ˆæ¯ä¹Ÿå¯åˆ©ç”¨MQçš„è¯¥idæ¥åˆ¤æ–­ï¼Œæˆ–è€…å¯æŒ‰è‡ªå·±çš„è§„åˆ™ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€idï¼Œæ¯æ¬¡æ¶ˆè´¹æ¶ˆæ¯æ—¶ç”¨è¯¥idå…ˆåˆ¤æ–­è¯¥æ¶ˆæ¯æ˜¯å¦å·²æ¶ˆè´¹è¿‡ã€‚</p><p><strong>æ¶ˆè´¹ç«¯çš„å¹‚ç­‰æ€§ä¿éšœ</strong><br>åœ¨æµ·é‡è®¢å•ç”Ÿæˆçš„ä¸šåŠ¡é«˜å³°æœŸï¼Œç”Ÿäº§ç«¯æœ‰å¯èƒ½å°±ä¼šé‡å¤å‘ç”Ÿäº†æ¶ˆæ¯ï¼Œè¿™æ—¶å€™æ¶ˆè´¹ç«¯å°±è¦å®ç°å¹‚ç­‰æ€§ï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬çš„æ¶ˆæ¯æ°¸è¿œä¸ä¼šè¢«æ¶ˆè´¹å¤šæ¬¡ï¼Œå³ä½¿æˆ‘ä»¬æ”¶åˆ°äº†ä¸€æ ·çš„æ¶ˆæ¯ã€‚ä¸šç•Œä¸»æµçš„å¹‚ç­‰æ€§æœ‰ä¸¤ç§æ“ä½œï¼ša.å”¯ä¸€ID+æŒ‡çº¹ç æœºåˆ¶ï¼Œåˆ©ç”¨æ•°æ®åº“ä¸»é”®å»é‡ï¼Œb.åˆ©ç”¨redisçš„åŸå­æ€§å»å®ç°</p><p><strong>å”¯ä¸€lD+æŒ‡çº¹ç æœºåˆ¶</strong><br>æŒ‡çº¹ç ï¼šæˆ‘ä»¬çš„ä¸€äº›è§„åˆ™æˆ–è€…æ—¶é—´æˆ³åŠ åˆ«çš„æœåŠ¡ç»™åˆ°çš„å”¯ä¸€ä¿¡æ¯ç ï¼Œå®ƒå¹¶ä¸ä¸€å®šæ˜¯æˆ‘ä»¬ç³»ç»Ÿç”Ÿæˆçš„ï¼ŒåŸºæœ¬éƒ½æ˜¯ç”±æˆ‘ä»¬çš„ä¸šåŠ¡è§„åˆ™æ‹¼æ¥è€Œæ¥ï¼Œä½†æ˜¯ä¸€å®šè¦ä¿è¯å”¯ä¸€æ€§ï¼Œç„¶åå°±åˆ©ç”¨æŸ¥è¯¢è¯­å¥è¿›è¡Œåˆ¤æ–­è¿™ä¸ªidæ˜¯å¦å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œä¼˜åŠ¿å°±æ˜¯å®ç°ç®€å•å°±ä¸€ä¸ªæ‹¼æ¥ï¼Œç„¶åæŸ¥è¯¢åˆ¤æ–­æ˜¯å¦é‡å¤ï¼›åŠ£åŠ¿å°±æ˜¯åœ¨é«˜å¹¶å‘æ—¶ï¼Œå¦‚æœæ˜¯å•ä¸ªæ•°æ®åº“å°±ä¼šæœ‰å†™å…¥æ€§èƒ½ç“¶é¢ˆå½“ç„¶ä¹Ÿå¯ä»¥é‡‡ç”¨åˆ†åº“åˆ†è¡¨æå‡æ€§èƒ½ï¼Œä½†ä¹Ÿä¸æ˜¯æˆ‘ä»¬æœ€æ¨èçš„æ–¹å¼ã€‚</p><p><strong>RedisåŸå­æ€§</strong>ï¼ˆé‡ç‚¹é€‰æ‹©ï¼‰<br>åˆ©ç”¨redisæ‰§è¡Œsetnxå‘½ä»¤ï¼Œå¤©ç„¶å…·æœ‰å¹•ç­‰æ€§ã€‚ä»è€Œå®ç°ä¸é‡å¤æ¶ˆè´¹ã€‚</p><h3 id="ä¼˜å…ˆçº§é˜Ÿåˆ—">ä¼˜å…ˆçº§é˜Ÿåˆ—</h3><p>åœ¨æˆ‘ä»¬ç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªè®¢å•å‚¬ä»˜çš„åœºæ™¯ï¼Œæˆ‘ä»¬çš„å®¢æˆ·åœ¨å¤©çŒ«ä¸‹çš„è®¢å•ï¼Œæ·˜å®ä¼šåŠæ—¶å°†è®¢å•æ¨é€ç»™æˆ‘ä»¬ï¼Œå¦‚æœåœ¨ç”¨æˆ·è®¾å®šçš„æ—¶é—´å†…æœªä»˜æ¬¾é‚£ä¹ˆå°±ä¼šç»™ç”¨æˆ·æ¨é€ä¸€æ¡çŸ­ä¿¡æé†’ï¼Œå¾ˆç®€å•çš„ä¸€ä¸ªåŠŸèƒ½å¯¹å§ï¼Œä½†æ˜¯ï¼Œtmallå•†å®¶å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œè‚¯å®šæ˜¯è¦åˆ†å¤§å®¢æˆ·å’Œå°å®¢æˆ·çš„å¯¹å§ï¼Œæ¯”å¦‚åƒè‹¹æœï¼Œå°ç±³è¿™æ ·å¤§å•†å®¶ä¸€å¹´èµ·ç èƒ½ç»™æˆ‘ä»¬åˆ›é€ å¾ˆå¤§çš„åˆ©æ¶¦ï¼Œæ‰€ä»¥ç†åº”å½“ç„¶ï¼Œä»–ä»¬çš„è®¢å•å¿…é¡»å¾—åˆ°ä¼˜å…ˆå¤„ç†ï¼Œè€Œæ›¾ç»æˆ‘ä»¬çš„åç«¯ç³»ç»Ÿæ˜¯ä½¿ç”¨ redisæ¥å­˜æ”¾çš„å®šæ—¶è½®è¯¢ï¼Œå¤§å®¶éƒ½çŸ¥é“ redis åªèƒ½ç”¨Liståšä¸€ä¸ªç®€ç®€å•å•çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶ä¸èƒ½å®ç°ä¸€ä¸ªä¼˜å…ˆçº§çš„åœºæ™¯ï¼Œæ‰€ä»¥è®¢å•é‡å¤§äº†åé‡‡ç”¨RabbitMQè¿›è¡Œæ”¹é€ å’Œä¼˜åŒ–ï¼Œå¦‚æœå‘ç°æ˜¯å¤§å®¢æˆ·çš„è®¢å•ç»™ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒé«˜çš„ä¼˜å…ˆçº§ï¼Œå¦åˆ™å°±æ˜¯é»˜è®¤ä¼˜å…ˆçº§ã€‚</p><p>å¦‚ä½•æ·»åŠ </p><p><img src="1667795380420.png" alt="1667795368461"></p><p>a.æ§åˆ¶å°æ·»åŠ </p><p>b.é˜Ÿåˆ—ä¸­ä»£ç æ·»åŠ ä¼˜å…ˆçº§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,Object&gt; parame = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">parame.put(<span class="string">&quot;x-max-prority&quot;</span>,<span class="number">10</span>);</span><br><span class="line">channel.queueDeclare(<span class="string">&quot;hello&quot;</span>,<span class="literal">true</span>,<span class="literal">false</span>,<span class="literal">false</span>,params);</span><br></pre></td></tr></table></figure><p><img src="1667796706959.png" alt="1667796706959"></p><p>c.æ¶ˆæ¯ä¸­ä»£ç æ·»åŠ ä¼˜å…ˆçº§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">final</span>  String QUEUE_NAME=<span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‘æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//å»ºç«‹ä¸€ä¸ªè¿æ¥æ–¹å¼</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        <span class="comment">//å·¥å‚IP è¿æ¥RabbitMQçš„é˜Ÿåˆ—</span></span><br><span class="line">        factory.setHost(<span class="string">&quot;www.littlehei.fun&quot;</span>);</span><br><span class="line">        <span class="comment">//ç”¨æˆ·å</span></span><br><span class="line">        factory.setUsername(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¯†ç </span></span><br><span class="line">        factory.setPassword(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºé“¾æ¥</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> factory.newConnection();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–ä¿¡é“</span></span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç”Ÿæˆä¸€ä¸ªé˜Ÿåˆ—</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        ç”Ÿæˆé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">        å‚æ•°1ï¼Œé˜Ÿåˆ—åç§°</span></span><br><span class="line"><span class="comment">        å‚æ•°2ï¼Œé˜Ÿåˆ—é‡Œè¾¹çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ–ï¼ˆç£ç›˜ï¼‰é»˜è®¤æƒ…å†µæ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­</span></span><br><span class="line"><span class="comment">        å‚æ•°3ï¼Œè¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ï¼Œæ˜¯å¦è¿›è¡Œæ¶ˆæ¯å…±äº«ï¼Œtrueå¯ä»¥å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹,falseï¼šåªèƒ½ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹</span></span><br><span class="line"><span class="comment">        å‚æ•°4ï¼Œæ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œæœ€åä¸€ä¸ªæ¶ˆè´¹è€…æ–­å¼€é“¾æ¥ä»¥åï¼Œè¯¥é˜Ÿæ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œtrueï¼Œè‡ªåŠ¨åˆ é™¤ï¼Œfalseä¸åˆ é™¤</span></span><br><span class="line"><span class="comment">        å‚æ•°5ï¼Œå…¶ä»–å‚æ•°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;x-max-priority&quot;</span>,<span class="number">10</span>);<span class="comment">//å®˜æ–¹å…è®¸æ˜¯0-255ä¹‹é—´ï¼Œæ­¤å¤„è®¾ç½®10ï¼Œå…è®¸ä¼˜åŒ–çº§èŒƒå›´ä¸º0-10 ä¸è¦è®¾ç½®è¿‡å¤§ï¼Œæµªè´¹CPUå’Œå†…å­˜</span></span><br><span class="line"></span><br><span class="line">        channel.queueDeclare(QUEUE_NAME,<span class="literal">true</span>,<span class="literal">false</span>,<span class="literal">false</span>,map);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å‘æ¶ˆæ¯</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;info&quot;</span> + i;<span class="comment">//åˆæ¬¡ä½¿ç”¨</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(i == <span class="number">5</span>)&#123;</span><br><span class="line">                AMQP.<span class="type">BasicProperties</span> <span class="variable">properties</span> <span class="operator">=</span></span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">AMQP</span>.BasicProperties().builder().priority(<span class="number">5</span>).build();</span><br><span class="line">                channel.basicPublish(<span class="string">&quot;&quot;</span>,QUEUE_NAME,properties,message.getBytes());</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                channel.basicPublish(<span class="string">&quot;&quot;</span>,QUEUE_NAME,<span class="literal">null</span>,message.getBytes());</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        å‘é€ä¸€ä¸ªæ¶ˆè´¹</span></span><br><span class="line"><span class="comment">        å‚æ•°1ï¼Œå‘é€åˆ°å“ªä¸ªäº¤æ¢æœº</span></span><br><span class="line"><span class="comment">        å‚æ•°2.è·¯ç”±çš„keyå€¼æ˜¯å“ªä¸ªï¼Ÿ  æœ¬æ¬¡æ˜¯é˜Ÿåˆ—çš„åç§°</span></span><br><span class="line"><span class="comment">        å‚æ•°3ï¼Œå…¶ä»–å‚æ•°é…ç½®</span></span><br><span class="line"><span class="comment">        å‚æ•°4ï¼Œå‘é€æ¶ˆæ¯çš„æ¶ˆæ¯ä½“</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—çš„åç§°ï¼š</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span>  <span class="keyword">final</span> String QUEUE_NAME=<span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºé“¾æ¥å·¥å‚</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        factory.setHost(<span class="string">&quot;www.littlehei.fun&quot;</span>);</span><br><span class="line">        factory.setUsername(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        factory.setPassword(<span class="string">&quot;guest&quot;</span>);</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span>  factory.newConnection();</span><br><span class="line">        <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span>  connection.createChannel();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å£°æ˜</span></span><br><span class="line">        <span class="type">DeliverCallback</span> <span class="variable">deliverCallback</span> <span class="operator">=</span> (consumerTag, message)-&gt;&#123;</span><br><span class="line">            <span class="comment">//  String message = new String(&quot;è‡ªå·±æ‰‹åŠ¨å»åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯ï¼Œä½†æ˜¯ä¸æ¨è&quot;);</span></span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(message.getBody()));</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å–æ¶ˆæ¶ˆæ¯æ—¶çš„å›è°ƒ</span></span><br><span class="line">        <span class="type">CancelCallback</span> <span class="variable">cancelCallback</span> <span class="operator">=</span> consumerTag -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¶ˆæ¯æ¶ˆè´¹è¢«ä¸­æ–­&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">        å‚æ•°1ï¼Œæ¶ˆè´¹å“ªä¸ªé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">        å‚æ•°2ï¼Œæ¶ˆè´¹æˆåŠŸä¹‹åæ˜¯å¦è¦è‡ªåŠ¨åº”ç­”ï¼Œtrueè¡¨ç¤ºè‡ªåŠ¨åº”ç­”ï¼Œfalseè¡¨ç¤ºä¸æ˜¯</span></span><br><span class="line"><span class="comment">        å‚æ•°3ï¼Œæ¶ˆè´¹è€…æœªæˆåŠŸæ¶ˆè´¹çš„å›è°ƒ</span></span><br><span class="line"><span class="comment">        å‚æ•°4ï¼Œæ¶ˆè´¹è€…å–å½•æ¶ˆè´¹çš„å›åˆ°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        channel.basicConsume(QUEUE_NAME,<span class="literal">true</span>,deliverCallback,cancelCallback);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="1667797198751.png" alt="1667797198751"></p><p><strong>d.æ³¨æ„äº‹é¡¹</strong></p><p>è¦è®©é˜Ÿåˆ—å®ç°ä¼˜å…ˆçº§éœ€è¦åšçš„äº‹æƒ…æœ‰å¦‚ä¸‹äº‹æƒ…ï¼š</p><p>é˜Ÿåˆ—éœ€è¦è®¾ç½®ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œæ¶ˆæ¯éœ€è¦è®¾ç½®æ¶ˆæ¯çš„ä¼˜å…ˆçº§ï¼Œæ¶ˆè´¹è€…éœ€è¦ç­‰å¾…æ¶ˆæ¯å·²ç»å‘é€åˆ°é˜Ÿåˆ—ä¸­æ‰å»æ¶ˆè´¹ï¼Œå› ä¸ºè¿™æ ·æ‰æœ‰æœºä¼šå¯¹æ¶ˆæ¯è¿›è¡Œæ’åº</p><h3 id="æƒ°æ€§é˜Ÿåˆ—">æƒ°æ€§é˜Ÿåˆ—</h3><p>RabbitMQä»3.6.0ç‰ˆæœ¬å¼€å§‹å¼•å…¥äº†æƒ°æ€§é˜Ÿåˆ—çš„æ¦‚å¿µã€‚æƒ°æ€§é˜Ÿåˆ—ä¼šå°½å¯èƒ½çš„å°†æ¶ˆæ¯å­˜å…¥ç£ç›˜ä¸­ï¼Œè€Œåœ¨æ¶ˆè´¹è€…æ¶ˆè´¹åˆ°ç›¸åº”çš„æ¶ˆæ¯æ—¶æ‰ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå®ƒçš„ä¸€ä¸ªé‡è¦çš„è®¾è®¡ç›®æ ‡æ˜¯èƒ½å¤Ÿæ”¯æŒæ›´é•¿çš„é˜Ÿåˆ—ï¼Œå³æ”¯æŒæ›´å¤šçš„æ¶ˆæ¯å­˜å‚¨ã€‚å½“æ¶ˆè´¹è€…ç”±äºå„ç§å„æ ·çš„åŸå› ï¼ˆæ¯”å¦‚æ¶ˆè´¹è€…ä¸‹çº¿ã€è‹¥æœºäº¦æˆ–è€…æ˜¯ç”±äºç»´æŠ¤è€Œå…³é—­ç­‰ï¼‰è€Œè‡´ä½¿é•¿æ—¶é—´å†…ä¸èƒ½æ¶ˆè´¹æ¶ˆæ¯é€ æˆå †ç§¯æ—¶ï¼Œæƒ°æ€§é˜Ÿåˆ—å°±å¾ˆæœ‰å¿…è¦äº†ã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°RabbitMQçš„æ—¶å€™ï¼Œé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šå°½å¯èƒ½çš„å­˜å‚¨åœ¨å†…å­˜ä¹‹ä¸­ï¼Œè¿™æ ·å¯ä»¥æ›´åŠ å¿«é€Ÿçš„å°†æ¶ˆæ¯å‘é€ç»™æ¶ˆè´¹è€…ã€‚å³ä½¿æ˜¯æŒä¹…åŒ–çš„æ¶ˆæ¯ï¼Œåœ¨è¢«å†™å…¥ç£ç›˜çš„åŒæ—¶ä¹Ÿä¼šåœ¨å†…å­˜ä¸­é©»ç•™ä¸€ä»½å¤‡ä»½ã€‚å½“RabbitMQéœ€è¦é‡Šæ”¾å†…å­˜çš„æ—¶å€™ï¼Œä¼šå°†å†…å­˜ä¸­çš„æ¶ˆæ¯æ¢é¡µè‡³ç£ç›˜ä¸­ï¼Œè¿™ä¸ªæ“ä½œä¼šè€—è´¹è¾ƒé•¿çš„æ—¶é—´ï¼Œä¹Ÿä¼šé˜»å¡é˜Ÿåˆ—çš„æ“ä½œï¼Œè¿›è€Œæ— æ³•æ¥æ”¶æ–°çš„æ¶ˆæ¯ã€‚è™½ç„¶RabbitMQçš„å¼€å‘è€…ä»¬ä¸€ç›´åœ¨å‡çº§ç›¸å…³çš„ç®—æ³•ï¼Œä½†æ˜¯æ•ˆæœå§‹ç»ˆä¸å¤ªç†æƒ³ï¼Œå°¤å…¶æ˜¯åœ¨æ¶ˆæ¯é‡ç‰¹åˆ«å¤§çš„æ—¶å€™ã€‚+</p><p><img src="1667797292928.png" alt="1667797292928"></p><p>å½“æ¶ˆæ¯å¤§é‡è¿‡æ¥ï¼Œæˆ‘ä»¬çŸ­æ—¶é—´å¤„ç†ä¸è¿‡æ¥ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬é‡‡ç”¨æƒ°æ€§é˜Ÿåˆ—äº†</p><p>é˜Ÿåˆ—å…·å¤‡ä¸¤ç§æ¨¡å¼ï¼šdefault å’Œlazyã€‚é»˜è®¤çš„ä¸ºdefaultæ¨¡å¼ï¼Œåœ¨3.6.0ä¹‹å‰çš„ç‰ˆæœ¬æ— éœ€åšä»»ä½•å˜æ›´ã€‚lazyæ¨¡å¼å³ä¸ºæƒ°æ€§é˜Ÿåˆ—çš„æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨channel.queueDeclareæ–¹æ³•çš„æ—¶å€™åœ¨å‚æ•°ä¸­è®¾ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡Policyçš„æ–¹å¼è®¾ç½®ï¼Œå¦‚æœä¸€ä¸ªé˜Ÿåˆ—åŒæ—¶ä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼è®¾ç½®çš„è¯ï¼Œé‚£ä¹ˆPolicyçš„æ–¹å¼å…·å¤‡æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚<br><strong>å¦‚æœè¦é€šè¿‡å£°æ˜çš„æ–¹å¼æ”¹å˜å·²æœ‰é˜Ÿåˆ—çš„æ¨¡å¼çš„è¯ï¼Œé‚£ä¹ˆåªèƒ½å…ˆåˆ é™¤é˜Ÿåˆ—ï¼Œç„¶åå†é‡æ–°å£°æ˜ä¸€ä¸ªæ–°çš„ã€‚</strong><br>**åœ¨é˜Ÿåˆ—å£°æ˜çš„æ—¶å€™å¯ä»¥é€šè¿‡â€œx-queue-mode&quot;å‚æ•°æ¥è®¾ç½®é˜Ÿåˆ—çš„æ¨¡å¼ï¼Œå–å€¼ä¸ºâ€œdefaultâ€™å’Œlazy&quot;ã€‚**ä¸‹é¢ç¤ºä¾‹ä¸­æ¼”ç¤ºäº†ä¸€ä¸ªæƒ°æ€§é˜Ÿåˆ—çš„å£°æ˜ç»†èŠ‚ï¼š</p><blockquote><p>Map&lt;Stringï¼ŒObject&gt; args =new HashMap&lt;Stringï¼ŒObject&gt;ï¼ˆï¼‰ï¼›</p><p>args.putï¼ˆâ€œx-queue-modeâ€ï¼Œâ€œlazyâ€ï¼‰ï¼›</p><p>channel.queueDeclareï¼ˆâ€œmyqueueâ€ï¼Œfalseï¼Œfalseï¼Œfalseï¼Œargsï¼‰ï¼›</p></blockquote><p><img src="1667797531387.png" alt="1667797531387"></p><p><strong>åœ¨å‘é€1ç™¾ä¸‡æ¡æ¶ˆæ¯ï¼Œæ¯æ¡æ¶ˆæ¯å¤§æ¦‚å 1KBçš„æƒ…å†µä¸‹ï¼Œæ™®é€šé˜Ÿåˆ—å ç”¨å†…å­˜æ˜¯1.2GBï¼Œè€Œæƒ°æ€§é˜Ÿåˆ—ä»…ä»…å ç”¨1.5MB</strong>ã€‚</p><h1>é›†ç¾¤éƒ¨åˆ†ï¼š</h1><h2 id="clustering"><strong>clustering</strong></h2><p><img src="1667797750772.png" alt="1667797750772"></p><h2 id="æ­å»ºé›†ç¾¤">æ­å»ºé›†ç¾¤</h2><p>å¦‚æœæ˜¯æœ¬åœ°è™šæ‹Ÿæœºçš„è¯ï¼Œæˆ‘ä»¬å°±å°†å‡ å°è™šæ‹Ÿæœºè¿›è¡Œå…‹éš†ï¼Œé€ æˆé›†ç¾¤ç¯å¢ƒã€‚</p><p>ç„¶åé€‰æ‹©ä¸€å°æœåŠ¡å™¨ä½œä¸ºé›†ç¾¤ï¼Œå…¶ä»–ä¸¤å°æœåŠ¡å™¨åŠ å…¥è¿›å»ã€‚</p><ol><li><p>ä¿®æ”¹3å°æœºå™¨çš„ä¸»æœºåç§°</p><p><code>vim /etc/hostname</code></p><p><code>vim /etc/host</code>è¿›å…¥åæ›´è¯¥å°±è¡Œ</p><p>â€‹ipåœ°å€ node1</p><p>â€‹ipåœ°å€ node2</p><p>â€‹ipåœ°å€ node3</p></li><li><p>é…ç½®å„ä¸ªèŠ‚ç‚¹çš„hostæ–‡ä»¶ï¼Œè®©å„ä¸ªèŠ‚ç‚¹éƒ½èƒ½ç›¸äº’è¯†åˆ«å¯¹æ–¹ã€‚</p><p><img src="1667798303738.png" alt="1667798303738"></p></li><li><p>ç¡®ä¿å„ä¸ªèŠ‚ç‚¹çš„cookieæ–‡ä»¶ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªå€¼ã€‚</p><p><code>scp/var/lib/rabbitmq/.erlang.cookie root@node2:/var/lib/rabbitmg/.erlang.cookie</code></p><p><code>scp/var/lib/rabbitmq/.erlang.cookie root@node3:/var/lib/rabbitmg/.erlang.cookie</code></p></li><li><p>å¯åŠ¨RabbitMQæœåŠ¡ï¼Œé¡ºå¸¦å¯åŠ¨Erlangè™šæ‹Ÿæœºå’ŒrabbitMQåº”ç”¨æœåŠ¡ï¼ˆåœ¨ä¸‰å°èŠ‚ç‚¹ä¸Šåˆ†å¸ƒæ‰§è¡Œå‘½ä»¤ï¼‰</p><p><code>rabbitmq-server-detached</code></p></li><li><p>åœ¨èŠ‚ç‚¹2æ‰§è¡Œ</p><p>rabbitmqctl stop_app</p><p>ï¼ˆrabbitmqctl stopä¼šå°†Erlangè™šæ‹Ÿæœºå…³é—­ï¼Œrabbitmqct stop_app åªå…³é—­RabbitMQæœåŠ¡ï¼‰</p><p>rabbitmqctl reset</p><p>rabbitmqctl join_cluster rabbit@node1</p><p>rabbitmqctl start_appï¼ˆåªå¯åŠ¨åº”ç”¨æœåŠ¡ï¼‰</p></li><li><p>åœ¨èŠ‚ç‚¹3æ‰§è¡Œ</p><p>rabbitmqctl stop_app</p><p>rabbitmqctl reset</p><p>rabbitmqctl join_cluster rabbit@node2</p><p>rabbitmqctl start_appï¼ˆåªå¯åŠ¨åº”ç”¨æœåŠ¡)</p></li><li><p>é›†ç¾¤çŠ¶æ€</p><p>rabbitmqctl cluster_status</p></li><li><p>éœ€è¦é‡æ–°è®¾ç½®ç”¨æˆ·è§’è‰²</p><p>åˆ›å»ºè´¦å·</p><p>â€‹rabbitmqctl add_user admin 123</p><p>è®¾ç½®ç”¨æˆ·è§’è‰²</p><p>â€‹rabbitmqctl set_user_tags admin adminstractor</p><p>è®¾ç½®ç”¨æˆ·æƒé™</p><p>â€‹<code>rabbitmqctl set_permissions -p &quot;/&quot; admin &quot;.*&quot; &quot;.*&quot; &quot;.*&quot; </code></p><p><img src="1667799075099.png" alt="1667799075099"></p><p>æ­¤æ—¶å¦‚å›¾ï¼Œè¡¨ç¤ºå­˜åœ¨é›†ç¾¤ï¼›</p></li><li><p>è§£é™¤é›†ç¾¤èŠ‚ç‚¹ï¼ˆnode2ï¼Œå’Œnode3åˆ†åˆ«æ‰§è¡Œï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl stop_app</span><br><span class="line"></span><br><span class="line">rabbitmqctl reset</span><br><span class="line"></span><br><span class="line">rabbitmqctl start_app</span><br><span class="line"></span><br><span class="line">rabbitmqctl cluster_status</span><br><span class="line"></span><br><span class="line">rabbitmqetl forget_cluster_node rabbit@node2ï¼ˆnode1æœºå™¨ä¸Šæ‰§è¡Œï¼‰</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h2 id="é•œåƒé˜Ÿåˆ—">é•œåƒé˜Ÿåˆ—</h2><p>å¦‚æœRabbitMQé›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ªBroker èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹çš„å¤±æ•ˆå°†å¯¼è‡´æ•´ä½“æœåŠ¡çš„ä¸´æ—¶æ€§ä¸å¯ç”¨ï¼Œå¹¶ä¸”ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯çš„ä¸¢å¤±ã€‚å¯ä»¥å°†æ‰€æœ‰æ¶ˆæ¯éƒ½è®¾ç½®ä¸ºæŒä¹…åŒ–ï¼Œå¹¶ä¸”å¯¹åº”é˜Ÿåˆ—çš„durableå±æ€§ä¹Ÿè®¾ç½®ä¸ºtrueï¼Œä½†æ˜¯è¿™æ ·ä»ç„¶æ— æ³•é¿å…ç”±äºç¼“å­˜å¯¼è‡´çš„é—®é¢˜ï¼šå› ä¸ºæ¶ˆæ¯åœ¨å‘é€ä¹‹åå’Œè¢«å†™å…¥ç£ç›˜äº•æ‰§è¡Œåˆ·ç›˜åŠ¨ä½œä¹‹é—´å­˜åœ¨ä¸€ä¸ªçŸ­æš‚å´ä¼šäº§ç”Ÿé—®é¢˜çš„æ—¶é—´çª—ï¼Œé€šè¿‡publisherconfirmæœºåˆ¶èƒ½å¤Ÿç¡®ä¿å®¢æˆ·ç«¯çŸ¥é“å“ªäº›æ¶ˆæ¯å·±ç»å­˜å…¥ç£ç›˜ï¼Œå°½ç®¡å¦‚æ­¤ï¼Œä¸€èˆ¬ä¸å¸Œæœ›é‡åˆ°å› å•ç‚¹æ•…éšœå¯¼è‡´çš„æœåŠ¡ä¸å¯ç”¨ã€‚<br>å¼•å…¥é•œåƒé˜Ÿåˆ—ï¼ˆMiror Queueï¼‰çš„æœºåˆ¶ï¼Œå¯ä»¥å°†é˜Ÿåˆ—é•œåƒåˆ°é›†ç¾¤ä¸­çš„å…¶ä»–BrokerèŠ‚ç‚¹ä¹‹ä¸Šï¼Œå¦‚æœé›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹å¤±æ•ˆäº†ï¼Œé˜Ÿåˆ—èƒ½è‡ªåŠ¨åœ°åˆ‡æ¢åˆ°é•œåƒä¸­çš„å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šä»¥ä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ã€‚</p><p><strong>æ­å»ºæ­¥éª¤</strong></p><ol><li><p>å¯åŠ¨ä¸‰å°é›†ç¾¤èŠ‚ç‚¹</p></li><li><p>éšä¾¿æ‰¾ä¸€ä¸ªèŠ‚ç‚¹æ·»åŠ policy</p><p><img src="1667922376855.png" alt="1667922376855"></p><p>ç…§ç€è¿™å¼ å›¾å¡«å†™ã€‚</p><p><img src="1667922420241.png" alt="1667922420241"></p><p>å¤‡ä»½å¦‚ä¸‹</p><p><img src="1667922518425.png" alt="1667922518425"></p><p><img src="1667922560387.png" alt="1667922560387"></p></li></ol><p><img src="1667922609313.png" alt="1667922609313"></p><p>å•ç‚¹æ— æ³•è¿æ¥</p><p><img src="1667922679579.png" alt="1667922679579"></p><p>é‡‡ç”¨è´Ÿè½½å‡è¡¡ï¼ŒHaproxy + keepalive å®ç°é«˜å¯ç”¨è´Ÿè½½å‡è¡¡ã€‚</p><p><img src="1667922801700.png" alt="1667922801700"></p><h2 id="FederationExchangeï¼ˆè”é‚¦äº¤æ¢æœºï¼‰">FederationExchangeï¼ˆè”é‚¦äº¤æ¢æœºï¼‰</h2><p>ï¼ˆbrokeråŒ—äº¬ï¼‰ï¼Œï¼ˆbroker æ·±åœ³ï¼‰å½¼æ­¤ä¹‹é—´ç›¸è·ç”šè¿œï¼Œç½‘ç»œå»¶è¿Ÿæ˜¯ä¸€ä¸ªä¸å¾—ä¸é¢å¯¹çš„é—®é¢˜ã€‚æœ‰ä¸€ä¸ªåœ¨åŒ—äº¬çš„ä¸šåŠ¡ï¼ˆClientåŒ—äº¬ï¼‰éœ€è¦è¿æ¥ï¼ˆbrokeråŒ—äº¬ï¼‰ï¼Œå‘å…¶ä¸­çš„äº¤æ¢å™¨exchangeAå‘é€æ¶ˆæ¯ï¼Œæ­¤æ—¶çš„ç½‘ç»œå»¶è¿Ÿå¾ˆå°ï¼Œï¼ˆClientåŒ—äº¬ï¼‰å¯ä»¥è¿…é€Ÿå°†æ¶ˆæ¯å‘é€è‡³exchangeAä¸­ï¼Œå°±ç®—åœ¨å¼€å¯äº†publisherconfirmæœºåˆ¶æˆ–è€…äº‹åŠ¡æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥è¿…é€Ÿæ”¶åˆ°ç¡®è®¤ä¿¡æ¯ã€‚æ­¤æ—¶åˆæœ‰ä¸ªåœ¨æ·±åœ³çš„ä¸šåŠ¡ï¼ˆClient æ·±åœ³ï¼‰éœ€è¦å‘ exchangeAå‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆï¼ˆClientæ·±åœ³ï¼‰ï¼ˆbrokeråŒ—äº¬ï¼‰ä¹‹é—´æœ‰å¾ˆå¤§çš„ç½‘ç»œå»¶è¿Ÿï¼Œï¼ˆClient æ·±åœ³ï¼‰å°†å‘é€æ¶ˆæ¯è‡³exchangeAä¼šç»å†ä¸€å®šçš„å»¶è¿Ÿï¼Œå°¤å…¶æ˜¯åœ¨å¼€å¯äº†publisherconfirmæœºåˆ¶æˆ–è€…äº‹åŠ¡æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œï¼ˆClientæ·±åœ³ï¼‰ä¼šç­‰å¾…å¾ˆé•¿çš„å»¶è¿Ÿæ—¶é—´æ¥æ¥æ”¶ï¼ˆbrokeråŒ—äº¬ï¼‰çš„ç¡®è®¤ä¿¡æ¯ï¼Œè¿›è€Œå¿…ç„¶é€ æˆè¿™æ¡å‘é€çº¿ç¨‹çš„æ€§èƒ½é™ä½ï¼Œç”šè‡³é€ æˆä¸€å®šç¨‹åº¦ä¸Šçš„é˜»å¡ã€‚</p><p>å°†ä¸šåŠ¡ï¼ˆClientæ·±åœ³ï¼‰éƒ¨ç½²åˆ°åŒ—äº¬çš„æœºæˆ¿å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœï¼ˆClientæ·±åœ³ï¼‰è°ƒç”¨çš„å¦äº›æœåŠ¡éƒ½éƒ¨ç½²åœ¨æ·±åœ³ï¼Œé‚£ä¹ˆåˆä¼šå¼•å‘æ–°çš„æ—¶å»¶é—®é¢˜ï¼Œæ€»ä¸è§å¾—å°†æ‰€æœ‰ä¸šåŠ¡å…¨éƒ¨éƒ¨ç½²åœ¨ä¸€ä¸ªæœºæˆ¿ï¼Œé‚£ä¹ˆå®¹ç¾åˆä½•ä»¥å®ç°ï¼Ÿ<br>è¿™é‡Œä½¿ç”¨Federation æ’ä»¶å°±å¯ä»¥å¾ˆå¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜.</p><p>ç”±äºä¸¤ä¸ªåœ°åŒºçš„æœåŠ¡å™¨æ¯”è¾ƒè¿œï¼Œè¿™ä¸ªæ—¶å€™å°±å­˜åœ¨ä¸€ç§æœåŠ¡å»¶è¿Ÿæƒ…å†µï¼Œæˆ‘ä»¬çš„federationäº¤æ¢æœºå°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚</p><p>æ­å»ºæ­¥éª¤ï¼š</p><ol><li><p>éœ€è¦ä¿è¯æ¯å°èŠ‚ç‚¹å•ç‹¬è¿è¡Œ</p></li><li><p>åœ¨æ¯å°æœºå™¨ä¸Šå¼€å¯federationç›¸å…³æ’ä»¶</p><p><code>rabbitmq-plugins enable rabbitmq_federation</code></p><p><code>rabbitmq-plugins enable rabbitmq federation_management</code></p><p>æ¯å°æœåŠ¡å™¨ä¸Šéƒ½è£…ä¸€ä¸‹ã€‚</p><p>ä¸¤ä¸ªæŒ‡ä»¤éƒ½éœ€è¦å®‰è£…ã€‚</p><p><img src="1667923322008.png" alt="1667923322008"></p></li><li><p>åŸç†å›¾ï¼šï¼ˆé«˜å±±æµæ°´ï¼Œåªèƒ½ä»ä¸Šæ¸¸æµå‘ä¸‹æ¸¸ï¼‰ã€‚</p><p><img src="1667923458139.png" alt="1667923458139"></p><p>æ³¨æ„çš„æ˜¯ï¼Œå¿…é¡»ä»åˆ›å»ºå¥½ä¸‹æ¸¸èŠ‚ç‚¹çš„äº¤æ¢æœºï¼Œæ‰èƒ½å¤Ÿå°†æ¶ˆæ¯ä»ä¸Šæ¸¸ä¼ åˆ°ä¸‹æ¸¸ã€‚ä¸Šæ¸¸çš„æ¶ˆæ¯åœ¨ä¸‹æ¸¸ä¸èƒ½æ¥æ”¶ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¶ˆæ¯å°±æ— æ³•ä¼ é€’åˆ°ä¸‹æ¸¸ã€‚</p></li><li><p>åœ¨downstean(node2)é…ç½®upstream(node1);</p><p><img src="1668010050815.png" alt="1668010050815"></p></li><li><p>æ·»åŠ è§„åˆ™</p></li><li><p><img src="1668010105701.png" alt="1668010105701"></p><p>ç»“æœå¦‚ä¸‹</p><p><img src="1668010140138.png" alt="1668010140138"></p></li></ol><h3 id="è”é‚¦é˜Ÿåˆ—">è”é‚¦é˜Ÿåˆ—</h3><p><img src="1668010229795.png" alt="1668010229795"></p><p><img src="1668010374916.png" alt="1668010374916"></p><p><img src="1668010393798.png" alt="1668010393798"></p><h2 id="Shovel">Shovel</h2><p>ä½¿ç”¨å®ƒçš„åŸå› <br>Federation å…·å¤‡çš„æ•°æ®è½¬å‘åŠŸèƒ½ç±»ä¼¼ï¼ŒShovelå¤Ÿå¯é ã€æŒç»­åœ°ä»ä¸€ä¸ªBrokerä¸­çš„é˜Ÿåˆ—ï¼ˆä½œä¸ºæºç«¯ï¼Œå³sourceï¼‰æ‹‰å–æ•°æ®å¹¶è½¬å‘è‡³å¦ä¸€ä¸ªBrokerä¸­çš„äº¤æ¢å™¨ï¼ˆä½œä¸ºç›®çš„ç«¯ï¼Œå³destinationï¼‰ã€‚ä½œä¸ºæºç«¯çš„é˜Ÿåˆ—å’Œä½œä¸ºç›®çš„ç«¯çš„äº¤æ¢å™¨å¯ä»¥åŒæ—¶ä½äºåŒä¸€ä¸ªBrokerï¼Œä¹Ÿå¯ä»¥ä½äºä¸åŒçš„Brokerä¸Šã€‚Shovelå¯ä»¥ç¿»è¯‘ä¸ºâ€œé“²å­&quot;<br>æ˜¯ä¸€ç§æ¯”è¾ƒå½¢è±¡çš„æ¯”å–»ï¼Œè¿™ä¸ªâ€é“²å­â€å¯ä»¥å°†æ¶ˆæ¯ä»ä¸€æ–¹â€œé“²å­&quot;å¦ä¸€æ–¹ã€‚Shovelè¡Œä¸ºå°±åƒä¼˜ç§€çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºèƒ½å¤Ÿè´Ÿè´£è¿æ¥æºå’Œç›®çš„åœ°ã€è´Ÿè´£æ¶ˆæ¯çš„è¯»å†™åŠè´Ÿè´£è¿æ¥å¤±è´¥é—®é¢˜çš„å¤„ç†ã€‚<br>æ­å»ºæ­¥éª¤<br>1.å¼€å¯æ’ä»¶ï¼ˆéœ€è¦çš„æœºå™¨éƒ½å¼€å¯ï¼‰</p><p><code>rabbitmq-plugins enable rabbitmq_shovel </code></p><p><code>rabbitmq-plugins enable rabbitmq_shovel_management</code></p><p><img src="1668010585500.png" alt="1668010585500"></p><p><img src="1668010503507.png" alt="1668010503507"></p><p><img src="1668010619325.png" alt="1668010619325"></p><p><img src="1668010650732.png" alt="1668010650732"></p>]]></content>
    
    
    <summary type="html">æœ¬æ–‡ä¸»è¦RabbitMQçš„è®°å½•</summary>
    
    
    
    <category term="æ¶ˆæ¯é˜Ÿåˆ—" scheme="https://luoxiaohei520.github.io/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
    
    <category term="RabbitMQ" scheme="https://luoxiaohei520.github.io/tags/RabbitMQ/"/>
    
  </entry>
  
  <entry>
    <title>Rediså­¦ä¹ </title>
    <link href="https://luoxiaohei520.github.io/posts/8434e219.html"/>
    <id>https://luoxiaohei520.github.io/posts/8434e219.html</id>
    <published>2023-11-09T02:50:23.338Z</published>
    <updated>2023-11-09T02:50:23.339Z</updated>
    
    <content type="html"><![CDATA[<h1>Rediså­¦ä¹ </h1><p>redisæ˜¯ä¸€ä¸ªNoSqlçš„ï¼ˆè¿œç¨‹å­—å…¸æœåŠ¡çš„ï¼Œkey_valueçš„æ•°æ®åº“ï¼‰</p><p><strong>redis èƒ½å¹²å˜›</strong></p><ol><li>å†…å­˜å­˜å‚¨ï¼ŒæŒä¹…åŒ–ï¼Œå†…å­˜ä¸­æ˜¯æ–­ç”µå°±å¤±å»ï¼Œæ‰€æœ‰è¯´æŒä¹…åŒ–å¾ˆé‡è¦</li><li>æ•ˆç‡é«˜ï¼Œå¯ä»¥ç”¨äºé«˜é€Ÿç¼“å­˜</li><li>å‘å¸ƒè®¢é˜…ç³»ç»Ÿ</li><li>åœ°å›¾ä¿¡æ¯ç»Ÿè®¡</li><li>è®¡æ—¶å™¨ï¼Œè®°æ•°å™¨</li><li>ã€‚ã€‚ã€‚ã€‚</li></ol><blockquote><p>ç‰¹æ€§</p></blockquote><ol><li>å¤šæ ·çš„æ•°æ®ç±»å‹ï¼ˆHashMap ,set ,String ,List ,Zsetï¼‰</li><li>æŒä¹…åŒ–</li><li>é›†ç¾¤</li><li>äº‹åŠ¡</li><li>ã€‚ã€‚ã€‚ã€‚</li></ol><blockquote><p>å¦‚ä½•å»å­¦ä¹ redis</p></blockquote><p>rediså®˜ç½‘ ï¼š <a href="https://www.redis.net.cn/">https://www.redis.net.cn/</a></p><p>å®‰è£…Redis : è¿™é‡Œä¸å†™</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹è½½redis </span><br><span class="line">docker pull redis</span><br><span class="line"></span><br><span class="line">åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨</span><br><span class="line">mkdir <span class="operator">-</span>p <span class="operator">/</span>mydata<span class="operator">/</span>redis<span class="operator">/</span>conf      </span><br><span class="line"></span><br><span class="line">touch redis.conf</span><br><span class="line"></span><br><span class="line">docker run <span class="operator">-</span>p <span class="number">6379</span>:<span class="number">6379</span> <span class="comment">--name redis -v /mydata/redis/data:/data \</span></span><br><span class="line">   <span class="operator">-</span>v <span class="operator">/</span>mydata<span class="operator">/</span>redis<span class="operator">/</span>conf<span class="operator">/</span>redis.conf:<span class="operator">/</span>etc<span class="operator">/</span>redis<span class="operator">/</span>redis.conf \</span><br><span class="line">   <span class="operator">-</span>d redis redis<span class="operator">-</span>server <span class="operator">/</span>etc<span class="operator">/</span>redis<span class="operator">/</span>redis.conf</span><br><span class="line"></span><br><span class="line"> ls   æŸ¥çœ‹å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶</span><br><span class="line"> cat redis.conf</span><br><span class="line"></span><br><span class="line"> æµ‹è¯•redis </span><br><span class="line">  </span><br><span class="line"> docker <span class="keyword">exec</span> <span class="operator">-</span>it redis redis<span class="operator">-</span>cli</span><br><span class="line"> </span><br><span class="line"> <span class="comment">---</span></span><br><span class="line"> ç”±äºä»¥å‰çš„æ•°æ®å…¨å­˜åœ¨å†…å­˜ä¸­ï¼Œä»è€Œæˆ‘ä»¬é‡å¤è¯»å–<span class="keyword">get</span> açš„æ—¶å€™ä¼šå¯¼è‡´å¤±è´¥</span><br><span class="line">[root<span class="variable">@localhost</span> conf]# cat redis.conf</span><br><span class="line">[root<span class="variable">@localhost</span> conf]# docker <span class="keyword">exec</span> <span class="operator">-</span>it redis redis<span class="operator">-</span>cli</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">set</span> a b</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> <span class="keyword">get</span> a</span><br><span class="line">&quot;b&quot;   <span class="operator">/</span><span class="operator">/</span>ä»è€Œåœ¨ä¸€æ¬¡ä¸Šæ¥çš„æ—¶å€™è¿™å—æ˜¯<span class="keyword">null</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> exit</span><br><span class="line"></span><br><span class="line"><span class="comment">--è®©redis æŒä¹…åŒ–  ---&gt; pwd</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span><span class="operator">&gt;</span> exit</span><br><span class="line">[root<span class="variable">@localhost</span> conf]# pwd</span><br><span class="line"><span class="operator">/</span>mydata<span class="operator">/</span>redis<span class="operator">/</span>conf</span><br><span class="line">[root<span class="variable">@localhost</span> conf]# ls</span><br><span class="line">redis.conf</span><br><span class="line">[root<span class="variable">@localhost</span> conf]# vi redis.conf </span><br><span class="line">i</span><br><span class="line">appendonly yes</span><br><span class="line">esc  :wq</span><br><span class="line"> <span class="comment">--ç”±äºè¿›å…¥æ–‡æ¡£åæˆ‘ä¸çŸ¥é“å¦‚ä½•ä¿å­˜ï¼Œæ•…æ­¤æˆ‘ä¸åœ¨ç»§ç»­æŒä¹…åŒ–äº† äº‹å®ä¸Šæœ€æ–°çš„redisè‡ªå¸¦æŒä¹…åŒ–äº†</span></span><br><span class="line"></span><br><span class="line">docker restart redis  <span class="operator">/</span><span class="operator">/</span>é‡å¯redis</span><br><span class="line"><span class="comment">--è®¾ç½®å¼€æœºè‡ªå¯åŠ¨docker é‡Œè¾¹å®¹å™¨</span></span><br><span class="line">sudo docker <span class="keyword">update</span> <span class="operator">&lt;</span>å®¹å™¨å<span class="operator">&gt;</span> <span class="comment">--restart=always</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Redisçš„åŸºç¡€çŸ¥è¯†">Redisçš„åŸºç¡€çŸ¥è¯†</h2><p><code>select</code> é€‰æ‹©æ•°æ®åº“</p><p><code>keys *</code>  æŸ¥çœ‹æ‰€æœ‰çš„key</p><p><code>exists</code> key  æŸ¥çœ‹keyæ˜¯å¦å­˜åœ¨</p><p><code>move  key  id</code> æ ¹æ®idå’Œkeyå€¼ç§»é™¤</p><p><code>flushdb</code> æ¸…é™¤å½“å‰æ•°æ®åº“</p><p><code>flushAll</code> æ¸…é™¤å…¨éƒ¨æ•°æ®åº“ä¸­æ‰€æœ‰æ•°æ®</p><p><code>set  key value</code> è®¾ç½®Keyå’Œvalue</p><p><code>get key</code>  è·å¾—keyçš„å€¼</p><p><code>expire key æ—¶é—´</code> è®¾ç½®è¿‡æœŸæ—¶é—´å•ä½ç§’</p><p><code>ttl key</code> æŸ¥çœ‹è¿‡æœŸæ—¶é—´</p><p><code>type key</code> æŸ¥çœ‹å½“å‰keyå­˜åˆ°valueçš„æ•°æ®ç±»å‹</p><p>ä¸ºä»€ä¹ˆredisç«¯å£å·ä¸º6379ã€‚(ä½œè€…ä½¿ç”¨ä¸€ä¸ªæ˜æ˜Ÿçš„åå­—)</p><blockquote><p>redisæ˜¯å•çº¿ç¨‹çš„</p></blockquote><p>ç”±äºrediså¾ˆå¿«ï¼Œå®˜æ–¹è®¤ä¸ºï¼Œredisæ˜¯åŸºäºå†…å­˜æ“ä½œï¼ŒCPUå¹¶ä¸æ˜¯Redisçš„æ€§èƒ½ç“¶é¢ˆï¼ŒRedisçš„ç“¶é¢ˆæ˜¯æ ¹æ®æœºæ¢°çš„å†…å­˜å’Œç½‘ç»œå¸¦å®½ï¼Œæ—¢ç„¶å¯ä»¥ä½¿ç”¨å•çº¿ç¨‹æ¥å®ç°ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨å•çº¿ç¨‹äº†ã€‚</p><h3 id="Redisä¸ºå•¥ä½¿ç”¨å•çº¿ç¨‹è¿˜æ˜¯è¿™ä¹ˆå¿«ï¼Ÿ">Redisä¸ºå•¥ä½¿ç”¨å•çº¿ç¨‹è¿˜æ˜¯è¿™ä¹ˆå¿«ï¼Ÿ</h3><ol><li><p>è¯¯åŒºï¼Œé«˜æ€§èƒ½çš„æœåŠ¡å™¨ä¸ä¸€ç‚¹å…¨æ˜¯å¤šçº¿ç¨‹çš„ã€‚</p></li><li><p>è¯¯åŒº2ï¼Œå¤šçº¿ç¨‹å¹¶ä¸ä¸€å®šéƒ½æ¯”å•çº¿ç¨‹æ•ˆç‡é«˜ã€‚</p><blockquote><p>redisæ˜¯å°†æ•°æ®å­˜æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œæ•…è€Œä½¿ç”¨å•çº¿ç¨‹å»æ“ä½œå°±æ¯”è¾ƒå¿«ï¼Œå¤šçº¿ç¨‹ä¼šè¿›è¡ŒCPUä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè€—æ—¶ï¼Œå¯¹äºå†…å­˜ç³»ç»Ÿæ¥è¯´ï¼Œå¦‚æœæ²¡æœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢æ•ˆç‡å°±æ˜¯æœ€é«˜çš„ï¼Œå¤šæ¬¡è¯»å†™éƒ½æ˜¯åœ¨ä¸€ä¸ªcpuä¸Šï¼Œåœ¨å†…å­˜æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå°±æ˜¯æœ€ä½³æ–¹æ¡ˆã€‚</p></blockquote></li></ol><h3 id="RedisæŒ‡ä»¤å¤§å…¨">RedisæŒ‡ä»¤å¤§å…¨</h3><h4 id="Redis-Key">Redis-Key</h4><p><code>select</code> é€‰æ‹©æ•°æ®åº“</p><p><code>keys *</code>  æŸ¥çœ‹æ‰€æœ‰çš„key</p><p><code>exists</code> key  æŸ¥çœ‹keyæ˜¯å¦å­˜åœ¨</p><p><code>move  key  id</code> æ ¹æ®idå’Œkeyå€¼ç§»é™¤</p><p><code>flushdb</code> æ¸…é™¤å½“å‰æ•°æ®åº“</p><p><code>flushAll</code> æ¸…é™¤å…¨éƒ¨æ•°æ®åº“ä¸­æ‰€æœ‰æ•°æ®</p><p><code>set  key value</code> è®¾ç½®Keyå’Œvalue</p><p><code>get key</code>  è·å¾—keyçš„å€¼</p><p><code>expire key æ—¶é—´</code> è®¾ç½®è¿‡æœŸæ—¶é—´å•ä½ç§’</p><p><code>ttl key</code> æŸ¥çœ‹è¿‡æœŸæ—¶é—´</p><p><code>type key</code> æŸ¥çœ‹å½“å‰keyå­˜åˆ°valueçš„æ•°æ®ç±»å‹</p><p><code>incr  key</code>æ¯æ¬¡æ‰§è¡Œéƒ½è¿›è¡ŒåŠ ä¸€æ“ä½œ</p><p><code>desc key</code> æ¯æ¬¡æ‰§è¡Œéƒ½è¿›è¡Œå‡ä¸€æ“ä½œ</p><p><code>getRange key 0 3</code> æˆªå–å­—ç¬¦ä¸²ã€0,3ã€‘</p><p><code>getRange key 0 -1</code> æˆªå–å…¨éƒ¨çš„å­—ç¬¦ä¸²å’Œget key æ˜¯ä¸€æ ·çš„</p><p><code>setrange key 1 xx</code>  æ›¿æ¢æŒ‡å®šä½ç½®å¼€å§‹çš„å­—ç¬¦ä¸²</p><p><code>settex (set with expire)  key è¿‡æœŸæ—¶é—´ value</code> è®¾ç½®è¿‡æœŸæ—¶é—´ä¸”å€¼ä¸ºvalue</p><p><code>setnx (set if not expire)  key</code>   ä¸å­˜åœ¨çš„æ—¶å€™è®¾ç½®ï¼ˆåœ¨åˆ†å¸ƒå¼ä¸­ä¼šç»å¸¸ä½¿ç”¨ï¼‰ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å­˜åœ¨çš„æ—¶å€™ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªkey,å¦‚æœä»–å­˜åœ¨çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šåˆ›å»ºå¤±è´¥</p><p><code>mset key1 value1   key2 value2  ...</code> å¯ä»¥åˆ›å»ºå¤šå¯¹keyå’Œvalue</p><p><code>mget  key1 key2 key3 ...</code>å¯ä»¥åŒæ—¶è·å–å¤šä¸ªå€¼</p><p><code>msetnx k1 v1 k2 v2 ...</code>æ˜¯ä¸€ä¸ªåŸå­æ€§æ“ä½œï¼Œè¦ä¹ˆä¸€èµ·æˆåŠŸï¼Œè¦ä¹ˆä¸€èµ·å¤±è´¥ã€‚</p><h3 id="Redisçš„æ•°æ®ç±»å‹ï¼ˆString-hash-list-set-zsetï¼‰">Redisçš„æ•°æ®ç±»å‹ï¼ˆString,hash,list,set,zsetï¼‰</h3><p>Redisæ˜¯ä¸€ä¸ªå¼€æºï¼ˆBSDè®¸å¯ï¼‰ï¼Œå†…å­˜å­˜å‚¨çš„æ•°æ®ç»“æ„æœåŠ¡å™¨ï¼Œå¯ç”¨ä½œæ•°æ®åº“ï¼Œé«˜é€Ÿç¼“å­˜å’Œæ¶ˆæ¯é˜Ÿåˆ—ä»£ç†ã€‚å®ƒæ”¯æŒ<a href="https://www.redis.net.cn/tutorial/3508.html">å­—ç¬¦ä¸²</a>ã€<a href="https://www.redis.net.cn/tutorial/3509.html">å“ˆå¸Œè¡¨</a>ã€<a href="https://www.redis.net.cn/tutorial/3510.html">åˆ—è¡¨</a>ã€<a href="https://www.redis.net.cn/tutorial/3511.html">é›†åˆ</a>ã€<a href="https://www.redis.net.cn/tutorial/3512.html">æœ‰åºé›†åˆ</a>ï¼Œ<a href="https://www.redis.net.cn/tutorial/3508.html">ä½å›¾</a>ï¼Œ<a href="https://www.redis.net.cn/tutorial/3513.html">hyperloglogs</a>ç­‰æ•°æ®ç±»å‹ã€‚å†…ç½®å¤åˆ¶ã€<a href="https://www.redis.net.cn/tutorial/3516.html">Luaè„šæœ¬</a>ã€LRUæ”¶å›ã€<a href="https://www.redis.net.cn/tutorial/3515.html">äº‹åŠ¡</a>ä»¥åŠä¸åŒçº§åˆ«ç£ç›˜æŒä¹…åŒ–åŠŸèƒ½ï¼ŒåŒæ—¶é€šè¿‡Redis Sentinelæä¾›é«˜å¯ç”¨ï¼Œé€šè¿‡Redis Clusteræä¾›è‡ªåŠ¨<a href="https://www.redis.net.cn/tutorial/3524.html">åˆ†åŒº</a>ã€‚</p><h4 id="Redis-é”®-key-å‘½ä»¤">Redis é”®(key) å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>Type å‘½ä»¤</td><td>è¿”å› key æ‰€å‚¨å­˜çš„å€¼çš„ç±»å‹ã€‚</td></tr><tr><td>PEXPIREAT</td><td>è®¾ç½® key çš„è¿‡æœŸæ—¶é—´äº¿ä»¥æ¯«ç§’è®¡ã€‚</td></tr><tr><td>PEXPIREAT</td><td>è®¾ç½® key è¿‡æœŸæ—¶é—´çš„æ—¶é—´æˆ³(unix timestamp) ä»¥æ¯«ç§’è®¡</td></tr><tr><td>Rename</td><td>ä¿®æ”¹ key çš„åç§°</td></tr><tr><td>PERSIST</td><td>ç§»é™¤ key çš„è¿‡æœŸæ—¶é—´ï¼Œkey å°†æŒä¹…ä¿æŒã€‚</td></tr><tr><td>Move</td><td>å°†å½“å‰æ•°æ®åº“çš„ key ç§»åŠ¨åˆ°ç»™å®šçš„æ•°æ®åº“ db å½“ä¸­ã€‚</td></tr><tr><td>RANDOMKEY</td><td>ä»å½“å‰æ•°æ®åº“ä¸­éšæœºè¿”å›ä¸€ä¸ª key ã€‚</td></tr><tr><td>Dump</td><td>åºåˆ—åŒ–ç»™å®š key ï¼Œå¹¶è¿”å›è¢«åºåˆ—åŒ–çš„å€¼ã€‚</td></tr><tr><td>TTL</td><td>ä»¥ç§’ä¸ºå•ä½ï¼Œè¿”å›ç»™å®š key çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´(TTL, time to live)ã€‚</td></tr><tr><td>Expire</td><td>seconds ä¸ºç»™å®š key è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚</td></tr><tr><td>DEL</td><td>è¯¥å‘½ä»¤ç”¨äºåœ¨ key å­˜åœ¨æ˜¯åˆ é™¤ keyã€‚</td></tr><tr><td>Pttl</td><td>ä»¥æ¯«ç§’ä¸ºå•ä½è¿”å› key çš„å‰©ä½™çš„è¿‡æœŸæ—¶é—´ã€‚</td></tr><tr><td>Renamenx</td><td>ä»…å½“ newkey ä¸å­˜åœ¨æ—¶ï¼Œå°† key æ”¹åä¸º newkey ã€‚</td></tr><tr><td>EXISTS</td><td>æ£€æŸ¥ç»™å®š key æ˜¯å¦å­˜åœ¨ã€‚</td></tr><tr><td>Expireat</td><td>EXPIREAT çš„ä½œç”¨å’Œ EXPIRE ç±»ä¼¼ï¼Œéƒ½ç”¨äºä¸º key è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚ ä¸åŒåœ¨äº EXPIREAT å‘½ä»¤æ¥å—çš„æ—¶é—´å‚æ•°æ˜¯ UNIX æ—¶é—´æˆ³(unix timestamp)ã€‚</td></tr><tr><td>Keys</td><td>æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼( pattern)çš„ key ã€‚</td></tr></tbody></table><h4 id="Redis-å­—ç¬¦ä¸²-String-å‘½ä»¤">Redis å­—ç¬¦ä¸²(String) å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>Setnx</td><td>åªæœ‰åœ¨ key ä¸å­˜åœ¨æ—¶è®¾ç½® key çš„å€¼ã€‚</td></tr><tr><td>Getrange</td><td>è¿”å› key ä¸­å­—ç¬¦ä¸²å€¼çš„å­å­—ç¬¦</td></tr><tr><td>Mset</td><td>åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª key-value å¯¹ã€‚</td></tr><tr><td>Setex</td><td>å°†å€¼ value å…³è”åˆ° key ï¼Œå¹¶å°† key çš„è¿‡æœŸæ—¶é—´è®¾ä¸º seconds (ä»¥ç§’ä¸ºå•ä½)ã€‚</td></tr><tr><td>SET</td><td>è®¾ç½®æŒ‡å®š key çš„å€¼</td></tr><tr><td>Get</td><td>è·å–æŒ‡å®š key çš„å€¼ã€‚</td></tr><tr><td>Getbit</td><td>å¯¹ key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œè·å–æŒ‡å®šåç§»é‡ä¸Šçš„ä½(bit)ã€‚</td></tr><tr><td>Setbit</td><td>å¯¹ key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œè®¾ç½®æˆ–æ¸…é™¤æŒ‡å®šåç§»é‡ä¸Šçš„ä½(bit)ã€‚</td></tr><tr><td>Decr</td><td>å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å‡ä¸€ã€‚</td></tr><tr><td>Decrby</td><td>key æ‰€å‚¨å­˜çš„å€¼å‡å»ç»™å®šçš„å‡é‡å€¼ï¼ˆdecrementï¼‰ ã€‚</td></tr><tr><td>Strlen</td><td>è¿”å› key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼çš„é•¿åº¦ã€‚</td></tr><tr><td>Msetnx</td><td>åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª key-value å¯¹ï¼Œå½“ä¸”ä»…å½“æ‰€æœ‰ç»™å®š key éƒ½ä¸å­˜åœ¨ã€‚</td></tr><tr><td>Incrby</td><td>å°† key æ‰€å‚¨å­˜çš„å€¼åŠ ä¸Šç»™å®šçš„å¢é‡å€¼ï¼ˆincrementï¼‰ ã€‚</td></tr><tr><td>Incrbyfloat</td><td>å°† key æ‰€å‚¨å­˜çš„å€¼åŠ ä¸Šç»™å®šçš„æµ®ç‚¹å¢é‡å€¼ï¼ˆincrementï¼‰ ã€‚</td></tr><tr><td>Setrange</td><td>ç”¨ value å‚æ•°è¦†å†™ç»™å®š key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œä»åç§»é‡ offset å¼€å§‹ã€‚</td></tr><tr><td>Psetex</td><td>è¿™ä¸ªå‘½ä»¤å’Œ SETEX å‘½ä»¤ç›¸ä¼¼ï¼Œä½†å®ƒä»¥æ¯«ç§’ä¸ºå•ä½è®¾ç½® key çš„ç”Ÿå­˜æ—¶é—´ï¼Œè€Œä¸æ˜¯åƒ SETEX å‘½ä»¤é‚£æ ·ï¼Œä»¥ç§’ä¸ºå•ä½ã€‚</td></tr><tr><td>Append</td><td>å¦‚æœ key å·²ç»å­˜åœ¨å¹¶ä¸”æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ APPEND å‘½ä»¤å°† value è¿½åŠ åˆ° key åŸæ¥çš„å€¼çš„æœ«å°¾ã€‚</td></tr><tr><td>Getset</td><td>å°†ç»™å®š key çš„å€¼è®¾ä¸º value ï¼Œå¹¶è¿”å› key çš„æ—§å€¼(old value)ã€‚</td></tr><tr><td>Mget</td><td>è·å–æ‰€æœ‰(ä¸€ä¸ªæˆ–å¤šä¸ª)ç»™å®š key çš„å€¼ã€‚</td></tr><tr><td>Incr</td><td>å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢ä¸€ã€‚</td></tr></tbody></table><h4 id="Redis-å“ˆå¸Œ-Hash-å‘½ä»¤">Redis å“ˆå¸Œ(Hash) å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>Hmset</td><td>åŒæ—¶å°†å¤šä¸ª field-value (åŸŸ-å€¼)å¯¹è®¾ç½®åˆ°å“ˆå¸Œè¡¨ key ä¸­ã€‚</td></tr><tr><td>Hmget</td><td>è·å–æ‰€æœ‰ç»™å®šå­—æ®µçš„å€¼</td></tr><tr><td>Hset</td><td>å°†å“ˆå¸Œè¡¨ key ä¸­çš„å­—æ®µ field çš„å€¼è®¾ä¸º value ã€‚</td></tr><tr><td>Hgetall</td><td>è·å–åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®š key çš„æ‰€æœ‰å­—æ®µå’Œå€¼</td></tr><tr><td>Hget</td><td>è·å–å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®šå­—æ®µçš„å€¼/td&gt;</td></tr><tr><td>Hexists</td><td>æŸ¥çœ‹å“ˆå¸Œè¡¨ key ä¸­ï¼ŒæŒ‡å®šçš„å­—æ®µæ˜¯å¦å­˜åœ¨ã€‚</td></tr><tr><td>Hincrby</td><td>ä¸ºå“ˆå¸Œè¡¨ key ä¸­çš„æŒ‡å®šå­—æ®µçš„æ•´æ•°å€¼åŠ ä¸Šå¢é‡ increment ã€‚</td></tr><tr><td>Hlen</td><td>è·å–å“ˆå¸Œè¡¨ä¸­å­—æ®µçš„æ•°é‡</td></tr><tr><td>Hdel</td><td>åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå“ˆå¸Œè¡¨å­—æ®µ</td></tr><tr><td>Hvals</td><td>è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰å€¼</td></tr><tr><td>Hincrbyfloat</td><td>ä¸ºå“ˆå¸Œè¡¨ key ä¸­çš„æŒ‡å®šå­—æ®µçš„æµ®ç‚¹æ•°å€¼åŠ ä¸Šå¢é‡ increment ã€‚</td></tr><tr><td>Hkeys</td><td>è·å–æ‰€æœ‰å“ˆå¸Œè¡¨ä¸­çš„å­—æ®µ</td></tr><tr><td>Hsetnx</td><td>åªæœ‰åœ¨å­—æ®µ field ä¸å­˜åœ¨æ—¶ï¼Œè®¾ç½®å“ˆå¸Œè¡¨å­—æ®µçš„å€¼ã€‚</td></tr></tbody></table><h4 id="Redis-åˆ—è¡¨-List-å‘½ä»¤">Redis åˆ—è¡¨(List) å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>Lindex</td><td>é€šè¿‡ç´¢å¼•è·å–åˆ—è¡¨ä¸­çš„å…ƒç´ </td></tr><tr><td>Rpush</td><td>åœ¨åˆ—è¡¨ä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå€¼</td></tr><tr><td>Lrange</td><td>è·å–åˆ—è¡¨æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ </td></tr><tr><td>Rpoplpush</td><td>ç§»é™¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å°†è¯¥å…ƒç´ æ·»åŠ åˆ°å¦ä¸€ä¸ªåˆ—è¡¨å¹¶è¿”å›</td></tr><tr><td>Blpop</td><td>ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ å¦‚æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨ç›´åˆ°ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢ã€‚</td></tr><tr><td>Brpop</td><td>ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œ å¦‚æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨ç›´åˆ°ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢ã€‚</td></tr><tr><td>Brpoplpush</td><td>ä»åˆ—è¡¨ä¸­å¼¹å‡ºä¸€ä¸ªå€¼ï¼Œå°†å¼¹å‡ºçš„å…ƒç´ æ’å…¥åˆ°å¦å¤–ä¸€ä¸ªåˆ—è¡¨ä¸­å¹¶è¿”å›å®ƒï¼› å¦‚æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨ç›´åˆ°ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢ã€‚</td></tr><tr><td>Lrem</td><td>ç§»é™¤åˆ—è¡¨å…ƒç´ </td></tr><tr><td>Llen</td><td>è·å–åˆ—è¡¨é•¿åº¦</td></tr><tr><td>Ltrim</td><td>å¯¹ä¸€ä¸ªåˆ—è¡¨è¿›è¡Œä¿®å‰ª(trim)ï¼Œå°±æ˜¯è¯´ï¼Œè®©åˆ—è¡¨åªä¿ç•™æŒ‡å®šåŒºé—´å†…çš„å…ƒç´ ï¼Œä¸åœ¨æŒ‡å®šåŒºé—´ä¹‹å†…çš„å…ƒç´ éƒ½å°†è¢«åˆ é™¤ã€‚</td></tr><tr><td>Lpop</td><td>å‡ºå¹¶è·å–åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ </td></tr><tr><td>Lpushx</td><td>å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ’å…¥åˆ°å·²å­˜åœ¨çš„åˆ—è¡¨å¤´éƒ¨</td></tr><tr><td>Linsert</td><td>åœ¨åˆ—è¡¨çš„å…ƒç´ å‰æˆ–è€…åæ’å…¥å…ƒç´ </td></tr><tr><td>Rpop</td><td>ç§»é™¤å¹¶è·å–åˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´ </td></tr><tr><td>Lset</td><td>é€šè¿‡ç´¢å¼•è®¾ç½®åˆ—è¡¨å…ƒç´ çš„å€¼</td></tr><tr><td>Lpush</td><td>å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨å¤´éƒ¨</td></tr><tr><td>Rpushx</td><td>ä¸ºå·²å­˜åœ¨çš„åˆ—è¡¨æ·»åŠ å€¼</td></tr></tbody></table><h4 id="Redis-é›†åˆ-Set-å‘½ä»¤">Redis é›†åˆ(Set) å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>Sunion</td><td>è¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„å¹¶é›†</td></tr><tr><td>Scard</td><td>è·å–é›†åˆçš„æˆå‘˜æ•°</td></tr><tr><td>Srandmember</td><td>è¿”å›é›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªéšæœºæ•°</td></tr><tr><td>Smembers</td><td>è¿”å›é›†åˆä¸­çš„æ‰€æœ‰æˆå‘˜</td></tr><tr><td>Sinter</td><td>è¿”å›ç»™å®šæ‰€æœ‰é›†åˆçš„äº¤é›†</td></tr><tr><td>Srem</td><td>é™¤é›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</td></tr><tr><td>Smove</td><td>å°† member å…ƒç´ ä» source é›†åˆç§»åŠ¨åˆ° destination é›†åˆ</td></tr><tr><td>Sadd</td><td>å‘é›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</td></tr><tr><td>Sismember</td><td>åˆ¤æ–­ member å…ƒç´ æ˜¯å¦æ˜¯é›†åˆ key çš„æˆå‘˜</td></tr><tr><td>Sdiffstore</td><td>è¿”å›ç»™å®šæ‰€æœ‰é›†åˆçš„å·®é›†å¹¶å­˜å‚¨åœ¨ destination ä¸­</td></tr><tr><td>Sdiff</td><td>è¿”å›ç»™å®šæ‰€æœ‰é›†åˆçš„å·®é›†</td></tr><tr><td>Sscan</td><td>è¿­ä»£é›†åˆä¸­çš„å…ƒç´ </td></tr><tr><td>Sinterstore</td><td>è¿”å›ç»™å®šæ‰€æœ‰é›†åˆçš„äº¤é›†å¹¶å­˜å‚¨åœ¨ destination ä¸­</td></tr><tr><td>Sunionstore</td><td>æ‰€æœ‰ç»™å®šé›†åˆçš„å¹¶é›†å­˜å‚¨åœ¨ destination é›†åˆä¸­</td></tr><tr><td>Spop</td><td>ç§»é™¤å¹¶è¿”å›é›†åˆä¸­çš„ä¸€ä¸ªéšæœºå…ƒç´ </td></tr></tbody></table><h4 id="Redis-æœ‰åºé›†åˆ-sorted-set-å‘½ä»¤">Redis æœ‰åºé›†åˆ(sorted set) å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>Zrevrank</td><td>è¿”å›æœ‰åºé›†åˆä¸­æŒ‡å®šæˆå‘˜çš„æ’åï¼Œæœ‰åºé›†æˆå‘˜æŒ‰åˆ†æ•°å€¼é€’å‡(ä»å¤§åˆ°å°)æ’åº</td></tr><tr><td>Zlexcount</td><td>åœ¨æœ‰åºé›†åˆä¸­è®¡ç®—æŒ‡å®šå­—å…¸åŒºé—´å†…æˆå‘˜æ•°é‡</td></tr><tr><td>Zunionstore</td><td>è®¡ç®—ç»™å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªæœ‰åºé›†çš„å¹¶é›†ï¼Œå¹¶å­˜å‚¨åœ¨æ–°çš„ key ä¸­</td></tr><tr><td>Zremrangebyrank</td><td>ç§»é™¤æœ‰åºé›†åˆä¸­ç»™å®šçš„æ’ååŒºé—´çš„æ‰€æœ‰æˆå‘˜</td></tr><tr><td>Zcard</td><td>è·å–æœ‰åºé›†åˆçš„æˆå‘˜æ•°</td></tr><tr><td>Zrem</td><td>ç§»é™¤æœ‰åºé›†åˆä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</td></tr><tr><td>Zinterstore</td><td>è®¡ç®—ç»™å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªæœ‰åºé›†çš„äº¤é›†å¹¶å°†ç»“æœé›†å­˜å‚¨åœ¨æ–°çš„æœ‰åºé›†åˆ key ä¸­</td></tr><tr><td>Zrank</td><td>è¿”å›æœ‰åºé›†åˆä¸­æŒ‡å®šæˆå‘˜çš„ç´¢å¼•</td></tr><tr><td>Zincrby</td><td>æœ‰åºé›†åˆä¸­å¯¹æŒ‡å®šæˆå‘˜çš„åˆ†æ•°åŠ ä¸Šå¢é‡ increment</td></tr><tr><td>Zrangebyscore</td><td>é€šè¿‡åˆ†æ•°è¿”å›æœ‰åºé›†åˆæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜</td></tr><tr><td>Zrangebylex</td><td>é€šè¿‡å­—å…¸åŒºé—´è¿”å›æœ‰åºé›†åˆçš„æˆå‘˜</td></tr><tr><td>Zscore</td><td>è¿”å›æœ‰åºé›†ä¸­ï¼Œæˆå‘˜çš„åˆ†æ•°å€¼</td></tr><tr><td>Zremrangebyscore</td><td>ç§»é™¤æœ‰åºé›†åˆä¸­ç»™å®šçš„åˆ†æ•°åŒºé—´çš„æ‰€æœ‰æˆå‘˜</td></tr><tr><td>Zscan</td><td>è¿­ä»£æœ‰åºé›†åˆä¸­çš„å…ƒç´ ï¼ˆåŒ…æ‹¬å…ƒç´ æˆå‘˜å’Œå…ƒç´ åˆ†å€¼ï¼‰</td></tr><tr><td>Zrevrangebyscore</td><td>è¿”å›æœ‰åºé›†ä¸­æŒ‡å®šåˆ†æ•°åŒºé—´å†…çš„æˆå‘˜ï¼Œåˆ†æ•°ä»é«˜åˆ°ä½æ’åº</td></tr><tr><td>Zremrangebylex</td><td>ç§»é™¤æœ‰åºé›†åˆä¸­ç»™å®šçš„å­—å…¸åŒºé—´çš„æ‰€æœ‰æˆå‘˜</td></tr><tr><td>Zrevrange</td><td>è¿”å›æœ‰åºé›†ä¸­æŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ï¼Œé€šè¿‡ç´¢å¼•ï¼Œåˆ†æ•°ä»é«˜åˆ°åº•</td></tr><tr><td>Zrange</td><td>é€šè¿‡ç´¢å¼•åŒºé—´è¿”å›æœ‰åºé›†åˆæˆæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜</td></tr><tr><td>Zcount</td><td>è®¡ç®—åœ¨æœ‰åºé›†åˆä¸­æŒ‡å®šåŒºé—´åˆ†æ•°çš„æˆå‘˜æ•°</td></tr><tr><td>Zadd</td><td>å‘æœ‰åºé›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ï¼Œæˆ–è€…æ›´æ–°å·²å­˜åœ¨æˆå‘˜çš„åˆ†æ•°</td></tr></tbody></table><h4 id="Redis-è¿æ¥-å‘½ä»¤">Redis è¿æ¥ å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>Echo</td><td>æ‰“å°å­—ç¬¦ä¸²</td></tr><tr><td>Select</td><td>åˆ‡æ¢åˆ°æŒ‡å®šçš„æ•°æ®åº“</td></tr><tr><td>Ping</td><td>æŸ¥çœ‹æœåŠ¡æ˜¯å¦è¿è¡Œ</td></tr><tr><td>Quit</td><td>å…³é—­å½“å‰è¿æ¥</td></tr><tr><td>Auth</td><td>éªŒè¯å¯†ç æ˜¯å¦æ­£ç¡®</td></tr></tbody></table><h4 id="Redis-æœåŠ¡å™¨-å‘½ä»¤">Redis æœåŠ¡å™¨ å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>Client Pause</td><td>åœ¨æŒ‡å®šæ—¶é—´å†…ç»ˆæ­¢è¿è¡Œæ¥è‡ªå®¢æˆ·ç«¯çš„å‘½ä»¤</td></tr><tr><td>Debug Object</td><td>è·å– key çš„è°ƒè¯•ä¿¡æ¯</td></tr><tr><td>Flushdb</td><td>åˆ é™¤å½“å‰æ•°æ®åº“çš„æ‰€æœ‰key</td></tr><tr><td>Save</td><td>å¼‚æ­¥ä¿å­˜æ•°æ®åˆ°ç¡¬ç›˜</td></tr><tr><td>Showlog</td><td>ç®¡ç† redis çš„æ…¢æ—¥å¿—</td></tr><tr><td>Lastsave</td><td>è¿”å›æœ€è¿‘ä¸€æ¬¡ Redis æˆåŠŸå°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Šçš„æ—¶é—´ï¼Œä»¥ UNIX æ—¶é—´æˆ³æ ¼å¼è¡¨ç¤º</td></tr><tr><td>Config Get</td><td>è·å–æŒ‡å®šé…ç½®å‚æ•°çš„å€¼</td></tr><tr><td>Command</td><td>è·å– Redis å‘½ä»¤è¯¦æƒ…æ•°ç»„</td></tr><tr><td>Slaveof</td><td>å°†å½“å‰æœåŠ¡å™¨è½¬å˜ä¸ºæŒ‡å®šæœåŠ¡å™¨çš„ä»å±æœåŠ¡å™¨(slave server)</td></tr><tr><td>Debug Segfault</td><td>è®© Redis æœåŠ¡å´©æºƒ</td></tr><tr><td>Flushall</td><td>åˆ é™¤æ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰key</td></tr><tr><td>Dbsize</td><td>è¿”å›å½“å‰æ•°æ®åº“çš„ key çš„æ•°é‡</td></tr><tr><td>Bgrewriteaof</td><td>å¼‚æ­¥æ‰§è¡Œä¸€ä¸ª AOFï¼ˆAppendOnly Fileï¼‰ æ–‡ä»¶é‡å†™æ“ä½œ</td></tr><tr><td>Cluster Slots</td><td>è·å–é›†ç¾¤èŠ‚ç‚¹çš„æ˜ å°„æ•°ç»„</td></tr><tr><td>Config Set</td><td>ä¿®æ”¹ redis é…ç½®å‚æ•°ï¼Œæ— éœ€é‡å¯</td></tr><tr><td>Command Info</td><td>è·å–æŒ‡å®š Redis å‘½ä»¤æè¿°çš„æ•°ç»„</td></tr><tr><td>Shutdown</td><td>å¼‚æ­¥ä¿å­˜æ•°æ®åˆ°ç¡¬ç›˜ï¼Œå¹¶å…³é—­æœåŠ¡å™¨</td></tr><tr><td>Sync</td><td>ç”¨äºå¤åˆ¶åŠŸèƒ½(replication)çš„å†…éƒ¨å‘½ä»¤</td></tr><tr><td>Client Kill</td><td>å…³é—­å®¢æˆ·ç«¯è¿æ¥</td></tr><tr><td>Role</td><td>è¿”å›ä¸»ä»å®ä¾‹æ‰€å±çš„è§’è‰²</td></tr><tr><td>Monitor</td><td>å®æ—¶æ‰“å°å‡º Redis æœåŠ¡å™¨æ¥æ”¶åˆ°çš„å‘½ä»¤ï¼Œè°ƒè¯•ç”¨</td></tr><tr><td>Command Getkeys</td><td>è·å–ç»™å®šå‘½ä»¤çš„æ‰€æœ‰é”®</td></tr><tr><td>Client Getname</td><td>è·å–è¿æ¥çš„åç§°</td></tr><tr><td>Config Resetstat</td><td>é‡ç½® INFO å‘½ä»¤ä¸­çš„æŸäº›ç»Ÿè®¡æ•°æ®</td></tr><tr><td>Command Count</td><td>è·å– Redis å‘½ä»¤æ€»æ•°</td></tr><tr><td>Time</td><td>è¿”å›å½“å‰æœåŠ¡å™¨æ—¶é—´</td></tr><tr><td>Info</td><td>è·å– Redis æœåŠ¡å™¨çš„å„ç§ä¿¡æ¯å’Œç»Ÿè®¡æ•°å€¼</td></tr><tr><td>Config rewrite</td><td>å¯¹å¯åŠ¨ Redis æœåŠ¡å™¨æ—¶æ‰€æŒ‡å®šçš„ redis.conf é…ç½®æ–‡ä»¶è¿›è¡Œæ”¹å†™</td></tr><tr><td>Client List</td><td>è·å–è¿æ¥åˆ°æœåŠ¡å™¨çš„å®¢æˆ·ç«¯è¿æ¥åˆ—è¡¨</td></tr><tr><td>Client Setname</td><td>è®¾ç½®å½“å‰è¿æ¥çš„åç§°</td></tr><tr><td>Bgsave</td><td>åœ¨åå°å¼‚æ­¥ä¿å­˜å½“å‰æ•°æ®åº“çš„æ•°æ®åˆ°ç£ç›˜</td></tr></tbody></table><h4 id="Redis-è„šæœ¬-å‘½ä»¤">Redis è„šæœ¬ å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>Script kill</td><td>æ€æ­»å½“å‰æ­£åœ¨è¿è¡Œçš„ Lua è„šæœ¬ã€‚</td></tr><tr><td>Script Load</td><td>å°†è„šæœ¬ script æ·»åŠ åˆ°è„šæœ¬ç¼“å­˜ä¸­ï¼Œä½†å¹¶ä¸ç«‹å³æ‰§è¡Œè¿™ä¸ªè„šæœ¬ã€‚</td></tr><tr><td>Eval</td><td>æ‰§è¡Œ Lua è„šæœ¬ã€‚</td></tr><tr><td>Evalsha</td><td>æ‰§è¡Œ Lua è„šæœ¬ã€‚</td></tr><tr><td>Script Exists</td><td>æŸ¥çœ‹æŒ‡å®šçš„è„šæœ¬æ˜¯å¦å·²ç»è¢«ä¿å­˜åœ¨ç¼“å­˜å½“ä¸­ã€‚</td></tr><tr><td>Script Flush</td><td>ä»è„šæœ¬ç¼“å­˜ä¸­ç§»é™¤æ‰€æœ‰è„šæœ¬ã€‚</td></tr></tbody></table><h4 id="Redis-äº‹åŠ¡-å‘½ä»¤">Redis äº‹åŠ¡ å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>Exec</td><td>æ‰§è¡Œæ‰€æœ‰äº‹åŠ¡å—å†…çš„å‘½ä»¤ã€‚</td></tr><tr><td>Watch</td><td>ç›‘è§†ä¸€ä¸ª(æˆ–å¤šä¸ª) key ï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ª(æˆ–è¿™äº›) key è¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­ã€‚</td></tr><tr><td>Discard</td><td>å–æ¶ˆäº‹åŠ¡ï¼Œæ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡å—å†…çš„æ‰€æœ‰å‘½ä»¤ã€‚</td></tr><tr><td>Unwatch</td><td>å–æ¶ˆ WATCH å‘½ä»¤å¯¹æ‰€æœ‰ key çš„ç›‘è§†ã€‚</td></tr><tr><td>Multi</td><td>æ ‡è®°ä¸€ä¸ªäº‹åŠ¡å—çš„å¼€å§‹ã€‚</td></tr></tbody></table><h4 id="Redis-HyperLogLog-å‘½ä»¤">Redis HyperLogLog å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>Pgmerge</td><td>å°†å¤šä¸ª HyperLogLog åˆå¹¶ä¸ºä¸€ä¸ª HyperLogLog</td></tr><tr><td>Pfadd</td><td>æ·»åŠ æŒ‡å®šå…ƒç´ åˆ° HyperLogLog ä¸­ã€‚</td></tr><tr><td>Pfcount</td><td>è¿”å›ç»™å®š HyperLogLog çš„åŸºæ•°ä¼°ç®—å€¼ã€‚</td></tr></tbody></table><h4 id="Redis-å‘å¸ƒè®¢é˜…-å‘½ä»¤">Redis å‘å¸ƒè®¢é˜… å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>Unsubscribe</td><td>æŒ‡é€€è®¢ç»™å®šçš„é¢‘é“ã€‚</td></tr><tr><td>Subscribe</td><td>è®¢é˜…ç»™å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“çš„ä¿¡æ¯ã€‚</td></tr><tr><td>Pubsub</td><td>æŸ¥çœ‹è®¢é˜…ä¸å‘å¸ƒç³»ç»ŸçŠ¶æ€ã€‚</td></tr><tr><td>Punsubscribe</td><td>é€€è®¢æ‰€æœ‰ç»™å®šæ¨¡å¼çš„é¢‘é“ã€‚</td></tr><tr><td>Publish</td><td>å°†ä¿¡æ¯å‘é€åˆ°æŒ‡å®šçš„é¢‘é“ã€‚</td></tr><tr><td>Psubscribe</td><td>è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªç¬¦åˆç»™å®šæ¨¡å¼çš„é¢‘é“ã€‚</td></tr></tbody></table><h4 id="Redis-åœ°ç†ä½ç½®-geo-å‘½ä»¤">Redis åœ°ç†ä½ç½®(geo) å‘½ä»¤</h4><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td>GEOHASH</td><td>è¿”å›ä¸€ä¸ªæˆ–å¤šä¸ªä½ç½®å…ƒç´ çš„ Geohash è¡¨ç¤º</td></tr><tr><td>GEOPOS</td><td>ä»keyé‡Œè¿”å›æ‰€æœ‰ç»™å®šä½ç½®å…ƒç´ çš„ä½ç½®ï¼ˆç»åº¦å’Œçº¬åº¦ï¼‰</td></tr><tr><td>GEODIST</td><td>è¿”å›ä¸¤ä¸ªç»™å®šä½ç½®ä¹‹é—´çš„è·ç¦»</td></tr><tr><td>GEORADIUS</td><td>ä»¥ç»™å®šçš„ç»çº¬åº¦ä¸ºä¸­å¿ƒï¼Œ æ‰¾å‡ºæŸä¸€åŠå¾„å†…çš„å…ƒç´ </td></tr><tr><td>GEOADD</td><td>å°†æŒ‡å®šçš„åœ°ç†ç©ºé—´ä½ç½®ï¼ˆçº¬åº¦ã€ç»åº¦ã€åç§°ï¼‰æ·»åŠ åˆ°æŒ‡å®šçš„keyä¸­</td></tr><tr><td>GEORADIUSBYMEMBER</td><td>æ‰¾å‡ºä½äºæŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ ï¼Œä¸­å¿ƒç‚¹æ˜¯ç”±ç»™å®šçš„ä½ç½®å…ƒç´ å†³å®š</td></tr></tbody></table><h3 id="å¦‚ä½•åœ¨Redisä¸­ä½¿ç”¨æ‚²è§‚é”å’Œä¹è§‚é”">å¦‚ä½•åœ¨Redisä¸­ä½¿ç”¨æ‚²è§‚é”å’Œä¹è§‚é”</h3><p>ä¹è§‚é”ä¸€èˆ¬é‡‡å–çš„æ–¹å¼ï¼š</p><p>è·å–ç‰ˆæœ¬å·ï¼Œä¹Ÿå°±æ˜¯version</p><p>ç„¶åæ›´æ–°çš„æ—¶å€™æ¯”è¾ƒç‰ˆæœ¬å·</p><blockquote><p>Redisæ£€æµ‹æµ‹è¯•</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; select 2  é€‰æ‹©æ•°æ®åº“</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[2]&gt; <span class="built_in">set</span> money 100  </span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[2]&gt; <span class="built_in">set</span> out 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[2]&gt; watch money <span class="comment">#ç›‘è§†moneyå¯¹è±¡</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[2]&gt; multi <span class="comment"># äº‹åŠ¡æ­£å¸¸ç»“æŸï¼Œæ•°æ®æ²¡æœ‰å‘ç”Ÿå˜åŠ¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ­£å¸¸æ‰§è¡ŒæˆåŠŸ</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379[2](TX)&gt; decrby money 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379[2](TX)&gt; incrby out 20</span><br><span class="line">QUEUED</span><br></pre></td></tr></table></figure><p>ä¹è§‚é”</p><p>æµç¨‹</p><ol><li>å…ˆ<strong>watch   key</strong> ç›‘è§†</li><li>ç„¶å         <strong>multi</strong>          ç›‘æµ‹äº‹åŠ¡,ç›‘æµ‹äº‹åŠ¡æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœæ²¡æœ‰å˜åŒ–é‚£å°±å¯ä»¥æ‰§è¡ŒæˆåŠŸï¼Œå¦‚æœå‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆå¯¹ä¸èµ·ï¼Œæ‰§è¡Œå¤±è´¥</li><li>å¦‚æœå‘ç°äº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œé‚£ä¹ˆå°±å…ˆè§£é”          ä¹Ÿå°±æ˜¯<strong>unwatch</strong></li><li>è·å–æœ€æ–°çš„å€¼ï¼Œå†æ¬¡ç›‘è§†ï¼Œselect version , <strong>watch key</strong><br>. <strong>decrby key</strong> å€¼ å‡å°‘<br>. <strong>incrby key</strong> å€¼ å¢åŠ </li></ol><h3 id="Jedis">Jedis</h3><p>:arrow_down_small:æ˜¯javaæ“ä½œredisä¸­çš„ä¸­é—´ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¯¼å…¥jedisçš„åŒ…--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.41<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªnew Jediså¯¹è±¡</span></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.1.100&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        <span class="comment">//jedisæ‰€æœ‰çš„æŒ‡ä»¤å°±æ˜¯æˆ‘ä»¬å­¦çš„æ‰€æœ‰çš„æŒ‡ä»¤</span></span><br><span class="line">        System.out.println(jedis.ping());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><p>PONG  è¯´æ˜é“¾æ¥æˆåŠŸ</p><h3 id="Redisäº‹åŠ¡">Redisäº‹åŠ¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">redisçš„äº‹åŠ¡å¤„ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Redis</span>äº‹åŠ¡ &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//å¼€å¯é“¾æ¥</span></span><br><span class="line">        <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;192.168.1.100&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        <span class="comment">//æ¸…ç©ºå½“å‰æ•°æ®åº“</span></span><br><span class="line">        jedis.flushDB();</span><br><span class="line">        <span class="comment">//å°†æ•°æ®è½¬æ¢ä¸ºjsonæ ¼å¼ï¼Œç›®å‰å…¬å¸å¤§éƒ¨åˆ†ä½¿ç”¨çš„å‡æ˜¯json</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        jsonObject.put(<span class="string">&quot;u1&quot;</span>,<span class="string">&quot;æˆ‘å–œæ¬¢&quot;</span>);</span><br><span class="line">        jsonObject.put(<span class="string">&quot;u2&quot;</span>,<span class="string">&quot;ä½ &quot;</span>);</span><br><span class="line">        <span class="comment">//å¼€å¯äº‹åŠ¡</span></span><br><span class="line">        <span class="type">Transaction</span> <span class="variable">multi</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> jsonObject.toJSONString();</span><br><span class="line">        <span class="comment">//  System.out.println(jedis.ping());</span></span><br><span class="line">        <span class="comment">//å¦‚æœæˆ‘éœ€è¦ç›‘æ§ï¼Œé‚£ä¹ˆæˆ‘å°±éœ€è¦åŠ ä¸€ä¸ªä¹è§‚é”</span></span><br><span class="line">        jedis.watch(result);<span class="comment">//åŠ ä¸€ä¸ªé”</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            multi.set(<span class="string">&quot;u1&quot;</span>,result);</span><br><span class="line">            multi.set(<span class="string">&quot;u2&quot;</span>,result);</span><br><span class="line">            <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">            multi.exec();<span class="comment">//å¦‚æœæˆåŠŸæ‰§è¡Œäº‹åŠ¡</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            multi.discard(); <span class="comment">//å¦‚æœå¤±è´¥äº†ï¼Œé‚£ä¹ˆå°±äº‹åŠ¡å›æ»šï¼Œæˆ–è€…äº‹åŠ¡æ”¾å¼ƒ</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(jedis.get(<span class="string">&quot;u1&quot;</span>));</span><br><span class="line">            System.out.println(jedis.get(<span class="string">&quot;u2&quot;</span>));</span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//multi.set(&quot;u1&quot;,&quot;è€èƒ¡&quot;);</span></span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">        HashMap map = new HashMap();</span></span><br><span class="line"><span class="comment">        String ke = &quot;k1&quot;;</span></span><br><span class="line"><span class="comment">        map.put(ke,&quot;å°é»‘&quot;);</span></span><br><span class="line"><span class="comment">        map.put(ke,&quot;ä½ å¥½&quot;);</span></span><br><span class="line"><span class="comment">        System.out.println(map);</span></span><br><span class="line"><span class="comment">        System.out.println(map.size());</span></span><br><span class="line"><span class="comment">        &#123;k1=ä½ å¥½&#125;</span></span><br><span class="line"><span class="comment">            1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">        <span class="comment">//è¿æ¥å…³é—­</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="SpringBootæ•´åˆRedis">SpringBootæ•´åˆRedis</h3><p>springBootæ“ä½œæ•°æ®ï¼š spring-data jpa JDBC MONGODB  Redis</p><blockquote><p>æ³¨æ„åœ¨springBoot 2.xä¹‹åï¼ŒåŸæ¥çš„rediséƒ½è¢«æ›¿æ¢ä¸ºlettuce</p></blockquote><p>Jedis ï¼š é‡‡ç”¨çš„ç›´è¿ï¼Œå¤šä¸ªçº¿ç¨‹æ“ä½œçš„è¯æ˜¯ä¸å®‰å…¨çš„ï¼Œå¦‚æœæƒ³è¦é¿å…ä¸å®‰å…¨ï¼Œä½¿ç”¨jedis poolé“¾æ¥æ± ã€‚BIO</p><p>lettuceï¼šé‡‡ç”¨nettyï¼Œå®ä¾‹å¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸‹ä½¿ç”¨ï¼Œä¸å­˜åœ¨çº¿ç¨‹ä¸å®‰å…¨çš„æƒ…å†µï¼Œå¯ä»¥å‡å°‘çº¿ç¨‹æ•°æ®ï¼Œæ›´åŠ åƒNIOæ¨¡å¼ã€‚</p><ol><li><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¯¼å…¥jedisçš„åŒ…--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.41<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é…ç½®redis</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure></li><li><p>æµ‹è¯•</p><p>æºç åˆ†æ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">    proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;RedisOperations.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;RedisProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedisAutoConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean( //åªæœ‰åœ¨æ²¡æœ‰çš„æ—¶å€™ä½¿ç”¨ï¼Œæ•…è€Œï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªRedisTemplate</span></span><br><span class="line"><span class="meta">        name = &#123;&quot;redisTemplate&quot;&#125;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">        <span class="comment">//é»˜è®¤çš„ï¼ŒredisTemplate ï¼Œæ²¡æœ‰è¿‡å¤šçš„è®¾ç½®ï¼Œrediså¯¹è±¡éƒ½æ˜¯éœ€è¦åºåˆ—åŒ–</span></span><br><span class="line">    <span class="comment">//ä¸¤ä¸ªæ³›å‹è¯»ä¹¦Object,Objectçš„ç±»å‹ï¼Œæˆ‘ä»¬ä½¿ç”¨éœ€è¦å¼ºåˆ¶è½¬æ¢ä¸º&lt;String,Obeject&gt;</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> <span class="keyword">throws</span> UnknownHostException &#123;</span><br><span class="line">        RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="comment">//ç”±äºStringæ˜¯Redisçš„æœ€å¸¸ä½¿ç”¨çš„ç±»å‹ï¼Œæ‰€ä»¥ä½†å¯¹æå‡ºæ¥äº†ä¸€ä¸ªbean</span></span><br><span class="line">    <span class="keyword">public</span> StringRedisTemplate <span class="title function_">stringRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> <span class="keyword">throws</span> UnknownHostException &#123;</span><br><span class="line">        <span class="type">StringRedisTemplate</span> <span class="variable">template</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringRedisTemplate</span>();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RedisSpringBootApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">        redisTemplate æ“ä½œä¸åŒçš„æ•°æ®ç±»å‹ã€‚apiå’Œæˆ‘ä»¬çš„æŒ‡ä»¤æ˜¯ä¸€æ ·çš„</span></span><br><span class="line"><span class="comment">        opsForValue  æ“ä½œå­—ç¬¦ä¸²ï¼Œç±»ä¼¼String</span></span><br><span class="line"><span class="comment">        opsForList æ“ä½œlist ç›¸å½“äºlist</span></span><br><span class="line"><span class="comment">        opsForSet</span></span><br><span class="line"><span class="comment">        opsForHash</span></span><br><span class="line"><span class="comment">        opsForZSet</span></span><br><span class="line"><span class="comment">        opsForGeo</span></span><br><span class="line"><span class="comment">        opsForHyperLogLogLog</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        é™¤äº†åŸºæœ¬çš„æ“ä½œï¼Œæˆ‘ä»¬å¸¸ç”¨æ–¹æ³•éƒ½å¯ä»¥ä½¿ç”¨redisTemplateæ“ä½œ</span></span><br><span class="line"><span class="comment">        æ¯”å¦‚äº‹åŠ¡å’ŒåŸºæœ¬çš„æ“ä½œ</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        è·å–redisçš„é“¾æ¥å¯¹è±¡</span></span><br><span class="line"><span class="comment">        RedisConnection redisConnection = redisTemplate.getConnectionFactory().getConnection();</span></span><br><span class="line"><span class="comment">        redisConnection.flushDb();</span></span><br><span class="line"><span class="comment">        redisConnection.flushAll();</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;k&quot;</span>,<span class="number">123</span>);</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;k1&quot;</span>,<span class="string">&quot;ç½—å°é»‘&quot;</span>);</span><br><span class="line">        System.out.println(redisTemplate.opsForValue().get(<span class="string">&quot;k&quot;</span>));</span><br><span class="line">        System.out.println(redisTemplate.opsForValue().get(<span class="string">&quot;k1&quot;</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®ä¿¡æ¯ï¼›</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xh<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Redis_SpringBoot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Redis_SpringBoot<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Redis_SpringBoot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>2.3.7.RELEASE<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--   é‡ç‚¹jacksonï¼Œæ˜¯æˆ‘ä»¬å°†redisçš„æ ¼å¼è½¬æ¢ä¸ºredisæ ¼å¼ï¼Œæ–¹ä¾¿æˆ‘ä»¬æœ€ç›´è§‚çš„æŸ¥çœ‹     --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis-reactive<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.taobao.arthas<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>arthas-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.projectreactor<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>reactor-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.xh.redis_springboot.RedisSpringBootApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰RedisTemplate</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Title è‡ªå®šä¹‰ä¸€ä¸ªTemplate</span></span><br><span class="line"><span class="comment"> * @Description </span></span><br><span class="line"><span class="comment"> * @author  ç½—å°é»‘</span></span><br><span class="line"><span class="comment"> * @param null</span></span><br><span class="line"><span class="comment"> * @return </span></span><br><span class="line"><span class="comment"> * @date 2022/10/12 19:34</span></span><br><span class="line"><span class="comment"> * @email </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Redis_self_RedisTemplate</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span></span><br><span class="line">            <span class="keyword">throws</span> UnknownHostException &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;String, Object&gt;();</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åºåˆ—åŒ–é…ç½®</span></span><br><span class="line">        <span class="comment">// jsonåºåˆ—åŒ–é…ç½®</span></span><br><span class="line">        <span class="type">Jackson2JsonRedisSerializer</span> <span class="variable">objectJackson2JsonRedisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class);</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        <span class="comment">// Stringåºåˆ—åŒ–é…ç½®</span></span><br><span class="line">        <span class="type">StringRedisSerializer</span> <span class="variable">stringRedisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line"></span><br><span class="line">        template.setHashValueSerializer(objectJackson2JsonRedisSerializer);</span><br><span class="line">        template.setValueSerializer(objectJackson2JsonRedisSerializer);</span><br><span class="line"></span><br><span class="line">        template.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line">        template.setKeySerializer(stringRedisSerializer);</span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰RedisUtilå·¥å…·ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xh.redis_springboot.Util;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnection;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Title æˆ‘ä»¬åœ¨ä½¿ç”¨Redisçš„æ—¶å€™é€šå¸¸ä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> * @Description è¿™æ˜¯ä¸€ç§æ€æƒ³ï¼Œä¸€ç§å°è£…é‡ç”¨çš„æ€æƒ³ï¼Œé¿å…æˆ‘ä»¬ç›´æ¥å»ä½¿ç”¨redisè‡ªå¸¦çš„æŒ‡ä»¤</span></span><br><span class="line"><span class="comment"> * @author  ç½—å°é»‘</span></span><br><span class="line"><span class="comment"> * @param null</span></span><br><span class="line"><span class="comment"> * @return</span></span><br><span class="line"><span class="comment"> * @date 2022/10/12 20:19</span></span><br><span class="line"><span class="comment"> * @email 2844135670@qq.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisUtil</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//============================Common=============================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å…³é—­</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–é“¾æ¥ç„¶åå¯¼å…¥</span></span><br><span class="line">        <span class="type">RedisConnection</span> <span class="variable">redisConnection</span> <span class="operator">=</span> Objects.requireNonNull(redisTemplate.getConnectionFactory()).getConnection();</span><br><span class="line">        redisConnection.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¸…ç©º</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">flushDB</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">RedisConnection</span> <span class="variable">redisConnection</span> <span class="operator">=</span> Objects.requireNonNull(redisTemplate.getConnectionFactory()).getConnection();</span><br><span class="line">        redisConnection.flushDb();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŒ‡å®šç¼“å­˜å¤±æ•ˆæ—¶é—´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time æ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">expire</span><span class="params">(String key, Long time)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                redisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®key è·å–è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”® ä¸èƒ½ä¸ºnull</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ—¶é—´(ç§’) è¿”å›0ä»£è¡¨ä¸ºæ°¸ä¹…æœ‰æ•ˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getExpire</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.getExpire(key, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true å­˜åœ¨ falseä¸å­˜åœ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">hasKey</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.hasKey(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤ç¼“å­˜</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key å¯ä»¥ä¼ ä¸€ä¸ªå€¼ æˆ–å¤šä¸ª</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">del</span><span class="params">(String... key)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (key != <span class="literal">null</span> &amp;&amp; key.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (key.length == <span class="number">1</span>) &#123;</span><br><span class="line">                redisTemplate.delete(key[<span class="number">0</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                redisTemplate.delete(Arrays.asList(key));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//============================String=============================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ™®é€šç¼“å­˜è·å–</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> key == <span class="literal">null</span> ? <span class="literal">null</span> : redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ™®é€šç¼“å­˜æ”¾å…¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> trueæˆåŠŸ falseå¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">set</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForValue().set(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ™®é€šç¼“å­˜æ”¾å…¥å¹¶è®¾ç½®æ—¶é—´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  æ—¶é—´(ç§’) timeè¦å¤§äº0 å¦‚æœtimeå°äºç­‰äº0 å°†è®¾ç½®æ— é™æœŸ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> trueæˆåŠŸ false å¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">set</span><span class="params">(String key, Object value, Long time)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                set(key, value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€’å¢</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delta è¦å¢åŠ å‡ (å¤§äº0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">incr</span><span class="params">(String key, Long delta)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;é€’å¢å› å­å¿…é¡»å¤§äº0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€’å‡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delta è¦å‡å°‘å‡ (å°äº0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">decr</span><span class="params">(String key, Long delta)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;é€’å‡å› å­å¿…é¡»å¤§äº0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, -delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//================================Map=================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashGet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  é”® ä¸èƒ½ä¸ºnull</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item é¡¹ ä¸èƒ½ä¸ºnull</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">hget</span><span class="params">(String key, String item)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().get(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–hashKeyå¯¹åº”çš„æ‰€æœ‰é”®å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¯¹åº”çš„å¤šä¸ªé”®å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;Object, Object&gt; <span class="title function_">hmget</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().entries(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map å¯¹åº”å¤šä¸ªé”®å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true æˆåŠŸ false å¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet å¹¶è®¾ç½®æ—¶é—´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map  å¯¹åº”å¤šä¸ªé”®å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time æ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> trueæˆåŠŸ falseå¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map, Long time)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®,å¦‚æœä¸å­˜åœ¨å°†åˆ›å»º</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item  é¡¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true æˆåŠŸ falseå¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">hset</span><span class="params">(String key, String item, Object value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®,å¦‚æœä¸å­˜åœ¨å°†åˆ›å»º</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item  é¡¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  æ—¶é—´(ç§’)  æ³¨æ„:å¦‚æœå·²å­˜åœ¨çš„hashè¡¨æœ‰æ—¶é—´,è¿™é‡Œå°†ä¼šæ›¿æ¢åŸæœ‰çš„æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true æˆåŠŸ falseå¤±è´¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">hset</span><span class="params">(String key, String item, Object value, Long time)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤hashè¡¨ä¸­çš„å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  é”® ä¸èƒ½ä¸ºnull</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item é¡¹ å¯ä»¥ä½¿å¤šä¸ª ä¸èƒ½ä¸ºnull</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hdel</span><span class="params">(String key, Object... item)</span> &#123;</span><br><span class="line">        redisTemplate.opsForHash().delete(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­hashè¡¨ä¸­æ˜¯å¦æœ‰è¯¥é¡¹çš„å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  é”® ä¸èƒ½ä¸ºnull</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item é¡¹ ä¸èƒ½ä¸ºnull</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true å­˜åœ¨ falseä¸å­˜åœ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">hHasKey</span><span class="params">(String key, String item)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().hasKey(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hashé€’å¢ å¦‚æœä¸å­˜åœ¨,å°±ä¼šåˆ›å»ºä¸€ä¸ª å¹¶æŠŠæ–°å¢åçš„å€¼è¿”å›</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item é¡¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by   è¦å¢åŠ å‡ (å¤§äº0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">hincr</span><span class="params">(String key, String item, <span class="type">double</span> by)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hashé€’å‡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item é¡¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by   è¦å‡å°‘è®°(å°äº0)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">hdecr</span><span class="params">(String key, String item, <span class="type">double</span> by)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, -by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//============================set=============================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®keyè·å–Setä¸­çš„æ‰€æœ‰å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Set&lt;Object&gt; <span class="title function_">sGet</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().members(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®valueä»ä¸€ä¸ªsetä¸­æŸ¥è¯¢,æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true å­˜åœ¨ falseä¸å­˜åœ¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">sHasKey</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().isMember(key, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æ•°æ®æ”¾å…¥setç¼“å­˜</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values å€¼ å¯ä»¥æ˜¯å¤šä¸ª</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æˆåŠŸä¸ªæ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">sSet</span><span class="params">(String key, Object... values)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().add(key, values);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†setæ•°æ®æ”¾å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time   æ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values å€¼ å¯ä»¥æ˜¯å¤šä¸ª</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æˆåŠŸä¸ªæ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">sSetAndTime</span><span class="params">(String key, Long time, Object... values)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> redisTemplate.opsForSet().add(key, values);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–setç¼“å­˜çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">sGetSetSize</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§»é™¤å€¼ä¸ºvalueçš„</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values å€¼ å¯ä»¥æ˜¯å¤šä¸ª</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç§»é™¤çš„ä¸ªæ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">setRemove</span><span class="params">(String key, Object... values)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().remove(key, values);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//===============================list=================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–listç¼“å­˜çš„å†…å®¹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> start å¼€å§‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end   ç»“æŸ  0 åˆ° -1ä»£è¡¨æ‰€æœ‰å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">lGet</span><span class="params">(String key, Long start, Long end)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().range(key, start, end);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–listç¼“å­˜çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">lGetListSize</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡ç´¢å¼• è·å–listä¸­çš„å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index ç´¢å¼•  index&gt;=0æ—¶ï¼Œ 0 è¡¨å¤´ï¼Œ1 ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨ï¼›index&lt;0æ—¶ï¼Œ-1ï¼Œè¡¨å°¾ï¼Œ-2å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">lGetIndex</span><span class="params">(String key, Long index)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().index(key, index);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†listæ”¾å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">lSet</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†listæ”¾å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  æ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">lSet</span><span class="params">(String key, Object value, Long time)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†listæ”¾å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">lSet</span><span class="params">(String key, List&lt;Object&gt; value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†listæ”¾å…¥ç¼“å­˜</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  æ—¶é—´(ç§’)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">lSet</span><span class="params">(String key, List&lt;Object&gt; value, Long time)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ç´¢å¼•ä¿®æ”¹listä¸­çš„æŸæ¡æ•°æ®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index ç´¢å¼•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">lUpdateIndex</span><span class="params">(String key, Long index, Object value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().set(key, index, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç§»é™¤Nä¸ªå€¼ä¸ºvalue</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   é”®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> count ç§»é™¤å¤šå°‘ä¸ª</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç§»é™¤çš„ä¸ªæ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">lRemove</span><span class="params">(String key, Long count, Object value)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().remove(key, count, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><p>æ‰€æœ‰çš„Redisæ“ä½œï¼Œå…¶å®éƒ½å¾ˆç®€å•ï¼Œä¸»è¦çš„æ˜¯ç†è§£redisçš„æ€æƒ³å’Œå…¶ä¸­æ¯ä¸€ç§æ•°æ®ç»“æ„çš„ç”¨å¤„å’Œä½œç”¨ã€‚</p><h3 id="Redis-confè¯¦ç»†">Redis.confè¯¦ç»†</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹è½½redis </span><br><span class="line">docker pull redis</span><br><span class="line"></span><br><span class="line">åˆ›å»ºå®ä¾‹å¹¶å¯åŠ¨</span><br><span class="line"><span class="built_in">mkdir</span> -p /mydata/redis/conf      </span><br><span class="line"></span><br><span class="line"><span class="built_in">touch</span> redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6379:6379 --name redis -v /mydata/redis/data:/data \</span><br><span class="line">   -v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">   -d redis redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line"> <span class="built_in">ls</span>   æŸ¥çœ‹å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶</span><br><span class="line"> <span class="built_in">cat</span> redis.conf</span><br><span class="line"></span><br><span class="line"> æµ‹è¯•redis </span><br><span class="line">  </span><br><span class="line"> docker <span class="built_in">exec</span> -it redis redis-cli</span><br><span class="line"> </span><br><span class="line"> ---</span><br><span class="line"> ç”±äºä»¥å‰çš„æ•°æ®å…¨å­˜åœ¨å†…å­˜ä¸­ï¼Œä»è€Œæˆ‘ä»¬é‡å¤è¯»å–get açš„æ—¶å€™ä¼šå¯¼è‡´å¤±è´¥</span><br><span class="line">[root@localhost conf]<span class="comment"># cat redis.conf</span></span><br><span class="line">[root@localhost conf]<span class="comment"># docker exec -it redis redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> a b</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get a</span><br><span class="line"><span class="string">&quot;b&quot;</span>   //ä»è€Œåœ¨ä¸€æ¬¡ä¸Šæ¥çš„æ—¶å€™è¿™å—æ˜¯null</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line">--è®©redis æŒä¹…åŒ–  ---&gt; <span class="built_in">pwd</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exit</span></span><br><span class="line">[root@localhost conf]<span class="comment"># pwd</span></span><br><span class="line">/mydata/redis/conf</span><br><span class="line">[root@localhost conf]<span class="comment"># ls</span></span><br><span class="line">redis.conf</span><br><span class="line">[root@localhost conf]<span class="comment"># vi redis.conf </span></span><br><span class="line">i</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">esc  :wq</span><br><span class="line"></span><br><span class="line">docker restart redis  //é‡å¯redis</span><br><span class="line">--è®¾ç½®å¼€æœºè‡ªå¯åŠ¨docker é‡Œè¾¹å®¹å™¨</span><br><span class="line">sudo docker update &lt;å®¹å™¨å&gt; --restart=always</span><br></pre></td></tr></table></figure><p>å¯åŠ¨çš„æ—¶å€™é€šè¿‡é…ç½®æ–‡ä»¶å¤„ç†ï¼›</p><blockquote><p>å•ä½</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost conf]<span class="comment"># pwd</span></span><br><span class="line">/mydata/redis/conf</span><br><span class="line">[root@localhost conf]<span class="comment"># ls</span></span><br><span class="line">redis.conf</span><br><span class="line">[root@localhost conf]<span class="comment"># vi redis.conf </span></span><br></pre></td></tr></table></figure><ol><li><p>é…ç½®æ–‡ä»¶unitå•ä½å¯¹ä¸æ•æ„Ÿ</p></li><li><p>åŒ…å«</p></li><li><p>ç½‘ç»œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 127.0.0.1 <span class="comment">#ç»‘å®šçš„IP</span></span><br><span class="line">protected-mode <span class="built_in">yes</span> <span class="comment">#åŒ…å«æ¨¡å¼</span></span><br><span class="line">port 6379 <span class="comment">#ç«¯å£é…ç½®ï¼Œä¸æ¨èä¿®æ”¹</span></span><br></pre></td></tr></table></figure></li><li><p>é€šç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">daemonize <span class="built_in">yes</span> <span class="comment">#ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼Œé»˜è®¤æ˜¯noï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±å¼€å¯ä¸ºyes!</span></span><br><span class="line"></span><br><span class="line">pidfile /var/run/redis_6379.pid  <span class="comment">#å¦‚æœä»¥åå°ç¨‹åºè¿è¡Œï¼Œæˆ‘ä»¬å°±éœ€è¦ç»™ä¸€ä¸ªpidæ–‡ä»¶</span></span><br><span class="line">loglevel notice <span class="comment"># æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">logfile <span class="string">&quot;&quot;</span> <span class="comment">#æ—¥å¿—æ–‡ä»¶ä½ç½®å</span></span><br><span class="line">databases 16 <span class="comment">#æ•°æ®åº“çš„æ•°é‡ï¼Œé»˜è®¤æ˜¯16ä¸ªæ•°æ®åº“</span></span><br><span class="line">always-show-logo <span class="built_in">yes</span> <span class="comment">#æ˜¯å¦æ˜¾ç¤ºlogo </span></span><br></pre></td></tr></table></figure></li><li><p>å¿«ç…§</p><p>æŒä¹…åŒ–ï¼Œåœ¨è§„å®šçš„æ—¶é—´å†…ï¼Œæ‰§è¡Œäº†å¤šå°‘æ¬¡æ“ä½œï¼Œåˆ™ä¼šæŒä¹…åŒ–åˆ°æ–‡ä»¶ .rdb.aof</p><p>redisæ˜¯å†…å­˜æ•°æ®åº“ï¼Œå¦‚æœæ²¡æœ‰æŒä¹…åŒ–ï¼Œé‚£ä¹ˆæ•°æ®æ–­ç”µå°±ä¼šä¸¢å¤±</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¦‚æœåœ¨900ç§’å†…ï¼Œå¦‚æœæœ‰è‡³å°‘ä¸€ä¸ªkey è¿›è¡Œä¿®æ”¹ï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</span></span><br><span class="line">save 900 1  </span><br><span class="line"><span class="comment">#å¦‚æœåœ¨300ç§’å†…ï¼Œæœ‰10ä¸ªkeyè¿›è¡Œä¿®æ”¹ï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›è¡ŒæŒä¹…åŒ–</span></span><br><span class="line">save  300 10</span><br><span class="line"><span class="comment">#å¦‚æœ60ç§’å†…ã€‚è‡³å°‘10000keyè¿›è¡Œä¿®æ”¹ï¼Œæˆ‘ä»¬è¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</span></span><br><span class="line">save 60 10000</span><br><span class="line"><span class="comment">#ä¹‹åæˆ‘ä»¬å¯ä»¥è‡ªå·±è‡ªå®šä¹‰</span></span><br><span class="line"></span><br><span class="line">stop-writes-on-bgsave-error <span class="built_in">yes</span> <span class="comment">#æŒä¹…åŒ–å¦‚æœå‡ºé”™ï¼Œæ˜¯å¦è¿˜éœ€è¦ç»§ç»­å·¥ä½œï¼</span></span><br><span class="line"></span><br><span class="line">rdbcompression <span class="built_in">yes</span> <span class="comment">#æ˜¯å¦å‹ç¼©rdbæ–‡ä»¶ï¼Œéœ€è¦å ç”¨ä¸€å®šçš„cpuçš„èµ„æº</span></span><br><span class="line">rdbchecksum <span class="built_in">yes</span> <span class="comment">#æ˜¯å¦ä¿æŒrdbæ–‡ä»¶çš„æ—¶å€™ï¼Œè¿›è¡Œé”™è¯¯çš„æ£€æŸ¥æ ¡éªŒ</span></span><br><span class="line"><span class="built_in">dir</span> ./ <span class="comment">#rdbæ–‡ä»¶ä¿å­˜è·¯å¾„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#=============================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¯†ç  </span></span><br><span class="line">config <span class="built_in">set</span> requirepass <span class="string">&quot;å¯†ç &quot;</span></span><br><span class="line"><span class="comment">#æ­¤æ—¶å°±éœ€è¦æƒé™äº†ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å¯†ç äº†</span></span><br><span class="line">config get requirepass </span><br><span class="line"><span class="comment">#è¾“å…¥å¯†ç </span></span><br><span class="line">auth å¯†ç </span><br><span class="line"><span class="comment">#æ­¤æ—¶å°±å¯ä»¥æŸ¥çœ‹</span></span><br><span class="line">config get requirepass </span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>é™åˆ¶å®¢æˆ·ç«¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">maxclients 10000  <span class="comment">#è®¾ç½®èƒ½é“¾æ¥ä¸Šçš„redisçš„æœ€å¤§å®¢æˆ·ç«¯æ•°é‡</span></span><br><span class="line">maxmemory &lt;byte&gt; <span class="comment">#redis é…ç½®æœ€å¤§çš„å†…å­˜å®¹é‡</span></span><br><span class="line">maxmemory-policy noeviction <span class="comment">#å†…å­˜åˆ°è¾¾ä¸Šé™ä¹‹åçš„å¤„ç†ç­–ç•¥</span></span><br><span class="line"></span><br><span class="line">volatile-lruï¼Œé’ˆå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyï¼Œä½¿ç”¨lruç®—æ³•è¿›è¡Œæ·˜æ±°ã€‚</span><br><span class="line">allkeys-lruï¼Œé’ˆå¯¹æ‰€æœ‰keyä½¿ç”¨lruç®—æ³•è¿›è¡Œæ·˜æ±°ã€‚</span><br><span class="line">volatile-randomï¼Œä»æ‰€æœ‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyä¸­ä½¿ç”¨éšæœºæ·˜æ±°çš„æ–¹å¼è¿›è¡Œæ·˜æ±°ã€‚</span><br><span class="line">allkeys-randomï¼Œé’ˆå¯¹æ‰€æœ‰çš„keyä½¿ç”¨éšæœºæ·˜æ±°æœºåˆ¶è¿›è¡Œæ·˜æ±°ã€‚</span><br><span class="line">volatile-ttlï¼Œé’ˆå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyï¼Œè¶Šæ—©è¿‡æœŸçš„è¶Šå…ˆè¢«æ·˜æ±°ã€‚</span><br><span class="line">noevictionï¼Œä¸ä¼šæ·˜æ±°ä»»ä½•æ•°æ®ï¼Œå½“ä½¿ç”¨çš„å†…å­˜ç©ºé—´è¶…è¿‡ maxmemory å€¼æ—¶ï¼Œå†æœ‰å†™è¯·æ±‚æ¥æ—¶è¿”å›é”™è¯¯ã€‚</span><br></pre></td></tr></table></figure></li><li><p>AOF : APPENDONLY æ¨¡å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">appendonly no <span class="comment">#é»˜è®¤æ˜¯ä¸å¼€å¯æ¨¡å¼çš„aofé»˜è®¤æ˜¯ä½¿ç”¨rdbçš„ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹rdbå¤Ÿç”¨äº†</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly.aof&quot;</span> <span class="comment">#æŒä¹…åŒ–çš„æ–‡ä»¶çš„åå­— .rdb</span></span><br><span class="line"><span class="comment">#appendfsync always  æ¯æ¬¡ä¿®æ”¹éƒ½ä¼š syncæ¶ˆè€—æ€§èƒ½</span></span><br><span class="line">appendsync everysec <span class="comment">#æ¯ç§’æ‰§è¡Œä¸€ä¸ªsync å¯èƒ½ä¼šä¸¢å¤±è¿™ä¸ªlsçš„æ•°æ®</span></span><br><span class="line"><span class="comment">#appendfsync no ä¸æ‰§è¡Œsyncè¿™ä¸ªæ˜¯æ“ä½œç³»ç»Ÿè‡ªå·±åŒæ­¥æ•°æ®ï¼Œé€Ÿåº¦æœ€å¿«</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="redisæŒä¹…åŒ–">redisæŒä¹…åŒ–</h3><p><strong>AOF</strong>:</p><p>å°†æˆ‘ä»¬æ‰€æœ‰çš„å‘½ä»¤è®°å½•ä¸‹æ¥ï¼Œhistoryï¼Œæ¢å¤çš„æ—¶å€™å°±æŠŠè¿™ä¸ªæ–‡ä»¶å…¨éƒ¨æ‰§è¡Œä¸€æ¬¡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost conf]<span class="comment"># vi redis.conf </span></span><br><span class="line">i</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line">esc  :wq</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æ˜¯é»˜è®¤ä¸å¼€å¯çš„ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å»å¼€å¯ã€‚</p><p>æˆ‘ä»¬ä¸€èˆ¬éœ€è¦å°†appendonly æ”¹æˆyeså°±è¡Œï¼Œç„¶åæˆ‘ä»¬å°±å¼€å¯äº†</p><p>æ›´æ–°åæˆ‘ä»¬éœ€è¦é‡å¯æœåŠ¡å™¨ï¼Œ</p><p>æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨<code>vim appendonly.aof</code>æŸ¥çœ‹æˆ‘ä»¬é…ç½®åäº§ç”Ÿçš„æ–‡ä»¶ï¼Œä½†æ˜¯å½“æˆ‘ä»¬å°†aofæ–‡ä»¶è¿›è¡Œä¸€å®šçš„æ›´æ”¹å°±ä¼šå¯¼è‡´rediså¯åŠ¨ä¸èµ·æ¥äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦ä¿®å¤è¿™ä¸ªaofæ–‡ä»¶</p><p>redisç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå·¥å…· <code>redis-check-aof --fix</code></p><p>ç„¶åæŒ‰ç…§æŒ‡ä»¤æ“ä½œï¼Œæˆ‘ä»¬å°±å¯ä»¥å®Œæˆaofçš„æ–‡ä»¶ä¿®å¤ã€‚</p><blockquote><p>ä¼˜ç‚¹å’Œç¼ºç‚¹</p></blockquote><p>ä¼˜ç‚¹ï¼š</p><ol><li>æ¯ä¸€æ¬¡ä¿®æ”¹éƒ½åŒæ­¥ï¼Œæ–‡ä»¶çš„å®Œæ•´ä¼šæ›´å¥½</li><li>æ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼Œå¯èƒ½ä¼šä¸¢å¤±ä¸€ç§’çš„æ•°æ®</li><li>ä»ä¸åŒæ­¥ï¼Œæ•ˆç‡æ˜¯æœ€é«˜çš„</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>ç›¸å¯¹äºæ•°æ®æ–‡ä»¶æ¥è¯´ï¼ŒAOFå¤§äºRDB,ä¿®å¤çš„é€Ÿåº¦ä¹Ÿæ¯”RDBæ…¢ï¼</li><li>AOFè¿è¡Œæ•ˆç‡ä¹Ÿä¼šæ¯”RDBæ…¢ï¼Œæ•…è€Œæˆ‘ä»¬éœ€è¦Redisé»˜è®¤çš„RDBæŒä¹…åŒ–</li></ol><p>å¦‚æœAOFæ–‡ä»¶å¤§äº64MB,ä¹Ÿå°±æ˜¯å¤ªå¤§äº†ï¼Œforkä¸€ä¸ªæ–°è¿›ç¨‹å°†å¯¹æˆ‘ä»¬çš„æ–‡ä»¶è¿›è¡Œé‡å†™ï¼</p><p><strong>RDB</strong>:</p><p>dump.rdb</p><p>redisé»˜è®¤RDB</p><ol><li>saveçš„è§„åˆ™æ»¡è¶³çš„æƒ…å†µä¸‹ï¼Œä¼šè‡ªåŠ¨è§¦å‘rdbè§„åˆ™</li><li>æ‰§è¡ŒflushAllå‘½ä»¤ï¼Œä¹Ÿä¼šè§¦å‘æˆ‘ä»¬rdbè§„åˆ™</li><li>é€€å‡ºredisä¹Ÿä¼šäº§ç”Ÿrdbæ–‡ä»¶</li></ol><p>å¤‡ä»½å°±äº§ç”Ÿä¸€ä¸ªdump.rdbæ–‡ä»¶</p><blockquote><p>å¦‚ä½•æ¢å¤rdbæ–‡ä»¶</p></blockquote><ol><li>åªè¦å°†rdbæ–‡ä»¶æ”¾åœ¨æˆ‘ä»¬rediså¯åŠ¨ç›®å½•å°±å¯ä»¥ï¼Œrediså¯åŠ¨çš„æ—¶å€™ä¼šè‡ªåŠ¨æ£€æŸ¥dump,rdbæ–‡ä»¶ï¼Œç„¶åæ¢å¤æ–‡ä»¶</li><li>æŸ¥çœ‹æˆ‘ä»¬éœ€è¦å­˜åœ¨çš„ä½ç½®</li></ol><p>ä¸€èˆ¬ä¸Šæˆ‘ä»¬é»˜è®¤ä½¿ç”¨RDB</p><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ol><li>é€‚åˆå¤§è§„æ¨¡çš„æ•°æ®æ¢å¤</li><li>å¯¹æ•°æ®çš„å®Œæ•´æ€§è¦æ±‚ä¸é«˜</li></ol><p><strong>ç¼ºç‚¹</strong></p><ol><li>éœ€è¦ä¸€å®šçš„æ—¶é—´é—´éš”è¿›ç¨‹æ“ä½œï¼Œå¦‚æœredisæ„å¤–å®•æœºäº†ï¼Œè¿™ä¸ªæœ€åä¸€æ¬¡ä¿®æ”¹çš„æ•°æ®å°±æ²¡æœ‰äº†</li><li>forkè¿›ç¨‹çš„æ—¶å€™éœ€è¦å ç”¨ä¸€å®šçš„å†…å­˜ç©ºé—´</li></ol><h3 id="Rediså‘å¸ƒè®¢é˜…">Rediså‘å¸ƒè®¢é˜…</h3><p>Redis å‘å¸ƒè®¢é˜… (pub/sub) æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€… (pub) å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€… (sub) æ¥æ”¶æ¶ˆæ¯ã€‚</p><p>æ³¨æ„æˆ‘ä»¬éœ€è¦å¼€å¯ä¸¤ä¸ªå®¢æˆ·ç«¯ï¼Œä¸€ä¸ªåšè®¢é˜…çš„ä¸€ä¸ªåšæ¨é€çš„ã€‚</p><p>Redis å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“ã€‚</p><p>ä»¥ä¸‹å®ä¾‹æ¼”ç¤ºäº†å‘å¸ƒè®¢é˜…æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œéœ€è¦å¼€å¯ä¸¤ä¸ª redis-cli å®¢æˆ·ç«¯ã€‚</p><p>åœ¨æˆ‘ä»¬å®ä¾‹ä¸­æˆ‘ä»¬åˆ›å»ºäº†è®¢é˜…é¢‘é“åä¸º <strong>runoobChat</strong>:</p><p><code>SUBSCRIBE åå­—</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; SUBSCRIBE runoobChat <span class="comment">#è®¢é˜…ä¸€ä¸ªé¢‘é“ï¼Œåå­—runoobChat</span></span><br><span class="line"></span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line">2) <span class="string">&quot;runoobChat&quot;</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment">#ç­‰å¾…è¯»å–æ¨é€çš„æ¶ˆæ¯</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å…ˆé‡æ–°å¼€å¯ä¸ª redis å®¢æˆ·ç«¯ï¼Œç„¶ååœ¨åŒä¸€ä¸ªé¢‘é“ runoobChat å‘å¸ƒä¸¤æ¬¡æ¶ˆæ¯ï¼Œè®¢é˜…è€…å°±èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯ã€‚</p><p><code>PUBLISH åå­— ä¿¡æ¯</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; PUBLISH runoobChat <span class="string">&quot;Redis PUBLISH test&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; PUBLISH runoobChat <span class="string">&quot;Learn redis by runoob.com&quot;</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># è®¢é˜…è€…çš„å®¢æˆ·ç«¯ä¼šæ˜¾ç¤ºå¦‚ä¸‹æ¶ˆæ¯</span></span><br><span class="line"> 1) <span class="string">&quot;message&quot;</span> <span class="comment">#æ¶ˆæ¯</span></span><br><span class="line">2) <span class="string">&quot;runoobChat&quot;</span>   <span class="comment">#é‚£ä¸ªé¢‘é“çš„æ¶ˆæ¯</span></span><br><span class="line">3) <span class="string">&quot;Redis PUBLISH test&quot;</span> <span class="comment"># æ¶ˆæ¯çš„å…·ä½“å†…å®¹</span></span><br><span class="line"> 1) <span class="string">&quot;message&quot;</span></span><br><span class="line">2) <span class="string">&quot;runoobChat&quot;</span></span><br><span class="line">3) <span class="string">&quot;Learn redis by runoob.com&quot;</span></span><br></pre></td></tr></table></figure><p>gif æ¼”ç¤ºå¦‚ä¸‹ï¼š</p><ul><li>å¼€å¯æœ¬åœ° Redis æœåŠ¡ï¼Œå¼€å¯ä¸¤ä¸ª redis-cli å®¢æˆ·ç«¯ã€‚</li><li>åœ¨<strong>ç¬¬ä¸€ä¸ª redis-cli å®¢æˆ·ç«¯</strong>è¾“å…¥ SUBSCRIBE runoobChatï¼Œæ„æ€æ˜¯è®¢é˜… <code>runoobChat</code> é¢‘é“ã€‚</li><li>åœ¨<strong>ç¬¬äºŒä¸ª redis-cli å®¢æˆ·ç«¯</strong>è¾“å…¥ PUBLISH runoobChat â€œRedis PUBLISH testâ€ å¾€ runoobChat é¢‘é“å‘é€æ¶ˆæ¯ï¼Œè¿™ä¸ªæ—¶å€™åœ¨ç¬¬ä¸€ä¸ª redis-cli å®¢æˆ·ç«¯å°±ä¼šçœ‹åˆ°ç”±ç¬¬äºŒä¸ª redis-cli å®¢æˆ·ç«¯å‘é€çš„æµ‹è¯•æ¶ˆæ¯ã€‚</li></ul><table><thead><tr><th>1</th><th>PSUBSCRIBE pattern è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªç¬¦åˆç»™å®šæ¨¡å¼çš„é¢‘é“ã€‚</th></tr></thead><tbody><tr><td>2</td><td>PUBSUB subcommand [argument æŸ¥çœ‹è®¢é˜…ä¸å‘å¸ƒç³»ç»ŸçŠ¶æ€ã€‚</td></tr><tr><td>3</td><td>PUBLISH channel message å°†ä¿¡æ¯å‘é€åˆ°æŒ‡å®šçš„é¢‘é“ã€‚</td></tr><tr><td>4</td><td>PUNSUBSCRIBE  é€€è®¢æ‰€æœ‰ç»™å®šæ¨¡å¼çš„é¢‘é“ã€‚</td></tr><tr><td>5</td><td>SUBSCRIBE channeè®¢é˜…ç»™å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“çš„ä¿¡æ¯ã€‚</td></tr><tr><td>6</td><td>UNSUBSCRIBE   æŒ‡é€€è®¢ç»™å®šçš„é¢‘é“ã€‚</td></tr></tbody></table><h3 id="redisä¸»ä»å¤åˆ¶">redisä¸»ä»å¤åˆ¶</h3><p>Redis Replicationæ˜¯ä¸€ç§ master-slave æ¨¡å¼çš„å¤åˆ¶æœºåˆ¶ï¼Œè¿™ç§æœºåˆ¶ä½¿å¾— slave èŠ‚ç‚¹å¯ä»¥æˆä¸ºä¸ master èŠ‚ç‚¹å®Œå…¨ç›¸åŒçš„å‰¯æœ¬ï¼Œå¯ä»¥é‡‡ç”¨ä¸€ä¸»å¤šä»æˆ–è€…çº§è”ç»“æ„ ã€‚</p><blockquote><p>ä¸»ä»å¤åˆ¶çš„é…ç½®è¦ç‚¹ï¼š</p><p>ï¼ˆ1ï¼‰é…ä»åº“ä¸é…ä¸»ï¼Œä»åº“é…ç½®ï¼šslaveof ä¸»åº“IP ä¸»åº“ç«¯å£</p><p>ï¼ˆ2ï¼‰æŸ¥çœ‹redisçš„é…ç½®ä¿¡æ¯ï¼šinfo replication</p></blockquote><blockquote><p><strong>Redisä¸ºä»€ä¹ˆéœ€è¦ä¸»ä»å¤åˆ¶ï¼Ÿ</strong><br>ä½¿ç”¨Redisä¸»ä»å¤åˆ¶çš„åŸå› ä¸»è¦æ˜¯å•å°RedisèŠ‚ç‚¹å­˜åœ¨ä»¥ä¸‹çš„å±€é™æ€§ï¼š</p><p>ï¼ˆ1ï¼‰Redisè™½ç„¶è¯»å†™çš„é€Ÿåº¦éƒ½å¾ˆå¿«ï¼Œå•èŠ‚ç‚¹çš„Redisèƒ½å¤Ÿæ”¯æ’‘QPSå¤§æ¦‚åœ¨5wå·¦å³ï¼Œå¦‚æœä¸Šåƒä¸‡çš„ç”¨æˆ·è®¿é—®ï¼ŒRediså°±æ‰¿è½½ä¸äº†ï¼Œæˆä¸ºäº†é«˜å¹¶å‘çš„ç“¶é¢ˆã€‚</p><p>ï¼ˆ2ï¼‰å•èŠ‚ç‚¹çš„Redisä¸èƒ½ä¿è¯é«˜å¯ç”¨ï¼Œå½“Rediså› ä¸ºæŸäº›åŸå› æ„å¤–å®•æœºæ—¶ï¼Œä¼šå¯¼è‡´ç¼“å­˜ä¸å¯ç”¨</p><p>ï¼ˆ3ï¼‰CPUçš„åˆ©ç”¨ç‡ä¸Šï¼Œå•å°Rediså®ä¾‹åªèƒ½åˆ©ç”¨å•ä¸ªæ ¸å¿ƒï¼Œè¿™å•ä¸ªæ ¸å¿ƒåœ¨é¢ä¸´æµ·é‡æ•°æ®çš„å­˜å–å’Œç®¡ç†å·¥ä½œæ—¶å‹åŠ›ä¼šéå¸¸å¤§ã€‚</p></blockquote><blockquote><p><strong>ä¸»ä»å¤åˆ¶çš„å¥½å¤„ï¼š</strong><br>ï¼ˆ1ï¼‰æ•°æ®å†—ä½™ï¼šä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼ã€‚</p><p>ï¼ˆ2ï¼‰æ•…éšœæ¢å¤ï¼šå¦‚æœmasterå®•æ‰äº†ï¼Œä½¿ç”¨å“¨å…µæ¨¡å¼ï¼Œå¯ä»¥æå‡ä¸€ä¸ª slave ä½œä¸ºæ–°çš„ masterï¼Œè¿›è€Œå®ç°æ•…éšœè½¬ç§»ï¼Œå®ç°é«˜å¯ç”¨</p><p>ï¼ˆ3ï¼‰è´Ÿè½½å‡è¡¡ï¼šå¯ä»¥è½»æ˜“åœ°å®ç°æ¨ªå‘æ‰©å±•ï¼Œå®ç°è¯»å†™åˆ†ç¦»ï¼Œä¸€ä¸ª master ç”¨äºå†™ï¼Œå¤šä¸ª slave ç”¨äºåˆ†æ‘Šè¯»çš„å‹åŠ›ï¼Œä»è€Œå®ç°é«˜å¹¶å‘ï¼›</p></blockquote><blockquote><p><strong>ä¸»ä»å¤åˆ¶çš„ç¼ºç‚¹ï¼š</strong><br>ç”±äºæ‰€æœ‰çš„å†™æ“ä½œéƒ½æ˜¯å…ˆåœ¨Masterä¸Šæ“ä½œï¼Œç„¶ååŒæ­¥æ›´æ–°åˆ°Slaveä¸Šï¼Œæ‰€ä»¥ä»MasteråŒæ­¥åˆ°SlaveæœåŠ¡å™¨æœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œå½“ç³»ç»Ÿå¾ˆç¹å¿™çš„æ—¶å€™ï¼Œå»¶è¿Ÿé—®é¢˜ä¼šæ›´åŠ ä¸¥é‡ï¼ŒSlaveæœºå™¨æ•°é‡çš„å¢åŠ ä¹Ÿä¼šä½¿è¿™ä¸ªé—®é¢˜æ›´åŠ ä¸¥é‡</p></blockquote><p><strong>ç¯å¢ƒé…ç½®</strong>ï¼š</p><p>åªé…ç½®ä»åº“ï¼Œä¸é…ç½®ä¸»åº“</p><p><code>info replication</code>æŸ¥çœ‹ç›¸å…³é…ç½®åº“</p><p><code>vim redis79.conf</code> è¿›å…¥é…ç½®æ–‡ä»¶è¿›è¡Œæ›´æ”¹</p><p>æ”¹ç«¯å£portï¼Œæ”¹åå°æœåŠ¡åå­—pidï¼Œæ”¹æ—¥å¿—ï¼Œæ”¹åå°è¿è¡Œï¼Œæ”¹dbfilename  dump.rdb</p><p><code>redis-server kconfig/redis.conf</code>  æˆ‘ä»¬å¯åŠ¨ç›¸åº”é…ç½®åçš„redisä»åº“</p><p><code>ps  -ef|grep redis</code> æŸ¥çœ‹åå°å¯åŠ¨ä¿¡æ¯</p><h4 id="ä¸€ä¸»äºŒä»">ä¸€ä¸»äºŒä»</h4><p>åˆšåˆšé…ç½®åå…¶æ¯ä¸ªæ•°æ®åº“éƒ½æ˜¯ä¸»åº“ï¼Œåªæœ‰ç»è¿‡é…ç½®åæ‰èƒ½ä¿è¯redisçš„æŸä¸ªåº“å˜æˆä»åº“ã€‚</p><p>é»˜è®¤æƒ…å†µä¹‹ä¸‹ã€‚æ¯å°RedisæœåŠ¡å™¨éƒ½æ˜¯ä¸»è¡¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 6379   <span class="comment">#å¯åŠ¨redisçš„å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment">#æ³¨æ„è¿™ä¸ªæ˜¯åœ¨ä½ è¦æŒ‡å®šä½œä¸ºä»æœºçš„å®¢æˆ·ç«¯çª—å£é‡Œè¾¹æ‰§è¡Œçš„ï¼Œä»–é€‰æ‹©è€å¤§ï¼Œè€Œä¸æ˜¯è€å¤§é€‰æ‹©ä»–</span></span><br><span class="line">slaveof 127.0.0.1 6379 <span class="comment">#é…ç½®ä¸»è¡¨ ç®€ç§°ä»»å‘½è€å¤§</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šå‘½ä»¤é…ç½®çš„ï¼Œåªèƒ½æ˜¯æš‚æ—¶çš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šRedis.confå®Œæˆé…ç½®è¾¾åˆ°æ°¸ä¹…é…ç½®çš„æ–¹å¼ï¼Œå…·ä½“å¯ä»¥ç™¾åº¦è§£å†³ã€‚</p><blockquote><p>replicaof <masterip> ipåœ°å€  <masterport>ç«¯å£å·   é…ç½®åœ¨ä»æœºçš„é…ç½®æ–‡ä»¶å†…ï¼Œå½“æœåŠ¡é‡æ–°å¯åŠ¨ï¼Œè¿™ä¸ªè¡¨å°±ä½œä¸ºä»æœºäº†</p></blockquote><p>æ³¨æ„ï¼š</p><p>å½“æˆ‘ä»¬é…ç½®å¥½ä¸»æœºå’Œä»æœºåï¼Œä¸»æœºå¯ä»¥è¿›è¡Œsetæ·»åŠ æ•°æ®ï¼Œè€Œæ·»åŠ çš„æ•°æ®å¯ä»¥ç›´æ¥åœ¨ä»è¡¨ä¸­æŸ¥åˆ°ï¼Œä½†æ˜¯ä»è¡¨ä¸èƒ½æ·»åŠ æ•°æ®ï¼Œå› ä¸ºä»–æ˜¯ä»è¡¨ã€‚</p><p>æ²¡æœ‰é…ç½®å“¨å…µçš„æ—¶å€™ï¼šå½“ä¸»æœºæ–­å¼€é“¾æ¥çš„æ—¶å€™ï¼Œä»æœºä¾æ—§è¿æ¥åˆ°ä¸»æœºï¼Œä½†æ˜¯æ²¡æœ‰å†™æ“ä½œï¼Œåªæœ‰è¯»æ“ä½œï¼Œå½“è¿™ä¸ªæ—¶å€™ä¸»æœºå›æ¥äº†ï¼Œé‚£ä¹ˆä»æœºè¿˜æ˜¯ä¿æŒé“¾æ¥ï¼Œä¸»æœºæ·»åŠ æ•°æ®ä»æœºç…§æ ·è¯»å–ä¸»æœºçš„æ•°æ®ã€‚</p><p>å¦‚æœæ˜¯ä½¿ç”¨å‘½ä»¤è¡Œï¼Œé‚£ä¹ˆé‡æ–°å¯åŠ¨åå°±åˆä¼šå˜å›ä¸»æœºï¼Œä½†è¿™ä¸ªæ—¶å€™ï¼Œåªè¦å˜å›ä»æœºï¼Œé‚£ä¹ˆå°±å¯ä»¥ç«‹é©¬æ‹¿åˆ°ä¸»æœºçš„æ•°æ®</p><blockquote><p>å¤åˆ¶åŸç†</p></blockquote><p>slaveå¯åŠ¨å¯åŠ¨æˆåŠŸé“¾æ¥åˆ°masteråä¼šå‘é€ä¸€ä¸ªsyncåŒæ­¥å‘½ä»¤</p><p>Masteræ¥å—åˆ°å‘½ä»¤åï¼Œå¯åŠ¨åå°çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°ç”¨äºä¿®æ”¹æ•°æ®é›†å‘½ä»¤ï¼Œåœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œmasterå°†ä¼ é€æ•´ä¸ªæ•°æ®æ–‡ä»¶åˆ°slave,å¹¶å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥ã€‚</p><p>å…¨é‡å¤åˆ¶ï¼šè€ŒslaveæœåŠ¡åœ¨æ¥åˆ°æ•°æ®åº“æ–‡ä»¶æ•°æ®åï¼Œå°†å…¶å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­</p><p>å¢é‡å¤åˆ¶ï¼šMasterç»§ç»­å°†æ–°çš„æ‰€æœ‰æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ ç»™slaveï¼Œå®ŒæˆåŒæ­¥ã€‚</p><p>ä½†æ˜¯åªè¦æ˜¯é‡æ–°é“¾æ¥Master,ä¸€æ¬¡å®Œå…¨åŒæ­¥ï¼ˆå…¨éƒ¨å¤åˆ¶ï¼‰å°†ä¼šè‡ªåŠ¨æ‰§è¡Œã€‚</p><blockquote><p>å±‚å±‚è¿æ¥</p></blockquote><p>A-&gt;B-&gt;C</p><h4 id="å®•æœºæ‰‹åŠ¨é…ç½®ä¸»æœº">å®•æœºæ‰‹åŠ¨é…ç½®ä¸»æœº</h4><p>å¦‚æœæˆ‘ä»¬çš„ä¸»æœºæŒ‚æ‰äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•å°†ä»æœºé…ç½®æˆä¸ºä¸»æœºï¼Ÿ</p><p>æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯<code>slaveof no one</code>è®©ä»è¡¨è‡ªå·±å˜æˆä¸»æœºï¼Œé‚£ä¹ˆå…¶ä»–èŠ‚ç‚¹å°±å¯ä»¥æ‰‹åŠ¨è¿æ¥åˆ°æœ€æ–°çš„è¿™ä¸ªä¸»æœºï¼Œåœ¨å“¨å…µæ²¡æœ‰åˆ›å»ºçš„æ—¶å€™ï¼Œä¸€èˆ¬éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»é…ç½®ã€‚å¦‚æœè¿™ä¸ªæ—¶å€™è€å¤§ä¿®å¤äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦é‡å†™è¿æ¥ã€‚</p><h4 id="å“¨å…µè‡ªåŠ¨é…ç½®">å“¨å…µè‡ªåŠ¨é…ç½®</h4><p>Redisçš„ä¸»ä»å¤åˆ¶æ¨¡å¼ä¸‹ï¼Œ ä¸€æ—¦ä¸»èŠ‚ç‚¹ç”±äºæ•…éšœä¸èƒ½æä¾›æœåŠ¡ï¼Œ éœ€è¦äººå·¥å°†ä»èŠ‚ç‚¹æ™‹å‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œ åŒæ—¶è¿˜è¦é€šçŸ¥åº”ç”¨æ–¹æ›´æ–°ä¸»èŠ‚ç‚¹åœ°å€ï¼Œ å¯¹äºå¾ˆå¤šåº”ç”¨åœºæ™¯è¿™ç§æ•…éšœå¤„ç†çš„æ–¹å¼æ˜¯æ— æ³•æ¥å—çš„ã€‚ å¯å–œçš„æ˜¯Redisä»2.8å¼€å§‹æ­£å¼<br>æä¾›äº†Redis Sentinelï¼ˆå“¨å…µï¼‰ æ¶æ„æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>æ€»ç»“ï¼š</p><p>==<strong>Redisä¸»ä»å¤åˆ¶çš„ç¼ºç‚¹ï¼šæ²¡æœ‰åŠæ³•å¯¹masterè¿›è¡ŒåŠ¨æ€é€‰ä¸¾ï¼Œéœ€è¦ä½¿ç”¨Sentinelæœºåˆ¶å®ŒæˆåŠ¨æ€é€‰ä¸¾</strong>==</p><ul><li><p>å“¨å…µæ¨¡å¼ä»‹ç»</p><ul><li><strong>Sentinel(å“¨å…µ)è¿›ç¨‹æ˜¯ç”¨äºç›‘æ§redisé›†ç¾¤ä¸­Masterä¸»æœåŠ¡å™¨å·¥ä½œçš„çŠ¶æ€åœ¨Masterä¸»æœåŠ¡å™¨å‘ç”Ÿæ•…éšœçš„æ—¶å€™ï¼Œå¯ä»¥å®ç°Masterå’ŒSlaveæœåŠ¡å™¨çš„åˆ‡æ¢ï¼Œä¿è¯ç³»ç»Ÿçš„é«˜å¯ç”¨ï¼ˆHAï¼‰å…¶å·²ç»è¢«é›†æˆåœ¨redis2.6+çš„ç‰ˆæœ¬ä¸­ï¼ŒRedisçš„å“¨å…µæ¨¡å¼åˆ°äº†2.8ç‰ˆæœ¬ä¹‹åå°±ç¨³å®šäº†ä¸‹æ¥ã€‚</strong></li></ul></li><li><p>å“¨å…µè¿›ç¨‹çš„ä½œç”¨</p><ul><li>ç›‘æ§(Monitoring):<ul><li>å“¨å…µ(sentinel) ä¼šä¸æ–­åœ°æ£€æŸ¥ä½ çš„Masterå’ŒSlaveæ˜¯å¦è¿ä½œæ­£å¸¸ã€‚</li></ul></li><li>æé†’(Notification):<ul><li>å½“è¢«ç›‘æ§çš„æŸä¸ªRedisèŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶, å“¨å…µ(sentinel) å¯ä»¥é€šè¿‡ API å‘ç®¡ç†å‘˜æˆ–è€…å…¶ä»–åº”ç”¨ç¨‹åºå‘é€é€šçŸ¥ã€‚</li></ul></li></ul></li><li><p>è‡ªåŠ¨æ•…éšœè¿ç§»(Automatic failover)ï¼š</p><ul><li>å½“ä¸€ä¸ªMasterä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼Œå“¨å…µ(sentinel) ä¼šå¼€å§‹ä¸€æ¬¡è‡ªåŠ¨æ•…éšœè¿ç§»æ“ä½œã€‚</li><li>å®ƒä¼šå°†å¤±æ•ˆMasterçš„å…¶ä¸­ä¸€ä¸ªSlaveå‡çº§ä¸ºæ–°çš„Master, å¹¶è®©å¤±æ•ˆMasterçš„å…¶ä»–Slaveæ”¹ä¸ºå¤åˆ¶æ–°çš„Masterï¼›</li><li>å½“å®¢æˆ·ç«¯è¯•å›¾è¿æ¥å¤±æ•ˆçš„Masteræ—¶ï¼Œé›†ç¾¤ä¹Ÿä¼šå‘å®¢æˆ·ç«¯è¿”å›æ–°Masterçš„åœ°å€ï¼Œä½¿å¾—é›†ç¾¤å¯ä»¥ä½¿ç”¨ç°åœ¨çš„Masteræ›¿æ¢å¤±æ•ˆMasterã€‚</li><li>Masterå’ŒSlaveæœåŠ¡å™¨åˆ‡æ¢åï¼ŒMasterçš„redis.confã€Slaveçš„redis.confå’Œsentinel.confçš„é…ç½®æ–‡ä»¶çš„å†…å®¹éƒ½ä¼šå‘ç”Ÿç›¸åº”çš„æ”¹å˜ï¼Œå³ï¼ŒMasterä¸»æœåŠ¡å™¨çš„redis.confé…ç½®æ–‡ä»¶ä¸­ä¼šå¤šä¸€è¡Œslaveofçš„é…ç½®ï¼Œsentinel.confçš„ç›‘æ§ç›®æ ‡ä¼šéšä¹‹è°ƒæ¢ã€‚</li></ul></li><li><p>å“¨å…µè¿›ç¨‹çš„å·¥ä½œæ–¹å¼</p><ul><li>æ¯ä¸ªSentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ä»¥æ¯ç§’é’Ÿä¸€æ¬¡çš„é¢‘ç‡å‘æ•´ä¸ªé›†ç¾¤ä¸­çš„Masterä¸»æœåŠ¡å™¨ï¼ŒSlaveä»æœåŠ¡å™¨ä»¥åŠå…¶ä»–Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘é€ä¸€ä¸ª PING å‘½ä»¤ã€‚</li><li>å¦‚æœä¸€ä¸ªå®ä¾‹ï¼ˆinstanceï¼‰è·ç¦»æœ€åä¸€æ¬¡æœ‰æ•ˆå›å¤ PING å‘½ä»¤çš„æ—¶é—´è¶…è¿‡ down-after-milliseconds é€‰é¡¹æ‰€æŒ‡å®šçš„å€¼ï¼Œåˆ™è¿™ä¸ªå®ä¾‹ä¼šè¢« Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰ã€‚</li><li>å¦‚æœä¸€ä¸ªMasterä¸»æœåŠ¡å™¨è¢«æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰ï¼Œåˆ™æ­£åœ¨ç›‘è§†è¿™ä¸ªMasterä¸»æœåŠ¡å™¨çš„æ‰€æœ‰</li><li>Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹è¦ä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡ç¡®è®¤Masterä¸»æœåŠ¡å™¨çš„ç¡®è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ã€‚</li><li>å½“æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ï¼ˆå¤§äºç­‰äºé…ç½®æ–‡ä»¶æŒ‡å®šçš„å€¼ï¼‰åœ¨æŒ‡å®šçš„æ—¶é—´èŒƒå›´å†…ç¡®è®¤Masterä¸»æœåŠ¡å™¨è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ï¼ˆSDOWNï¼‰ï¼Œ åˆ™Masterä¸»æœåŠ¡å™¨ä¼šè¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰ã€‚</li><li>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ æ¯ä¸ªSentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ä¼šä»¥æ¯ 10 ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘é›†ç¾¤ä¸­çš„æ‰€æœ‰Masterä¸»æœåŠ¡å™¨ã€Slaveä»æœåŠ¡å™¨å‘é€ INFO å‘½ä»¤ã€‚</li><li>å½“Masterä¸»æœåŠ¡å™¨è¢« Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰æ—¶ï¼ŒSentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘ä¸‹çº¿çš„ Masterä¸»æœåŠ¡å™¨çš„æ‰€æœ‰ Slaveä»æœåŠ¡å™¨å‘é€ INFO å‘½ä»¤çš„é¢‘ç‡ä¼šä» 10 ç§’ä¸€æ¬¡æ”¹ä¸ºæ¯ç§’ä¸€æ¬¡ã€‚</li><li>è‹¥æ²¡æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹åŒæ„ Masterä¸»æœåŠ¡å™¨ä¸‹çº¿ï¼Œ Masterä¸»æœåŠ¡å™¨çš„å®¢è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚è‹¥ Masterä¸»æœåŠ¡å™¨é‡æ–°å‘ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘é€ PING å‘½ä»¤è¿”å›æœ‰æ•ˆå›å¤ï¼ŒMasterä¸»æœåŠ¡å™¨çš„ä¸»è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é…ç½®å“¨å…µ</span></span><br><span class="line">vim sentinel.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿›å…¥é…ç½®æ–‡ä»¶ æŒ‰iè¿›å…¥ç¼–è¾‘æ¨¡å¼</span></span><br><span class="line">sentinel monitor  åå­—  ipåœ°å€   ç«¯å£å·  1 <span class="comment"># 1ä»£è¡¨ä¸»æœºæŒ‚äº†ä¹‹åæ˜¯è°æˆä¸ºä¸»æœº</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>1ä»£è¡¨slaveæŠ•ç¥¨ï¼Œè®©è°æˆä¸ºä¸»æœºç¥¨æ•°æœ€å¤šçš„å°±æ˜¯ä¸»æœº</p><p>æˆ‘ä»¬å…³é—­ä¸»æœºåï¼Œé‚£ä¹ˆå“¨å…µè‡ªåŠ¨å°†ä¼šæ›¿æˆ‘ä»¬ä»è¡¨ä¸­é€‰æ‹©ä¸»æœºã€‚åŒæ—¶ä¹Ÿä¼šåœ¨æ—¥å¿—é‡Œè¾¹æ˜¾ç¤ºslave0 ,slave1ç­‰éƒ½æ˜¯ä»æœºï¼Œmasteræ˜¯ä¸»æœºã€‚è¿™ä¸ªæ—¶å€™å¦‚æœä¸»æœºå›æ¥äº†ï¼Œé‚£ä¹ˆ<strong>ä¸»æœºå°±åªèƒ½å½“ä»æœºäº†ï¼Œå†œæ°‘ç¿»èº«åšä¸»äººäº†ï¼Œä½ æƒ³è¦æˆä¸ºä¸»äººï¼Œä¸å¤ªå¯èƒ½äº†ï¼Œé™¤éå…³é—­å…¶ä»–ä»æœºï¼Œç„¶åä¿ç•™ä½ è‡ªå·±ï¼Œåœ¨å…³é—­ä¸»æœºï¼Œè¿™æ ·æ–¹å¯æˆä¸ºä¸»æœºã€‚</strong></p><blockquote><p>ä¼˜ç‚¹ä¸ç¼ºç‚¹</p></blockquote><p>ä¼˜ç‚¹ï¼š</p><ol><li>å“¨å…µé›†ç¾¤ï¼ŒåŸºäºä¸»ä»å¤åˆ¶æ¨¡å¼ï¼Œæ‰€æœ‰çš„ä¸»ä»é…ç½®ä¼˜ç‚¹ä»–å…¨æœ‰</li><li>ä¸»ä»å¯ä»¥åˆ‡æ¢ï¼Œæ•…éšœå¯ä»¥è½¬ç§»ï¼Œç³»ç»Ÿçš„å¯ç”¨æ€§å°±ä¼šæ›´å¥½</li><li>å“¨å…µæ¨¡å¼å°±æ˜¯ä¸»ä»æ¨¡å¼çš„å‡çº§ï¼Œæ‰‹åŠ¨åˆ°è‡ªåŠ¨ï¼Œæ›´åŠ å¥å£®</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>Redisä¸å¥½åœ¨çº¿æ‰©å®¹ï¼Œé›†æƒå®¹é‡ä¸€æ—¦è¾¾åˆ°ä¸Šé™ï¼Œåœ¨çº¿æ‰©å®¹å°±ä¼šå¾ˆéº»çƒ¦</li><li>å®ç°å“¨å…µæ¨¡å¼çš„é…ç½®å…¶å®æ˜¯å¾ˆéº»çƒ¦çš„ï¼Œé‡Œè¾¹æœ‰å¾ˆå¤šçš„é€‰æ‹©ã€‚</li></ol><blockquote><p>å“¨å…µæ¨¡å¼çš„é…ç½®</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example sentinel.conf</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># å“¨å…µsentinelå®ä¾‹è¿è¡Œçš„ç«¯å£ é»˜è®¤26379</span></span><br><span class="line">port 26379</span><br><span class="line"> </span><br><span class="line"><span class="comment"># å“¨å…µsentinelçš„å·¥ä½œç›®å½•</span></span><br><span class="line"><span class="built_in">dir</span> /tmp</span><br><span class="line"> </span><br><span class="line"><span class="comment"># å“¨å…µsentinelç›‘æ§çš„redisä¸»èŠ‚ç‚¹çš„ ip port </span></span><br><span class="line"><span class="comment"># master-name  å¯ä»¥è‡ªå·±å‘½åçš„ä¸»èŠ‚ç‚¹åå­— åªèƒ½ç”±å­—æ¯A-zã€æ•°å­—0-9 ã€è¿™ä¸‰ä¸ªå­—ç¬¦&quot;.-_&quot;ç»„æˆã€‚</span></span><br><span class="line"><span class="comment"># quorum é…ç½®å¤šå°‘ä¸ªsentinelå“¨å…µç»Ÿä¸€è®¤ä¸ºmasterä¸»èŠ‚ç‚¹å¤±è” é‚£ä¹ˆè¿™æ—¶å®¢è§‚ä¸Šè®¤ä¸ºä¸»èŠ‚ç‚¹å¤±è”äº†</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</span></span><br><span class="line">  sentinel monitor mymaster 127.0.0.1 6379 2</span><br><span class="line"> </span><br><span class="line"><span class="comment"># å½“åœ¨Rediså®ä¾‹ä¸­å¼€å¯äº†requirepass foobared æˆæƒå¯†ç  è¿™æ ·æ‰€æœ‰è¿æ¥Rediså®ä¾‹çš„å®¢æˆ·ç«¯éƒ½è¦æä¾›å¯†ç </span></span><br><span class="line"><span class="comment"># è®¾ç½®å“¨å…µsentinel è¿æ¥ä¸»ä»çš„å¯†ç  æ³¨æ„å¿…é¡»ä¸ºä¸»ä»è®¾ç½®ä¸€æ ·çš„éªŒè¯å¯†ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span></span><br><span class="line">sentinel auth-pass mymaster MySUPER--secret-0123passw0rd</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># æŒ‡å®šå¤šå°‘æ¯«ç§’ä¹‹å ä¸»èŠ‚ç‚¹æ²¡æœ‰åº”ç­”å“¨å…µsentinel æ­¤æ—¶ å“¨å…µä¸»è§‚ä¸Šè®¤ä¸ºä¸»èŠ‚ç‚¹ä¸‹çº¿ é»˜è®¤30ç§’</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span></span><br><span class="line">sentinel down-after-milliseconds mymaster 30000</span><br><span class="line"> </span><br><span class="line"><span class="comment"># è¿™ä¸ªé…ç½®é¡¹æŒ‡å®šäº†åœ¨å‘ç”Ÿfailoverä¸»å¤‡åˆ‡æ¢æ—¶æœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªslaveåŒæ—¶å¯¹æ–°çš„masterè¿›è¡Œ åŒæ­¥ï¼Œè¿™ä¸ªæ•°å­—è¶Šå°ï¼Œå®Œæˆfailoveræ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªæ•°å­—è¶Šå¤§ï¼Œå°±æ„å‘³ç€è¶Š å¤šçš„slaveå› ä¸ºreplicationè€Œä¸å¯ç”¨ã€‚å¯ä»¥é€šè¿‡å°†è¿™ä¸ªå€¼è®¾ä¸º 1 æ¥ä¿è¯æ¯æ¬¡åªæœ‰ä¸€ä¸ªslave å¤„äºä¸èƒ½å¤„ç†å‘½ä»¤è¯·æ±‚çš„çŠ¶æ€ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt;</span></span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># æ•…éšœè½¬ç§»çš„è¶…æ—¶æ—¶é—´ failover-timeout å¯ä»¥ç”¨åœ¨ä»¥ä¸‹è¿™äº›æ–¹é¢ï¼š </span></span><br><span class="line"><span class="comment">#1. åŒä¸€ä¸ªsentinelå¯¹åŒä¸€ä¸ªmasterä¸¤æ¬¡failoverä¹‹é—´çš„é—´éš”æ—¶é—´ã€‚</span></span><br><span class="line"><span class="comment">#2. å½“ä¸€ä¸ªslaveä»ä¸€ä¸ªé”™è¯¯çš„masteré‚£é‡ŒåŒæ­¥æ•°æ®å¼€å§‹è®¡ç®—æ—¶é—´ã€‚ç›´åˆ°slaveè¢«çº æ­£ä¸ºå‘æ­£ç¡®çš„masteré‚£é‡ŒåŒæ­¥æ•°æ®æ—¶ã€‚</span></span><br><span class="line"><span class="comment">#3.å½“æƒ³è¦å–æ¶ˆä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„failoveræ‰€éœ€è¦çš„æ—¶é—´ã€‚  </span></span><br><span class="line"><span class="comment">#4.å½“è¿›è¡Œfailoveræ—¶ï¼Œé…ç½®æ‰€æœ‰slavesæŒ‡å‘æ–°çš„masteræ‰€éœ€çš„æœ€å¤§æ—¶é—´ã€‚ä¸è¿‡ï¼Œå³ä½¿è¿‡äº†è¿™ä¸ªè¶…æ—¶ï¼Œslavesä¾ç„¶ä¼šè¢«æ­£ç¡®é…ç½®ä¸ºæŒ‡å‘masterï¼Œä½†æ˜¯å°±ä¸æŒ‰parallel-syncsæ‰€é…ç½®çš„è§„åˆ™æ¥äº†</span></span><br><span class="line"><span class="comment"># é»˜è®¤ä¸‰åˆ†é’Ÿ</span></span><br><span class="line"><span class="comment"># sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span></span><br><span class="line">sentinel failover-timeout mymaster 180000</span><br><span class="line"> </span><br><span class="line"><span class="comment"># SCRIPTS EXECUTION</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#é…ç½®å½“æŸä¸€äº‹ä»¶å‘ç”Ÿæ—¶æ‰€éœ€è¦æ‰§è¡Œçš„è„šæœ¬ï¼Œå¯ä»¥é€šè¿‡è„šæœ¬æ¥é€šçŸ¥ç®¡ç†å‘˜ï¼Œä¾‹å¦‚å½“ç³»ç»Ÿè¿è¡Œä¸æ­£å¸¸æ—¶å‘é‚®ä»¶é€šçŸ¥ç›¸å…³äººå‘˜ã€‚</span></span><br><span class="line"><span class="comment">#å¯¹äºè„šæœ¬çš„è¿è¡Œç»“æœæœ‰ä»¥ä¸‹è§„åˆ™ï¼š</span></span><br><span class="line"><span class="comment">#è‹¥è„šæœ¬æ‰§è¡Œåè¿”å›1ï¼Œé‚£ä¹ˆè¯¥è„šæœ¬ç¨åå°†ä¼šè¢«å†æ¬¡æ‰§è¡Œï¼Œé‡å¤æ¬¡æ•°ç›®å‰é»˜è®¤ä¸º10</span></span><br><span class="line"><span class="comment">#è‹¥è„šæœ¬æ‰§è¡Œåè¿”å›2ï¼Œæˆ–è€…æ¯”2æ›´é«˜çš„ä¸€ä¸ªè¿”å›å€¼ï¼Œè„šæœ¬å°†ä¸ä¼šé‡å¤æ‰§è¡Œã€‚</span></span><br><span class="line"><span class="comment">#å¦‚æœè„šæœ¬åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ç”±äºæ”¶åˆ°ç³»ç»Ÿä¸­æ–­ä¿¡å·è¢«ç»ˆæ­¢äº†ï¼Œåˆ™åŒè¿”å›å€¼ä¸º1æ—¶çš„è¡Œä¸ºç›¸åŒã€‚</span></span><br><span class="line"><span class="comment">#ä¸€ä¸ªè„šæœ¬çš„æœ€å¤§æ‰§è¡Œæ—¶é—´ä¸º60sï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œè„šæœ¬å°†ä¼šè¢«ä¸€ä¸ªSIGKILLä¿¡å·ç»ˆæ­¢ï¼Œä¹‹åé‡æ–°æ‰§è¡Œã€‚</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#é€šçŸ¥å‹è„šæœ¬:å½“sentinelæœ‰ä»»ä½•è­¦å‘Šçº§åˆ«çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆæ¯”å¦‚è¯´rediså®ä¾‹çš„ä¸»è§‚å¤±æ•ˆå’Œå®¢è§‚å¤±æ•ˆç­‰ç­‰ï¼‰ï¼Œå°†ä¼šå»è°ƒç”¨è¿™ä¸ªè„šæœ¬ï¼Œè¿™æ—¶è¿™ä¸ªè„šæœ¬åº”è¯¥é€šè¿‡é‚®ä»¶ï¼ŒSMSç­‰æ–¹å¼å»é€šçŸ¥ç³»ç»Ÿç®¡ç†å‘˜å…³äºç³»ç»Ÿä¸æ­£å¸¸è¿è¡Œçš„ä¿¡æ¯ã€‚è°ƒç”¨è¯¥è„šæœ¬æ—¶ï¼Œå°†ä¼ ç»™è„šæœ¬ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯äº‹ä»¶çš„ç±»å‹ï¼Œä¸€ä¸ªæ˜¯äº‹ä»¶çš„æè¿°ã€‚å¦‚æœsentinel.confé…ç½®æ–‡ä»¶ä¸­é…ç½®äº†è¿™ä¸ªè„šæœ¬è·¯å¾„ï¼Œé‚£ä¹ˆå¿…é¡»ä¿è¯è¿™ä¸ªè„šæœ¬å­˜åœ¨äºè¿™ä¸ªè·¯å¾„ï¼Œå¹¶ä¸”æ˜¯å¯æ‰§è¡Œçš„ï¼Œå¦åˆ™sentinelæ— æ³•æ­£å¸¸å¯åŠ¨æˆåŠŸã€‚</span></span><br><span class="line"><span class="comment">#é€šçŸ¥è„šæœ¬</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;</span></span><br><span class="line">  sentinel notification-script mymaster /var/redis/notify.sh</span><br><span class="line"> </span><br><span class="line"><span class="comment"># å®¢æˆ·ç«¯é‡æ–°é…ç½®ä¸»èŠ‚ç‚¹å‚æ•°è„šæœ¬</span></span><br><span class="line"><span class="comment"># å½“ä¸€ä¸ªmasterç”±äºfailoverè€Œå‘ç”Ÿæ”¹å˜æ—¶ï¼Œè¿™ä¸ªè„šæœ¬å°†ä¼šè¢«è°ƒç”¨ï¼Œé€šçŸ¥ç›¸å…³çš„å®¢æˆ·ç«¯å…³äºmasteråœ°å€å·²ç»å‘ç”Ÿæ”¹å˜çš„ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="comment"># ä»¥ä¸‹å‚æ•°å°†ä¼šåœ¨è°ƒç”¨è„šæœ¬æ—¶ä¼ ç»™è„šæœ¬:</span></span><br><span class="line"><span class="comment"># &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt;</span></span><br><span class="line"><span class="comment"># ç›®å‰&lt;state&gt;æ€»æ˜¯â€œfailoverâ€,</span></span><br><span class="line"><span class="comment"># &lt;role&gt;æ˜¯â€œleaderâ€æˆ–è€…â€œobserverâ€ä¸­çš„ä¸€ä¸ªã€‚ </span></span><br><span class="line"><span class="comment"># å‚æ•° from-ip, from-port, to-ip, to-portæ˜¯ç”¨æ¥å’Œæ—§çš„masterå’Œæ–°çš„master(å³æ—§çš„slave)é€šä¿¡çš„</span></span><br><span class="line"><span class="comment"># è¿™ä¸ªè„šæœ¬åº”è¯¥æ˜¯é€šç”¨çš„ï¼Œèƒ½è¢«å¤šæ¬¡è°ƒç”¨ï¼Œä¸æ˜¯é’ˆå¯¹æ€§çš„ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸€èˆ¬éƒ½æ˜¯è¿ç»´æ¥é…ç½®ï¼š</span></span><br><span class="line"><span class="comment"># sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</span></span><br><span class="line"> sentinel client-reconfig-script mymaster /var/redis/reconfig.sh</span><br></pre></td></tr></table></figure><h3 id="Redisç¼“å­˜ç©¿é€å’Œé›ªå´©">Redisç¼“å­˜ç©¿é€å’Œé›ªå´©</h3><p>â€‹     ç¼“å­˜ç©¿é€ï¼šç”¨æˆ·æƒ³æŸ¥è¯¢ä¸€ä¸ªæ•°æ®ï¼Œå‘ç°rediså†…å­˜æ•°æ®åº“æ²¡æœ‰ï¼Œä¹Ÿå°±æ˜¯ç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œäºæ˜¯å‘ç€æŒä¹…å±‚æ•°æ®åº“æŸ¥è¯¢ï¼Œå‘ç°ä¹Ÿæ²¡æœ‰ï¼Œæ•…è€Œæœ¬æ¬¡æŸ¥è¯¢å¤±è´¥ï¼Œå½“ç”¨æˆ·å¾ˆå¤šçš„æ—¶å€™ï¼Œç¼“å­˜éƒ½æ²¡æœ‰å‘½ä¸­ï¼Œäºæ˜¯éƒ½å»è¯·æ±‚äº†æŒä¹…å±‚æ•°æ®åº“ï¼Œè¿™æ ·å°±ä¼šä½¿æŒä¹…å±‚é€ æˆå¾ˆå¤§å‹åŠ›ï¼Œè¿™ä¸ªæ—¶å€™å°±å‡ºç°äº†ç¼“å­˜ç©¿é€ã€‚</p><p>ç¼“å­˜ç©¿é€**ï¼Œæ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªæ•°æ®åº“ä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ã€‚æ­£å¸¸çš„ä½¿ç”¨ç¼“å­˜æµç¨‹å¤§è‡´æ˜¯ï¼Œæ•°æ®æŸ¥è¯¢å…ˆè¿›è¡Œç¼“å­˜æŸ¥è¯¢ï¼Œå¦‚æœkeyä¸å­˜åœ¨æˆ–è€…keyå·²ç»è¿‡æœŸï¼Œå†å¯¹æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶æŠŠæŸ¥è¯¢åˆ°çš„å¯¹è±¡ï¼Œæ”¾è¿›ç¼“å­˜ã€‚å¦‚æœæ•°æ®åº“æŸ¥è¯¢å¯¹è±¡ä¸ºç©ºï¼Œåˆ™ä¸æ”¾è¿›ç¼“å­˜**</p><p>ç¼“å­˜ç©¿é€è§£å†³æ€è·¯ï¼š</p><ol><li>å¦‚æœæŸ¥è¯¢æ•°æ®åº“ä¹Ÿä¸ºç©ºï¼Œç›´æ¥è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼å­˜æ”¾åˆ°ç¼“å­˜ï¼Œè¿™æ ·ç¬¬äºŒæ¬¡åˆ°ç¼“å†²ä¸­è·å–å°±æœ‰å€¼äº†ï¼Œè€Œä¸ä¼šç»§ç»­è®¿é—®æ•°æ®åº“ï¼Œè¿™ç§åŠæ³•æœ€ç®€å•ç²—æš´ã€‚</li><li>æ ¹æ®ç¼“å­˜æ•°æ®Keyçš„è§„åˆ™ã€‚ä¾‹å¦‚æˆ‘ä»¬å…¬å¸æ˜¯åšæœºé¡¶ç›’çš„ï¼Œç¼“å­˜æ•°æ®ä»¥Macä¸ºKeyï¼ŒMacæ˜¯æœ‰è§„åˆ™ï¼Œå¦‚æœä¸ç¬¦åˆè§„åˆ™å°±è¿‡æ»¤æ‰ï¼Œè¿™æ ·å¯ä»¥è¿‡æ»¤ä¸€éƒ¨åˆ†æŸ¥è¯¢ã€‚åœ¨åšç¼“å­˜è§„åˆ’çš„æ—¶å€™ï¼ŒKeyæœ‰ä¸€å®šè§„åˆ™çš„è¯ï¼Œå¯ä»¥é‡‡å–è¿™ç§åŠæ³•ã€‚è¿™ç§åŠæ³•åªèƒ½ç¼“è§£ä¸€éƒ¨åˆ†çš„å‹åŠ›ï¼Œè¿‡æ»¤å’Œç³»ç»Ÿæ— å…³çš„æŸ¥è¯¢ï¼Œä½†æ˜¯æ— æ³•æ ¹æ²»ã€‚</li><li>é‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„BitSetä¸­ï¼Œä¸å­˜åœ¨çš„æ•°æ®å°†ä¼šè¢«æ‹¦æˆªæ‰ï¼Œä»è€Œé¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›ã€‚å…³äºå¸ƒéš†è¿‡æ»¤å™¨ï¼Œè¯¦æƒ…æŸ¥çœ‹ï¼šåŸºäºBitSetçš„å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰</li></ol><p>ç¼“å­˜å‡»ç©¿ï¼Œ<strong>æ˜¯æŒ‡ä¸€ä¸ªkeyéå¸¸çƒ­ç‚¹ï¼Œåœ¨ä¸åœçš„æ‰›ç€å¤§å¹¶å‘ï¼Œå¤§å¹¶å‘é›†ä¸­å¯¹è¿™ä¸€ä¸ªç‚¹è¿›è¡Œè®¿é—®ï¼Œå½“è¿™ä¸ªkeyåœ¨å¤±æ•ˆçš„ç¬é—´ï¼ŒæŒç»­çš„å¤§å¹¶å‘å°±ç©¿ç ´ç¼“å­˜ï¼Œç›´æ¥è¯·æ±‚æ•°æ®åº“ï¼Œå°±åƒåœ¨ä¸€ä¸ªå±éšœä¸Šå‡¿å¼€äº†ä¸€ä¸ªæ´ã€‚</strong></p><p>ç¼“å­˜é›ªå´©</p><p><strong>å°±æ˜¯æŒ‡ç¼“å­˜ç”±äºæŸäº›åŸå› ï¼ˆæ¯”å¦‚å®•æœºã€cacheæœåŠ¡æŒ‚äº†æˆ–è€…ä¸å“åº”ï¼‰æ•´ä½“crashæ‰äº†ï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚åˆ°è¾¾åç«¯æ•°æ®åº“ï¼Œä»è€Œå¯¼è‡´æ•°æ®åº“å´©æºƒï¼Œæ•´ä¸ªç³»ç»Ÿå´©æºƒï¼Œå‘ç”Ÿç¾éš¾ã€‚</strong><br>ä¸‹é¢çš„å°±æ˜¯ä¸€ä¸ªé›ªå´©çš„ç®€å•è¿‡ç¨‹ï¼š<br>1ã€redisé›†ç¾¤å½»åº•å´©æºƒ<br>2ã€ç¼“å­˜æœåŠ¡å¤§é‡å¯¹redisçš„è¯·æ±‚hangä½ï¼Œå ç”¨èµ„æº<br>3ã€ç¼“å­˜æœåŠ¡å¤§é‡çš„è¯·æ±‚æ‰“åˆ°æºå¤´æœåŠ¡å»æŸ¥è¯¢mysqlï¼Œç›´æ¥æ‰“æ­»mysql<br>4ã€æºå¤´æœåŠ¡å› ä¸ºmysqlè¢«æ‰“æ­»ä¹Ÿå´©æºƒï¼Œå¯¹æºæœåŠ¡çš„è¯·æ±‚ä¹Ÿhangä½ï¼Œå ç”¨èµ„æº</p><p>5ã€ç¼“å­˜æœåŠ¡å¤§é‡çš„èµ„æºå…¨éƒ¨è€—è´¹åœ¨è®¿é—®rediså’ŒæºæœåŠ¡æ— æœï¼Œæœ€åè‡ªå·±è¢«æ‹–æ­»ï¼Œæ— æ³•æä¾›æœåŠ¡</p><p>6ã€nginxæ— æ³•è®¿é—®ç¼“å­˜æœåŠ¡ï¼Œrediså’ŒæºæœåŠ¡ï¼Œåªèƒ½åŸºäºæœ¬åœ°ç¼“å­˜æä¾›æœåŠ¡ï¼Œä½†æ˜¯ç¼“å­˜è¿‡æœŸåï¼Œæ²¡æœ‰æ•°æ®æä¾›</p><p>7ã€ç½‘ç«™å´©æ¸</p><p><strong>ç¼“å­˜é›ªå´©çš„è§£å†³æ–¹æ¡ˆ</strong><br>1ï¼Œé‡‡ç”¨åŠ é”è®¡æ•°ï¼Œæˆ–è€…ä½¿ç”¨åˆç†çš„é˜Ÿåˆ—æ•°é‡æ¥é¿å…ç¼“å­˜å¤±æ•ˆæ—¶å¯¹æ•°æ®åº“é€ æˆå¤ªå¤§çš„å‹åŠ›ã€‚è¿™ç§åŠæ³•è™½ç„¶èƒ½ç¼“è§£æ•°æ®åº“çš„å‹åŠ›ï¼Œä½†æ˜¯åŒæ—¶åˆé™ä½äº†ç³»ç»Ÿçš„ååé‡ã€‚<br>2ï¼Œåˆ†æç”¨æˆ·è¡Œä¸ºï¼Œå°½é‡è®©å¤±æ•ˆæ—¶é—´ç‚¹å‡åŒ€åˆ†å¸ƒã€‚é¿å…ç¼“å­˜é›ªå´©çš„å‡ºç°ã€‚<br>3ï¼Œå¦‚æœæ˜¯å› ä¸ºæŸå°ç¼“å­˜æœåŠ¡å™¨å®•æœºï¼Œå¯ä»¥è€ƒè™‘åšä¸»å¤‡ï¼Œæ¯”å¦‚ï¼šredisä¸»å¤‡ï¼Œä½†æ˜¯åŒç¼“å­˜æ¶‰åŠåˆ°æ›´æ–°äº‹åŠ¡çš„é—®é¢˜ï¼Œupdateå¯èƒ½è¯»åˆ°è„æ•°æ®ï¼Œéœ€è¦å¥½å¥½è§£å†³ã€‚</p><h3 id="Redisé›†ç¾¤åˆ†å¸ƒéƒ¨ç½²">Redisé›†ç¾¤åˆ†å¸ƒéƒ¨ç½²</h3>]]></content>
    
    
    <summary type="html">ä½œä¸ºç›®å‰æœ€å—æ¬¢è¿çš„NoSQLï¼ŒRedisæœ‰ä»–çš„ç‹¬ç‰¹ä¹‹å¤„ï¼Œå¹¶ä¸”Redisä½œä¸ºåœ¨å†…å­˜å±‚æ¬¡çš„æ•°æ®åº“ï¼Œä»–çš„å¿«é€Ÿå’Œå¤„ç†ç›¸å¯¹MySQLæ¥è¯´å…·æœ‰å¾ˆå¤§çš„ä¼˜åŠ¿ï¼Œä½†æ˜¯å…¶ä¸MySQLå„æœ‰ä¼˜åŠ¿ã€‚</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://luoxiaohei520.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="Redis" scheme="https://luoxiaohei520.github.io/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>MySQLå­¦ä¹ </title>
    <link href="https://luoxiaohei520.github.io/posts/c6fb831a.html"/>
    <id>https://luoxiaohei520.github.io/posts/c6fb831a.html</id>
    <published>2023-11-09T02:50:23.336Z</published>
    <updated>2023-11-09T02:50:23.336Z</updated>
    
    <content type="html"><![CDATA[<h1>MySqlåˆæ­¥å­¦ä¹ </h1><p>å®‰è£…mysql ã€‚ã€‚ã€‚è‡ªè¡Œç™¾åº¦</p><h3 id="é“¾æ¥æ•°æ®åº“">é“¾æ¥æ•°æ®åº“</h3><p>é€šè¿‡å‘½ä»¤è¡Œï¼ï¼ï¼</p><p><code>mysql -uç”¨æˆ·å -på¯†ç </code>   é“¾æ¥æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">-- æ›´æ–°æ•°æ®åº“å¯†ç ï¼ˆé€‚åˆå°ç™½å¿˜è®°å¯†ç ï¼‰</span><br><span class="line">update mysql.user set authentication_string=password(&#x27;a&#x27;) where user= &#x27;root&#x27; and Host=&#x27;localhost&#x27;;</span><br><span class="line"></span><br><span class="line">flush privileges ; -- åˆ·æ–°æƒé™</span><br><span class="line"></span><br><span class="line">-- --------------------------------------</span><br><span class="line">-- æŸ¥çœ‹æ‰€æœ‰çš„æ•°æ®åº“</span><br><span class="line">show databases; </span><br><span class="line">-- ä½¿ç”¨æŸä¸ªæ•°æ®åº“</span><br><span class="line">user æ•°æ®åº“å;</span><br><span class="line"></span><br><span class="line">-- å±•ç°æ•°æ®åº“ä¸­æ‰€æœ‰çš„è¡¨</span><br><span class="line">show tables;-- æŸ¥çœ‹æ•°æ®åº“ä¸­æ‰€æœ‰çš„è¡¨</span><br><span class="line">-- æŸ¥çœ‹è¡¨ä¸­çš„æ•°æ®</span><br><span class="line">describe è¡¨å;</span><br><span class="line">-- åˆ›å»ºä¸€ä¸ªæ•°æ®åº“</span><br><span class="line">create database æ•°æ®åº“å;</span><br><span class="line">use æ•°æ®åº“å;</span><br><span class="line"></span><br><span class="line">-- é€€å‡ºæ•°æ®åº“</span><br><span class="line">exit ;</span><br></pre></td></tr></table></figure><p>æ•°æ®åº“è¯­è¨€CURDä¸šåŠ¡ç¨‹åºå‘˜ï¼ˆç®€å•çš„å¢åˆ æ”¹æŸ¥ï¼‰ï¼ŒAPIï¼Œ</p><h3 id="DDL-æ•°æ®åº“å®šä¹‰è¯­è¨€-ï¼š">DDL(æ•°æ®åº“å®šä¹‰è¯­è¨€)ï¼š</h3><p><strong>æ˜¯å¯¹æ•°æ®åº“å†…éƒ¨çš„å¯¹è±¡è¿›è¡Œåˆ›å»ºï¼Œåˆ é™¤ï¼Œä¿®æ”¹ç­‰çš„æ“ä½œè¯­è¨€ã€‚å®ƒå’ŒDMLè¯­è¨€æœ€å¤§çš„åŒºåˆ«æ˜¯DMLåªæ˜¯å¯¹è¡¨å†…éƒ¨æ•°æ®çš„æ“ä½œï¼Œè€Œä¸æ¶‰åŠåˆ°è¡¨çš„å®šä¹‰ï¼Œç»“æ„çš„ä¿®æ”¹ï¼Œæ›´ä¸ä¼šæ¶‰åŠåˆ°å…¶å®ƒå¯¹è±¡ã€‚</strong></p><ol><li><p>åˆ›å»ºæ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create database if not exists &lt;name&gt; ; -- åˆ›å»ºä¸€ä¸ªæ•°æ®åº“</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop database if not exists &lt;name&gt; ; åˆ é™¤ä¸€ä¸ªæ•°æ®åº“</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨æ•°æ®åº“</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use &lt;name&gt; ; -- ä½¿ç”¨æ•°æ®åº“</span><br></pre></td></tr></table></figure><ol start="4"><li><p>æŸ¥çœ‹æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show databases; -- æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“</span><br></pre></td></tr></table></figure></li></ol><h4 id="æ•°æ®åº“çš„æ•°æ®ç±»å‹">æ•°æ®åº“çš„æ•°æ®ç±»å‹</h4><blockquote><p>æ•°å€¼</p></blockquote><table><thead><tr><th>tinyint</th><th>ååˆ†å°çš„æ•°æ®</th><th>1ä¸ªå­—èŠ‚</th></tr></thead><tbody><tr><td>smallint</td><td>æ¯”è¾ƒå°çš„æ•°æ®</td><td>2ä¸ªå­—èŠ‚</td></tr><tr><td>mediumint</td><td>ä¸­ç­‰å¤§å°çš„æ•°æ®</td><td>3ä¸ªå­—èŠ‚</td></tr><tr><td>int</td><td>æ ‡å‡†çš„æ•´æ•°</td><td>4ä¸ªå­—èŠ‚</td></tr><tr><td>bigint</td><td>è¾ƒå¤§çš„æ•°æ®</td><td>8ä¸ªå­—èŠ‚</td></tr><tr><td>float</td><td>å•ç²¾åº¦ï¼ˆæµ®ç‚¹æ€§ï¼‰</td><td>4ä¸ªå­—èŠ‚</td></tr><tr><td>double</td><td>åŒç²¾åº¦</td><td>8ä¸ªå­—èŠ‚</td></tr><tr><td>decimal</td><td>å­—ç¬¦ä¸²å½¢å¼çš„æµ®ç‚¹æ•°</td><td>é‡‘èè®¡ç®—çš„æ—¶å€™ä¸€èˆ¬ä½¿ç”¨</td></tr></tbody></table><blockquote><p>å­—ç¬¦ä¸²</p></blockquote><table><thead><tr><th><strong>char</strong></th><th><strong>å­—ç¬¦ä¸²å›ºå®šå¤§å°</strong></th><th><strong>0-255</strong></th></tr></thead><tbody><tr><td>varchar :1st_place_medal:</td><td>å¯å˜å­—ç¬¦ä¸²</td><td>0-65535</td></tr><tr><td>tinytext</td><td>å¾®å‹æ–‡æœ¬</td><td>2^8 -1</td></tr><tr><td>text :2nd_place_medal:</td><td>æ–‡æœ¬ä¸²</td><td>2^16-1</td></tr></tbody></table><blockquote><p>æ—¶é—´æ—¥æœŸ</p></blockquote><table><thead><tr><th>date</th><th>YYYY-MM-DD</th><th>æ—¥æœŸæ ¼å¼</th></tr></thead><tbody><tr><td>time</td><td>HH:mm:ss</td><td>æ—¶åŒºæ ¼å¼</td></tr><tr><td>datetime</td><td>YYYY-MM-DD HH:mm:ss</td><td>æœ€é•¿ç”¨çš„æ—¶é—´æ ¼å¼</td></tr><tr><td>timestamp</td><td>æ—¶é—´æˆ³ï¼Œ1970.1.1</td><td>ä»1970.1.1åˆ°ç°åœ¨çš„æ¯«ç§’æ•°ï¼ä¹Ÿæ¯”è¾ƒå¸¸ç”¨</td></tr><tr><td>year</td><td>å¹´ä»½è¡¨ç¤º</td><td></td></tr></tbody></table><blockquote><p>null</p></blockquote><p>æ²¡æœ‰å€¼ï¼Œæ³¨æ„ï¼Œä¸è¦ä½¿ç”¨nullè¿›è¡Œè¿ç®—ï¼Œç»“æœè¿ç®—ä¸ºnull.</p><h4 id="æ•°æ®åº“çš„å­æ®µå±æ€§ï¼š">æ•°æ®åº“çš„å­æ®µå±æ€§ï¼š</h4><p><strong>Unsignedï¼š</strong></p><ul><li>æ— ç¬¦å·çš„æ•´æ•°</li><li>å£°æ˜äº†è¯¥åˆ—ä¸èƒ½å£°æ˜ä¸ºè´Ÿæ•°</li></ul><p><strong>zerofillï¼š</strong></p><ul><li>0å¡«å……çš„</li><li>ä¸è¶³çš„ä½æ•°ï¼Œç”¨0æ¥è¡¥å……,int(3)ï¼Œ 5  â€”  005</li></ul><p><strong>è‡ªå¢</strong></p><ul><li>é€šå¸¸ç†è§£ä¸ºè‡ªå¢ï¼Œè‡ªåŠ¨åœ¨ä¸Šä¸€æ¡è®°å½•çš„åŸºç¡€ä¹‹ä¸Š+1(é»˜è®¤)ã€‚</li><li>é€šå¸¸ç”¨æ¥è®¾è®¡å”¯ä¸€çš„ä¸»é”®-- index,å¿…é¡»æ˜¯æ•´æ•°ç±»å‹ã€‚</li><li>å¯ä»¥è‡ªå®šä¹‰è®¾è®¡ä¸»é”®è‡ªå¢çš„èµ·å§‹å€¼å’Œæ­¥é•¿</li></ul><p><strong>éç©º null  not  null:</strong></p><ul><li><p>å‡è®¾è®¾ç½®ä¸ºnot null å¦‚æœä¸ç»™ä»–èµ‹å€¼å°±ä¼šæŠ¥é”™</p></li><li><p>null å¦‚æœä¸å¡«å†™å€¼ï¼Œè¿™ä¸ªå€¼å°±ä¼šè‡ªåŠ¨å¡«å……ä¸ºç©ºå€¼ã€‚</p></li></ul><p><strong>é»˜è®¤</strong></p><p>è®¾ç½®é»˜è®¤çš„å€¼</p><p>å¦‚æœä¸ç»™ä»–è®¾ç½®å€¼ï¼Œä»–å°±ä¼šé»˜è®¤ä¸ºæˆ‘ä»¬è®¾ç½®çš„å¡«å……å€¼</p><p><strong>ä¸€èˆ¬åˆ›å»ºè¡¨æ ¼çš„æ—¶å€™æˆ‘ä»¬å¿…é¡»åˆ›å»ºçš„å­˜åœ¨çš„5ä¸ªå­—æ®µ</strong></p><blockquote><p>id  ä¸»é”®</p><p>version  ä¹è§‚é”</p><p>is_delete     ä¼ªåˆ é™¤ æ•°æ®æ— ä»·å‡åˆ é™¤ä¿æ•°æ®</p><p>gmt_create  åˆ›å»ºæ—¶é—´</p><p>gmt_update  åˆ é™¤æ—¶é—´</p></blockquote><p><strong>åˆ›å»ºè¡¨</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-- åˆ›å»ºè¡¨æ ¼ï¼Œä¸€èˆ¬è¡¨é¢æˆ‘ä»¬ä½¿ç”¨``è¿›è¡Œæ ‡è®°</span><br><span class="line">-- æ³¨æ„è¡¨ä¸­å­—ç¬¦ä¸²çš„ä½¿ç”¨ä¸€èˆ¬æ˜¯å•å¼•å·æˆ–è€…åŒå¼•å·</span><br><span class="line">-- æ‰€æœ‰çš„è¯­å¥åæ·»åŠ ï¼Œæœ€åä¸€ä¸ªä¸è¦åŠ </span><br><span class="line"></span><br><span class="line">create table if not exists test1(</span><br><span class="line">    -- id åˆ—å  int æ•°æ®ç±»å‹  primary key ä¸»é”® not null ä¸ä¸ºç©º auto_increment è‡ªå¢   comment &quot;&quot; åˆ«å</span><br><span class="line">id  int  primary key  not null auto_increment comment &#x27;ä¸»é”®&#x27;,</span><br><span class="line">    -- default &#x27;&#x27; é»˜è®¤çš„</span><br><span class="line">    name varchar(10) not null default &#x27;åŒ¿å&#x27; comment &#x27;å§“å&#x27;ï¼Œ</span><br><span class="line">    </span><br><span class="line">    birthday datetime default null comment &#x27;ç”Ÿæ—¥&#x27;</span><br><span class="line"></span><br><span class="line">)Engine=innodb default charset=utf8;</span><br></pre></td></tr></table></figure><p>æ ¼å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists(</span><br><span class="line">`å­—æ®µå` åˆ—ç±»å‹ [å±æ€§] [ç´¢å¼•] [æ³¨é‡Š],</span><br><span class="line">    `å­—æ®µå` åˆ—ç±»å‹ [å±æ€§] [ç´¢å¼•] [æ³¨é‡Š],</span><br><span class="line">    `å­—æ®µå` åˆ—ç±»å‹ [å±æ€§] [ç´¢å¼•] [æ³¨é‡Š],</span><br><span class="line">    .....</span><br><span class="line">    `å­—æ®µå` åˆ—ç±»å‹ [å±æ€§] [ç´¢å¼•] [æ³¨é‡Š]</span><br><span class="line">)[è¡¨ç±»å‹][å­—ç¬¦ç¼–ç é›†][æ³¨é‡Š]</span><br><span class="line"></span><br><span class="line">show create database [æ•°æ®åº“å]  -- æŸ¥çœ‹åˆ›å»ºæ•°æ®åº“çš„è¯­å¥</span><br><span class="line">show create table [æ•°æ®åº“å] -- æŸ¥çœ‹æ•°æ®åº“è¡¨çš„å®šä¹‰è¯­å¥</span><br><span class="line">Desc [è¡¨å] -- æ˜¾ç¤ºè¡¨çš„ç»“æ„</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æ•°æ®åº“å¼•æ“</strong></p><p><strong>MYISAM   æ—©å…ˆå¹´ä½¿ç”¨çš„</strong></p><blockquote><p>äº‹åŠ¡æ”¯æŒï¼š ä¸æ”¯æŒ</p><p>æ•°æ®è¡Œé”å®šï¼šä¸æ”¯æŒ</p><p>å¤–é”®ï¼šä¸æ”¯æŒ</p><p>å…¨æ–‡ç´¢å¼•ï¼š æ”¯æŒ</p><p>è¡¨ç©ºé—´å¤§å° ï¼š è¾ƒå°</p></blockquote><p><strong>INNODB ç›®å‰é»˜è®¤ä½¿ç”¨çš„</strong></p><blockquote><p>äº‹åŠ¡æ”¯æŒï¼š æ”¯æŒ</p><p>æ•°æ®è¡Œé”å®šï¼šæ”¯æŒ</p><p>å¤–é”®ï¼šæ”¯æŒ</p><p>å…¨æ–‡ç´¢å¼•ï¼š ä¸æ”¯æŒ</p><p>è¡¨ç©ºé—´å¤§å°ï¼šè¾ƒå¤§ï¼Œçº¦ä¸º2å€</p></blockquote><p><strong>å¸¸è§„ä½¿ç”¨æ“ä½œï¼š</strong></p><blockquote><p>MYISAM èŠ‚çº¦ç©ºé—´ï¼Œé€Ÿåº¦è¾ƒå¿«</p><p>INNODB å®‰å…¨æ€§é«˜ï¼Œäº‹åŠ¡çš„å¤„ç†ï¼Œå¤šè¡¨å¤šç”¨æˆ·æ“ä½œ</p></blockquote><blockquote><p>åœ¨ç‰©ç†ç©ºé—´å­˜å‚¨çš„ä½ç½®</p></blockquote><p>æ‰€æœ‰çš„æ•°æ®åº“æ–‡ä»¶éƒ½å­˜åœ¨dataä¸‹ä¸€ä¸ªæ–‡ä»¶å¤¹å°±ä»£è¡¨ä¸€ä¸ªæ•°æ®åº“</p><p>æœ¬è´¨è¿˜æ˜¯æ–‡ä»¶çš„å­˜å‚¨</p><h5 id="MYSQLå¼•æ“åœ¨ç‰©ç†æ–‡ä»¶ä¸Šçš„åŒºåˆ«">MYSQLå¼•æ“åœ¨ç‰©ç†æ–‡ä»¶ä¸Šçš„åŒºåˆ«</h5><ul><li><p>â€‹InnoDBåœ¨æ•°æ®åº“è¡¨ä¸­åªæœ‰ä¸€ä¸ª*.frmæ–‡ä»¶ï¼Œä»¥åŠç›®å½•ä¸Šçº§ç›®å½•ä¸‹çš„ibdata1æ–‡ä»¶</p><p>â€‹MYISAMå¯¹åº”æ–‡ä»¶</p><ul><li>*.frm --è¡¨ç»“æ„çš„å®šä¹‰æ–‡ä»¶</li><li>*.MYD æ•°æ®æ–‡ä»¶ï¼ˆdataï¼‰</li><li>*.MYI  ç´¢å¼•æ–‡ä»¶ï¼ˆindexï¼‰</li></ul></li></ul><blockquote><p>è®¾ç½®æ•°æ®åº“è¡¨çš„å­—ç¬¦é›†ç¼–ç </p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">charset=utf8;</span><br></pre></td></tr></table></figure><p>ä¸è®¾ç½®çš„è¯ä¼šæ˜¯ä½¿ç”¨mysqlä¸­é»˜è®¤çš„ç¼–ç ï¼Œä»–ä¸æ”¯æŒä¸­æ–‡ã€‚</p><p>my.iniä¸­é…ç½®é»˜è®¤çš„ç¼–ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">character-set-server=utf8;</span><br></pre></td></tr></table></figure><p>===============================================================</p><h5 id="ä¿®æ”¹è¡¨">ä¿®æ”¹è¡¨</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- ä¿®æ”¹è¡¨çš„åå­— alter table æ—§è¡¨å  rename as æ–°è¡¨å</span><br><span class="line">alter table san rename san1;</span><br></pre></td></tr></table></figure><h5 id="å¢åŠ è¡¨å­—æ®µ">å¢åŠ è¡¨å­—æ®µ</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- æ·»åŠ è¡¨å­—æ®µ alter table è¡¨å add åˆ—å æ•°æ®ç±»å‹</span><br><span class="line">alter table test add min int(4);</span><br></pre></td></tr></table></figure><h5 id="ä¿®æ”¹è¡¨çš„å­—æ®µ">ä¿®æ”¹è¡¨çš„å­—æ®µ</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-- ä¿®æ”¹çº¦æŸ alter table è¡¨å modify åˆ—å æ•°æ®ç±»å‹</span><br><span class="line">alter table test modify min varchar(20);</span><br><span class="line"></span><br><span class="line">-- å­—æ®µ é‡å‘½å ä»¥åŠä¿®æ”¹çº¦æŸ  alter  table  è¡¨å change æ—§åå­— æ–°åå­— åˆ—å±æ€§</span><br><span class="line">alter table test change min min1 int(11); </span><br><span class="line"></span><br><span class="line">-- åˆ é™¤è¡¨å­—æ®µ  alter table è¡¨å drop åˆ—å</span><br><span class="line">alter table è¡¨å drop åˆ—åï¼›</span><br><span class="line"></span><br><span class="line">-- åˆ é™¤è¡¨ </span><br><span class="line">drop table if exists è¡¨å</span><br></pre></td></tr></table></figure><p>== æ‰€æœ‰çš„åˆ›å»ºå’Œåˆ é™¤æ“ä½œåŠ²é‡åŠ ä¸Šåˆ¤æ–­ï¼Œä»¥å…é€ æˆé”™è¯¯ ==</p><h4 id="MYSQLæ•°æ®ç®¡ç†"><strong>MYSQLæ•°æ®ç®¡ç†</strong></h4><h5 id="å¤–é”®">å¤–é”®</h5><p>æ–¹å¼ä¸€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-- å®šä¹‰å¤–é”®key</span><br><span class="line">-- ç»™è¿™ä¸ªå¤–é”®æ·»åŠ çº¦æŸæ‰§è¡Œå¼•ç”¨ references å¼•ç”¨</span><br><span class="line">key FK_åˆ—å(åˆ—å) ï¼Œ</span><br><span class="line">constraint FK_åˆ—å foreign key åˆ—å references è¡¨åï¼ˆåˆ—åï¼‰</span><br><span class="line"></span><br><span class="line">-- æ–¹å¼äºŒï¼Œåˆ›å»ºè¡¨æˆåŠŸåï¼Œæ·»åŠ å¤–é”®çº¦æŸ</span><br><span class="line">alter table test</span><br><span class="line">add constraint FK_åˆ—å foregin key (åˆ—å) references  `è¡¨å`(åˆ—å)ï¼›</span><br><span class="line">-- alter table è¡¨ add constraint çº¦æŸå foreign key(ä½œä¸ºä¸»é”®çš„åˆ—) referebces é‚£ä¸ªè¡¨ï¼ˆå“ªä¸ªå­—æ®µï¼‰</span><br></pre></td></tr></table></figure><p>åˆ é™¤æœ‰å¤–é”®å…³è”çš„å€¼çš„æ—¶å€™ï¼Œå¿…é¡»è¦åˆ é™¤å¤–é”®ã€‚</p><p>æœ€å¥½çš„åŠæ³•ï¼Œæ•°æ®åº“å°±æ˜¯å•çº¯çš„è¡¨ï¼Œç”¨æ¥å­˜æ•°æ®ï¼Œåªæœ‰è¡Œå’Œåˆ—</p><p>æˆ‘ä»¬æƒ³ä½¿ç”¨å¤šå¼ è¡¨çš„æ—¶å€™æƒ³ä½¿ç”¨å¤–é”®ã€‚</p><h3 id="DMLï¼ˆæ•°æ®åº“æ“ä½œè¯­è¨€ï¼‰ï¼š">DMLï¼ˆæ•°æ®åº“æ“ä½œè¯­è¨€ï¼‰ï¼š</h3><p><strong>æ•°æ®æ“ä½œè¯­è¨€DMLï¼ˆData Manipulation Languageï¼‰ï¼Œç”¨æˆ·é€šè¿‡å®ƒå¯ä»¥å®ç°å¯¹æ•°æ®åº“çš„åŸºæœ¬æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¯¹è¡¨ä¸­æ•°æ®çš„æŸ¥è¯¢ã€æ’å…¥ã€åˆ é™¤å’Œä¿®æ”¹ã€‚ åœ¨DMLä¸­ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å¯¹æ•°æ®åº“ä½œæ’ï¼Œåˆ ï¼Œæ”¹ï¼Œæ’ï¼Œæ£€ç­‰äº”ç§æ“ä½œ</strong></p><p>æ•°æ®åº“æ„ä¹‰ï¼Œå­˜å‚¨ï¼Œç®¡ç†ã€‚</p><p>åˆ›å»ºä¸€ä¸ªè¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists test(</span><br><span class="line">    -- id åˆ—å  int æ•°æ®ç±»å‹  primary key ä¸»é”® not null ä¸ä¸ºç©º auto_increment è‡ªå¢   comment &quot;&quot; åˆ«å</span><br><span class="line">id  int  primary key  not null auto_increment comment &#x27;ä¸»é”®&#x27;,</span><br><span class="line">    -- default &#x27;&#x27; é»˜è®¤çš„</span><br><span class="line">    name varchar(10) not null default &#x27;åŒ¿å&#x27; comment &#x27;å§“å&#x27;</span><br><span class="line">)Engine=innodb default charset=utf8;</span><br></pre></td></tr></table></figure><h5 id="æ·»åŠ -insert">æ·»åŠ (insert):</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-- ä¸€èˆ¬å†™æ’å…¥è¯­å¥ï¼Œæˆ‘ä»¬ä¸€å®šè¦æ•°æ®å’Œå­—æ®µä¸€ä¸€å¯¹åº” ä¸€ä¸ªå­æ®µå¯¹åº”ä¸€ä¸ªå€¼</span><br><span class="line">-- æ’å…¥æ•°æ®</span><br><span class="line">insert into è¡¨å (ã€å­—æ®µ1ï¼Œè‡ªæ®µ2ï¼Œå­—æ®µä¸‰ã€‘) value (&#x27;å€¼1&#x27;)ï¼Œ(&#x27;å€¼2&#x27;),(&#x27;å€¼3&#x27;)ï¼›</span><br><span class="line"></span><br><span class="line">insert into test(name) value(&quot;å¼ ä¸‰&quot;)ï¼›</span><br><span class="line"> -- æˆ–è€…</span><br><span class="line"> -- å·²çŸ¥åˆ—  id name </span><br><span class="line"> insert into test value (&#x27;12&#x27;,&#x27;name&#x27;)ï¼›</span><br><span class="line"> </span><br><span class="line"> -- ç”±äºä¸»é”®è‡ªå¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸æ’å…¥id</span><br><span class="line"> insert into test value( ,&#x27;name&#x27;)ï¼›</span><br><span class="line"> </span><br><span class="line"> -- ä¸€æ¬¡æ’å…¥å¤šä¸ªæ•°æ®</span><br><span class="line"> insert into test(name) value (&#x27;å¼ ä¸‰&#x27;),ï¼ˆ&#x27;æå››&#x27;ï¼‰;</span><br><span class="line"> </span><br><span class="line"> </span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ol><li>å­—æ®µä½¿ç”¨è‹±æ–‡é€—å·éš”å¼€</li><li>ä¸å†™å…·ä½“çš„åˆ—è¿›è¡Œæ’å…¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ’å…¥çš„æ—¶å€™å°±éœ€è¦æ•´ä¸ªæ•°æ®åº“åˆ—çš„å€¼å…¨éƒ¨æ’å…¥</li><li>å­—æ®µå¯ä»¥çœç•¥ï¼Œä½†æ˜¯åé¢çš„å€¼å¿…é¡»è¦ä¸€ä¸€å¯¹åº”ï¼Œä¸èƒ½å°‘</li><li>å¯ä»¥åŒæ—¶æ’å…¥å¤šæ¡æ•°æ®ï¼Œvalueåè¾¹çš„å€¼ï¼Œéœ€è¦ä½¿ç”¨ è‹±æ–‡é€—å·éš”å¼€ã€‚(),()</li></ol><h5 id="æ›´æ–°-update">æ›´æ–°(update):</h5><p>ä¸€èˆ¬æ˜¯æ›´æ–°æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œè€Œä¸æ˜¯æ›´æ–°è¡¨çš„å­æ®µã€‚ã€‚ã€‚ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-- ä¿®æ”¹å­¦å‘˜çš„åå­—</span><br><span class="line">update test set name = &#x27;å¼ ä¸‰&#x27; where id = 1 ;</span><br><span class="line">-- åœ¨ä¸æŒ‡å®šå…·ä½“çš„æ¡ä»¶çš„æƒ…å†µä¸‹æ›´æ”¹ä¼šæ›´æ”¹è¡¨ä¸­æ‰€æœ‰nameçš„æ•°æ®</span><br><span class="line">update test set name = &#x27;æå››&#x27;;  -- æ›´æ–°æ•´ä¸ªè¡¨ä¸­åˆ—ä¸ºnameçš„æ‰€æœ‰æ•°æ®æ˜¯nameéƒ½ç­‰äº&#x27;æå››&#x27;ï¼›  åˆ‡è®°ä¸è¦å‚»ä¹ä¹çš„ä½¿ç”¨ã€‚ã€‚ã€‚åæœå°±æ˜¯åˆ åº“è·‘è·¯</span><br><span class="line"></span><br><span class="line">-- ä¿®æ”¹å¤šä¸ªå±æ€§ï¼Œé€—å·éš”å¼€</span><br><span class="line">update test set name =  &#x27;å¼ ä¸‰&#x27;  , tel = &#x27;123321&#x27;, email = &#x27;2569758@qq.com&#x27; where id = 1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- è¯­æ³• </span><br><span class="line">update è¡¨å set ã€åˆ—å1 = å€¼1ï¼Œåˆ—2 = å€¼2 ã€‚ã€‚ã€‚ã€‚ã€‘ where ã€æ¡ä»¶ã€‘ï¼› </span><br><span class="line"></span><br></pre></td></tr></table></figure><table><thead><tr><th>æ“ä½œç¬¦</th><th>å«ä¹‰</th><th>èŒƒå›´</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>=</td><td>ç­‰äº</td><td>5=6</td><td>false</td></tr><tr><td>&lt;&gt; æˆ–  !=</td><td>ä¸ç­‰äº</td><td>5&lt;&gt; 6</td><td>true</td></tr><tr><td>&gt;</td><td>å¤§äº</td><td>5&gt;6</td><td>false</td></tr><tr><td>&lt;</td><td>å°äº</td><td>5&lt;6</td><td>true</td></tr><tr><td>&lt;=</td><td>å°äºç­‰äº</td><td>â€“</td><td></td></tr><tr><td>&gt;=</td><td>å¤§äºç­‰äº</td><td>â€“</td><td></td></tr><tr><td>betweenâ€¦ and â€¦</td><td>ä»‹äºâ€¦ä¹‹é—´</td><td>[2,5]</td><td></td></tr><tr><td>and</td><td>å’Œ</td><td>5&gt;1 and 1&gt;2</td><td>false</td></tr><tr><td>or</td><td>æˆ–</td><td>5&gt;1 or 1&gt;2</td><td>true</td></tr></tbody></table><p><code>update è¡¨å set ã€åˆ—å1 = å€¼1ï¼Œåˆ—2 = å€¼2 ã€‚ã€‚ã€‚ã€‚ã€‘ where ã€æ¡ä»¶ã€‘ï¼›</code></p><p>æ³¨æ„ï¼š</p><ol><li><p>æ›´æ–°æŸä¸ªç±»éœ€è¦æŒ‡å®šåˆ—åï¼Œé¡ºå¸¦åŠ ä¸Šæ¡ä»¶ï¼Œæ²¡æœ‰åŠ æ¡ä»¶åˆ™ä¼šæ›´æ–°æ‰€æœ‰çš„åˆ—</p></li><li><p>ä¸åŒåˆ—åä¹‹é—´éœ€è¦åŠ ï¼Œéš”å¼€ã€‚</p></li></ol><h5 id="åˆ é™¤-delete">åˆ é™¤(delete)</h5><p>åˆ é™¤è¡¨ä¸­çš„æ•°æ®ï¼Œå’Œdropä¸ä¸€æ ·ï¼Œdropæ˜¯åˆ é™¤æ•´ä¸ªè¡¨ï¼Œdeleteæ˜¯åˆ é™¤è¡¨ä¸­çš„æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- åˆ é™¤æ•°æ® å°½é‡é¿å…ä¸æ·»åŠ æ¡ä»¶åˆ é™¤</span><br><span class="line">delete from è¡¨å ; -- è¿™æ ·ä¼šåˆ é™¤æ•´ä¸ªæ•°æ®åº“</span><br><span class="line"></span><br><span class="line">-- åˆ é™¤æŒ‡å®šæ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ ¹æ®æ¡ä»¶åˆ é™¤</span><br><span class="line">delete from è¡¨å where  åˆ—å1 = å€¼1 and åˆ—å2 = å€¼2 ...ï¼›</span><br></pre></td></tr></table></figure><h5 id="TRUNCATEå‘½ä»¤ï¼ˆæ¨èï¼‰">TRUNCATEå‘½ä»¤ï¼ˆæ¨èï¼‰</h5><p>æ¸…ç©ºæŸä¸€å¼ è¡¨ã€‚ã€‚ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- æ¸…ç©ºstudentè¡¨ truncate</span><br><span class="line">TRUNCATE è¡¨åï¼›</span><br></pre></td></tr></table></figure><h5 id="delete-å’Œ-truncateåŒºåˆ«ï¼š">delete å’Œ truncateåŒºåˆ«ï¼š</h5><ol><li>ç›¸åŒç‚¹ï¼šéƒ½èƒ½åˆ é™¤è¡¨æ•°æ®ï¼Œä¸”ä¸ä¼šåˆ é™¤è¡¨ç»“æ„</li><li>ä¸åŒï¼š<ol><li>truncate é‡æ–°è®¾ç½®<strong>è‡ªå¢åˆ—</strong> è®°æ•°å™¨ä¼šå½’é›¶</li><li>truncateä¸ä¼šå½±å“äº‹åŠ¡</li></ol></li></ol><p><strong>deleteåˆ é™¤é—®é¢˜ï¼Œé‡å¯æ•°æ®åº“ï¼Œç°è±¡</strong></p><blockquote><p>InnoDB è‡ªå¢ä¼šé‡1å¼€å§‹(å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œæ–­ç”µå°±å¤±å»)ï¼›</p><p>MyISAM ç»§ç»­ä»ä¸Šä¸€ä¸ªè‡ªå¢é‡å¼€å§‹(å­˜åœ¨æ–‡ä»¶ä¸­ï¼Œä¸ä¼šä¸¢å¤±ï¼‰</p></blockquote><h3 id="DQLï¼ˆæ•°æ®åº“æŸ¥è¯¢è¯­è¨€ï¼‰ï¼š">DQLï¼ˆæ•°æ®åº“æŸ¥è¯¢è¯­è¨€ï¼‰ï¼š</h3><p><strong>DQLï¼ˆdata query languageï¼‰æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼Œä¸“é—¨ç”¨æ¥æŸ¥è¯¢æ•°æ®ã€‚</strong></p><ul><li>ä¸€èˆ¬ä½¿ç”¨çš„éƒ½æ˜¯Select æ‰€æœ‰çš„æŸ¥è¯¢æ“ä½œéƒ½æ˜¯è¿™ä¸ª</li><li>ç®€å•çš„æŸ¥è¯¢å’Œå¤æ‚çš„æŸ¥è¯¢éƒ½èƒ½åš</li><li>æ•°æ®åº“ä¸­æœ€æ ¸å¿ƒçš„è¯­è¨€ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„è¯­å¥ã€‚</li><li>ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„è¯­å¥</li></ul><h5 id="æŸ¥è¯¢æ‰€æœ‰">æŸ¥è¯¢æ‰€æœ‰</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from è¡¨åï¼› -- ä¸€èˆ¬ä¸æ¨èä½¿ç”¨ sqlä¼˜åŒ–ä¸æ¨èä½¿ç”¨</span><br></pre></td></tr></table></figure><h5 id="æŸ¥è¯¢æŒ‡å®šå­—æ®µ">æŸ¥è¯¢æŒ‡å®šå­—æ®µ</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id , name fromè¡¨åï¼› </span><br></pre></td></tr></table></figure><h5 id="æŸ¥è¯¢èµ·åˆ«åï¼Œç„¶åé€šè¿‡åˆ«åå¾—åˆ°æ•°æ®">æŸ¥è¯¢èµ·åˆ«åï¼Œç„¶åé€šè¿‡åˆ«åå¾—åˆ°æ•°æ®</h5><p>as å¯ä»¥ç»™å­—æ®µèµ·åˆ«åï¼Œä¹Ÿå¯ä»¥ç»™è¡¨èµ·åˆ«å</p><p>å¦‚ ï¼š from è¡¨å as â€˜åˆ«åâ€™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select åˆ—å1 as &#x27;åˆ«å1&#x27; , åˆ—å2 as &#x27;åˆ«å2&#x27; ... from è¡¨åï¼›</span><br></pre></td></tr></table></figure><h5 id="å»é‡æŸ¥è¯¢distinct">å»é‡æŸ¥è¯¢distinct</h5><p>å»é™¤æŸ¥åˆ°çš„é‡å¤çš„å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select distinct åˆ—å from è¡¨åï¼›  -- æŸ¥è¯¢è¡¨ä¸­é‡å¤çš„æ•°æ®ï¼Œä½¿å¾—é‡å¤çš„æ•°æ®åªæ˜¾ç¤ºä¸€æ¡ã€‚</span><br><span class="line"></span><br><span class="line">select version() ; -- æŸ¥è¯¢ç³»ç»Ÿç‰ˆæœ¬</span><br><span class="line">select 100*3 -1 as &#x27;ç»“æœ&#x27; ;  -- ç”¨æ¥è®¡ç®—  </span><br><span class="line">select @@auto_increment_increment ;   -- æŸ¥è¯¢è‡ªå¢çš„æ­¥é•¿ï¼ˆå˜é‡ï¼‰</span><br><span class="line"></span><br><span class="line">-- ä¾‹å­ æŸ¥è¯¢è€ƒè¯•æˆç»© + 1 æŸ¥çœ‹</span><br><span class="line">select id , scode + 1 as &#x27;åŠ åˆ†å&#x27; from è¡¨å;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="æ•°æ®åº“ä¸­è¡¨è¾¾å¼ï¼š">æ•°æ®åº“ä¸­è¡¨è¾¾å¼ï¼š</h5><p>æ–‡æœ¬å€¼ï¼Œåˆ—ï¼ŒNULLï¼Œå‡½æ•°ï¼Œè®¡ç®—è¡¨è¾¾å¼ï¼Œç³»ç»Ÿå˜é‡â€¦</p><blockquote><p>select è¡¨è¾¾å¼ from è¡¨åï¼›</p></blockquote><h5 id="WHEREæ¡ä»¶">WHEREæ¡ä»¶</h5><p>ä¸€èˆ¬ä½œä¸ºæ£€ç´¢æ•°æ®ä¸­çš„ç¬¦åˆæ¡ä»¶çš„å€¼</p><p>æœç´¢çš„æ¡ä»¶ä¸€èˆ¬ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ¡ä»¶ç»„æˆã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">select id , score from è¡¨åï¼›</span><br><span class="line">-- æŸ¥è¯¢æˆç»©åœ¨95 - 100 ç›´æ¥çš„ id</span><br><span class="line">select id from è¡¨å where score &gt;=95  and score &lt;= 100;</span><br><span class="line"></span><br><span class="line">-- and  &amp;&amp; </span><br><span class="line">select id from è¡¨å where score &gt;=95  &amp;&amp; score &lt;= 100;</span><br><span class="line"></span><br><span class="line">-- æ¨¡ç³ŠæŸ¥è¯¢ï¼ˆbetweenï¼‰</span><br><span class="line">select id from è¡¨å where score between 95 and 100;</span><br><span class="line"></span><br><span class="line">-- é™¤äº†1000å·åŒå­¦ä»¥ä¸ºçš„æ‰€æœ‰åŒå­¦çš„æˆç»©</span><br><span class="line">select id ,score from è¡¨å where id != 1000;</span><br><span class="line"></span><br><span class="line">-- != not </span><br><span class="line">select id ,score from è¡¨å where not id = 1000;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>äº†è§£é€»è¾‘è¿ç®—ç¬¦ï¼š</p></blockquote><table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯­æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td>and           &amp;&amp;</td><td>a and b  a &amp;&amp; b</td><td>é€»è¾‘ä¸ï¼Œä¸¤çœŸä¸ºçœŸ</td></tr><tr><td>or              ||</td><td>a || b         a   or  b</td><td>é€»è¾‘æˆ– ï¼Œä¸€çœŸä¸ºçœŸï¼Œå…¨å‡ä¸ºå‡</td></tr><tr><td>not           !</td><td>not  a           !a</td><td>é€»è¾‘éï¼ŒçœŸä¸ºå‡ï¼Œå‡ä¸ºçœŸ****</td></tr></tbody></table><p><strong>æ¨¡ç³ŠæŸ¥è¯¢</strong></p><table><thead><tr><th>è¿ç®—ç¬¦</th><th>è¯­æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td>is null</td><td>a is  null</td><td>å¦‚æœæ“ä½œç¬¦ä¸ºnull,ç»“æœä¸ºçœŸ</td></tr><tr><td>is not null</td><td>a is not null</td><td>å¦‚æœæ“ä½œç¬¦ä¸ä¸ºç©ºï¼Œç»“æœä¸ºçœŸ</td></tr><tr><td>between</td><td>a between b and c</td><td>å¦‚æœaåœ¨bå’Œcä¹‹é—´ï¼Œåˆ™ç»“æœä¸ºçœŸ</td></tr><tr><td>like</td><td>a like  b</td><td>sqlåŒ¹é…æˆåŠŸï¼Œå¦‚æœaåŒ¹é…bï¼Œåˆ™ç»“æœä¸ºçœŸ</td></tr><tr><td>in</td><td>a in b</td><td>a åœ¨ b ä¸­</td></tr><tr><td></td><td></td><td></td></tr></tbody></table><p>ä¸¾ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">-- æŸ¥è¯¢å§“åˆ˜çš„åŒå­¦çš„åå­—</span><br><span class="line">select id , name from è¡¨å where name like &#x27;åˆ˜%&#x27;ï¼›</span><br><span class="line"></span><br><span class="line">-- æŸ¥è¯¢å§“åˆ˜çš„åŒå­¦ï¼Œä¸”åªæœ‰ä¸€ä¸ªå­—çš„</span><br><span class="line">select id , name from è¡¨å where name like &#x27;åˆ˜_&#x27;ï¼›</span><br><span class="line"></span><br><span class="line">-- æŸ¥è¯¢å§“åˆ˜çš„åŒå­¦ï¼Œä¸”åªæœ‰ä¸¤ä¸ªå­—çš„</span><br><span class="line">select id , name from è¡¨å where name like &#x27;åˆ˜__&#x27;ï¼›</span><br><span class="line"></span><br><span class="line">-- æŸ¥è¯¢åå­—ä¸­æœ‰å˜‰çš„åŒå­¦ï¼Œ%å˜‰%</span><br><span class="line">select id , name from è¡¨å where name like &#x27;%å˜‰%&#x27;ï¼›</span><br><span class="line"></span><br><span class="line">-- =================== inï¼ˆå…·ä½“çš„ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ï¼‰ ================</span><br><span class="line"> -- æŸ¥è¯¢101,102,103 å·å­¦å‘˜</span><br><span class="line"> select id, name from è¡¨å where id in ( 101,102,103);</span><br><span class="line"> </span><br><span class="line"> -- ç”¨inæŸ¥è¯¢åå­—ç­‰äºå¼ ä¸‰ï¼Œæå››ã€‚ã€‚ã€‚çš„å­¦ç”Ÿ</span><br><span class="line"> select id , name from è¡¨å where name in (&#x27;å¼ ä¸‰&#x27;, &#x27;æå››&#x27; ,&#x27;ç‹äº”&#x27;...)ï¼›</span><br><span class="line"> </span><br><span class="line"> -- æŸ¥è¯¢å§“åä¸ºç©ºçš„å­¦ä¹ ï¼ˆå½“ç„¶æˆ‘ä»¬è®¾ç½®é»˜è®¤å€¼ï¼Œå¿…å®šä¸å­˜åœ¨è¿™ä¸ªå€¼ï¼‰</span><br><span class="line">  select id , name from è¡¨å where name  = &#x27;&#x27; or name is null;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  -- æŸ¥è¯¢å§“åä¸ä¸ºç©ºçš„åŒå­¦</span><br><span class="line">    select id , name from è¡¨å where name  != &#x27;&#x27; or name is not null;</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure><h5 id="è¿è¡¨æŸ¥è¯¢ï¼ˆJOIN-onï¼‰">è¿è¡¨æŸ¥è¯¢ï¼ˆJOIN onï¼‰</h5><p><img src="F:%5C%E4%B8%89%E6%9C%9F%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99%5C%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99%5CMysql%5C1666274982133.png" alt="1666274982133"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">-- è¿æ¥ä¸¤ä¸ªè¡¨</span><br><span class="line">select s.id , s.name ,cid ,cname </span><br><span class="line">from stu s inner join class as r</span><br><span class="line">where s.id = r.id;</span><br><span class="line"> </span><br><span class="line">-- å³è¿æ¥ right join </span><br><span class="line">select s.id , name , cid , cname from stu s</span><br><span class="line">right join class c</span><br><span class="line">on s.id = c.id</span><br><span class="line"></span><br><span class="line">-- å·¦è¿æ¥ left join  </span><br><span class="line">select s.id , name , cid , cname from stu s</span><br><span class="line">left join class c</span><br><span class="line">on s.id = c.id</span><br><span class="line"></span><br><span class="line">-- join  on  è¿æ¥æŸ¥è¯¢</span><br><span class="line">-- where  ç­‰å€¼æŸ¥è¯¢</span><br><span class="line"></span><br><span class="line">-- æŸ¥è¯¢nameä¸ºç©ºçš„åŒå­¦</span><br><span class="line">select s.id , sname , cid, cname </span><br><span class="line">from stu s left join </span><br><span class="line">class c on s.id = c.id </span><br><span class="line">where name is null;</span><br><span class="line"></span><br><span class="line">-- æŸ¥è¯¢æ—¶é—´ä¸ºç©ºçš„å­¦ç”Ÿä¿¡æ¯</span><br><span class="line">select s.id ,date, name ,cid , cname from stu s</span><br><span class="line">left join class c</span><br><span class="line">on s.id = c.id</span><br><span class="line">where date is null;</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:center">æ“ä½œ</th><th style="text-align:center">æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">inner   join</td><td style="text-align:center">å¦‚æœè¡¨ä¸­è‡³å°‘æœ‰ä¸€ä¸ªåŒ¹é…å€¼ï¼Œé‚£ä¹ˆå°±è¿”å›è¡Œ</td></tr><tr><td style="text-align:center">left join</td><td style="text-align:center">ä¼šä»å·¦è¡¨ä¸­è¿”å›æ‰€æœ‰çš„å€¼ï¼Œå³ä½¿å³è¡¨ä¸­æ²¡æœ‰</td></tr><tr><td style="text-align:center">right join</td><td style="text-align:center">ä¼šä»å³è¡¨ä¸­è¿”å›æ‰€æœ‰çš„å€¼ï¼Œå³ä½¿å·¦è¡¨ä¸­æ²¡æœ‰</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">-- æµ‹è¯•æ•°æ®åº“</span><br><span class="line">create table `table_a` (</span><br><span class="line">  `aid` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `a_name` varchar(255) NOT NULL,</span><br><span class="line">  `age` smallint NOT NULL,</span><br><span class="line">  PRIMARY KEY(`aid`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT &#x27;æµ‹è¯•è¡¨A&#x27;;</span><br><span class="line"> </span><br><span class="line">create table `table_b` (</span><br><span class="line">  `bid` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `b_name` varchar(255) NOT NULL,</span><br><span class="line">  `age` smallint NOT NULL,</span><br><span class="line">  PRIMARY KEY(`bid`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT &#x27;æµ‹è¯•è¡¨B&#x27;;</span><br><span class="line"> </span><br><span class="line"># æ’å…¥æµ‹è¯•æ•°æ®</span><br><span class="line">INSERT INTO `table_a`(aid, a_name, age) VALUES(1, &#x27;test1&#x27;, 1),(2, &#x27;test2&#x27;, 2),(3, &#x27;test3&#x27;, 3);</span><br><span class="line">INSERT INTO `table_b`(bid, b_name, age) VALUES(1, &#x27;test2&#x27;, 2),(2, &#x27;test3&#x27;, 3),(4, &#x27;test4&#x27;, 4);</span><br></pre></td></tr></table></figure><p>è¿™ä¸‰æ¡SQLéƒ½æ˜¯ç­‰ä»·çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM table_a JOIN table_b;</span><br><span class="line">SELECT * FROM table_a INNER JOIN table_b;</span><br><span class="line">SELECT * FROM table_a CROSS JOIN table_b;</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><h6 id="inner-joinè¿æ¥">inner  joinè¿æ¥</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-- ç›¸å½“äºç¬›å¡å°”ç§¯</span><br><span class="line">mysql&gt; SELECT * FROM table_a INNER JOIN table_b;</span><br><span class="line">+-----+--------+-----+-----+--------+-----+</span><br><span class="line">| aid | a_name | age | bid | b_name | age |</span><br><span class="line">+-----+--------+-----+-----+--------+-----+</span><br><span class="line">|   1 | test1  |   1 |   1 | test2  |   2 |</span><br><span class="line">|   2 | test2  |   2 |   1 | test2  |   2 |</span><br><span class="line">|   3 | test3  |   3 |   1 | test2  |   2 |</span><br><span class="line">|   1 | test1  |   1 |   2 | test3  |   3 |</span><br><span class="line">|   2 | test2  |   2 |   2 | test3  |   3 |</span><br><span class="line">|   3 | test3  |   3 |   2 | test3  |   3 |</span><br><span class="line">|   1 | test1  |   1 |   4 | test4  |   4 |</span><br><span class="line">|   2 | test2  |   2 |   4 | test4  |   4 |</span><br><span class="line">|   3 | test3  |   3 |   4 | test4  |   4 |</span><br><span class="line">+-----+--------+-----+-----+--------+-----+</span><br></pre></td></tr></table></figure><p>æœ‰ONå’ŒWHEREç­›é€‰æ¡ä»¶ï¼Œæ­¤æ—¶å¾—åˆ°çš„ç»“æœæ˜¯<strong>ä¸¤å¼ è¡¨çš„äº¤é›†</strong>ï¼ˆä¸­é—´çš„å›¾ï¼‰ï¼Œå¯¹äºå†…è¿æ¥ï¼ŒONå’ŒWHEREæ˜¯ç­‰ä»·çš„ï¼Œä½†æ˜¯å¯¹äºå¤–è¿æ¥åˆ™ä¸æ˜¯ï¼Œåœ¨ä¸‹é¢ä¼šè®²åˆ°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># è¿™ä¸¤æ¡SQLæ˜¯ç­‰ä»·çš„ï¼Œä¸è¿‡å»ºè®®ä½¿ç”¨ONå…³é”®å­—ï¼Œçº¦å®šä¿—æˆ</span><br><span class="line">SELECT * FROM table_a a INNER JOIN table_b b ON a.a_name=b.b_name;</span><br><span class="line">SELECT * FROM table_a a INNER JOIN table_b b WHERE a.a_name=b.b_name;</span><br><span class="line"></span><br><span class="line"># ç»“æœå¦‚ä¸‹ï¼š</span><br><span class="line">mysql&gt; SELECT * FROM table_a a INNER JOIN table_b b ON a.a_name=b.b_name;</span><br><span class="line">+-----+--------+-----+-----+--------+-----+</span><br><span class="line">| aid | a_name | age | bid | b_name | age |</span><br><span class="line">+-----+--------+-----+-----+--------+-----+</span><br><span class="line">|   2 | test2  |   2 |   1 | test2  |   2 |</span><br><span class="line">|   3 | test3  |   3 |   2 | test3  |   3 |</span><br><span class="line">+-----+--------+-----+-----+--------+-----+</span><br><span class="line"></span><br></pre></td></tr></table></figure><h6 id="å³è¿æ¥-right-join">å³è¿æ¥(right join)</h6><p>å³è¿æ¥çš„å…³é”®å­—æ˜¯Â <code>RIGHT JOIN</code>ï¼Œä»ä¸Šå›¾å¯ä»¥å¾—åˆ°ï¼ˆå³è¾¹çš„å›¾ï¼‰ï¼Œå³è¿æ¥å…¶å®å°±æ˜¯<strong>ä¸¤ä¸ªè¡¨çš„äº¤é›†+å³è¡¨å‰©ä¸‹çš„æ•°æ®</strong>Â ï¼Œå½“ç„¶è¿™æ˜¯åœ¨æ²¡å…¶ä»–è¿‡æ»¤æ¡ä»¶çš„æƒ…å†µä¸‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM `table_a` a RIGHT JOIN `table_b` b ON a.a_name=b.b_name;</span><br><span class="line">+------+--------+------+-----+--------+-----+</span><br><span class="line">| aid  | a_name | age  | bid | b_name | age |</span><br><span class="line">+------+--------+------+-----+--------+-----+</span><br><span class="line">|    2 | test2  |    2 |   1 | test2  |   2 |</span><br><span class="line">|    3 | test3  |    3 |   2 | test3  |   3 |</span><br><span class="line">| NULL | NULL   | NULL |   4 | test4  |   4 |</span><br><span class="line">+------+--------+------+-----+--------+-----+</span><br></pre></td></tr></table></figure><h6 id="å·¦è¿æ¥-left-join">å·¦è¿æ¥(left join)</h6><p>å·¦è¿æ¥çš„å…³é”®å­—æ˜¯ <code>LEFT JOIN</code>ï¼Œä»ä¸Šå›¾å¯ä»¥å¾—åˆ°ï¼ˆå·¦è¾¹çš„å›¾ï¼‰ï¼Œå·¦è¿æ¥å…¶å®å°±æ˜¯<strong>ä¸¤ä¸ªè¡¨çš„äº¤é›†+å·¦è¡¨å‰©ä¸‹çš„æ•°æ®</strong> ï¼Œå½“ç„¶è¿™æ˜¯åœ¨æ²¡å…¶ä»–è¿‡æ»¤æ¡ä»¶çš„æƒ…å†µä¸‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># æ²¡æ‰¾åˆ°çš„è¢«ç½®ä¸ºNULL</span><br><span class="line">mysql&gt; SELECT * FROM `table_a` a LEFT JOIN `table_b` b ON a.a_name=b.b_name;</span><br><span class="line">+-----+--------+-----+------+--------+------+</span><br><span class="line">| aid | a_name | age | bid  | b_name | age  |</span><br><span class="line">+-----+--------+-----+------+--------+------+</span><br><span class="line">|   2 | test2  |   2 |    1 | test2  |    2 |</span><br><span class="line">|   3 | test3  |   3 |    2 | test3  |    3 |</span><br><span class="line">|   1 | test1  |   1 | NULL | NULL   | NULL |</span><br><span class="line">+-----+--------+-----+------+--------+------+</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p><strong>WHEREå­å¥ä¸­çš„è¿‡æ»¤æ¡ä»¶å°±æ˜¯æˆ‘ä»¬å¸¸è§çš„é‚£ç§ï¼Œä¸ç®¡æ˜¯å†…è¿æ¥è¿˜æ˜¯å¤–è¿æ¥ï¼Œåªè¦ä¸ç¬¦åˆWHEREå­å¥çš„è¿‡æ»¤æ¡ä»¶ï¼Œéƒ½ä¼šè¢«è¿‡æ»¤æ‰ã€‚</strong></p><p><strong>è€ŒONå­å¥ä¸­çš„è¿‡æ»¤æ¡ä»¶å¯¹äºå†…è¿æ¥å’Œå¤–è¿æ¥æ˜¯ä¸åŒçš„ï¼Œå¯¹äºå†…è¿æ¥ï¼ŒONå’ŒWHEREçš„ä½œç”¨æ˜¯ä¸€è‡´çš„ï¼Œå› ä¸ºåŒ¹é…ä¸åˆ°çš„éƒ½ä¼šè¿‡æ»¤ï¼Œæ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°å†…è¿æ¥å¹¶ä¸å¼ºåˆ¶éœ€è¦ ON å…³é”®å­—ï¼›ä½†æ˜¯å¯¹äºå¤–è¿æ¥ï¼ŒONå†³å®šåŒ¹é…ä¸åˆ°çš„æ˜¯å¦è¦è¿‡æ»¤ï¼Œæ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°å¤–è¿æ¥æ˜¯å¼ºåˆ¶éœ€è¦ ON å…³é”®å­—çš„ã€‚</strong></p></blockquote><p>æˆ‘è¦æŸ¥è¯¢å“ªäº›æ•°æ® select â€¦</p><p>ä»é‚£å‡ ä¸ªè¡¨ä¸­æŸ¥fromè¡¨  XXXjoin è¿æ¥çš„è¡¨ onäº¤å‰æ¡ä»¶</p><p>å‡è®¾å­˜åœ¨ä¸€ç§å¤šå¼ è¡¨æŸ¥è¯¢ï¼Œæ…¢æ…¢æ¥ï¼Œå…ˆæŸ¥è¯¢ä¸¤å¼ è¡¨  ç„¶ååœ¨æ…¢æ…¢æ·»åŠ ã€‚</p><h5 id="è‡ªè¿æ¥-äº†è§£">è‡ªè¿æ¥(äº†è§£)</h5><p>è‡ªå·±çš„è¡¨å’Œè‡ªå·±çš„è¡¨è¿æ¥ï¼š <strong>æ ¸å¿ƒæ˜¯ä¸€å¼ è¡¨æ‹†ä¸ºä¸¤å¼ è¡¨ä½¿ç”¨</strong></p><p>å°†æ•°æ®åŒä¸€å¼ è¡¨ä¸­æ•°æ®è¿›è¡ŒæŸ¥åˆ†ï¼Œç„¶åèµ·åˆ«åã€‚å°†ä¸€å¼ è¡¨å˜æˆä¸¤å¼ è¡¨å¤„ç†ã€‚</p><p>åˆ†ä¸ºçˆ¶å’Œå­ï¼Œä¹Ÿå°±æ˜¯æ‹†åˆ†çš„è¡¨å¯ä»¥æˆä¸ºçˆ¶å’Œå­å…³ç³»æˆ–è€…è¯´<strong>åŒ…å«</strong>å’Œ<strong>è¢«åŒ…å«</strong>å…³ç³»ã€‚</p><h5 id="åˆ†é¡µå’Œæ’åº">åˆ†é¡µå’Œæ’åº</h5><p><strong>limit  å’Œ order by</strong></p><h6 id="limitï¼ˆåˆ†é¡µï¼‰">limitï¼ˆåˆ†é¡µï¼‰</h6><p>â€‹limit  å½“å‰é¡µï¼Œé¡µé¢å¤§å°</p><p>â€‹<code>limit  0 , 5</code>       --å‰è¾¹æ•°å­—è¡¨ç¤ºç¬¬å‡ é¡µï¼Œåè¾¹æ•°æ®æ¯é¡µæ˜¾ç¤ºçš„æ•°æ®æ¡æ•°</p><h6 id="order-by-ï¼ˆæ’åºï¼‰">order by ï¼ˆæ’åºï¼‰</h6><ul><li><p>å‡åºasc</p><p><code>order by id  asc</code> æ ¹æ®idå‡åºæ’åº</p></li><li><p>é™åº        desc</p><p><code>order by  id  desc</code>æ ¹æ®idé™åºæ’åº</p></li></ul><h5 id="å­æŸ¥è¯¢å’ŒåµŒå¥—æŸ¥è¯¢">å­æŸ¥è¯¢å’ŒåµŒå¥—æŸ¥è¯¢</h5><p><strong>å‡ºç°åœ¨å…¶ä»–è¯­å¥ä¸­çš„selectè¯­å¥è¢«ç§°ä¸ºå­æŸ¥è¯¢</strong></p><p>:top:<strong>æŸ¥è¯¢é¡ºåºæ˜¯ç”±é‡ŒåŠå¤–ã€‚</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">-- æŸ¥è¯¢ æ•°æ®åº“ç»“æ„çš„æ‰€æœ‰è€ƒè¯•ç»“æœ(å­¦å·ï¼Œç§‘ç›®ç¼–å·ï¼Œæˆç»©)ï¼Œé™åºæ’åˆ—</span><br><span class="line">-- æ–¹å¼1  id æ˜¯stu è¡¨ å­¦ç”Ÿç¼–å·ï¼Œsid æ˜¯ score è¡¨ï¼Œæˆç»©ç¼–å·</span><br><span class="line">select id , s.sid, score</span><br><span class="line">from score s,</span><br><span class="line">inner join sub  u</span><br><span class="line">on s.id = u.id</span><br><span class="line">where sname = &#x27;æ•°æ®ç»“æ„&#x27;</span><br><span class="line">order by score desc</span><br><span class="line"></span><br><span class="line">-- æ–¹å¼2 ä½¿ç”¨å­æŸ¥è¯¢</span><br><span class="line">select id , sid ,score</span><br><span class="line">from score </span><br><span class="line">where sid = (</span><br><span class="line">    -- ä½œä¸ºå­æŸ¥è¯¢ å…ˆæŸ¥è¯¢é‡Œè¾¹çš„ç„¶ååœ¨æŸ¥è¯¢å¤–è¾¹çš„</span><br><span class="line">select sid </span><br><span class="line">    from score </span><br><span class="line">    where sname = &#x27;æ•°æ®ç»“æ„&#x27;</span><br><span class="line">)</span><br><span class="line">order by score desc;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“ç»“æ„ çš„å­¦ç”Ÿå­¦å·</span><br><span class="line">select id from score where sname = &#x27;æ•°æ®ç»“æ„&#x27;ï¼› </span><br><span class="line"></span><br><span class="line">-- æŸ¥è¯¢åˆ†æ•°ä¸å°äº80åˆ†çš„å­¦å·å’Œå§“å</span><br><span class="line">select distinct id , name </span><br><span class="line">from stu t</span><br><span class="line">inner join score s</span><br><span class="line">on s.id = t.id</span><br><span class="line">where score &gt; 80;</span><br><span class="line"></span><br><span class="line">-- åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ ä¸€ä¸ªç§‘ç›®ï¼Œé«˜ç­‰æ•°å­¦</span><br><span class="line">select distinct id , name </span><br><span class="line">from stu t</span><br><span class="line">inner join score s</span><br><span class="line">on s.id = t.id</span><br><span class="line">where score &gt; 80 and sid = (</span><br><span class="line">select sid  from score </span><br><span class="line">    where sname = &#x27;é«˜ç­‰æ•°å­¦&#x27;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>æŒ‰ä½ç½®åˆ†ç±»ï¼š</p><blockquote><p>selectåé¢<br>fromåé¢<br>whereæˆ–havingåé¢<br>existsåé¢<br>æŒ‰ç»“æœçº§çš„è¡Œæ•°ä¸åŒåˆ†ç±»ï¼š</p></blockquote><ul><li>æ ‡é‡å­æŸ¥è¯¢ (ç»“æœé›†æœ‰ä¸€è¡Œä¸€åˆ—)</li><li>åˆ—å­æŸ¥è¯¢ (ç»“æœé›†åªæœ‰ä¸€åˆ—å¤šè¡Œ)</li><li>è¡Œå­æŸ¥è¯¢ (ç»“æœé›†åªæœ‰ä¸€è¡Œå¤šåˆ—)</li><li>è¡¨å­æŸ¥è¯¢ (ç»“æœé›†ä¸€èˆ¬ä¸ºå¤šè¡Œå¤šåˆ—)</li></ul><p><strong>whereæˆ–havingåé¢é•¿æ”¾çš„</strong></p><ul><li>æ ‡é‡å­æŸ¥è¯¢</li><li>åˆ—å­æŸ¥è¯¢</li><li>è¡Œå­æŸ¥è¯¢</li></ul><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ul><li><p>å­æŸ¥è¯¢éƒ½æ”¾åœ¨å°æ‹¬å·å†…ï¼Œç»“å°¾ä¸ç”¨åŠ  ;</p></li><li><p>å­æŸ¥è¯¢å¯ä»¥æ”¾åœ¨fromåé¢ã€selectåé¢ã€whereåé¢ã€havingåé¢ï¼Œä½†ä¸€èˆ¬æ”¾åœ¨æ¡ä»¶çš„å³ä¾§</p></li><li><p>å­æŸ¥è¯¢ä¼˜å…ˆäºä¸»æŸ¥è¯¢æ‰§è¡Œï¼Œä¸»æŸ¥è¯¢ä½¿ç”¨äº†å­æŸ¥è¯¢çš„æ‰§è¡Œç»“æœ</p></li><li><p>å­æŸ¥è¯¢æ ¹æ®æŸ¥è¯¢ç»“æœçš„è¡Œæ•°ä¸åŒåˆ†ä¸ºä»¥ä¸‹ä¸¤ç±»ï¼šå•è¡Œå­æŸ¥è¯¢å’Œå¤šè¡Œå­æŸ¥è¯¢</p></li></ul><blockquote><p><strong>å•è¡Œå­æŸ¥è¯¢</strong><br>ç»“æœé›†åªæœ‰ä¸€è¡Œ<br>ä¸€èˆ¬æ­é…å•è¡Œæ“ä½œç¬¦ä½¿ç”¨ï¼š&gt; &lt; = &lt;&gt; &gt;= &lt;=<br>éæ³•ä½¿ç”¨å­æŸ¥è¯¢çš„æƒ…å†µï¼š</p><p>å­æŸ¥è¯¢çš„ç»“æœä¸ºä¸€ç»„å€¼<br>å­æŸ¥è¯¢çš„ç»“æœä¸ºç©º</p></blockquote><blockquote><p><strong>å¤šè¡Œå­æŸ¥è¯¢</strong><br>ç»“æœé›†æœ‰å¤šè¡Œ<br>ä¸€èˆ¬æ­é…å¤šè¡Œæ“ä½œç¬¦ä½¿ç”¨ï¼šanyã€allã€inã€not in<br>inï¼šå±äºå­æŸ¥è¯¢ç»“æœä¸­çš„ä»»æ„ä¸€ä¸ªå°±è¡Œ<br>anyå’Œall:å¾€å¾€å¯ä»¥ç”¨å…¶ä»–æŸ¥è¯¢ä»£æ›¿</p></blockquote><h5 id="MySQLå¸¸ç”¨å‡½æ•°">MySQLå¸¸ç”¨å‡½æ•°</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-- æ•°å­¦è¿ç®—</span><br><span class="line">SELECT ABS(-10);-- ç»å¯¹å€¼</span><br><span class="line">SELECT CEIL(10.1);-- ceilå’Œceiling å‘ä¸Šå–æ•´</span><br><span class="line">SELECT FLOOR(10.1);-- å‘ä¸‹å–æ•´</span><br><span class="line">SELECT RAND();-- è¿”å›0-1éšæœºæ•°</span><br><span class="line">SELECT SIGN(NULL);-- è¿”å›å‚æ•°çš„ç¬¦å· è´Ÿæ•°è¿”å›-1 æ­£æ•°è¿”å›1 </span><br><span class="line">-- 0å’Œéæ•°å­—è¿”å›0 nullè¿”å›null</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-- å­—ç¬¦ä¸²å‡½æ•°</span><br><span class="line">SELECT CHAR_LENGTH(&#x27;fwebw&#x27;);-- è¿”å›å­—ç¬¦ä¸²é•¿åº¦</span><br><span class="line">SELECT CONCAT(&#x27;1&#x27;,&#x27;2&#x27;,&#x27;3&#x27;);-- æ‹¼æ¥å­—ç¬¦ä¸²</span><br><span class="line">SELECT INSERT(&#x27;123456&#x27;,1,3,&#x27;0&#x27;);-- å…ˆæŠŠç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²çš„ç¬¬1ä½èµ·çš„0ä¸ªå­—ç¬¦å»é™¤</span><br><span class="line">-- ç„¶åå†æŠŠç¬¬äºŒä¸ªå­—ç¬¦ä¸²æ’å…¥åˆ°å¯¹åº”ä½ç½®</span><br><span class="line">SELECT LOWER(&#x27;JIOji&#x27;);-- è½¬å°å†™å­—æ¯</span><br><span class="line">SELECT UPPER(&#x27;wfdINOI&#x27;);-- è½¬å¤§å†™å­—æ¯ </span><br><span class="line">SELECT INSTR(&#x27;asdasd&#x27;,&#x27;sd&#x27;);-- è¿”å›ç¬¬ä¸€ä¸ªå­—ä¸²å‡ºç°çš„ä½ç½®</span><br><span class="line">SELECT REPLACE(&#x27;123456789123&#x27;,&#x27;123&#x27;,&#x27;hhh&#x27;);-- æŠŠs1ä¸­s2éƒ¨åˆ†æ›¿æ¢ä¸ºs3ï¼ˆæ‰€æœ‰s2ï¼‰</span><br><span class="line">SELECT SUBSTR(&#x27;123456789&#x27;,2,4);-- æˆªå–å­—ç¬¦ä¸²ï¼Œä»ç¬¬2ä¸ªå­—ç¬¦å¼€å§‹æˆªå–4ä¸ªå­—ç¬¦</span><br><span class="line">SELECT REVERSE(&#x27;123465&#x27;);-- ç¿»è½¬å­—ç¬¦ä¸²</span><br><span class="line"></span><br><span class="line">-- æŸ¥è¯¢å§“å‘¨çš„åŒå­¦å¹¶æŠŠå§“æ¢ä¸ºé‚¹</span><br><span class="line">SELECT REPLACE(studentName,&#x27;å‘¨&#x27;,&#x27;é‚¹&#x27;) FROM students</span><br><span class="line">WHERE studentName LIKE &#x27;å‘¨%&#x27;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-- æ—¶é—´å’Œæ—¥æœŸå‡½æ•°</span><br><span class="line">SELECT CURRENT_DATE();-- è·å–å½“å‰æ—¥æœŸ</span><br><span class="line">SELECT CURDATE()-- è·å–å½“å‰æ—¥æœŸ</span><br><span class="line">SELECT CURRENT_TIME();-- è·å–å½“å‰æ—¶é—´ï¼ˆæ—¶åˆ†ç§’ï¼‰</span><br><span class="line">SELECT SYSDATE();-- è·å–ç³»ç»Ÿæ—¶é—´</span><br><span class="line">SELECT NOW();-- è·å–æ—¶é—´</span><br><span class="line">SELECT YEAR(NOW());-- è·å–å½“å‰å¹´</span><br><span class="line">SELECT MONTH(NOW());-- è·å–å½“å‰æœˆ</span><br><span class="line">-- Â·Â·Â·Â·Â·Â·è·å–æ—¥æ—¶åˆ†ç§’åŒç†</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- ç³»ç»Ÿ</span><br><span class="line">SELECT SYSTEM_USER();</span><br><span class="line">SELECT USER();-- è·å–å½“å‰ç”¨æˆ·</span><br><span class="line">SELECT VERSION(); -- è·å–å½“å‰ç‰ˆæœ¬ä¿¡æ¯</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‡½æ•°å­—æ®µ</th><th></th><th>æè¿°</th></tr></thead><tbody><tr><td>abs()</td><td></td><td>ç»å¯¹å€¼</td></tr><tr><td>ceiling()</td><td></td><td>å‘ä¸Šå–æ•´</td></tr><tr><td>floor()</td><td></td><td>å‘ä¸‹å–æ•´</td></tr><tr><td>rand()</td><td></td><td>è¿”å›ä¸€ä¸ª0-1ç›´æ¥çš„éšæœºæ•°</td></tr><tr><td>sign()</td><td></td><td>åˆ¤æ–­ä¸€ä¸ªæ•°çš„ç¬¦å·  è´Ÿæ•°èŒƒå›´-1ï¼Œæ­£æ•°è¿”å›1</td></tr><tr><td>char_length()</td><td></td><td>åˆ¤æ–­å­—ç¬¦ä¸²é•¿åº¦</td></tr><tr><td>concat(â€˜â€™,â€˜â€™,â€˜â€™)</td><td></td><td>æ‹¼æ¥å­—ç¬¦ä¸²</td></tr><tr><td>insert(â€˜æŸ¥è¯¢å¹¶è¢«æ›¿æ¢çš„â€™,1ï¼Œ3,â€˜è¦æ›¿æ¢çš„â€™)</td><td></td><td>æŸ¥è¯¢æ›¿æ¢ä»1ï¼Œåˆ°3å·ä½ç½®æ›¿æ¢</td></tr><tr><td>lower()</td><td></td><td>å°†å­—ç¬¦ä¸²ä¸“ä¸ºå°å†™</td></tr><tr><td>upper()</td><td></td><td>å°†å°å†™è½¬ä¸ºå¤§å†™</td></tr><tr><td>instr()</td><td></td><td>è¿”å›ç¬¬ä¸€æ¬¡å‡ºç°çš„å­—ç¬¦ä¸²ç´¢å¼•</td></tr><tr><td>replace()</td><td></td><td>æ›¿æ¢å‡ºç°çš„æŒ‡å®šå­—ç¬¦ä¸²</td></tr><tr><td>substr()</td><td></td><td>æˆªå–å­—ç¬¦ä¸²</td></tr><tr><td>reverse()</td><td></td><td>åè½¬</td></tr><tr><td>â€¦</td><td></td><td>â€¦</td></tr></tbody></table><h5 id="èšåˆå‡½æ•°å’Œåˆ†ç»„è¿‡æ»¤ï¼ˆhaving-by-ï¼‰">èšåˆå‡½æ•°å’Œåˆ†ç»„è¿‡æ»¤ï¼ˆhaving by ï¼‰</h5><table><thead><tr><th>èšåˆå‡½æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>count()</td><td>ç»Ÿè®¡</td></tr><tr><td>sum()</td><td>æ±‚å’Œ</td></tr><tr><td>avg()</td><td>å¹³å‡å€¼</td></tr><tr><td>max()</td><td>æœ€å¤§å€¼</td></tr><tr><td>min()</td><td>æœ€å°å€¼</td></tr></tbody></table><p>havingçš„ç”¨æ³•</p><p><strong>havingå­—å¥å¯ä»¥è®©æˆ‘ä»¬ç­›é€‰æˆç»„åçš„å„ç§æ•°æ®ï¼Œwhereå­—å¥åœ¨èšåˆå‰å…ˆç­›é€‰è®°å½•ï¼Œä¹Ÿå°±æ˜¯è¯´ä½œç”¨åœ¨group byå’Œhavingå­—å¥å‰ã€‚è€Œ havingå­å¥åœ¨èšåˆåå¯¹ç»„è®°å½•è¿›è¡Œç­›é€‰ã€‚</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-- æŸ¥è¯¢ä¸åŒç§‘ç›®çš„å¹³å‡åˆ†æœ€é«˜åˆ†å’Œæœ€ä½åˆ† å¹³å‡åˆ†å¤§äº80</span><br><span class="line">-- ç”±äºæŒ‰ç…§é¡ºåºæ‰§è¡Œï¼Œæ‰€ä»¥whereä¸èƒ½é™å®šåˆ†ç»„åè®¡ç®—å‡ºçš„å¹³å‡å€¼ç­‰ä¿¡æ¯</span><br><span class="line">-- å¯ä»¥ä½¿ç”¨having</span><br><span class="line">SELECT sname,AVG(score),MAX(score),MIN(score)</span><br><span class="line">FROM score s</span><br><span class="line">INNER JOIN `sub` sub</span><br><span class="line">ON s.id=sub.id</span><br><span class="line">GROUP BY s.id</span><br><span class="line">HAVING AVG(score)&gt;=80;</span><br></pre></td></tr></table></figure><h3 id="äº‹åŠ¡ï¼ˆtransactionï¼‰">äº‹åŠ¡ï¼ˆtransactionï¼‰</h3><p>äº‹åŠ¡ç‰¹æ€§ï¼šACIDï¼ˆåŸå­æ€§ï¼Œä¸€è‡´æ€§ï¼Œéš”ç¦»æ€§ï¼ŒæŒä¹…æ€§ï¼‰</p><ul><li><p>A:åŸå­æ€§</p><ul><li>è¦ä¹ˆæˆåŠŸè¦ä¹ˆä¸æˆåŠŸ</li></ul></li><li><p>C:ä¸€è‡´æ€§</p><ul><li>æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¿è¯æœ€ç»ˆç»“æœä¸€è‡´</li></ul></li><li><p>I:éš”ç¦»æ€§</p><ul><li>ä¸€ä¸ªäº‹åŠ¡çš„æäº¤ä¸ä¼šå½±å“ä¸‹ä¸€ä¸ªäº‹åŠ¡ã€‚</li><li>éš”ç¦»äº§ç”Ÿçš„é—®é¢˜<ul><li>è„è¯»ï¼š ä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ®ã€‚</li><li>ä¸å¯é‡å¤è¯»ï¼šåœ¨ä¸€ä¸ªäº‹åŠ¡å†…è¯»å–è¡¨ä¸­çš„æŸä¸€è¡Œæ•°æ®ï¼Œå¤šæ¬¡è¯»å–ç»“æœä¸åŒã€‚</li><li>å¹»è¯»ï¼šæŒ‡åœ¨ä¸€ä¸ªäº‹åŠ¡å†…è¯»å–åˆ°åˆ«çš„äº‹åŠ¡æ’å…¥çš„æ•°æ®ï¼Œå¯¼è‡´å‰åè¯»å–ä¸ä¸€è‡´ã€‚</li></ul></li></ul></li><li><p>D:æŒä¹…æ€§</p><ul><li>è¡¨ç¤ºäº‹åŠ¡ç»“æŸåçš„æ•°ä¸ä¼šéšç€å¤–ç•ŒåŸå› å¯¼è‡´æ•°æ®ä¸¢å¤±</li><li>ä¹Ÿå°±æ˜¯è¯´ï¼Œäº‹åŠ¡æ²¡æœ‰æäº¤ï¼Œé‚£ä¹ˆå°±æ¢å¤åˆ°åŸæ¥çš„æœªæäº¤çŠ¶æ€ï¼Œå¦‚æœæäº¤ï¼Œé‚£ä¹ˆå°±æ›´æ–°ä¸ºæäº¤åçš„çŠ¶æ€ï¼ŒæŒä¹…åŒ–åˆ°æ•°æ®ï¼Œäº‹åŠ¡ä¸€æ—¦æäº¤å°±ä¸å¯é€†ã€‚</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- æ‰‹åŠ¨å¼€å¯äº‹åŠ¡</span><br><span class="line">start transaction -- æ ‡è®°ä¸€ä¸ªäº‹åŠ¡çš„å¼€å§‹ï¼Œä»è¿™ä¸ªä¹‹åçš„sqléƒ½åœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…</span><br><span class="line"></span><br><span class="line">insert xxx</span><br><span class="line">insert xxx</span><br><span class="line"></span><br><span class="line">-- æäº¤ æŒä¹…åŒ–</span><br><span class="line">commit ;</span><br><span class="line">-- å¦‚æœæäº¤å¤±è´¥å°±å›æ»šåˆ°åŸæ¥çš„æ ·å­</span><br><span class="line">rollback;</span><br><span class="line"></span><br><span class="line">-- äº‹åŠ¡ç»“æŸ</span><br><span class="line">set autocommit = 1 ï¼›-- å¼€å¯è‡ªåŠ¨æäº¤</span><br><span class="line"></span><br><span class="line">savepoint ä¿å­˜ç‚¹å -- è®¾ç½®ä¸€ä¸ªäº‹åŠ¡çš„ä¿æŒç‚¹</span><br><span class="line">rollback to savepoint ä¿å­˜ç‚¹å  -- å›æ»šåˆ°ä¿å­˜ç‚¹</span><br><span class="line">release  savepoint ä¿å­˜ç‚¹å -- æ’¤é”€ä¿å­˜ç‚¹</span><br></pre></td></tr></table></figure><p>æ¨¡æ‹Ÿåœºæ™¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">-- è½¬è´¦</span><br><span class="line">create database shop character set utf8 collate utf_8_general_cli;</span><br><span class="line">use shop;</span><br><span class="line">create table account(</span><br><span class="line">id int (3) not null primary key auto_increment,</span><br><span class="line">    name varchar(20) not nullï¼Œ</span><br><span class="line">    money decimal(9,2) not null</span><br><span class="line">) engine = innodb default charset=utf8;</span><br><span class="line"></span><br><span class="line">-- æ’å…¥æ•°æ®</span><br><span class="line">insert into account(name,money) </span><br><span class="line">value(&#x27;A&#x27;,1024.00),(&#x27;B&#x27;,2048.00)</span><br><span class="line"></span><br><span class="line">-- æ¨¡æ‹Ÿè½¬è´¦ï¼šäº‹åŠ¡</span><br><span class="line">set autocommit = 0; -- å…³é—­è‡ªåŠ¨æäº¤</span><br><span class="line">start transaction ; -- å¼€å¯äº‹åŠ¡</span><br><span class="line">update account set money - 500 where name = &#x27;A&#x27;;</span><br><span class="line">update account set money + 500 where name = &#x27;B&#x27;;</span><br><span class="line"></span><br><span class="line">commit ; -- æäº¤äº‹åŠ¡</span><br><span class="line">rollback ; -- å›æ»š</span><br><span class="line">set autocommit = 1; -- æ¢å¤é»˜è®¤å€¼</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ç´¢å¼•">ç´¢å¼•</h3><p>==<strong>æ˜¯å¸®åŠ©mysqlé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œæå–å¥å­ä¸»å¹²ï¼Œå¯ä»¥å¾—åˆ°ç´¢å¼•çš„æœ¬è´¨ï¼Œç´¢å¼•æ˜¯æ•°æ®ç»“æ„ã€‚</strong>==</p><h4 id="ç´¢å¼•åˆ†ç±»ï¼š"><strong>ç´¢å¼•åˆ†ç±»ï¼š</strong></h4><ol><li><p>ä¸»é”®ç´¢å¼•ï¼šåˆ›å»ºä¸»é”®åä¼šè‡ªåŠ¨å»ºç«‹ç´¢å¼•</p><ol><li><p>å”¯ä¸€æ ‡è¯†ï¼Œä¸»é”®ä¸å¯é‡å¤ï¼Œåªèƒ½æœ‰ä¸€ä¸ªä¸»é”®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#éšè¡¨ä¸€èµ·å»ºç´¢å¼•ï¼š</span><br><span class="line">CREATE TABLE customer (</span><br><span class="line">    id INT(10) UNSIGNED  AUTO_INCREMENT ,</span><br><span class="line">    customer_no VARCHAR(200),</span><br><span class="line">    customer_name VARCHAR(200),</span><br><span class="line">    PRIMARY KEY(id) </span><br><span class="line">);</span><br><span class="line">#ä½¿ç”¨AUTO_INCREMENTå…³é”®å­—çš„åˆ—å¿…é¡»æœ‰ç´¢å¼•(åªè¦æœ‰ç´¢å¼•å°±è¡Œ)ã€‚</span><br><span class="line">CREATE TABLE customer2 (</span><br><span class="line">    id INT(10) UNSIGNED,</span><br><span class="line">    customer_no VARCHAR(200),</span><br><span class="line">    customer_name VARCHAR(200),</span><br><span class="line"> PRIMARY KEY(id) </span><br><span class="line">);</span><br><span class="line">#å•ç‹¬å»ºä¸»é”®ç´¢å¼•ï¼š</span><br><span class="line">ALTER TABLE customer </span><br><span class="line">add PRIMARY KEY </span><br><span class="line">customer(customer_no);  </span><br><span class="line">#åˆ é™¤å»ºä¸»é”®ç´¢å¼•ï¼š</span><br><span class="line">ALTER TABLE customer</span><br><span class="line">drop PRIMARY KEY ;  </span><br><span class="line">#ä¿®æ”¹å»ºä¸»é”®ç´¢å¼•ï¼š</span><br><span class="line">#å¿…é¡»å…ˆåˆ é™¤æ‰(drop)åŸç´¢å¼•ï¼Œå†æ–°å»º(add)ç´¢å¼•</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol></li><li><p>å”¯ä¸€ç´¢å¼•:ç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä½†å…è®¸æœ‰ç©ºå€¼</p><ol><li><p>é¿å…é‡å¤çš„åˆ—å‡ºç°ï¼Œå”¯ä¸€ç´¢å¼•å¯ä»¥é‡å¤ï¼Œå¤šä¸ªåˆ—éƒ½å¯ä»¥æ ‡è¯†ä¸ºï¼Œå”¯ä¸€ç´¢å¼•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#éšè¡¨ä¸€èµ·å»ºç´¢å¼•ï¼š</span><br><span class="line">CREATE TABLE customer (</span><br><span class="line">    id INT(10) UNSIGNED  AUTO_INCREMENT ,</span><br><span class="line">    customer_no VARCHAR(200),</span><br><span class="line">    customer_name VARCHAR(200),</span><br><span class="line">  PRIMARY KEY(id),</span><br><span class="line">  KEY (customer_name),</span><br><span class="line">  UNIQUE (customer_no)</span><br><span class="line">);</span><br><span class="line">#å»ºç«‹ å”¯ä¸€ç´¢å¼•æ—¶å¿…é¡»ä¿è¯æ‰€æœ‰çš„å€¼æ˜¯å”¯ä¸€çš„ï¼ˆé™¤äº†nullï¼‰ï¼Œè‹¥æœ‰é‡å¤æ•°æ®ï¼Œä¼šæŠ¥é”™ã€‚   </span><br><span class="line">#å•ç‹¬å»ºå”¯ä¸€ç´¢å¼•ï¼š</span><br><span class="line">CREATE UNIQUE INDEX </span><br><span class="line">idx_customer_no </span><br><span class="line">ON customer(customer_no); </span><br><span class="line">#åˆ é™¤ç´¢å¼•ï¼š</span><br><span class="line">DROP INDEX idx_customer_no</span><br><span class="line">on customer ;</span><br></pre></td></tr></table></figure></li></ol></li><li><p>å¸¸è§„ç´¢å¼•</p><ol><li><p>é»˜è®¤çš„ï¼Œindexï¼Œkeyå…³é”®å­—æ¥è®¾ç½®</p></li><li><p>å•åˆ—ç´¢å¼•ï¼šä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—ï¼Œä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå•åˆ—ç´¢å¼•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#éšè¡¨ä¸€èµ·å»ºç´¢å¼•ï¼š</span><br><span class="line">CREATE TABLE customer (</span><br><span class="line">    id INT(10) UNSIGNED  AUTO_INCREMENT ,</span><br><span class="line">    customer_no VARCHAR(200),</span><br><span class="line">    customer_name VARCHAR(200),</span><br><span class="line">  PRIMARY KEY(id),</span><br><span class="line">  KEY (customer_name)  </span><br><span class="line">);</span><br><span class="line">#éšè¡¨ä¸€èµ·å»ºç«‹çš„ç´¢å¼• ç´¢å¼•ååŒ åˆ—å(customer_name)</span><br><span class="line">#å•ç‹¬å»ºå•å€¼ç´¢å¼•ï¼š</span><br><span class="line">CREATE INDEX idx_customer_name </span><br><span class="line">ON customer(customer_name); </span><br><span class="line">#åˆ é™¤ç´¢å¼•ï¼š</span><br><span class="line">DROP INDEX idx_customer_name ;</span><br></pre></td></tr></table></figure></li><li><p>å¤åˆç´¢å¼•ï¼šä¸€ä¸ªç´¢å¼•åŒ…å«å¤šä¸ªåˆ—ï¼Œåœ¨æ•°æ®åº“æ“ä½œæœŸé—´ï¼Œå¤åˆç´¢å¼•æ¯”å•å€¼ç´¢å¼•æ‰€éœ€è¦çš„å¼€é”€æ›´å°ï¼ˆå¯¹äºç›¸åŒçš„å¤šä¸ªåˆ—å»ºç´¢å¼•ï¼‰</p></li></ol><pre><code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#éšè¡¨ä¸€èµ·å»ºç´¢å¼•ï¼š</span><br><span class="line">CREATE TABLE customer (</span><br><span class="line">    id INT(10) UNSIGNED  AUTO_INCREMENT ,</span><br><span class="line">    customer_no VARCHAR(200),</span><br><span class="line">    customer_name VARCHAR(200),</span><br><span class="line">  PRIMARY KEY(id),</span><br><span class="line">  KEY (customer_name),</span><br><span class="line">  UNIQUE (customer_name),</span><br><span class="line">  KEY (customer_no,customer_name)</span><br><span class="line">);</span><br><span class="line">#å•ç‹¬å»ºç´¢å¼•ï¼š</span><br><span class="line">CREATE INDEX idx_no_name</span><br><span class="line">ON customer(customer_no,customer_name); </span><br><span class="line">#åˆ é™¤ç´¢å¼•ï¼š</span><br><span class="line">DROP INDEX idx_no_name  on customer ;</span><br></pre></td></tr></table></figure></code></pre></li><li><p>å…¨æ–‡ç´¢å¼•</p><ol><li><p>åœ¨ç‰¹å®šçš„æ•°æ®åº“å¼•æ“ä¸‹æ‰æœ‰çš„ï¼ŒmyIsam</p></li><li><p>å¿«é€Ÿå®šä½æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- ç´¢å¼•çš„ä½¿ç”¨</span><br><span class="line">-- åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ç»™å­—æ®µå¢åŠ ç´¢å¼•</span><br><span class="line">-- åˆ›å»ºå®Œæ¯•åï¼Œå¢åŠ ç´¢å¼•</span><br><span class="line"></span><br><span class="line">-- æ˜¾ç¤ºæ‰€æœ‰çš„ç´¢å¼•ä¿¡æ¯</span><br><span class="line">show index from student;</span><br><span class="line"></span><br><span class="line">-- å¢åŠ ä¸€ä¸ªå…¨æ–‡ç´¢å¼•ï¼ˆç´¢å¼•åï¼‰ åˆ—å</span><br><span class="line">alter table school.student</span><br><span class="line">add fulltext </span><br><span class="line">index studentName(studentName);</span><br><span class="line"></span><br><span class="line">-- explain åˆ†æmysqlæ‰§è¡Œçš„çŠ¶å†µ</span><br><span class="line">explain select * from student ; -- éå…¨æ–‡ç´¢å¼•</span><br><span class="line"></span><br><span class="line">select * from student</span><br><span class="line">where match(studentName) against(&#x27;åˆ˜&#x27;)ï¼›</span><br></pre></td></tr></table></figure></li><li><p>èšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•</p><ol><li>èšé›†ç´¢å¼•ï¼šæŒ‡ç´¢å¼•é¡¹çš„æ’åºæ–¹å¼å’Œè¡¨ä¸­æ•°æ®è®°å½•æ’åºæ–¹å¼ä¸€è‡´çš„ç´¢å¼•ã€‚</li><li>éèšé›†ç´¢å¼•ï¼šä¸èšé›†ç´¢å¼•ç›¸åï¼Œç´¢å¼•é¡ºåºä¸ç‰©ç†å­˜å‚¨é¡ºåºä¸ä¸€è‡´</li></ol></li></ol></li></ol><h4 id="ç´¢å¼•æµ‹è¯•">ç´¢å¼•æµ‹è¯•</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">-- æˆ‘ä»¬åœ¨åˆ›å»ºç´¢å¼•çš„æ—¶å€™ä¸€èˆ¬ä½¿ç”¨  primary  key (åˆ—å)äº‹å®ä¸Šè¿™å°±æ˜¯è®¾ç½®ä¸»é”®ï¼Œä½†æ˜¯è¿™ä¸ªä¹Ÿå°±æ˜¯åˆ›å»ºäº†å”¯ä¸€ç´¢å¼•</span><br><span class="line">create table if not exists yyl(</span><br><span class="line">id int(10) not null primary key auto_increment comment &#x27;ä¸»é”®&#x27;,</span><br><span class="line">    name varchar(20) default null comment  &#x27;å§“å&#x27;,</span><br><span class="line">    pwd varchar(50) not null default &#x27;123321&#x27; comment &#x27;å¯†ç &#x27;,</span><br><span class="line">    age int (10) not null default &#x27;0&#x27; comment &#x27;å¹´é¾„&#x27;</span><br><span class="line">)engine = innodb default charset = utf8;</span><br><span class="line"></span><br><span class="line">-- æ’å…¥100ä¸‡æ•°æ®</span><br><span class="line">delimiter $$ -- å†™æ•°æ®ä¹‹å‰å¿…é¡»è¦å†™ï¼Œæ ‡å¿—</span><br><span class="line">create function mock_data()</span><br><span class="line">returns int</span><br><span class="line">begin</span><br><span class="line">declare num int default 1000000;</span><br><span class="line">declare i int default 0;</span><br><span class="line">while i &lt; num do</span><br><span class="line">-- æ’å…¥è¯­å¥</span><br><span class="line"></span><br><span class="line">insert into yyl (name,pwd,age) </span><br><span class="line">value(concat(&#x27;ç”¨æˆ·&#x27;,i),UUID(),floor(rand()*100));</span><br><span class="line">set i = i + 1;</span><br><span class="line">end while;</span><br><span class="line">return i;</span><br><span class="line">end;</span><br><span class="line"></span><br><span class="line">-- æ‰§è¡Œä¸€ä¸‹</span><br><span class="line">select mock_data();</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">select mock_data();</span><br><span class="line">å—å½±å“çš„è¡Œ: 0</span><br><span class="line">æ—¶é—´: 42.708ms</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">-- æ’å…¥è¡¨æ•°æ®</span><br><span class="line">insert into yyl (name,pwd,age) </span><br><span class="line">value(concat(&#x27;ç”¨æˆ·&#x27;,i),UUID(),floor(rand()*100));</span><br><span class="line"></span><br><span class="line">-- ç”±äºæ’å…¥äº†1000000æ¡æ•°æ®ï¼Œé‚£ä¹ˆæŸ¥è¯¢ä¸€ä¸ªå€¼</span><br><span class="line">select * from yyl where name = &#x27;ç”¨æˆ·99999&#x27;;</span><br><span class="line">/*</span><br><span class="line">æ²¡åˆ›å»ºç´¢å¼•çš„æ—¶å€™å»æŸ¥è¯¢æ•°æ®</span><br><span class="line">[SQL] select * from yyl where name = &#x27;ç”¨æˆ·99999&#x27;;</span><br><span class="line">å—å½±å“çš„è¡Œ: 0</span><br><span class="line">æ—¶é—´: 0.744ms</span><br><span class="line">æˆ‘ä»¬å‘ç°æ—¶é—´æ¯”è¾ƒé•¿</span><br><span class="line">*/</span><br><span class="line">explain select * from yyl where name = &#x27;ç”¨æˆ·99999&#x27;; -- rows 1000539æ¬¡</span><br><span class="line"></span><br><span class="line">-- åˆ›å»ºç´¢å¼• id_è¡¨å_å­—æ®µå on ç´¢å¼•å on è¡¨ï¼ˆå­—æ®µï¼‰</span><br><span class="line">create index id_yyl_name on yyl(name);</span><br><span class="line"></span><br><span class="line">-- åˆ é™¤ç´¢å¼•</span><br><span class="line">drop index id_yyl_name ;</span><br><span class="line">/*</span><br><span class="line">åˆ›å»ºç´¢å¼•åå†å»æŸ¥è¯¢æ•°æ®éå¸¸å¿«</span><br><span class="line">[SQL] select * from yyl where name = &#x27;ç”¨æˆ·99999&#x27;; </span><br><span class="line">å—å½±å“çš„è¡Œ: 0</span><br><span class="line">æ—¶é—´: 0.009ms</span><br><span class="line">*/</span><br><span class="line">-- æ­¤æ—¶explain   rows =1;</span><br><span class="line">explain select * from yyl where name = &#x27;ç”¨æˆ·99999&#x27;;</span><br></pre></td></tr></table></figure><p>==åˆ›å»ºç´¢å¼•==</p><p>â€‹==create index id _ è¡¨å_ å­—æ®µå on ç´¢å¼•å è¡¨(å­—æ®µ)ï¼›==</p><p>==ç´¢å¼•åœ¨å°æ•°æ®é‡çš„æ—¶å€™ï¼Œç”¨å¤„ä¸å¤§ï¼Œä½†æ˜¯åœ¨å¤§æ•°æ®çš„æ—¶å€™ï¼ŒåŒºåˆ«ååˆ†æ˜æ˜¾ã€‚==</p><h4 id="ç´¢å¼•åŸåˆ™">ç´¢å¼•åŸåˆ™</h4><ul><li>ç´¢å¼•ä¸æ˜¯è¶Šå¤šè¶Šå¥½</li><li>ä¸è¦å¯¹è¿›ç¨‹å˜åŠ¨æ•°æ®åŠ ç´¢å¼•</li><li>å°æ•°æ®é‡çš„è¡¨ä¸éœ€è¦åŠ ç´¢å¼•</li><li>ç´¢å¼•ä¸€èˆ¬åŠ åœ¨å¸¸å¸¸ç”¨æ¥æŸ¥è¯¢çš„å­—æ®µä¸Šï¼</li></ul><p>ç´¢å¼•çš„æ•°æ®ç»“æ„ï¼š</p><ul><li>Hash ç±»å‹çš„ç´¢å¼•</li><li>B+æ ‘ï¼šinnodbçš„é»˜è®¤æ•°æ®ç»“æ„</li></ul><h5 id="è®¨è®ºä¸ºå•¥Innodbè¦ä½¿ç”¨B-æ ‘è€Œä¸ä½¿ç”¨å…¶ä»–æ•°æ®ç»“æ„å‘¢ï¼Ÿ">è®¨è®ºä¸ºå•¥Innodbè¦ä½¿ç”¨B+æ ‘è€Œä¸ä½¿ç”¨å…¶ä»–æ•°æ®ç»“æ„å‘¢ï¼Ÿ</h5><ul><li><p>â€‹B-æ ‘ï¼šï¼ˆä¸æ˜¯äºŒåˆ†æŸ¥æ‰¾ï¼Œå´ç›¸ä¼¼äºäºŒåˆ†æŸ¥æ‰¾ï¼‰</p><ul><li>B-æ ‘æ˜¯ä¸€ç§å¤šè·¯è‡ªå¹³è¡¡çš„æœç´¢æ ‘ï¼Œå®ƒç±»ä¼¼æ™®é€šçš„å¹³è¡¡äºŒå‰æ ‘ï¼Œä¸åŒçš„ä¸€ç‚¹æ˜¯B-æ ‘å…è®¸æ¯ä¸ªèŠ‚ç‚¹æœ‰æ›´å¤šçš„å­èŠ‚ç‚¹ã€‚B-Treeç›¸å¯¹äºAVLTreeç¼©å‡äº†èŠ‚ç‚¹ä¸ªæ•°ï¼Œä½¿æ¯æ¬¡ç£ç›˜I/Oå–åˆ°å†…å­˜çš„æ•°æ®éƒ½å‘æŒ¥äº†ä½œç”¨ï¼Œä»è€Œæé«˜äº†æŸ¥è¯¢æ•ˆç‡ã€‚</li><li>å­˜åœ¨é—®é¢˜ï¼š<ul><li>æ¯ä¸ªèŠ‚ç‚¹ä¸­æœ‰keyï¼Œä¹Ÿæœ‰dataï¼Œè€Œæ¯ä¸€ä¸ªé¡µçš„å­˜å‚¨ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œå¦‚æœdataæ•°æ®è¾ƒå¤§æ—¶å°†ä¼šå¯¼è‡´æ¯ä¸ªèŠ‚ç‚¹ï¼ˆå³ä¸€ä¸ªé¡µï¼‰èƒ½å­˜å‚¨çš„keyçš„æ•°é‡å¾ˆå°ã€‚ å½“å­˜å‚¨çš„æ•°æ®é‡å¾ˆå¤§æ—¶åŒæ ·ä¼šå¯¼è‡´B-Treeçš„æ·±åº¦è¾ƒå¤§ï¼Œå¢å¤§æŸ¥è¯¢æ—¶çš„ç£ç›˜I/Oæ¬¡æ•°ï¼Œè¿›è€Œå½±å“æŸ¥è¯¢æ•ˆç‡</li></ul></li></ul></li><li><p>B+æ ‘ï¼š</p><ul><li>B+Treeæ˜¯åœ¨B-TreeåŸºç¡€ä¸Šçš„ä¸€ç§ä¼˜åŒ–ï¼ŒInnoDBå­˜å‚¨å¼•æ“å°±æ˜¯ç”¨B+Treeå®ç°å…¶ç´¢å¼•ç»“æ„ã€‚</li><li>å®ƒå¸¦æ¥çš„å˜åŒ–ç‚¹ï¼š<ul><li>B+æ ‘æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥åŒ…å«æ›´å¤šçš„èŠ‚ç‚¹ï¼Œè¿™æ ·åšæœ‰ä¸¤ä¸ªåŸå› ï¼Œä¸€ä¸ªæ˜¯é™ä½æ ‘çš„é«˜åº¦ã€‚å¦å¤–ä¸€ä¸ªæ˜¯å°†æ•°æ®èŒƒå›´å˜ä¸ºå¤šä¸ªåŒºé—´ï¼ŒåŒºé—´è¶Šå¤šï¼Œæ•°æ®æ£€ç´¢è¶Šå¿«</li><li>éå¶å­èŠ‚ç‚¹å­˜å‚¨keyï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨keyå’Œæ•°æ®å¶å­èŠ‚ç‚¹ä¸¤ä¸¤æŒ‡é’ˆç›¸äº’é“¾æ¥ï¼ˆç¬¦åˆç£ç›˜çš„é¢„è¯»ç‰¹æ€§ï¼‰ï¼Œé¡ºåºæŸ¥è¯¢æ€§èƒ½æ›´é«˜</li></ul></li><li>é€šå¸¸åœ¨B+Treeä¸Šæœ‰ä¸¤ä¸ªå¤´æŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘æ ¹èŠ‚ç‚¹ï¼Œå¦ä¸€ä¸ªæŒ‡å‘å…³é”®å­—æœ€å°çš„å¶å­èŠ‚ç‚¹ï¼Œè€Œä¸”æ‰€æœ‰å¶å­èŠ‚ç‚¹ï¼ˆå³æ•°æ®èŠ‚ç‚¹ï¼‰ä¹‹é—´æ˜¯ä¸€ç§é“¾å¼ç¯ç»“æ„ã€‚</li><li>å› æ­¤å¯ä»¥å¯¹B+Treeè¿›è¡Œä¸¤ç§æŸ¥æ‰¾è¿ç®—ï¼š<ul><li>ä¸€ç§æ˜¯å¯¹äºä¸»é”®çš„èŒƒå›´æŸ¥æ‰¾çš„åˆ†é¡µæŸ¥æ‰¾ã€‚</li><li>å¦ä¸€ç§æ˜¯ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œè¿›è¡ŒéšæœºæŸ¥æ‰¾ã€‚</li></ul></li></ul><p><strong>Bæ ‘å’ŒB+æ ‘çš„åŒºåˆ«ï¼š</strong></p><blockquote><p>B+æ ‘å†…èŠ‚ç‚¹ä¸å­˜å‚¨æ•°æ®ï¼Œæ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨å¶èŠ‚ç‚¹å¯¼è‡´æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦å›ºå®šä¸ºlog n<br>B-æ ‘æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸å›ºå®šï¼Œä¸Keyåœ¨æ ‘ä¸­çš„ä½ç½®æœ‰å…³ï¼Œæœ€å¥½ä¸ºO(1)<br>B+æ ‘å¶èŠ‚ç‚¹ä¸¤ä¸¤ç›¸è¿å¯å¤§å¤§å¢åŠ åŒºé—´è®¿é—®æ€§ï¼Œå¯ä½¿ç”¨åœ¨èŒƒå›´æŸ¥è¯¢ç­‰<br>B+æ ‘æ›´é€‚åˆå¤–éƒ¨å­˜å‚¨ï¼ˆå­˜å‚¨ç£ç›˜æ•°æ®ï¼‰ã€‚ç”±äºå†…èŠ‚ç‚¹æ— dataåŸŸï¼Œæ¯ä¸ªèŠ‚ç‚¹èƒ½ç´¢å¼•çš„èŒƒå›´æ›´å¤§æ›´ç²¾ç¡®ã€‚</p></blockquote></li></ul><h3 id="DCLï¼ˆæ•°æ®åº“æ§åˆ¶è¯­è¨€ï¼‰ï¼š">DCLï¼ˆæ•°æ®åº“æ§åˆ¶è¯­è¨€ï¼‰ï¼š</h3><p><strong>æ•°æ®æ§åˆ¶è¯­è¨€ ç”¨æˆ·æƒé™æ§åˆ¶ grantã€revoke</strong></p><h4 id="æƒé™ç®¡ç†">æƒé™ç®¡ç†</h4><h5 id="ç”¨æˆ·ç®¡ç†">ç”¨æˆ·ç®¡ç†</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">-- åˆ›å»ºç”¨æˆ· create user ç”¨æˆ·å identified by &#x27;å¯†ç &#x27;</span><br><span class="line">create user xh identitied by &#x27;a&#x27;;</span><br><span class="line">-- ä¿®æ”¹å¯†ç </span><br><span class="line">set password = password(&#x27;123321&#x27;);</span><br><span class="line">-- ä¿®æ”¹å¯†ç ï¼ˆä¿®æ”¹æŒ‡å®šç”¨æˆ·å¯†ç ï¼‰</span><br><span class="line">set password from xh = password(&#x27;a&#x27;);</span><br><span class="line">-- é‡å‘½å</span><br><span class="line">rename user åŸæ¥å to æ–°åå­—;</span><br><span class="line">-- ç”¨æˆ·æˆæƒ</span><br><span class="line">-- all privileges é™¤äº†ç»™åˆ«äººæˆæƒï¼Œå…¶ä»–éƒ½èƒ½å¹²</span><br><span class="line">grant all privileges on *.* to xh;</span><br><span class="line">-- æŸ¥è¯¢æƒé™</span><br><span class="line">show grant for xh ; -- æŸ¥çœ‹æŒ‡å®šç”¨æˆ·çš„æƒé™</span><br><span class="line">show grant for root@loaclhost</span><br><span class="line">-- rootç”¨æˆ·æƒé™ï¼šGrant all privileges on *.* to &#x27;root&#x27;@&#x27;localhost&#x27; with grant option </span><br><span class="line">Grant all privileges on *.* to &#x27;root&#x27;@&#x27;localhost&#x27; with grant option </span><br><span class="line">-- æ’¤é”€æƒé™ revoke å“ªäº›æƒé™ï¼Œåœ¨å“ªä¸ªåº“æ’¤é”€ï¼Œç»™è°æ’¤é”€</span><br><span class="line">revoke all privileges on *.* from xh;</span><br><span class="line">-- åˆ é™¤ç”¨æˆ·</span><br><span class="line">drop user xh;</span><br></pre></td></tr></table></figure><h4 id="MYSQLå¤‡ä»½">MYSQLå¤‡ä»½</h4><p>ä¸ºå•¥è¦å¤‡ä»½ï¼š</p><ul><li><p>ä¿è¯é‡è¦æ•°æ®ä¸ä¸¢å¤±ã€‚</p></li><li><p>æ•°æ®è½¬ç§»ã€‚</p></li></ul><p>MYSQLæ•°æ®åº“å¤‡ä»½çš„æ–¹å¼ï¼š</p><ul><li>ç›´æ¥æ‹·è´ç‰©ç†æ–‡ä»¶</li><li>åœ¨å¯è§†åŒ–ç¼–è¾‘å™¨ä¸­æ‰‹åŠ¨å¯¼å‡º</li><li>ä½¿ç”¨å‘½ä»¤è¡Œå¯¼å‡º  mysqldump  å‘½ä»¤è¡Œå¯¼å‡ºã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å‡ºæ•°æ®åº“ï¼Œwindowsæˆ–è€…linuxå¯¼å‡º</span></span><br><span class="line"><span class="comment"># -p åå¯†ç  ï¼Œæ•°æ®åº“å ï¼Œè¡¨å &gt;D:/æ–‡ä»¶å.sql</span></span><br><span class="line">mysqldump -hlocalhost -uroot -pa <span class="built_in">test</span> test1 &gt;D:/a.sql</span><br><span class="line"><span class="comment"># å¯¼å…¥æ•°æ®åº“</span></span><br><span class="line">mysql -uroot -pa åº“å &lt; å¤‡ä»½æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">use <span class="built_in">test</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> d:/æ–‡ä»¶å.sql;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="æ•°æ®åº“è§„èŒƒ">æ•°æ®åº“è§„èŒƒ</h4><h5 id="ä¸ºå•¥éœ€è¦è®¾è®¡ï¼Ÿ">ä¸ºå•¥éœ€è¦è®¾è®¡ï¼Ÿ</h5><p>==å½“æ•°æ®åº“æ¯”è¾ƒå¤æ‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è®¾è®¡==</p><p>ä¸€ä¸ªç³Ÿç³•çš„æ•°æ®åº“è®¾è®¡ï¼š</p><ul><li>å­˜åœ¨æ•°æ®æ²‰ä½™ï¼Œæµªè´¹ç©ºé—´</li><li>æ•°æ®æ’å…¥å’Œåˆ é™¤éƒ½ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå¼‚å¸¸ã€å±è”½ä½¿ç”¨ç‰©ç†å¤–é”®ã€‘</li><li>ç¨‹åºçš„æ€§èƒ½å¾ˆå·®</li></ul><p>è‰¯å¥½çš„æ•°æ®åº“è®¾è®¡ï¼š</p><ul><li>èŠ‚çœå†…å­˜ç©ºé—´ã€‚</li><li>ä¿è¯æ•°æ®åº“çš„å®Œæ•´æ€§ã€‚</li><li>æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œå¼€å‘ã€‚</li></ul><p>è½¯ä»¶å¼€å‘ä¸­ï¼Œå…³äºæ•°æ®åº“è®¾è®¡</p><ul><li>åˆ†æéœ€æ±‚ï¼šåˆ†æä¸šåŠ¡å’Œéœ€è¦å¤„ç†çš„æ•°æ®åº“çš„éœ€æ±‚ã€‚</li><li>æ¦‚è¦è®¾è®¡ï¼šè®¾è®¡å…³ç³»å›¾E-Rå›¾ã€‚</li></ul><p>ç”¨ä¸ªäººåšå®¢ï¼š</p><ul><li>æ”¶é›†ç”¨æˆ·ä¿¡æ¯ï¼š<ul><li>ç”¨æˆ·è¡¨ï¼ˆç”¨æˆ·ç™»å½•æ³¨å†Œï¼Œç”¨æˆ·ä¿¡æ¯ï¼Œå†™åšå®¢ï¼Œåˆ›å»ºåˆ†ç±»ï¼‰</li><li>åˆ†ç±»è¡¨ï¼ˆç±»å‹ç¼–å·ï¼Œç±»å‹åï¼Œç±»å‹å›¾ç‰‡ï¼‰</li><li>æ–‡ç« è¡¨(æ–‡ç« id,æ–‡ç« åï¼Œæ–‡ç« ç±»å‹ï¼Œæ–‡ç« å†…å®¹ï¼Œä½œè€…)</li><li>å‹é“¾è¡¨ï¼ˆï¼‰</li><li>è‡ªå®šä¹‰è¡¨ï¼ˆï¼‰</li></ul></li></ul><h4 id="ä¸‰å¤§èŒƒå¼">ä¸‰å¤§èŒƒå¼</h4><p>ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®è§„èŒƒåŒ–</p><ul><li>ä¿¡æ¯é‡å¤</li><li>æ›´æ–°å¼‚å¸¸</li><li>æ’å…¥å¼‚å¸¸<ul><li>æ— æ³•æ­£å¸¸æ˜¾ç¤ºä¿¡æ¯</li></ul></li><li>åˆ é™¤å¼‚å¸¸<ul><li>ä¸¢å¤±æœ‰æ•ˆçš„ä¿¡æ¯</li></ul></li></ul><blockquote><p>ä¸‰å¤§èŒƒå¼</p></blockquote><p>â€‹ç¬¬ä¸€èŒƒå¼ï¼šä¿è¯åŸå­æ€§ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€åˆ—éƒ½ä¸å¯å†åˆ†ã€‚</p><p>â€‹ç¬¬äºŒèŒƒå¼ï¼šå¿…é¡»å…ˆæ»¡è¶³ç¬¬ä¸€èŒƒå¼ï¼Œç„¶åæ‰èƒ½åˆ¤æ–­æ˜¯å¦æ»¡è¶³ç¬¬äºŒèŒƒå¼ï¼Œç¡®ä¿==æ¯å¼ è¡¨åªå¹²ä¸€ä»¶äº‹==</p><p>â€‹</p><p>â€‹ç¬¬ä¸‰èŒƒå¼ï¼šç¡®ä¿æ»¡è¶³ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸‹ï¼Œç¡®ä¿æ¯å¼ è¡¨æ¯ä¸€åˆ—çš„æ•°æ®éƒ½å’Œä¸»é”®ç›´æ¥ç›¸å…³ï¼Œè€Œä¸æ˜¯é—´æ¥ç›¸å…³ã€‚</p><p><strong>è§„èŒƒæ€§å’Œæ€§èƒ½é—®é¢˜</strong></p><p>å…³è”æŸ¥è¯¢çš„è¡¨ä¸å¾—è¶…è¿‡ä¸‰å¼ è¡¨</p><ul><li>åœ¨è€ƒè™‘å•†ä¸šåŒ–çš„éœ€æ±‚å’Œç›®æ ‡ï¼ˆæˆæœ¬å’Œç”¨æˆ·ä½“éªŒï¼ï¼‰æ•°æ®åº“çš„æ€§èƒ½æ›´åŠ é‡è¦</li><li>åœ¨è§„èŒƒæ€§èƒ½é—®é¢˜çš„æ—¶å€™ï¼Œéœ€è¦é€‚å½“è€ƒè™‘ä¸€ä¸‹è§„èŒƒæ€§ã€‚</li><li>æ•…æ„ç»™æŸäº›è¡¨å¢åŠ ä¸€äº›å†—ä½™çš„å­—æ®µï¼ˆä»å¤šè¡¨æŸ¥è¯¢ä¸­å˜ä¸ºå•è¡¨æŸ¥è¯¢ï¼Œé—®å°±æ˜¯å¢å¿«æŸ¥è¯¢æ•°æ®å‘—ï¼‰</li><li>æ•…æ„å¢åŠ ä¸€äº›è®¡ç®—åˆ—ï¼ˆä»å¤§æ•°æ®é‡é™ä¸ºå°æ•°æ®é‡ï¼šç´¢å¼•ï¼‰ã€‚</li></ul><h4 id="JDBC">JDBC</h4><p>è¿æ¥æ•°æ®åº“çš„ä¸€ä¸ªåŒ…ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªåŒ…ï¼Œæˆ‘ä»¬é€šè¿‡åŒ…æä¾›çš„å°è£…ç±»ï¼Œå®Œæˆè¿æ¥æ•°æ®åº“æŒ‡ä»¤æ“ä½œã€‚</p><p>åˆ›å»ºä¸€ä¸ªJDBC</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿æ¥mysql</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBC</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String [] args)</span> <span class="keyword">throws</span> ClassNotFoundException&#123;</span><br><span class="line">        <span class="comment">//1åŠ è½½é©±åŠ¨</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);<span class="comment">//å›ºå®šè¯­æ³•ï¼ŒåŠ è½½é©±åŠ¨ï¼Œæ³¨æ„mysql5.0å’Œ8.0ç›´æ¥é©±åŠ¨è¿æ¥æœ‰å·®åˆ«.5.0çš„ä¸éœ€è¦æœ‰cjï¼Œä¹Ÿå°±æ˜¯com.mysql.jdbc.Driver,ä½†æ˜¯8.0çš„æ˜¯com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2ç”¨æˆ·ä¿¡æ¯ï¼Œurl</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/æ•°æ®åº“åï¼ŸuseUnicode=true&amp;characterEncoding=utf8&amp;useSSL=true&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;a&quot;</span>; </span><br><span class="line">        <span class="comment">//3è¿æ¥æˆåŠŸ,æ•°æ®åº“å¯¹è±¡ Connection ä»£è¡¨æ•°æ®åº“</span></span><br><span class="line">       <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(url,username,password); </span><br><span class="line">        <span class="comment">//4æ‰§è¡Œsqlå¯¹è±¡  Statement æ‰§è¡Œsqlå¯¹è±¡çš„</span></span><br><span class="line">     <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();   </span><br><span class="line">        <span class="comment">//æ‰§è¡Œsqlå¯¹è±¡å»æ‰§è¡Œsqlçš„å¯èƒ½å­˜åœ¨çš„ç»“æœ</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;ä½ è¦å†™çš„sqlè¯­å¥&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="type">ResuletSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> statement.executeQuery(sql);<span class="comment">//è¿”å›ç»“æœé›†ï¼Œç»“æœé›†ä¸­å°è£…äº†æˆ‘ä»¬å…¨éƒ¨æŸ¥è¯¢å‡ºæ¥çš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">while</span>(resultSet.next())&#123;</span><br><span class="line">            <span class="comment">//ä»¥ä¸‹å…¨ä¸ºè¡¨ä¸­çš„åˆ—å­—æ®µ</span></span><br><span class="line">            System.out.println(<span class="string">&quot;id= &quot;</span> resultSet.getObject(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">               System.out.println(<span class="string">&quot;name= &quot;</span> resultSet.getObject(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">               System.out.println(<span class="string">&quot;pwd= &quot;</span> resultSet.getObject(<span class="string">&quot;pwd&quot;</span>));</span><br><span class="line">               System.out.println(<span class="string">&quot;email= &quot;</span> resultSet.getObject(<span class="string">&quot;email&quot;</span>));</span><br><span class="line">               System.out.println(<span class="string">&quot;birth= &quot;</span> resultSet.getObject(<span class="string">&quot;brithday&quot;</span>));</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">                <span class="comment">//é‡Šæ”¾è¿æ¥ï¼Œå…³é—­ã€‚</span></span><br><span class="line">        resultSet.close();</span><br><span class="line">        statement.close();</span><br><span class="line">        connection.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¥éª¤æ€»ç»“ï¼š</p><ol><li>åŠ è½½é©±åŠ¨</li><li>è¿æ¥æ•°æ®åº“DriverManager</li><li>è·å–æ‰§è¡Œsqlçš„å¯¹è±¡Statement</li><li>è¿”å›è·å¾—çš„ç»“æœé›†ï¼ˆlistï¼‰</li><li>é‡Šæ”¾è¿æ¥</li></ol><blockquote><p>DriverManager</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">   <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(url,username,password);<span class="comment">//è¿æ¥æ•°æ®åº“</span></span><br><span class="line"><span class="comment">//äº‹åŠ¡ä»¥åŠè‡ªåŠ¨æäº¤éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªæ“ä½œ</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>Url</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/æ•°æ®åº“å?useUnicode=true&amp;characterEncoding=utf8&amp;useSSL=true&quot;</span>;</span><br><span class="line"><span class="comment">// mysql 3306 </span></span><br><span class="line"><span class="comment">// jdbc:mysql://ä¸»æœºåœ°å€ï¼šç«¯å£å·/æ•°æ®åº“åï¼Ÿå‚æ•°1&amp;å‚æ•°2.ã€‚ã€‚ã€‚</span></span><br><span class="line"><span class="comment">//oracle 1521</span></span><br><span class="line"><span class="comment">//jdbc:oracle:thin:@localhost:1521:è¡¨åï¼Ÿ</span></span><br></pre></td></tr></table></figure><blockquote><p>Statement</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//4æ‰§è¡Œsqlå¯¹è±¡  Statement æ‰§è¡Œsqlå¯¹è±¡çš„</span></span><br><span class="line">    <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();   </span><br><span class="line">statement.executeQuery();<span class="comment">// æŸ¥è¯¢æ“ä½œè¿”å›ResultSet</span></span><br><span class="line">statement.execute();<span class="comment">//æ‰§è¡Œä»»ä½•Sql</span></span><br><span class="line">statement.executeUpdate()ï¼›<span class="comment">//æ›´æ–°ï¼Œæ’å…¥åˆ é™¤ï¼Œéƒ½æ˜¯é€šè¿‡è¿™ä¸ªã€‚</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>ResultSetæŸ¥è¯¢çš„ç»“æœé›†ï¼šå°è£…äº†æ‰€æœ‰çš„æŸ¥è¯¢ç»“æœ</p></blockquote><p>è·å¾—æŒ‡å®šçš„æ•°æ®ç±»å‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="type">ResuletSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> statement.executeQuery(sql);<span class="comment">//è¿”å›ç»“æœé›†ï¼Œç»“æœé›†ä¸­å°è£…äº†æˆ‘ä»¬å…¨éƒ¨æŸ¥è¯¢å‡ºæ¥çš„ç»“æœ</span></span><br><span class="line"><span class="comment">//å¦‚æœä¸çŸ¥é“åˆ—ç±»å‹çš„è¯æˆ‘ä»¬å°±ä½¿ç”¨</span></span><br><span class="line">resultSet.getObject();</span><br><span class="line"><span class="comment">//çŸ¥é“çš„è¯</span></span><br><span class="line">resultSet.getString();</span><br><span class="line">resultSet.getInt();</span><br><span class="line">resultSet.getFloat();</span><br><span class="line">....</span><br></pre></td></tr></table></figure><p>éå†æŒ‡é’ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">resultSet.beforeFirst();<span class="comment">//ç§»åŠ¨åˆ°æœ€å‰è¾¹</span></span><br><span class="line">resultSet.afterLast();<span class="comment">//ç§»åŠ¨åˆ°æœ€åè¾¹</span></span><br><span class="line">resultSet.next();<span class="comment">//ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ•°æ®</span></span><br><span class="line">resultSet.previous();<span class="comment">//ç§»åŠ¨åˆ°å‰ä¸€è¡Œ</span></span><br><span class="line">resultSet.absolute(row)ï¼›<span class="comment">//ç§»åŠ¨åˆ°æŒ‡å®šè¡Œ</span></span><br></pre></td></tr></table></figure><blockquote><p>é‡Šæ”¾èµ„æº:å¿…é¡»è¦åšçš„</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">resultSet.close();</span><br><span class="line">statement.close();</span><br><span class="line">connection.close();</span><br></pre></td></tr></table></figure><h5 id="å·¥å…·ç±»">å·¥å…·ç±»</h5><p>åˆ›å»ºä¸€ä¸ªJDBCé“¾æ¥çš„å·¥å…·ç±»ï¼ˆoracleï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSetMetaData;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DBHelper</span> &#123;</span><br><span class="line"><span class="comment">//åŠ è½½æˆåŠŸï¼Œåœ¨æ•´ä¸ªç¨‹åºä¸­ï¼Œåªéœ€è¦åŠ è½½åœ¨ä¸€æ¬¡å°±å¥½äº†</span></span><br><span class="line">    <span class="comment">//æ”¾åˆ°é™æ€å¿«é‡Œè¾¹ï¼šå› ä¸ºé™æ€å¿«ï¼Œè‡ªåŠ¨æ‰§è¡Œï¼Œå¹¶ä¸”åªæ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Class.forName(MyProperties.getInstance().getProperty(<span class="string">&quot;driverClass&quot;</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;<span class="comment">//é™æ€æ–¹æ³•ï¼Œå¯ä»¥ä¸å®ä¾‹åŒ–ï¼Œè€Œç›´æ¥è°ƒç”¨</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–è¿æ¥è¿™ä¸€æ®µä»£ç ï¼Œå¤ªé•¿äº†ï¼Œå¯¹æ­¤æˆ‘ä»¬å°è£…ä¸€ä¸‹</span></span><br><span class="line"><span class="keyword">public</span> Connection <span class="title function_">getCon</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="comment">//åœ¨è¿™é‡Œï¼Œè¿æ¥åœ°å€ï¼Œç”¨æˆ·åï¼Œå’Œå¯†ç ï¼Œå¯¹äºä¸åŒçš„ç”¨æˆ·ï¼Œå¯èƒ½ä¸ä¸€æ ·</span></span><br><span class="line"><span class="comment">//æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªä¸‰ä¸ªä¸œè¥¿ï¼Œä½œä¸ºé…ç½®é¡¹ï¼Œé…ç½®åˆ°ç¨‹åºä¸­</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">conn = DriverManager.getConnection(MyProperties.getInstance().getProperty(<span class="string">&quot;url&quot;</span>),</span><br><span class="line">MyProperties.getInstance());</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> conn;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¢åˆ æ”¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sql è¦æ‰§è¡Œçš„è¯­å¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params è¦æ³¨å…¥çš„å‚æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">doUpdate</span><span class="params">(String sql,List&lt;Object&gt; params)</span> &#123;</span><br><span class="line"><span class="comment">//å®šä¹‰è¿”å›å€¼</span></span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//è·å–è¿æ¥</span></span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> getCon();</span><br><span class="line"><span class="comment">//åˆ›å»ºé¢„å¤„ç†è¯­å¥å¯¹è±¡</span></span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line"><span class="comment">//å¦‚æœæœ‰é—®å·ï¼Œæœ‰å‚æ•°ï¼Œè¦æ³¨å…¥å‚æ•°</span></span><br><span class="line">doParams(ps,params);</span><br><span class="line"><span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">result = ps.executeUpdate();</span><br><span class="line"><span class="comment">//å…³é—­å„ç§è¿æ¥ï¼Œæ¥å£</span></span><br><span class="line">closeAll(conn,<span class="literal">null</span>,ps);</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æœ€ç»ˆè¿”å›æ•°æ®</span></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢è¯­å¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sql</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">findAll</span><span class="params">(String sql,List&lt;Object&gt;params)</span>&#123;</span><br><span class="line">List&lt;Map&lt;String,Object&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Map&lt;String,Object&gt;&gt;();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//è·å–è¿æ¥</span></span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> getCon();</span><br><span class="line"><span class="comment">//åˆ›å»ºé¢„å¤„ç†è¯­å¥å¯¹è±¡</span></span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line"><span class="comment">//å¦‚æœæœ‰é—®å·ï¼Œæœ‰å‚æ•°ï¼Œè¦æ³¨å…¥å‚æ•°</span></span><br><span class="line">doParams(ps, params);</span><br><span class="line"><span class="comment">//æ‰§è¡Œè¿™é‡Œå¼€å§‹ä¸ä¸€æ ·</span></span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> ps.executeQuery();</span><br><span class="line"><span class="comment">//æˆ‘ä»¬è¦å°†resultSeté‡Œè¾¹çš„å€¼ï¼Œè½¬åŒ–ä¸ºList&lt;Map&lt;String,Object&gt;&gt;</span></span><br><span class="line"><span class="comment">//Map&lt;String,Object&gt; é”®å€¼å¯¹     é”®  ï¼š è¡¨çš„å­—æ®µ  å€¼:è¿™ä¸ªå­—æ®µå¯¹åº”çš„å€¼</span></span><br><span class="line"><span class="type">ResultSetMetaData</span> <span class="variable">rsmd</span> <span class="operator">=</span>rs.getMetaData();</span><br><span class="line"><span class="comment">//æˆ‘ä»¬å°†æ‰€æœ‰çš„åˆ—åï¼Œå­˜åˆ°ä¸€ä¸ªæ•°ç»„ä¸­</span></span><br><span class="line">String [] cnames = <span class="keyword">new</span> <span class="title class_">String</span> [rsmd.getColumnCount()];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span> ;i&lt;cnames.length;i++) &#123;</span><br><span class="line">cnames[i] = rsmd.getColumnName(i+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¼€å§‹è·å¾—æ•°æ®</span></span><br><span class="line"><span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line"><span class="comment">//åˆ›å»ºmapå¯¹è±¡</span></span><br><span class="line">Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;cnames.length;i++) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(rs.getObject(cnames[i])== <span class="literal">null</span>)&#123;</span><br><span class="line">map.put(cnames[i].toLowerCase(), <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;oracle.sql.BLOB&quot;</span>.equals(rs.getObject(cnames[i]).getClass().getName()))&#123;</span><br><span class="line">map.put(cnames[i].toLowerCase(), rs.getBytes(cnames[i]));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">//é”®  è½¬æ¢ä¸ºå°å†™     å€¼  </span></span><br><span class="line">map.put(cnames[i].toLowerCase(),rs.getObject(cnames[i]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å°†mapæ·»åŠ åˆ°listä¸­</span></span><br><span class="line">list.add(map);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å…³é—­</span></span><br><span class="line">closeAll(conn,rs,ps);</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> list;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List&lt;Map&lt;String,Object&gt;&gt; <span class="title function_">findAll</span><span class="params">(String sql,Object...params)</span>&#123;</span><br><span class="line">List&lt;Map&lt;String,Object&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Map&lt;String,Object&gt;&gt;();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//è·å–è¿æ¥</span></span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> getCon();</span><br><span class="line"><span class="comment">//åˆ›å»ºé¢„å¤„ç†è¯­å¥å¯¹è±¡</span></span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line"><span class="comment">//å¦‚æœæœ‰é—®å·ï¼Œæœ‰å‚æ•°ï¼Œè¦æ³¨å…¥å‚æ•°</span></span><br><span class="line">doParams(ps, params);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰§è¡Œè¿™é‡Œå¼€å§‹ä¸ä¸€æ ·</span></span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> ps.executeQuery();</span><br><span class="line"><span class="comment">//æˆ‘ä»¬è¦å°†resultSeté‡Œè¾¹çš„å€¼ï¼Œè½¬åŒ–ä¸ºList&lt;Map&lt;String,Object&gt;&gt;</span></span><br><span class="line"><span class="comment">//Map&lt;String,Object&gt; é”®å€¼å¯¹     é”®  ï¼š è¡¨çš„å­—æ®µ  å€¼:è¿™ä¸ªå­—æ®µå¯¹åº”çš„å€¼</span></span><br><span class="line"><span class="type">ResultSetMetaData</span> <span class="variable">rsmd</span> <span class="operator">=</span>rs.getMetaData();</span><br><span class="line"><span class="comment">//æˆ‘ä»¬å°†æ‰€æœ‰çš„åˆ—åï¼Œå­˜åˆ°ä¸€ä¸ªæ•°ç»„ä¸­</span></span><br><span class="line">String [] cnames = <span class="keyword">new</span> <span class="title class_">String</span> [rsmd.getColumnCount()];</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span> ;i&lt;cnames.length;i++) &#123;</span><br><span class="line">cnames[i] = rsmd.getColumnName(i+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¼€å§‹è·å¾—æ•°æ®</span></span><br><span class="line"><span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line"><span class="comment">//åˆ›å»ºmapå¯¹è±¡</span></span><br><span class="line">Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;cnames.length;i++) &#123;</span><br><span class="line"><span class="comment">// é”®          è½¬ä¸ºå°å†™    å€¼</span></span><br><span class="line"><span class="comment">//å¯¹äºblob çš„å€¼ï¼Œæˆ‘ä»¬è¿™é‡Œè¦åŒºåˆ†ä¸€ä¸‹</span></span><br><span class="line"><span class="keyword">if</span>(rs.getObject(cnames[i])== <span class="literal">null</span>)&#123;</span><br><span class="line">map.put(cnames[i].toLowerCase(), <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//System.out.println(rs.getObject(cnames[i]).getClass().getName());</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;oracle.sql.BLOB&quot;</span>.equals(rs.getObject(cnames[i]).getClass().getName()))&#123;</span><br><span class="line">map.put(cnames[i].toLowerCase(), rs.getBytes(cnames[i]));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="comment">//é”®  è½¬æ¢ä¸ºå°å†™     å€¼  </span></span><br><span class="line">map.put(cnames[i].toLowerCase(),rs.getObject(cnames[i]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å°†mapæ·»åŠ åˆ°listä¸­</span></span><br><span class="line">list.add(map);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ³¨å…¥å‚æ•°</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doParams</span><span class="params">(PreparedStatement ps, List&lt;Object&gt; params)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(ps != <span class="literal">null</span> &amp;&amp;params!= <span class="literal">null</span>&amp;&amp; params.size()&gt;<span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">//å¾ªç¯æ³¨å…¥</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;params.size();i++) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">ps.setObject(i+<span class="number">1</span>, params.get(i));</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é‡è½½                                                                                                                      ...é‡è¯å‚æ•°  ä»£è¡¨ä»»æ„ä¸ªå‚æ•° æœ¬è´¨æ˜¯æ•°ç»„</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doParams</span><span class="params">(PreparedStatement ps, Object...params)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(ps != <span class="literal">null</span> &amp;&amp; params.length&gt;<span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">//å¾ªç¯æ³¨å…¥</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;params.length;i++) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">ps.setObject(i+<span class="number">1</span>, params[i]);</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">doUpdate</span><span class="params">(String sql,Object... params)</span> &#123;</span><br><span class="line"><span class="comment">//å®šä¹‰è¿”å›å€¼</span></span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//è·å–è¿æ¥</span></span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> getCon();</span><br><span class="line"><span class="comment">//åˆ›å»ºé¢„å¤„ç†è¯­å¥å¯¹è±¡</span></span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line"><span class="comment">//å¦‚æœæœ‰é—®å·ï¼Œæœ‰å‚æ•°ï¼Œè¦æ³¨å…¥å‚æ•°</span></span><br><span class="line">doParams(ps,params);</span><br><span class="line"><span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">result = ps.executeUpdate();</span><br><span class="line"><span class="comment">//å…³é—­å„ç§è¿æ¥ï¼Œæ¥å£</span></span><br><span class="line">closeAll(conn,<span class="literal">null</span>,ps);</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e1) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e1.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æœ€ç»ˆè¿”å›æ•°æ®</span></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">closeAll</span><span class="params">(Connection conn, ResultSet rs, PreparedStatement ps)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(conn != <span class="literal">null</span> ) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">conn.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(rs != <span class="literal">null</span> ) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">rs.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(ps != <span class="literal">null</span> ) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">ps.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">      &#125;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å·¥å…·ç±»ï¼ˆå•ä¾‹ï¼‰-Oracle">å·¥å…·ç±»ï¼ˆå•ä¾‹ï¼‰(Oracle)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProperties</span> <span class="keyword">extends</span> <span class="title class_">Properties</span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> MyProperties myProperties;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ„é€ å‡½æ•°ç§æœ‰åŒ–  å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment">//å•ä¾‹  åªæœ‰ä¸€ä¸ªå®ä¾‹</span></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">MyProperties</span><span class="params">()</span>&#123;<span class="comment">//è£…è½½é€šè¿‡æ•°æ®æµè·å¾—çš„èµ„æºé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> MyProperties.class.getClassLoader().getResourceAsStream(<span class="string">&quot;db.properties&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//load è£…è½½é…ç½®æ–‡ä»¶  void java.util.Properties.load(InputStream inStream) throws IOException</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.load(is);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å•ä¾‹æ¨¡å¼è®¾è®¡ä¹‹å ï¼Œä¸€å®šè¦æœ‰ä¸€ä¸ªå…¬æœ‰çš„æ–¹æ³•ï¼Œè®©å…¶ä»–å¯¹è±¡è®¿é—®åˆ°è¿™ä¸ªå±æ€§</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> MyProperties <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">if</span>( myProperties  == <span class="literal">null</span> )&#123;</span><br><span class="line">myProperties = <span class="keyword">new</span> <span class="title class_">MyProperties</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> myProperties;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="db-properties">db.properties</h5><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#db.properties</span></span><br><span class="line"><span class="attr">driverClass</span>=oracle.jdbc.OracleDriver</span><br><span class="line"><span class="attr">url</span>=jdbc:oracle:thin:@<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">1521</span>:orcl</span><br><span class="line"><span class="attr">user</span>=scott</span><br><span class="line"><span class="attr">password</span>=a</span><br><span class="line"></span><br><span class="line"><span class="comment">#mysqlè¿æ¥æ–¹å¼</span></span><br><span class="line"><span class="comment">#driverClass=com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="comment">#url=jdbc:mysql://127.0.0.1:3306/res</span></span><br><span class="line"><span class="comment">#user=root</span></span><br><span class="line"><span class="comment">#password=a</span></span><br></pre></td></tr></table></figure><h5 id="å·¥å…·ç±»ï¼ˆMysql-DBHelperï¼‰">å·¥å…·ç±»ï¼ˆMysql,DBHelperï¼‰</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°è£…  æ•°æ®åº“æ“ä½œçš„å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 38929</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>  2021å¹´5æœˆ29æ—¥ ä¸‹åˆ4:43:06</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DBHelper</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment">//ORACLE</span></span><br><span class="line"><span class="comment">//private static String driverClassName = &quot;oracle.jdbc.driver.OracleDriver&quot;;</span></span><br><span class="line"><span class="comment">//private String url = &quot;jdbc:oracle:thin:@localhost:1521:ORCL&quot;;</span></span><br><span class="line"><span class="comment">//private String user = &quot;scott&quot;;</span></span><br><span class="line"><span class="comment">//private String password = &quot;a&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//MySQL</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç›¸å…³å¯¹è±¡</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//è¿æ¥å¯¹è±¡</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">PreparedStatement</span> <span class="variable">pstmt</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//é¢„ç¼–è¯‘</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//ç»“æœé›†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//åªåœ¨ç±»ä¸­ç¬¬ä¸€æ¬¡åŠ è½½æ‰æ‰§è¡Œ ä¸” æ‰§è¡Œä¸€æ¬¡      -&gt;   å½“ä½¿ç”¨JNDIè¿æ¥æ•°æ®åº“æ—¶  å¯ä»¥æ³¨é‡Šè¯¥é™æ€åŠ è½½ </span></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line"><span class="comment">//2ã€åŠ è½½å¹¶æ³¨å†Œä¾èµ–oracle.jdbc.driver.OracleDriver.class</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Class.forName( ReadConfig.getInstance().getProperty(<span class="string">&quot;driverClassName&quot;</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å»ºç«‹è¿æ¥</span></span><br><span class="line"><span class="keyword">private</span> Connection <span class="title function_">getConn</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//3ã€å»ºç«‹è¿æ¥     url  uname  pwd</span></span><br><span class="line"><span class="comment">//url ç»Ÿä¸€èµ„æºå®šä½ç¬¦   jdbc:oracle:thin:@æ•°æ®åº“çš„IPåœ°å€:1521:å®ä¾‹å    127.0.0.1 | localhost:1521:ORCL </span></span><br><span class="line"><span class="comment">//ctrl 1 + 2 -&gt; L</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//conn = DriverManager.getConnection(&quot;jdbc:oracle:thin:@localhost:1521:ORCL&quot;, &quot;scott&quot;, &quot;a&quot;);</span></span><br><span class="line">conn = DriverManager.getConnection(ReadConfig.getInstance().getProperty(<span class="string">&quot;url&quot;</span>), ReadConfig.getInstance());</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»æœåŠ¡å™¨ context.xml ä¸­ ä¸Šä¸‹æ–‡è·å–é…ç½®çš„DataSource  </span></span><br><span class="line"><span class="comment">//Context context= new InitialContext();</span></span><br><span class="line"><span class="comment">//ä»å‘½åç›®å½•æ¥å£ä¸­æ ¹æ®èµ„æºåæŸ¥è¯¢  å‰é¢ java:comp/env/blog å›ºå®šçš„   ç±»ä¼¼äºåè®®</span></span><br><span class="line"><span class="comment">//DataSource dataSource =  (DataSource)context.lookup(&quot;java:comp/env/blog&quot;);</span></span><br><span class="line"><span class="comment">//ä»æ•°æ®åº“è¿æ¥æ± è·å–ä¸€ä¸ªç©ºé—²çš„è¿æ¥ </span></span><br><span class="line"><span class="comment">//conn = dataSource.getConnection();</span></span><br><span class="line"><span class="comment">/*&#125; catch (NamingException e) &#123;</span></span><br><span class="line"><span class="comment">e.printStackTrace();*/</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> conn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…³é—­èµ„æº</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> rs</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pstmt</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> conn</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unused&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">closeAll</span><span class="params">(ResultSet rs, PreparedStatement pstmt, Connection conn)</span> &#123;</span><br><span class="line"><span class="comment">//7ã€å…³é—­èµ„æº  å…ˆå¼€å¯çš„åå…³é—­  åå¼€å¯çš„å…ˆå…³é—­  ç»“æœé›† -&gt; è¯­å¥å— -&gt; è¿æ¥</span></span><br><span class="line"><span class="keyword">if</span>( rs != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">rs.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>( pstmt != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">pstmt.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>( conn != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">conn.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ›´æ–°æ“ä½œ   Object ... params  ä¸å®šå‚æ•°   ç±»ä¼¼äºæ•°ç»„  ä¸‡ç‰©çš†å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sql  è¦æ‰§è¡Œçš„æ›´æ–°è¯­å¥   å¯ä»¥ insert update delete </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params è¦æ‰§è¡Œçš„SQLè¯­å¥ä¸­çš„å ä½ç¬¦ï¼Ÿ æ‰€å¯¹åº”å‚æ•°çš„å€¼ </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(String sql, Object ... params)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> -<span class="number">1</span>;<span class="comment">//å®šä¹‰é»˜è®¤çš„èŒƒå›´å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">conn = <span class="built_in">this</span>.getConn();<span class="comment">//è·å–è¿æ¥</span></span><br><span class="line">pstmt = conn.prepareStatement(sql);<span class="comment">//é¢„ç¼–è¯‘å¯¹è±¡è£…è½½SQL</span></span><br><span class="line"><span class="built_in">this</span>.setParams(pstmt, params);<span class="comment">//éœ€è¦ç»™å ä½ç¬¦æ³¨å…¥å‚æ•°</span></span><br><span class="line">result = pstmt.executeUpdate();<span class="comment">//æ‰§è¡Œæ›´æ–°è¯­å¥</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»™é¢„ç¼–è¯‘è¯­å¥å—ä¸­å ä½ç¬¦ èµ‹å€¼ è®¾ç½®å‚æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pstmt   é¢„ç¼–è¯‘å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params  è¦æ‰§è¡Œçš„SQLè¯­å¥ä¸­çš„å ä½ç¬¦ï¼Ÿ æ‰€å¯¹åº”å‚æ•°çš„å€¼ </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setParams</span><span class="params">(PreparedStatement pstmt, Object ... params)</span> &#123;</span><br><span class="line"><span class="comment">//å»ç©ºåˆ¤æ–­  è¯´æ˜æ²¡æœ‰å‚æ•°ç»™æˆ‘   ä¹Ÿå°±æ˜¯æ‰§è¡Œçš„SQLè¯­å¥ä¸­æ²¡æœ‰å ä½ç¬¦</span></span><br><span class="line"><span class="keyword">if</span>( <span class="literal">null</span> == params || params.length &lt;= <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æœ‰å‚æ•° åˆ™å¾ªç¯å‚æ•°  ç»™é¢„ç¼–è¯‘è¯­å¥å—ä¸­å ä½ç¬¦ èµ‹å€¼</span></span><br><span class="line"><span class="comment">//å…ˆè·å–å‚æ•°çš„é•¿åº¦  èŠ‚çœèµ„æº æé«˜æ€§èƒ½</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>, len = params.length; i &lt; len; i++) &#123;</span><br><span class="line"><span class="comment">//æˆ‘ä¸æ¸…æ¥šå ä½ç¬¦ å¯¹åº”çš„è¯¦ç»†æ•°æ®ç±»å‹    ä¸‡ç‰©çš†å¯¹è±¡</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">pstmt.setObject( i + <span class="number">1</span>, params[i]);<span class="comment">// % +v+ %</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="comment">//é¡¹ç›®å¯ä»¥ä½¿ç”¨æ—¥å¿—æ¥è®°å½•</span></span><br><span class="line">System.out.println(<span class="string">&quot;ç¬¬&quot;</span> + (i+<span class="number">1</span>) + <span class="string">&quot;ä¸ªå‚æ•°æ³¨å€¼å¤±è´¥...&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å•æ¡æŸ¥è¯¢ è¿”å›ä¸€æ¡è®°å½•   select * from userinfo where user_name = ? and user_pwd = ?</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sql  æŸ¥è¯¢SQL  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params æŸ¥è¯¢å‚æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> map  ä¸€æ¡è®°å½•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">findSingle</span><span class="params">(String sql, Object ... params)</span>&#123;</span><br><span class="line">Map&lt;String, Object&gt; map = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">conn = <span class="built_in">this</span>.getConn();<span class="comment">//è·å–è¿æ¥</span></span><br><span class="line">pstmt = conn.prepareStatement(sql);<span class="comment">//é¢„ç¼–è¯‘å¯¹è±¡è£…è½½SQL</span></span><br><span class="line"><span class="built_in">this</span>.setParams(pstmt, params);<span class="comment">//éœ€è¦ç»™å ä½ç¬¦æ³¨å…¥å‚æ•°</span></span><br><span class="line">rs = pstmt.executeQuery();<span class="comment">//æ‰§è¡Œæ›´æ–°è¯­å¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç°è·å–æ‰€æœ‰çš„åˆ—å</span></span><br><span class="line">List&lt;String&gt; columnNames = <span class="built_in">this</span>.getAllColumnNames(rs);</span><br><span class="line"><span class="keyword">if</span>( rs.next()) &#123; <span class="comment">//å¤„ç†ç»“æœé›†</span></span><br><span class="line">map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line"><span class="comment">//map.put(&quot;user_id&quot;, rs.getInt(&quot;user_id&quot;));</span></span><br><span class="line"><span class="comment">//map.put(&quot;user_name&quot;, rs.getString(&quot;user_name&quot;));</span></span><br><span class="line"><span class="comment">//map.put(&quot;user_pwd&quot;, rs.getString(&quot;user_pwd&quot;));</span></span><br><span class="line"><span class="comment">//å¦‚æœæ¢äº†æŸ¥è¯¢çš„è¡¨  è¿˜ä¼šæœ‰è¿™äº›åˆ—å—ï¼Ÿ  select * from emp; </span></span><br><span class="line"><span class="comment">//å¦‚ä½•æŸ¥è¯¢è¡¨æ‰€å¯¹åº”å„ä¸ªåˆ—çš„åç§°ï¼Ÿ  è¯·å»API å…ˆè¡ŒæŸ¥çœ‹ rs.getMetaData()</span></span><br><span class="line"></span><br><span class="line"><span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//åˆ—æ‰€å¯¹åº”çš„å€¼</span></span><br><span class="line"><span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;<span class="comment">//åˆ—æ‰€å¯¹åº”çš„å€¼çš„ç±»å‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¢å¼ºfor</span></span><br><span class="line"><span class="keyword">for</span>(String columnName : columnNames) &#123;</span><br><span class="line"><span class="comment">//åˆ—å¯¹åº”çš„ç±»å‹ä¸ç¡®å®š</span></span><br><span class="line"><span class="comment">//map.put(columnName, rs.getObject(columnName));</span></span><br><span class="line">value = rs.getObject(columnName);</span><br><span class="line"><span class="comment">//åˆ¤ç©º</span></span><br><span class="line"><span class="keyword">if</span>( <span class="literal">null</span> == value) &#123;</span><br><span class="line">map.put(columnName, value);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">type = value.getClass().getName(); <span class="comment">//è·å–ç±»å‹</span></span><br><span class="line"><span class="comment">//System.out.println(type); //oracle.sql.BLOB   java.math.BigDecimal</span></span><br><span class="line"><span class="comment">//åˆ¤æ–­ç±»å‹</span></span><br><span class="line"><span class="comment">//TODO å¦‚æœæ˜¯Blobç±»å‹ è¯¥æ€ä¹ˆåŠ ?  å›¾ç‰‡çš„å¤„ç†ï¼Ÿï¼Ÿ? æƒ³åŠæ³•è·å–å¯¹åº”çš„æ•°æ®ç±»å‹ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;oracle.sql.BLOB&quot;</span>.equals(type)) &#123;</span><br><span class="line"><span class="comment">//è·å–å¯¹åº”ç±»å‹æ•°æ®</span></span><br><span class="line"><span class="type">Blob</span> <span class="variable">blob</span> <span class="operator">=</span> rs.getBlob(columnName);</span><br><span class="line"><span class="comment">//è·å–å¯¹åº”äºŒè¿›åˆ¶æµæ“ä½œ</span></span><br><span class="line"><span class="keyword">try</span>(<span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> blob.getBinaryStream())&#123;</span><br><span class="line"><span class="type">byte</span> [] bt = <span class="keyword">new</span> <span class="title class_">byte</span>[ (<span class="type">int</span>)blob.length()];</span><br><span class="line">is.read(bt);</span><br><span class="line">map.put(columnName, bt);<span class="comment">//å­˜å…¥å­—èŠ‚æ•°ç»„</span></span><br><span class="line">&#125;<span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">map.put(columnName, value);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JDBC2.0 è·å–æ‰€æœ‰çš„åˆ—å</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> rs</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getAllColumnNames</span><span class="params">(ResultSet rs)</span>&#123;</span><br><span class="line"><span class="comment">//å­˜å‚¨åˆ—çš„é›†åˆ</span></span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//getMetaData() è·å–æ­¤ ResultSet å¯¹è±¡çš„åˆ—çš„ç¼–å·ã€ç±»å‹å’Œå±æ€§</span></span><br><span class="line"><span class="type">ResultSetMetaData</span> <span class="variable">rsmd</span> <span class="operator">=</span> rs.getMetaData();</span><br><span class="line"><span class="comment">//è·å–åˆ—çš„æ•°é‡</span></span><br><span class="line"><span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> rsmd.getColumnCount();</span><br><span class="line"><span class="comment">//åˆ—çš„èŒƒå›´ç¡®å®š å¾ªç¯</span></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= count; i++)&#123;</span><br><span class="line"><span class="comment">//è·å–å¯¹åº”åˆ—çš„åˆ—å</span></span><br><span class="line">list.add(rsmd.getColumnName(i).toLowerCase());</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤šè¡ŒæŸ¥è¯¢ è¿”å›å¤šæ¡  select * from emp; </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sql  æŸ¥è¯¢SQL  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params æŸ¥è¯¢å‚æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> list </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">findMultiple</span><span class="params">(String sql, Object ... params)</span>&#123;</span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Map&lt;String,Object&gt;&gt;();</span><br><span class="line">Map&lt;String, Object&gt; map = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">conn = <span class="built_in">this</span>.getConn();<span class="comment">//è·å–è¿æ¥</span></span><br><span class="line">pstmt = conn.prepareStatement(sql);<span class="comment">//é¢„ç¼–è¯‘å¯¹è±¡è£…è½½SQL</span></span><br><span class="line"><span class="built_in">this</span>.setParams(pstmt, params);<span class="comment">//éœ€è¦ç»™å ä½ç¬¦æ³¨å…¥å‚æ•°</span></span><br><span class="line">rs = pstmt.executeQuery();<span class="comment">//æ‰§è¡Œæ›´æ–°è¯­å¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç°è·å–æ‰€æœ‰çš„åˆ—å</span></span><br><span class="line">List&lt;String&gt; columnNames = <span class="built_in">this</span>.getAllColumnNames(rs);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>( rs.next()) &#123; <span class="comment">//å¤„ç†ç»“æœé›†</span></span><br><span class="line">map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line"><span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//åˆ—æ‰€å¯¹åº”çš„å€¼</span></span><br><span class="line"><span class="type">String</span> <span class="variable">type</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;<span class="comment">//åˆ—æ‰€å¯¹åº”çš„å€¼çš„ç±»å‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¢å¼ºfor</span></span><br><span class="line"><span class="keyword">for</span>(String columnName : columnNames) &#123;</span><br><span class="line"><span class="comment">//åˆ—å¯¹åº”çš„ç±»å‹ä¸ç¡®å®š</span></span><br><span class="line"><span class="comment">//map.put(columnName, rs.getObject(columnName));</span></span><br><span class="line">value = rs.getObject(columnName);</span><br><span class="line"><span class="comment">//åˆ¤ç©º</span></span><br><span class="line"><span class="keyword">if</span>( <span class="literal">null</span> == value) &#123;</span><br><span class="line">map.put(columnName, value);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">type = value.getClass().getName(); <span class="comment">//è·å–ç±»å‹</span></span><br><span class="line"><span class="comment">//System.out.println(type); //oracle.sql.BLOB   java.math.BigDecimal</span></span><br><span class="line"><span class="comment">//åˆ¤æ–­ç±»å‹</span></span><br><span class="line"><span class="comment">//TODO å¦‚æœæ˜¯Blobç±»å‹ è¯¥æ€ä¹ˆåŠ ?  å›¾ç‰‡çš„å¤„ç†ï¼Ÿï¼Ÿ? æƒ³åŠæ³•è·å–å¯¹åº”çš„æ•°æ®ç±»å‹ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;oracle.sql.BLOB&quot;</span>.equals(type)) &#123;</span><br><span class="line"><span class="comment">//è·å–å¯¹åº”ç±»å‹æ•°æ®</span></span><br><span class="line"><span class="type">Blob</span> <span class="variable">blob</span> <span class="operator">=</span> rs.getBlob(columnName);</span><br><span class="line"><span class="comment">//è·å–å¯¹åº”äºŒè¿›åˆ¶æµæ“ä½œ</span></span><br><span class="line"><span class="keyword">try</span>(<span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> blob.getBinaryStream())&#123;</span><br><span class="line"><span class="type">byte</span> [] bt = <span class="keyword">new</span> <span class="title class_">byte</span>[ (<span class="type">int</span>)blob.length()];</span><br><span class="line">is.read(bt);</span><br><span class="line">map.put(columnName, bt);<span class="comment">//å­˜å…¥å­—èŠ‚æ•°ç»„</span></span><br><span class="line">&#125;<span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">map.put(columnName, value);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">list.add(map);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  ä»¥å¯¹è±¡çš„æ–¹å¼ å°†å°†æŸ¥è¯¢ç»“æœè¿”å›</span></span><br><span class="line"><span class="comment"> *   c.newInstance() -&gt; new AdminInfo() </span></span><br><span class="line"><span class="comment"> *   m.invoke(obj, value)  æ¿€æ´»mæ–¹æ³•</span></span><br><span class="line"><span class="comment"> *   è·å–å½“å‰classå®ä¾‹ä¸­æ‰€æœ‰çš„æ–¹æ³•å’Œå±æ€§</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> c</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt; é™å®šç±»å‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sql  æŸ¥è¯¢SQL </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params æ³¨å…¥çš„å‚æ•° </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt;List&lt;T&gt; <span class="title function_">findMultiple</span><span class="params">(Class c,String sql, Object ... params)</span>&#123;</span><br><span class="line">List&lt;T&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;T&gt;();</span><br><span class="line">System.out.println(<span class="number">1111</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">conn = <span class="built_in">this</span>.getConn();<span class="comment">//è·å–è¿æ¥</span></span><br><span class="line">pstmt = conn.prepareStatement(sql);<span class="comment">//é¢„ç¼–è¯‘å¯¹è±¡è£…è½½SQL</span></span><br><span class="line"><span class="built_in">this</span>.setParams(pstmt, params);<span class="comment">//éœ€è¦ç»™å ä½ç¬¦æ³¨å…¥å‚æ•°</span></span><br><span class="line">rs = pstmt.executeQuery();<span class="comment">//æ‰§è¡Œæ›´æ–°è¯­å¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç°è·å–æ‰€æœ‰çš„åˆ—å</span></span><br><span class="line">List&lt;String&gt; columnNames = <span class="built_in">this</span>.getAllColumnNames(rs);</span><br><span class="line"></span><br><span class="line"><span class="type">T</span> <span class="variable">t</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//å£°æ˜ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//åˆ—æ‰€å¯¹åº”çš„å€¼</span></span><br><span class="line"><span class="type">String</span> <span class="variable">typeName</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;<span class="comment">//åˆ—æ‰€å¯¹åº”çš„å€¼çš„ç±»å‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//é€šè¿‡åå°„æ¥è·å–ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³• methods</span></span><br><span class="line">Method [] methods = c.getDeclaredMethods();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>( rs.next()) &#123; <span class="comment">//å¤„ç†ç»“æœé›†</span></span><br><span class="line"><span class="comment">//åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">t =  (T)c.newInstance();<span class="comment">//è°ƒç”¨æ— å‚æ•°çš„æ„é€ æ–¹æ³•  AdminInfo admin = new AdminInfo();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¢å¼ºfor  åˆ—</span></span><br><span class="line"><span class="keyword">for</span>(String columnName : columnNames) &#123;</span><br><span class="line"><span class="comment">//åˆ—å¯¹åº”çš„ç±»å‹ä¸ç¡®å®š</span></span><br><span class="line">value = rs.getObject(columnName);</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆ¤ç©º</span></span><br><span class="line"><span class="keyword">if</span>( <span class="literal">null</span> == value) &#123; <span class="comment">// æ•°æ®åº“æ— æ•°æ®</span></span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¾ªç¯ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">for</span>(Method method : methods) &#123;</span><br><span class="line"><span class="comment">//æ˜¯å¦æœ‰å¯¹åº”setXXX æ–¹æ³•å   set + columnName -&gt; methodçš„åå­—</span></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;set&quot;</span> + columnName;</span><br><span class="line"><span class="comment">//è·å–åˆ—å¯¹åº”å€¼çš„ç±»å‹</span></span><br><span class="line">typeName = value.getClass().getName();</span><br><span class="line"><span class="comment">//System.out.println( typeName );</span></span><br><span class="line"><span class="comment">//æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•å</span></span><br><span class="line"><span class="keyword">if</span>( name.equalsIgnoreCase( method.getName())) &#123;</span><br><span class="line"><span class="comment">//åˆ¤æ–­æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;java.math.BigDecimal&quot;</span>.equals(typeName)) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">method.invoke( t, rs.getDouble( columnName ));</span><br><span class="line">&#125;<span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">method.invoke( t, rs.getString( columnName ));</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;java.lang.String&quot;</span>.equals(typeName)) &#123;</span><br><span class="line">method.invoke( t, rs.getString( columnName ));</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;java.lang.Double&quot;</span>.equals(typeName)) &#123;</span><br><span class="line">method.invoke( t, rs.getDouble( columnName ));</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;java.lang.Integer&quot;</span>.equals(typeName)) &#123;</span><br><span class="line">method.invoke( t, rs.getInt( columnName ));</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;java.lang.Date&quot;</span>.equals(typeName)) &#123;</span><br><span class="line"><span class="comment">//MySQL ä¸­date æ•°æ®ç±»å‹ è½¬æ¢æˆJavaBean å¯¹è±¡ä¸­ä½¿ç”¨String </span></span><br><span class="line">method.invoke( t, rs.getString( columnName ));</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;oracle.sql.BLOB&quot;</span>.equals(typeName)) &#123;  <span class="comment">//TODO å¦‚æœæ˜¯Blobç±»å‹ è¯¥æ€ä¹ˆåŠ ?  å›¾ç‰‡çš„å¤„ç†ï¼Ÿï¼Ÿ? æƒ³åŠæ³•è·å–å¯¹åº”çš„æ•°æ®ç±»å‹ï¼Ÿ</span></span><br><span class="line"><span class="comment">//è·å–å¯¹åº”ç±»å‹æ•°æ®</span></span><br><span class="line"><span class="type">Blob</span> <span class="variable">blob</span> <span class="operator">=</span> rs.getBlob(columnName);</span><br><span class="line"><span class="comment">//è·å–å¯¹åº”äºŒè¿›åˆ¶æµæ“ä½œ</span></span><br><span class="line"><span class="keyword">try</span>(<span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> blob.getBinaryStream())&#123;</span><br><span class="line"><span class="type">byte</span> [] bt = <span class="keyword">new</span> <span class="title class_">byte</span>[ (<span class="type">int</span>)blob.length()];</span><br><span class="line">is.read(bt);</span><br><span class="line">method.invoke( t, bt);</span><br><span class="line">&#125;<span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;oracle.sql.CLOB&quot;</span>.equals(typeName))&#123;</span><br><span class="line"><span class="type">Reader</span> <span class="variable">in</span> <span class="operator">=</span> rs.getCharacterStream(columnName);</span><br><span class="line"><span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>( in );</span><br><span class="line"><span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> br.readLine();<span class="comment">//æ¯æ¬¡è¯»å–ä¸€è¡Œæ•°æ®</span></span><br><span class="line"><span class="keyword">while</span>( <span class="literal">null</span> != str ) &#123;</span><br><span class="line">sb.append( str );</span><br><span class="line">str = br.readLine();</span><br><span class="line">&#125;</span><br><span class="line">method.invoke( t, sb.toString());</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//TODO åæœŸéœ€è¦ è‡ªè¡Œæ‰©å±•</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">list.add(t); <span class="comment">//è®¾ç½®å¯¹è±¡åˆ°listé›†åˆä¸­</span></span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;<span class="keyword">catch</span> (InstantiationException | IllegalAccessException | IllegalArgumentException | InvocationTargetException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  ä»¥å¯¹è±¡çš„æ–¹å¼ å°†å°†æŸ¥è¯¢ç»“æœè¿”å›</span></span><br><span class="line"><span class="comment"> *   c.newInstance() -&gt; new AdminInfo() </span></span><br><span class="line"><span class="comment"> *   m.invoke(obj, value)  æ¿€æ´»mæ–¹æ³•</span></span><br><span class="line"><span class="comment"> *   è·å–å½“å‰classå®ä¾‹ä¸­æ‰€æœ‰çš„æ–¹æ³•å’Œå±æ€§</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> c</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt; é™å®šç±»å‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sql  æŸ¥è¯¢SQL </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params æ³¨å…¥çš„å‚æ•° </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; T <span class="title function_">findSingle</span><span class="params">(Class c,String sql, Object ... params)</span>&#123;</span><br><span class="line"><span class="type">T</span> <span class="variable">t</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//å£°æ˜ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">conn = <span class="built_in">this</span>.getConn();<span class="comment">//è·å–è¿æ¥</span></span><br><span class="line">pstmt = conn.prepareStatement(sql);<span class="comment">//é¢„ç¼–è¯‘å¯¹è±¡è£…è½½SQL</span></span><br><span class="line"><span class="built_in">this</span>.setParams(pstmt, params);<span class="comment">//éœ€è¦ç»™å ä½ç¬¦æ³¨å…¥å‚æ•°</span></span><br><span class="line">rs = pstmt.executeQuery();<span class="comment">//æ‰§è¡Œæ›´æ–°è¯­å¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç°è·å–æ‰€æœ‰çš„åˆ—å</span></span><br><span class="line">List&lt;String&gt; columnNames = <span class="built_in">this</span>.getAllColumnNames(rs);</span><br><span class="line"></span><br><span class="line"><span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> <span class="literal">null</span>;<span class="comment">//åˆ—æ‰€å¯¹åº”çš„å€¼</span></span><br><span class="line"><span class="type">String</span> <span class="variable">typeName</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;<span class="comment">//åˆ—æ‰€å¯¹åº”çš„å€¼çš„ç±»å‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//é€šè¿‡åå°„æ¥è·å–ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³• methods</span></span><br><span class="line">Method [] methods = c.getDeclaredMethods();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( rs.next()) &#123; <span class="comment">//å¤„ç†ç»“æœé›†</span></span><br><span class="line"><span class="comment">//åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">t =  (T)c.newInstance();<span class="comment">//è°ƒç”¨æ— å‚æ•°çš„æ„é€ æ–¹æ³•  AdminInfo admin = new AdminInfo();</span></span><br><span class="line"><span class="comment">//å¢å¼ºfor  åˆ—</span></span><br><span class="line"><span class="keyword">for</span>(String columnName : columnNames) &#123;</span><br><span class="line"><span class="comment">//åˆ—å¯¹åº”çš„ç±»å‹ä¸ç¡®å®š</span></span><br><span class="line">value = rs.getObject(columnName);</span><br><span class="line"><span class="comment">//åˆ¤ç©º</span></span><br><span class="line"><span class="keyword">if</span>( <span class="literal">null</span> == value) &#123; <span class="comment">// æ•°æ®åº“æ— æ•°æ®</span></span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¾ªç¯ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">for</span>(Method method : methods) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ˜¯å¦æœ‰å¯¹åº”setXXX æ–¹æ³•å   set + columnName -&gt; methodçš„åå­—</span></span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;set&quot;</span> + columnName;</span><br><span class="line"><span class="comment">//è·å–åˆ—å¯¹åº”å€¼çš„ç±»å‹</span></span><br><span class="line">typeName = value.getClass().getName();</span><br><span class="line"><span class="comment">//System.out.println( name + &quot;--&quot; + typeName );</span></span><br><span class="line"><span class="comment">//æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•å</span></span><br><span class="line"><span class="keyword">if</span>( name.equalsIgnoreCase( method.getName())) &#123;</span><br><span class="line"><span class="comment">//åˆ¤æ–­æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;java.math.BigDecimal&quot;</span>.equals(typeName)) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">method.invoke( t, rs.getDouble( columnName ));</span><br><span class="line">&#125;<span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">method.invoke( t, rs.getString( columnName ));</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;java.lang.String&quot;</span>.equals(typeName)) &#123;</span><br><span class="line">method.invoke( t, rs.getString( columnName ));</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;java.lang.Double&quot;</span>.equals(typeName)) &#123;</span><br><span class="line">method.invoke( t, rs.getDouble( columnName ));</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;java.lang.Integer&quot;</span>.equals(typeName)) &#123;</span><br><span class="line">method.invoke( t, rs.getInt( columnName ));</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;java.lang.Date&quot;</span>.equals(typeName)) &#123;</span><br><span class="line"><span class="comment">//MySQL ä¸­date æ•°æ®ç±»å‹ è½¬æ¢æˆJavaBean å¯¹è±¡ä¸­ä½¿ç”¨String </span></span><br><span class="line">method.invoke( t, rs.getString( columnName ));</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;oracle.sql.BLOB&quot;</span>.equals(typeName)) &#123;  <span class="comment">//TODO å¦‚æœæ˜¯Blobç±»å‹ è¯¥æ€ä¹ˆåŠ ?  å›¾ç‰‡çš„å¤„ç†ï¼Ÿï¼Ÿ? æƒ³åŠæ³•è·å–å¯¹åº”çš„æ•°æ®ç±»å‹ï¼Ÿ</span></span><br><span class="line"><span class="comment">//è·å–å¯¹åº”ç±»å‹æ•°æ®</span></span><br><span class="line"><span class="type">Blob</span> <span class="variable">blob</span> <span class="operator">=</span> rs.getBlob(columnName);</span><br><span class="line"><span class="comment">//è·å–å¯¹åº”äºŒè¿›åˆ¶æµæ“ä½œ</span></span><br><span class="line"><span class="keyword">try</span>(<span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> blob.getBinaryStream())&#123;</span><br><span class="line"><span class="type">byte</span> [] bt = <span class="keyword">new</span> <span class="title class_">byte</span>[ (<span class="type">int</span>)blob.length()];</span><br><span class="line">is.read(bt);</span><br><span class="line">method.invoke( t, bt);</span><br><span class="line">&#125;<span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;oracle.sql.CLOB&quot;</span>.equals(typeName))&#123;</span><br><span class="line"><span class="type">Reader</span> <span class="variable">in</span> <span class="operator">=</span> rs.getCharacterStream(columnName);</span><br><span class="line"><span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>( in );</span><br><span class="line"><span class="type">StringBuffer</span> <span class="variable">sb</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> br.readLine();<span class="comment">//æ¯æ¬¡è¯»å–ä¸€è¡Œæ•°æ®</span></span><br><span class="line"><span class="keyword">while</span>( <span class="literal">null</span> != str ) &#123;</span><br><span class="line">sb.append( str );</span><br><span class="line">str = br.readLine();</span><br><span class="line">&#125;</span><br><span class="line">method.invoke( t, sb.toString());</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//TODO åæœŸéœ€è¦ è‡ªè¡Œæ‰©å±•</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;<span class="keyword">catch</span> (InstantiationException | IllegalAccessException | IllegalArgumentException | InvocationTargetException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">total</span><span class="params">(String sql,Object...params)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">conn = <span class="built_in">this</span>.getConn();</span><br><span class="line">pstmt = conn.prepareStatement(sql);</span><br><span class="line"><span class="comment">//è®¾ç½®å‚æ•°</span></span><br><span class="line">setParams(pstmt,params);</span><br><span class="line"><span class="comment">//æ‰§è¡Œè¯­å¥å—</span></span><br><span class="line">rs= pstmt.executeQuery();</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¤„ç†ç»“æœé›†</span></span><br><span class="line"><span class="keyword">if</span>(rs.next()) &#123;</span><br><span class="line">result = rs.getInt(<span class="number">1</span>);<span class="comment">//åˆ—ç´¢å¼•ç¬¬ä¸€åˆ—</span></span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.closeAll(rs, pstmt, conn);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å·¥å…·ç±»ï¼ˆmysql-ä¹Ÿæ˜¯å•ä¾‹ï¼‰">å·¥å…·ç±»ï¼ˆmysql,ä¹Ÿæ˜¯å•ä¾‹ï¼‰</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReadConfig</span> <span class="keyword">extends</span> <span class="title class_">Properties</span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1560020482133144083L</span>;</span><br><span class="line"><span class="comment">//é¥¿æ±‰å•ä¾‹   æå‰å®ä¾‹åŒ–å¯¹ï¿½?</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">ReadConfig</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReadConfig</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ„é€ æ–¹æ³•ç§æœ‰åŒ–  </span></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">ReadConfig</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//æƒ³åŠæ³•è¯»å–è‡ªå·±çš„é…ç½®æ–‡ä»¶   </span></span><br><span class="line"><span class="comment">//JDK1.7 ä¼šè‡ªåŠ¨å…³é—­ä¸”ï¿½?å®šå…³é—­èµ„ï¿½?   try - with -resources</span></span><br><span class="line"><span class="keyword">try</span>(<span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="built_in">this</span>.getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;db.properties&quot;</span>))&#123;</span><br><span class="line"><span class="comment">//ä¸šåŠ¡ä»£ç   æµå¤„ï¿½? </span></span><br><span class="line"><span class="built_in">this</span>.load(is); <span class="comment">//è¯»å–é…ç½®æ–‡ä»¶</span></span><br><span class="line">&#125;<span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å› ä¸ºæ„ï¿½?ï¿½ç§æœ‰åŒ–å°±æ„å‘³ç€å¤–éƒ¨æ— æ³•å®ä¾‹åŒ–è¯¥å¯¹è±¡ å¿…é¡»å¯¹å¤–æä¾›ï¿½?ä¸ªè·å–å®ä¾‹çš„æ–¹æ³•  å¹¶åœ¨å†…éƒ¨æå‰å®ä¾‹ï¿½? </span></span><br><span class="line"><span class="comment">//åˆå› ä¸ºå¤–éƒ¨æ— æ³•æ˜¯å®ä¾‹ï¿½? åªèƒ½é€šè¿‡ç±»åæ–¹æ³• è¯¥æ–¹ï¿½? ï¿½?å£°æ˜ä¸ºé™æ€çš„ </span></span><br><span class="line"><span class="keyword">public</span>  <span class="keyword">static</span> ReadConfig <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="db-properties-2">db.properties</h5><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#MySQL5</span></span><br><span class="line"><span class="comment">#driverClassName=com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="comment">#url=jdbc:mysql://localhost:3306/blog</span></span><br><span class="line"><span class="comment">#user=root</span></span><br><span class="line"><span class="comment">#password=a</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#MySQL8</span></span><br><span class="line"><span class="attr">driverClassName</span>=com.mysql.cj.jdbc.Driver</span><br><span class="line"></span><br><span class="line"><span class="attr">url</span>=jdbc:mysql://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">3306</span>/æ•°æ®åº“?useOldAliasMetadataBehavior=<span class="literal">true</span>&amp;useSSL=<span class="literal">false</span>&amp;useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf8&amp;serverTimezone=GMT%<span class="number">2</span>B8</span><br><span class="line"><span class="attr">user</span>=root</span><br><span class="line"><span class="attr">password</span>=a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#Oracle</span></span><br><span class="line"><span class="comment">#driverClassName=oracle.jdbc.driver.OracleDriver</span></span><br><span class="line"><span class="comment">#url=jdbc:oracle:thin:@localhost:1521:orcl</span></span><br><span class="line"><span class="comment">#user=scott</span></span><br><span class="line"><span class="comment">#password=a</span></span><br></pre></td></tr></table></figure><h4 id="SQLæ³¨å…¥">SQLæ³¨å…¥</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminInfoDAOImpl</span> <span class="keyword">implements</span> <span class="title class_">IAdminInfoDAO</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> AdminInfo <span class="title function_">login</span><span class="params">(String aname, String pwd)</span> &#123;</span><br><span class="line">         <span class="type">DBHelper</span> <span class="variable">db</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DBHelper</span>();</span><br><span class="line">         <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from admininfo where aname = ? and pwd = md5(?)&quot;</span>;</span><br><span class="line">         <span class="keyword">return</span> db.findSingle(AdminInfo.class,sql,aname,pwd);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(String aname, String pwd, String photo)</span> &#123;</span><br><span class="line"><span class="type">DBHelper</span> <span class="variable">db</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DBHelper</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into admininfo value(0,?,md5(?),?)&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> db.update(sql, aname,pwd,photo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é»˜è®¤ä¸æŸ¥è¯¢å¯†ç  å¦‚æœéœ€è¦æŸ¥è¯¢ å°†æ¥ç•Œé¢æ¸²æŸ“å¯†ç   å¿…é¡»æ‘˜ç æ˜¾ç¤º 123456 -&gt; 1***6</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;AdminInfo&gt; <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">DBHelper</span> <span class="variable">db</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DBHelper</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select aid,aname,photo from admininfo order by aid desc&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> db.findMultiple(AdminInfo.class, sql);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>==sqlæ³¨å…¥æ¼æ´ä¹Ÿå°±æ˜¯sqlæ‹¼æ¥==</p><p>PreparedStatementï¼šå¯ä»¥é¢„é˜²SQLæ³¨å…¥</p><p>ä¸Šè¿°æˆ‘ä»¬ä½¿ç”¨çš„å·¥å…·ç±»å°±æ˜¯ä½¿ç”¨PreparedStatementæ¥çš„ã€‚</p><p>äº‹åŠ¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ›´æ–°æ“ä½œ   Object ... params  ä¸å®šå‚æ•°   ç±»ä¼¼äºæ•°ç»„  ä¸‡ç‰©çš†å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sql  è¦æ‰§è¡Œçš„æ›´æ–°è¯­å¥   å¯ä»¥ insert update delete </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params è¦æ‰§è¡Œçš„SQLè¯­å¥ä¸­çš„å ä½ç¬¦ï¼Ÿ æ‰€å¯¹åº”å‚æ•°çš„å€¼ </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(String sql, Object ... params)</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> -<span class="number">1</span>;<span class="comment">//å®šä¹‰é»˜è®¤çš„èŒƒå›´å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">conn = <span class="built_in">this</span>.getConn();<span class="comment">//è·å–è¿æ¥</span></span><br><span class="line"><span class="comment">//å¼€å¯äº‹åŠ¡   conn.setAutoCommit(false);</span></span><br><span class="line">pstmt = conn.prepareStatement(sql);<span class="comment">//é¢„ç¼–è¯‘å¯¹è±¡è£…è½½SQL</span></span><br><span class="line"><span class="built_in">this</span>.setParams(pstmt, params);<span class="comment">//éœ€è¦ç»™å ä½ç¬¦æ³¨å…¥å‚æ•°</span></span><br><span class="line">result = pstmt.executeUpdate();<span class="comment">//æ‰§è¡Œæ›´æ–°è¯­å¥</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//äº‹åŠ¡æäº¤conn.commit();</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line"><span class="comment">//å¦‚æœå¤±è´¥äº‹åŠ¡æäº¤å¤±è´¥åˆ™å›æ»š</span></span><br><span class="line"><span class="comment">/*try &#123;</span></span><br><span class="line"><span class="comment">conn.rollback();</span></span><br><span class="line"><span class="comment">&#125;catch(SQLException e)&#123;</span></span><br><span class="line"><span class="comment">e.printStackTrace();</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®åº“é“¾æ¥æ± ï¼Œæ± åŒ–æŠ€æœ¯">æ•°æ®åº“é“¾æ¥æ± ï¼Œæ± åŒ–æŠ€æœ¯</h3><p>æ•°æ®åº“é“¾æ¥â€“æ‰§è¡Œå®Œæ¯•â€“é‡Šæ”¾</p><p>è¿æ¥â€“é‡Šæ”¾ååˆ†æµªè´¹èµ„æº</p><p>æ± åŒ–æŠ€æœ¯ï¼š</p><p>å‡†å¤‡ä¸€äº›é¢„å…ˆçš„èµ„æºï¼Œè¿‡æ¥å°±è¿æ¥é¢„å…ˆå‡†å¤‡å¥½çš„</p><p>éœ€è¦çš„åŒ…ä¸‹è½½ï¼š<a href="https://blog.csdn.net/qq_51178489/article/details/118805942">https://blog.csdn.net/qq_51178489/article/details/118805942</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.mchange.v2.c3p0.ComboPooledDataSource;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.dbcp2.BasicDataSourceFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCUtils_C3P0</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DataSource dataSource=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//xmlæ•°æ®æºç›´æ¥åŠ è½½ä¸ç”¨åå°„</span></span><br><span class="line"><span class="comment">//            dataSource= new ComboPooledDataSource();     //æ— å‚æ•°æ—¶ç”¨é»˜è®¤æ•°æ®æº</span></span><br><span class="line">            dataSource=<span class="keyword">new</span> <span class="title class_">ComboPooledDataSource</span>(<span class="string">&quot;MySQL&quot;</span>); <span class="comment">//ç”¨é…ç½®name=&quot;MySQL&quot;çš„æ•°æ®æº   ä¹Ÿå¯ä»¥datasource.setMaxPoolSize();ç­‰</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;     <span class="comment">//æä¾›è¿æ¥</span></span><br><span class="line">        <span class="keyword">return</span> dataSource.getConnection();         <span class="comment">//æ•°æ®æºä¸­è·å–è¿æ¥ï¼Œè‡ªåŠ¨è£…å¥½å‚æ•°æ¯”å¦‚è´¦å·å¯†ç url</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">release</span><span class="params">(Connection con, PreparedStatement st, ResultSet re)</span>&#123;   <span class="comment">//æä¾›å…³é—­</span></span><br><span class="line">        <span class="keyword">if</span>(re!=<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                re.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(st!=<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                st.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(con!=<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                con.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c3p0-config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é»˜è®¤é…ç½®ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šåˆ™ä½¿ç”¨è¿™ä¸ªé…ç½® --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default-config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>a<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span>&gt;</span>jdbc:mysql://localhost:3306/school<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;checkoutTimeout&quot;</span>&gt;</span>30000<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;idleConnectionTestPeriod&quot;</span>&gt;</span>30<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialPoolSize&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdleTime&quot;</span>&gt;</span>30<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxPoolSize&quot;</span>&gt;</span>100<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minPoolSize&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxStatements&quot;</span>&gt;</span>200<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">default-config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å‘½åçš„é…ç½®,å¯ä»¥é€šè¿‡æ–¹æ³•è°ƒç”¨å®ç° --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">named-config</span> <span class="attr">name</span>=<span class="string">&quot;MySQL&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span>&gt;</span>jdbc:mysql://localhost:3306/school<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¦‚æœæ± ä¸­æ•°æ®è¿æ¥ä¸å¤Ÿæ—¶ä¸€æ¬¡å¢é•¿å¤šå°‘ä¸ª --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;acquireIncrement&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- åˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± æ—¶è¿æ¥çš„æ•°é‡ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialPoolSize&quot;</span>&gt;</span>20<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ•°æ®åº“è¿æ¥æ± ä¸­çš„æœ€å¤§çš„æ•°æ®åº“è¿æ¥æ•° --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxPoolSize&quot;</span>&gt;</span>25<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ•°æ®åº“è¿æ¥æ± ä¸­çš„æœ€å°çš„æ•°æ®åº“è¿æ¥æ•° --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minPoolSize&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">named-config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c3p0-config</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">åšä¸»å¯¹mySQLåˆæ­¥å­¦ä¹ çš„äº†è§£ï¼Œæš‚æ—¶æ²¡æœ‰æ·±å…¥äº†è§£ï¼Œæœ¬æ–‡å°†ä¼šæŒç»­è·Ÿæ–°ï¼Œå¹¶ä»¥å¤šæ–‡æ¡£è¿›è¡Œï¼Œç¼–ç¨‹ä¹‹è·¯å¾ˆé•¿å¾ˆé•¿ï¼Œæˆ‘å¾—å­¦ä¼šè¾¹èµ°è¾¹çœ‹çœ‹é£æ™¯</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://luoxiaohei520.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://luoxiaohei520.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>JavaJUCå­¦ä¹ ç¯‡</title>
    <link href="https://luoxiaohei520.github.io/posts/e45e7a2d.html"/>
    <id>https://luoxiaohei520.github.io/posts/e45e7a2d.html</id>
    <published>2023-11-09T02:50:23.335Z</published>
    <updated>2023-11-09T02:50:23.335Z</updated>
    
    <content type="html"><![CDATA[<h1>JavaJUCå­¦ä¹ ç¯‡</h1><h4 id="ä»€ä¹ˆæ˜¯JUC">ä»€ä¹ˆæ˜¯JUC</h4><p>java.util å·¥å…·åŒ…ã€åŒ…ã€åˆ†ç±»</p><h4 id="çº¿ç¨‹å’Œè¿›ç¨‹">çº¿ç¨‹å’Œè¿›ç¨‹</h4><p>è¿›ç¨‹ï¼šä¸€ä¸ªç¨‹åºï¼Œæ¯”å¦‚qq,é…·æˆ‘éŸ³ä¹å•¥çš„ä¸€ä¸ªè¿›ç¨‹å¾€å¾€åŒ…å«ä¸€ä¸ªå¤šä¸ªçº¿ç¨‹ã€‚</p><p>çº¿ç¨‹ï¼šjavaé»˜è®¤ä¸¤ä¸ªçº¿ç¨‹ä¸€ä¸ªmainï¼Œä¸€ä¸ªGC</p><p>javaçº¿ç¨‹å®ç°çš„æ–¹å¼ï¼š</p><p>ç»§æ‰¿Threadï¼Œå®ç°Runnableæ¥å£ï¼Œå®ç°callable</p><h4 id="å¹¶è¡Œå’Œå¹¶å‘">å¹¶è¡Œå’Œå¹¶å‘</h4><p>å¹¶è¡Œï¼šå¤šçº¿ç¨‹æ“ä½œå¤„ç†åŒä¸€ä¸ªèµ„æºï¼Œæˆ–è€…è¯´å¤šä¸ªäººå®ŒæˆåŒä¸€ä»¶äº‹æƒ…</p><p>å¹¶å‘ï¼šä¸ºäº†è¾¾åˆ°æŸä»¶äº‹ï¼Œæ¯ä¸ªäººè´Ÿè´£ä¸åŒçš„æ¨¡å—ç„¶åå®Œæˆäº‹æƒ…ã€‚</p><h4 id="çº¿ç¨‹çš„çŠ¶æ€ï¼š">çº¿ç¨‹çš„çŠ¶æ€ï¼š</h4><p>åˆ›å»º  --ã€‹ å°±ç»ª --ã€‹ è¿è¡Œ --ã€‹é˜»å¡  --&gt;æ­»äº¡</p><p>ï¼ˆæˆ‘ä»¬é€šå¸¸åˆ†ä¸ºäº”ç§ï¼Œä½†æ˜¯æœ‰äº›æƒ…å†µä¸‹åˆ†ä¸º7ç§ï¼ŒåŠ çš„ä¸¤ç§ä¸ºç­‰å¾…å’Œè¶…æ—¶ç­‰å¾…ï¼‰</p><h4 id="waitå’Œsleepçš„åŒºåˆ«">waitå’Œsleepçš„åŒºåˆ«</h4><p>é¦–å…ˆï¼š</p><p>waitæ¥è‡ªObject</p><p>sleepæ¥è‡ªThread</p><p>å…¶æ¬¡ï¼š</p><p>waitä¼šé‡Šæ”¾é”</p><p>sleepä¸ä¼š</p><p>ä½¿ç”¨èŒƒå›´ä¸ä¸€æ ·ï¼š</p><p>waitå¿…é¡»æ”¾åˆ°åŒæ­¥å—ä¸­</p><p>sleepæ²¡æœ‰è¦æ±‚</p><h4 id="Lockå’ŒSynchonized">Lockå’ŒSynchonized</h4><p><strong>ä¼ ç»Ÿçš„synchonizedé”</strong></p><p>synchonizedï¼ˆï¼‰{</p><p>}</p><p>æ‹¬å·é‡Œè¾¹ä¸€èˆ¬ä¸¤ç§</p><p>1å¯¹è±¡</p><p>2ç±»å.class</p><p>è¿˜æœ‰ private synchonized void name(){}</p><p><strong>Lockæ¥å£</strong></p><p>ReentrantLockï¼š å¯é‡ç”¨é”</p><p>readLock: è¯»é”</p><p>writeLock:å†™é”</p><p><strong>Synchronized å’Œ Lock åŒºåˆ«</strong></p><p>1ã€Synchronized å†…ç½®çš„Javaå…³é”®å­—ï¼Œ Lock æ˜¯ä¸€ä¸ªJavaç±»</p><p>2ã€Synchronized æ— æ³•åˆ¤æ–­è·å–é”çš„çŠ¶æ€ï¼ŒLock å¯ä»¥åˆ¤æ–­æ˜¯å¦è·å–åˆ°äº†é”</p><p>3ã€Synchronized ä¼šè‡ªåŠ¨é‡Šæ”¾é”ï¼Œlock å¿…é¡»è¦æ‰‹åŠ¨é‡Šæ”¾é”ï¼å¦‚æœä¸é‡Šæ”¾é”ï¼Œæ­»é”</p><p>4ã€Synchronized çº¿ç¨‹ 1ï¼ˆè·å¾—é”ï¼Œé˜»å¡ï¼‰ã€çº¿ç¨‹2ï¼ˆç­‰å¾…ï¼Œå‚»å‚»çš„ç­‰ï¼‰ï¼›Locké”å°±ä¸ä¸€å®šä¼šç­‰å¾…ä¸‹</p><p>å»ï¼›</p><p>5ã€Synchronized å¯é‡å…¥é”ï¼Œä¸å¯ä»¥ä¸­æ–­çš„ï¼Œéå…¬å¹³ï¼›Lock ï¼Œå¯é‡å…¥é”ï¼Œå¯ä»¥ åˆ¤æ–­é”ï¼Œéå…¬å¹³ï¼ˆå¯ä»¥</p><p>è‡ªå·±è®¾ç½®ï¼‰ï¼›</p><p>6ã€Synchronized é€‚åˆé”å°‘é‡çš„ä»£ç åŒæ­¥é—®é¢˜ï¼ŒLock é€‚åˆé”å¤§é‡çš„åŒæ­¥ä»£ç ï¼</p><h4 id="ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜">ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜</h4><blockquote><p>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜Synchronizedç‰ˆ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xh.juc.day02;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Title</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>  ç½—å°é»‘</span></span><br><span class="line"><span class="comment"> * çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡é—®é¢˜ï¼Œå¸¸ç”¨çš„æ˜¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜ã€‚ ç­‰å¾…å”¤é†’ï¼Œé€šçŸ¥å”¤é†’ã€‚</span></span><br><span class="line"><span class="comment"> * çº¿ç¨‹äº¤æ›¿æ‰§è¡Œ A Bæ“ä½œåŒä¸€ä¸ªå˜é‡ num = 0;</span></span><br><span class="line"><span class="comment"> * A num + 1</span></span><br><span class="line"><span class="comment"> * B num  - 1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/10/2 16:29</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@email</span> 2844135670@qq.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    date.increment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    date.decrement();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿäº§è€…æ¶ˆè´¹è€…ï¼š åˆ¤æ–­ç­‰å¾… ï¼Œä¸šåŠ¡ ï¼Œ é€šçŸ¥</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Date</span>&#123;</span><br><span class="line">    <span class="comment">//æ•°å­—èµ„æºé”</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span>  <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">if</span>(number != <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//ç­‰å¾…</span></span><br><span class="line">            <span class="built_in">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//é€šçŸ¥å…¶ä»–çº¿ç¨‹æˆ‘åŠ 1å®Œæ¯•äº†</span></span><br><span class="line">        number ++ ;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;=&gt;&quot;</span> +number);</span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span>  <span class="keyword">void</span>  <span class="title function_">decrement</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">if</span>(number == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//ç­‰å¾…</span></span><br><span class="line">            <span class="built_in">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        number --;</span><br><span class="line">        <span class="comment">//é€šçŸ¥å…¶ä»–çº¿ç¨‹æˆ‘-1å®Œæ¯•äº†</span></span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;=&gt;&quot;</span> +number);</span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ï¼šä¸¤ä¸ªè¿˜å¥½ï¼Œä½†æ˜¯åˆ°äº†ä¸‰ä¸ªæˆ–è€…å››ä¸ªå°±ä¼šäº§ç”Ÿé—®é¢˜</p><p>é¢è¯•å¸¸é—®ï¼š å•ä¾‹æ¨¡å¼ï¼Œæ’åºç®—æ³•ï¼Œç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ï¼Œæ­»é”</p><p>é—®é¢˜å­˜åœ¨ï¼šA,B,C,Då››ä¸ªçº¿ç¨‹çš„æƒ…å†µä¸‹å‡ºç°é—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºçº¿ç¨‹Aè¿›è¡ŒåŠ </span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    date.increment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    date.increment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    date.decrement();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;C&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    date.decrement();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;D&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>A=&gt;1<br>C=&gt;0<br>B=&gt;1<br>A=&gt;2<br>B=&gt;3<br>C=&gt;2<br>C=&gt;1<br>C=&gt;0<br>B=&gt;1<br>A=&gt;2<br>B=&gt;3<br>C=&gt;2<br>B=&gt;3<br>A=&gt;4<br>D=&gt;3<br>D=&gt;2<br>D=&gt;1<br>D=&gt;0<br>A=&gt;1<br>D=&gt;0</p></blockquote><p>ä»¥ä¸ŠåŸå› æ˜¯ç”±äºçº¿ç¨‹äº§ç”Ÿäº†è™šå‡å”¤é†’ï¼Œå¯¼è‡´å‡ºç°é—®é¢˜ã€‚</p><p>==è§£å†³åŠæ³•ï¼Œæˆ‘ä»¬å°†ifæ”¹æˆwhileåˆ¤æ–­==</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Date1</span>&#123;</span><br><span class="line">    <span class="comment">//æ•°å­—èµ„æºé”</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span>  <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span>(number != <span class="number">0</span>)&#123;<span class="comment">//ifæ”¹æˆwhileè§£å†³çº¿ç¨‹è™šæ‹Ÿå”¤é†’</span></span><br><span class="line">            <span class="comment">//ç­‰å¾…</span></span><br><span class="line">            <span class="built_in">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//é€šçŸ¥å…¶ä»–çº¿ç¨‹æˆ‘åŠ 1å®Œæ¯•äº†</span></span><br><span class="line">        number ++ ;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;=&gt;&quot;</span> +number);</span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span>  <span class="keyword">void</span>  <span class="title function_">decrement</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span>(number == <span class="number">0</span>)&#123;<span class="comment">//æ”¹æˆwhileè§£å†³çº¿ç¨‹è™šæ‹Ÿå”¤é†’</span></span><br><span class="line">            <span class="comment">//ç­‰å¾…</span></span><br><span class="line">            <span class="built_in">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        number --;</span><br><span class="line">        <span class="comment">//é€šçŸ¥å…¶ä»–çº¿ç¨‹æˆ‘-1å®Œæ¯•äº†</span></span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;=&gt;&quot;</span> +number);</span><br><span class="line">        <span class="built_in">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>Lockè§£å†³ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é—®é¢˜JUCç‰ˆæœ¬çš„</p></blockquote><p>åŸºæœ¬å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">C</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Data</span> <span class="variable">data</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Data</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    data.increment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    data.increment();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    data.decrement();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;C&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    data.decrement();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;D&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span>  <span class="title class_">Data</span>&#123;</span><br><span class="line">    <span class="keyword">private</span>  <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="type">Condition</span> <span class="variable">condition</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åŠ ä¸€æ“ä½œ</span></span><br><span class="line">    <span class="comment">/*  condition.await();//ç­‰å¾…ç›¸å½“äºwait</span></span><br><span class="line"><span class="comment">        condition.signalAll();//å”¤é†’å…¨éƒ¨*/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span> <span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">while</span>(number != <span class="number">0</span>)&#123;</span><br><span class="line">                condition.await();</span><br><span class="line">            &#125;</span><br><span class="line">            number ++;</span><br><span class="line"></span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;=&gt;&quot;</span>+ number);</span><br><span class="line">            condition.signalAll();</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‡ä¸€æ“ä½œ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrement</span> <span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">while</span> (number == <span class="number">0</span>) &#123;</span><br><span class="line">                condition.await();</span><br><span class="line">            &#125;</span><br><span class="line">            number--;</span><br><span class="line"></span><br><span class="line">            System.out.println(Thread.currentThread().getName() +<span class="string">&quot;=&gt;&quot;</span>+ number);</span><br><span class="line">            condition.signalAll();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>ä»»ä½•ä¸€ä¸ªæ–°çš„æŠ€æœ¯ç»å¯¹ä¸æ˜¯ä»…ä»…è¦†ç›–äº†ä¸€èµ·çš„æŠ€æœ¯ï¼Œä¸€å®šä¼šåœ¨åŸæ¥çš„æŠ€æœ¯ä¸Šè¿›è¡Œç›¸åº”çš„æ‹“å±•</p></blockquote><p>Condtionå®ç°ç²¾å‡†å”¤é†’</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">D</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Data2</span> <span class="variable">data2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Data2</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                data2.printA();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;A&quot;</span>).start();;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                data2.printB();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                data2.printC();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;C&quot;</span>).start();;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Data2</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">//1A 2B 3C</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition1</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition2</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printA</span><span class="params">()</span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//ä¸šåŠ¡ï¼Œåˆ¤æ–­ -&gt;æ‰§è¡Œ -&gt;é€šçŸ¥</span></span><br><span class="line">            <span class="keyword">while</span>(number != <span class="number">1</span>)&#123;</span><br><span class="line">                <span class="comment">//ç­‰å¾…</span></span><br><span class="line">                condition.await();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+ <span class="string">&quot;==&gt;AA&quot;</span> );</span><br><span class="line">            number = <span class="number">2</span>;</span><br><span class="line">            condition1.signal();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printB</span><span class="params">()</span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//ä¸šåŠ¡ï¼Œåˆ¤æ–­ -&gt;æ‰§è¡Œ -&gt;é€šçŸ¥</span></span><br><span class="line">            <span class="keyword">while</span> ( number != <span class="number">2</span>)&#123;</span><br><span class="line">                condition1.await();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+ <span class="string">&quot;==&gt;BB&quot;</span>);</span><br><span class="line">            number = <span class="number">3</span>;</span><br><span class="line">            condition2.signal();</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printC</span><span class="params">()</span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//ä¸šåŠ¡ï¼Œåˆ¤æ–­ -&gt;æ‰§è¡Œ -&gt;é€šçŸ¥</span></span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">3</span>)&#123;</span><br><span class="line">                condition2.await();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;==&gt;CC&quot;</span>);</span><br><span class="line">            number =<span class="number">1</span>;</span><br><span class="line">            condition.signal();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä»€ä¹ˆæ˜¯é”ï¼Œå¦‚ä½•åˆ¤æ–­é”å¯¹è±¡ï¼ˆ8ç§é”ï¼‰ï¼š">ä»€ä¹ˆæ˜¯é”ï¼Œå¦‚ä½•åˆ¤æ–­é”å¯¹è±¡ï¼ˆ8ç§é”ï¼‰ï¼š</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Phone</span> <span class="variable">phone</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">Phone</span>();</span><br><span class="line">        <span class="comment">//å¹¶ä¸æ˜¯è°å…ˆè°åï¼Œè€Œæ˜¯ç”±äºé”çš„å­˜åœ¨ï¼Œè°å…ˆæ‹¿åˆ°è°æ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                phone.sendSms();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);<span class="comment">//ä¼‘çœ ä¸€ç§’ï¼Œæ¯”è¾ƒè°å¿«</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            phone.sendTel();</span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Phone</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span>  <span class="keyword">void</span> <span class="title function_">sendSms</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘çŸ­ä¿¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span>  <span class="keyword">void</span> <span class="title function_">sendTel</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰“ç”µè¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½ æŒæœ‰ä¸€æŠŠé”ï¼Œæ•…è€Œæœ‰ä¸¤æŠŠé”</span></span><br><span class="line">        <span class="type">Phone2</span> <span class="variable">phone2</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">Phone2</span>();</span><br><span class="line">        <span class="type">Phone</span> <span class="variable">phone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone</span>();</span><br><span class="line">        <span class="comment">//å¹¶ä¸æ˜¯è°å…ˆè°åï¼Œè€Œæ˜¯ç”±äºé”çš„å­˜åœ¨ï¼Œè°å…ˆæ‹¿åˆ°è°æ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//å­˜åœ¨é” phone2.sendSms();</span></span><br><span class="line">                phone.sendSms();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);<span class="comment">//ä¼‘çœ ä¸€ç§’ï¼Œæ¯”è¾ƒè°å¿«</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">           <span class="comment">// phone2.hello();</span></span><br><span class="line">            phone2.sendTel();</span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Phone2</span>&#123;</span><br><span class="line">        <span class="comment">//synchronizedé”çš„å¯¹è±¡æ—¶æ–¹æ³•çš„è°ƒç”¨è€…</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span>  <span class="keyword">void</span> <span class="title function_">sendSms</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘çŸ­ä¿¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span>  <span class="keyword">void</span> <span class="title function_">sendTel</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰“ç”µè¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ²¡æœ‰åŠ é”ï¼Œæ™®é€šæ–¹æ³•ï¼Œæ•…è€Œæ²¡æœ‰æ”¶åˆ°é”çš„é™åˆ¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¯´hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//åŠ äº†staticä¿è¯é”ä½ç±»ï¼Œè€Œä¸æ˜¯ä¹‹å‰çš„å¯¹è±¡äº†</span></span><br><span class="line">        <span class="type">Phone3</span> <span class="variable">phone3</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">Phone3</span>();</span><br><span class="line">        <span class="type">Phone</span> <span class="variable">phone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//å­˜åœ¨é” phone2.sendSms();</span></span><br><span class="line">                phone.sendSms();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);<span class="comment">//ä¼‘çœ ä¸€ç§’ï¼Œæ¯”è¾ƒè°å¿«</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="comment">// phone2.hello();</span></span><br><span class="line">            phone3.sendTel();</span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Phone3</span>&#123;</span><br><span class="line">    <span class="comment">//synchronizedé”çš„å¯¹è±¡æ—¶æ–¹æ³•çš„è°ƒç”¨è€…</span></span><br><span class="line">    <span class="comment">//staticç±»ä¸€åŠ è½½å°±æœ‰äº† æ­¤æ—¶é”çš„æ˜¯ç±»è€Œä¸æ˜¯ä¸€å¼€å§‹çš„å¯¹è±¡äº†é”çš„æ˜¯Phone3.class</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span>  <span class="keyword">void</span> <span class="title function_">sendSms</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘çŸ­ä¿¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span>  <span class="keyword">void</span> <span class="title function_">sendTel</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰“ç”µè¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ²¡æœ‰åŠ é”ï¼Œæ™®é€šæ–¹æ³•ï¼Œæ•…è€Œæ²¡æœ‰æ”¶åˆ°é”çš„é™åˆ¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¯´hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test4</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Phone4</span> <span class="variable">phone4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone4</span>();</span><br><span class="line">        <span class="type">Phone2</span> <span class="variable">phone2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone2</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                phone4.sendSms();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            phone2.sendTel();</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Phone4</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">synchronized</span>  <span class="keyword">void</span> <span class="title function_">sendSms</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘çŸ­ä¿¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span>  <span class="keyword">void</span> <span class="title function_">call</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰“ç”µè¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>new this å…·ä½“çš„ä¸€ä¸ªæ‰‹æœº</p><p>static Class å”¯ä¸€çš„ä¸€ä¸ªæ¨¡æ¿</p><h4 id="é›†åˆç±»æ˜¯ä¸å®‰å…¨çš„">é›†åˆç±»æ˜¯ä¸å®‰å…¨çš„</h4><blockquote><p>List</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//java.util.ConcurrentModificationException  å¹¶å‘ä¿®æ”¹å¼‚å¸¸</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//å¹¶å‘ä¸‹ArrayListæ˜¯ä¸å®‰å…¨çš„ã€‚   java.util.ConcurrentModificationException</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         è§£å†³åŠæ³•ï¼Œä½¿ç”¨Vectorå¯ä»¥ä¿è¯ä¸æŠ¥é”™</span></span><br><span class="line"><span class="comment">           List&lt;String&gt; list =  new Vector&lt;&gt;();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">         è§£å†³æ–¹æ³•äºŒï¼Œä½¿ç”¨Collectionå°†ArrayListè½¬å˜æˆå®‰å…¨çš„ï¼Œä½¿ç”¨é”æœºåˆ¶</span></span><br><span class="line"><span class="comment">         List&lt;String&gt; list = Collections.synchronizedList(new ArrayList&lt;&gt;());</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        è§£å†³åŠæ³•ä¸‰ï¼šä½¿ç”¨JUCä¸‹çš„CopyOnWriteArrayList</span></span><br><span class="line"><span class="comment">        List&lt;String&gt; list = new CopyOnWriteArrayList&lt;&gt;(); //JUCé‡Œè¾¹è‡ªå¸¦çš„è§£å†³åŠæ³•</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">//copyOnWriteå†™å…¥æ—¶å¤åˆ¶  COWè®¡ç®—ç¨‹åºé¢†åŸŸçš„ä¸€ç§ä¼˜åŒ–ç­–ç•¥</span></span><br><span class="line">        <span class="comment">//å¤šä¸ªçº¿ç¨‹è°ƒç”¨çš„æ—¶å€™ï¼Œlist,è¯»å–çš„æ—¶å€™å›ºå®šçš„ï¼Œå†™å…¥ï¼ˆè¦†ç›–ï¼‰</span></span><br><span class="line">        <span class="comment">//å†™å…¥æ—¶å€™é¿å…è¦†ç›–ï¼Œé€ æˆæ•°æ®é—®é¢˜</span></span><br><span class="line">        <span class="comment">// copyOnWrite æ¯”vector nbåœ¨å“ªï¼Ÿ</span></span><br><span class="line">       <span class="comment">// List&lt;String&gt; list = new ArrayList&lt;&gt;();</span></span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;&gt;(); <span class="comment">//JUCé‡Œè¾¹è‡ªå¸¦çš„è§£å†³åŠæ³•</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                list.add(UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">5</span>));</span><br><span class="line">                System.out.println(list);</span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Setçš„ä¸å®‰å…¨</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Title</span> java.util.ConcurrentModificationException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> åŒç†å¯å¾—è¿˜æ˜¯å‡ºç°å¹¶å‘ä¿®æ”¹å¼‚å¸¸</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>  ç½—å°é»‘</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/10/5 14:22</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@email</span> 2844135670@qq.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//è§£å†³åŠæ³•ï¼Œè¿˜æ˜¯å¦‚ä»¥å‰ä¸€æ ·</span></span><br><span class="line">        <span class="comment">// Set&lt;String&gt; set = new HashSet&lt;&gt;();</span></span><br><span class="line">        <span class="comment">//æ–¹æ³•ä¸€ä½¿ç”¨Collection.synchronizedSetæ–¹æ³•è§£å†³</span></span><br><span class="line">       <span class="comment">// Set&lt;String&gt; set = Collections.synchronizedSet(new HashSet&lt;&gt;());</span></span><br><span class="line">        <span class="comment">//æ–¹æ³•äºŒä½¿ç”¨JUCä¸‹çš„Copy...</span></span><br><span class="line">        <span class="comment">//Set&lt;String &gt; set = new CopyOnWriteArraySet&lt;&gt;();</span></span><br><span class="line">        Set&lt;String &gt; set = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArraySet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                set.add(UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">5</span>));</span><br><span class="line">                System.out.println(set);</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>HashSetçš„åº•å±‚å°±æ˜¯HashMap</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="title function_">HashSet</span><span class="params">()</span> &#123;</span><br><span class="line">        map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//add  set æœ¬è´¨ä¸Šå°±æ˜¯map key æ˜¯æ— æ³•é‡å¤çš„</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> map.put(e,PRESENT) == <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">object</span> <span class="variable">PRESENT</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();  <span class="comment">//ä¸å¯å˜çš„å€¼</span></span><br></pre></td></tr></table></figure><blockquote><p>HashMap</p></blockquote><p>å›é¡¾hashMapçš„ ç®€å•ç”¨æ³•åŠ è½½å› å­ä¸º0.75</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ConcurrentModificationExceptionå­˜åœ¨å¹¶å‘ä¿®æ”¹å¼‚å¸¸</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashMapTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//map æ˜¯è¿™æ ·å­ç”¨çš„å—ï¼Ÿä¸æ˜¯ï¼Œå·¥ä½œä¸­ä¸ç”¨HashMap(16,0.75)</span></span><br><span class="line">        <span class="comment">//é»˜è®¤ç­‰ä»·å¹²ä»€ä¹ˆï¼Ÿ</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">////ConcurrentModificationExceptionå­˜åœ¨å¹¶å‘ä¿®æ”¹å¼‚å¸¸</span></span><br><span class="line">        <span class="comment">//Map&lt;String ,Object&gt; map = new HashMap&lt;&gt;();</span></span><br><span class="line">       <span class="comment">//è§£å†³åŠæ³•ä¸€ï¼Œè¿˜æ˜¯ä½¿ç”¨        Map&lt;String ,String&gt; map = Collections.synchronizedMap(new HashMap&lt;&gt;());</span></span><br><span class="line">        <span class="comment">//Map&lt;String ,String&gt; map = Collections.synchronizedMap(new HashMap&lt;&gt;());</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//è§£å†³åŠæ³•äºŒ</span></span><br><span class="line">        Map&lt;String,String&gt; map = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                map.put(Thread.currentThread().getName(), UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">5</span>));</span><br><span class="line">                System.out.println(map);</span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Callableé‡ç‚¹è®²è§£">Callableé‡ç‚¹è®²è§£</h4><ol><li>æœ‰è¿”å›å€¼</li><li>å¯ä»¥æŠ›å‡ºå¼‚å¸¸</li><li>æ–¹æ³•ä¸åŒï¼Œrun()/call()</li></ol><blockquote><p>ä»£ç æµ‹è¯•</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CallabelTest</span> &#123;</span><br><span class="line">    <span class="comment">//ä¸¤è€…å¯¹æ¯”ï¼Œçœ‹åˆ°è¿™é‡Œå®ç°çš„Runnableæ¥å£æ²¡æœ‰è¿”å›å€¼</span></span><br><span class="line">    <span class="comment">//new Thread (new Runnable()).start();</span></span><br><span class="line">    <span class="comment">//new Thread (new FutureTask&lt;V&gt;()).start();</span></span><br><span class="line">    <span class="comment">//new Thread (new FutureTask&lt;V&gt;(Callable)).start();</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>().start(); <span class="comment">//æ€ä¹ˆå¯åŠ¨Callable</span></span><br><span class="line">        <span class="type">MyThread1</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread1</span>();</span><br><span class="line">        <span class="type">FutureTask</span> <span class="variable">futureTask</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">FutureTask</span>(thread);</span><br><span class="line">        <span class="comment">// é€‚é…ç±»</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask,<span class="string">&quot;B&quot;</span>).start(); <span class="comment">//ç»“æœä¼šè¢«ç¼“å­˜ï¼Œæ•ˆç‡ä¼šé«˜</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">o</span> <span class="operator">=</span> (Integer)futureTask.get();<span class="comment">//è·å–callbaleçš„è¿”å›ç»“æœ</span></span><br><span class="line">        System.out.println(o);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°Runnableæ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">implements</span>  <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®ç°Callableæ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread1</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;Integer&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯¹æ¯”å‘ç°ï¼Œè¿™é‡Œå®ç°çš„Callableæ¥å£æ˜¯å­˜åœ¨è¿”å›å€¼çš„</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Call()&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»†èŠ‚ï¼š</p><ol><li>å­˜åœ¨ç¼“å­˜</li><li>ç»“æœå¯èƒ½éœ€è¦ç­‰å¾…ï¼Œä¼šé˜»å¡</li></ol><h4 id="å¸¸ç”¨çš„è¾…åŠ©ç±»ï¼ˆå¿…é¡»æŒæ¡ï¼‰">å¸¸ç”¨çš„è¾…åŠ©ç±»ï¼ˆå¿…é¡»æŒæ¡ï¼‰</h4><p>CountDownLatch</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¡æ•°å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CountDownLatchDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//æ€»æ•°æ˜¯6,å¿…é¡»è¦æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ï¼Œå†ä½¿ç”¨</span></span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">countDownLatch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">6</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>( ()-&gt;&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; \t GO OUT&quot;</span>);</span><br><span class="line">                countDownLatch.countDown(); <span class="comment">//æ•°é‡å‡1</span></span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">        countDownLatch.await(); <span class="comment">//ç­‰å¾…è®¡æ•°å™¨å½’é›¶ï¼Œè®©å‘ä¸‹æ‰§è¡Œ</span></span><br><span class="line">        <span class="comment">//ä¿è¯æ•°æ®å…¨éƒ¨æ‰§è¡Œä¹‹åæ‰å°†ç¨‹åºç»“æŸ</span></span><br><span class="line">        <span class="comment">//countDownLatch.countDown(); // -1</span></span><br><span class="line">        System.out.println(<span class="string">&quot;å…³é—¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡æ³•è®¡æ•°å™¨ï¼š</p><p>åŸç†æ˜¯æ•°é‡å‡ä¸€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">countDownLatch.countDown(); <span class="comment">// -1</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">countDownLatch.await(); <span class="comment">//ç­‰å¾…è®¡æ•°å™¨å½’é›¶ï¼Œè®©å‘ä¸‹æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure><p>æ¯æ¬¡æœ‰çº¿ç¨‹è°ƒç”¨countDown()æ•°é‡1ï¼Œå‡è®¾è®¡æ•°å™¨å˜ä¸º0ï¼ŒcountDownLatch.awaitå°±ä¼šè¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œï¼</p><p>CycliBarrierï¼š åŠ æ³•è®¡æ•°å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CycliBarrierDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœè¿™é‡Œçš„æ•°å€¼æ²¡æœ‰åœ¨forå¾ªç¯ä¸­ä½“ç°çš„è¯ï¼Œå°±ä¸èƒ½ç»“æŸäº‹ä»¶ï¼Œä¹Ÿå°±ä¼šä¸€ç›´è¿è¡Œï¼Œå ç”¨ç¨‹åºè¿è¡Œ</span></span><br><span class="line">        <span class="type">CyclicBarrier</span> <span class="variable">cyclicBarrier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(<span class="number">6</span>,()-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;äº‹ä»¶å®Œæˆ&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//åŠ æ³•è®¡æ•°å™¨</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">7</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span>  <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="comment">//lambdaèƒ½æ“ä½œåˆ°iå—      --ä¸èƒ½ç›´æ¥æ“ä½œåˆ°</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>( ()-&gt;&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;æ”¶é›†&quot;</span>+ temp + <span class="string">&quot;ä¸ªé¾™ç &quot;</span>); <span class="comment">//æˆ‘ä»¬å‘ç°æ˜¯æ“ä½œä¸åˆ°içš„</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    cyclicBarrier.await();  <span class="comment">//ç­‰å¾…</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (BrokenBarrierException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Semaphore :  ä¿¡å·é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SemaphoreDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//çº¿ç¨‹æ•°é‡;åœè½¦ä½,é™æµ</span></span><br><span class="line">        <span class="type">Semaphore</span> <span class="variable">semaphore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                <span class="comment">//acquire()å¾—åˆ°</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    semaphore.acquire();</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+ <span class="string">&quot;æŠ¢åˆ°è½¦ä½&quot;</span>);</span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+ <span class="string">&quot;ç¦»å¼€è½¦ä½&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    semaphore.release();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//release()é‡Šæ”¾</span></span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åŸç†ï¼š</p><p>semaphore.acquire();è·å¾—ï¼Œå‡å¦‚å·²ç»æ»¡äº†ï¼Œç­‰å¾…ï¼Œç­‰å¾…è¢«é‡Šæ”¾</p><p>semaphore.release();é‡Šæ”¾ï¼Œä¼šå°†å½“å‰çš„ä¿¡å·é‡é‡Šæ”¾ +1 ï¼Œç„¶åå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚</p><h4 id="è¯»å†™é”">è¯»å†™é”</h4><p>ReadWriteLock:è¯»å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹è¯»ï¼Œä½†å†™çš„æ—¶å€™åªèƒ½æ˜¯ä¸€ä¸ªçº¿ç¨‹å†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReadWriteLockDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">MyCacheLock</span> <span class="variable">myCache</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyCacheLock</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span>  <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> i; <span class="comment">//lamadaè¡¨è¾¾å¼ä¸­ä¸èƒ½ç›´æ¥è¯»å–iï¼Œåªèƒ½é€šè¿‡è¿™æ ·çš„è½¬æ¢</span></span><br><span class="line">            <span class="comment">//åªåšå†™å…¥çš„æ“ä½œ</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                myCache.put(temp + <span class="string">&quot;&quot;</span>,temp +<span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åªåšè¯»å–çš„æ“ä½œ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span>  <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> i; <span class="comment">//lamadaè¡¨è¾¾å¼ä¸­ä¸èƒ½ç›´æ¥è¯»å–iï¼Œåªèƒ½é€šè¿‡è¿™æ ·çš„è½¬æ¢</span></span><br><span class="line">            <span class="comment">//åªåšå†™å…¥çš„æ“ä½œ</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                myCache.get(temp + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æœªåŠ é”å¯¼è‡´ï¼Œæˆ‘åœ¨å†™å…¥1çš„æ—¶å€™ç”±äºçº¿ç¨‹å½±å“å¯èƒ½ä¼šäº§ç”Ÿ1æ²¡å†™å…¥å®Œæˆï¼Œ</span></span><br><span class="line"><span class="comment">// äºŒä¹Ÿè¿›è¡Œå†™å…¥äº†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyCache</span>&#123;</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">volatile</span> Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™ä¸ªæ˜¯ä¸€ä¸ªå­˜çš„è¿‡ç¨‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(String key , Object obj)</span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+ <span class="string">&quot;å†™å…¥&quot;</span>+ key);</span><br><span class="line">        map.put(key,obj);</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;å†™å…¥æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™ä¸ªæ˜¯ä¸€ä¸ªå–çš„è¿‡ç¨‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">get</span><span class="params">(String key)</span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+ <span class="string">&quot;è¯»å–&quot;</span>+ key);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span>  map.get(key);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;è¯»å–æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyCacheLock</span>&#123;</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">volatile</span> Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//private Lock lock = new ReentrantLock(); //æ™®é€šé”</span></span><br><span class="line">    <span class="comment">//è¯»å†™é”ï¼Œå­˜å†™å…¥çš„æ—¶å€™ï¼Œåªå¸Œæœ›åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹å†™</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">ReadWriteLock</span> <span class="variable">lock</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line">    <span class="comment">//è¿™ä¸ªæ˜¯ä¸€ä¸ªå­˜çš„è¿‡ç¨‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(String key , Object obj)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿™ä¸ªæ—¶å€™å°±æ˜¯è¿›è¡Œæ·é”äº†</span></span><br><span class="line">        lock.writeLock().lock();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+ <span class="string">&quot;å†™å…¥&quot;</span>+ key);</span><br><span class="line">            map.put(key,obj);</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;å†™å…¥æˆåŠŸ&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.writeLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿™ä¸ªæ˜¯ä¸€ä¸ªå–çš„è¿‡ç¨‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">get</span><span class="params">(String key)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åŠ ä¸Šè¯»é”</span></span><br><span class="line">        lock.readLock().lock();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+ <span class="string">&quot;è¯»å–&quot;</span>+ key);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span>  map.get(key);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;è¯»å–æˆåŠŸ&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.readLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é˜»å¡é˜Ÿåˆ—">é˜»å¡é˜Ÿåˆ—</h4><p>é˜Ÿåˆ—ï¼ˆFIFOï¼‰</p><p>å†™å…¥çš„æ—¶å€™ï¼šå¦‚æœé˜Ÿåˆ—æ˜¯æ»¡çš„ï¼Œé‚£ä¹ˆä¹…å¿…é¡»é˜»å¡ç­‰å¾…ã€‚</p><p>å–å‡ºæ¥çš„æ—¶å€™ï¼šå¦‚æœé˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆå¿…é¡»é˜»å¡ç­‰å¾…ç”Ÿäº§ã€‚</p><p>BlockingQueue</p><p>åœ¨çº¿ç¨‹ä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™éœ€è¦æ³¨æ„é˜»å¡é˜Ÿåˆ—æ˜¯å¤šçº¿ç¨‹ä¸‹å¹¶å‘å¤„ç†ï¼Œçº¿ç¨‹æ± å¤„ç†ã€‚</p><p><strong>å­¦ä¼šä½¿ç”¨é˜Ÿåˆ—</strong></p><p>æ·»åŠ ï¼Œç§»é™¤</p><p><strong>å››ç»„API</strong>(ç†Ÿç»ƒæŒæ¡å¹¶ä½¿ç”¨ )</p><table><thead><tr><th>æ–¹å¼</th><th>æŠ›å‡ºå¼‚å¸¸</th><th>ä¸ä¼šæŠ›å‡ºå¼‚å¸¸</th><th>é˜»å¡ç­‰å¾…</th><th>è¶…æ—¶ç­‰å¾…</th></tr></thead><tbody><tr><td>æ·»åŠ </td><td>add</td><td>offer</td><td>put</td><td>offer(,)</td></tr><tr><td>ç§»é™¤</td><td>remove</td><td>poll</td><td>take</td><td>poll(,)</td></tr><tr><td>åˆ¤æ–­é˜Ÿåˆ—é¦–ä½</td><td>element</td><td>peek</td><td>â€“</td><td>â€“</td></tr></tbody></table><ol><li>æŠ›å‡ºå¼‚å¸¸</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlockingQueueDemo</span> &#123;</span><br><span class="line">   <span class="comment">/* Collections</span></span><br><span class="line"><span class="comment">    List</span></span><br><span class="line"><span class="comment">    Set</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        test1();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//é˜Ÿåˆ—çš„å¤§å°</span></span><br><span class="line">        <span class="type">ArrayBlockingQueue</span> <span class="variable">blockingQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(blockingQueue.add(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">        System.out.println(blockingQueue.add(<span class="string">&quot;b&quot;</span>));</span><br><span class="line">        System.out.println(blockingQueue.add(<span class="string">&quot;c&quot;</span>));</span><br><span class="line">        <span class="comment">/*ç”±äºæˆ‘å®šä¹‰çš„æ˜¯3ä¸ªå€¼ï¼Œæ•…è€Œå¦‚æœæ·»åŠ å››ä¸ªå€¼çš„è¯å¯¼è‡´ä¿æŒ</span></span><br><span class="line"><span class="comment">       é˜Ÿåˆ—æ»¡äº†ï¼Œè¿™å°±è¯´æ˜å’Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ•°ç»„ä¸€æ ·ï¼Œå®šäºä¸€ä¸ªå¤§å°ï¼Œè¶…å‡ºè¿™ä¸ªå¤§å°å°±å¥½æŠ¥é”™</span></span><br><span class="line"><span class="comment">         æŠ›å‡ºå¼‚å¸¸ Queue full*/</span></span><br><span class="line">       <span class="comment">// System.out.println(blockingQueue.add(&quot;d&quot;));</span></span><br><span class="line">        <span class="comment">//è®²é˜Ÿåˆ—çš„æ‰€æœ‰æ·»åŠ å€¼å…¨éƒ¨ç§»é™¤ï¼Œä½¿å¾—é˜Ÿåˆ—ä¸ºç©º</span></span><br><span class="line">       <span class="comment">// ä¸€æ¬¡åªèƒ½ç§»é™¤ä¸€ä¸ª</span></span><br><span class="line">        System.out.println(blockingQueue.remove());</span><br><span class="line">        System.out.println(blockingQueue.remove());</span><br><span class="line">        System.out.println(blockingQueue.remove());</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        æ¬¡æ•°é˜Ÿåˆ—ä¸ºç©ºï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å°†ä¼šäº§ç”Ÿé—®é¢˜</span></span><br><span class="line"><span class="comment">        java.util.NoSuchElementException</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        System.out.println(blockingQueue.remove());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ä¸ä¼šæŠ›å‡ºå¼‚å¸¸</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">       ä¸æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//è®¾ç½®é˜Ÿåˆ—çš„å¤§å°</span></span><br><span class="line">       <span class="type">ArrayBlockingQueue</span> <span class="variable">blockingQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">       System.out.println(blockingQueue.offer(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">       System.out.println(blockingQueue.offer(<span class="string">&quot;b&quot;</span>));</span><br><span class="line">       System.out.println(blockingQueue.offer(<span class="string">&quot;c&quot;</span>));</span><br><span class="line">       <span class="comment">//ä¸ä¼šæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">       System.out.println(blockingQueue.offer(<span class="string">&quot;d&quot;</span>));<span class="comment">//false</span></span><br><span class="line">       System.out.println(blockingQueue.peek()); <span class="comment">//åˆ¤æ–­é˜Ÿé¦–å…ƒç´ </span></span><br><span class="line">       System.out.println(<span class="string">&quot;===========================&quot;</span>);</span><br><span class="line">       System.out.println(blockingQueue.poll());</span><br><span class="line">       System.out.println(blockingQueue.poll());</span><br><span class="line">       System.out.println(blockingQueue.poll());</span><br><span class="line">       System.out.println(blockingQueue.poll());  <span class="comment">//null</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ol><li>é˜»å¡ , ç­‰å¾…</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">        ç­‰å¾…ï¼Œé˜»å¡ï¼ˆä¸€ç›´é˜»å¡ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//è€æ ·å­è®¾ç½®é˜Ÿåˆ—å¤§å°</span></span><br><span class="line">        <span class="type">ArrayBlockingQueue</span> <span class="variable">blockingQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¸€ç›´é˜»å¡</span></span><br><span class="line">        blockingQueue.put(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">        blockingQueue.put(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">        blockingQueue.put(<span class="string">&quot;c&quot;</span>);</span><br><span class="line">      <span class="comment">//  blockingQueue.put(&quot;d&quot;);//é˜Ÿåˆ—æ²¡æœ‰ä½ç½®</span></span><br><span class="line">        System.out.println(blockingQueue.take());</span><br><span class="line">        System.out.println(blockingQueue.take());</span><br><span class="line">        System.out.println(blockingQueue.take());</span><br><span class="line">        <span class="comment">//ä¼šå¯¼è‡´ä¸€ç›´é˜»å¡</span></span><br><span class="line">       <span class="comment">// System.out.println(blockingQueue.take());</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li>è¶…æ—¶ç­‰å¾…</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">       è¶…æ—¶ç­‰å¾…</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span>  <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">       <span class="type">ArrayBlockingQueue</span> <span class="variable">blockingQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">3</span>);</span><br><span class="line">       blockingQueue.offer(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">       blockingQueue.offer(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">       blockingQueue.offer(<span class="string">&quot;c&quot;</span>);</span><br><span class="line">       <span class="comment">//è¶…æ—¶ç­‰å¾…å•Šï¼Œè¶…è¿‡ä¸¤ç§’é’Ÿå°±é€€å‡º</span></span><br><span class="line">       blockingQueue.offer(<span class="string">&quot;d&quot;</span>,<span class="number">2</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">       System.out.println(blockingQueue.poll());</span><br><span class="line">       System.out.println(blockingQueue.poll());</span><br><span class="line">       System.out.println(blockingQueue.poll());</span><br><span class="line">       blockingQueue.poll(<span class="number">2</span>,TimeUnit.SECONDS);<span class="comment">//è¶…è¿‡2ç§’é’Ÿå°±é€€å‡º</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h4 id="SynchronousQueue">SynchronousQueue</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    åŒæ­¥é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">    å’Œå…¶ä»–çš„æ˜¯ä¸ä¸€æ ·çš„ï¼ŒSynchronousQueueä¸å­˜å‚¨å…ƒç´ </span></span><br><span class="line"><span class="comment">    putäº†ä¸€ä¸ªå…ƒç´ ï¼Œå¿…é¡»ä»é‡Œè¾¹å…ˆtakeå‡ºæ¥ï¼Œå¦åˆ™ä¸èƒ½åœ¨putè¿›å»å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronousQueueDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//åŒæ­¥é˜Ÿåˆ—</span></span><br><span class="line">     <span class="type">SynchronousQueue</span> <span class="variable">synchronousQueue</span> <span class="operator">=</span>  <span class="keyword">new</span> <span class="title class_">SynchronousQueue</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">     <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">             System.out.println(Thread.currentThread().getName() + <span class="string">&quot;put 1&quot;</span> );</span><br><span class="line">             synchronousQueue.put(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">             System.out.println(Thread.currentThread().getName() + <span class="string">&quot;put 2&quot;</span> );</span><br><span class="line">             synchronousQueue.put(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">             System.out.println(Thread.currentThread().getName() + <span class="string">&quot;put 3&quot;</span> );</span><br><span class="line">             synchronousQueue.put(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">             <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;,<span class="string">&quot;T1&quot;</span>).start();</span><br><span class="line">     <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">             TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">             System.out.println(Thread.currentThread().getName() +<span class="string">&quot;=&gt;&quot;</span>+ synchronousQueue.take() );</span><br><span class="line">             TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">             System.out.println(Thread.currentThread().getName() +<span class="string">&quot;=&gt;&quot;</span>+ synchronousQueue.take());</span><br><span class="line">             TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">             System.out.println(Thread.currentThread().getName()+<span class="string">&quot;=&gt;&quot;</span>+ synchronousQueue.take() );</span><br><span class="line">         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">             <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;,<span class="string">&quot;T2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="çº¿ç¨‹æ± ï¼ˆé‡ç‚¹ï¼‰">çº¿ç¨‹æ± ï¼ˆé‡ç‚¹ï¼‰</h4><blockquote><p>æ± åŒ–æŠ€æœ¯</p></blockquote><p>ç¨‹åºçš„è¿è¡Œï¼Œæœ¬è´¨ï¼šå ç”¨ç³»ç»Ÿçš„èµ„æºï¼Œä¼˜åŒ–èµ„æºçš„ä½¿ç”¨ï¼=&gt;æ± åŒ–æŠ€æœ¯</p><p>çº¿ç¨‹æ± ï¼Œè¿æ¥æ± ï¼Œå†…å­˜æ± ï¼Œå¯¹è±¡æ± ã€‚ã€‚ã€‚  åˆ›å»ºï¼Œé”€æ¯ï¼Œååˆ†æµªè´¹èµ„æº</p><p>æ± åŒ–æŠ€æœ¯ï¼Œäº‹å…ˆå‡†å¤‡å¥½ä¸€äº›èµ„æºï¼Œæœ‰äººè¦ç”¨ï¼Œå°±å¯ä»¥æ¥æˆ‘è¿™é‡Œæ‹¿ï¼Œç”¨å®Œä¹‹åè¿˜ç»™æˆ‘</p><p><strong>çº¿ç¨‹æ± çš„å¥½å¤„</strong></p><ol><li>é™ä½èµ„æºçš„æ¶ˆè€—</li><li>æé«˜å“åº”çš„é€Ÿåº¦</li><li>æ–¹ä¾¿ç®¡ç†</li></ol><p>çº¿ç¨‹å¤ç”¨ï¼Œå¯ä»¥æ§åˆ¶æœ€å¤§çš„å¹¶å‘æ•°ï¼Œç®¡ç†çº¿ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    Executor å·¥å…·ç±»ï¼Œé‡Œè¾¹æœ‰ä¸‰å¤§æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">     <span class="comment">// ExecutorService threadPool =  Executors.newSingleThreadExecutor();//åˆ›å»ºä¸€ä¸ªå•ä¾‹çš„çº¿ç¨‹æ± </span></span><br><span class="line">       <span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span>  Executors.newCachedThreadPool();<span class="comment">//åˆ›å»ºä¸€ä¸ªç¼“å­˜çš„çº¿ç¨‹æ± ï¼Œé‡å¼ºåˆ™å¼ºï¼Œé‡å¼±åˆ™å¼±</span></span><br><span class="line">       <span class="comment">//ExecutorService threadPool =  Executors.newFixedThreadPool(5);//åˆ›å»ºä¸€ä¸ªå›ºå®šçš„çº¿ç¨‹å¤§å°</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//TODO çº¿ç¨‹ä½¿ç”¨å®Œæ¯•æ˜¯è¦å…³é—­çš„                                           </span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> i;</span><br><span class="line">                <span class="comment">//new Thread(()-&gt;&#123;&#125;).start();//å¸¸è§„çš„åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼</span></span><br><span class="line">                <span class="comment">//ç°åœ¨çº¿ç¨‹æ± çš„åˆ›å»ºæ–¹å¼ threadPool.execute(()-&gt;&#123;&#125;);</span></span><br><span class="line">                threadPool.execute(()-&gt;&#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+ <span class="string">&quot;=&gt;&quot;</span> + <span class="string">&quot;OK&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>7å¤§å‚æ•°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newFixedThreadPool</span><span class="params">(<span class="type">int</span> nThreads)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(nThreads, nThreads,</span><br><span class="line">                                      <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                      <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newCachedThreadPool</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">0</span>, Integer.MAX_VALUE, <span class="comment">//æœ€å¤§21äº¿</span></span><br><span class="line">                                      <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                      <span class="keyword">new</span> <span class="title class_">SynchronousQueue</span>&lt;Runnable&gt;());</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newSingleThreadExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FinalizableDelegatedExecutorService</span></span><br><span class="line">            (<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                    <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                    <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;()));</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//æˆ‘ä»¬å‘ç°éƒ½æ˜¯è°ƒç”¨ ThreadPoolExecutor</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ThreadPoolExecutor</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="type">int</span> corePoolSize,  //åˆ›å»ºçº¿ç¨‹åˆ›å¤§å°</span></span><br><span class="line"><span class="params">                              <span class="type">int</span> maximumPoolSize, //æœ€å¤§æ ¸å¿ƒçº¿ç¨‹çš„å¤§å°</span></span><br><span class="line"><span class="params">                              <span class="type">long</span> keepAliveTime,  //è¶…æ—¶äº†ï¼Œæ²¡äººè°ƒç”¨å°±å¥½é‡Šæ”¾</span></span><br><span class="line"><span class="params">                              TimeUnit unit,//è¶…æ—¶å•ä½</span></span><br><span class="line"><span class="params">                              BlockingQueue&lt;Runnable&gt; workQueue, //é˜»å¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="params">                              ThreadFactory threadFactory, //çº¿ç¨‹å·¥å‚ï¼Œåˆ›å»ºçº¿ç¨‹çš„ï¼Œä¸€èˆ¬ä¸ç”¨åŠ¨</span></span><br><span class="line"><span class="params">                              RejectedExecutionHandler handler //æ‹’ç»ç­–ç•¥)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (corePoolSize &lt; <span class="number">0</span> ||</span><br><span class="line">            maximumPoolSize &lt;= <span class="number">0</span> ||</span><br><span class="line">            maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">            keepAliveTime &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">        <span class="keyword">if</span> (workQueue == <span class="literal">null</span> || threadFactory == <span class="literal">null</span> || handler == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">        <span class="built_in">this</span>.acc = System.getSecurityManager() == <span class="literal">null</span> ?</span><br><span class="line">                <span class="literal">null</span> :</span><br><span class="line">                AccessController.getContext();</span><br><span class="line">        <span class="built_in">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">        <span class="built_in">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">        <span class="built_in">this</span>.workQueue = workQueue;</span><br><span class="line">        <span class="built_in">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">        <span class="built_in">this</span>.threadFactory = threadFactory;</span><br><span class="line">        <span class="built_in">this</span>.handler = handler;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ã€å¼ºåˆ¶ã€‘çº¿ç¨‹**æ± ä¸å…è®¸ä½¿ç”¨ Executors å»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ ThreadPoolExecutor çš„æ–¹å¼ï¼Œ**è¿™æ · çš„å¤„ç†æ–¹å¼è®©å†™çš„åŒå­¦æ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œè§„é¿èµ„æºè€—å°½çš„é£é™©ã€‚</p><p>è¯´æ˜ï¼šExecutors è¿”å›çš„çº¿ç¨‹æ± å¯¹è±¡çš„å¼Šç«¯å¦‚ä¸‹ï¼š</p><p>1ï¼‰FixedThreadPool å’Œ SingleThreadPool:</p><p>å…è®¸çš„è¯·æ±‚é˜Ÿåˆ—é•¿åº¦ä¸º Integer.MAX_VALUEï¼Œå¯èƒ½ä¼šå †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ OOMã€‚</p><p>2ï¼‰CachedThreadPool å’Œ ScheduledThreadPool:</p><p>å…è®¸çš„åˆ›å»ºçº¿ç¨‹æ•°é‡ä¸º Integer.MAX_VALUEï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çš„çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´ OOMã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    Executor å·¥å…·ç±»ï¼Œé‡Œè¾¹æœ‰ä¸‰å¤§æ–¹æ³•</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    ä¸ƒå¤§å‚æ•°</span></span><br><span class="line"><span class="comment">    å››ç§æ‹’ç»ç­–ç•¥</span></span><br><span class="line"><span class="comment">    new ThreadPoolExecutor.AbortPolicy() //é“¶è¡Œæ»¡äº†ï¼Œä½†è¿˜æœ‰äººè¿›å»</span></span><br><span class="line"><span class="comment">    new ThreadPoolExecutor.CallerRunsPolicy() //å“ªæ¥çš„å»å“ªé‡Œ</span></span><br><span class="line"><span class="comment">    new ThreadPoolExecutor.DiscardPolicy()  //é˜Ÿåˆ—æ»¡äº†ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä¼šä¸¢åˆ°ä»»åŠ¡</span></span><br><span class="line"><span class="comment">    new ThreadPoolExecutor.DiscardOldestPolicy()//é˜Ÿåˆ—æ»¡äº†ï¼Œå°è¯•å’Œæœ€æ—©çš„å»ç«äº‰</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">     <span class="comment">// ExecutorService threadPool =  Executors.newSingleThreadExecutor();//åˆ›å»ºä¸€ä¸ªå•ä¾‹çš„çº¿ç¨‹æ± </span></span><br><span class="line">      <span class="comment">// ExecutorService threadPool =  Executors.newCachedThreadPool();//åˆ›å»ºä¸€ä¸ªç¼“å­˜çš„çº¿ç¨‹æ± ï¼Œé‡å¼ºåˆ™å¼ºï¼Œé‡å¼±åˆ™å¼±</span></span><br><span class="line">       <span class="comment">//ExecutorService threadPool =  Executors.newFixedThreadPool(5);//åˆ›å»ºä¸€ä¸ªå›ºå®šçš„çº¿ç¨‹å¤§å°</span></span><br><span class="line">       <span class="comment">/*</span></span><br><span class="line"><span class="comment">            ä¸ƒå¤§å‚æ•° ï¼Œè‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œä¸€èˆ¬æ˜¯å·¥ä½œä¸­ä½¿ç”¨ï¼Œå› ä¸ºä½¿ç”¨å·¥å…·äº†ç±»ä¼šå‡ºç°é—®é¢˜</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">                <span class="number">2</span>,</span><br><span class="line">                <span class="number">5</span>,</span><br><span class="line">                <span class="number">3</span>,</span><br><span class="line">                TimeUnit.SECONDS,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="number">3</span>),</span><br><span class="line">                Executors.defaultThreadFactory(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.DiscardOldestPolicy()<span class="comment">//é˜Ÿåˆ—æ»¡äº†ï¼Œå°è¯•å’Œæœ€æ—©çš„å»ç«äº‰</span></span><br><span class="line">                );</span><br><span class="line">        <span class="comment">//TODO çº¿ç¨‹ä½¿ç”¨å®Œæ¯•æ˜¯è¦å…³é—­çš„</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> i;</span><br><span class="line">                <span class="comment">//new Thread(()-&gt;&#123;&#125;).start();//å¸¸è§„çš„åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼</span></span><br><span class="line">                <span class="comment">//ç°åœ¨çº¿ç¨‹æ± çš„åˆ›å»ºæ–¹å¼ threadPool.execute(()-&gt;&#123;&#125;);</span></span><br><span class="line">                threadPool.execute(()-&gt;&#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+ <span class="string">&quot;=&gt;&quot;</span> + <span class="string">&quot;OK&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹æ± å¤§å°å¦‚ä½•å»è®¾ç½®</p><p>CPUå¯†é›†å‹å’ŒIOå¯†é›†å‹ï¼ˆè°ƒä¼˜ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">        æœ€å¤§çº¿ç¨‹æ•°åº”è¯¥å¦‚ä½•å®šä¹‰ï¼Ÿ</span></span><br><span class="line"><span class="comment">        IOå¯†é›†å‹ ååˆ†å ç”¨èµ„æº ç¨‹åº ï¼Œ 15ä¸ªç±»å‹ä»»åŠ¡  åˆ¤æ–­ä½ çš„ç¨‹åºä¸­åˆ¤æ–­ç¨‹åºä¸­å ç”¨IOçš„çº¿ç¨‹</span></span><br><span class="line"><span class="comment">        CPUå¯†é›†å‹ ï¼Œå‡ æ ¸å°±æ˜¯å‡ ï¼Œå¯ä»¥ä¿æŒCPUçš„æ•ˆç‡æœ€é«˜</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">//è¾“å‡ºCPUçš„æ ¸å¿ƒæ•°</span></span><br><span class="line">        System.out.println(Runtime.getRuntime().availableProcessors());</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="å››å¤§å‡½æ•°æ¥å£ï¼ˆå¿…éœ€æŒæ¡ï¼‰">å››å¤§å‡½æ•°æ¥å£ï¼ˆå¿…éœ€æŒæ¡ï¼‰</h4><p>æ–°æ—¶ä»£çš„ç¨‹åºå‘˜éœ€è¦æŒæ¡çš„lambdaè¡¨è¾¾å¼ï¼Œé“¾å¼ç¼–ç¨‹ï¼Œå‡½æ•°å¼æ¥å£ï¼ŒStreamæµå¼è®¡ç®—</p><blockquote><p>å‡½æ•°å¼æ¥å£ï¼šåªæœ‰ä¸€ä¸ªæ–¹æ³•çš„æ¥å£</p></blockquote><p>æ¯”å¦‚ï¼šRunnable</p><p>ç®€åŒ–å¼€å‘æ¨¡å‹ï¼Œåœ¨æ–°ç‰ˆæœ¬ä¸­å¤§é‡ä½¿ç”¨</p><p>æ¯”å¦‚foreach</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Title å‡½æ•°å¼æ¥å£</span></span><br><span class="line"><span class="comment"> * @Description  Function</span></span><br><span class="line"><span class="comment"> * æœ‰ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œæœ‰ä¸€ä¸ªè¾“å‡º</span></span><br><span class="line"><span class="comment"> * åªè¦æ˜¯ å‡½æ•°å¼æ¥å£ï¼Œé‚£ä¹ˆæˆ‘ä»¬éƒ½å¯ä»¥ç”¨lambda è¡¨è¾¾å¼ç®€åŒ–</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @author  ç½—å°é»‘</span></span><br><span class="line"><span class="comment"> * @param null</span></span><br><span class="line"><span class="comment"> * @return</span></span><br><span class="line"><span class="comment"> * @date 2022/10/7 18:38</span></span><br><span class="line"><span class="comment"> * @email 2844135670@qq.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FunctionDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="type">Function</span> <span class="variable">function</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Function</span>&lt;String,String&gt;()&#123;</span><br><span class="line"></span><br><span class="line">           <span class="comment">//å·¥å…·ç±»ï¼Œè¾“å‡ºè¾“å…¥çš„å€¼</span></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> String <span class="title function_">apply</span><span class="params">(String o)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">       <span class="type">Function</span> <span class="variable">function1</span> <span class="operator">=</span> (str)-&gt;&#123; <span class="keyword">return</span>  str;&#125;;</span><br><span class="line">        System.out.println(function.apply(<span class="string">&quot;asd&quot;</span>));</span><br><span class="line">        System.out.println(function1.apply(<span class="string">&quot;add&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ–­å®šæ€§æ¥å£ï¼›æœ‰ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œè¿”å›å€¼åªèƒ½æ˜¯å¸ƒå°”å€¼</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PredicateDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="type">Predicate</span> <span class="variable">predicate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Predicate</span>&lt;String &gt;()&#123;</span><br><span class="line"></span><br><span class="line">           <span class="comment">//åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(String o)</span> &#123;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">return</span> o.isEmpty();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//æ³¨æ„ä¸€ä¸‹ï¼Œè¿™é‡Œæ³›å‹éœ€è¦å®šä¹‰ä¸€ä¸‹</span></span><br><span class="line">       Predicate&lt;String&gt; predicate1 = (str)-&gt;&#123;<span class="keyword">return</span> str.isEmpty();&#125;;</span><br><span class="line">        System.out.println(predicate.test(<span class="string">&quot;aad&quot;</span>));</span><br><span class="line">        System.out.println(predicate1.test(<span class="string">&quot;&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    æ¶ˆè´¹å‹æ¥å£</span></span><br><span class="line"><span class="comment">    åªæœ‰è¾“å…¥ï¼Œæ²¡æœ‰è¿”å›å€¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Consumer</span>&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(String o)</span> &#123;</span><br><span class="line">                System.out.println(o);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Consumer&lt;String&gt; consumer1 = (str)-&gt;&#123;</span><br><span class="line">            System.out.println(str);</span><br><span class="line">        &#125;;</span><br><span class="line">        consumer.accept(<span class="string">&quot;ä½ å¥½&quot;</span>);</span><br><span class="line">        consumer1.accept(<span class="string">&quot;æˆ‘å–œæ¬¢ä½ &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¾›ç»™å‹å‡½æ•°æ¥å£ï¼Œæ²¡æœ‰å‚æ•°ï¼Œåªæœ‰è¿”å›å€¼</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SupplierDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Supplier</span> <span class="variable">supplier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Supplier</span>&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;ä½ å¥½&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">Supplier</span> <span class="variable">supplier1</span> <span class="operator">=</span> ()-&gt;&#123;<span class="keyword">return</span> <span class="string">&quot;æˆ‘è¿˜æ˜¯å–œæ¬¢ä½ &quot;</span>;&#125;;</span><br><span class="line">        System.out.println(supplier.get());</span><br><span class="line">        System.out.println(supplier1.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€ç¨‹åºå‘˜ï¼Œæ³›å‹ï¼Œåå°„ï¼Œæšä¸¾éƒ½éœ€è¦ä¼š</p><p>æ–°ç¨‹åºå‘˜ï¼Œlambdaè¡¨è¾¾å¼ï¼Œå‡½æ•°å¼æ¥å£ï¼ŒStreamæµå¼è®¡ç®—</p><blockquote><p>ä»€ä¹ˆæ˜¯æµå¼è®¡ç®—</p></blockquote><p>å¤§æ•°æ®ï¼šå­˜å‚¨+è®¡ç®—</p><p>é›†åˆï¼ŒMySqlæœ¬è´¨ä¸Šå°±æ˜¯å­˜å‚¨ä¸œè¥¿</p><p>è®¡ç®—éƒ½åº”è¯¥äº¤ç»™æµæ¥å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æµå¼è®¡ç®—</span></span><br><span class="line"><span class="comment">ç°æœ‰ä¸€ä¸ªé¢˜ç›®ï¼šè¦æ±‚ä¸€åˆ†é’Ÿå†…å®Œæˆæ­¤é¢˜ï¼Œåªèƒ½ç”¨ä¸€è¡Œä»£ç å®ç°</span></span><br><span class="line"><span class="comment">    ç°æœ‰äº”ä¸ªç”¨æˆ·ï¼Œ</span></span><br><span class="line"><span class="comment">       1.IDå¿…é¡»ä¸ºå¶æ•°</span></span><br><span class="line"><span class="comment">       2.å¹´é¾„å¿…é¡»è¦å¤§äº23å²</span></span><br><span class="line"><span class="comment">       3.ç”¨æˆ·åå¿…é¡»è½¬æ¢ä¸ºå¤§å†™</span></span><br><span class="line"><span class="comment">       4.ç”¨æˆ·åå­—å€’å™æ’åº</span></span><br><span class="line"><span class="comment">       5.åªè¾“å‡ºä¸€ä¸ªç”¨æˆ·</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">u1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1</span>,<span class="number">12</span>,<span class="string">&quot;a&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">u2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">2</span>,<span class="number">25</span>,<span class="string">&quot;b&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">u3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">3</span>,<span class="number">23</span>,<span class="string">&quot;c&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">u4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">4</span>,<span class="number">15</span>,<span class="string">&quot;d&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">u5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">5</span>,<span class="number">16</span>,<span class="string">&quot;e&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä½¿ç”¨Listé›†åˆå­˜å‚¨,å°†é›†åˆç±»å¯¹è±¡è½¬æ¢</span></span><br><span class="line">        List&lt;User&gt; list =  Arrays.asList(u1,u2,u3,u4,u5);</span><br><span class="line">        System.out.println(list);</span><br><span class="line">        <span class="comment">//è®¡ç®—äº¤ç»™Steamæµ</span></span><br><span class="line">        list.stream()</span><br><span class="line">                .filter(u-&gt;&#123;<span class="keyword">return</span>  u.getId()%<span class="number">2</span> ==<span class="number">0</span>;&#125;)<span class="comment">//è¿‡æ»¤idä¸ºå¶æ•°çš„</span></span><br><span class="line">                .filter(u-&gt;&#123;<span class="keyword">return</span>  u.getAge() &gt; <span class="number">16</span>;&#125;) <span class="comment">//è¿‡æ»¤å¹´é¾„å°äº16çš„</span></span><br><span class="line">                .map(u-&gt;&#123;<span class="keyword">return</span> u.getName().toUpperCase();&#125;) <span class="comment">//é€šè¿‡mapå‡½æ•°å¼æ¥å£å°†åå­—è½¬æ¢ä¸ºå¤§å†™</span></span><br><span class="line">                .sorted((uu1,uu2) -&gt; &#123;<span class="keyword">return</span>  uu1.compareTo(uu2);&#125;)<span class="comment">//æ’åºå¹¶æ¯”è¾ƒ</span></span><br><span class="line">                .limit(<span class="number">1</span>)<span class="comment">//åªæ˜¾ç¤ºä¸€æ¡æ•°æ®</span></span><br><span class="line">                .forEach(System.out::println);<span class="comment">//å°†ä»–éå†å‡ºæ¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ForkJoin">ForkJoin</h4><p>ForkJoinåœ¨JDK1.7ä¸­ï¼Œå¹¶è¡Œæ‰§è¡Œä»»åŠ¡ï¼Œæäº¤æ•ˆç‡ï¼Œä¸€èˆ¬é€šç”¨äºå¤§æ•°æ®é‡ï¼</p><p>å¤§æ•°æ®ï¼šMap Reduceï¼ˆæŠŠå¤§ä»»åŠ¡æ‹†åˆ†ä¸ºå°ä»»åŠ¡ï¼‰</p><p><strong>ForkJoinç‰¹ç‚¹</strong></p><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">      <span class="comment">// test1();</span></span><br><span class="line">        <span class="comment">//test2();</span></span><br><span class="line">        test3(); <span class="comment">//è´¼å¼ºï¼Œé€Ÿåº¦å¾ˆå¿«ä¸€èˆ¬å¤§å‹çš„æ—¶å€™ä½¿ç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ™®é€šç¨‹åºå‘˜</span></span><br><span class="line">    <span class="comment">// Sum=æ—¶é—´4099</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1L</span>; i &lt;= <span class="number">10_0000_0000</span>; i++) &#123;</span><br><span class="line">            sum +=  i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Sum=&quot;</span>+sum+<span class="string">&quot;æ—¶é—´\t&quot;</span> + (end -start));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸­çº§ç¨‹åºå‘˜</span></span><br><span class="line">    <span class="comment">//Sum=æ—¶é—´11302</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">ForkJoinPool</span> <span class="variable">forkJoinPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ForkJoinPool</span>();</span><br><span class="line">        ForkJoinTask&lt;Long&gt; task = <span class="keyword">new</span> <span class="title class_">ForkJoinDemo</span>(<span class="number">1L</span>,<span class="number">10_0000_0000L</span>);</span><br><span class="line">        forkJoinPool.execute(task);</span><br><span class="line">       ForkJoinTask&lt;Long&gt; submit = forkJoinPool.submit(task);<span class="comment">//æäº¤ä»»åŠ¡</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">sum</span> <span class="operator">=</span> submit.get();</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;Sum=&quot;</span>+<span class="string">&quot;æ—¶é—´&quot;</span> + (end -start));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">//å¹¶è¡Œæµ  æ—¶é—´241</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">Long</span> <span class="variable">sum</span> <span class="operator">=</span> LongStream.rangeClosed(<span class="number">0L</span>,<span class="number">10_0000_0000L</span>).parallel().reduce(<span class="number">0</span>,Long::sum);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;Sum=&quot;</span>+sum + <span class="string">&quot;\næ—¶é—´&quot;</span> + (end -start));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¼‚æ­¥å›è°ƒ">å¼‚æ­¥å›è°ƒ</h4><blockquote><p>Futureè®¾è®¡åˆè¡·ï¼Œå¯¹å°†æ¥æŸä¸ªäº‹ä»¶ç»“æœè¿›è¡Œå»ºæ¨¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å¼‚æ­¥è°ƒç”¨ajaxæŠ€æœ¯ï¼Œä¸€èˆ¬ä¸Šajaxä½¿ç”¨åŸç†å°±å¼‚æ­¥è°ƒç”¨</span></span><br><span class="line"><span class="comment">å¼‚æ­¥æ‰§è¡Œï¼š</span></span><br><span class="line"><span class="comment">æˆåŠŸå›è°ƒ</span></span><br><span class="line"><span class="comment">å¤±è´¥å›è°ƒ</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FutureDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">//å‘é€ä¸€ä¸ªè¯·æ±‚  ï¼Œæ²¡æœ‰è¿”å›å€¼çš„å¼‚æ­¥å›è°ƒ</span></span><br><span class="line">        CompletableFuture&lt;Void&gt; completableFuture = CompletableFuture.runAsync(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;RunAsny=&gt;Void&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(<span class="string">&quot;111&quot;</span>);</span><br><span class="line">        completableFuture.get();<span class="comment">//è·å–æ‰§è¡Œç»“æœ</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;=================================&quot;</span>);</span><br><span class="line">        <span class="comment">//æœ‰è¿”å›å€¼çš„å¼‚æ­¥å›è°ƒ</span></span><br><span class="line">        <span class="comment">//æœ‰è¿”å›å€¼çš„æ˜¯supplyAsyncå¼‚æ­¥å›è°ƒ</span></span><br><span class="line">        <span class="comment">//ajaxï¼ŒæˆåŠŸå’Œå¤±è´¥çš„å›è°ƒ</span></span><br><span class="line">        <span class="comment">//è¿”å›çš„æ˜¯é”™è¯¯çš„ä¿¡æ¯ã€‚</span></span><br><span class="line">      CompletableFuture&lt;Integer&gt; completableFuture1 =   CompletableFuture.supplyAsync(()-&gt;&#123;</span><br><span class="line">          System.out.println(Thread.currentThread().getName() + <span class="string">&quot;supplyAsync=&gt;Integer&quot;</span>);</span><br><span class="line">           <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span>  <span class="number">4</span>/<span class="number">0</span>;</span><br><span class="line">           <span class="keyword">return</span> <span class="number">1024</span> ;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">      completableFuture1.whenComplete((t,u)-&gt;&#123;</span><br><span class="line">          System.out.println( <span class="string">&quot; --&gt; &quot;</span> +t); <span class="comment">//æ­£ç¡®çš„è¿”å›ç»“æœ</span></span><br><span class="line">          System.out.println( <span class="string">&quot; -- &gt;&quot;</span> + u);  <span class="comment">//é”™è¯¯ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">      &#125;).exceptionally((e)-&gt;&#123;</span><br><span class="line">          System.out.println(e.getMessage());</span><br><span class="line">          <span class="keyword">return</span> <span class="number">444</span>; <span class="comment">//å¯ä»¥é€šè¿‡è¿™ä¸ªæ ‡è¯†ç è·å–é”™è¯¯çš„è¿”å›ç»“æœ</span></span><br><span class="line">      &#125;).get();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="JVMåˆæ­¥ç†è§£">JVMåˆæ­¥ç†è§£</h4><blockquote><p>è°ˆè°ˆä½ å¯¹Volatileçš„ç†è§£</p></blockquote><p>volatileæ˜¯javaJVMæä¾›çš„è½»é‡çº§çš„åŒæ­¥æœºåˆ¶</p><ol><li>ä¿è¯å¯è§æ€§</li><li><strong>ä¸ä¿è¯åŸå­æ€§</strong></li><li>é™æ­¢æŒ‡ä»¤é‡æ’</li></ol><p>JMMï¼šjavaå†…å­˜æ¨¡å‹ï¼Œä¸å­˜åœ¨çš„ä¸œè¥¿ï¼Œå°±æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼çº¦å®š****</p><p><strong>å…³äºJMMçš„ä¸€äº›åŒæ­¥çš„çº¦å®š</strong></p><ol><li>çº¿ç¨‹è§£é”å‰ï¼Œå¿…é¡»æŠŠå…±äº«å˜é‡<strong>ç«‹åˆ»</strong> åˆ·å›ä¸»å­˜ã€‚</li><li>çº¿ç¨‹åŠ é”å‰ï¼Œå¿…é¡»è¯»å–ä¸»å­˜ä¸­çš„æœ€æ–°å€¼åˆ°å·¥ä½œå†…å­˜ä¸­ã€‚</li><li>åŠ é”å’Œè§£é”æ˜¯åŒä¸€æŠŠé”ã€‚</li></ol><p>çº¿ç¨‹å·¥ä½œå†…å­˜ï¼Œä¸»å†…å­˜</p><p>jvmçš„8ç§æ“ä½œï¼š</p><ol><li>read - &gt; load</li><li>user -&gt; assign</li><li>write -&gt;store</li><li>lock -&gt; unlock</li></ol><p><strong>å†…å­˜äº¤äº’æ“ä½œæœ‰8ç§ï¼Œè™šæ‹Ÿæœºå®ç°å¿…é¡»ä¿è¯æ¯ä¸€ä¸ªæ“ä½œéƒ½æ˜¯åŸå­çš„ï¼Œä¸å¯åœ¨åˆ†çš„ï¼ˆå¯¹äºdoubleå’Œlongç±» å‹çš„å˜é‡æ¥è¯´ï¼Œloadã€storeã€readå’Œwriteæ“ä½œåœ¨æŸäº›å¹³å°ä¸Šå…è®¸ä¾‹å¤–ï¼‰</strong></p><blockquote><p>lock ï¼ˆé”å®šï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªå˜é‡æ ‡è¯†ä¸ºçº¿ç¨‹ç‹¬å çŠ¶æ€</p><p>unlock ï¼ˆè§£é”ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡ æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®š</p><p>read ï¼ˆè¯»å–ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿ éšåçš„loadåŠ¨ä½œä½¿ç”¨</p><p>load ï¼ˆè½½å…¥ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠreadæ“ä½œä»ä¸»å­˜ä¸­å˜é‡æ”¾å…¥å·¥ä½œå†…å­˜ä¸­</p><p>use ï¼ˆä½¿ç”¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ä¼ è¾“ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœº é‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨åˆ°å˜é‡çš„å€¼ï¼Œå°±ä¼šä½¿ç”¨åˆ°è¿™ä¸ªæŒ‡ä»¤</p><p>assign ï¼ˆèµ‹å€¼ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“ä¸­æ¥å—åˆ°çš„å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜ é‡å‰¯æœ¬ä¸­</p><p>store ï¼ˆå­˜å‚¨ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜ä¸­çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»å·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œ</p></blockquote><p><strong>ä»¥ä¾¿åç»­çš„writeä½¿ç”¨write ï¼ˆå†™å…¥ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜ä¸­çš„å˜é‡ï¼Œå®ƒæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡çš„å€¼æ”¾å…¥ä¸»å†… å­˜çš„å˜é‡ä¸­</strong></p><p><strong>JMMå¯¹è¿™å…«ç§æŒ‡ä»¤çš„ä½¿ç”¨ï¼Œåˆ¶å®šäº†å¦‚ä¸‹è§„åˆ™</strong>ï¼š</p><ul><li>ä¸å…è®¸readå’Œloadã€storeå’Œwriteæ“ä½œä¹‹ä¸€å•ç‹¬å‡ºç°ã€‚å³ä½¿ç”¨äº†readå¿…é¡»loadï¼Œä½¿ç”¨äº†storeå¿…é¡» write</li><li>ä¸å…è®¸çº¿ç¨‹ä¸¢å¼ƒä»–æœ€è¿‘çš„assignæ“ä½œï¼Œå³å·¥ä½œå˜é‡çš„æ•°æ®æ”¹å˜äº†ä¹‹åï¼Œå¿…é¡»å‘ŠçŸ¥ä¸»å­˜</li><li>ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹å°†æ²¡æœ‰assignçš„æ•°æ®ä»å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜</li><li>ä¸€ä¸ªæ–°çš„å˜é‡å¿…é¡»åœ¨ä¸»å†…å­˜ä¸­è¯ç”Ÿï¼Œä¸å…è®¸å·¥ä½œå†…å­˜ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–çš„å˜é‡ã€‚å°±æ˜¯æ€¼å˜é‡ å®æ–½useã€storeæ“ä½œä¹‹å‰ï¼Œå¿…é¡»ç»è¿‡assignå’Œloadæ“ä½œ</li><li>ä¸€ä¸ªå˜é‡åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¯¹å…¶è¿›è¡Œlockã€‚å¤šæ¬¡lockåï¼Œå¿…é¡»æ‰§è¡Œç›¸åŒæ¬¡æ•°çš„unlockæ‰èƒ½è§£ é”</li><li>å¦‚æœå¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œlockæ“ä½œï¼Œä¼šæ¸…ç©ºæ‰€æœ‰å·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ï¼Œåœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨è¿™ä¸ªå˜é‡å‰ï¼Œ å¿…é¡»é‡æ–°loadæˆ–assignæ“ä½œåˆå§‹åŒ–å˜é‡çš„å€¼</li><li>å¦‚æœä¸€ä¸ªå˜é‡æ²¡æœ‰è¢«lockï¼Œå°±ä¸èƒ½å¯¹å…¶è¿›è¡Œunlockæ“ä½œã€‚ä¹Ÿä¸èƒ½unlockä¸€ä¸ªè¢«å…¶ä»–çº¿ç¨‹é”ä½çš„å˜é‡ å¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œunlockæ“ä½œä¹‹å‰ï¼Œå¿…é¡»æŠŠæ­¤å˜é‡åŒæ­¥å›ä¸»å†…å­˜</li></ul><h4 id="Volatile">Volatile</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">åœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬å‘ç°ï¼Œå½“æ‰§è¡Œçº¿ç¨‹çš„æ—¶å€™ï¼Œnum =0æ˜¯ä¸€å¼€å§‹çš„æ—¶å€™ï¼Œä¹‹åæˆ‘ä»¬å°†</span></span><br><span class="line"><span class="comment">æ”¹æˆnum = 1ï¼Œä½†æ˜¯ç¨‹åºè¾“å‡º1å´æ²¡æœ‰ç»ˆæ­¢</span></span><br><span class="line"><span class="comment">è¿™é‡ŒåŸå› æ˜¯ï¼Œæˆ‘ä»¬æ›´æ”¹äº†numçš„å€¼ï¼Œä½†æ˜¯çº¿ç¨‹BçŸ¥é“è€Œçº¿ç¨‹Aå´ä¸çŸ¥é“</span></span><br><span class="line"><span class="comment">ä¹Ÿå°±æ˜¯mainçº¿ç¨‹çŸ¥é“ï¼Œä½†æ˜¯Threadçº¿ç¨‹å´æ˜¯ä¸çŸ¥é“</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VolatileDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">static</span>  <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>( ()-&gt;&#123;</span><br><span class="line">            <span class="keyword">while</span> (num == <span class="number">0</span>)&#123;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        num =<span class="number">1</span>;</span><br><span class="line">        System.out.println(num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>éªŒè¯ç‰¹æ€§</p></blockquote><ul><li>ä¿è¯å¯è§æ€§</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">åœ¨è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬å‘ç°ï¼Œå½“æ‰§è¡Œçº¿ç¨‹çš„æ—¶å€™ï¼Œnum =0æ˜¯ä¸€å¼€å§‹çš„æ—¶å€™ï¼Œä¹‹åæˆ‘ä»¬å°†</span></span><br><span class="line"><span class="comment">æ”¹æˆnum = 1ï¼Œä½†æ˜¯ç¨‹åºè¾“å‡º1å´æ²¡æœ‰ç»ˆæ­¢</span></span><br><span class="line"><span class="comment">è¿™é‡ŒåŸå› æ˜¯ï¼Œæˆ‘ä»¬æ›´æ”¹äº†numçš„å€¼ï¼Œä½†æ˜¯çº¿ç¨‹BçŸ¥é“è€Œçº¿ç¨‹Aå´ä¸çŸ¥é“</span></span><br><span class="line"><span class="comment">ä¹Ÿå°±æ˜¯mainçº¿ç¨‹çŸ¥é“ï¼Œä½†æ˜¯Threadçº¿ç¨‹å´æ˜¯ä¸çŸ¥é“</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VolatileDemo</span> &#123;</span><br><span class="line">    <span class="comment">//ä¸åŠ volatileå°±ä¼šé™·å…¥æ— é™å¾ªç¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span>   <span class="keyword">static</span>  <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>( ()-&gt;&#123;</span><br><span class="line">            <span class="keyword">while</span> (num == <span class="number">0</span>)&#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        num =<span class="number">1</span>;</span><br><span class="line">        System.out.println(num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>ä¸ä¿è¯åŸå­æ€§ï¼šä¸å¯åˆ†å‰²</li></ul><p>åŸå­æ€§ï¼š çº¿ç¨‹Aåœ¨æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ï¼Œä¸èƒ½è¢«æ‰“æ‰°åˆ°ï¼Œä¹Ÿä¸èƒ½è¢«åˆ†å‰²ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸ä¿è¯åŸå­æ€§</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VolatileDemo2</span> &#123;</span><br><span class="line">    <span class="comment">//è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œvolatileæ— æ³•ä¿è¯åŸå­æ€§</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span>   <span class="keyword">static</span>  <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//synchronizedå¯ä¿è¯ä¸ºç»“æœä¸º20000</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">void</span>  <span class="title function_">add</span><span class="params">()</span>&#123;</span><br><span class="line">        num ++; <span class="comment">// ä¸æ˜¯åŸå­æ€§</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="comment">//ç†è®ºä¸Šnum ä¸º20000</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">1000</span>; j++) &#123;</span><br><span class="line">                    add();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        javaä¸­é»˜è®¤ä¸¤ä¸ªçº¿ç¨‹ï¼Œç¬¬ä¸€ä¸ªmain,ç¬¬äºŒä¸ªGCçº¿ç¨‹</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">while</span> (Thread.activeCount()&gt;<span class="number">2</span>)&#123;</span><br><span class="line">            Thread.<span class="keyword">yield</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;  &quot;</span> + num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸ä¿è¯åŸå­æ€§</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VolatileDemo2</span> &#123;</span><br><span class="line">    <span class="comment">//è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œvolatileæ— æ³•ä¿è¯åŸå­æ€§</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span>   <span class="keyword">static</span>  <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//synchronizedå¯ä¿è¯ä¸ºç»“æœä¸º20000</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//æˆ‘ä»¬æ­¤æ—¶å‘ç°ï¼Œlockä¹Ÿå¯ä»¥ä¿è¯ç»“æœä¸º20000</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">void</span>  <span class="title function_">add</span><span class="params">()</span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            num ++;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="comment">//ç†è®ºä¸Šnum ä¸º20000</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">1000</span>; j++) &#123;</span><br><span class="line">                    add();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        javaä¸­é»˜è®¤ä¸¤ä¸ªçº¿ç¨‹ï¼Œç¬¬ä¸€ä¸ªmain,ç¬¬äºŒä¸ªGCçº¿ç¨‹</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">while</span> (Thread.activeCount()&gt;<span class="number">2</span>)&#123;</span><br><span class="line">            Thread.<span class="keyword">yield</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;  &quot;</span> + num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>å¦‚æœä¸åŠ Lockå’Œsynochronizedå¦‚ä½•ä¿è¯åŸå­æ€§ã€‚</strong></p><p>ä½¿ç”¨åŸå­ç±»è§£å†³åŸå­æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸ä¿è¯åŸå­æ€§</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VolatileDemo2</span> &#123;</span><br><span class="line">    <span class="comment">//è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œvolatileæ— æ³•ä¿è¯åŸå­æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//    private volatile   static  int num = 0;</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span>  <span class="keyword">static</span> <span class="type">AtomicInteger</span> <span class="variable">num</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//synchronizedå¯ä¿è¯ä¸ºç»“æœä¸º20000</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//æˆ‘ä»¬æ­¤æ—¶å‘ç°ï¼Œlockä¹Ÿå¯ä»¥ä¿è¯ç»“æœä¸º20000</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">void</span>  <span class="title function_">add</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">/*    lock.lock();</span></span><br><span class="line"><span class="comment">        try&#123;</span></span><br><span class="line"><span class="comment">            num ++;</span></span><br><span class="line"><span class="comment">        &#125;catch (Exception e)&#123;</span></span><br><span class="line"><span class="comment">            e.printStackTrace();</span></span><br><span class="line"><span class="comment">        &#125;finally &#123;</span></span><br><span class="line"><span class="comment">            lock.unlock();</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">        num.getAndIncrement(); <span class="comment">//AtomicInteger +1æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="comment">//ç†è®ºä¸Šnum ä¸º20000</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">1000</span>; j++) &#123;</span><br><span class="line">                    add();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        javaä¸­é»˜è®¤ä¸¤ä¸ªçº¿ç¨‹ï¼Œç¬¬ä¸€ä¸ªmain,ç¬¬äºŒä¸ªGCçº¿ç¨‹</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">while</span> (Thread.activeCount()&gt;<span class="number">2</span>)&#123;</span><br><span class="line">            Thread.<span class="keyword">yield</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;  &quot;</span> + num);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™äº›ç±»çš„åº•å±‚éƒ½æ˜¯å’Œæ“ä½œç³»ç»ŸæŒ‚é’©ï¼Œåœ¨å†…å­˜ä¸­ä¿®æ”¹ä¸­ï¼ŒUnsafeæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å­˜åœ¨ã€‚</p><blockquote><p>æŒ‡ä»¤é‡æ’</p></blockquote><p>ä»€ä¹ˆæ˜¯æŒ‡ä»¤é‡æ’ï¼šä½ å†™çš„ç¨‹åºï¼Œè®¡ç®—æœºå¹¶ä¸æ˜¯æŒ‰ç…§ä½ å†™çš„ç¨‹åºé‚£æ ·å»æ‰§è¡Œçš„ã€‚</p><p>æºä»£ç  - â€“  ç¼–è¯‘å™¨é‡Œè¾¹çš„ä¼˜åŒ–çš„é‡æ’ ------  æŒ‡ä»¤å¹¶è¡Œä¹Ÿå¯èƒ½ä¼šé‡æ’ â€“  å†…å­˜ç³»ç»Ÿä¹Ÿä¼šé‡æ’-----æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">//1</span></span><br><span class="line"><span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">2</span>;<span class="comment">//2</span></span><br><span class="line">x = x+ <span class="number">5</span>;<span class="comment">// 3</span></span><br><span class="line">y = x +x;  <span class="comment">// 4</span></span><br><span class="line"><span class="comment">//æˆ‘ä»¬å¸Œæœ›çš„é¡ºåºæ˜¯ 1234   å¯èƒ½æ˜¯ 1234  2134 1324 ä½†ä¸å¯èƒ½æ˜¯ 4123</span></span><br></pre></td></tr></table></figure><p>å¯èƒ½é€ æˆå½±å“çš„ç»“æœï¼š a b x y è¿™å››ä¸ªå€¼ é»˜è®¤éƒ½æ˜¯ 0</p><table><thead><tr><th>çº¿ç¨‹A</th><th>çº¿ç¨‹B</th></tr></thead><tbody><tr><td>x =a</td><td>y =b</td></tr><tr><td>b =1</td><td>a = 2</td></tr><tr><td></td><td></td></tr></tbody></table><p>æ­£å¸¸çš„ç»“æœ x = 0; y = 0;</p><p><strong>volatileå¯ä»¥é¿å…æŒ‡ä»¤é‡æ’</strong></p><p>å†…å­˜å±éšœï¼ŒCPUæŒ‡ä»¤ï¼Œä½œç”¨ï¼š</p><ol><li>ä¿è¯ç‰¹å®šçš„æ“ä½œæ‰§è¡Œé¡ºåº</li><li>ä¿è¯æŸäº›å˜é‡çš„å†…å­˜å¯è§æ€§ï¼ˆåˆ©ç”¨è¿™äº›ç‰¹æ€§Volatileå®ç°å¯è§æ€§ï¼‰</li></ol><p>volatileå¯ä¿è¯å¯è§æ€§ï¼Œä¸èƒ½ä¿è¯åŸå­æ€§ï¼Œç”±äºå†…å­˜å±éšœï¼Œå¯ä»¥é¿å…æŒ‡ä»¤é‡æ’çš„ç°è±¡äº§ç”Ÿã€‚</p><p><strong>å†…å­˜å±éšœä½¿ç”¨æœ€å¤šçš„åœºæ™¯æ˜¯å•ä¾‹æ¨¡å¼</strong></p><h4 id="å•ä¾‹æ¨¡å¼">å•ä¾‹æ¨¡å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingleDemo</span> &#123;</span><br><span class="line">    <span class="comment">//é¥¿æ±‰å¼å•ä¾‹è¿™äº›æ•°æ®éƒ½æ²¡æœ‰ä½¿ç”¨ï¼Œä½†æ˜¯è¢«åˆ›å»ºçš„æ—¶å€™è¿˜æ˜¯å ç”¨å¾ˆå¤šå†…å­˜</span></span><br><span class="line">    <span class="keyword">private</span>  <span class="type">byte</span>[] d1 =  <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>* <span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">private</span>  <span class="type">byte</span>[] d2 =  <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>* <span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">private</span>  <span class="type">byte</span>[] d3 =  <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>* <span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">private</span>  <span class="type">byte</span>[] d4 =  <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>* <span class="number">1024</span>];</span><br><span class="line">    <span class="comment">//æ— å‚æ„é€  åªè¦æ˜¯å•ä¾‹ï¼Œæˆ‘ä»¬éƒ½è¦åˆ›å»ºä¸€ä¸ªç§æœ‰åŒ–æ„é€ </span></span><br><span class="line">    <span class="keyword">private</span>  <span class="title function_">SingleDemo</span><span class="params">()</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å•ä¾‹æ¨¡å¼çš„è°ƒç”¨æ–¹å¼</span></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">static</span>  <span class="type">SingleDemo</span> <span class="variable">singleDemo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingleDemo</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  SingleDemo <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  singleDemo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Title æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼</span></span><br><span class="line"><span class="comment"> * @Description </span></span><br><span class="line"><span class="comment"> * @author  ç½—å°é»‘</span></span><br><span class="line"><span class="comment"> * @param null</span></span><br><span class="line"><span class="comment"> * @return </span></span><br><span class="line"><span class="comment"> * @date 2022/10/9 0:04</span></span><br><span class="line"><span class="comment"> * @email 2844135670@qq.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LazyDemo</span> &#123;</span><br><span class="line">    <span class="comment">//ä¸è¯´äºŒè¯ç›´æ¥æ•´ä¸Šæ„é€ å™¨,åªè¦æ˜¯å•ä¾‹æ¨¡å¼ï¼Œæ„é€ å™¨ç§æœ‰</span></span><br><span class="line">    <span class="keyword">private</span>  <span class="title function_">LazyDemo</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;\t OK&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment">//å…ˆåˆ›å»ºä¸€ä¸ªlazyå¯¹è±¡ï¼Œä¸ºä¿è¯ä¸ä¼šäº§ç”ŸæŒ‡ä»¤é‡æ’ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿™åŠ å…¥volatile</span></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">volatile</span> <span class="keyword">static</span>  LazyDemo lazyDemo;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @Title åŒé‡æ£€æµ‹æ¨¡å¼ä¸‹çš„æ‡’æ±‰å¼å•ä¾‹ï¼ŒDCLæ‡’æ±‰å¼</span></span><br><span class="line"><span class="comment"> * @Description</span></span><br><span class="line"><span class="comment"> * @author  ç½—å°é»‘</span></span><br><span class="line"><span class="comment"> * @return com.xh.juc.day06.Single.LazyDemo</span></span><br><span class="line"><span class="comment"> * @date 2022/10/9 0:15</span></span><br><span class="line"><span class="comment"> * @email 2844135670@qq.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    <span class="comment">//é‡ç‚¹æ˜¯getInstanceåœ¨å•ä¾‹æ¨¡å¼ä¸­æˆ‘ä»¬ç›´æ¥ä½¿ç”¨çš„æ˜¯getInstance()</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span>  LazyDemo <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//è§£å†³åŠæ³•ä¹‹ä¸€æœ€å¸¸ç”¨çš„åŠ é”ã€‚</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(lazyDemo == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (LazyDemo.class)&#123;</span><br><span class="line">                lazyDemo = <span class="keyword">new</span> <span class="title class_">LazyDemo</span>(); <span class="comment">//ä¸æ˜¯ä¸€ä¸ªåŸå­æ€§æ“ä½œ</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    æœ‰ä¸‰æ­¥ï¼š</span></span><br><span class="line"><span class="comment">           1. åˆ†é…å†…å­˜ç©ºé—´</span></span><br><span class="line"><span class="comment">           2. æ‰§è¡Œæ„é€ æ–¹æ³•ï¼Œåˆå§‹åŒ–å¯¹è±¡</span></span><br><span class="line"><span class="comment">           3.æŠŠè¿™ä¸ªå¯¹è±¡æŒ‡å‘è¿™ä¸ªç©ºé—´</span></span><br><span class="line"><span class="comment">           è¿™ä¸ªæ—¶å€™å¯èƒ½ä¼šäº§ç”ŸæŒ‡ä»¤é‡æ’ï¼Œä¼šå‡ºç°æ•…éšœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å¦‚æœä¼ å¦‚çš„å¯¹è±¡ä¸ºç©ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å°†å¯¹çˆ±å¿ƒç»™ä»–èµ‹äºˆ</span></span><br><span class="line">            <span class="comment">//   lazyDemo = new LazyDemo();</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> lazyDemo;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//é—®é¢˜ï¼Œå•çº¿ç¨‹ä¸‹æ²¡é—®é¢˜ï¼Œä½†æ˜¯å¤šçº¿æ€§ä¸‹å‡ºç°é—®é¢˜.</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬å‘ç°åœ¨å¤šçº¿ç¨‹ä¸‹ä¼šäº§ç”Ÿä¸ä¸€æ ·çš„ç»“æœï¼Œè€Œä¸”ä¹Ÿä¸ä¼šåˆ›å»º10ä¸ªçº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                LazyDemo.getInstance();</span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é™æ€å†…éƒ¨ç±» </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Holder</span> &#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Holder</span><span class="params">()</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Holder <span class="title function_">getInstace</span><span class="params">()</span>&#123; </span><br><span class="line">        <span class="keyword">return</span> InnerClass.HOLDER;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">InnerClass</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Holder</span> <span class="variable">HOLDER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Holder</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å•ä¾‹ä¸å®‰å…¨ï¼Œåå°„</span></span><br><span class="line"><span class="comment">//æšä¸¾</span></span><br><span class="line"> <span class="comment">// enum æ˜¯ä¸€ä¸ªä»€ä¹ˆï¼Ÿ æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªClassç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">EnumSingle</span> &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">    <span class="keyword">public</span> EnumSingle <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException &#123; </span><br><span class="line">        <span class="type">EnumSingle</span> <span class="variable">instance1</span> <span class="operator">=</span> EnumSingle.INSTANCE; </span><br><span class="line">        Constructor&lt;EnumSingle&gt; declaredConstructor = EnumSingle.class.getDeclaredConstructor(String.class,<span class="type">int</span>.class); </span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">EnumSingle</span> <span class="variable">instance2</span> <span class="operator">=</span> declaredConstructor.newInstance();</span><br><span class="line">        <span class="comment">// NoSuchMethodException: com.kuang.single.EnumSingle.&lt;init&gt;() </span></span><br><span class="line">        System.out.println(instance1);</span><br><span class="line">        System.out.println(instance2);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="CAS">CAS</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CASDemo</span> &#123;</span><br><span class="line">    <span class="comment">//CAS compareAndSet ï¼š æ¯”è¾ƒå¹¶äº¤æ¢</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AtomicInteger</span> <span class="variable">atomicInteger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">2022</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æœŸæœ›ï¼Œæ›´æ–°</span></span><br><span class="line">       <span class="comment">// public final boolean compareAndSet(int expect,int update);</span></span><br><span class="line">        <span class="comment">//å¦‚æœæˆ‘æœŸæœ›çš„å€¼è¾¾åˆ°äº†ï¼Œé‚£ä¹ˆå°±æ›´æ–°ï¼Œå¦åˆ™ä¸æ›´æ–° CASæ˜¯CPUçš„è°ƒåº¦</span></span><br><span class="line">        <span class="comment">//java æ— æ³•æ“ä½œå†…å­˜ï¼Œjavaå¯ä»¥è°ƒç”¨C++ native  C++å¯ä»¥æ“ä½œå†…å­˜ï¼Œjavaçš„åé—¨ï¼Œå¯ä»¥æ“ä½œè¿™ä¸ªç±»ï¼ˆUnsafeï¼‰è°ƒåº¦</span></span><br><span class="line">        System.out.println(atomicInteger.compareAndSet(<span class="number">2022</span>, <span class="number">2123</span>));</span><br><span class="line">        System.out.println(atomicInteger.get());</span><br><span class="line"></span><br><span class="line">        System.out.println(atomicInteger.compareAndSet(<span class="number">2020</span>, <span class="number">2021</span>));</span><br><span class="line">        System.out.println(atomicInteger.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CAS:æ¯”è¾ƒå½“å‰å·¥ä½œå†…å­˜ä¸­çš„å€¼å’Œä¸»å†…å­˜çš„å€¼ï¼Œå¦‚æœè¿™ä¸ªå€¼æ˜¯æœŸæœ›çš„ï¼Œé‚£ä¹ˆæ‰§è¡Œæ“ä½œï¼Œå¦‚æœä¸æ˜¯å°±ä¸€ç›´å¾ªç¯</p><p><strong>ç¼ºç‚¹:</strong></p><ol><li>å¾ªç¯ä¼šè€—æ—¶</li><li>ä¸€æ¬¡æ€§åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ€§</li><li>ABAé—®é¢˜</li></ol><blockquote><p>CAS:ABAé—®é¢˜ï¼ˆç‹¸çŒ«æ¢å¤ªå­ï¼‰</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CASDemo</span> &#123;</span><br><span class="line">    <span class="comment">//CAS compareAndSet ï¼š æ¯”è¾ƒå¹¶äº¤æ¢</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AtomicInteger</span> <span class="variable">atomicInteger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">2022</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æœŸæœ›ï¼Œæ›´æ–°</span></span><br><span class="line">       <span class="comment">// public final boolean compareAndSet(int expect,int update);</span></span><br><span class="line">        <span class="comment">//å¦‚æœæˆ‘æœŸæœ›çš„å€¼è¾¾åˆ°äº†ï¼Œé‚£ä¹ˆå°±æ›´æ–°ï¼Œå¦åˆ™ä¸æ›´æ–° CASæ˜¯CPUçš„è°ƒåº¦</span></span><br><span class="line">        <span class="comment">//java æ— æ³•æ“ä½œå†…å­˜ï¼Œjavaå¯ä»¥è°ƒç”¨C++ native  C++å¯ä»¥æ“ä½œå†…å­˜ï¼Œjavaçš„åé—¨ï¼Œå¯ä»¥æ“ä½œè¿™ä¸ªç±»ï¼ˆUnsafeï¼‰è°ƒåº¦</span></span><br><span class="line">        <span class="comment">//(A)</span></span><br><span class="line">        System.out.println(atomicInteger.compareAndSet(<span class="number">2022</span>, <span class="number">2123</span>));</span><br><span class="line">        System.out.println(atomicInteger.get());</span><br><span class="line"><span class="comment">// B</span></span><br><span class="line">        System.out.println(atomicInteger.compareAndSet(<span class="number">2123</span>, <span class="number">2022</span>));</span><br><span class="line">        System.out.println(atomicInteger.get());</span><br><span class="line">    <span class="comment">//A    </span></span><br><span class="line">        System.out.println(atomicInteger.compareAndSet(<span class="number">2022</span>, <span class="number">2123</span>));</span><br><span class="line">        System.out.println(atomicInteger.get());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŸå­å¼•ç”¨ï¼ˆABAé—®é¢˜ï¼‰">åŸå­å¼•ç”¨ï¼ˆABAé—®é¢˜ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¹è§‚é”å’Œæ‚²è§‚é”</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CASDemo2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//æ³¨æ„å¦‚æœæ³›å‹æ˜¯åŒ…è£…ç±»ï¼Œéœ€è¦æ³¨æ„å¼•ç”¨ç±»å‹å’ŒèŒƒå›´Integerçš„èŒƒå›´æ˜¯-128 åˆ° 127</span></span><br><span class="line">        <span class="comment">//æ­£å¸¸çš„åº”ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„éƒ½æ˜¯å¯¹è±¡ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨Integerçš„ç­‰ï¼Œ</span></span><br><span class="line">        AtomicStampedReference&lt;Integer&gt; atomicStampedReference = <span class="keyword">new</span> <span class="title class_">AtomicStampedReference</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">stamp</span> <span class="operator">=</span> atomicStampedReference.getStamp();<span class="comment">//è·å–ç‰ˆæœ¬å·</span></span><br><span class="line">            System.out.println( Thread.currentThread().getName()+ <span class="string">&quot; &quot;</span> + atomicStampedReference.getStamp());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(atomicStampedReference.compareAndSet(</span><br><span class="line">                    <span class="number">1</span>, <span class="number">5</span>,</span><br><span class="line">                    atomicStampedReference.getStamp(),</span><br><span class="line">                    atomicStampedReference.getStamp() + <span class="number">1</span>));</span><br><span class="line">            System.out.println( Thread.currentThread().getName()+ <span class="string">&quot; -A2- &quot;</span> + atomicStampedReference.getStamp());</span><br><span class="line"></span><br><span class="line">            System.out.println(atomicStampedReference.compareAndSet(</span><br><span class="line">                    <span class="number">5</span>, <span class="number">6</span>,</span><br><span class="line">                    atomicStampedReference.getStamp(),</span><br><span class="line">                    atomicStampedReference.getStamp() + <span class="number">1</span>));</span><br><span class="line">            System.out.println( Thread.currentThread().getName()+ <span class="string">&quot; -A3- &quot;</span> + atomicStampedReference.getStamp());</span><br><span class="line"></span><br><span class="line">        &#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¯”è¾ƒABä¸¤ä¸ªçº¿ç¨‹çš„ç‰ˆæœ¬å·</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">stamp</span> <span class="operator">=</span> atomicStampedReference.getStamp();<span class="comment">//è·å–ç‰ˆæœ¬å·</span></span><br><span class="line">            System.out.println( Thread.currentThread().getName()+ <span class="string">&quot; &quot;</span> + atomicStampedReference.getStamp());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(atomicStampedReference.compareAndSet(<span class="number">2020</span>, <span class="number">6666</span>,</span><br><span class="line">                    stamp, stamp + <span class="number">1</span>));</span><br><span class="line">            System.out.println( Thread.currentThread().getName()+ <span class="string">&quot; -B2- &quot;</span> + atomicStampedReference.getStamp());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é”æœºåˆ¶çš„äº†è§£">é”æœºåˆ¶çš„äº†è§£</h4><h5 id="å…¬å¹³é”ï¼ˆåŒ…å«è¯»å†™é”ï¼‰">å…¬å¹³é”ï¼ˆåŒ…å«è¯»å†™é”ï¼‰</h5><p>å…¬å¹³é”ï¼šéå¸¸å…¬å¹³ï¼Œä¸èƒ½æ’é˜Ÿï¼Œå¿…é¡»å…ˆæ¥å…ˆåˆ°</p><p>éå…¬å¹³é”ï¼šjavaè‡ªå¸¦é»˜è®¤éå…¬å¹³é”ï¼Œå¯ä»¥æ’é˜Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//javaæºç </span></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">ReentrantLock</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">//æˆ‘ä»¬å‘ç°ï¼Œè¿™é‡Œé»˜è®¤å°±æ˜¯ä¸å…¬å¹³é”</span></span><br><span class="line">        sync = <span class="keyword">new</span> <span class="title class_">NonfairSync</span>();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> class å…¬å¹³é” &#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºä¸€ä¸ªå…¬å¹³é”</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//synchronized</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Phone</span> <span class="variable">phone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone</span>();</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                phone.sms();</span><br><span class="line">            &#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">            <span class="keyword">new</span>  <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">                phone.sms();</span><br><span class="line">            &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span>  <span class="title class_">Phone</span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">synchronized</span>  <span class="keyword">void</span> <span class="title function_">sms</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;å‘çŸ­ä¿¡&quot;</span>);</span><br><span class="line">        call();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">synchronized</span>  <span class="keyword">void</span>  <span class="title function_">call</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;æ‰“ç”µè¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LockDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Phone2</span> <span class="variable">phone2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Phone2</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            phone2.sms();</span><br><span class="line">        &#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            phone2.sms();</span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;=====================&quot;</span>);</span><br><span class="line">        <span class="type">Test</span> <span class="variable">te</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            te.sms();</span><br><span class="line">        &#125;,<span class="string">&quot;C&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            te.sms();</span><br><span class="line">        &#125;,<span class="string">&quot;D&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Phone2</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title function_">sms</span><span class="params">()</span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot;å‘æ¶ˆæ¯&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">        call();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">call</span><span class="params">()</span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+ <span class="string">&quot;æ‰“ç”µè¯&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title function_">sms</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">&quot;å‘æ¶ˆæ¯&quot;</span>);</span><br><span class="line">        call();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title function_">call</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+ <span class="string">&quot;æ‰“ç”µè¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å¯é‡å…¥é”">å¯é‡å…¥é”</h5><p>å¯é‡å…¥é”æ˜¯<strong>æŸä¸ªçº¿ç¨‹å·²ç»è·å¾—æŸä¸ªé”ï¼Œå¯ä»¥å†æ¬¡è·å–é”è€Œä¸ä¼šå‡ºç°æ­»é”</strong>ã€‚å†æ¬¡è·å–é”çš„æ—¶å€™ä¼šåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æ˜¯å·²ç»åŠ é”çš„çº¿ç¨‹ï¼Œå¦‚æœæ˜¯<strong>å¯¹é”çš„æ¬¡æ•°+1ï¼Œé‡Šæ”¾é”çš„æ—¶å€™åŠ äº†å‡ æ¬¡é”ï¼Œå°±éœ€è¦é‡Šæ”¾å‡ æ¬¡é”</strong>ã€‚</p><p>ä»£ç ä¸­çš„é”çš„é€’å½’åªæ˜¯é”çš„ä¸€ç§è¡¨ç°åŠè¯æ˜å½¢å¼ï¼Œé™¤äº†è¿™ç§å½¢å¼å¤–ï¼Œè¿˜æœ‰å¦ä¸€ç§è¡¨ç°å½¢å¼ã€‚åŒä¸€ä¸ªçº¿ç¨‹åœ¨æ²¡æœ‰é‡Šæ”¾é”çš„æƒ…å†µä¸‹å¤šæ¬¡è°ƒç”¨ä¸€ä¸ªåŠ é”æ–¹æ³•ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™ä¹Ÿè¯´æ˜æ˜¯å¯é‡å…¥é”ã€‚</p><h5 id="è‡ªæ—‹é”">è‡ªæ—‹é”</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">è‡ªæ—‹é”:</span></span><br><span class="line"><span class="comment">æˆ‘ä»¬è‡ªå·±å®šä¹‰ä¸€ä¸ªè‡ªæ—‹é”</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> class è‡ªæ—‹é” &#123;</span><br><span class="line">    AtomicReference&lt;Thread&gt; atomicStampedReference = <span class="keyword">new</span> <span class="title class_">AtomicReference</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    //åŠ é”</span></span><br><span class="line"><span class="comment">    æ‰€è°“è‡ªæ—‹é”</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span>  <span class="title function_">myLock</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;=&gt; MY Lock&quot;</span>);</span><br><span class="line">        <span class="comment">//è‡ªæ—‹å¼€å§‹</span></span><br><span class="line">        <span class="keyword">while</span> (!atomicStampedReference.compareAndSet(<span class="literal">null</span>,thread))&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     è§£é”</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myUnLock</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;=&gt; MY UnLock&quot;</span>);</span><br><span class="line">        atomicStampedReference.compareAndSet(thread,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test_Self</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨çš„æ–¹å¼</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        ReentrantLock reentrantLock = new ReentrantLock();</span></span><br><span class="line"><span class="comment">        reentrantLock.lock();</span></span><br><span class="line"><span class="comment">        reentrantLock.unlock();</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        ä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰ä¸‹çš„æ–¹å¼</span></span><br><span class="line"><span class="comment">        æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯CASæ¯”è¾ƒçš„ä¹Ÿå°±æ˜¯compareAndSet</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        è‡ªæ—‹é”  t = <span class="keyword">new</span> è‡ªæ—‹é”();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            t.myLock();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                t.myUnLock();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;,<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">            t.myLock();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                t.myUnLock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ‚²è§‚é”">æ‚²è§‚é”</h5><p>æ€»æ˜¯ä»¥æ‚²è§‚çš„è§’åº¦æ¥çœ‹é—®é¢˜ï¼Œå½“ç”¨æˆ·æ‹¿åˆ°é”ä¹‹åï¼Œè®¤ä¸ºç”¨æˆ·ä¼šä¿®æ”¹</p><h5 id="ä¹è§‚é”">ä¹è§‚é”</h5><p>æ€»æ˜¯ä»¥ä¹è§‚çš„æ–¹å¼çœ‹å¾…é—®é¢˜ï¼Œå½“ç”¨æˆ·æ¯æ¬¡æ‹¿åˆ°é”åï¼Œéƒ½ä¸ä¼šå¯¹æ•°æ®è¿›è¡Œä¿®æ”¹</p><h5 id="æ­»é”">æ­»é”</h5><p>ä¸¤ä¸ªçº¿ç¨‹å¼ºåˆ¶ä¸€ä¸ªèµ„æºé€ æˆçš„ä¸¤ä¸ªçº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œåœ¨ä¸ç»è¿‡äººçš„å¹²é¢„çš„æƒ…å†µä¹‹ä¸‹ä¸€ç›´ä¼šä¿æŒè¿™ç§çŠ¶æ€ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ­»é”ã€‚</p><p>å¦‚ä½•å»é¿å…æ­»é”ï¼ˆé¿å…æ­»é”äº§ç”Ÿçš„æ¡ä»¶ï¼‰</p><blockquote><p>å¦‚ä½•å»åˆ¤æ–­çº¿ç¨‹äº§ç”Ÿæ­»é”é—®é¢˜</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> class æ­»é”&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">lockA</span> <span class="operator">=</span> <span class="string">&quot;lockA&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">lockB</span> <span class="operator">=</span> <span class="string">&quot;lockB&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyTest</span>(lockA,lockB),<span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyTest</span>(lockB,lockA),<span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span>  <span class="title class_">MyTest</span> <span class="keyword">implements</span>  <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>  String lockA;</span><br><span class="line">    <span class="keyword">private</span>  String lockB;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyTest</span><span class="params">(String lockA, String lockB)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.lockA = lockA;</span><br><span class="line">        <span class="built_in">this</span>.lockB = lockB;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lockA)&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;Lock A &quot;</span>  + <span class="string">&quot;=&gt; get &quot;</span> + lockB);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æˆ‘ä»¬è®©çº¿ç¨‹Aä¼‘çœ 2ç§’</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">synchronized</span> (lockB)&#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;Lock B &quot;</span> + lockB + <span class="string">&quot;=&gt; get &quot;</span> + lockA);</span><br><span class="line">                <span class="comment">//æˆ‘ä»¬è®©çº¿ç¨‹Aä¼‘çœ 2ç§’</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p>ä½¿ç”¨   <code>jps -l</code>   å®šä½è¿›ç¨‹å·</p></li><li><p>ä½¿ç”¨    <code>jstack   è¿›ç¨‹å·</code>  æŸ¥çœ‹è¿›ç¨‹çš„ä¿¡æ¯ ,æ‰¾åˆ°æ­»é”é—®é¢˜</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line">PS E:<span class="keyword">\IDEAProgram</span><span class="keyword">\juc</span>-learning&gt; jstack 2400</span><br><span class="line">2022-10-09 21:13:37</span><br><span class="line">Full thread dump Java HotSpot(TM) 64-Bit Server VM (25.261-b12 mixed mode):</span><br><span class="line"></span><br><span class="line">&quot;DestroyJavaVM&quot; <span class="params">#1</span>4 prio=5 os<span class="built_in">_</span>prio=0 tid=0x000001f454e10800 nid=0x31ec wait</span><br><span class="line">ing on condition [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">&quot;B&quot; <span class="params">#1</span>3 prio=5 os<span class="built_in">_</span>prio=0 tid=0x000001f470d10800 nid=0x3690 waiting for moni</span><br><span class="line">tor entry [0x000000870e7ff000]</span><br><span class="line">   java.lang.Thread.State: BLOCKED (on object monitor)</span><br><span class="line">        at com.xh.juc.day07.é”.MyTest.run(æ­»é”.java:40)</span><br><span class="line">        - waiting to lock &lt;0x0000000775b9f8a0&gt; (a java.lang.String)        </span><br><span class="line">        - locked &lt;0x0000000775b9f8d8&gt; (a java.lang.String)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"></span><br><span class="line">&quot;A&quot; <span class="params">#1</span>2 prio=5 os<span class="built_in">_</span>prio=0 tid=0x000001f470d03000 nid=0x39e0 waiting for moni</span><br><span class="line">tor entry [0x000000870e6ff000]</span><br><span class="line">   java.lang.Thread.State: BLOCKED (on object monitor)</span><br><span class="line">        at com.xh.juc.day07.é”.MyTest.run(æ­»é”.java:40)</span><br><span class="line">        - waiting to lock &lt;0x0000000775b9f8d8&gt; (a java.lang.String)        </span><br><span class="line">        - locked &lt;0x0000000775b9f8a0&gt; (a java.lang.String)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"></span><br><span class="line">&quot;Service Thread&quot; <span class="params">#1</span>1 daemon prio=9 os<span class="built_in">_</span>prio=0 tid=0x000001f470ba4000 nid=0x3</span><br><span class="line">ea0 runnable [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">&quot;C1 CompilerThread3&quot; <span class="params">#1</span>0 daemon prio=9 os<span class="built_in">_</span>prio=2 tid=0x000001f470af0000 nid</span><br><span class="line">=0x3f94 waiting on condition [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">&quot;C2 CompilerThread2&quot; <span class="params">#9</span> daemon prio=9 os<span class="built_in">_</span>prio=2 tid=0x000001f470aef000 nid=</span><br><span class="line">0x3168 waiting on condition [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">&quot;C2 CompilerThread1&quot; <span class="params">#8</span> daemon prio=9 os<span class="built_in">_</span>prio=2 tid=0x000001f470ade000 nid=</span><br><span class="line">0xd1c waiting on condition [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">&quot;C2 CompilerThread0&quot; <span class="params">#7</span> daemon prio=9 os<span class="built_in">_</span>prio=2 tid=0x000001f470add000 nid=</span><br><span class="line">0x1d30 waiting on condition [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">&quot;Monitor Ctrl-Break&quot; <span class="params">#6</span> daemon prio=5 os<span class="built_in">_</span>prio=0 tid=0x000001f470adb000 nid=</span><br><span class="line">0x268c runnable [0x000000870dffe000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line">        at java.net.SocketInputStream.socketRead0(Native Method)</span><br><span class="line">        at java.net.SocketInputStream.socketRead(SocketInputStream.java:116</span><br><span class="line">)</span><br><span class="line">        at java.net.SocketInputStream.read(SocketInputStream.java:171)     </span><br><span class="line">        at java.net.SocketInputStream.read(SocketInputStream.java:141)     </span><br><span class="line">        at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:284)      </span><br><span class="line">        at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:326)       </span><br><span class="line">        at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:178)</span><br><span class="line">        - locked &lt;0x0000000775c8d1c0&gt; (a java.io.InputStreamReader)        </span><br><span class="line">        at java.io.InputStreamReader.read(InputStreamReader.java:184)      </span><br><span class="line">        at java.io.BufferedReader.fill(BufferedReader.java:161)</span><br><span class="line">        at java.io.BufferedReader.readLine(BufferedReader.java:324)        </span><br><span class="line">        - locked &lt;0x0000000775c8d1c0&gt; (a java.io.InputStreamReader)        </span><br><span class="line">        at java.io.BufferedReader.readLine(BufferedReader.java:389)        </span><br><span class="line">        at com.intellij.rt.execution.application.AppMainV2<span class="built_in">$</span>1.run(AppMainV2.</span><br><span class="line">java:49)</span><br><span class="line"></span><br><span class="line">&quot;Attach Listener&quot; <span class="params">#5</span> daemon prio=5 os<span class="built_in">_</span>prio=2 tid=0x000001f46edb9800 nid=0xd</span><br><span class="line">64 waiting on condition [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">&quot;Signal Dispatcher&quot; <span class="params">#4</span> daemon prio=9 os<span class="built_in">_</span>prio=2 tid=0x000001f46ee1e000 nid=0</span><br><span class="line">x10e8 runnable [0x0000000000000000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">&quot;Finalizer&quot; <span class="params">#3</span> daemon prio=8 os<span class="built_in">_</span>prio=1 tid=0x000001f454eb7000 nid=0x2ee0 in</span><br><span class="line"> Object.wait() [0x000000870dcfe000]</span><br><span class="line">   java.lang.Thread.State: WAITING (on object monitor)</span><br><span class="line">        at java.lang.Object.wait(Native Method)</span><br><span class="line">        - waiting on &lt;0x0000000775a08ee0&gt; (a java.lang.ref.ReferenceQueue<span class="built_in">$</span>L</span><br><span class="line">ock)</span><br><span class="line">        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:144)    </span><br><span class="line">        - locked &lt;0x0000000775a08ee0&gt; (a java.lang.ref.ReferenceQueue<span class="built_in">$</span>Lock)</span><br><span class="line">        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:165)    </span><br><span class="line">        at java.lang.ref.Finalizer<span class="built_in">$</span>FinalizerThread.run(Finalizer.java:216) </span><br><span class="line"></span><br><span class="line">&quot;Reference Handler&quot; <span class="params">#2</span> daemon prio=10 os<span class="built_in">_</span>prio=2 tid=0x000001f454eb0000 nid=</span><br><span class="line">0x35e0 in Object.wait() [0x000000870dbff000]</span><br><span class="line">   java.lang.Thread.State: WAITING (on object monitor)</span><br><span class="line">        at java.lang.Object.wait(Native Method)</span><br><span class="line">        - waiting on &lt;0x0000000775a06c00&gt; (a java.lang.ref.Reference<span class="built_in">$</span>Lock) </span><br><span class="line">        at java.lang.Object.wait(Object.java:502)</span><br><span class="line">        at java.lang.ref.Reference.tryHandlePending(Reference.java:191)    </span><br><span class="line">        - locked &lt;0x0000000775a06c00&gt; (a java.lang.ref.Reference<span class="built_in">$</span>Lock)     </span><br><span class="line">        at java.lang.ref.Reference<span class="built_in">$</span>ReferenceHandler.run(Reference.java:153)</span><br><span class="line"></span><br><span class="line">&quot;VM Thread&quot; os<span class="built_in">_</span>prio=2 tid=0x000001f454ead800 nid=0x1f50 runnable</span><br><span class="line"></span><br><span class="line">&quot;GC task thread<span class="params">#0</span> (ParallelGC)&quot; os<span class="built_in">_</span>prio=0 tid=0x000001f454e26000 nid=0x3f00</span><br><span class="line"> runnable</span><br><span class="line"></span><br><span class="line">&quot;GC task thread<span class="params">#1</span> (ParallelGC)&quot; os<span class="built_in">_</span>prio=0 tid=0x000001f454e28800 nid=0x3eb0</span><br><span class="line"> runnable</span><br><span class="line"></span><br><span class="line">&quot;GC task thread<span class="params">#2</span> (ParallelGC)&quot; os<span class="built_in">_</span>prio=0 tid=0x000001f454e29800 nid=0x3e84</span><br><span class="line"> runnable</span><br><span class="line"></span><br><span class="line">&quot;GC task thread<span class="params">#3</span> (ParallelGC)&quot; os<span class="built_in">_</span>prio=0 tid=0x000001f454e2d000 nid=0x3fb8</span><br><span class="line"> runnable</span><br><span class="line"></span><br><span class="line">&quot;GC task thread<span class="params">#4</span> (ParallelGC)&quot; os<span class="built_in">_</span>prio=0 tid=0x000001f454e32000 nid=0x3ca0</span><br><span class="line"> runnable</span><br><span class="line"></span><br><span class="line">&quot;GC task thread<span class="params">#5</span> (ParallelGC)&quot; os<span class="built_in">_</span>prio=0 tid=0x000001f454e32800 nid=0x3df8</span><br><span class="line"> runnable</span><br><span class="line"></span><br><span class="line">&quot;GC task thread<span class="params">#6</span> (ParallelGC)&quot; os<span class="built_in">_</span>prio=0 tid=0x000001f454e35800 nid=0x3630</span><br><span class="line"> runnable</span><br><span class="line"></span><br><span class="line">&quot;GC task thread<span class="params">#7</span> (ParallelGC)&quot; os<span class="built_in">_</span>prio=0 tid=0x000001f454e36800 nid=0x8ec </span><br><span class="line">runnable</span><br><span class="line"></span><br><span class="line">&quot;VM Periodic Task Thread&quot; os<span class="built_in">_</span>prio=2 tid=0x000001f470be6000 nid=0x21f4 waiti</span><br><span class="line">ng on condition</span><br><span class="line"></span><br><span class="line">JNI global references: 12</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Found one Java-level deadlock:</span><br><span class="line">=============================</span><br><span class="line">&quot;B&quot;:</span><br><span class="line">  waiting to lock monitor 0x000001f454eb3c68 (object 0x0000000775b9f8a0, a </span><br><span class="line">java.lang.String),</span><br><span class="line">  which is held by &quot;A&quot;</span><br><span class="line">&quot;A&quot;:</span><br><span class="line">  waiting to lock monitor 0x000001f454eb65a8 (object 0x0000000775b9f8d8, a </span><br><span class="line">java.lang.String),</span><br><span class="line">  which is held by &quot;B&quot;</span><br><span class="line"></span><br><span class="line">Java stack information for the threads listed above:</span><br><span class="line">===================================================</span><br><span class="line">&quot;B&quot;:</span><br><span class="line">        at com.xh.juc.day07.???.MyTest.run(æ­»é”.java:40)</span><br><span class="line">        - waiting to lock &lt;0x0000000775b9f8a0&gt; (a java.lang.String)        </span><br><span class="line">        - locked &lt;0x0000000775b9f8d8&gt; (a java.lang.String)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748)</span><br><span class="line">&quot;A&quot;:</span><br><span class="line">        at com.xh.juc.day07.é”.MyTest.run(æ­»é”.java:40)</span><br><span class="line">        - waiting to lock &lt;0x0000000775b9f8d8&gt; (a java.lang.String)        </span><br><span class="line">        - locked &lt;0x0000000775b9f8a0&gt; (a java.lang.String)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"></span><br><span class="line">Found 1 deadlock.</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚ä½•æ£€æµ‹æ­»é”ï¼š</p><ol><li>æŸ¥çœ‹æ—¥å¿—</li><li>å †æ ˆä¿¡æ¯</li></ol></li></ol><h5 id="è½»é‡é”">è½»é‡é”</h5><p>â‘  å½“ä¸€ä¸ªçº¿ç¨‹è¦è¿›å…¥åŒæ­¥å—æ—¶ï¼Œé¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ªLock Recordï¼ˆé”è®°å½•ï¼‰å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«Displaced Mark Wordå’ŒOwnerã€‚<br>â‘¡ é”è®°å½•å¯¹è±¡ä¼šæ‹·è´å¯¹è±¡å¤´ä¸­çš„Mark Wordï¼Œå³Displaced Mark Wordã€‚<br>â‘¢ æ‹·è´æˆåŠŸåï¼Œé”è®°å½•å°†owneræŒ‡å‘å¯¹è±¡å¤´ï¼Œç„¶åå°è¯•é€šè¿‡caså°†å¯¹è±¡å¤´çš„Mark Wordæ›´æ”¹ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡é’ˆï¼Œå¹¶ä¸”å°†å¯¹è±¡Mark Wordçš„é”æ ‡å¿—ä½è®¾ç½®ä¸ºâ€œ00â€ã€‚<br>â‘£ å¦‚æœæ›´æ–°æˆåŠŸï¼Œåˆ™è¡¨ç¤ºè¯¥å¯¹è±¡å¤„äºè½»é‡çº§é”å®šçŠ¶æ€ã€‚å¦‚æœå¤±è´¥ï¼Œé‚£ä¹ˆé¦–å…ˆæ£€æµ‹æ˜¯å¦æ˜¯å¯é‡å…¥ï¼Œå¦‚æœå¯é‡å…¥åˆ™è¿›å…¥æ‰§è¡Œã€‚<br>â‘¤ å¦‚æœä¸å¯é‡å…¥ï¼Œåˆ™è†¨èƒ€ä¸ºé‡é‡é”ã€‚ï¼ˆæœ‰çš„æ–‡ç« è¯´ä¼šè¿›è¡Œè‡ªæ—‹ï¼Œæœ‰çš„è¯´ä¸è¿›è¡Œè‡ªæ—‹åªè¦å­˜åœ¨ç«äº‰å°±è†¨èƒ€ä¸ºé‡é‡é”ï¼Œç¾å›¢è¯´å½“åªæœ‰ä¸€ä¸ªç­‰å¾…çº¿ç¨‹æ—¶ï¼Œè¯¥çº¿ç¨‹è‡ªæ—‹ã€‚å½“è¶…è¿‡ä¸€å®šæ¬¡æ•°æˆ–è€…è¶…è¿‡ä¸€ä¸ªè‡ªæ—‹çº¿ç¨‹æ—¶ç›´æ¥è†¨èƒ€ä¸ºé‡é‡é”ï¼‰ã€‚<br>â‘¥ é‡Šæ”¾é”æ—¶ï¼Œä½¿ç”¨caså¯¹è±¡å¤´çš„Mark Wordæ¢å¤ï¼Œå¦‚æœcasæˆåŠŸï¼Œåˆ™è§£é”æˆåŠŸã€‚å¦‚æœcaså¤±è´¥ï¼Œåˆ™è¿›å…¥é‡é‡é”è§£é”æµç¨‹ã€‚</p><h5 id="é‡é‡é”">é‡é‡é”</h5><p>JDK1.6ä¹‹å‰ï¼Œé”æ²¡è¢«ä¼˜åŒ–ï¼Œsynchronizedä½¿ç”¨çš„æ˜¯é‡é‡é”ã€‚é‡é‡é”éœ€è¦æ“ä½œç³»ç»Ÿå¸®å¿™ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢ï¼ŒåŒæ—¶è¿˜ä¼šå¸¦æ¥çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚<br>åŸç†</p><p><img src="F:%5C%E4%B8%89%E6%9C%9F%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99%5C%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99%5CJUC%5C1665323626063.png" alt="1665323626063"></p><p>Monitorå¯¹è±¡åˆ†ä¸º3éƒ¨åˆ†ç»„æˆï¼šOwnerã€EntryListå’ŒWaitSet<br>â‘  JVMä¼šåˆ›å»ºä¸€ä¸ªMonitorå¯¹è±¡ï¼Œç„¶åå°†é”å¯¹è±¡çš„å¯¹è±¡å¤´ä¸­MarkWordæ”¹å˜æˆæŒ‡å‘Monitorå¯¹è±¡çš„æŒ‡é’ˆã€‚<br>â‘¡ å½“å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹æŠ¢å åˆ°é”åï¼ŒMonitorçš„Ownerä¼šç½®ä¸ºè¯¥çº¿ç¨‹idï¼Œåªèƒ½æœ‰ä¸€ä¸ªã€‚<br>â‘¢ å…¶ä½™æ²¡æŠ¢åˆ°çš„ï¼Œä¼šè¢«æ”¾ç½®åˆ°EntryListä¸­é˜»å¡ã€‚<br>â‘£ è¿›å…¥WAITINGçŠ¶æ€çš„çº¿ç¨‹ï¼Œä¼šè¢«æ”¾åœ¨WaitSetä¸­ã€‚</p><h5 id="æ’ä»–é”">æ’ä»–é”</h5><p>æ’ä»–é”ï¼ˆEXclusive Lockï¼‰ï¼Œåˆç§°Xé”ã€ç‹¬å é”ã€å†™é”ã€‚é’ˆå¯¹è¡Œé”ã€‚<br>å½“æœ‰äº‹åŠ¡å¯¹æ•°æ®åŠ å†™é”åï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½å†å¯¹é”å®šçš„æ•°æ®åŠ ä»»ä½•é”ï¼Œåˆå› ä¸ºInnoDBå¯¹selectè¯­å¥é»˜è®¤ä¸åŠ é”ï¼Œæ‰€ä»¥å…¶ä»–äº‹åŠ¡é™¤äº†ä¸èƒ½å†™æ“ä½œå¤–ï¼Œç…§æ ·æ˜¯å…è®¸è¯»çš„ï¼ˆå°½ç®¡ä¸å…è®¸åŠ è¯»é”ï¼‰ã€‚</p><p>ğŸ“¢ä¸»è¦ä¸ºäº†åœ¨äº‹åŠ¡è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œä¸å…è®¸å…¶ä»–äº‹åŠ¡ä¿®æ”¹ã€‚</p><h5 id="åå‘é”">åå‘é”</h5><p>è½»é‡é”æ¯æ¬¡é‡å…¥å’Œé€€å‡ºæ—¶è¿˜æ˜¯ä¼šæ‰§è¡Œcasæ“ä½œï¼Œå¹¶ä¸”è¦åˆ›å»ºé”è®°å½•å¯¹è±¡ã€‚å¦‚æœåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”æ€»æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œå°±å¯ä»¥ä½¿ç”¨åå‘é”ä¼˜åŒ–ã€‚<br>åŸç†<br>â‘  ç¬¬ä¸€æ¬¡ä½¿ç”¨CASå°†çº¿ç¨‹IDè®¾ç½®åˆ°å¯¹è±¡çš„Mark Wordã€‚<br>â‘¡ ä»¥åè¯¥çº¿ç¨‹è¿›å…¥åŒæ­¥å—æ—¶ï¼Œä¸éœ€è¦CASè¿›è¡ŒåŠ é”ï¼Œåªä¼šå¾€å½“å‰çº¿ç¨‹çš„æ ˆä¸­æ·»åŠ ä¸€æ¡Displaced Mark Wordä¸ºç©ºçš„Lock Recordä¸­ï¼Œç”¨æ¥ç»Ÿè®¡é‡å…¥çš„æ¬¡æ•°ã€‚</p>]]></content>
    
    
    <summary type="html">æœ¬æ–‡ä¸»è¦JavaJUCå­¦ä¹ ç¯‡çš„è®°å½•</summary>
    
    
    
    <category term="javaå­¦ä¹ " scheme="https://luoxiaohei520.github.io/categories/java%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="javaå­¦ä¹ " scheme="https://luoxiaohei520.github.io/tags/java%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>MySQLçš„å¸¸ç”¨è¯­å¥çºªå½•</title>
    <link href="https://luoxiaohei520.github.io/posts/a9be6930.html"/>
    <id>https://luoxiaohei520.github.io/posts/a9be6930.html</id>
    <published>2023-11-09T02:50:23.335Z</published>
    <updated>2023-11-09T02:50:23.335Z</updated>
    
    <content type="html"><![CDATA[<h1>MySQLåŸºç¡€</h1><h2 id="MySqlåŸºæœ¬æŒ‡ä»¤">MySqlåŸºæœ¬æŒ‡ä»¤</h2><h3 id="1ã€MySQLå¸¸ç”¨å‘½ä»¤">1ã€MySQLå¸¸ç”¨å‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºæ•°æ®åº“</span><br><span class="line">create database name;  </span><br><span class="line">#é€‰æ‹©æ•°æ®åº“</span><br><span class="line">use databasename;</span><br><span class="line">#ç›´æ¥åˆ é™¤æ•°æ®åº“ï¼Œä¸æé†’</span><br><span class="line">drop database name ;</span><br><span class="line">#æ˜¾ç¤ºè¡¨</span><br><span class="line">show tables; </span><br><span class="line">#è¡¨çš„è¯¦ç»†æè¿°</span><br><span class="line">describe tablename; </span><br><span class="line"></span><br><span class="line">select ä¸­åŠ ä¸Šdistinctå»é™¤é‡å¤å­—æ®µ</span><br><span class="line"></span><br><span class="line">#åˆ é™¤æ•°æ®åº“å‰ï¼Œæœ‰æç¤ºã€‚</span><br><span class="line">mysqladmin drop databasename </span><br><span class="line"></span><br><span class="line">#æ˜¾ç¤ºå½“å‰mysqlç‰ˆæœ¬å’Œå½“å‰æ—¥æœŸ</span><br><span class="line"></span><br><span class="line">select version(),current_date;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2ã€ä¿®æ”¹mysqlä¸­rootçš„å¯†ç ï¼š">2ã€ä¿®æ”¹mysqlä¸­rootçš„å¯†ç ï¼š</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">shell&gt;</span><span class="language-bash">mysql -u root -p</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">update user <span class="built_in">set</span> password=password(â€xueok654123â€³) <span class="built_in">where</span> user=â€™rootâ€™;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">flush privileges //åˆ·æ–°æ•°æ®åº“</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt;</span><span class="language-bash">use dbnameï¼› æ‰“å¼€æ•°æ®åº“ï¼š</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt;</span><span class="language-bash">show databases; æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt;</span><span class="language-bash">show tables; æ˜¾ç¤ºæ•°æ®åº“mysqlä¸­æ‰€æœ‰çš„è¡¨ï¼šå…ˆuse mysqlï¼›ç„¶å</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt;</span><span class="language-bash">describe user; æ˜¾ç¤ºè¡¨mysqlæ•°æ®åº“ä¸­userè¡¨çš„åˆ—ä¿¡æ¯)ï¼›</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3ã€grantæˆæƒ">3ã€grantæˆæƒ</h3><p>åˆ›å»ºä¸€ä¸ªå¯ä»¥ä»ä»»ä½•åœ°æ–¹è¿æ¥æœåŠ¡å™¨çš„ä¸€ä¸ªå®Œå…¨çš„è¶…çº§ç”¨æˆ·ï¼Œä½†æ˜¯å¿…é¡»ä½¿ç”¨ä¸€ä¸ªå£ä»¤somethingåšè¿™ä¸ª</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; grant all privileges on *.* to user@localhost identified by â€™somethingâ€™ with</span><br></pre></td></tr></table></figure><p>å¢åŠ æ–°ç”¨æˆ·</p><p><em><em>æ ¼å¼ï¼šgrant select on æ•°æ®åº“.</em> to ç”¨æˆ·å@ç™»å½•ä¸»æœº identified by â€œå¯†ç â€</em>*</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON *.* TO monty@localhost IDENTIFIED BY â€™somethingâ€™ WITH GRANT OPTION;</span><br><span class="line">GRANT ALL PRIVILEGES ON . TO monty@â€%â€ IDENTIFIED BY â€™somethingâ€™ WITH GRANT OPTION;</span><br></pre></td></tr></table></figure><p><strong>åˆ é™¤æˆæƒï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; revoke all privileges on . from root@â€%â€;</span><br><span class="line"></span><br><span class="line">mysql&gt; delete from user <span class="built_in">where</span> user=â€rootâ€ and host=â€%â€;</span><br><span class="line"></span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºä¸€ä¸ªç”¨æˆ·customåœ¨ç‰¹å®šå®¢æˆ·ç«¯it363.comç™»å½•ï¼Œå¯è®¿é—®ç‰¹å®šæ•°æ®åº“fangchandb</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt;grant select, insert, update, delete, create,drop on fangchandb.* to custom@ it363.com identified by â€˜ passwdâ€™</span><br></pre></td></tr></table></figure><p><strong>é‡å‘½åè¡¨:</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &gt; alter table t1 rename t2;</span><br></pre></td></tr></table></figure><h3 id="4ã€mysqldump">4ã€mysqldump</h3><p><strong>å¤‡ä»½æ•°æ®åº“</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysqldump -h host -u root -p dbname &gt;dbname_backup.sql</span><br></pre></td></tr></table></figure><p><strong>æ¢å¤æ•°æ®åº“</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysqladmin -h myhost -u root -p create dbname</span><br><span class="line">shell&gt; mysqldump -h host -u root -p dbname &lt; dbname_backup.sql</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœåªæƒ³å¸å‡ºå»ºè¡¨æŒ‡ä»¤ï¼Œåˆ™å‘½ä»¤å¦‚ä¸‹ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysqladmin -u root -p -d databasename &gt; a.sql</span><br></pre></td></tr></table></figure><p>å¦‚æœåªæƒ³å¸å‡ºæ’å…¥æ•°æ®çš„sqlå‘½ä»¤ï¼Œè€Œä¸éœ€è¦å»ºè¡¨å‘½ä»¤ï¼Œåˆ™å‘½ä»¤å¦‚ä¸‹ï¼š</p><p>shell&gt; mysqladmin -u root -p -t databasename &gt; a.sql</p><p>é‚£ä¹ˆå¦‚æœæˆ‘åªæƒ³è¦æ•°æ®ï¼Œè€Œä¸æƒ³è¦ä»€ä¹ˆsqlå‘½ä»¤æ—¶ï¼Œåº”è¯¥å¦‚ä½•æ“ä½œå‘¢ï¼Ÿ</p><p>mysqldump -T./ phptest driver</p><p>å…¶ä¸­ï¼Œåªæœ‰æŒ‡å®šäº†-Tå‚æ•°æ‰å¯ä»¥å¸å‡ºçº¯æ–‡æœ¬æ–‡ä»¶ï¼Œè¡¨ç¤ºå¸å‡ºæ•°æ®çš„ç›®å½•ï¼Œ./è¡¨ç¤ºå½“å‰ç›®å½•ï¼Œå³ä¸mysqldumpåŒä¸€ç›®å½•ã€‚å¦‚æœä¸æŒ‡å®šdriver è¡¨ï¼Œåˆ™å°†å¸å‡ºæ•´ä¸ªæ•°æ®åº“çš„æ•°æ®ã€‚æ¯ä¸ªè¡¨ä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªä¸º.sqlæ–‡ä»¶ï¼ŒåŒ…å«å»ºè¡¨æ‰§è¡Œã€‚å¦ä¸€ä¸ªä¸º.txtæ–‡ä»¶ï¼ŒåªåŒ…å«æ•°æ®ï¼Œä¸”æ²¡æœ‰sqlæŒ‡ä»¤ã€‚</p><h3 id="5ã€å¯å°†æŸ¥è¯¢å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å¹¶å‘Šè¯‰mysqlä»æ–‡ä»¶ä¸­è¯»å–æŸ¥è¯¢è€Œä¸æ˜¯ç­‰å¾…é”®ç›˜è¾“å…¥ã€‚å¯åˆ©ç”¨å¤–å£³ç¨‹åºé”®å…¥é‡å®šå‘å®ç”¨ç¨‹åºæ¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚">5ã€å¯å°†æŸ¥è¯¢å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å¹¶å‘Šè¯‰mysqlä»æ–‡ä»¶ä¸­è¯»å–æŸ¥è¯¢è€Œä¸æ˜¯ç­‰å¾…é”®ç›˜è¾“å…¥ã€‚å¯åˆ©ç”¨å¤–å£³ç¨‹åºé”®å…¥é‡å®šå‘å®ç”¨ç¨‹åºæ¥å®Œæˆè¿™é¡¹å·¥ä½œã€‚</h3><p>ä¾‹å¦‚ï¼Œå¦‚æœåœ¨æ–‡ä»¶my_file.sql ä¸­å­˜æ”¾æœ‰æŸ¥è¯¢ï¼Œå¯å¦‚ä¸‹æ‰§è¡Œè¿™äº›æŸ¥è¯¢ï¼š</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³å°†å»ºè¡¨è¯­å¥æå‰å†™åœ¨sql.txtä¸­:</p><p>mysql &gt; mysql -h myhost -u root -p database &lt; sql.txt</p><p>è½¬ mysqlå‘½ä»¤</p><h2 id="ä¸€-å®‰è£…ä¸é…ç½®MYSQL">ä¸€ . å®‰è£…ä¸é…ç½®MYSQL</h2><p>è¿™ä¸ªå°±ä¸è¯´äº†ï¼Œä¸€èˆ¬åˆ†ä¸ºWindowså®‰è£…å’ŒLinuxå®‰è£…</p><h2 id="äºŒ-å¸¸ç”¨mysqlå‘½ä»¤è¡Œå‘½ä»¤">äºŒ . å¸¸ç”¨mysqlå‘½ä»¤è¡Œå‘½ä»¤</h2><p>1 .mysqlçš„å¯åŠ¨ä¸åœæ­¢</p><p>å¯åŠ¨MYSQLæœåŠ¡ <code>net start mysql</code></p><p>åœæ­¢MYSQLæœåŠ¡ <code>net stop mysql</code></p><p>2 .<code> netstat â€“na | findstr 3306</code> æŸ¥çœ‹è¢«ç›‘å¬çš„ç«¯å£ , findstrç”¨äºæŸ¥æ‰¾åé¢çš„ç«¯å£æ˜¯å¦å­˜åœ¨</p><p>3 . åœ¨å‘½ä»¤è¡Œä¸­ç™»é™†MYSQLæ§åˆ¶å° , å³ä½¿ç”¨ <code>MYSQL COMMEND LINE TOOL</code></p><p>è¯­æ³•æ ¼å¼ <code>mysql â€“user=root â€“password=123456 db_name</code></p><p>æˆ– <code>mysql â€“u root â€“p123456 db_name</code></p><p>4 . è¿›å…¥MYSQLå‘½ä»¤è¡Œå·¥å…·å , ä½¿ç”¨<code>status; </code>æˆ–/s æŸ¥çœ‹è¿è¡Œç¯å¢ƒä¿¡æ¯</p><p>5 . åˆ‡æ¢è¿æ¥æ•°æ®åº“çš„è¯­æ³• :<code> use new_dbname;</code></p><p>6 . æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“ : <code>show databases;</code></p><p>7 . æ˜¾ç¤ºæ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨ :<code>show tables;</code></p><p>8 . æ˜¾ç¤ºæŸä¸ªè¡¨åˆ›å»ºæ—¶çš„å…¨éƒ¨ä¿¡æ¯ : <code>show create table table_name;</code></p><p>9 . æŸ¥çœ‹è¡¨çš„å…·ä½“å±æ€§ä¿¡æ¯åŠè¡¨ä¸­å„å­—æ®µçš„æè¿°</p><p><code>Describe table_name;</code> ç¼©å†™å½¢å¼ : <code>desc table_name;</code></p><h2 id="ä¸‰-MySqlä¸­çš„SQLè¯­å¥">ä¸‰ . MySqlä¸­çš„SQLè¯­å¥</h2><ol><li><p>æ•°æ®åº“åˆ›å»º : <code>Create database db_name;</code></p><p>æ•°æ®åº“åˆ é™¤ : <code>Drop database db_name;</code> åˆ é™¤æ—¶å¯å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œå†™æˆ : <code>drop database if exits db_name</code></p></li><li><p>å»ºè¡¨ : åˆ›å»ºæ•°æ®è¡¨çš„è¯­æ³• :<code> create table table_name (å­—æ®µ1 æ•°æ®ç±»å‹ , å­—æ®µ2 æ•°æ®ç±»å‹);</code></p><p>ä¾‹ : create table mytable (id int , username char(20));</p></li><li><p>åˆ è¡¨ :<code>drop table table_name;</code>ä¾‹ : drop table mytable;</p></li><li><p>æ·»åŠ æ•°æ® : <code>Insert into è¡¨å [(å­—æ®µ1 , å­—æ®µ2 , â€¦.)] values (å€¼1 , å€¼2 , â€¦..);</code></p><p>å¦‚æœå‘è¡¨ä¸­çš„æ¯ä¸ªå­—æ®µéƒ½æ’å…¥ä¸€ä¸ªå€¼,é‚£ä¹ˆå‰é¢ [ ] æ‹¬å·å†…å­—æ®µåå¯å†™ä¹Ÿå¯ä¸å†™</p><p>ä¾‹ : insert into mytable (id,username) values (1,â€™zhangsanâ€™);</p></li><li><p>æŸ¥è¯¢ : æŸ¥è¯¢æ‰€æœ‰æ•°æ® : <code>select * from table_name;</code></p><p>æŸ¥è¯¢æŒ‡å®šå­—æ®µçš„æ•°æ® :<code> select å­—æ®µ1 , å­—æ®µ2 from table_name;</code></p><p>ä¾‹ : select id,username from mytable where id=1 order by desc;å¤šè¡¨æŸ¥è¯¢è¯­å¥------------å‚ç…§ç¬¬17æ¡å®ä¾‹</p></li><li><p>æ›´æ–°æŒ‡å®šæ•°æ® , æ›´æ–°æŸä¸€ä¸ªå­—æ®µçš„æ•°æ®(æ³¨æ„ï¼Œä¸æ˜¯æ›´æ–°å­—æ®µçš„åå­—)</p></li></ol><p><code>Update table_name set å­—æ®µå=â€™æ–°å€¼â€™ [, å­—æ®µ2 =â€™æ–°å€¼â€™ , â€¦..][where id=id_num] [order by å­—æ®µ é¡ºåº]</code></p><p>â€‹ä¾‹ : update mytable set username=â€™lisiâ€™ where id=1;</p><p>â€‹Orderè¯­å¥æ˜¯æŸ¥è¯¢çš„é¡ºåº , å¦‚ : <code>order by id desc(æˆ–asc)</code> , é¡ºåºæœ‰ä¸¤ç§ : descå€’åº(100â€”1,å³ä»æœ€æ–°æ•°æ®å¾€åæŸ¥è¯¢),asc(ä»1-100)ï¼ŒWhereå’Œorderè¯­å¥ä¹Ÿå¯ç”¨äºæŸ¥è¯¢select ä¸åˆ é™¤delete</p><ol start="7"><li><p>åˆ é™¤è¡¨ä¸­çš„ä¿¡æ¯ :</p><p>åˆ é™¤æ•´ä¸ªè¡¨ä¸­çš„ä¿¡æ¯ : <code>delete from table_name;</code></p><p>åˆ é™¤è¡¨ä¸­æŒ‡å®šæ¡ä»¶çš„è¯­å¥ : <code>delete from table_name where æ¡ä»¶è¯­å¥ ;</code> æ¡ä»¶è¯­å¥å¦‚ : id=3;</p></li><li><p>åˆ›å»ºæ•°æ®åº“ç”¨æˆ·</p><p>ä¸€æ¬¡å¯ä»¥åˆ›å»ºå¤šä¸ªæ•°æ®åº“ç”¨æˆ·å¦‚ï¼š</p><p><code>CREATE USER username1 identified BY â€˜passwordâ€™ , username2 IDENTIFIED BY â€˜passwordâ€™â€¦.</code></p></li><li><p>ç”¨æˆ·çš„æƒé™æ§åˆ¶ï¼šgrantåº“ï¼Œè¡¨çº§çš„æƒé™æ§åˆ¶ : å°†æŸä¸ªåº“ä¸­çš„æŸä¸ªè¡¨çš„æ§åˆ¶æƒèµ‹äºˆæŸä¸ªç”¨æˆ·</p><p><code>Grant all ON db_name.table_name TO user_name [ indentified by â€˜passwordâ€™ ];</code></p></li><li><p>è¡¨ç»“æ„çš„ä¿®æ”¹</p><p>(1)å¢åŠ ä¸€ä¸ªå­—æ®µæ ¼å¼ï¼š</p><p>â€‹<code>alter table table_name add column (å­—æ®µå å­—æ®µç±»å‹); ----æ­¤æ–¹æ³•å¸¦æ‹¬å·</code></p><p>(2)æŒ‡å®šå­—æ®µæ’å…¥çš„ä½ç½®ï¼š</p><p>â€‹<code>alter table table_name add column å­—æ®µå å­—æ®µç±»å‹ after æŸå­—æ®µï¼›</code></p><p>åˆ é™¤ä¸€ä¸ªå­—æ®µï¼š</p><p>â€‹<code>alter table table_name dropå­—æ®µå;</code></p><p>(3)ä¿®æ”¹å­—æ®µåç§°/ç±»å‹</p><p>â€‹<code>alter table table_name change æ—§å­—æ®µå æ–°å­—æ®µå æ–°å­—æ®µçš„ç±»å‹;</code></p><p>(4)æ”¹è¡¨çš„åå­—</p><p>â€‹<code>alter table table_name rename to new_table_name;</code></p><p>(5)ä¸€æ¬¡æ€§æ¸…ç©ºè¡¨ä¸­çš„æ‰€æœ‰æ•°æ®</p><p>â€‹<code>truncate table table_name; æ­¤æ–¹æ³•ä¹Ÿä¼šä½¿è¡¨ä¸­çš„å–å·å™¨(ID)ä»1å¼€å§‹</code></p></li><li><p>å¢åŠ ä¸»é”®ï¼Œå¤–é”®ï¼Œçº¦æŸï¼Œç´¢å¼•ã€‚ã€‚ã€‚ã€‚(ä½¿ç”¨æ–¹æ³•è§17å®ä¾‹)</p><p>â‘  <strong>çº¦æŸ(ä¸»é”®Primary keyã€å”¯ä¸€æ€§Uniqueã€éç©ºNot Null)</strong></p><p>â‘¡ <strong>è‡ªåŠ¨å¢å¼  auto_increment</strong></p><p>â‘¢<strong>å¤–é”®Foreign key-----ä¸reference table_name(col_nameåˆ—å)é…åˆä½¿ç”¨ï¼Œå»ºè¡¨æ—¶å•ç‹¬ä½¿ç”¨</strong></p><p>â‘£ <strong>åˆ é™¤å¤šä¸ªè¡¨ä¸­æœ‰å…³è”çš„æ•°æ®----è®¾ç½®foreign key ä¸ºset null â€”å…·ä½“è®¾ç½®å‚è€ƒå¸®åŠ©æ–‡æ¡£</strong></p></li><li><p>æŸ¥çœ‹æ•°æ®åº“å½“å‰å¼•æ“</p><p>``SHOW CREATE TABLE table_name;`</p></li><li><p>ä¿®æ”¹æ•°æ®åº“å¼•æ“</p><p><code>ALTER TABLE table_name ENGINE=MyISAM | InnoDB;</code></p></li><li><p>SQLè¯­å¥è¿ç”¨å®ä¾‹:</p><p><strong>â€“1 å»ºusersè¡¨</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table users (</span><br><span class="line">id int primary key auto_increment,</span><br><span class="line">nikename varchar(20) not null unique,</span><br><span class="line">password varchar(100) not null,</span><br><span class="line">address varchar(200), </span><br><span class="line">reg_date timestamp not null default CURRENT_TIMESTAMP</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><strong>â€“2 å»ºarticlesè¡¨,åœ¨å»ºè¡¨æ—¶è®¾ç½®å¤–é”®</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create table articles (</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    content longtext not null,</span><br><span class="line">    userid int,</span><br><span class="line">    constraint foreign key (userid) references users(id) on delete set null</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>â€‹<strong>â€“2.1 å»ºarticlesè¡¨,å»ºè¡¨æ—¶ä¸è®¾ç½®å¤–é”®</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table articles (</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    content longtext not null,</span><br><span class="line">    userid int</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>â€‹-<strong>-2.2 ç»™articlesè¡¨è®¾ç½®å¤–é”®</strong></p><p>â€‹<code>alter table articles add constraint foreign key (userid) references users(id) on delete set null;</code></p><p><strong>â€“3. å‘usersè¡¨ä¸­æ’å…¥æ•°æ®,åŒæ—¶æ’å…¥å¤šæ¡</strong></p><p><code>insert into users (id,nikename,password,address) values (1,'lyh1','1234',null),(10,'lyh22','4321','æ¹–åŒ—æ­¦æ±‰'),(null,'lyh333','5678', 'åŒ—äº¬æµ·æ·€');</code></p></li></ol><p>â€‹<strong>â€“4. å‘articleä¸­æ’å…¥ä¸‰æ¡æ•°æ®</strong></p><p>â€‹<code>insert into articles (id,content,userid) values (2,'hahahahahaha',11),(null,'xixixixixix',10),(13,'aiaiaiaiaiaiaiaiaiaiaiaia',1),(14,'hohoahaoaoooooooooo',10);</code></p><p>â€‹<strong>â€“5. è¿›è¡Œå¤šè¡¨æŸ¥è¯¢ï¼Œé€‰æ‹©usersè¡¨ä¸­ID=10çš„ç”¨æˆ·å‘å¸ƒçš„æ‰€æœ‰ç•™è¨€åŠè¯¥ç”¨æˆ·çš„æ‰€æœ‰ä¿¡æ¯</strong></p><p>â€‹<code>select articles.id,articles.content,users.* from users,articles where users.id=10 and articles.userid=users.id order by articles.id desc;</code></p><p>â€‹<strong>â€“6. æŸ¥çœ‹æ•°æ®åº“å¼•æ“ç±»å‹</strong></p><p>â€‹<code>show create table users;</code></p><p>â€‹<strong>â€“7. ä¿®æ”¹æ•°æ®åº“å¼•æ“ç±»å‹</strong></p><p>â€‹<code>alter table users engine=MyISAM; </code>â€”å› ä¸ºusersè¡¨ä¸­IDè¢«è®¾ç½®æˆå¤–é”®ï¼Œæ‰§è¡Œæ­¤å¥ä¼šå‡ºé”™</p><p>â€‹-<strong>-8. åŒè¡¨æŸ¥è¯¢,å·²çŸ¥ä¸€ä¸ªæ¡ä»¶çš„æƒ…å†µä¸‹.æŸ¥è¯¢IDå·å¤§äºç”¨æˆ·lyh1çš„IDå·çš„æ‰€æœ‰ç”¨æˆ·</strong></p><p>â€‹<code>select a.id,a.nikename,a.address from users a,users b where b.nikename='lyh1' and a.id&gt;b.id;</code></p><p>â€‹------ä¹Ÿå¯å†™æˆ</p><p>â€‹<code>select id,nikename,address from users where id&gt;(select id from users where nikename='lyh1');</code></p><h3 id="ä¹ é¢˜ï¼š">ä¹ é¢˜ï¼š</h3><ol><li><strong>æ˜¾ç¤ºå¹´é¾„æ¯”é¢†å¯¼è¿˜å¤§çš„å‘˜å·¥ï¼š</strong></li></ol><p><code>select a.name from users a,users b where a.managerid=b.id and a.age&gt;b.age;</code></p><ol start="2"><li><p><strong>æŸ¥è¯¢ç¼–å·ä¸º2çš„å‘å¸–äºº: å…ˆæŸ¥articlesè¡¨,å¾—åˆ°å‘å¸–äººçš„ç¼–å·,å†æ ¹æ®ç¼–å·æŸ¥userså¾—åˆ°çš„ç”¨æˆ·åã€‚</strong></p><p><strong>æ¥ç€ç”¨å…³è”æŸ¥è¯¢.</strong></p><ol><li><code>select * from articles,users</code>å¾—åˆ°ç¬›å¡å„¿ç§¯,å†åŠ <code>order by articles.id</code>ä»¥ä¾¿è§‚å¯Ÿ</li><li>ä½¿ç”¨<code>select * from articles,users where articles.id=2</code> ç­›é€‰å‡º2å·å¸–å­ä¸æ¯ä¸ªç”¨æˆ·çš„ç»„åˆè®°å½•</li><li>å†ä½¿ç”¨<code>select * from articles,users where articles.id=2 and articles.userid=users.id</code>é€‰å‡ºusers.idç­‰äº2å·å¸–çš„å‘å¸–äººidçš„è®°å½•.</li><li>åªå–ç”¨æˆ·å:select user where user.id=(select userid from articles where <a href="http://article.id">article.id</a> =2)</li></ol></li><li><p><strong>æ‰¾å‡ºå¹´é¾„æ¯”å°ç‹è¿˜å¤§çš„äºº:å‡è®¾å°ç‹æ˜¯28å²,å…ˆæƒ³æ‰¾å‡ºå¹´é¾„å¤§äº28çš„äºº</strong></p><p><code>select * from users where age&gt;(select age from users where name='xiaowang');</code></p><p><strong>è¦æŸ¥è¯¢çš„è®°å½•éœ€è¦å‚ç…§è¡¨é‡Œé¢çš„å…¶ä»–è®°å½•:</strong></p></li></ol><p><code>select a.name from users a,users b where b.name='xiaowang' and a.age&gt;b.age</code></p><p>è¡¨é‡Œçš„æ¯ä¸ªç”¨æˆ·éƒ½æƒ³pkä¸€ä¸‹.<code>select a.nickname,b.nickname from users a,users b where a.id&gt;b.id ;</code></p><p>æ›´ä¿é™©çš„è¯­å¥:<code>select a.nickname,b.nickname from (select * from users order by id) a,(select * from users order by id) b where a.id&gt;b.id ;</code></p><p>å†æŸ¥è¯¢æŸä¸ªäººå‘çš„æ‰€æœ‰å¸–å­.</p><p><code>select b.* from articles a , articles b where a.id=2 and a.userid=b.userid</code></p><p>è¯´æ˜: è¡¨ä¹‹é—´å­˜åœ¨ç€å…³ç³»ï¼ŒERæ¦‚å¿µçš„è§£é‡Šï¼Œç”¨accessä¸­çš„ç¤ºä¾‹æ•°æ®åº“æ¼”ç¤ºè¡¨ä¹‹é—´çš„å…³ç³».<strong>åªæœ‰innodbå¼•æ“æ‰æ”¯æŒforeign keyï¼Œmysqlçš„ä»»ä½•å¼•æ“ç›®å‰éƒ½ä¸æ”¯æŒcheckçº¦æŸã€‚</strong></p><h2 id="å››-å­—ç¬¦é›†å‡ºç°é”™è¯¯è§£å†³åŠæ³•"><strong>å››. å­—ç¬¦é›†å‡ºç°é”™è¯¯è§£å†³åŠæ³•</strong></h2><p>å‡ºç°çš„é—®é¢˜ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update <span class="built_in">users</span></span><br><span class="line">-&gt; <span class="built_in">set</span> username=<span class="string">&#x27;å…³ç¾½&#x27;</span></span><br><span class="line">-&gt; <span class="built_in">where</span> userid=2;</span><br><span class="line"></span><br><span class="line">ERROR 1366 (HY000): Incorrect string value: <span class="string">&#x27;/xB9/xD8/xD3/xF0&#x27;</span> <span class="keyword">for</span> column <span class="string">&#x27;username&#x27;</span> at row 1</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å‘è¡¨ä¸­æ’å…¥ä¸­æ–‡å­—ç¬¦æ—¶ï¼Œå‡ºç°é”™è¯¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from <span class="built_in">users</span>;</span><br><span class="line">+--------+----------+</span><br><span class="line">| userid | username |</span><br><span class="line">+--------+----------+</span><br><span class="line">| 2 | ???? |</span><br><span class="line">| 3 | ???? |</span><br><span class="line">| 4 | ?Ã­?Ã¹ |</span><br><span class="line">+--------+----------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¡¨ä¸­çš„ä¸­æ–‡å­—ç¬¦ä½ä¹±ç ã€‚</p><p>è§£å†³åŠæ³•ï¼š</p><p>ä½¿ç”¨å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; status;</span><br><span class="line">mysql Ver 14.12 Distrib 5.0.45, <span class="keyword">for</span> Win32 (ia32)</span><br><span class="line">Connection <span class="built_in">id</span>: 8</span><br><span class="line">Current database: <span class="built_in">test</span></span><br><span class="line">Current user: root@localhost</span><br><span class="line">SSL: Not <span class="keyword">in</span> use</span><br><span class="line">Using delimiter: ;</span><br><span class="line">Server version: 5.0.45-community-nt MySQL Community Edition (GPL)</span><br><span class="line">Protocol version: 10</span><br><span class="line">Connection: localhost via TCP/IP</span><br><span class="line">Server characterset: latin1</span><br><span class="line">Db characterset: latin1</span><br><span class="line">Client characterset: gbk</span><br><span class="line">Conn. characterset: gbk</span><br><span class="line">TCP port: 3306</span><br><span class="line">Uptime: 7 hours 39 min 19 sec</span><br><span class="line">Threads: 2 Questions: 174 Slow queries: 0 Opens: 57 Flush tables: 1 Open ta</span><br><span class="line">bles: 1 Queries per second avg: 0.006</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹mysqlå‘ç°<strong>Server charactersetï¼ŒDb charactersetçš„å­—ç¬¦é›†è®¾æˆäº†latin1</strong>ï¼Œæ‰€ä»¥å‡ºç°ä¸­æ–‡ä¹±ç ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br><span class="line">+----------------+</span><br><span class="line">| Tables_in_test |</span><br><span class="line">+----------------+</span><br><span class="line">| <span class="built_in">users</span> |</span><br><span class="line">+----------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure><p>æ›´æ”¹è¡¨çš„å­—ç¬¦é›†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table <span class="built_in">users</span> character <span class="built_in">set</span> GBK;</span><br><span class="line">Query OK, 3 rows affected (0.08 sec)</span><br><span class="line">Records: 3 Duplicates: 0 Warnings: 0</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è¡¨çš„ç»“æ„ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show create <span class="built_in">users</span>;</span><br><span class="line"></span><br><span class="line">ERROR 1064 (42000): You have an error <span class="keyword">in</span> your SQL syntax; check the manual that corresponds to your MySQL server version <span class="keyword">for</span> the right syntax to use near <span class="string">&#x27;users&#x27;</span> at line 1</span><br><span class="line">mysql&gt; show create table <span class="built_in">users</span>;</span><br><span class="line"></span><br><span class="line">| Table | Create Table|| <span class="built_in">users</span> | </span><br><span class="line">CREATE TABLE <span class="built_in">users</span> (</span><br><span class="line">userid int(11) default NULL,</span><br><span class="line">username char(20) character <span class="built_in">set</span> latin1 default NULL</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=gbk |</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; desc <span class="built_in">users</span>;</span><br><span class="line"></span><br><span class="line">+----------+----------+------+-----+---------+-------+</span><br><span class="line">| Field | Type | Null | Key | Default | Extra |</span><br><span class="line">+----------+----------+------+-----+---------+-------+</span><br><span class="line">| userid | int(11) | YES | | NULL | |</span><br><span class="line">| username | char(20) | YES | | NULL | |</span><br><span class="line">+----------+----------+------+-----+---------+-------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.02 sec)</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å‘è¡¨ä¸­æ’å…¥ä¸­æ–‡ç„¶åæœ‰é”™è¯¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into <span class="built_in">users</span> values(88,<span class="string">&#x27;ä¸­æ–‡&#x27;</span>);</span><br><span class="line"></span><br><span class="line">ERROR 1366 (HY000): Incorrect string value: <span class="string">&#x27;/xD6/xD0/xCE/xC4&#x27;</span> <span class="keyword">for</span> column <span class="string">&#x27;username&#x27;</span> at row 1</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into <span class="built_in">users</span> values(88,<span class="string">&#x27;ä¸­æ–‡&#x27;</span>);</span><br><span class="line">ERROR 1366 (HY000): Incorrect string value: <span class="string">&#x27;/xD6/xD0/xCE/xC4&#x27;</span> <span class="keyword">for</span> column <span class="string">&#x27;username&#x27;</span> at row 1</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿˜è¦æ›´æ”¹usersè¡¨çš„usernameçš„å­—ç¬¦é›†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table <span class="built_in">users</span> modify username char(20) character <span class="built_in">set</span> gbk;</span><br><span class="line"></span><br><span class="line">ERROR 1366 (HY000): Incorrect string value: <span class="string">&#x27;/xC0/xEE/xCB/xC4&#x27;</span> <span class="keyword">for</span> column <span class="string">&#x27;username&#x27;</span> at row 1</span><br><span class="line"></span><br><span class="line">mysql&gt; alter table <span class="built_in">users</span> modify username char(20) character <span class="built_in">set</span> gbk;</span><br><span class="line"></span><br><span class="line">ERROR 1366 (HY000): Incorrect string value: <span class="string">&#x27;/xC0/xEE/xCB/xC4&#x27;</span> <span class="keyword">for</span> column <span class="string">&#x27;username&#x27;</span> at row 1</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å› ä¸ºè¡¨ä¸­å·²ç»æœ‰æ•°æ®ï¼Œæ‰€ä»¥æ›´æ”¹usernameå­—ç¬¦é›†çš„æ“ä½œæ²¡æœ‰æˆåŠŸ</p><p>æ¸…ç©ºusersè¡¨ä¸­çš„æ•°æ®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="built_in">truncate</span> table <span class="built_in">users</span>;</span><br><span class="line">Query OK, 3 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure><p>é‡æ–°æ›´æ”¹userè¡¨ä¸­usernameçš„å­—ç¬¦é›†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table <span class="built_in">users</span> modify username char(20) character <span class="built_in">set</span> gbk;</span><br><span class="line"></span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line">Records: 0 Duplicates: 0 Warnings: 0</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å†æ’å…¥ä¸­æ–‡å­—ç¬¦ï¼Œæ’å…¥æˆåŠŸã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into <span class="built_in">users</span> values(88,<span class="string">&#x27;ä¸­æ–‡&#x27;</span>);</span><br><span class="line"></span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line">mysql&gt; select * from <span class="built_in">users</span>;</span><br><span class="line">+--------+----------+</span><br><span class="line">| userid | username |</span><br><span class="line">+--------+----------+</span><br><span class="line">| 88 | ä¸­æ–‡ |</span><br><span class="line">+--------+----------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line">mysql&gt;<span class="built_in">exit</span>;</span><br></pre></td></tr></table></figure><p><strong>å­¦ä¹ MySQLå¸¸ç”¨æ“ä½œå‘½ä»¤</strong></p><p><strong>1ã€å¯åŠ¨MySQLæœåŠ¡å™¨</strong></p><p>å®é™…ä¸Šä¸Šç¯‡å·²è®²åˆ°å¦‚ä½•å¯åŠ¨MySQLã€‚ä¸¤ç§æ–¹æ³•ï¼š <strong>ä¸€æ˜¯ç”¨winmysqladminï¼Œå¦‚æœæœºå™¨å¯åŠ¨æ—¶å·²è‡ªåŠ¨è¿è¡Œï¼Œåˆ™å¯ç›´æ¥è¿›å…¥ä¸‹ä¸€æ­¥æ“ä½œã€‚ äºŒæ˜¯åœ¨DOSæ–¹å¼ä¸‹è¿è¡Œ d:mysqlbinmysqld</strong></p><p><strong>2ã€è¿›å…¥mysqläº¤äº’æ“ä½œç•Œé¢</strong></p><p>åœ¨DOSæ–¹å¼ä¸‹ï¼Œè¿è¡Œï¼š <code>d:mysqlbinmysql</code></p><p>å‡ºç°: mysql çš„æç¤ºç¬¦ï¼Œæ­¤æ—¶å·²è¿›å…¥mysqlçš„äº¤äº’æ“ä½œæ–¹å¼ã€‚</p><p>å¦‚æœå‡ºç° &quot;ERROR 2003: Canâ€²t connect to MySQL server on â€²localhostâ€² (10061)â€œï¼Œ</p><p>è¯´æ˜ä½ çš„MySQLè¿˜æ²¡æœ‰å¯åŠ¨ã€‚</p><p><strong>3ã€é€€å‡ºMySQLæ“ä½œç•Œé¢</strong></p><p>åœ¨mysql&gt;æç¤ºç¬¦ä¸‹è¾“å…¥quitå¯ä»¥éšæ—¶é€€å‡ºäº¤äº’æ“ä½œç•Œé¢ï¼š</p><p><code>mysql&gt; quit</code></p><p>Bye</p><p>ä½ ä¹Ÿå¯ä»¥ç”¨control-Dé€€å‡ºã€‚</p><p><strong>4ã€ç¬¬ä¸€æ¡å‘½ä»¤</strong></p><p><code>mysql&gt; select version(),current_date();</code></p><p>Â±---------------Â±----------------+</p><p>| version() | current_date() |</p><p>Â±---------------Â±----------------+</p><p>| 3.23.25a-debug | 2001-05-17 |</p><p>Â±---------------Â±----------------+</p><p>1 row in set (0.01 sec)</p><p>mysql&gt;</p><p>æ­¤å‘½ä»¤è¦æ±‚mysqlæœåŠ¡å™¨å‘Šè¯‰ä½ å®ƒçš„ç‰ˆæœ¬å·å’Œå½“å‰æ—¥æœŸã€‚å°è¯•ç”¨ä¸åŒå¤§å°å†™æ“ä½œä¸Šè¿°å‘½ä»¤ï¼Œçœ‹ç»“æœå¦‚ä½•ã€‚ç»“æœè¯´æ˜mysqlå‘½ä»¤çš„å¤§å°å†™ç»“æœæ˜¯ä¸€è‡´çš„ã€‚</p><p>ç»ƒä¹ å¦‚ä¸‹æ“ä½œï¼š</p><p><code>mysql&gt;Select (20+5)*4;</code></p><p><code>mysql&gt;Select (20+5)*4,sin(pi()/3);</code></p><p><code>mysql&gt;Select (20+5)*4 AS Result,sin(pi()/3);</code> (AS: æŒ‡å®šå‡åä¸ºResult)</p><p><strong>5ã€å¤šè¡Œè¯­å¥</strong></p><p>ä¸€æ¡å‘½ä»¤å¯ä»¥åˆ†æˆå¤šè¡Œè¾“å…¥ï¼Œç›´åˆ°å‡ºç°åˆ†å·â€œï¼›â€ä¸ºæ­¢ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> mysql&gt; select</span><br><span class="line">-&gt; USER()</span><br><span class="line">-&gt; ,</span><br><span class="line">-&gt; now()</span><br><span class="line">-&gt;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+--------------------+---------------------+</span><br><span class="line">| USER() | now() |</span><br><span class="line">+--------------------+---------------------+</span><br><span class="line">| ODBC@localhost | 2001-05-17 22:59:15 |</span><br><span class="line">+--------------------+---------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.06 sec)</span><br><span class="line">mysql&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸­é—´çš„é€—å·å’Œæœ€åçš„åˆ†å·çš„ä½¿ç”¨æ–¹æ³•ã€‚</p><p><strong>6ã€ä¸€è¡Œå¤šå‘½ä»¤</strong></p><p>è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT USER(); SELECT NOW();</span><br><span class="line">+------------------+</span><br><span class="line">| USER() |</span><br><span class="line">+------------------+</span><br><span class="line">| ODBC@localhost |</span><br><span class="line">+------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line">+---------------------+</span><br><span class="line">| NOW() |</span><br><span class="line">+---------------------+</span><br><span class="line">| 2001-05-17 23:06:15 |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸­é—´çš„åˆ†å·ï¼Œå‘½ä»¤ä¹‹é—´ç”¨åˆ†å·éš”å¼€ã€‚</p><p><strong>7ã€æ˜¾ç¤ºå½“å‰å­˜åœ¨çš„æ•°æ®åº“</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+----------+</span><br><span class="line">| Database |</span><br><span class="line">+----------+</span><br><span class="line">| mysql |</span><br><span class="line">| <span class="built_in">test</span> |</span><br><span class="line">+----------+</span><br><span class="line">2 row <span class="keyword">in</span> <span class="built_in">set</span> (0.06 sec)</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure><p><strong>8ã€é€‰æ‹©æ•°æ®åº“å¹¶æ˜¾ç¤ºå½“å‰é€‰æ‹©çš„æ•°æ®åº“</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; USE mysql</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt;</span><br><span class="line">(USE å’Œ QUIT å‘½ä»¤ä¸éœ€è¦åˆ†å·ç»“æŸã€‚)</span><br><span class="line">mysql&gt; select database();</span><br><span class="line">Â±--------------+</span><br><span class="line">| database() |</span><br><span class="line">Â±--------------+</span><br><span class="line">| mysql |</span><br><span class="line">Â±--------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure><p><strong>9ã€æ˜¾ç¤ºå½“å‰æ•°æ®åº“ä¸­å­˜åœ¨çš„è¡¨</strong></p><p><code>mysql&gt; SHOW TABLES;</code></p><p><strong>10ã€æ˜¾ç¤ºè¡¨(db)çš„å†…å®¹</strong></p><p><code>mysql&gt;select * from db;</code></p><p><strong>11ã€å‘½ä»¤çš„å–æ¶ˆ</strong></p><p>å½“å‘½ä»¤è¾“å…¥é”™è¯¯è€Œåˆæ— æ³•æ”¹å˜(å¤šè¡Œè¯­å¥æƒ…å½¢)æ—¶ï¼Œåªè¦åœ¨åˆ†å·å‡ºç°å‰å°±å¯ä»¥ç”¨ cæ¥å–æ¶ˆè¯¥æ¡å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select</span><br><span class="line">-&gt; user()</span><br><span class="line">-&gt; c</span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€äº›æœ€å¸¸ç”¨çš„æœ€åŸºæœ¬çš„æ“ä½œå‘½ä»¤ï¼Œé€šè¿‡å¤šæ¬¡ç»ƒä¹ å°±å¯ä»¥ç‰¢ç‰¢æŒæ‚äº†</p><p>==========================================================================</p><h2 id="äº”-mysqlå‘½ä»¤">äº”. mysqlå‘½ä»¤</h2><p>æµ‹è¯•ç¯å¢ƒï¼šmysql 5.0.45</p><p>ã€æ³¨ï¼šå¯ä»¥åœ¨mysqlä¸­é€šè¿‡mysql&gt; SELECT VERSION();æ¥æŸ¥çœ‹æ•°æ®åº“ç‰ˆæœ¬ã€‘</p><p>æ•´ç†ï¼šleo</p><h3 id="ä¸€ã€è¿æ¥MYSQLã€‚">ä¸€ã€è¿æ¥MYSQLã€‚</h3><p>æ ¼å¼ï¼š <code>mysql -hä¸»æœºåœ°å€ -uç”¨æˆ·å ï¼pç”¨æˆ·å¯†ç </code></p><h4 id="1ã€è¿æ¥åˆ°æœ¬æœºä¸Šçš„MYSQLã€‚"><strong>1ã€è¿æ¥åˆ°æœ¬æœºä¸Šçš„MYSQLã€‚</strong></h4><p>é¦–å…ˆæ‰“å¼€DOSçª—å£ï¼Œç„¶åè¿›å…¥ç›®å½•mysql/binï¼Œå†é”®å…¥å‘½ä»¤<code>mysql -u root -p</code>ï¼Œå›è½¦åæç¤ºä½ è¾“å¯†ç .æ³¨æ„ç”¨æˆ·åå‰å¯ä»¥æœ‰ç©ºæ ¼ä¹Ÿå¯ä»¥æ²¡æœ‰ç©ºæ ¼ï¼Œä½†æ˜¯å¯†ç å‰å¿…é¡»æ²¡æœ‰ç©ºæ ¼ï¼Œå¦åˆ™è®©ä½ é‡æ–°è¾“å…¥å¯†ç .</p><p>å¦‚æœåˆšå®‰è£…å¥½MYSQLï¼Œè¶…çº§ç”¨æˆ·rootæ˜¯æ²¡æœ‰å¯†ç çš„ï¼Œæ•…ç›´æ¥å›è½¦å³å¯è¿›å…¥åˆ°MYSQLä¸­äº†ï¼ŒMYSQLçš„æç¤ºç¬¦æ˜¯ï¼š mysql&gt;</p><h4 id="2ã€è¿æ¥åˆ°è¿œç¨‹ä¸»æœºä¸Šçš„MYSQLã€‚"><strong>2ã€è¿æ¥åˆ°è¿œç¨‹ä¸»æœºä¸Šçš„MYSQLã€‚</strong></h4><p>å‡è®¾è¿œç¨‹ä¸»æœºçš„IPä¸ºï¼š110.110.110.110ï¼Œç”¨æˆ·åä¸ºroot,å¯†ç ä¸ºabcd123ã€‚åˆ™é”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p><p><code>mysql -h110.110.110.110 -u root -p abcd123;</code> (æ³¨:uä¸rootä¹‹é—´å¯ä»¥ä¸ç”¨åŠ ç©ºæ ¼ï¼Œå…¶å®ƒä¹Ÿä¸€æ ·)</p><p><strong>3ã€é€€å‡ºMYSQLå‘½ä»¤ï¼š exit (å›è½¦)</strong></p><h3 id="äºŒã€ä¿®æ”¹å¯†ç ã€‚"><strong>äºŒã€ä¿®æ”¹å¯†ç ã€‚</strong></h3><p>æ ¼å¼ï¼š<code>mysqladmin -uç”¨æˆ·å -pæ—§å¯†ç  password æ–°å¯†ç </code></p><h4 id="1ã€ç»™rootåŠ ä¸ªå¯†ç ab12ã€‚">1ã€ç»™rootåŠ ä¸ªå¯†ç ab12ã€‚</h4><p>é¦–å…ˆåœ¨DOSä¸‹è¿›å…¥ç›®å½•mysql/binï¼Œç„¶åé”®å…¥ä»¥ä¸‹å‘½ä»¤</p><p><code>mysqladmin -u root -password ab12</code></p><p>æ³¨ï¼šå› ä¸ºå¼€å§‹æ—¶rootæ²¡æœ‰å¯†ç ï¼Œæ‰€ä»¥-pæ—§å¯†ç ä¸€é¡¹å°±å¯ä»¥çœç•¥äº†ã€‚</p><h4 id="2ã€å†å°†rootçš„å¯†ç æ”¹ä¸ºdjg345ã€‚">2ã€å†å°†rootçš„å¯†ç æ”¹ä¸ºdjg345ã€‚</h4><p><code>mysqladmin -u root -p ab12 password djg345</code></p><h3 id="ä¸‰ã€å¢åŠ æ–°ç”¨æˆ·ã€‚">ä¸‰ã€å¢åŠ æ–°ç”¨æˆ·ã€‚</h3><p>(æ³¨æ„ï¼šå’Œä¸Šé¢ä¸åŒï¼Œä¸‹é¢çš„å› ä¸ºæ˜¯MYSQLç¯å¢ƒä¸­çš„å‘½ä»¤ï¼Œæ‰€ä»¥åé¢éƒ½å¸¦ä¸€ä¸ªåˆ†å·ä½œä¸ºå‘½ä»¤ç»“æŸç¬¦)</p><p>æ ¼å¼ï¼š<code>grant select on æ•°æ®åº“.* to ç”¨æˆ·å@ç™»å½•ä¸»æœº identified by â€œå¯†ç â€</code></p><p>1ã€å¢åŠ ä¸€ä¸ªç”¨æˆ·test1å¯†ç ä¸ºabcï¼Œè®©ä»–å¯ä»¥åœ¨ä»»ä½•ä¸»æœºä¸Šç™»å½•ï¼Œå¹¶å¯¹æ‰€æœ‰æ•°æ®åº“æœ‰æŸ¥è¯¢ã€æ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤çš„æƒé™ã€‚é¦–å…ˆç”¨rootç”¨æˆ·è¿å…¥MYSQLï¼Œç„¶åé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p><p><code>grant select,insert,update,delete on *.* to [email=test1@â€%]test1@â€%[/email]â€ Identified by â€œabcâ€;</code></p><p><strong>ä½†å¢åŠ çš„ç”¨æˆ·æ˜¯ååˆ†å±é™©çš„ï¼Œä½ æƒ³å¦‚æŸä¸ªäººçŸ¥é“test1çš„å¯†ç ï¼Œé‚£ä¹ˆä»–å°±å¯ä»¥åœ¨internetä¸Šçš„ä»»ä½•ä¸€å°ç”µè„‘ä¸Šç™»å½•ä½ çš„mysqlæ•°æ®åº“å¹¶å¯¹ä½ çš„æ•°æ®å¯ä»¥ä¸ºæ‰€æ¬²ä¸ºäº†ï¼Œè§£å†³åŠæ³•è§2ã€‚</strong></p><p>2ã€å¢åŠ ä¸€ä¸ªç”¨æˆ·test2å¯†ç ä¸ºabc,è®©ä»–åªå¯ä»¥åœ¨localhostä¸Šç™»å½•ï¼Œå¹¶å¯ä»¥å¯¹æ•°æ®åº“mydbè¿›è¡ŒæŸ¥è¯¢ã€æ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤çš„æ“ä½œ(localhostæŒ‡æœ¬åœ°ä¸»æœºï¼Œå³MYSQLæ•°æ®åº“æ‰€åœ¨çš„é‚£å°ä¸»æœº)ï¼Œ</p><p>è¿™æ ·ç”¨æˆ·å³ä½¿ç”¨çŸ¥é“test2çš„å¯†ç ï¼Œä»–ä¹Ÿæ— æ³•ä»internetä¸Šç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œ<strong>åªèƒ½é€šè¿‡MYSQLä¸»æœºä¸Šçš„webé¡µæ¥è®¿é—®äº†ã€‚</strong></p><p><code>grant select,insert,update,delete on mydb.* to [email=test2@localhost]test2@localhost[/email] identified by â€œabcâ€;</code></p><p>å¦‚æœ<strong>ä½ ä¸æƒ³test2æœ‰å¯†ç ï¼Œå¯ä»¥å†æ‰“ä¸€ä¸ªå‘½ä»¤å°†å¯†ç æ¶ˆæ‰ã€‚</strong></p><p><code>grant select,insert,update,delete on mydb.* to [email=test2@localhost]test2@localhost[/email] identified by â€œâ€;</code></p><h2 id="å…­-MYSQLä¸­æœ‰å…³æ•°æ®åº“æ–¹é¢çš„æ“ä½œã€‚">å…­. MYSQLä¸­æœ‰å…³æ•°æ®åº“æ–¹é¢çš„æ“ä½œã€‚</h2><p>æ³¨æ„ï¼šä½ å¿…é¡»é¦–å…ˆç™»å½•åˆ°MYSQLä¸­ï¼Œä»¥ä¸‹æ“ä½œéƒ½æ˜¯åœ¨MYSQLçš„æç¤ºç¬¦ä¸‹è¿›è¡Œçš„ï¼Œè€Œä¸”æ¯ä¸ªå‘½ä»¤ä»¥åˆ†å·ç»“æŸã€‚</p><h3 id="ä¸€ã€æ“ä½œæŠ€å·§">ä¸€ã€æ“ä½œæŠ€å·§</h3><p>1ã€å¦‚æœä½ æ‰“å‘½ä»¤æ—¶ï¼Œå›è½¦åå‘ç°å¿˜è®°åŠ åˆ†å·ï¼Œä½ æ— é¡»é‡æ‰“ä¸€éå‘½ä»¤ï¼Œåªè¦æ‰“ä¸ªåˆ†å·å›è½¦å°±å¯ä»¥äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ä½ å¯ä»¥æŠŠä¸€ä¸ªå®Œæ•´çš„å‘½ä»¤åˆ†æˆå‡ è¡Œæ¥æ‰“ï¼Œå®Œåç”¨åˆ†å·ä½œç»“æŸæ ‡å¿—å°±OKã€‚</p><p>2ã€ä½ å¯ä»¥ä½¿ç”¨å…‰æ ‡ä¸Šä¸‹é”®è°ƒå‡ºä»¥å‰çš„å‘½ä»¤ã€‚</p><h3 id="äºŒã€æ˜¾ç¤ºå‘½ä»¤">äºŒã€æ˜¾ç¤ºå‘½ä»¤</h3><p>1ã€æ˜¾ç¤ºå½“å‰æ•°æ®åº“æœåŠ¡å™¨ä¸­çš„æ•°æ®åº“åˆ—è¡¨ï¼š</p><p><code>mysql&gt; SHOW DATABASES;</code></p><p>æ³¨æ„ï¼šmysqlåº“é‡Œé¢æœ‰MYSQLçš„ç³»ç»Ÿä¿¡æ¯ï¼Œæˆ‘ä»¬æ”¹å¯†ç å’Œæ–°å¢ç”¨æˆ·ï¼Œå®é™…ä¸Šå°±æ˜¯ç”¨è¿™ä¸ªåº“è¿›è¡Œæ“ä½œã€‚</p><p>2ã€æ˜¾ç¤ºæ•°æ®åº“ä¸­çš„æ•°æ®è¡¨ï¼š</p><p><code>mysql&gt; USE åº“åï¼›</code></p><p><code>mysql&gt; SHOW TABLES;</code></p><p>3ã€æ˜¾ç¤ºæ•°æ®è¡¨çš„ç»“æ„ï¼š</p><p><code>mysql&gt; DESCRIBE è¡¨å;</code></p><p>4ã€å»ºç«‹æ•°æ®åº“ï¼š</p><p><code>mysql&gt; CREATE DATABASE åº“å;</code></p><p>5ã€å»ºç«‹æ•°æ®è¡¨ï¼š</p><p><code>mysql&gt; USE åº“å;</code></p><p><code>mysql&gt; CREATE TABLE è¡¨å (å­—æ®µå VARCHAR(20), å­—æ®µå CHAR(1));</code></p><p>6ã€åˆ é™¤æ•°æ®åº“ï¼š</p><p><code>mysql&gt; DROP DATABASE åº“å;</code></p><p>7ã€åˆ é™¤æ•°æ®è¡¨ï¼š</p><p><code>mysql&gt; DROP TABLE è¡¨åï¼›</code></p><p>8ã€å°†è¡¨ä¸­è®°å½•æ¸…ç©ºï¼š</p><p><code>mysql&gt; DELETE FROM è¡¨å;</code></p><p>9ã€æ˜¾ç¤ºè¡¨ä¸­çš„è®°å½•ï¼š</p><p><code>mysql&gt; SELECT * FROM è¡¨å;</code></p><p>10ã€å¾€è¡¨ä¸­æ’å…¥è®°å½•ï¼š</p><p><code>mysql&gt; INSERT INTO è¡¨å VALUES (â€hyqâ€,â€Mâ€);</code></p><p>11ã€æ›´æ–°è¡¨ä¸­æ•°æ®ï¼š</p><p><code>mysql-&gt; UPDATE è¡¨å SET å­—æ®µå1=â€™a',å­—æ®µå2=â€™bâ€™ WHERE å­—æ®µå3=â€™c';</code></p><p>12ã€ç”¨æ–‡æœ¬æ–¹å¼å°†æ•°æ®è£…å…¥æ•°æ®è¡¨ä¸­ï¼š</p><p><code>mysql&gt; LOAD DATA LOCAL INFILE â€œD:/mysql.txtâ€ INTO TABLE è¡¨å;</code></p><p>13ã€å¯¼å…¥.sqlæ–‡ä»¶å‘½ä»¤ï¼š</p><p><code>mysql&gt; USE æ•°æ®åº“å;</code></p><p><code>mysql&gt; SOURCE d:/mysql.sql;</code></p><p>14ã€å‘½ä»¤è¡Œä¿®æ”¹rootå¯†ç ï¼š</p><p><code>mysql&gt; UPDATE mysql.user SET password=PASSWORD(â€™æ–°å¯†ç â€™) WHERE User=â€™rootâ€™;</code></p><p><code>mysql&gt; FLUSH PRIVILEGES;</code></p><p>15ã€æ˜¾ç¤ºuseçš„æ•°æ®åº“åï¼š</p><p><code>mysql&gt; SELECT DATABASE();</code></p><p>16ã€æ˜¾ç¤ºå½“å‰çš„userï¼š</p><p><code>mysql&gt; SELECT USER();</code></p><h3 id="ä¸‰ã€ä¸€ä¸ªå»ºåº“å’Œå»ºè¡¨ä»¥åŠæ’å…¥æ•°æ®çš„å®ä¾‹">ä¸‰ã€ä¸€ä¸ªå»ºåº“å’Œå»ºè¡¨ä»¥åŠæ’å…¥æ•°æ®çš„å®ä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">drop database if exists school; //å¦‚æœå­˜åœ¨SCHOOLåˆ™åˆ é™¤</span><br><span class="line">create database school;       //å»ºç«‹åº“SCHOOL</span><br><span class="line">use school; //æ‰“å¼€åº“SCHOOL</span><br><span class="line"></span><br><span class="line">create table teacher //å»ºç«‹è¡¨TEACHER(</span><br><span class="line">id int(3) auto_increment not null primary key,</span><br><span class="line">name char(10) not null,</span><br><span class="line">address varchar(50) default â€˜æ·±åœ³â€™,</span><br><span class="line">year date</span><br><span class="line">); //å»ºè¡¨ç»“æŸ</span><br><span class="line"></span><br><span class="line">//ä»¥ä¸‹ä¸ºæ’å…¥å­—æ®µ</span><br><span class="line">insert into teacher values(â€,â€™allenâ€™,&#x27;å¤§è¿ä¸€ä¸­â€™,&#x27;1976-10-10â€²);</span><br><span class="line">insert into teacher values(â€,â€™jackâ€™,&#x27;å¤§è¿äºŒä¸­â€™,&#x27;1975-12-23â€²);</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ åœ¨mysqlæç¤ºç¬¦é”®å…¥ä¸Šé¢çš„å‘½ä»¤ä¹Ÿå¯ä»¥ï¼Œä½†ä¸æ–¹ä¾¿è°ƒè¯•ã€‚</p><p>â€‹(1)<strong>ä½ å¯ä»¥å°†ä»¥ä¸Šå‘½ä»¤åŸæ ·å†™å…¥ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­ï¼Œå‡è®¾ä¸ºschool.sqlï¼Œç„¶åå¤åˆ¶åˆ°c://ä¸‹ï¼Œå¹¶åœ¨DOSçŠ¶æ€è¿›å…¥ç›®å½•[url=file:mysql//bin]//mysql//bin[/url]ï¼Œç„¶åé”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</strong></p><p>â€‹<code>mysql -uroot -på¯†ç  &lt; c://school.sql</code></p><p><strong>å¦‚æœæˆåŠŸï¼Œç©ºå‡ºä¸€è¡Œæ— ä»»ä½•æ˜¾ç¤ºï¼›å¦‚æœ‰é”™è¯¯ï¼Œä¼šæœ‰æç¤ºã€‚(ä»¥ä¸Šå‘½ä»¤å·²ç»è°ƒè¯•ï¼Œä½ åªè¦å°†//çš„æ³¨é‡Šå»æ‰å³å¯ä½¿ç”¨)ã€‚</strong></p><p>(2)æˆ–è€…è¿›å…¥å‘½ä»¤è¡Œåä½¿ç”¨ <code>mysql&gt; source c://school.sql; </code>ä¹Ÿå¯ä»¥å°†school.sqlæ–‡ä»¶å¯¼å…¥æ•°æ®åº“ä¸­ã€‚</p><h3 id="å››ã€å°†æ–‡æœ¬æ•°æ®è½¬åˆ°æ•°æ®åº“ä¸­">å››ã€å°†æ–‡æœ¬æ•°æ®è½¬åˆ°æ•°æ®åº“ä¸­</h3><p>1ã€æ–‡æœ¬æ•°æ®åº”ç¬¦åˆçš„æ ¼å¼ï¼šå­—æ®µæ•°æ®ä¹‹é—´ç”¨<strong>tab</strong>é”®éš”å¼€ï¼Œnullå€¼ç”¨<code>[url=file:n]//n[/url]</code>æ¥ä»£æ›¿.ä¾‹ï¼š</p><p><code>3 rose å¤§è¿äºŒä¸­ 1976-10-10</code></p><p><code>4 mike å¤§è¿ä¸€ä¸­ 1975-12-23</code></p><p><strong>å‡è®¾ä½ æŠŠè¿™ä¸¤ç»„æ•°æ®å­˜ä¸ºschool.txtæ–‡ä»¶ï¼Œæ”¾åœ¨cç›˜æ ¹ç›®å½•ä¸‹ã€‚</strong></p><p>æ•°æ®ä¼ å…¥å‘½ä»¤ <code>load data local infile â€œc://school.txtâ€ into table è¡¨å;</code></p><p>æ³¨æ„ï¼šä½ æœ€å¥½å°†æ–‡ä»¶å¤åˆ¶åˆ°[url=file:mysql//bin]//mysql//bin[/url]ç›®å½•ä¸‹ï¼Œå¹¶ä¸”è¦å…ˆç”¨useå‘½ä»¤æ‰“è¡¨æ‰€åœ¨çš„åº“ã€‚</p><h3 id="äº”ã€å¤‡ä»½æ•°æ®åº“1-å¯¼å‡ºæ•´ä¸ªæ•°æ®åº“">äº”ã€å¤‡ä»½æ•°æ®åº“1.å¯¼å‡ºæ•´ä¸ªæ•°æ®åº“</h3><p>å¯¼å‡ºæ–‡ä»¶é»˜è®¤æ˜¯å­˜åœ¨mysql/binç›®å½•ä¸‹</p><p><strong>mysqldump -u ç”¨æˆ·å -p æ•°æ®åº“å &gt; å¯¼å‡ºçš„æ–‡ä»¶å</strong></p><p><code>mysqldump -u user_name -p123456 database_name &gt; outfile_name.sql</code></p><p>2.å¯¼å‡ºä¸€ä¸ªè¡¨</p><p><strong>mysqldump -u ç”¨æˆ·å -p æ•°æ®åº“å è¡¨å&gt; å¯¼å‡ºçš„æ–‡ä»¶å</strong></p><p><code>mysqldump -u user_name -p database_name table_name &gt; outfile_name.sql</code></p><p>3.å¯¼å‡ºä¸€ä¸ªæ•°æ®åº“ç»“æ„</p><p><code>mysqldump -u user_name -p -d â€“add-drop-table database_name &gt; outfile_name.sql</code></p><p><strong>-d æ²¡æœ‰æ•°æ® â€“add-drop-table åœ¨æ¯ä¸ªcreateè¯­å¥ä¹‹å‰å¢åŠ ä¸€ä¸ªdrop table</strong></p><p>4.å¸¦è¯­è¨€å‚æ•°å¯¼å‡º</p><p><code>mysqldump -uroot -p â€“default-character-set=latin1 â€“set-charset=gbk â€“skip-opt database_name &gt; outfile_name.sql</code></p><h3 id="å…­ã€å¯¼å…¥æ•°æ®åº“">å…­ã€å¯¼å…¥æ•°æ®åº“</h3><p>ä¾‹å¦‚ï¼šæ•°æ®åº“åä¸º dbTest</p><p>é¦–å…ˆï¼Œè¿›å…¥mysql</p><p><code>mysql -uroot -p123456</code></p><p>ç„¶åï¼Œåˆ›å»ºæ•°æ®åº“</p><p><code>create dbTest</code></p><p><code>exit</code></p><p>æœ€åï¼Œå¯¼å…¥æ•°æ®åº“</p><p><code>mysql -uroot -p123456 dbTest </code></p><p>æ•°æ®åº“åŠè¡¨å¯¼å‡ºå¯¼å…¥ç¤ºä¾‹ï¼š</p><p>å¯¼å‡ºæ•°æ®åº“</p><p><code>mysqldump -u root -p123456 gameTop &gt; gameTop_db.sql</code></p><p>å¯¼å‡ºæ•°æ®åº“çš„è¡¨</p><p><code>mysqldump -u -p123456 root gameTop gametop800 &gt; gameTop_table.sql</code></p><p>å¯¼å‡ºæ•°æ®åº“çš„ç‰¹å®šè¡¨</p><p><code>mysqldump -u root -p123456  gameTop --table gametop800  &gt; gameTop_table.sql</code></p><p>å¯¼å‡ºæ•°æ®åº“(åªå¯¼ç»“æ„ï¼Œä¸è¦æ•°æ®)</p><p><code>mysqldump -u root -p123456 --opt -d gameTop &gt; gameTop_db.sql</code></p><p>æˆ–è€…</p><p><code>mysqldump -u root -p123456  -d gameTop &gt; gameTop_db.sql</code></p><p>å¯¼å‡ºæ•°æ®åº“(åªå¯¼æ•°æ®ï¼Œä¸è¦ç»“æ„)</p><p><code>mysqldump -u root -p123456  -t gameTop &gt; gameTop_db.sql</code></p><p>æ³¨ï¼šä¸åŠ  -d å’Œ -t åˆ™æ—¢å¯¼å‡ºç»“æ„ï¼Œä¹Ÿå¯¼å‡ºæ•°æ®</p><p>mysqldumpå¯¼å‡ºæŠ›å‡ºå¼‚å¸¸ï¼š</p><p><code>mysqldump: Got error: 1044: Access denied for user 'username'@'%' to database 'dbname' when using LOCK TABLES</code></p><p>è§£å†³åŠæ³•ï¼Œæ·»åŠ å‚æ•° --skip-lock-tablesï¼š</p><p><code>mysqldump --skip-lock-tables -h172.88.12.102 -username-pAnJnVs3C2tYXyTwV dbname&gt; dbname_bk.sql</code></p><p>å¯¼å…¥æ•°æ®åº“ï¼š</p><p>ç™»å½•MySQL:      <code>mysql -uroot -p123456</code></p><p>åˆ›å»ºæ•°æ®åº“ï¼š    <code>create database gameTop;</code></p><p>å¯¼å…¥æ•°æ®åº“ï¼š</p><p><code>mysql -uroot -p123456 gameTop </code></p><p>å¯¼å…¥æ•°æ®åº“è¡¨ï¼š</p><p><code>mysql -uroot -p123456 gameTop  gametop800 &lt;  gameTop_table.sql</code></p><p>å¯¼å…¥æ•°æ®åº“è¡¨ï¼š</p><p><code>mysql -uroot -p123456 gameTop  </code></p><p>1:ä½¿ç”¨SHOWè¯­å¥æ‰¾å‡ºåœ¨æœåŠ¡å™¨ä¸Šå½“å‰å­˜åœ¨ä»€ä¹ˆæ•°æ®åº“ï¼š</p><p><code>mysql&gt; SHOW DATABASES;</code></p><p>2:åˆ›å»ºä¸€ä¸ªæ•°æ®åº“MYSQLDATA</p><p><code>mysql&gt; CREATE DATABASE MYSQLDATA;</code></p><p>3:é€‰æ‹©ä½ æ‰€åˆ›å»ºçš„æ•°æ®åº“</p><p><code>mysql&gt; USE MYSQLDATA;</code> (æŒ‰å›è½¦é”®å‡ºç°Database changed æ—¶è¯´æ˜æ“ä½œæˆåŠŸï¼)</p><p>4:æŸ¥çœ‹ç°åœ¨çš„æ•°æ®åº“ä¸­å­˜åœ¨ä»€ä¹ˆè¡¨</p><p><code>mysql&gt; SHOW TABLES;</code></p><p>5:åˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¡¨</p><p><code>mysql&gt; CREATE TABLE MYTABLE (name VARCHAR(20), sex CHAR(1));</code></p><p>6:æ˜¾ç¤ºè¡¨çš„ç»“æ„ï¼š</p><p><code>mysql&gt; DESCRIBE MYTABLE;</code></p><p>7:å¾€è¡¨ä¸­åŠ å…¥è®°å½•</p><p><code>mysql&gt; insert into MYTABLE values (â€hyqâ€,â€Mâ€);</code></p><p>8:ç”¨æ–‡æœ¬æ–¹å¼å°†æ•°æ®è£…å…¥æ•°æ®åº“è¡¨ä¸­(ä¾‹å¦‚D:/mysql.txt)</p><p><code>mysql&gt; LOAD DATA LOCAL INFILE â€œD:/mysql.txtâ€ INTO TABLE MYTABLE;</code></p><p>9:å¯¼å…¥.sqlæ–‡ä»¶å‘½ä»¤(ä¾‹å¦‚D:/mysql.sql)</p><p><code>mysql&gt;use database;</code></p><p><code>mysql&gt;source d:/mysql.sql;</code></p><p>10:åˆ é™¤è¡¨</p><p><code>mysql&gt;drop TABLE MYTABLE;</code></p><p>11:æ¸…ç©ºè¡¨</p><p><code>mysql&gt;delete from MYTABLE;</code></p><p>12:æ›´æ–°è¡¨ä¸­æ•°æ®</p><p><code>mysql&gt;update MYTABLE set sex=â€fâ€ where name=â€™hyqâ€™;</code></p><p>ä»¥ä¸‹æ˜¯æ— æ„ä¸­åœ¨ç½‘ç»œçœ‹åˆ°çš„ä½¿ç”¨MySqlçš„ç®¡ç†å¿ƒå¾—,</p><ul><li><p>åœ¨windowsä¸­MySqlä»¥æœåŠ¡å½¢å¼å­˜åœ¨ï¼Œåœ¨ä½¿ç”¨å‰åº”ç¡®ä¿æ­¤æœåŠ¡å·²ç»å¯åŠ¨ï¼Œæœªå¯åŠ¨å¯ç”¨net start mysqlå‘½ä»¤å¯åŠ¨ã€‚è€ŒLinuxä¸­å¯åŠ¨æ—¶å¯ç”¨â€œ/etc/rc.d/init.d/mysqld startâ€å‘½ä»¤ï¼Œæ³¨æ„å¯åŠ¨è€…åº”å…·æœ‰ç®¡ç†å‘˜æƒé™ã€‚</p></li><li><p>åˆšå®‰è£…å¥½çš„MySqlåŒ…å«ä¸€ä¸ªå«ç©ºå¯†ç çš„rootå¸æˆ·å’Œä¸€ä¸ªåŒ¿åå¸æˆ·ï¼Œè¿™æ˜¯å¾ˆå¤§çš„å®‰å…¨éšæ‚£ï¼Œå¯¹äºä¸€äº›é‡è¦çš„åº”ç”¨æˆ‘ä»¬åº”å°†å®‰å…¨æ€§å°½å¯èƒ½æé«˜ï¼Œåœ¨è¿™é‡Œåº”æŠŠåŒ¿åå¸æˆ·åˆ é™¤ã€ rootå¸æˆ·è®¾ç½®å¯†ç ï¼Œå¯ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">delete from User <span class="built_in">where</span> User=â€<span class="string">&quot;;</span></span><br><span class="line"><span class="string">update User set Password=PASSWORD(â€™newpasswordâ€™) where User=â€™rootâ€™;</span></span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœè¦å¯¹ç”¨æˆ·æ‰€ç”¨çš„ç™»å½•ç»ˆç«¯è¿›è¡Œé™åˆ¶ï¼Œå¯ä»¥æ›´æ–°Userè¡¨ä¸­ç›¸åº”ç”¨æˆ·çš„Hostå­—æ®µï¼Œåœ¨è¿›è¡Œäº†ä»¥ä¸Šæ›´æ”¹ååº”é‡æ–°å¯åŠ¨æ•°æ®åº“æœåŠ¡ï¼Œæ­¤æ—¶ç™»å½•æ—¶å¯ç”¨å¦‚ä¸‹ç±»ä¼¼å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p;</span><br><span class="line">mysql -uroot -pnewpassword;</span><br><span class="line">mysql mydb -uroot -p;</span><br><span class="line">mysql mydb -uroot -pnewpassword;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å‘½ä»¤å‚æ•°æ˜¯å¸¸ç”¨å‚æ•°çš„ä¸€éƒ¨åˆ†ï¼Œè¯¦ç»†æƒ…å†µå¯å‚è€ƒæ–‡æ¡£ã€‚æ­¤å¤„çš„mydbæ˜¯è¦ç™»å½•çš„æ•°æ®åº“çš„åç§°ã€‚</p></li><li><p>åœ¨ è¿›è¡Œå¼€å‘å’Œå®é™…åº”ç”¨ä¸­ï¼Œç”¨æˆ·ä¸åº”è¯¥åªç”¨rootç”¨æˆ·è¿›è¡Œè¿æ¥æ•°æ®åº“ï¼Œè™½ç„¶ä½¿ç”¨rootç”¨æˆ·è¿›è¡Œæµ‹è¯•æ—¶å¾ˆæ–¹ä¾¿ï¼Œä½†ä¼šç»™ç³»ç»Ÿå¸¦æ¥é‡å¤§å®‰å…¨éšæ‚£ï¼Œä¹Ÿä¸åˆ©äºç®¡ç†æŠ€ æœ¯çš„æé«˜ã€‚æˆ‘ä»¬ç»™ä¸€ä¸ªåº”ç”¨ä¸­ä½¿ç”¨çš„ç”¨æˆ·èµ‹äºˆæœ€æ°å½“çš„æ•°æ®åº“æƒé™ã€‚å¦‚ä¸€ä¸ªåªè¿›è¡Œæ•°æ®æ’å…¥çš„ç”¨æˆ·ä¸åº”èµ‹äºˆå…¶åˆ é™¤æ•°æ®çš„æƒé™ã€‚</p></li><li><p>MySqlçš„ç”¨æˆ·ç®¡ç†æ˜¯é€šè¿‡ Userè¡¨æ¥å®ç°çš„ï¼Œæ·»åŠ æ–°ç”¨æˆ·å¸¸ç”¨çš„æ–¹æ³•æœ‰ä¸¤ä¸ªï¼Œä¸€æ˜¯åœ¨Userè¡¨æ’å…¥ç›¸åº”çš„æ•°æ®è¡Œï¼ŒåŒæ—¶è®¾ç½®ç›¸åº”çš„æƒé™ï¼›äºŒæ˜¯é€šè¿‡GRANTå‘½ä»¤åˆ›å»ºå…·æœ‰æŸç§æƒé™çš„ç”¨ æˆ·ã€‚å…¶ä¸­GRANTçš„å¸¸ç”¨ç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grant all on mydb.* to NewUserName@HostName identified by â€œpasswordâ€ ;</span><br><span class="line">grant usage on . to NewUserName@HostName identified by â€œpasswordâ€;</span><br><span class="line">grant select,insert,update on mydb.* to NewUserName@HostName identified by â€œpasswordâ€;</span><br><span class="line">grant update,delete on mydb.TestTable to NewUserName@HostName identified by â€œpasswordâ€;</span><br></pre></td></tr></table></figure></li><li><p>è‹¥ è¦ç»™æ­¤ç”¨æˆ·èµ‹äºˆä»–åœ¨ç›¸åº”å¯¹è±¡ä¸Šçš„æƒé™çš„ç®¡ç†èƒ½åŠ›ï¼Œå¯åœ¨GRANTåé¢æ·»åŠ WITH GRANT OPTIONé€‰é¡¹ã€‚è€Œå¯¹äºç”¨æ’å…¥Userè¡¨æ·»åŠ çš„ç”¨æˆ·ï¼ŒPasswordå­—æ®µåº”ç”¨PASSWORD å‡½æ•°è¿›è¡Œæ›´æ–°åŠ å¯†ï¼Œä»¥é˜²ä¸è½¨ä¹‹äººçªƒçœ‹å¯†ç ã€‚å¯¹äºé‚£äº›å·²ç»ä¸ç”¨çš„ç”¨æˆ·åº”ç»™äºˆæ¸…é™¤ï¼Œæƒé™è¿‡ç•Œçš„ç”¨æˆ·åº”åŠæ—¶å›æ”¶æƒé™ï¼Œå›æ”¶æƒé™å¯ä»¥é€šè¿‡æ›´æ–°Userè¡¨ç›¸åº”å­—æ®µï¼Œ ä¹Ÿå¯ä»¥ä½¿ç”¨REVOKEæ“ä½œã€‚</p></li></ul><p>ä¸‹é¢ç»™å‡ºæœ¬äººä»å…¶å®ƒèµ„æ–™(<a href="http://www.cn-Java.com">www.cn-Java.com</a>)è·å¾—çš„å¯¹å¸¸ç”¨æƒé™çš„è§£é‡Šï¼š</p><h2 id="ä¸ƒ-å…¨å±€ç®¡ç†æƒé™ï¼š">ä¸ƒ. å…¨å±€ç®¡ç†æƒé™ï¼š</h2><ol><li><strong>FILE: åœ¨MySQLæœåŠ¡å™¨ä¸Šè¯»å†™æ–‡ä»¶ã€‚</strong></li><li><strong>PROCESS: æ˜¾ç¤ºæˆ–æ€æ­»å±äºå…¶å®ƒç”¨æˆ·çš„æœåŠ¡çº¿ç¨‹ã€‚</strong></li><li><strong>RELOAD: é‡è½½è®¿é—®æ§åˆ¶è¡¨ï¼Œåˆ·æ–°æ—¥å¿—ç­‰ã€‚</strong></li><li><strong>SHUTDOWN: å…³é—­MySQLæœåŠ¡ã€‚</strong></li><li><strong>æ•°æ®åº“/æ•°æ®è¡¨/æ•°æ®åˆ—æƒé™ï¼š</strong></li><li><strong>ALTER: ä¿®æ”¹å·²å­˜åœ¨çš„æ•°æ®è¡¨(ä¾‹å¦‚å¢åŠ /åˆ é™¤åˆ—)å’Œç´¢å¼•ã€‚</strong></li><li><strong>CREATE: å»ºç«‹æ–°çš„æ•°æ®åº“æˆ–æ•°æ®è¡¨.</strong></li><li><strong>DELETE: åˆ é™¤è¡¨çš„è®°å½•ã€‚</strong></li><li><strong>DROP: åˆ é™¤æ•°æ®è¡¨æˆ–æ•°æ®åº“ã€‚</strong></li><li><strong>INDEX: å»ºç«‹æˆ–åˆ é™¤ç´¢å¼•ã€‚</strong></li><li><strong>INSERT: å¢åŠ è¡¨çš„è®°å½•ã€‚</strong></li><li><strong>SELECT: æ˜¾ç¤º/æœç´¢è¡¨çš„è®°å½•ã€‚</strong></li><li><strong>UPDATE: ä¿®æ”¹è¡¨ä¸­å·²å­˜åœ¨çš„è®°å½•ã€‚</strong></li><li><strong>ç‰¹åˆ«çš„æƒé™ï¼šALL: å…è®¸åšä»»ä½•äº‹(å’Œrootä¸€æ ·)ã€‚</strong></li><li><strong>USAGE: åªå…è®¸ç™»å½•â€“å…¶å®ƒä»€ä¹ˆä¹Ÿä¸å…è®¸åšã€‚</strong></li></ol><p>çŸ¥è¯†æ‹“å±•ï¼š</p><p><code>mysql -uroot -p123456 gameTop  gametop800</code></p>]]></content>
    
    
    <summary type="html">ä½œä¸ºå½“ä»Šæœ€å—æ¬¢è¿çš„æ•°æ®åº“ï¼Œå…¶å› ä¸ºå…è´¹ï¼Œè½»é‡è€Œæˆä¸ºç›®å‰ä¼ä¸šçº§å¼€å‘çš„ä¸»è¦æ•°æ®åº“ã€‚</summary>
    
    
    
    <category term="æ•°æ®åº“" scheme="https://luoxiaohei520.github.io/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="MySQL" scheme="https://luoxiaohei520.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>05Spring Boot çš„å®é™…å¼€å‘ä¸­ç”Ÿäº§å°±ç»ªåŠŸèƒ½</title>
    <link href="https://luoxiaohei520.github.io/posts/f95521c8.html"/>
    <id>https://luoxiaohei520.github.io/posts/f95521c8.html</id>
    <published>2023-11-09T02:50:23.333Z</published>
    <updated>2023-11-09T02:50:23.333Z</updated>
    
    <content type="html"><![CDATA[<p><a id="production-ready"></a></p><h1>äº”ã€Spring Boot Actuator: ç”Ÿäº§å°±ç»ªåŠŸèƒ½</h1><p>Spring Boot åŒ…å«è®¸å¤šå…¶ä»–åŠŸèƒ½ï¼Œå¯å¸®åŠ©ä½ åœ¨å°†åº”ç”¨ç¨‹åºæ¨é€åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶ç›‘æ§å’Œç®¡ç†åº”ç”¨ç¨‹åºã€‚ä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨ HTTP ç«¯ç‚¹æˆ– JMX æ¥ç®¡ç†å’Œç›‘æ§åº”ç”¨ç¨‹åºã€‚å®¡è®¡ã€å¥åº·å’ŒæŒ‡æ ‡æ”¶é›†ä¹Ÿå¯ä»¥è‡ªåŠ¨åº”ç”¨äºä½ çš„åº”ç”¨ç¨‹åºã€‚</p><p><a id="production-ready-enabling"></a></p><h2 id="52ã€å¯ç”¨ç”Ÿäº§å°±ç»ªåŠŸèƒ½">52ã€å¯ç”¨ç”Ÿäº§å°±ç»ªåŠŸèƒ½</h2><p><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator"><code>spring-boot-actuator</code></a> æ¨¡å—æä¾›äº† Spring Boot çš„æ‰€æœ‰ç”Ÿäº§å°±ç»ªåŠŸèƒ½ã€‚å¯ç”¨è¿™äº›åŠŸèƒ½çš„æœ€ç®€å•æ–¹æ³•æ˜¯æ·»åŠ  <code>spring-boot-starter-actuator</code> starter åˆ°ä¾èµ–ä¸­ã€‚</p><blockquote><p><strong>Actuator çš„å®šä¹‰</strong></p><p>Actuator æ˜¯åˆ¶é€ æœ¯è¯­ï¼ŒæŒ‡çš„æ˜¯ç”¨äºç§»åŠ¨æˆ–æ§åˆ¶æŸç‰©çš„æœºæ¢°è£…ç½®ã€‚Actuator å¯ä»¥é€šè¿‡ä¸€ä¸ªå°çš„å˜åŒ–äº§ç”Ÿå¤§é‡çš„è¿åŠ¨ã€‚</p></blockquote><p>è¦å°† actuator æ·»åŠ åˆ°åŸºäº Maven çš„é¡¹ç›®ï¼Œè¯·æ·»åŠ ä»¥ä¸‹ starter ä¾èµ–é¡¹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯¹äº Gradleï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å£°æ˜ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">compile(<span class="string">&quot;org.springframework.boot:spring-boot-starter-actuator&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="production-ready-endpoints"></a></p><h2 id="53ã€ç«¯ç‚¹">53ã€ç«¯ç‚¹</h2><p>é€šè¿‡ Actuator ç«¯ç‚¹ï¼Œä½ å¯ä»¥ç›‘æ§åº”ç”¨ç¨‹åºå¹¶ä¸ä¹‹äº¤äº’ã€‚Spring Boot åŒ…å«è®¸å¤šå†…ç½®ç«¯ç‚¹ï¼Œä¹Ÿå…è®¸ä½ æ·»åŠ è‡ªå·±çš„ç«¯ç‚¹ã€‚ä¾‹å¦‚ï¼Œ<code>health</code> ç«¯ç‚¹æä¾›åŸºæœ¬çš„åº”ç”¨ç¨‹åºå¥åº·ä¿¡æ¯ã€‚</p><p>å¯ä»¥<a href="#production-ready-endpoints-enabling-endpoints">å¯ç”¨æˆ–ç¦ç”¨</a>æ¯ä¸ªç«¯ç‚¹ã€‚å®ƒå¯æ§åˆ¶å½“å…¶ bean å­˜åœ¨äºåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­æ˜¯å¦åˆ›å»ºç«¯ç‚¹ã€‚è¦è¿›è¡Œè¿œç¨‹è®¿é—®ï¼Œå¿…é¡»<a href="#production-ready-endpoints-exposing-endpoints">é€šè¿‡ JMX æˆ– HTTP æš´éœ²ç«¯ç‚¹</a>ã€‚å¤§å¤šæ•°åº”ç”¨ç¨‹åºé€‰æ‹© HTTP æ–¹å¼ï¼Œç«¯ç‚¹çš„ ID ä»¥åŠ <code>/actuator</code> çš„å‰ç¼€æ˜ å°„åˆ°ä¸€ä¸ª URLã€‚ä¾‹å¦‚ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>health</code> ç«¯ç‚¹æ˜ å°„åˆ° <code>/actuator/health</code>ã€‚</p><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸æŠ€æœ¯æ— å…³çš„ç«¯ç‚¹ï¼š</p><table><thead><tr><th>ID</th><th>æè¿°</th><th style="text-align:center">é»˜è®¤å¯ç”¨</th></tr></thead><tbody><tr><td><code>auditevents</code></td><td>æš´éœ²å½“å‰åº”ç”¨ç¨‹åºçš„å®¡è®¡äº‹ä»¶ä¿¡æ¯ã€‚</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>beans</code></td><td>æ˜¾ç¤ºåº”ç”¨ç¨‹åºä¸­æ‰€æœ‰ Spring bean çš„å®Œæ•´åˆ—è¡¨ã€‚</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>caches</code></td><td>æš´éœ²å¯ç”¨çš„ç¼“å­˜ã€‚</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>conditions</code></td><td>æ˜¾ç¤ºåœ¨é…ç½®å’Œè‡ªåŠ¨é…ç½®ç±»ä¸Šè¯„ä¼°çš„æ¡ä»¶ä»¥åŠå®ƒä»¬åŒ¹é…æˆ–ä¸åŒ¹é…çš„åŸå› ã€‚</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>configprops</code></td><td>æ˜¾ç¤ºæ‰€æœ‰ <code>@ConfigurationProperties</code> çš„æ ¡å¯¹æ¸…å•ã€‚</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>env</code></td><td>æš´éœ² Spring <code>ConfigurableEnvironment</code> ä¸­çš„å±æ€§ã€‚</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>flyway</code></td><td>æ˜¾ç¤ºå·²åº”ç”¨çš„ Flyway æ•°æ®åº“è¿ç§»ã€‚</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>health</code></td><td>æ˜¾ç¤ºåº”ç”¨ç¨‹åºå¥åº·ä¿¡æ¯</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>httptrace</code></td><td>æ˜¾ç¤º HTTP è¿½è¸ªä¿¡æ¯ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œæœ€å 100 ä¸ª HTTP è¯·æ±‚/å“åº”äº¤æ¢ï¼‰ã€‚</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>info</code></td><td>æ˜¾ç¤ºåº”ç”¨ç¨‹åºä¿¡æ¯ã€‚</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>integrationgraph</code></td><td>æ˜¾ç¤º Spring Integration å›¾ã€‚</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>loggers</code></td><td>æ˜¾ç¤ºå’Œä¿®æ”¹åº”ç”¨ç¨‹åºä¸­æ—¥å¿—è®°å½•å™¨çš„é…ç½®ã€‚</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>liquibase</code></td><td>æ˜¾ç¤ºå·²åº”ç”¨çš„ Liquibase æ•°æ®åº“è¿ç§»ã€‚</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>metrics</code></td><td>æ˜¾ç¤ºå½“å‰åº”ç”¨ç¨‹åºçš„æŒ‡æ ‡åº¦é‡ä¿¡æ¯ã€‚</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>mappings</code></td><td>æ˜¾ç¤ºæ‰€æœ‰ <code>@RequestMapping</code> è·¯å¾„çš„æ•´ç†æ¸…å•ã€‚</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>scheduledtasks</code></td><td>æ˜¾ç¤ºåº”ç”¨ç¨‹åºä¸­çš„è°ƒåº¦ä»»åŠ¡ã€‚</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>sessions</code></td><td>å…è®¸ä» Spring Session æ”¯æŒçš„ä¼šè¯å­˜å‚¨ä¸­æ£€ç´¢å’Œåˆ é™¤ç”¨æˆ·ä¼šè¯ã€‚å½“ä½¿ç”¨ Spring Session çš„å“åº”å¼ Web åº”ç”¨ç¨‹åºæ”¯æŒæ—¶ä¸å¯ç”¨ã€‚</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>shutdown</code></td><td>æ­£å¸¸å…³é—­åº”ç”¨ç¨‹åºã€‚</td><td style="text-align:center">å¦</td></tr><tr><td><code>threaddump</code></td><td>æ‰§è¡Œçº¿ç¨‹ dumpã€‚</td><td style="text-align:center">æ˜¯</td></tr></tbody></table><p>å¦‚æœä½ çš„åº”ç”¨ç¨‹åºæ˜¯ Web åº”ç”¨ç¨‹åºï¼ˆSpring MVCã€Spring WebFlux æˆ– Jerseyï¼‰ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹é™„åŠ ç«¯ç‚¹ï¼š</p><table><thead><tr><th>ID</th><th>æè¿°</th><th style="text-align:center">é»˜è®¤å¯ç”¨</th></tr></thead><tbody><tr><td><code>heapdump</code></td><td>è¿”å›ä¸€ä¸ª <code>hprof</code> å † dump æ–‡ä»¶ã€‚</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>jolokia</code></td><td>é€šè¿‡ HTTP æš´éœ² JMX beanï¼ˆå½“ Jolokia åœ¨ classpath ä¸Šæ—¶ï¼Œä¸é€‚ç”¨äº WebFluxï¼‰ã€‚</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>logfile</code></td><td>è¿”å›æ—¥å¿—æ–‡ä»¶çš„å†…å®¹ï¼ˆå¦‚æœå·²è®¾ç½® <code>logging.file</code> æˆ– <code>logging.path</code> å±æ€§ï¼‰ã€‚æ”¯æŒä½¿ç”¨ HTTP <code>Range</code> å¤´æ¥æ£€ç´¢éƒ¨åˆ†æ—¥å¿—æ–‡ä»¶çš„å†…å®¹ã€‚</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>prometheus</code></td><td>ä»¥å¯ä»¥ç”± Prometheus æœåŠ¡å™¨æŠ“å–çš„æ ¼å¼æš´éœ²æŒ‡æ ‡ã€‚</td><td style="text-align:center">æ˜¯</td></tr></tbody></table><p>æƒ³äº†è§£æœ‰å…³ Actuator ç«¯ç‚¹åŠå…¶è¯·æ±‚å’Œå“åº”æ ¼å¼çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…å•ç‹¬çš„ API æ–‡æ¡£ï¼ˆ<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/actuator-api//html">HTML</a> æˆ– <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/actuator-api//pdf/spring-boot-actuator-web-api.pdf">PDF</a>ï¼‰ã€‚</p><p><a id="production-ready-endpoints-enabling-endpoints"></a></p><h3 id="53-1ã€å¯ç”¨ç«¯ç‚¹">53.1ã€å¯ç”¨ç«¯ç‚¹</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒActuator å¯ç”¨é™¤ <code>shutdown</code> ä¹‹å¤–çš„æ‰€æœ‰ç«¯ç‚¹ã€‚è¦é…ç½®ç«¯ç‚¹çš„å¯ç”¨ï¼Œè¯·ä½¿ç”¨å…¶ <code>management.endpoint.&lt;id&gt;.enabled</code> å±æ€§ã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å¯ç”¨å…³é—­ç«¯ç‚¹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.endpoint.shutdown.enabled</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä½ å¸Œæœ›ç«¯ç‚¹å¯ç”¨æ˜¯é€‰æ‹©æ€§åŠ å…¥è€Œä¸æ˜¯é€‰æ‹©æ€§é€€å‡ºï¼Œè¯·å°† <code>management.endpoints.enabled-by-default</code> å±æ€§è®¾ç½®ä¸º <code>false</code>ï¼Œå¹¶ä½¿ç”¨å„ä¸ªç«¯ç‚¹çš„ <code>enabled</code> å±æ€§é‡æ–°åŠ å…¥ã€‚ä»¥ä¸‹ç¤ºä¾‹å¯ç”¨ <code>info</code> ç«¯ç‚¹å¹¶ç¦ç”¨æ‰€æœ‰å…¶ä»–ç«¯ç‚¹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.endpoints.enabled-by-default</span>=<span class="literal">false</span></span><br><span class="line"><span class="attr">management.endpoint.info.enabled</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>å·²å®Œå…¨ä»åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­åˆ é™¤å·²ç¦ç”¨çš„ç«¯ç‚¹ã€‚å¦‚æœåªæƒ³æ›´æ”¹ç«¯ç‚¹æ‰€æš´éœ²çš„æŠ€æœ¯ï¼Œè¯·æ”¹ç”¨ <a href="#production-ready-endpoints-exposing-endpoints"><code>include</code> å’Œ <code>exclude</code> å±æ€§</a>ã€‚</p></blockquote><p><a id="production-ready-endpoints-exposing-endpoints"></a></p><h3 id="53-2ã€æš´éœ²ç«¯ç‚¹">53.2ã€æš´éœ²ç«¯ç‚¹</h3><p>ç”±äºç«¯ç‚¹å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œå› æ­¤åº”ä»”ç»†è€ƒè™‘ä½•æ—¶æš´éœ²å®ƒä»¬ã€‚ä¸‹è¡¨æ˜¾ç¤ºäº†å†…ç½®ç«¯ç‚¹å’Œé»˜è®¤æš´éœ²æƒ…å†µï¼š</p><table><thead><tr><th>ID</th><th>JMX</th><th style="text-align:center">Web</th></tr></thead><tbody><tr><td><code>auditevents</code></td><td>æ˜¯</td><td style="text-align:center">å¦</td></tr><tr><td><code>beans</code></td><td>æ˜¯</td><td style="text-align:center">å¦</td></tr><tr><td><code>caches</code></td><td>æ˜¯</td><td style="text-align:center">å¦</td></tr><tr><td><code>conditions</code></td><td>æ˜¯</td><td style="text-align:center">å¦</td></tr><tr><td><code>configprops</code></td><td>æ˜¯</td><td style="text-align:center">å¦</td></tr><tr><td><code>env</code></td><td>æ˜¯</td><td style="text-align:center">å¦</td></tr><tr><td><code>flyway</code></td><td>æ˜¯</td><td style="text-align:center">å¦</td></tr><tr><td><code>health</code></td><td>æ˜¯</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>heapdump</code></td><td>N/A</td><td style="text-align:center">å¦</td></tr><tr><td><code>httptrace</code></td><td>æ˜¯</td><td style="text-align:center">å¦</td></tr><tr><td><code>info</code></td><td>æ˜¯</td><td style="text-align:center">æ˜¯</td></tr><tr><td><code>integrationgraph</code></td><td>æ˜¯</td><td style="text-align:center">å¦</td></tr><tr><td><code>jolokia</code></td><td>N/A</td><td style="text-align:center">å¦</td></tr><tr><td><code>logfile</code></td><td>N/A</td><td style="text-align:center">å¦</td></tr><tr><td><code>loggers</code></td><td>æ˜¯</td><td style="text-align:center">å¦</td></tr><tr><td><code>liquibase</code></td><td>æ˜¯</td><td style="text-align:center">å¦</td></tr><tr><td><code>metrics</code></td><td>æ˜¯</td><td style="text-align:center">å¦</td></tr><tr><td><code>mappings</code></td><td>æ˜¯</td><td style="text-align:center">å¦</td></tr><tr><td><code>prometheus</code></td><td>N/A</td><td style="text-align:center">å¦</td></tr><tr><td><code>scheduledtasks</code></td><td>æ˜¯</td><td style="text-align:center">å¦</td></tr><tr><td><code>sessions</code></td><td>æ˜¯</td><td style="text-align:center">å¦</td></tr><tr><td><code>shutdown</code></td><td>æ˜¯</td><td style="text-align:center">å¦</td></tr><tr><td><code>threaddump</code></td><td>æ˜¯</td><td style="text-align:center">å¦</td></tr></tbody></table><p>è¦æ›´æ”¹æš´éœ²çš„ç«¯ç‚¹ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹ç‰¹å®šçš„ <code>include</code> å’Œ <code>exclude</code> å±æ€§ï¼š</p><table><thead><tr><th>å±æ€§</th><th>é»˜è®¤</th></tr></thead><tbody><tr><td><code>management.endpoints.jmx.exposure.exclude</code></td><td></td></tr><tr><td><code>management.endpoints.jmx.exposure.include</code></td><td><code>*</code></td></tr><tr><td><code>management.endpoints.web.exposure.exclude</code></td><td></td></tr><tr><td><code>management.endpoints.web.exposure.include</code></td><td><code>info, health</code></td></tr></tbody></table><p><code>include</code> å±æ€§åˆ—å‡ºäº†æš´éœ²çš„ç«¯ç‚¹çš„ IDã€‚<code>exclude</code> å±æ€§åˆ—å‡ºäº†ä¸åº”æš´éœ²çš„ç«¯ç‚¹çš„ IDã€‚<code>exclude</code> å±æ€§ä¼˜å…ˆäº <code>include</code> å±æ€§ã€‚å¯ä»¥ä½¿ç”¨ç«¯ç‚¹ ID åˆ—è¡¨é…ç½® <code>include</code> å’Œ <code>exclude</code> å±æ€§ã€‚</p><p>ä¾‹å¦‚ï¼Œè¦åœæ­¢é€šè¿‡ JMX æš´éœ²æ‰€æœ‰ç«¯ç‚¹å¹¶ä»…æš´éœ² <code>health</code> å’Œ <code>info</code> ç«¯ç‚¹ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å±æ€§ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.endpoints.jmx.exposure.include</span>=health,info</span><br></pre></td></tr></table></figure><p><code>*</code> å¯ç”¨äºé€‰æ‹©æ‰€æœ‰ç«¯ç‚¹ã€‚ä¾‹å¦‚ï¼Œè¦é€šè¿‡ HTTP æš´éœ²é™¤ <code>env</code> å’Œ <code>beans</code> ä¹‹å¤–çš„æ‰€æœ‰ç«¯ç‚¹ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å±æ€§ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.endpoints.web.exposure.include</span>=*</span><br><span class="line"><span class="attr">management.endpoints.web.exposure.exclude</span>=env,beans</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p><code>*</code> åœ¨ YAML ä¸­å…·æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œå› æ­¤å¦‚æœè¦åŒ…å«ï¼ˆæˆ–æ’é™¤ï¼‰æ‰€æœ‰ç«¯ç‚¹ï¼Œè¯·åŠ¡å¿…æ·»åŠ å¼•å·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure></blockquote><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœä½ çš„åº”ç”¨ç¨‹åºæ˜¯å…¬å¼€çš„ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½ ä¹Ÿ<a href="#production-ready-endpoints-security">ä¿æŠ¤ä½ çš„ç«¯ç‚¹</a>ã€‚</p></blockquote><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœè¦åœ¨æš´éœ²ç«¯ç‚¹æ—¶å®ç°è‡ªå·±çš„ç­–ç•¥ï¼Œå¯ä»¥æ³¨å†Œä¸€ä¸ª <code>EndpointFilter</code> beanã€‚</p></blockquote><p><a id="production-ready-endpoints-security"></a></p><h3 id="53-3ã€ä¿æŠ¤-HTTP-ç«¯ç‚¹">53.3ã€ä¿æŠ¤ HTTP ç«¯ç‚¹</h3><p>ä½ åº”è¯¥åƒä¿æŠ¤æ‰€æœ‰å…¶ä»–æ•æ„Ÿ URL ä¸€æ ·æ³¨æ„ä¿æŠ¤ HTTP ç«¯ç‚¹ã€‚å¦‚æœå­˜åœ¨ Spring Securityï¼Œåˆ™é»˜è®¤ä½¿ç”¨ Spring Security çš„å†…å®¹åå•†ç­–ç•¥æ¥ä¿æŠ¤ç«¯ç‚¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å¸Œæœ›ä¸º HTTP ç«¯ç‚¹é…ç½®è‡ªå®šä¹‰å®‰å…¨ç­–ç•¥ï¼Œåªå…è®¸å…·æœ‰ç‰¹å®šè§’è‰²èº«ä»½çš„ç”¨æˆ·è®¿é—®å®ƒä»¬ï¼ŒSpring Boot æä¾›äº†æ–¹ä¾¿çš„ <code>RequestMatcher</code> å¯¹è±¡ï¼Œå¯ä»¥ä¸ Spring Security ç»“åˆä½¿ç”¨ã€‚</p><p>å…¸å‹çš„ Spring Security é…ç½®å¯èƒ½å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActuatorSecurity</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">http.requestMatcher(EndpointRequest.toAnyEndpoint()).authorizeRequests()</span><br><span class="line">.anyRequest().hasRole(<span class="string">&quot;ENDPOINT_ADMIN&quot;</span>)</span><br><span class="line">.and()</span><br><span class="line">.httpBasic();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç¤ºä¾‹ä½¿ç”¨ <code>EndpointRequest.toAnyEndpoint()</code> å°†è¯·æ±‚ä¸æ‰€æœ‰ç«¯ç‚¹è¿›è¡ŒåŒ¹é…ï¼Œç„¶åç¡®ä¿æ‰€æœ‰ç«¯ç‚¹éƒ½å…·æœ‰ <code>ENDPOINT_ADMIN</code> è§’è‰²ã€‚<code>EndpointRequest</code> ä¸Šè¿˜æä¾›äº†å…¶ä»–å‡ ç§åŒ¹é…å™¨æ–¹æ³•ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… API æ–‡æ¡£ï¼ˆ<a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/actuator-api//html">HTML</a>æˆ– <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/actuator-api//pdf/spring-boot-actuator-web-api.pdf">PDF</a>ï¼‰ã€‚</p><p>å¦‚æœåº”ç”¨ç¨‹åºéƒ¨ç½²åœ¨æœ‰é˜²ç«å¢™çš„ç¯å¢ƒï¼Œä½ å¯èƒ½å¸Œæœ›æ— éœ€èº«ä»½éªŒè¯å³å¯è®¿é—®æ‰€æœ‰ Actuator ç«¯ç‚¹ã€‚ä½ å¯ä»¥é€šè¿‡æ›´æ”¹ <code>management.endpoints.web.exposure.include</code> å±æ€§æ¥æ‰§è¡Œæ­¤æ“ä½œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><strong>application.properties</strong></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.endpoints.web.exposure.include</span>=*</span><br></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œå¦‚æœå­˜åœ¨ Spring Securityï¼Œåˆ™éœ€è¦æ·»åŠ è‡ªå®šä¹‰å®‰å…¨é…ç½®ï¼Œä»¥å…è®¸å¯¹ç«¯ç‚¹è¿›è¡Œæœªç»èº«ä»½éªŒè¯çš„è®¿é—®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActuatorSecurity</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">http.requestMatcher(EndpointRequest.toAnyEndpoint()).authorizeRequests()</span><br><span class="line">.anyRequest().permitAll();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="production-ready-endpoints-caching"></a></p><h3 id="53-4ã€é…ç½®ç«¯ç‚¹">53.4ã€é…ç½®ç«¯ç‚¹</h3><p>ç«¯ç‚¹å¯¹ä¸å¸¦å‚æ•°è¯»å–æ“ä½œçš„å“åº”è‡ªåŠ¨ç¼“å­˜ã€‚è¦é…ç½®ç«¯ç‚¹ç¼“å­˜å“åº”çš„æ—¶é—´é•¿åº¦ï¼Œè¯·ä½¿ç”¨å…¶ <code>cache.time-to-live</code> å±æ€§ã€‚ä»¥ä¸‹ç¤ºä¾‹å°†beansç«¯ç‚¹ç¼“å­˜çš„ç”Ÿå­˜æ—¶é—´è®¾ç½®ä¸º10ç§’ï¼š</p><p><strong>application.properties</strong></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.endpoint.beans.cache.time-to-live</span>=<span class="number">10</span>s</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>å‰ç¼€ <code>management.endpoint.&lt;name&gt;</code> ç”¨äºå”¯ä¸€æ ‡è¯†é…ç½®çš„ç«¯ç‚¹ã€‚</p></blockquote><p><strong>æ³¨æ„</strong></p><blockquote><p>åœ¨è¿›è¡Œä¸€ä¸ªèº«ä»½éªŒè¯ HTTP è¯·æ±‚æ—¶ï¼Œ<code>Principal</code> è¢«è§†ä¸ºç«¯ç‚¹çš„è¾“å…¥ï¼Œå› æ­¤ä¸ä¼šç¼“å­˜å“åº”ã€‚</p></blockquote><p><a id="production-ready-endpoints-hypermedia"></a></p><h3 id="53-5ã€Actuator-Web-ç«¯ç‚¹è¶…åª’ä½“">53.5ã€Actuator Web ç«¯ç‚¹è¶…åª’ä½“</h3><p>æ·»åŠ  <strong>discovery page</strong>ï¼Œå…¶åŒ…å«æŒ‡å‘æ‰€æœ‰ç«¯ç‚¹çš„é“¾æ¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong>discovery page</strong> åœ¨ <code>/actuator</code> ä¸Šå¯è®¿é—®ã€‚</p><p>é…ç½®ä¸€ä¸ªè‡ªå®šä¹‰ç®¡ç†ä¸Šä¸‹æ–‡ï¼ˆmanagement contextï¼‰è·¯å¾„æ—¶ï¼Œ<strong>discovery page</strong> ä¼šè‡ªåŠ¨ä» <code>/actuator</code> ç§»åŠ¨åˆ°ç®¡ç†ä¸Šä¸‹æ–‡çš„æ ¹ç›®å½•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç®¡ç†ä¸Šä¸‹æ–‡è·¯å¾„æ˜¯ <code>/management</code>ï¼Œåˆ™å¯ä»¥ä» <code>/management</code> è·å– discovery pageã€‚å½“ç®¡ç†ä¸Šä¸‹æ–‡è·¯å¾„è®¾ç½®ä¸º <code>/</code> æ—¶ï¼Œå°†ç¦ç”¨å‘ç°é¡µé¢ä»¥é˜²æ­¢ä¸å…¶ä»–æ˜ å°„å†²çªã€‚</p><p><a id="production-ready-endpoints-cors"></a></p><h3 id="53-6ã€è·¨åŸŸæ”¯æŒ">53.6ã€è·¨åŸŸæ”¯æŒ</h3><p><a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">è·¨æºèµ„æºå…±äº«</a>ï¼ˆCORSï¼‰æ˜¯ä¸€ä¸ª <a href="https://www.w3.org/TR/cors/">W3C è§„èŒƒ</a>ï¼Œå…è®¸ä½ ä»¥çµæ´»çš„æ–¹å¼æŒ‡å®šæˆæƒçš„è·¨åŸŸè¯·æ±‚ç±»å‹ã€‚å¦‚æœä½ ä½¿ç”¨ Spring MVC æˆ– Spring WebFluxï¼Œåˆ™å¯ä»¥é…ç½® Actuator çš„ Web ç«¯ç‚¹ä»¥æ”¯æŒæ­¤ç±»æ–¹æ¡ˆã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ CORS æ”¯æŒè¢«ç¦ç”¨ï¼Œä»…åœ¨è®¾ç½®äº† <code>management.endpoints.web.cors.allowed-origins</code> å±æ€§åæ‰å¯ç”¨ CORS æ”¯æŒã€‚ä»¥ä¸‹é…ç½®å…è®¸æ¥è‡ª <code>example.com</code> åŸŸçš„ GET å’Œ POST è°ƒç”¨ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.endpoints.web.cors.allowed-origins</span>=http://example.com</span><br><span class="line"><span class="attr">management.endpoints.web.cors.allowed-methods</span>=GET,POST</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>æœ‰å…³é€‰é¡¹çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜… <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/endpoint/web/CorsEndpointProperties.java">CorsEndpointProperties</a>ã€‚</p></blockquote><p><a id="production-ready-endpoints-custom"></a></p><h3 id="53-7ã€å®ç°è‡ªå®šä¹‰ç«¯ç‚¹">53.7ã€å®ç°è‡ªå®šä¹‰ç«¯ç‚¹</h3><p>å¦‚æœä½ æ·»åŠ ä¸€ä¸ªä½¿ç”¨äº† <code>@Endpoint</code> æ³¨è§£çš„ <code>@Bean</code>ï¼Œåˆ™ä½¿ç”¨ <code>@ReadOperation</code>ã€<code>@WritOperation</code> æˆ– <code>@DeleteOperation</code> æ³¨è§£çš„æ‰€æœ‰æ–¹æ³•éƒ½å°†é€šè¿‡ JMX è‡ªåŠ¨æš´éœ²ï¼Œå¹¶ä¸”åœ¨ Web åº”ç”¨ç¨‹åºä¸­ä¹Ÿå°†é€šè¿‡ HTTP æš´éœ²ã€‚å¯ä»¥ä½¿ç”¨ Jerseyã€Spring MVC æˆ– Spring WebFlux é€šè¿‡ HTTP æš´éœ²ç«¯ç‚¹ã€‚</p><p>ä½ è¿˜å¯ä»¥ä½¿ç”¨ <code>@JmxEndpoint</code> æˆ– <code>@WebEndpoint</code> ç¼–å†™ç‰¹å®šæŠ€æœ¯çš„ç«¯ç‚¹ã€‚è¿™äº›ç«¯ç‚¹ä»…é™äºå„è‡ªçš„æŠ€æœ¯ã€‚ä¾‹å¦‚ï¼Œ<code>@WebEndpoint</code> ä»…é€šè¿‡ HTTP æš´éœ²ï¼Œè€Œä¸æ˜¯ JMXã€‚</p><p>ä½ å¯ä»¥ä½¿ç”¨ <code>@EndpointWebExtension</code> å’Œ <code>@EndpointJmxExtension</code> ç¼–å†™ç‰¹å®šæŠ€æœ¯çš„æ‰©å±•ã€‚é€šè¿‡è¿™äº›æ³¨è§£ï¼Œä½ å¯ä»¥æä¾›ç‰¹å®šæŠ€æœ¯çš„æ“ä½œæ¥æ‰©å……ç°æœ‰ç«¯ç‚¹ã€‚</p><p>æœ€åï¼Œå¦‚æœä½ éœ€è¦è®¿é—®ç‰¹å®š Web æ¡†æ¶çš„åŠŸèƒ½ï¼Œåˆ™å¯ä»¥å®ç° Servlet æˆ– Spring <code>@Controller</code> å’Œ <code>@RestController</code> ç«¯ç‚¹ï¼Œä½†ä»£ä»·æ˜¯å®ƒä»¬æ— æ³•é€šè¿‡ JMX æˆ–ä½¿ç”¨å…¶ä»– Web æ¡†æ¶ã€‚</p><p><a id="production-ready-endpoints-custom-input"></a></p><h4 id="53-7-1ã€æ¥æ”¶è¾“å…¥">53.7.1ã€æ¥æ”¶è¾“å…¥</h4><p>ç«¯ç‚¹ä¸Šçš„æ“ä½œé€šè¿‡å‚æ•°æ¥æ”¶è¾“å…¥ã€‚é€šè¿‡ Web æš´éœ²æ—¶ï¼Œè¿™äº›å‚æ•°çš„å€¼å–è‡ª URL çš„æŸ¥è¯¢å‚æ•°å’Œ JSON è¯·æ±‚ä½“ã€‚é€šè¿‡ JMX æš´éœ²æ—¶ï¼Œå‚æ•°å°†æ˜ å°„åˆ° MBean æ“ä½œçš„å‚æ•°ã€‚é»˜è®¤æƒ…å†µä¸‹å‚æ•°æ˜¯å¿…é¡»çš„ã€‚å¯ä»¥ä½¿ç”¨ <code>@org.springframework.lang.Nullable</code> å¯¹å®ƒä»¬è¿›è¡Œæ³¨è§£ï¼Œä½¿å®ƒä»¬æˆä¸ºå¯é€‰é¡¹ã€‚</p><p>JSON è¯·æ±‚ä½“ä¸­çš„æ¯ä¸ªæ ¹å±æ€§éƒ½å¯ä»¥æ˜ å°„åˆ°ç«¯ç‚¹çš„å‚æ•°ã€‚è€ƒè™‘ä»¥ä¸‹ JSON è¯·æ±‚ä½“ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;counter&quot;</span><span class="punctuation">:</span> <span class="number">42</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™å¯ç”¨äºè°ƒç”¨å¸¦æœ‰ <code>String name</code> å’Œ <code>int counter</code> å‚æ•°çš„å†™æ“ä½œã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>ç”±äºç«¯ç‚¹ä¸æŠ€æœ¯æ— å…³ï¼Œå› æ­¤åªèƒ½åœ¨æ–¹æ³•ç­¾åä¸­æŒ‡å®šç®€å•ç±»å‹ã€‚ç‰¹åˆ«æ˜¯ä¸æ”¯æŒä½¿ç”¨å®šä¹‰ä¸€ä¸ª <code>name</code> å’Œ <code>counter</code> å±æ€§çš„è‡ªå®šä¹‰ç±»å‹å£°æ˜å•ä¸ªå‚æ•°ã€‚</p></blockquote><p><strong>æ³¨æ„</strong></p><blockquote><p>è¦å…è®¸å°†è¾“å…¥æ˜ å°„åˆ°æ“ä½œæ–¹æ³•çš„å‚æ•°ï¼Œåº”ä½¿ç”¨ <code>-parameters</code> ç¼–è¯‘å®ç°ç«¯ç‚¹çš„ Java ä»£ç ï¼Œå¹¶ä¸”åº”ä½¿ç”¨ <code>-java-parameters</code> ç¼–è¯‘å®ç°ç«¯ç‚¹çš„ Kotlin ä»£ç ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Spring Boot çš„ Gradle æ’ä»¶ï¼Œæˆ–è€…æ˜¯ Maven å’Œ spring-boot-starter-parentï¼Œåˆ™å®ƒä»¬ä¼šè‡ªåŠ¨æ‰§è¡Œæ­¤æ“ä½œã€‚</p></blockquote><p><a id="production-ready-endpoints-custom-input-conversion"></a></p><h5 id="è¾“å…¥ç±»å‹è½¬æ¢">è¾“å…¥ç±»å‹è½¬æ¢</h5><p>å¦‚æœ‰å¿…è¦ï¼Œä¼ é€’ç»™ç«¯ç‚¹æ“ä½œæ–¹æ³•çš„å‚æ•°å°†è‡ªåŠ¨è½¬æ¢ä¸ºæ‰€éœ€ç±»å‹ã€‚åœ¨è°ƒç”¨æ“ä½œæ–¹æ³•ä¹‹å‰ï¼Œä½¿ç”¨ <code>ApplicationConversionService</code> å®ä¾‹å°†é€šè¿‡ JMX æˆ– HTTP è¯·æ±‚æ¥æ”¶çš„è¾“å…¥è½¬æ¢ä¸ºæ‰€éœ€ç±»å‹ã€‚</p><p><a id="production-ready-endpoints-custom-web"></a></p><h4 id="53-7-2ã€è‡ªå®šä¹‰-Web-ç«¯ç‚¹">53.7.2ã€è‡ªå®šä¹‰ Web ç«¯ç‚¹</h4><p><code>@Endpoint</code>ã€<code>@WebEndpoint</code> æˆ– <code>@EndpointWebExtension</code> ä¸Šçš„æ“ä½œå°†ä½¿ç”¨ Jerseyã€Spring MVC æˆ– Spring WebFlux é€šè¿‡ HTTP è‡ªåŠ¨æš´éœ²ã€‚</p><p><a id="production-ready-endpoints-custom-web-predicate"></a></p><h5 id="Web-ç«¯ç‚¹è¯·æ±‚è°“è¯">Web ç«¯ç‚¹è¯·æ±‚è°“è¯</h5><p>ä¸º Web æš´éœ²çš„ç«¯ç‚¹ä¸Šçš„æ¯ä¸ªæ“ä½œè‡ªåŠ¨ç”Ÿæˆè¯·æ±‚è°“è¯ã€‚</p><p><a id="production-ready-endpoints-custom-web-predicate-path"></a></p><h5 id="è·¯å¾„">è·¯å¾„</h5><p>è°“è¯çš„è·¯å¾„ç”±ç«¯ç‚¹çš„ ID å’Œ Web æš´éœ²çš„ç«¯ç‚¹çš„åŸºç¡€è·¯å¾„ç¡®å®šã€‚é»˜è®¤åŸºç¡€è·¯å¾„æ˜¯ <code>/actuator</code>ã€‚ä¾‹å¦‚ï¼Œæœ‰ ID ä¸º <code>sessions</code> çš„ç«¯ç‚¹å°†ä½¿ç”¨ <code>/actuator/sessions</code> ä½œä¸ºå…¶åœ¨è°“è¯ä¸­çš„è·¯å¾„ã€‚</p><p>é€šè¿‡ä½¿ç”¨ <code>@Selector</code> æ³¨è§£æ“ä½œæ–¹æ³•çš„ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼Œå¯ä»¥è¿›ä¸€æ­¥è‡ªå®šä¹‰è·¯å¾„ã€‚è¿™æ ·çš„å‚æ•°ä½œä¸ºè·¯å¾„å˜é‡æ·»åŠ åˆ°è·¯å¾„è°“è¯ä¸­ã€‚è°ƒç”¨ç«¯ç‚¹æ“ä½œæ—¶ï¼Œå˜é‡çš„å€¼å°†ä¼ é€’ç»™æ“ä½œæ–¹æ³•ã€‚</p><p><a id="production-ready-endpoints-custom-web-predicate-http-method"></a></p><h5 id="HTTP-æ–¹æ³•">HTTP æ–¹æ³•</h5><p>è°“è¯çš„ HTTP æ–¹æ³•ç”±æ“ä½œç±»å‹å†³å®šï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><table><thead><tr><th>æ“ä½œ</th><th>HTTP æ–¹æ³•</th></tr></thead><tbody><tr><td><code>@ReadOperation</code></td><td><code>GET</code></td></tr><tr><td><code>@WriteOperation</code></td><td><code>POST</code></td></tr><tr><td><code>@DeleteOperation</code></td><td><code>DELETE</code></td></tr></tbody></table><p><a id="production-ready-endpoints-custom-web-predicate-consumes"></a></p><h5 id="Consume">Consume</h5><p>å¯¹äºä½¿ç”¨è¯·æ±‚ä½“çš„ <code>@WriteOperation</code>ï¼ˆHTTP <code>POST</code>ï¼‰ï¼Œè°“è¯çš„ consume å­å¥æ˜¯ <code>application/vnd.spring-boot.actuator.v2+json, application/json</code>ã€‚å¯¹äºæ‰€æœ‰å…¶ä»–æ“ä½œï¼Œconsume å­å¥ä¸ºç©ºã€‚</p><p><a id="production-ready-endpoints-custom-web-predicate-produces"></a></p><h5 id="Produce">Produce</h5><p>è°“è¯çš„ produce å­å¥å¯ä»¥ç”± <code>@DeleteOperation</code>ã€<code>@ReadOperation</code> å’Œ <code>@WriteOperation</code> æ³¨è§£çš„ <code>produce</code> å±æ€§ç¡®å®šã€‚è¯¥å±æ€§æ˜¯å¯é€‰çš„ã€‚å¦‚æœæœªä½¿ç”¨ï¼Œåˆ™è‡ªåŠ¨ç¡®å®š produce å­å¥ã€‚</p><p>å¦‚æœæ“ä½œæ–¹æ³•è¿”å› <code>void</code> æˆ– <code>Void</code>ï¼Œåˆ™ produce å­å¥ä¸ºç©ºã€‚å¦‚æœæ“ä½œæ–¹æ³•è¿”å› <code>org.springframework.core.io.Resource</code>ï¼Œåˆ™ produce å­å¥ä¸º <code>application/octet-stream</code>ã€‚å¯¹äºæ‰€æœ‰å…¶ä»–æ“ä½œï¼Œproduce å­å¥æ˜¯ <code>application/vnd.spring-boot.actuator.v2+json, application/json</code>ã€‚</p><p><a id="production-ready-endpoints-custom-web-response-status"></a></p><h5 id="Web-ç«¯ç‚¹å“åº”çŠ¶æ€">Web ç«¯ç‚¹å“åº”çŠ¶æ€</h5><p>ç«¯ç‚¹æ“ä½œçš„é»˜è®¤å“åº”çŠ¶æ€å–å†³äºæ“ä½œç±»å‹ï¼ˆè¯»å–ã€å†™å…¥æˆ–åˆ é™¤ï¼‰ä»¥åŠæ“ä½œè¿”å›çš„å†…å®¹ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚</p><p><code>@ReadOperation</code> è¿”å›ä¸€ä¸ªå€¼ï¼Œå“åº”çŠ¶æ€ä¸º 200ï¼ˆOKï¼‰ã€‚å¦‚æœå®ƒæœªè¿”å›å€¼ï¼Œåˆ™å“åº”çŠ¶æ€å°†ä¸º 404ï¼ˆæœªæ‰¾åˆ°ï¼‰ã€‚</p><p>å¦‚æœ <code>@WriteOperation</code> æˆ– <code>@DeleteOperation</code> è¿”å›å€¼ï¼Œåˆ™å“åº”çŠ¶æ€å°†ä¸º 200ï¼ˆOKï¼‰ã€‚å¦‚æœå®ƒæ²¡æœ‰è¿”å›å€¼ï¼Œåˆ™å“åº”çŠ¶æ€å°†ä¸º 204ï¼ˆæ— å†…å®¹ï¼‰ã€‚</p><p>å¦‚æœåœ¨æ²¡æœ‰å¿…éœ€å‚æ•°çš„æƒ…å†µä¸‹è°ƒç”¨æ“ä½œï¼Œæˆ–è€…ä½¿ç”¨æ— æ³•è½¬æ¢ä¸ºæ‰€éœ€ç±»å‹çš„å‚æ•°ï¼Œåˆ™ä¸ä¼šè°ƒç”¨æ“ä½œæ–¹æ³•ï¼Œå¹¶ä¸”å“åº”çŠ¶æ€å°†ä¸º 400ï¼ˆé”™è¯¯è¯·æ±‚ï¼‰ã€‚</p><p><a id="production-ready-endpoints-custom-web-range-requests"></a></p><h5 id="Web-ç«¯ç‚¹èŒƒå›´è¯·æ±‚">Web ç«¯ç‚¹èŒƒå›´è¯·æ±‚</h5><p>å¯ç”¨ HTTP èŒƒå›´è¯·æ±‚è¯·æ±‚éƒ¨åˆ† HTTP èµ„æºã€‚ä½¿ç”¨ Spring MVC æˆ– Spring Web Flux æ—¶ï¼Œè¿”å› <code>org.springframework.core.io.Resource</code> çš„æ“ä½œä¼šè‡ªåŠ¨æ”¯æŒèŒƒå›´è¯·æ±‚ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>ä½¿ç”¨ Jersey æ—¶ä¸æ”¯æŒèŒƒå›´è¯·æ±‚ã€‚</p></blockquote><p><a id="production-ready-endpoints-custom-web-security"></a></p><h5 id="Web-ç«¯ç‚¹å®‰å…¨">Web ç«¯ç‚¹å®‰å…¨</h5><p>Web ç«¯ç‚¹æˆ–ç‰¹å®š Web çš„ç«¯ç‚¹æ‰©å±•ä¸Šçš„æ“ä½œå¯ä»¥æ¥æ”¶å½“å‰çš„ <code>java.security.Principal</code> æˆ– <code>org.springframework.boot.actuate.endpoint.SecurityContext</code> ä½œä¸ºæ–¹æ³•å‚æ•°ã€‚å‰è€…é€šå¸¸ä¸ <code>@Nullable</code> ç»“åˆä½¿ç”¨ï¼Œä¸ºç»è¿‡èº«ä»½éªŒè¯å’Œæœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·æä¾›ä¸åŒçš„è¡Œä¸ºã€‚åè€…é€šå¸¸ç”¨äºä½¿ç”¨å…¶ <code>isUserInRole(String)</code> æ–¹æ³•æ‰§è¡Œæˆæƒæ£€æŸ¥ã€‚</p><p><a id="production-ready-endpoints-custom-servlet"></a></p><h4 id="53-7-3ã€Servlet-ç«¯ç‚¹">53.7.3ã€Servlet ç«¯ç‚¹</h4><p>é€šè¿‡å®ç°ä¸€ä¸ªå¸¦æœ‰ <code>@ServletEndpoint</code> æ³¨è§£çš„ç±»ï¼Œ<code>Servlet</code> å¯ä»¥ä½œä¸ºç«¯ç‚¹æš´éœ²ï¼Œè¯¥ç±»ä¹Ÿå®ç°äº† <code>Supplier&lt;EndpointServlet&gt;</code>ã€‚Servlet ç«¯ç‚¹æä¾›äº†ä¸ Servlet å®¹å™¨æ›´æ·±å±‚æ¬¡çš„é›†æˆï¼Œä½†ä»£ä»·æ˜¯å¯ç§»æ¤æ€§ã€‚å®ƒä»¬æ—¨åœ¨ç”¨äºå°†ç°æœ‰ Servlet ä½œä¸ºç«¯ç‚¹æš´éœ²ã€‚å¯¹äºæ–°ç«¯ç‚¹ï¼Œåº”å°½å¯èƒ½é¦–é€‰ <code>@Endpoint</code> å’Œ <code>@WebEndpoint</code> æ³¨è§£ã€‚</p><p><a id="production-ready-endpoints-custom-controller"></a></p><h4 id="53-7-4ã€æ§åˆ¶å™¨ç«¯ç‚¹">53.7.4ã€æ§åˆ¶å™¨ç«¯ç‚¹</h4><p><code>@ControllerEndpoint</code> å’Œ <code>@RestControllerEndpoint</code> å¯ç”¨äºå®ç°ä»…ç”± Spring MVC æˆ– Spring WebFlux æš´éœ²çš„ç«¯ç‚¹ã€‚ä½¿ç”¨ Spring MVC å’Œ Spring WebFlux çš„æ ‡å‡†æ³¨è§£ï¼ˆå¦‚ <code>@RequestMapping</code> å’Œ <code>@GetMapping</code>ï¼‰æ˜ å°„æ–¹æ³•ï¼Œå¹¶å°†ç«¯ç‚¹çš„ ID ç”¨ä½œè·¯å¾„çš„å‰ç¼€ã€‚æ§åˆ¶å™¨ç«¯ç‚¹æä¾›äº†ä¸ Spring çš„ Web æ¡†æ¶æ›´æ·±å±‚æ¬¡çš„é›†æˆï¼Œä½†ä»£ä»·æ˜¯å¯ç§»æ¤æ€§ã€‚åº”å°½å¯èƒ½é¦–é€‰ <code>@Endpoint</code> å’Œ <code>@WebEndpoint</code> æ³¨è§£ã€‚</p><p><a id="production-ready-health"></a></p><h3 id="53-8ã€å¥åº·ä¿¡æ¯">53.8ã€å¥åº·ä¿¡æ¯</h3><p>ä½ å¯ä»¥ä½¿ç”¨å¥åº·ä¿¡æ¯æ¥æ£€æŸ¥æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚ç›‘æ§è½¯ä»¶ç»å¸¸åœ¨ç”Ÿäº§ç³»ç»Ÿå‡ºç°æ•…éšœæ—¶ä½¿ç”¨å®ƒæé†’æŸäººã€‚<code>health</code> ç«¯ç‚¹æš´éœ²çš„ä¿¡æ¯å–å†³äº <code>management.endpoint.health.show-details</code> å±æ€§ï¼Œè¯¥å±æ€§å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å€¼ä¹‹ä¸€è¿›è¡Œé…ç½®ï¼š</p><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>never</code></td><td>æ°¸è¿œä¸ä¼šæ˜¾ç¤ºç»†èŠ‚ã€‚</td></tr><tr><td><code>when-authorized</code></td><td>è¯¦ç»†ä¿¡æ¯ä»…å‘æˆæƒç”¨æˆ·æ˜¾ç¤ºã€‚å¯ä»¥ä½¿ç”¨ <code>management.endpoint.health.roles</code> é…ç½®æˆæƒè§’è‰²ã€‚</td></tr><tr><td><code>always</code></td><td>å‘æ‰€æœ‰ç”¨æˆ·æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ã€‚</td></tr></tbody></table><p>é»˜è®¤å€¼ä¸º <code>never</code>ã€‚å½“ç”¨æˆ·å¤„äºä¸€ä¸ªæˆ–å¤šä¸ªç«¯ç‚¹çš„è§’è‰²æ—¶ï¼Œå°†è¢«è§†ä¸ºå·²è·å¾—æˆæƒã€‚å¦‚æœç«¯ç‚¹æ²¡æœ‰é…ç½®è§’è‰²ï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œåˆ™è®¤ä¸ºæ‰€æœ‰ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·éƒ½å·²è·å¾—æˆæƒã€‚å¯ä»¥ä½¿ç”¨ <code>management.endpoint.health.roles</code> å±æ€§é…ç½®è§’è‰²ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœä½ å·²ä¿æŠ¤åº”ç”¨ç¨‹åºå¹¶å¸Œæœ›ä½¿ç”¨ <code>always</code>ï¼Œåˆ™å®‰å…¨é…ç½®å¿…é¡»å…è®¸ç»è¿‡èº«ä»½éªŒè¯å’Œæœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·å¯¹å¥åº·ç«¯ç‚¹çš„è®¿é—®ã€‚</p></blockquote><p>å¥åº·ä¿¡æ¯æ˜¯ä» <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthIndicatorRegistry.java"><code>HealthIndicatorRegistry</code></a> çš„å†…å®¹ä¸­æ”¶é›†çš„ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>ApplicationContext</code> ä¸­å®šä¹‰çš„æ‰€æœ‰ <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthIndicator.java"><code>HealthIndicator</code></a> å®ä¾‹ï¼‰ã€‚Spring Boot åŒ…å«è®¸å¤šè‡ªåŠ¨é…ç½®çš„ <code>HealthIndicators</code>ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±ç¼–å†™ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæœ€ç»ˆç³»ç»ŸçŠ¶æ€ç”± <code>HealthAggregator</code> æ ¹æ®çŠ¶æ€çš„æœ‰åºåˆ—è¡¨å¯¹æ¯ä¸ª <code>HealthIndicator</code> çš„çŠ¶æ€è¿›è¡Œæ’åºã€‚æ’åºåˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªçŠ¶æ€ä½œä¸ºæ•´ä½“å¥åº·çŠ¶æ€ã€‚å¦‚æœæ²¡æœ‰ <code>HealthIndicator</code> è¿”å›ä¸€ä¸ª <code>HealthAggregator</code> å·²çŸ¥çš„çŠ¶æ€ï¼Œåˆ™ä½¿ç”¨ <code>UNKNOWN</code> çŠ¶æ€ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p><code>HealthIndicatorRegistry</code> å¯ç”¨äºåœ¨è¿è¡Œæ—¶æ³¨å†Œå’Œæ³¨é”€å¥åº·æŒ‡ç¤ºå™¨ã€‚</p></blockquote><p><a id="_auto_configured_healthindicators"></a></p><h4 id="53-8-1ã€è‡ªåŠ¨é…ç½®çš„-HealthIndicator">53.8.1ã€è‡ªåŠ¨é…ç½®çš„ HealthIndicator</h4><p>é€‚å½“æ—¶ï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½®ä»¥ä¸‹ <code>HealthIndicator</code>ï¼š</p><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/cassandra/CassandraHealthIndicator.java"><code>CassandraHealthIndicator</code></a></td><td>æ£€æŸ¥ Cassandra æ•°æ®åº“æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/couchbase/CouchbaseHealthIndicator.java"><code>CouchbaseHealthIndicator</code></a></td><td>æ£€æŸ¥ Couchbase é›†ç¾¤æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/system/DiskSpaceHealthIndicator.java"><code>DiskSpaceHealthIndicator</code></a></td><td>æ£€æŸ¥æ˜¯å¦ç£ç›˜ç©ºé—´ä¸è¶³ã€‚</td></tr><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/jdbc/DataSourceHealthIndicator.java"><code>DataSourceHealthIndicator</code></a></td><td>æ£€æŸ¥æ˜¯å¦å¯ä»¥è·å¾—ä¸ <code>DataSource</code> çš„è¿æ¥ã€‚</td></tr><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/elasticsearch/ElasticsearchHealthIndicator.java"><code>ElasticsearchHealthIndicator</code></a></td><td>æ£€æŸ¥ Elasticsearch é›†ç¾¤æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/influx/InfluxDbHealthIndicator.java"><code>InfluxDbHealthIndicator</code></a></td><td>æ£€æŸ¥ InfluxDB æœåŠ¡å™¨æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/jms/JmsHealthIndicator.java"><code>JmsHealthIndicator</code></a></td><td>æ£€æŸ¥ JMS broker æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mail/MailHealthIndicator.java"><code>MailHealthIndicator</code></a></td><td>æ£€æŸ¥é‚®ä»¶æœåŠ¡å™¨æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mongo/MongoHealthIndicator.java"><code>MongoHealthIndicator</code></a></td><td>æ£€æŸ¥ Mongo æ•°æ®åº“æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/neo4j/Neo4jHealthIndicator.java"><code>Neo4jHealthIndicator</code></a></td><td>æ£€æŸ¥ Neo4j æœåŠ¡å™¨æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/amqp/RabbitHealthIndicator.java"><code>RabbitHealthIndicator</code></a></td><td>æ£€æŸ¥ Rabbit æœåŠ¡å™¨æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/redis/RedisHealthIndicator.java"><code>RedisHealthIndicator</code></a></td><td>æ£€æŸ¥ Redis æœåŠ¡å™¨æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/solr/SolrHealthIndicator.java"><code>SolrHealthIndicator</code></a></td><td>æ£€æŸ¥ Solr æœåŠ¡å™¨æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr></tbody></table><p><strong>æç¤º</strong></p><blockquote><p>ä½ å¯ä»¥é€šè¿‡è®¾ç½® <code>management.health.defaults.enabled</code> å±æ€§æ¥ç¦ç”¨å®ƒä»¬ã€‚</p></blockquote><p><a id="_writing_custom_healthindicators"></a></p><h4 id="53-8-2ã€ç¼–å†™è‡ªå®šä¹‰-HealthIndicator">53.8.2ã€ç¼–å†™è‡ªå®šä¹‰ HealthIndicator</h4><p>è¦æä¾›è‡ªå®šä¹‰å¥åº·ä¿¡æ¯ï¼Œå¯ä»¥æ³¨å†Œå®ç° <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthIndicator.java"><code>HealthIndicator</code></a> æ¥å£çš„ Spring beanã€‚ä½ éœ€è¦æä¾› <code>health()</code> æ–¹æ³•çš„å®ç°å¹¶è¿”å›ä¸€ä¸ª <code>Health</code> å“åº”ã€‚<code>Health</code> å“åº”åº”åŒ…æ‹¬ä¸€ä¸ªçŠ¶æ€ï¼Œå¹¶ä¸”å¯ä»¥é€‰æ‹©åŒ…æ‹¬è¦æ˜¾ç¤ºçš„å…¶ä»–è¯¦ç»†ä¿¡æ¯ã€‚ä»¥ä¸‹ä»£ç å±•ç¤ºäº†ä¸€ä¸ª HealthIndicator å®ç°ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.health.Health;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.health.HealthIndicator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyHealthIndicator</span> <span class="keyword">implements</span> <span class="title class_">HealthIndicator</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Health <span class="title function_">health</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">errorCode</span> <span class="operator">=</span> check(); <span class="comment">// æ‰§è¡ŒæŸäº›ç‰¹å®šçš„å¥åº·æ£€æŸ¥</span></span><br><span class="line"><span class="keyword">if</span> (errorCode != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> Health.down().withDetail(<span class="string">&quot;Error Code&quot;</span>, errorCode).build();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> Health.up().build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>ç»™å®š <code>HealthIndicator</code> çš„æ ‡è¯†ç¬¦æ˜¯æ²¡æœ‰ <code>HealthIndicator</code> åç¼€çš„ bean çš„åç§°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œå¥åº·ä¿¡æ¯åœ¨åä¸º <code>my</code> çš„æ¡ç›®ä¸­å¯ç”¨ã€‚</p></blockquote><p>é™¤äº† Spring Boot çš„é¢„å®šä¹‰ <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/Status.java"><code>Status</code></a> ç±»å‹ä¹‹å¤–ï¼Œ<code>Health</code> è¿˜å¯ä»¥è¿”å›ä¸€ä¸ªè¡¨ç¤ºæ–°ç³»ç»ŸçŠ¶æ€çš„è‡ªå®šä¹‰ <code>Status</code>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿˜éœ€è¦æä¾› <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthAggregator.java"><code>HealthAggregator</code></a> æ¥å£çš„è‡ªå®šä¹‰å®ç°ï¼Œæˆ–è€…å¿…é¡»ä½¿ç”¨ <code>management.health.status.order</code> é…ç½®å±æ€§é…ç½®é»˜è®¤å®ç°ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾åœ¨ä½ çš„ä¸€ä¸ª <code>HealthIndicator</code> å®ç°ä¸­ä½¿ç”¨äº†ä»£ç ä¸º <code>FATAL</code> çš„æ–° <code>Status</code>ã€‚éœ€è¦é…ç½®ä¸¥é‡æ€§é¡ºåºï¼Œè¯·å°†ä»¥ä¸‹å±æ€§æ·»åŠ åˆ°åº”ç”¨ç¨‹åºå±æ€§ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.health.status.order</span>=FATAL, DOWN, OUT_OF_SERVICE, UNKNOWN, UP</span><br></pre></td></tr></table></figure><p>å“åº”ä¸­çš„ HTTP çŠ¶æ€ç åæ˜ äº†æ•´ä½“è¿è¡ŒçŠ¶å†µï¼ˆä¾‹å¦‚ï¼Œ<code>UP</code> æ˜ å°„åˆ° 200ï¼Œè€Œ <code>OUT_OF_SERVICE</code> å’Œ <code>DOWN</code> æ˜ å°„åˆ° 503ï¼‰ã€‚å¦‚æœé€šè¿‡ HTTP è®¿é—®å¥åº·ç«¯ç‚¹ï¼Œåˆ™å¯èƒ½è¿˜éœ€è¦æ³¨å†Œè‡ªå®šä¹‰çŠ¶æ€æ˜ å°„ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å±æ€§å°† <code>FATAL</code> æ˜ å°„åˆ° 503ï¼ˆæœåŠ¡ä¸å¯ç”¨ï¼‰ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.health.status.http-mapping.FATAL</span>=<span class="number">503</span></span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœéœ€è¦æ§åˆ¶æ›´å¤šï¼Œå¯ä»¥å®šä¹‰è‡ªå·±çš„ <code>HealthStatusHttpMapper</code> beanã€‚</p></blockquote><p>ä¸‹è¡¨å±•ç¤ºäº†å†…ç½®çŠ¶æ€çš„é»˜è®¤çŠ¶æ€æ˜ å°„ï¼š</p><table><thead><tr><th>çŠ¶æ€</th><th>æ˜ å°„</th></tr></thead><tbody><tr><td>DOWN</td><td>SERVICE_UNAVAILABLE (503)</td></tr><tr><td>OUT_OF_SERVICE</td><td>SERVICE_UNAVAILABLE (503)</td></tr><tr><td>UP</td><td>é»˜è®¤æ²¡æœ‰æ˜ å°„ï¼Œå› æ­¤çŠ¶æ€ç ä¸º 200</td></tr><tr><td>UNKNOWN</td><td>é»˜è®¤æ²¡æœ‰æ˜ å°„ï¼Œå› æ­¤çŠ¶æ€ç ä¸º 200</td></tr></tbody></table><p><a id="reactive-health-indicators"></a></p><h4 id="53-8-3ã€å“åº”å¼å¥åº·æŒ‡ç¤ºå™¨">53.8.3ã€å“åº”å¼å¥åº·æŒ‡ç¤ºå™¨</h4><p>å¯¹äºå“åº”å¼åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚ä½¿ç”¨ Spring WebFlux çš„åº”ç”¨ç¨‹åºï¼Œ<code>ReactiveHealthIndicator</code> æä¾›äº†ä¸€ä¸ªéé˜»å¡çš„æ¥å£æ¥è·å–åº”ç”¨ç¨‹åºå¥åº·ä¿¡æ¯ã€‚ä¸ä¼ ç»Ÿçš„ <code>HealthIndicator</code> ç±»ä¼¼ï¼Œå¥åº·ä¿¡æ¯ä» <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/ReactiveHealthIndicatorRegistry.java"><code>ReactiveHealthIndicatorRegistry</code></a> çš„å†…å®¹ä¸­æ”¶é›†ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>ApplicationContext</code> ä¸­å®šä¹‰çš„æ‰€æœ‰ <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthIndicator.java"><code>HealthIndicator</code></a> å’Œ <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/ReactiveHealthIndicator.java"><code>ReactiveHealthIndicator</code></a> å®ä¾‹ï¼‰ã€‚ä¸æ£€æŸ¥å“åº”å¼ API çš„å¸¸è§„ <code>HealthIndicator</code>åœ¨å¼¹æ€§è°ƒåº¦ç¨‹åºä¸Šæ‰§è¡Œã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>åœ¨å“åº”å¼åº”ç”¨ç¨‹åºä¸­ï¼Œ<code>ReactiveHealthIndicatorRegistry</code> å¯ç”¨äºåœ¨è¿è¡Œæ—¶æ³¨å†Œå’Œå–æ¶ˆæ³¨å†Œå¥åº·æŒ‡ç¤ºå™¨ã€‚</p></blockquote><p>è¦ä»å“åº”å¼ API æä¾›è‡ªå®šä¹‰å¥åº·ä¿¡æ¯ï¼Œå¯ä»¥æ³¨å†Œå®ç° <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/ReactiveHealthIndicator.java"><code>ReactiveHealthIndicator</code></a> æ¥å£çš„ Spring beanã€‚ä»¥ä¸‹ä»£ç å±•ç¤ºäº† <code>ReactiveHealthIndicator</code> å®ç°çš„ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyReactiveHealthIndicator</span> <span class="keyword">implements</span> <span class="title class_">ReactiveHealthIndicator</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;Health&gt; <span class="title function_">health</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> doHealthCheck() <span class="comment">// æ‰§è¡Œä¸€äº›ç‰¹å®šçš„å¥åº·æ£€æŸ¥å¹¶è¿”å›ä¸€ä¸ª Mono&lt;Health&gt;</span></span><br><span class="line">.onErrorResume(ex -&gt; Mono.just(<span class="keyword">new</span> <span class="title class_">Health</span>.Builder().down(ex).build())));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>è¦è‡ªåŠ¨å¤„ç†é”™è¯¯ï¼Œè¯·è€ƒè™‘ä» <code>AbstractReactiveHealthIndicator</code> è¿›è¡Œæ‰©å±•ã€‚</p></blockquote><p><a id="_auto_configured_reactivehealthindicators"></a></p><h4 id="53-8-4ã€è‡ªåŠ¨é…ç½®çš„-ReactiveHealthIndicator">53.8.4ã€è‡ªåŠ¨é…ç½®çš„ ReactiveHealthIndicator</h4><p>é€‚å½“æ—¶ï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½®ä»¥ä¸‹ <code>ReactiveHealthIndicator</code>ï¼š</p><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/cassandra/CassandraReactiveHealthIndicator.java"><code>CassandraReactiveHealthIndicator</code></a></td><td>æ£€æŸ¥ Cassandra æ•°æ®åº“æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/couchbase/CouchbaseReactiveHealthIndicator.java"><code>CouchbaseReactiveHealthIndicator</code></a></td><td>æ£€æŸ¥ Couchbase é›†ç¾¤æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mongo/MongoReactiveHealthIndicator.java"><code>MongoReactiveHealthIndicator</code></a></td><td>æ£€æŸ¥ Mongo æ•°æ®åº“æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/redis/RedisReactiveHealthIndicator.java"><code>RedisReactiveHealthIndicator</code></a></td><td>æ£€æŸ¥ Redis æœåŠ¡å™¨æ˜¯å¦å·²å¯åŠ¨ã€‚</td></tr></tbody></table><p><strong>æç¤º</strong></p><blockquote><p>å¿…è¦æ—¶ï¼Œå“åº”å¼æŒ‡ç¤ºå™¨å–ä»£å¸¸è§„æŒ‡ç¤ºå™¨ã€‚æ­¤å¤–ï¼Œä»»ä½•æœªæ˜ç¡®å¤„ç†çš„ <code>HealthIndicator</code> éƒ½ä¼šè‡ªåŠ¨åŒ…è£…ã€‚</p></blockquote><p><a id="production-ready-application-info"></a></p><h3 id="53-9ã€åº”ç”¨ç¨‹åºä¿¡æ¯">53.9ã€åº”ç”¨ç¨‹åºä¿¡æ¯</h3><p>åº”ç”¨ç¨‹åºä¿¡æ¯æš´éœ²ä» <code>ApplicationContext</code> ä¸­å®šä¹‰çš„æ‰€æœ‰ <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/InfoContributor.java"><code>InfoContributor</code></a> bean æ”¶é›†çš„å„ç§ä¿¡æ¯ã€‚Spring Boot åŒ…å«è®¸å¤šè‡ªåŠ¨é…ç½®çš„ <code>InfoContributor</code> beanï¼Œä½ å¯ä»¥ç¼–å†™è‡ªå·±çš„ beanã€‚</p><p><a id="production-ready-application-info"></a></p><h4 id="53-9-1ã€è‡ªåŠ¨é…ç½®çš„-InfoContributor">53.9.1ã€è‡ªåŠ¨é…ç½®çš„ InfoContributor</h4><p>é€‚å½“æ—¶ï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½®ä»¥ä¸‹ <code>InfoContributor</code> beanï¼š</p><table><thead><tr><th>åç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/EnvironmentInfoContributor.java"><code>EnvironmentInfoContributor</code></a></td><td>åœ¨ <code>info</code> key ä¸‹æ˜¾ç¤º <code>Environment</code> ä¸­çš„æ‰€æœ‰ keyã€‚</td></tr><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/GitInfoContributor.java"><code>GitInfoContributor</code></a></td><td>å¦‚æœ <code>git.properties</code> å¯ç”¨åˆ™æš´éœ² git ä¿¡æ¯ã€‚</td></tr><tr><td><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/BuildInfoContributor.java"><code>BuildInfoContributor</code></a></td><td>å¦‚æœ <code>META-INF/build-info.properties</code> å¯ç”¨åˆ™æš´éœ²æ„å»ºä¿¡æ¯ã€‚</td></tr></tbody></table><p><strong>æç¤º</strong></p><blockquote><p>å¯ä»¥é€šè¿‡è®¾ç½® <code>management.info.defaults.enabled</code> å±æ€§æ¥ç¦ç”¨å®ƒä»¬ã€‚</p></blockquote><p><a id="production-ready-application-info-env"></a></p><h4 id="53-9-2ã€è‡ªå®šä¹‰åº”ç”¨ç¨‹åºä¿¡æ¯">53.9.2ã€è‡ªå®šä¹‰åº”ç”¨ç¨‹åºä¿¡æ¯</h4><p>ä½ å¯ä»¥é€šè¿‡è®¾ç½® <code>info.*</code> å­—ç¬¦ä¸²å±æ€§æ¥è‡ªå®šä¹‰ <code>info</code>ç«¯ç‚¹æš´éœ²çš„æ•°æ®ã€‚<code>info</code> key ä¸‹çš„æ‰€æœ‰ <code>Environment</code> å±æ€§éƒ½ä¼šè‡ªåŠ¨æš´éœ²ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å°†ä»¥ä¸‹è®¾ç½®æ·»åŠ åˆ° <code>application.properties</code> æ–‡ä»¶ä¸­ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">info.app.encoding</span>=UTF-<span class="number">8</span></span><br><span class="line"><span class="attr">info.app.java.source</span>=<span class="number">1.8</span></span><br><span class="line"><span class="attr">info.app.java.target</span>=<span class="number">1.8</span></span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>ä½ å¯ä»¥åœ¨<a href="how-to.md#howto-automatic-expansion">æ„å»ºæ—¶æ‰©å±• info å±æ€§</a>ï¼Œè€Œä¸æ˜¯å¯¹è¿™äº›å€¼è¿›è¡Œç¡¬ç¼–ç ã€‚<br>å‡è®¾ä½ ä½¿ç”¨ Mavenï¼Œä½ å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼é‡å†™å‰é¢çš„ç¤ºä¾‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">info.app.encoding</span>=@project.build.sourceEncoding@</span><br><span class="line"><span class="attr">info.app.java.source</span>=@java.version@</span><br><span class="line"><span class="attr">info.app.java.target</span>=@java.version@</span><br></pre></td></tr></table></figure></blockquote><p><a id="production-ready-application-info-git"></a></p><h4 id="53-9-3ã€Git-æäº¤ä¿¡æ¯">53.9.3ã€Git æäº¤ä¿¡æ¯</h4><p><code>info</code> ç«¯ç‚¹çš„å¦ä¸€ä¸ªæœ‰ç”¨åŠŸèƒ½æ˜¯å®ƒèƒ½å¤Ÿåœ¨æ„å»ºé¡¹ç›®æ—¶å‘å¸ƒ git æºç ä»“åº“ç›¸å…³çš„çŠ¶æ€çš„ä¿¡æ¯ã€‚å¦‚æœ <code>GitProperties</code> bean å¯ç”¨ï¼Œåˆ™æš´éœ² <code>git.branch</code>ã€<code>git.commit.id</code> å’Œ <code>git.commit.time</code> å±æ€§ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœ <code>git.properties</code> æ–‡ä»¶åœ¨ classpath çš„æ ¹ç›®å½•ä¸­å¯ç”¨ï¼Œåˆ™ä¼šè‡ªåŠ¨é…ç½® <code>GitProperties</code> beanã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="how-to.md#howto-git-info"><strong>ç”Ÿæˆ git ä¿¡æ¯</strong></a>ã€‚</p></blockquote><p>å¦‚æœè¦æ˜¾ç¤ºå®Œæ•´çš„ git ä¿¡æ¯ï¼ˆå³ <code>git.properties</code> çš„å®Œæ•´å†…å®¹ï¼‰ï¼Œè¯·ä½¿ç”¨ <code>management.info.git.mode</code> å±æ€§ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.info.git.mode</span>=full</span><br></pre></td></tr></table></figure><p><a id="production-ready-application-info-build"></a></p><h4 id="53-9-4ã€æ„å»ºä¿¡æ¯">53.9.4ã€æ„å»ºä¿¡æ¯</h4><p>å¦‚æœ <code>BuildProperties</code> bean å¯ç”¨ï¼Œåˆ™ <code>info</code> ç«¯ç‚¹è¿˜å¯ä»¥å‘å¸ƒæ„å»ºç›¸å…³çš„ä¿¡æ¯ã€‚å¦‚æœ classpath ä¸­æœ‰ <code>META-INF/build-info.properties</code> æ–‡ä»¶ï¼Œåˆ™ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>Maven å’Œ Gradle æ’ä»¶éƒ½å¯ä»¥ç”Ÿæˆè¯¥æ–‡ä»¶ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="how-to.md#howto-build-info"><strong>ç”Ÿæˆæ„å»ºä¿¡æ¯</strong></a>ã€‚</p></blockquote><p><a id="production-ready-application-info-build"></a></p><h4 id="53-9-5ã€ç¼–å†™è‡ªå®šä¹‰-InfoContributor">53.9.5ã€ç¼–å†™è‡ªå®šä¹‰ InfoContributor</h4><p>è¦æä¾›è‡ªå®šä¹‰åº”ç”¨ç¨‹åºä¿¡æ¯ï¼Œå¯ä»¥æ³¨å†Œå®ç° <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/InfoContributor.java"><code>InfoContributor</code></a> æ¥å£çš„ Spring beanã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹æä¾›äº†å…·æœ‰å•ä¸ªå€¼çš„ <code>example</code> æ¡ç›®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.info.Info;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.actuate.info.InfoContributor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExampleInfoContributor</span> <span class="keyword">implements</span> <span class="title class_">InfoContributor</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contribute</span><span class="params">(Info.Builder builder)</span> &#123;</span><br><span class="line">builder.withDetail(<span class="string">&quot;example&quot;</span>,</span><br><span class="line">Collections.singletonMap(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœè®¿é—® <code>info</code> ç«¯ç‚¹ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°åŒ…å«ä»¥ä¸‹é™„åŠ æ¡ç›®çš„å“åº”ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;example&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;key&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;value&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><a id="production-ready-monitoring"></a></p><h2 id="54ã€é€šè¿‡-HTTP-ç›‘æ§å’Œç®¡ç†">54ã€é€šè¿‡ HTTP ç›‘æ§å’Œç®¡ç†</h2><p>å¦‚æœä½ æ­£åœ¨å¼€å‘ Web åº”ç”¨ç¨‹åºï¼ŒSpring Boot Actuator ä¼šè‡ªåŠ¨é…ç½®æ‰€æœ‰å·²å¯ç”¨çš„ç«¯ç‚¹ä»¥é€šè¿‡ HTTP æš´éœ²ã€‚é»˜è®¤çº¦å®šæ˜¯ä½¿ç”¨å‰ç¼€ä¸º <code>/actuator</code> çš„ç«¯ç‚¹çš„ <code>id</code> ä½œä¸º URL è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œ<code>health</code> ä»¥ <code>/actuator/health</code> æš´éœ²ã€‚æç¤ºï¼šSpring MVCã€Spring WebFlux å’Œ Jersey æœ¬èº«æ”¯æŒ Actuatorã€‚</p><p><a id="production-ready-customizing-management-server-context-path"></a></p><h3 id="54-1ã€è‡ªå®šä¹‰-Management-ç«¯ç‚¹è·¯å¾„">54.1ã€è‡ªå®šä¹‰ Management ç«¯ç‚¹è·¯å¾„</h3><p>æœ‰æ—¶ï¼Œè‡ªå®šä¹‰ management ç«¯ç‚¹çš„å‰ç¼€å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œä½ çš„åº”ç”¨ç¨‹åºå¯èƒ½å·²å°† <code>/actuator</code> ç”¨äºå…¶ä»–ç›®çš„ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>management.endpoints.web.base-path</code> å±æ€§æ›´æ”¹ management ç«¯ç‚¹çš„å‰ç¼€ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.endpoints.web.base-path</span>=/manage</span><br></pre></td></tr></table></figure><p>å‰é¢çš„ <code>application.properties</code> ç¤ºä¾‹å°†ç«¯ç‚¹ä» <code>/actuator/&#123;id&#125;</code> æ›´æ”¹ä¸º <code>/manage/&#123;id&#125;</code>ï¼ˆä¾‹å¦‚ï¼Œ<code>/manage/info</code>ï¼‰ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>é™¤éå·²å°† management ç«¯å£é…ç½®ä¸º<a href="production-ready-customizing-management-server-port">ä½¿ç”¨å…¶ä»– HTTP ç«¯å£æš´éœ²ç«¯ç‚¹</a>ï¼Œå¦åˆ™ <code>management.endpoints.web.base-path</code> ä¸ <code>server.servlet.context-path</code> ç›¸å…³è”ã€‚å¦‚æœé…ç½®äº† <code>management.server.port</code>ï¼Œåˆ™ <code>management.endpoints.web.base-path</code> ä¸ <code>management.server.servlet.context-path</code> ç›¸å…³è”ã€‚</p></blockquote><p>å¦‚æœè¦å°†ç«¯ç‚¹æ˜ å°„åˆ°å…¶ä»–è·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨ <code>management.endpoints.web.path-mapping</code> å±æ€§ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹å°† <code>/actuator/health</code> é‡æ–°æ˜ å°„åˆ° <code>/healthcheck</code>ï¼š</p><p><strong>application.properties</strong></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.endpoints.web.base-path</span>=/</span><br><span class="line"><span class="attr">management.endpoints.web.path-mapping.health</span>=healthcheck</span><br></pre></td></tr></table></figure><p><a id="production-ready-customizing-management-server-port"></a></p><h3 id="54-2ã€è‡ªå®šä¹‰-Management-æœåŠ¡å™¨ç«¯å£">54.2ã€è‡ªå®šä¹‰ Management æœåŠ¡å™¨ç«¯å£</h3><p>ä½¿ç”¨é»˜è®¤ HTTP ç«¯å£æš´éœ² management ç«¯ç‚¹æ˜¯åŸºäºäº‘éƒ¨ç½²çš„æ˜æ™ºé€‰æ‹©ã€‚ä½†æ˜¯ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ˜¯åœ¨è‡ªå·±çš„æ•°æ®ä¸­å¿ƒå†…è¿è¡Œï¼Œä½ å¯èƒ½æ›´å–œæ¬¢ä½¿ç”¨å…¶ä»– HTTP ç«¯å£æš´éœ²ç«¯ç‚¹ã€‚</p><p>ä½ å¯ä»¥è®¾ç½® <code>management.server.port</code> å±æ€§ä»¥æ›´æ”¹ HTTP ç«¯å£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.server.port</span>=<span class="number">8081</span></span><br></pre></td></tr></table></figure><p><a id="production-ready-management-specific-ssl"></a></p><h3 id="54-3ã€é…ç½®-Management-çš„-SSL">54.3ã€é…ç½® Management çš„ SSL</h3><p>å½“é…ç½®ä¸ºä½¿ç”¨è‡ªå®šä¹‰ç«¯å£æ—¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å„ç§ <code>management.server.ssl.*</code> å±æ€§ä¸º management æœåŠ¡å™¨é…ç½®è‡ªå·±çš„ SSLã€‚ä¾‹å¦‚ï¼Œè¿™æ ·åšå¯ä»¥åœ¨ä¸»åº”ç”¨ç¨‹åºä½¿ç”¨ HTTPS æ—¶å¯é€šè¿‡ HTTP ä½¿ç”¨ management æœåŠ¡å™¨ï¼Œå¦‚ä»¥ä¸‹å±æ€§è®¾ç½®æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="number">8443</span></span><br><span class="line"><span class="attr">server.ssl.enabled</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">server.ssl.key-store</span>=classpath:store.jks</span><br><span class="line"><span class="attr">server.ssl.key-password</span>=secret</span><br><span class="line"><span class="attr">management.server.port</span>=<span class="number">8080</span></span><br><span class="line"><span class="attr">management.server.ssl.enabled</span>=<span class="literal">false</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œä¸»æœåŠ¡å™¨å’Œ management æœåŠ¡å™¨éƒ½å¯ä»¥ä½¿ç”¨ SSLï¼Œä½†ä»–ä»¬çš„ key store ä¸åŒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="number">8443</span></span><br><span class="line"><span class="attr">server.ssl.enabled</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">server.ssl.key-store</span>=classpath:main.jks</span><br><span class="line"><span class="attr">server.ssl.key-password</span>=secret</span><br><span class="line"><span class="attr">management.server.port</span>=<span class="number">8080</span></span><br><span class="line"><span class="attr">management.server.ssl.enabled</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">management.server.ssl.key-store</span>=classpath:management.jks</span><br><span class="line"><span class="attr">management.server.ssl.key-password</span>=secret</span><br></pre></td></tr></table></figure><p><a id="production-ready-customizing-management-server-address"></a></p><h3 id="54-4ã€é…ç½®-Management-æœåŠ¡å™¨åœ°å€">54.4ã€é…ç½® Management æœåŠ¡å™¨åœ°å€</h3><p>ä½ å¯ä»¥é€šè¿‡è®¾ç½® <code>management.server.address</code> å±æ€§æ¥è‡ªå®šä¹‰ management ç«¯ç‚¹å¯ç”¨çš„åœ°å€ã€‚å¦‚æœä½ åªæƒ³åœ¨å†…éƒ¨æˆ–æ“ä½œçš„ç½‘ç»œä¸Šç›‘å¬æˆ–ä»…ç›‘å¬æ¥è‡ª <code>localhost</code> çš„è¿æ¥ï¼Œé‚£ä¹ˆè¿™æ ·åšä¼šéå¸¸æœ‰ç”¨ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>ä»…å½“ç«¯å£ä¸ä¸»æœåŠ¡å™¨ç«¯å£ä¸åŒæ—¶ï¼Œæ‰èƒ½ç›‘å¬ä¸åŒçš„åœ°å€ã€‚</p></blockquote><p>ä»¥ä¸‹ <code>application.properties</code> ç¤ºä¾‹ä¸å…è®¸è¿œç¨‹è¿æ¥ managementï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.server.port</span>=<span class="number">8081</span></span><br><span class="line"><span class="attr">management.server.address</span>=<span class="number">127.0</span>.<span class="number">0.1</span></span><br></pre></td></tr></table></figure><p><a id="production-ready-disabling-http-endpoints"></a></p><h3 id="54-5ã€ç¦ç”¨-HTTP-ç«¯ç‚¹">54.5ã€ç¦ç”¨ HTTP ç«¯ç‚¹</h3><p>å¦‚æœä½ ä¸å¸Œæœ›é€šè¿‡ HTTP æš´éœ²ç«¯ç‚¹ï¼Œåˆ™å¯ä»¥å°† management ç«¯å£è®¾ç½®ä¸º <code>-1</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.server.port</span>=-<span class="number">1</span></span><br></pre></td></tr></table></figure><p>è¿™å¯ä»¥ä½¿ç”¨ <code>management.endpoints.web.exposure.exclude</code> å±æ€§æ¥å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.endpoints.web.exposure.exclude</span>=*</span><br></pre></td></tr></table></figure><p><a id="production-ready-jmx"></a></p><h2 id="55ã€é€šè¿‡-JMX-ç›‘æ§å’Œç®¡ç†">55ã€é€šè¿‡ JMX ç›‘æ§å’Œç®¡ç†</h2><p>Java ç®¡ç†æ‰©å±•ï¼ˆJava Management Extensionsï¼ŒJMXï¼‰æä¾›äº†ä¸€ç§ç›‘æ§å’Œç®¡ç†åº”ç”¨ç¨‹åºçš„æ ‡å‡†æœºåˆ¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot å°† management ç«¯ç‚¹æš´éœ²ä¸º <code>org.springframework.boot</code> åŸŸä¸‹çš„ JMX MBeanã€‚</p><p><a id="production-ready-custom-mbean-names"></a></p><h3 id="55-1ã€è‡ªå®šä¹‰-MBean-åç§°">55.1ã€è‡ªå®šä¹‰ MBean åç§°</h3><p>MBean çš„åç§°é€šå¸¸æ˜¯ä»ç«¯ç‚¹çš„ <code>id</code> ç”Ÿæˆçš„ã€‚ä¾‹å¦‚ï¼Œ<code>health</code> ç«¯ç‚¹å…¬å¼€ä¸º <code>org.springframework.boot:type=Endpoint,name=Health</code>ã€‚</p><p>å¦‚æœä½ çš„åº”ç”¨ç¨‹åºåŒ…å«å¤šä¸ª Spring <code>ApplicationContext</code>ï¼Œå¯èƒ½ä¼šå‘ç”Ÿåç§°å†²çªã€‚è¦è§£å†³æ­¤é—®é¢˜ï¼Œå¯ä»¥å°† <code>spring.jmx.unique-names</code> å±æ€§è®¾ç½®ä¸º <code>true</code>ï¼Œä»¥ä¿è¯ MBean åç§°å§‹ç»ˆå”¯ä¸€ã€‚</p><p>ä½ è¿˜å¯ä»¥è‡ªå®šä¹‰æš´éœ²ç«¯ç‚¹çš„ JMX åŸŸã€‚ä»¥ä¸‹è®¾ç½®å±•ç¤ºäº†åœ¨ <code>application.properties</code> ä¸­æ‰§è¡Œæ­¤æ“ä½œçš„ç¤ºä¾‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.jmx.unique-names</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">management.endpoints.jmx.domain</span>=com.example.myapp</span><br></pre></td></tr></table></figure><p><a id="production-ready-disable-jmx-endpoints"></a></p><h3 id="55-2ã€ç¦ç”¨-JMX-ç«¯ç‚¹">55.2ã€ç¦ç”¨ JMX ç«¯ç‚¹</h3><p>å¦‚æœä½ ä¸æƒ³é€šè¿‡ JMX æš´éœ²ç«¯ç‚¹ï¼Œå¯ä»¥å°† <code>management.endpoints.jmx.exposure.exclude</code> å±æ€§è®¾ç½®ä¸º <code>*</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.endpoints.jmx.exposure.exclude</span>=*</span><br></pre></td></tr></table></figure><p><a id="production-ready-jolokia"></a></p><h3 id="55-3ã€é€šè¿‡-HTTP-ä½¿ç”¨-Jolokia-è®¿é—®-JMX">55.3ã€é€šè¿‡ HTTP ä½¿ç”¨ Jolokia è®¿é—® JMX</h3><p>Jolokia æ˜¯ä¸€ä¸ª JMX-HTTP æ¡¥ï¼Œå®ƒæä¾›äº†ä¸€ç§è®¿é—® JMX bean çš„æ–°æ–¹å¼ã€‚è¦ä½¿ç”¨ Jolokiaï¼Œè¯·å¼•å…¥ä¾èµ–ï¼š<code>org.jolokia:jolokia-core</code>ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ Mavenï¼Œä½ å°†æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jolokia<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jolokia-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¹‹åå¯ä»¥é€šè¿‡å°† <code>jolokia</code> æˆ– <code>*</code> æ·»åŠ åˆ° <code>management.endpoints.web.exposure.include</code> å±æ€§æ¥æš´éœ² Jolokia ç«¯ç‚¹ã€‚æœ€åï¼Œä½ å¯ä»¥åœ¨ management HTTP æœåŠ¡å™¨ä¸Šä½¿ç”¨ <code>/actuator/jolokia</code> è®¿é—®å®ƒã€‚</p><p><a id="production-ready-customizing-jolokia"></a></p><h4 id="55-3-1ã€è‡ªå®šä¹‰-Jolokia">55.3.1ã€è‡ªå®šä¹‰ Jolokia</h4><p>Jolokia æœ‰è®¸å¤šè®¾ç½®ï¼Œä½ å¯ä»¥é€šè¿‡è®¾ç½® servlet å‚æ•°æ¥ä½¿ç”¨ä¼ ç»Ÿæ–¹å¼è¿›è¡Œé…ç½®ã€‚ä½¿ç”¨ Spring Boot æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>application.properties</code> æ–‡ä»¶é…ç½®ã€‚è¯·åœ¨å‚æ•°å‰åŠ ä¸Š <code>management.endpoint.jolokia.config</code>ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.endpoint.jolokia.config.debug</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p><a id="production-ready-disabling-jolokia"></a></p><h4 id="55-3-2ã€ç¦ç”¨-Jolokia">55.3.2ã€ç¦ç”¨ Jolokia</h4><p>å¦‚æœä½ ä½¿ç”¨ Jolokia ä½†ä¸å¸Œæœ› Spring Boot é…ç½®å®ƒï¼Œè¯·å°† <code>management.endpoint.jolokia.enabled</code> å±æ€§è®¾ç½®ä¸º <code>false</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.endpoint.jolokia.enabled</span>=<span class="literal">false</span></span><br></pre></td></tr></table></figure><p><a id="production-ready-loggers"></a></p><h2 id="56ã€æ—¥å¿—è®°å½•å™¨">56ã€æ—¥å¿—è®°å½•å™¨</h2><p>Spring Boot Actuator æœ‰å¯åœ¨è¿è¡Œæ—¶æŸ¥çœ‹å’Œé…ç½®åº”ç”¨ç¨‹åºæ—¥å¿—çº§åˆ«çš„åŠŸèƒ½ã€‚ä½ å¯ä»¥æŸ¥çœ‹å…¨éƒ¨æˆ–å•ä¸ªæ—¥å¿—è®°å½•å™¨çš„é…ç½®ï¼Œè¯¥é…ç½®ç”±æ˜¾å¼é…ç½®çš„æ—¥å¿—è®°å½•çº§åˆ«ä»¥åŠæ—¥å¿—è®°å½•æ¡†æ¶ä¸ºå…¶æä¾›çš„æœ‰æ•ˆæ—¥å¿—è®°å½•çº§åˆ«ç»„æˆã€‚è¿™äº›çº§åˆ«å¯ä»¥æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼š</p><ul><li><code>TRACE</code></li><li><code>DEBUG</code></li><li><code>INFO</code></li><li><code>WARN</code></li><li><code>ERROR</code></li><li><code>FATAL</code></li><li><code>OFF</code></li><li><code>null</code></li></ul><p><code>null</code> è¡¨ç¤ºæ²¡æœ‰æ˜¾å¼é…ç½®ã€‚</p><p><a id="production-ready-logger-configuration"></a></p><h3 id="56-1ã€é…ç½®ä¸€ä¸ªæ—¥å¿—è®°å½•å™¨">56.1ã€é…ç½®ä¸€ä¸ªæ—¥å¿—è®°å½•å™¨</h3><p>è¦é…ç½®æ—¥å¿—è®°å½•å™¨ï¼Œè¯·å°†éƒ¨åˆ†å®ä½“ <code>POST</code> åˆ°èµ„æºçš„ URIï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;configuredLevel&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DEBUG&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>è¦<strong>é‡ç½®</strong>æ—¥å¿—è®°å½•å™¨çš„ç‰¹å®šçº§åˆ«ï¼ˆå¹¶ä½¿ç”¨é»˜è®¤é…ç½®ä»£æ›¿ï¼‰ï¼Œå¯ä»¥å°† <code>null</code> å€¼ä½œä¸º <code>configuredLevel</code> ä¼ é€’ã€‚</p></blockquote><p><a id="production-ready-metrics"></a></p><h2 id="57ã€æŒ‡æ ‡">57ã€æŒ‡æ ‡</h2><p>Spring Boot Actuator ä¸º <a href="https://micrometer.io/">Micrometer</a> æä¾›äº†ä¾èµ–ç®¡ç†å’Œè‡ªåŠ¨é…ç½®ï¼ŒMicrometer æ˜¯ä¸€ä¸ªæ”¯æŒä¼—å¤šç›‘æ§ç³»ç»Ÿçš„åº”ç”¨ç¨‹åºæŒ‡æ ‡é—¨é¢ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li><a href="#production-ready-metrics-export-appoptics">AppOptics</a></li><li><a href="#production-ready-metrics-export-atlas">Atlas</a></li><li><a href="#production-ready-metrics-export-datadog">Datadog</a></li><li><a href="#production-ready-metrics-export-dynatrace">Dynatrace</a></li><li><a href="#production-ready-metrics-export-elastic">Elastic</a></li><li><a href="#production-ready-metrics-export-ganglia">Ganglia</a></li><li><a href="#production-ready-metrics-export-graphite">Graphite</a></li><li><a href="#production-ready-metrics-export-humio">Humio</a></li><li><a href="#production-ready-metrics-export-influx">Influx</a></li><li><a href="#production-ready-metrics-export-jmx">JMX</a></li><li><a href="#production-ready-metrics-export-kairos">KairosDB</a></li><li><a href="#production-ready-metrics-export-newrelic">New Relic</a></li><li><a href="#production-ready-metrics-export-prometheus">Prometheus</a></li><li><a href="#production-ready-metrics-export-signalfx">SignalFx</a></li><li><a href="#production-ready-metrics-export-simple">Simple (in-memory)</a></li><li><a href="#production-ready-metrics-export-statsd">StatsD</a></li><li><a href="#production-ready-metrics-export-wavefront">Wavefront</a></li></ul><p><strong>æç¤º</strong></p><p>è¦äº†è§£æœ‰å…³ Micrometer åŠŸèƒ½çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…å…¶<a href="https://micrometer.io/docs">å‚è€ƒæ–‡æ¡£</a>ï¼Œç‰¹åˆ«æ˜¯<a href="https://micrometer.io/docs/concepts">æ¦‚å¿µéƒ¨åˆ†</a>ã€‚</p><p><a id="production-ready-metrics-getting-started"></a></p><h3 id="57-1ã€å…¥é—¨">57.1ã€å…¥é—¨</h3><p>Spring Boot è‡ªåŠ¨é…ç½®äº†ä¸€ä¸ªç»„åˆçš„ <code>MeterRegistry</code>ï¼Œå¹¶ä¸º classpath ä¸­æ¯ä¸ªå—æ”¯æŒçš„å®ç°å‘è¯¥ç»„åˆæ³¨å†Œä¸€ä¸ªæ³¨å†Œè¡¨ã€‚åœ¨è¿è¡Œæ—¶ï¼Œåªéœ€è¦ classpath ä¸­æœ‰ <code>micrometer-registry-&#123;system&#125;</code> ä¾èµ–å³å¯è®© Spring Boot é…ç½®è¯¥æ³¨å†Œè¡¨ã€‚</p><p>å¤§éƒ¨åˆ†æ³¨å†Œè¡¨éƒ½æœ‰å…±åŒç‚¹ ä¾‹å¦‚ï¼Œå³ä½¿ Micrometer æ³¨å†Œå®ç°ä½äº classpath ä¸Šï¼Œä½ ä¹Ÿå¯ä»¥ç¦ç”¨ç‰¹å®šçš„æ³¨å†Œè¡¨ã€‚ä¾‹å¦‚ï¼Œè¦ç¦ç”¨ Datadogï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.datadog.enabled</span>=<span class="literal">false</span></span><br></pre></td></tr></table></figure><p>Spring Boot è¿˜ä¼šå°†æ‰€æœ‰è‡ªåŠ¨é…ç½®çš„æ³¨å†Œè¡¨æ·»åŠ åˆ° <code>Metrics</code> ç±»çš„å…¨å±€é™æ€å¤åˆæ³¨å†Œè¡¨ä¸­ï¼Œé™¤éä½ æ˜ç¡®ç¦æ­¢ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.use-global-registry</span>=<span class="literal">false</span></span><br></pre></td></tr></table></figure><p>åœ¨æ³¨å†Œè¡¨ä¸­æ³¨å†Œä»»ä½•æŒ‡æ ‡ä¹‹å‰ï¼Œä½ å¯ä»¥æ³¨å†Œä»»æ„æ•°é‡çš„ <code>MeterRegistryCustomizer</code> bean ä»¥è¿›ä¸€æ­¥é…ç½®æ³¨å†Œè¡¨ï¼Œä¾‹å¦‚é€šç”¨æ ‡ç­¾ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">MeterRegistryCustomizer&lt;MeterRegistry&gt; <span class="title function_">metricsCommonTags</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> registry -&gt; registry.config().commonTags(<span class="string">&quot;region&quot;</span>, <span class="string">&quot;us-east-1&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥é€šè¿‡æŒ‡å®šæ³›å‹ç±»å‹ï¼Œè‡ªå®šä¹‰æ³¨å†Œè¡¨å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">MeterRegistryCustomizer&lt;GraphiteMeterRegistry&gt; <span class="title function_">graphiteMetricsNamingConvention</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> registry -&gt; registry.config().namingConvention(MY_CUSTOM_CONVENTION);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¯¥è®¾ç½®ï¼Œä½ å¯ä»¥åœ¨ç»„ä»¶ä¸­æ³¨å…¥ <code>MeterRegistry</code> å¹¶æ³¨å†ŒæŒ‡æ ‡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SampleBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Counter counter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">SampleBean</span><span class="params">(MeterRegistry registry)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.counter = registry.counter(<span class="string">&quot;received.messages&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.counter.increment();</span><br><span class="line"><span class="comment">// å¤„ç†æ¶ˆæ¯å®ç°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Spring Boot è¿˜<a href="https://docs.spring.io/spring-boot/docs/2.1.4.RELEASE/reference/htmlsingle/#production-ready-metrics-meter">é…ç½®å†…ç½®çš„æµ‹é‡å·¥å…·</a>ï¼ˆå³ <code>MeterBinder</code> å®ç°ï¼‰ï¼Œä½ å¯ä»¥é€šè¿‡é…ç½®æˆ–ä¸“ç”¨æ³¨è§£æ ‡è®°æ¥æ§åˆ¶ã€‚</p><p><a id="production-ready-metrics-export"></a></p><h3 id="57-2ã€æ”¯æŒçš„ç›‘æ§ç³»ç»Ÿ">57.2ã€æ”¯æŒçš„ç›‘æ§ç³»ç»Ÿ</h3><p><a id="production-ready-metrics-export-appoptics"></a></p><h4 id="57-2-1ã€AppOptics">57.2.1ã€AppOptics</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒAppOptics æ³¨å†Œè¡¨ä¼šå®šæœŸå°†æŒ‡æ ‡æ¨é€åˆ° <a href="https://api.appoptics.com/v1/measurements">api.appoptics.com/v1/measurements</a>ã€‚è¦å°†æŒ‡æ ‡å¯¼å‡ºåˆ° SaaS <a href="https://micrometer.io/docs/registry/appoptics">AppOptics</a>ï¼Œä½ å¿…é¡»æä¾› API ä»¤ç‰Œï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.appoptics.api-token</span>=YOUR_TOKEN</span><br></pre></td></tr></table></figure><p><a id="production-ready-metrics-export-atlas"></a></p><h4 id="57-2-2ã€Atlas">57.2.2ã€Atlas</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåº¦é‡æ ‡å‡†å°†å¯¼å‡ºåˆ°æœ¬åœ°çš„ <a href="https://micrometer.io/docs/registry/atlas">Atlas</a>ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æŒ‡å®š <a href="https://github.com/Netflix/atlas">Atlas æœåŠ¡å™¨</a>çš„ä½ç½®ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.atlas.uri</span>=https://atlas.example.com:<span class="number">7101</span>/api/v1/publish</span><br></pre></td></tr></table></figure><p><a id="production-ready-metrics-export-datadog"></a></p><h4 id="57-2-3ã€Datadog">57.2.3ã€Datadog</h4><p>Datadog æ³¨å†Œè¡¨ä¼šå®šæœŸå°†æŒ‡æ ‡æ¨é€åˆ° <a href="https://www.datadoghq.com/">datadoghq</a>ã€‚è¦å°†æŒ‡æ ‡å¯¼å‡ºåˆ° <a href="https://micrometer.io/docs/registry/datadog">Datadog</a>ï¼Œä½ å¿…é¡»æä¾› API å¯†é’¥ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.datadog.api-key</span>=YOUR_KEY</span><br></pre></td></tr></table></figure><p>ä½ è¿˜å¯ä»¥æ›´æ”¹åº¦é‡æ ‡å‡†å‘é€åˆ° Datadog çš„é—´éš”æ—¶é—´ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.datadog.step</span>=<span class="number">30</span>s</span><br></pre></td></tr></table></figure><p><a id="production-ready-metrics-export-dynatrace"></a></p><h4 id="57-2-4ã€Dynatrace">57.2.4ã€Dynatrace</h4><p>Dynatrace æ³¨å†Œè¡¨å®šæœŸå°†æŒ‡æ ‡æ¨é€åˆ°é…ç½®çš„ URIã€‚è¦å°†æŒ‡æ ‡å¯¼å‡ºåˆ° <a href="https://micrometer.io/docs/registry/dynatrace">Dynatrace</a>ï¼Œå¿…é¡»æä¾› API ä»¤ç‰Œã€è®¾å¤‡ ID å’Œ URIï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.dynatrace.api-token</span>=YOUR_TOKEN</span><br><span class="line"><span class="attr">management.metrics.export.dynatrace.device-id</span>=YOUR_DEVICE_ID</span><br><span class="line"><span class="attr">management.metrics.export.dynatrace.uri</span>=YOUR_URI</span><br></pre></td></tr></table></figure><p>ä½ è¿˜å¯ä»¥æ›´æ”¹åº¦é‡æ ‡å‡†å‘é€åˆ° Dynatrace çš„é—´éš”æ—¶é—´ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.dynatrace.step</span>=<span class="number">30</span>s</span><br></pre></td></tr></table></figure><p><a id="production-ready-metrics-export-elastic"></a></p><h4 id="57-2-5ã€Elastic">57.2.5ã€Elastic</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåº¦é‡å°†å¯¼å‡ºåˆ°æœ¬åœ°çš„ <a href="https://micrometer.io/docs/registry/elastic">Elastic</a>ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å±æ€§æä¾› Elastic æœåŠ¡å™¨çš„ä½ç½®ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.elastic.host</span>=https://elastic.example.com:<span class="number">8086</span></span><br></pre></td></tr></table></figure><p><a id="production-ready-metrics-export-ganglia"></a></p><h4 id="57-2-6ã€Ganglia">57.2.6ã€Ganglia</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåº¦é‡å°†å¯¼å‡ºåˆ°æœ¬åœ°çš„ <a href="https://micrometer.io/docs/registry/ganglia">Ganglia</a>ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æä¾› <a href="http://ganglia.sourceforge.net/">Ganglia æœåŠ¡å™¨</a>ä¸»æœºå’Œç«¯å£ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.ganglia.host</span>=ganglia.example.com</span><br><span class="line"><span class="attr">management.metrics.export.ganglia.port</span>=<span class="number">9649</span></span><br></pre></td></tr></table></figure><p><a id="production-ready-metrics-export-graphite"></a></p><h4 id="57-2-7ã€Graphite">57.2.7ã€Graphite</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåº¦é‡å°†å¯¼å‡ºåˆ°æœ¬åœ°çš„ <a href="https://micrometer.io/docs/registry/graphite">Graphite</a>ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æä¾› <a href="https://graphiteapp.org/">Graphite æœåŠ¡å™¨</a>ä¸»æœºå’Œç«¯å£ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.graphite.host</span>=graphite.example.com</span><br><span class="line"><span class="attr">management.metrics.export.graphite.port</span>=<span class="number">9004</span></span><br></pre></td></tr></table></figure><p>Micrometer æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„ <code>HierarchicalNameMapper</code>ï¼Œå®ƒç®¡ç†ç»´åº¦è®¡æ•°å™¨ id å¦‚ä½•<a href="https://micrometer.io/docs/registry/graphite#_hierarchical_name_mapping">æ˜ å°„åˆ°å¹³é¢åˆ†å±‚åç§°</a>ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>è¦æ§åˆ¶æ­¤è¡Œä¸ºï¼Œè¯·å®šä¹‰ <code>GraphiteMeterRegistry</code> å¹¶æä¾›è‡ªå·±çš„ <code>HierarchicalNameMapper</code>ã€‚é™¤éä½ è‡ªå·±å®šä¹‰ï¼Œå¦åˆ™ä½¿ç”¨è‡ªåŠ¨é…ç½®çš„ <code>GraphiteConfig</code> å’Œ <code>Clock</code> beanï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> GraphiteMeterRegistry <span class="title function_">graphiteMeterRegistry</span><span class="params">(GraphiteConfig config, Clock clock)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">GraphiteMeterRegistry</span>(config, clock, MY_HIERARCHICAL_MAPPER);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="production-ready-metrics-export-humio"></a></p><h4 id="57-2-8ã€Humio">57.2.8ã€Humio</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒHumio æ³¨å†Œè¡¨ä¼šå®šæœŸå°†æŒ‡æ ‡æ¨é€åˆ° <a href="https://cloud.humio.com/">cloud.humio.com</a>ã€‚è¦å°†æŒ‡æ ‡å¯¼å‡ºåˆ° SaaS <a href="https://micrometer.io/docs/registry/humio">Humio</a>ï¼Œä½ å¿…é¡»æä¾› API ä»¤ç‰Œï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.humio.api-token</span>=YOUR_TOKEN</span><br></pre></td></tr></table></figure><p>ä½ è¿˜åº”é…ç½®ä¸€ä¸ªæˆ–å¤šä¸ªæ ‡è®°ï¼Œä»¥æ ‡è¯†è¦æ¨é€æŒ‡æ ‡çš„æ•°æ®æºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.humio.tags.alpha</span>=a</span><br><span class="line"><span class="attr">management.metrics.export.humio.tags.bravo</span>=b</span><br></pre></td></tr></table></figure><p><a id="production-ready-metrics-export-influx"></a></p><h4 id="57-2-9ã€Influx">57.2.9ã€Influx</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåº¦é‡å°†å¯¼å‡ºåˆ°æœ¬åœ°çš„ <a href="https://micrometer.io/docs/registry/influx">Influx</a>ã€‚è¦æŒ‡å®š <a href="https://www.influxdata.com/">Influx æœåŠ¡å™¨</a>çš„ä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.influx.uri</span>=https://influx.example.com:<span class="number">8086</span></span><br></pre></td></tr></table></figure><p><a id="production-ready-metrics-export-jmx"></a></p><h4 id="57-2-10ã€JMX">57.2.10ã€JMX</h4><p>Micrometer æä¾›äº†ä¸ <a href="https://micrometer.io/docs/registry/jmx">JMX</a> çš„åˆ†å±‚æ˜ å°„ï¼Œä¸»è¦ä¸ºäº†æ–¹ä¾¿åœ¨æœ¬åœ°æŸ¥çœ‹æŒ‡æ ‡ä¸”å¯ç§»æ¤ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåº¦é‡å°†å¯¼å‡ºåˆ° <code>metrics</code> JMX åŸŸã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æä¾›è¦ä½¿ç”¨çš„åŸŸï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.jmx.domain</span>=com.example.app.metrics</span><br></pre></td></tr></table></figure><p>Micrometer æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„ <code>HierarchicalNameMapper</code>ï¼Œå®ƒç®¡ç†ç»´åº¦è®¡æ•°å™¨ id å¦‚ä½•<a href="https://micrometer.io/docs/registry/jmx#_hierarchical_name_mapping">æ˜ å°„åˆ°å¹³é¢åˆ†å±‚åç§°</a>ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>è¦æ§åˆ¶æ­¤è¡Œä¸ºï¼Œè¯·å®šä¹‰ <code>JmxMeterRegistry</code> å¹¶æä¾›è‡ªå·±çš„ <code>HierarchicalNameMapper</code>ã€‚é™¤éä½ è‡ªå·±å®šä¹‰ï¼Œå¦åˆ™ä½¿ç”¨è‡ªåŠ¨é…ç½®çš„ <code>JmxConfig</code> å’Œ <code>Clock</code> beanï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> JmxMeterRegistry <span class="title function_">jmxMeterRegistry</span><span class="params">(JmxConfig config, Clock clock)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JmxMeterRegistry</span>(config, clock, MY_HIERARCHICAL_MAPPER);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="production-ready-metrics-export-kairos"></a></p><h4 id="57-2-11ã€KairosDB">57.2.11ã€KairosDB</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåº¦é‡å°†å¯¼å‡ºåˆ°æœ¬åœ°çš„ <a href="https://micrometer.io/docs/registry/kairos">KairosDB</a>ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æä¾› <a href="https://kairosdb.github.io/">KairosDB æœåŠ¡å™¨</a>çš„ä½ç½®ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.kairos.uri</span>=https://kairosdb.example.com:<span class="number">8080</span>/api/v1/datapoints</span><br></pre></td></tr></table></figure><p><a id="production-ready-metrics-export-newrelic"></a></p><h4 id="57-2-12ã€New-Relic">57.2.12ã€New Relic</h4><p>New Relic æ³¨å†Œè¡¨å®šæœŸå°†æŒ‡æ ‡æ¨é€åˆ° <a href="https://micrometer.io/docs/registry/new-relic">New Relic</a>ã€‚è¦å°†æŒ‡æ ‡å¯¼å‡ºåˆ° <a href="https://newrelic.com/">New Relic</a>ï¼Œä½ å¿…é¡»æä¾› API å¯†é’¥å’Œå¸æˆ· IDï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.newrelic.api-key</span>=YOUR_KEY</span><br><span class="line"><span class="attr">management.metrics.export.newrelic.account-id</span>=YOUR_ACCOUNT_ID</span><br></pre></td></tr></table></figure><p>ä½ è¿˜å¯ä»¥æ›´æ”¹å°†åº¦é‡å‘é€åˆ° New Relic çš„é—´éš”æ—¶é—´ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.newrelic.step</span>=<span class="number">30</span>s</span><br></pre></td></tr></table></figure><p><a id="production-ready-metrics-export-prometheus"></a></p><h4 id="57-2-13ã€Prometheus">57.2.13ã€Prometheus</h4><p><a href="https://micrometer.io/docs/registry/prometheus">Prometheus</a> å¸Œæœ›æŠ“å–æˆ–è½®è¯¢å„ä¸ªåº”ç”¨å®ä¾‹ä»¥è·å–æŒ‡æ ‡æ•°æ®ã€‚Spring Boot åœ¨ <code>/actuator/prometheus</code> ä¸Šæä¾› actuator ç«¯ç‚¹ï¼Œä»¥é€‚å½“çš„æ ¼å¼å‘ˆç° <a href="https://prometheus.io/">Prometheus scrape </a>ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ç«¯ç‚¹ä¸å¯ç”¨ï¼Œå¿…é¡»æš´éœ²ï¼Œè¯·å‚é˜…<a href="#production-ready-endpoints-exposing-endpoints">æš´éœ²ç«¯ç‚¹</a>ä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p></blockquote><p>ä»¥ä¸‹æ˜¯è¦æ·»åŠ åˆ° <code>prometheus.yml</code> çš„ç¤ºä¾‹ <code>scrape_config</code>ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;spring&#x27;</span></span><br><span class="line"><span class="attr">metrics_path:</span> <span class="string">&#x27;/actuator/prometheus&#x27;</span></span><br><span class="line"><span class="attr">static_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;HOST:PORT&#x27;</span>]</span><br></pre></td></tr></table></figure><p><a id="production-ready-metrics-export-signalfx"></a></p><h4 id="57-2-14ã€SignalFx">57.2.14ã€SignalFx</h4><p>SignalFx æ³¨å†Œè¡¨å®šæœŸå°†æŒ‡æ ‡æ¨é€åˆ° <a href="https://micrometer.io/docs/registry/signalfx">SignalFx</a>ã€‚è¦å°†æŒ‡æ ‡å¯¼å‡ºåˆ° <a href="https://signalfx.com/">SignalFx</a>ï¼Œä½ å¿…é¡»æä¾›è®¿é—®ä»¤ç‰Œï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.signalfx.access-token</span>=YOUR_ACCESS_TOKEN</span><br></pre></td></tr></table></figure><p>ä½ è¿˜å¯ä»¥æ›´æ”¹å°†æŒ‡æ ‡å‘é€åˆ° SignalFx çš„é—´éš”æ—¶é—´ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.signalfx.step</span>=<span class="number">30</span>s</span><br></pre></td></tr></table></figure><p><a id="production-ready-metrics-export-simple"></a></p><h4 id="57-2-15ã€Simple">57.2.15ã€Simple</h4><p>Micrometer é™„å¸¦ä¸€ä¸ªç®€å•çš„å†…å­˜åç«¯ï¼Œå¦‚æœæ²¡æœ‰é…ç½®å…¶ä»–æ³¨å†Œè¡¨ï¼Œå®ƒå°†è‡ªåŠ¨ç”¨ä½œåå¤‡ã€‚è¿™ä½¿ä½ å¯ä»¥æŸ¥çœ‹<a href="#production-ready-metrics-endpoint">æŒ‡æ ‡ç«¯ç‚¹</a>ä¸­æ”¶é›†çš„æŒ‡æ ‡ä¿¡æ¯ã€‚</p><p>åªè¦ä½ ä½¿ç”¨äº†ä»»ä½•å…¶ä»–å¯ç”¨çš„åç«¯ï¼Œå†…å­˜åç«¯å°±ä¼šè‡ªåŠ¨ç¦ç”¨ã€‚ä½ ä¹Ÿå¯ä»¥æ˜¾å¼ç¦ç”¨å®ƒï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.simple.enabled</span>=<span class="literal">false</span></span><br></pre></td></tr></table></figure><p><a id="production-ready-metrics-export-statsd"></a></p><h4 id="57-2-16ã€StatsD">57.2.16ã€StatsD</h4><p>StatsD æ³¨å†Œè¡¨å°† UDP ä¸Šçš„æŒ‡æ ‡æ¨é€åˆ° <a href="https://micrometer.io/docs/registry/statsd">StatsD</a> ä»£ç†ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œåº¦é‡å°†å¯¼å‡ºåˆ°æœ¬åœ°çš„ StatsD ä»£ç†ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æä¾› StatsD ä»£ç†ä¸»æœºå’Œç«¯å£ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.statsd.host</span>=statsd.example.com</span><br><span class="line"><span class="attr">management.metrics.export.statsd.port</span>=<span class="number">9125</span></span><br></pre></td></tr></table></figure><p>ä½ è¿˜å¯ä»¥æ›´æ”¹è¦ä½¿ç”¨çš„ StatsD çº¿è·¯åè®®ï¼ˆé»˜è®¤ä¸º Datadogï¼‰ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.statsd.flavor</span>=etsy</span><br></pre></td></tr></table></figure><p><a id="production-ready-metrics-export-wavefront"></a></p><h4 id="57-2-17ã€Wavefront">57.2.17ã€Wavefront</h4><p>Wavefront æ³¨å†Œè¡¨å®šæœŸå°†æŒ‡æ ‡æ¨é€åˆ° <a href="https://micrometer.io/docs/registry/wavefront">Wavefront</a>ã€‚å¦‚æœè¦å°†æŒ‡æ ‡ç›´æ¥å¯¼å‡ºåˆ° <a href="https://www.wavefront.com/">Wavefront</a>ï¼Œåˆ™ä½ å¿…é¡»æä¾› API ä»¤ç‰Œï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.wavefront.api-token</span>=YOUR_API_TOKEN</span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œä½ å¯ä»¥åœ¨ç¯å¢ƒä¸­ä½¿ç”¨ Wavefront sidecar æˆ–å†…éƒ¨ä»£ç†è®¾ç½®ï¼Œå°†æŒ‡æ ‡æ•°æ®è½¬å‘åˆ° Wavefront API ä¸»æœºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.wavefront.uri</span>=proxy://localhost:<span class="number">2878</span></span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœå°†åº¦é‡å‘å¸ƒåˆ° Wavefront ä»£ç†ï¼ˆå¦‚<a href="https://docs.wavefront.com/proxies_installing.html">æ–‡æ¡£</a>ä¸­æ‰€è¿°ï¼‰ï¼Œåˆ™ä¸»æœºå¿…é¡»é‡‡ç”¨ <code>proxy://HOST:PORT</code> æ ¼å¼ã€‚</p></blockquote><p>ä½ è¿˜å¯ä»¥æ›´æ”¹å°†æŒ‡æ ‡å‘é€åˆ° Wavefront çš„é—´éš”æ—¶é—´ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.export.wavefront.step</span>=<span class="number">30</span>s</span><br></pre></td></tr></table></figure><p><a id="production-ready-metrics-meter"></a></p><h3 id="57-3ã€æ”¯æŒçš„æŒ‡æ ‡">57.3ã€æ”¯æŒçš„æŒ‡æ ‡</h3><p>Spring Boot åœ¨é€‚å½“çš„ç¯å¢ƒæ³¨å†Œä»¥ä¸‹æ ¸å¿ƒæŒ‡æ ‡ï¼š</p><ul><li>JVM æŒ‡æ ‡ï¼ŒæŠ¥å‘Šåˆ©ç”¨ç‡ï¼š<ul><li>å„ç§å†…å­˜å’Œç¼“å†²æ± </li><li>ä¸åƒåœ¾å›æ”¶æœ‰å…³çš„ç»Ÿè®¡</li><li>çº¿ç¨‹åˆ©ç”¨ç‡</li><li>åŠ è½½/å¸è½½ class çš„æ•°é‡</li></ul></li><li>CPU æŒ‡æ ‡</li><li>æ–‡ä»¶æè¿°ç¬¦æŒ‡æ ‡</li><li>Kafka æ¶ˆè´¹è€…æŒ‡æ ‡</li><li>Log4j2 æŒ‡æ ‡ï¼šè®°å½•æ¯ä¸ªçº§åˆ«è®°å½•åˆ° Log4j2 çš„äº‹ä»¶æ•°</li><li>Logback æŒ‡æ ‡ï¼šè®°å½•æ¯ä¸ªçº§åˆ«è®°å½•åˆ° Logback çš„äº‹ä»¶æ•°</li><li>æ­£å¸¸è¿è¡Œæ—¶é—´æŒ‡æ ‡ï¼šæŠ¥å‘Šæ­£å¸¸è¿è¡Œæ—¶é—´å’Œè¡¨ç¤ºåº”ç”¨ç¨‹åºç»å¯¹å¯åŠ¨æ—¶é—´çš„å›ºå®šè®¡é‡å€¼</li><li>Tomcat æŒ‡æ ‡</li><li><a href="https://docs.spring.io/spring-integration/docs/current/reference/html/system-management-chapter.html#micrometer-integration">Spring Integration</a> æŒ‡æ ‡</li></ul><p><a id="production-ready-metrics-spring-mvc"></a></p><h4 id="57-3-1ã€Spring-MVC-æŒ‡æ ‡">57.3.1ã€Spring MVC æŒ‡æ ‡</h4><p>è‡ªåŠ¨é…ç½®å¯ç”¨ Spring MVC å¤„ç†çš„è¯·æ±‚çš„æŒ‡æ ‡è®°å½•ã€‚å½“ <code>management.metrics.web.server.auto-time-requests</code> ä¸º <code>true</code> æ—¶ï¼Œå°†å¯¹æ‰€æœ‰è¯·æ±‚è¿›è¡Œæ­¤æ£€æµ‹ã€‚æˆ–è€…ï¼Œå½“è®¾ç½®ä¸º <code>false</code> æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡å°† <code>@Timed</code> æ·»åŠ åˆ°è¯·æ±‚å¤„ç†æ–¹æ³•æ¥å¯ç”¨æ£€æµ‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Timed</span> <span class="comment">// &lt;1&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyController</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/api/people&quot;)</span></span><br><span class="line"><span class="meta">@Timed(extraTags = &#123; &quot;region&quot;, &quot;us-east-1&quot; &#125;)</span> <span class="comment">// &lt;2&gt;</span></span><br><span class="line"><span class="meta">@Timed(value = &quot;all.people&quot;, longTask = true)</span> <span class="comment">// &lt;3&gt;</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Person&gt; <span class="title function_">listPeople</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ä¸€ä¸ªæ§åˆ¶å™¨ç±»ï¼Œä¸ºæ§åˆ¶å™¨ä¸­çš„æ¯ä¸ªè¯·æ±‚å¤„ç†ç¨‹åºå¯ç”¨è®¡æ—¶ã€‚</li><li>å¯ç”¨å•ä¸ªç«¯ç‚¹ã€‚å¦‚æœä½ åœ¨ç±»ä¸Šä½¿ç”¨äº†å®ƒï¼Œå°±ä¸éœ€è¦åœ¨æ–¹æ³•ä¸Šå†æ¬¡å£°æ˜ï¼Œä½†å¯ä»¥ç”¨å®ƒæ¥è¿›ä¸€æ­¥è‡ªå®šä¹‰è¯¥ç‰¹å®šç«¯ç‚¹çš„è®¡æ—¶å™¨ã€‚</li><li>ä½¿ç”¨ <code>longTask = true</code> çš„æ–¹æ³•ä¸ºè¯¥æ–¹æ³•å¯ç”¨é•¿ä»»åŠ¡è®¡æ—¶å™¨ã€‚é•¿ä»»åŠ¡è®¡æ—¶å™¨éœ€è¦å•ç‹¬çš„æŒ‡æ ‡åç§°ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨çŸ­ä»»åŠ¡è®¡æ—¶å™¨è¿›è¡Œå †å ã€‚</li></ol><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨åç§°ä¸º <code>http.server.requests</code> ç”Ÿæˆåº¦é‡æŒ‡æ ‡ã€‚å¯ä»¥é€šè¿‡è®¾ç½® <code>management.metrics.web.server.requests-metric-name</code> å±æ€§æ¥è‡ªå®šä¹‰åç§°ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring MVC ç›¸å…³æŒ‡æ ‡ä½¿ç”¨äº†ä»¥ä¸‹æ ‡ç­¾æ ‡è®°ï¼š</p><table><thead><tr><th>æ ‡ç­¾</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>exception</code></td><td>å¤„ç†è¯·æ±‚æ—¶æŠ›å‡ºçš„å¼‚å¸¸çš„ç®€å•ç±»åã€‚</td></tr><tr><td><code>method</code></td><td>è¯·æ±‚çš„æ–¹æ³•ï¼ˆä¾‹å¦‚ï¼Œ<code>GET</code> æˆ– <code>POST</code>ï¼‰</td></tr><tr><td><code>outcome</code></td><td>æ ¹æ®å“åº”çŠ¶æ€ç ç”Ÿæˆç»“æœã€‚1xx æ˜¯ <code>INFORMATIONAL</code>ï¼Œ2xx æ˜¯ <code>SUCCESS</code>ï¼Œ3xx æ˜¯ <code>REDIRECTION</code>ï¼Œ4xx æ˜¯ <code>CLIENT_ERROR</code>ï¼Œ5xx æ˜¯ <code>SERVER_ERROR</code></td></tr><tr><td><code>status</code></td><td>å“åº”çš„ HTTP çŠ¶æ€ç ï¼ˆä¾‹å¦‚ï¼Œ<code>200</code> æˆ– <code>500</code>ï¼‰</td></tr><tr><td><code>uri</code></td><td>å¦‚æœå¯èƒ½ï¼Œåœ¨å˜é‡æ›¿æ¢ä¹‹å‰è¯·æ±‚ URI æ¨¡æ¿ï¼ˆä¾‹å¦‚ï¼Œ<code>/api/person/&#123;id&#125;</code>ï¼‰</td></tr></tbody></table><p>è¦è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè¯·æä¾›ä¸€ä¸ªå®ç°äº† <code>WebMvcTagsProvider</code> çš„ <code>@Bean</code>ã€‚</p><p><a id="production-ready-metrics-web-flux"></a></p><h4 id="57-3-2ã€Spring-WebFlux-æŒ‡æ ‡">57.3.2ã€Spring WebFlux æŒ‡æ ‡</h4><p>è‡ªåŠ¨é…ç½®å¯ç”¨äº† WebFlux æ§åˆ¶å™¨å’Œå‡½æ•°å¼å¤„ç†ç¨‹åºå¤„ç†çš„æ‰€æœ‰è¯·æ±‚çš„æŒ‡æ ‡è®°å½•åŠŸèƒ½ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨åä¸º <code>http.server.requests</code> ç”Ÿæˆåº¦é‡æŒ‡æ ‡ã€‚ä½ å¯ä»¥é€šè¿‡è®¾ç½® <code>management.metrics.web.server.requests-metric-name</code> å±æ€§æ¥è‡ªå®šä¹‰åç§°ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ WebFlux ç›¸å…³çš„æŒ‡æ ‡ä½¿ç”¨ä»¥ä¸‹æ ‡ç­¾æ ‡è®°ï¼š</p><table><thead><tr><th>æ ‡ç­¾</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>exception</code></td><td>å¤„ç†è¯·æ±‚æ—¶æŠ›å‡ºçš„å¼‚å¸¸çš„ç®€å•ç±»åã€‚</td></tr><tr><td><code>method</code></td><td>è¯·æ±‚æ–¹æ³•ï¼ˆä¾‹å¦‚ï¼Œ<code>GET</code>æˆ– <code>POST</code>ï¼‰</td></tr><tr><td><code>outcome</code></td><td>æ ¹æ®å“åº”çŠ¶æ€ç ç”Ÿæˆè¯·æ±‚ç»“æœã€‚1xx æ˜¯ <code>INFORMATIONAL</code>ï¼Œ2xx æ˜¯ <code>SUCCESS</code>ï¼Œ3xx æ˜¯ <code>REDIRECTION</code>ï¼Œ4xx æ˜¯ <code>CLIENT_ERROR</code>ï¼Œ5xx æ˜¯ <code>SERVER_ERROR</code></td></tr><tr><td><code>status</code></td><td>å“åº”çš„ HTTP çŠ¶æ€ç ï¼ˆä¾‹å¦‚ï¼Œ<code>200</code> æˆ– <code>500</code>ï¼‰</td></tr><tr><td><code>uri</code></td><td>å¦‚æœå¯èƒ½ï¼Œåœ¨å˜é‡æ›¿æ¢ä¹‹å‰è¯·æ±‚ URI æ¨¡æ¿ï¼ˆä¾‹å¦‚ï¼Œ<code>/api/person/&#123;id&#125;</code>ï¼‰</td></tr></tbody></table><p>è¦è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè¯·æä¾›ä¸€ä¸ªå®ç°äº† <code>WebFluxTagsProvider</code> çš„ <code>@Bean</code>ã€‚</p><p><a id="production-ready-metrics-jersey-server"></a></p><h4 id="57-3-3ã€Jersey-Server-æŒ‡æ ‡">57.3.3ã€Jersey Server æŒ‡æ ‡</h4><p>è‡ªåŠ¨é…ç½®å¯ç”¨äº†ç”± Jersey JAX-RS å®ç°å¤„ç†çš„è¯·æ±‚çš„æŒ‡æ ‡è®°å½•åŠŸèƒ½ã€‚å½“ <code>management.metrics.web.server.auto-time-requests</code> ä¸º <code>true</code> æ—¶ï¼Œå°†å¯¹æ‰€æœ‰è¯·æ±‚è¿›è¡Œè¯¥é¡¹æ£€æµ‹ã€‚å½“è®¾ç½®ä¸º <code>false</code> æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡å°† <code>@Timed</code> æ·»åŠ åˆ°è¯·æ±‚å¤„ç†æ–¹æ³•ä¸Šæ¥å¯ç”¨æ£€æµ‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Path(&quot;/api/people&quot;)</span></span><br><span class="line"><span class="meta">@Timed</span> <span class="comment">// &lt;1&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Endpoint</span> &#123;</span><br><span class="line"><span class="meta">@GET</span></span><br><span class="line"><span class="meta">@Timed(extraTags = &#123; &quot;region&quot;, &quot;us-east-1&quot; &#125;)</span> <span class="comment">// &lt;2&gt;</span></span><br><span class="line"><span class="meta">@Timed(value = &quot;all.people&quot;, longTask = true)</span> <span class="comment">// &lt;3&gt;</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Person&gt; <span class="title function_">listPeople</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>åœ¨èµ„æºç±»ä¸Šï¼Œä¸ºèµ„æºä¸­çš„æ¯ä¸ªè¯·æ±‚å¤„ç†ç¨‹åºå¯ç”¨è®¡æ—¶ã€‚</li><li>åœ¨æ–¹æ³•ä¸Šåˆ™å¯ç”¨å•ä¸ªç«¯ç‚¹ã€‚å¦‚æœä½ åœ¨ç±»ä¸Šä½¿ç”¨äº†å®ƒï¼Œåˆ™ä¸éœ€åœ¨æ–¹æ³•ä¸Šå†æ¬¡å£°æ˜ï¼Œä½†å¯ä»¥ç”¨å®ƒæ¥è¿›ä¸€æ­¥è‡ªå®šä¹‰è¯¥ç‰¹å®šç«¯ç‚¹çš„è®¡æ—¶å™¨ã€‚</li><li>åœ¨æœ‰ <code>longTask = true</code> çš„æ–¹æ³•ä¸Šï¼Œä¸ºè¯¥æ–¹æ³•å¯ç”¨é•¿ä»»åŠ¡è®¡æ—¶å™¨ã€‚é•¿ä»»åŠ¡è®¡æ—¶å™¨éœ€è¦å•ç‹¬çš„åº¦é‡åç§°ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨çŸ­ä»»åŠ¡è®¡æ—¶å™¨è¿›è¡Œå †å ã€‚</li></ol><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨åä¸º <code>http.server.requests</code> ç”Ÿæˆåº¦é‡æŒ‡æ ‡ã€‚å¯ä»¥é€šè¿‡è®¾ç½® <code>management.metrics.web.server.requests-metric-name</code> å±æ€§æ¥è‡ªå®šä¹‰åç§°ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒJersey æœåŠ¡å™¨æŒ‡æ ‡ä½¿ç”¨ä»¥ä¸‹æ ‡ç­¾æ ‡è®°ï¼š</p><table><thead><tr><th>æ ‡ç­¾</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>exception</code></td><td>å¤„ç†è¯·æ±‚æ—¶æŠ›å‡ºçš„å¼‚å¸¸çš„ç®€å•ç±»åã€‚</td></tr><tr><td><code>method</code></td><td>è¯·æ±‚çš„æ–¹æ³•ï¼ˆä¾‹å¦‚ï¼Œ<code>GET</code> æˆ– <code>POST</code>ï¼‰</td></tr><tr><td><code>outcome</code></td><td>æ ¹æ®å“åº”çŠ¶æ€ç ç”Ÿæˆçš„è¯·æ±‚ç»“æœã€‚1xx æ˜¯ <code>INFORMATIONAL</code>ï¼Œ2xx æ˜¯ <code>SUCCESS</code>ï¼Œ3xx æ˜¯ <code>REDIRECTION</code>ï¼Œ4xx æ˜¯ <code>CLIENT_ERROR</code>ï¼Œ5xx æ˜¯ <code>SERVER_ERROR</code></td></tr><tr><td><code>status</code></td><td>å“åº”çš„ HTTP çŠ¶æ€ç ï¼ˆä¾‹å¦‚ï¼Œ<code>200</code>æˆ– <code>500</code>ï¼‰</td></tr><tr><td><code>uri</code></td><td>å¦‚æœå¯èƒ½ï¼Œåœ¨å˜é‡æ›¿æ¢ä¹‹å‰è¯·æ±‚ URI æ¨¡æ¿ï¼ˆä¾‹å¦‚ï¼Œ<code>/api/person/&#123;id&#125;</code>ï¼‰</td></tr></tbody></table><p>è¦è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè¯·æä¾›ä¸€ä¸ªå®ç°äº† <code>JerseyTagsProvider</code> çš„ <code>@Bean</code>ã€‚</p><p><a id="production-ready-metrics-http-clients"></a></p><h4 id="57-3-4ã€HTTP-Client-æŒ‡æ ‡">57.3.4ã€HTTP Client æŒ‡æ ‡</h4><p>Spring Boot Actuator ç®¡ç† RestTemplate å’Œ WebClient çš„æŒ‡æ ‡è®°å½•ã€‚ä¸ºæ­¤ï¼Œä½ å¿…é¡»æ³¨å…¥ä¸€ä¸ªè‡ªåŠ¨é…ç½®çš„ builder å¹¶ä½¿ç”¨å®ƒæ¥åˆ›å»ºå®ä¾‹ï¼š</p><ul><li><code>RestTemplateBuilder</code> ç”¨äº <code>RestTemplate</code></li><li><code>WebClient.Builder</code> ç”¨äº <code>WebClient</code></li></ul><p>ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šè´Ÿè´£æ­¤æŒ‡æ ‡è®°å½•çš„è‡ªå®šä¹‰ç¨‹åºï¼Œå³ <code>MetricsRestTemplateCustomizer</code> å’Œ <code>MetricsWebClientCustomizer</code>ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨åä¸º <code>http.client.requests</code> ç”Ÿæˆåº¦é‡æŒ‡æ ‡ã€‚å¯ä»¥é€šè¿‡è®¾ç½® <code>management.metrics.web.client.requests-metric-name</code> å±æ€§æ¥è‡ªå®šä¹‰åç§°ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå·²æŒ‡æ ‡è®°å½•å®¢æˆ·ç«¯ç”Ÿæˆçš„åº¦é‡æŒ‡æ ‡ä½¿ç”¨ä»¥ä¸‹æ ‡ç­¾æ ‡è®°ï¼š</p><ul><li><code>method</code>ï¼Œè¯·æ±‚çš„æ–¹æ³•ï¼ˆä¾‹å¦‚ï¼Œ<code>GET</code>æˆ– <code>POST</code>ï¼‰ã€‚</li><li><code>uri</code>ï¼Œå˜é‡æ›¿æ¢ä¹‹å‰çš„è¯·æ±‚ URI æ¨¡æ¿ï¼ˆå¦‚æœå¯èƒ½ï¼‰ï¼ˆä¾‹å¦‚ï¼Œ<code>/api/person/&#123;id&#125;</code>ï¼‰ã€‚</li><li><code>status</code>ï¼Œå“åº”çš„ HTTP çŠ¶æ€ç ï¼ˆä¾‹å¦‚ï¼Œ<code>200</code> æˆ– <code>500</code>ï¼‰ã€‚</li><li><code>clientName</code>ï¼ŒURI çš„ä¸»æœºéƒ¨åˆ† ã€‚</li></ul><p>è¦æ ¹æ®ä½ é€‰æ‹©çš„å®¢æˆ·ç«¯è‡ªå®šä¹‰æ ‡ç­¾ï¼Œä½ å¯ä»¥æä¾›ä¸€ä¸ªå®ç°äº† <code>RestTemplateExchangeTagsProvider</code> æˆ– <code>WebClientExchangeTagsProvider</code> çš„ <code>@Bean</code>ã€‚<code>RestTemplateExchangeTags</code> å’Œ <code>WebClientExchangeTags</code> ä¸­æœ‰ä¾¿æ·çš„é™æ€å‡½æ•°ã€‚</p><p><a id="production-ready-metrics-cache"></a></p><h4 id="57-3-5ã€Cache-æŒ‡æ ‡">57.3.5ã€Cache æŒ‡æ ‡</h4><p>åœ¨å¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨é…ç½®å¯åŠ¨æ‰€æœ‰å¯ç”¨ <code>Cache</code> çš„æŒ‡æ ‡è®°å½•åŠŸèƒ½ï¼ŒæŒ‡æ ‡ä»¥ <code>cache</code> ä¸ºå‰ç¼€ã€‚ç¼“å­˜æŒ‡æ ‡è®°å½•é’ˆå¯¹ä¸€ç»„åŸºæœ¬æŒ‡æ ‡è¿›è¡Œäº†æ ‡å‡†åŒ–ã€‚æ­¤å¤–ï¼Œè¿˜æä¾›äº†ç¼“å­˜ç‰¹å®šçš„æŒ‡æ ‡ã€‚</p><p>æ”¯æŒä»¥ä¸‹ç¼“å­˜åº“ï¼š</p><ul><li>Caffeine</li><li>EhCache 2</li><li>Hazelcast</li><li>æ‰€æœ‰å…¼å®¹ JCacheï¼ˆJSR-107ï¼‰çš„å®ç°</li></ul><p>åº¦é‡æŒ‡æ ‡ç”±ç¼“å­˜çš„åç§°å’Œä» bean åç§°æ´¾ç”Ÿçš„ <code>CacheManager</code> çš„åç§°æ ‡è®°ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>åªæœ‰å¯åŠ¨æ—¶å¯ç”¨çš„ç¼“å­˜æ‰ä¼šç»‘å®šåˆ°æ³¨å†Œè¡¨ã€‚å¯¹äºåœ¨å¯åŠ¨é˜¶æ®µä¹‹åå³æ—¶æˆ–ä»¥ç¼–ç¨‹æ–¹å¼åˆ›å»ºçš„ç¼“å­˜ï¼Œéœ€è¦æ˜¾å¼æ³¨å†Œã€‚å¯ç”¨ <code>CacheMetricsRegistrar</code> bean ç®€åŒ–è¯¥è¿‡ç¨‹ã€‚</p></blockquote><p><a id="production-ready-metrics-jdbc"></a></p><h4 id="57-3-6ã€æ•°æ®æºæŒ‡æ ‡">57.3.6ã€æ•°æ®æºæŒ‡æ ‡</h4><p>è‡ªåŠ¨é…ç½®å¯ç”¨å¯¹æ‰€æœ‰å¯ç”¨ <code>DataSource</code> å¯¹è±¡è¿›è¡ŒæŒ‡æ ‡è®°å½•åŠŸèƒ½ï¼ŒæŒ‡æ ‡çš„åç§°ä¸º <code>jdbc</code>ã€‚æ•°æ®æºæŒ‡æ ‡è®°å½•ä¼šç”Ÿæˆè¡¨ç¤ºæ± ä¸­å½“å‰æ´»åŠ¨ã€å¤§å…è®¸å’Œæœ€å°å…è®¸è¿æ¥çš„è®¡é‡å™¨ï¼ˆgaugeï¼‰ã€‚è¿™äº›è®¡é‡å™¨éƒ½æœ‰ä¸€ä¸ªä»¥ <code>jdbc</code> ä¸ºå‰ç¼€çš„åç§°ã€‚</p><p>åº¦é‡æŒ‡æ ‡ä¹Ÿç”±åŸºäº bean åç§°è®¡ç®—çš„ <code>DataSource</code> çš„åç§°æ ‡è®°ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot ä¸ºæ‰€æœ‰æ”¯æŒçš„æ•°æ®æºæä¾›äº†å…ƒæ•°æ®ã€‚å¦‚æœå¼€ç®±å³ç”¨ä¸æ”¯æŒä½ å–œæ¬¢çš„æ•°æ®æºï¼Œåˆ™å¯ä»¥æ·»åŠ å…¶ä»– <code>DataSourcePoolMetadataProvider</code> beanã€‚æœ‰å…³ç¤ºä¾‹ï¼Œè¯·å‚é˜… <code>DataSourcePoolMetadataProvidersConfiguration</code>ã€‚</p></blockquote><p>æ­¤å¤–ï¼ŒHikari ç‰¹å®šçš„æŒ‡æ ‡ç”¨ <code>hikaricp</code> å‰ç¼€æš´éœ²ã€‚æ¯ä¸ªåº¦é‡æŒ‡æ ‡éƒ½ç”±æ± åç§°æ ‡è®°ï¼ˆå¯ä»¥ä½¿ç”¨ <code>spring.datasource.name</code> æ§åˆ¶ï¼‰ã€‚</p><p><a id="production-ready-metrics-hibernate"></a></p><h4 id="57-3-7ã€Hibernate-æŒ‡æ ‡">57.3.7ã€Hibernate æŒ‡æ ‡</h4><p>è‡ªåŠ¨é…ç½®å¯ç”¨æ‰€æœ‰å¯ç”¨ Hibernate <code>EntityManagerFactory</code> å®ä¾‹çš„æŒ‡æ ‡è®°å½•åŠŸèƒ½ï¼Œè¿™äº›å®ä¾‹ä½¿ç”¨åä¸º <code>hibernate</code> çš„åº¦é‡æŒ‡æ ‡ç»Ÿè®¡ä¿¡æ¯ã€‚</p><p>åº¦é‡æŒ‡æ ‡ä¹Ÿç”±ä» bean åç§°æ´¾ç”Ÿçš„ <code>EntityManagerFactory</code> çš„åç§°æ ‡è®°ã€‚</p><p>è¦å¯ç”¨ä¿¡æ¯ç»Ÿè®¡ï¼Œå¿…é¡»å°†æ ‡å‡† JPA å±æ€§ <code>hibernate.generate_statistics</code> è®¾ç½®ä¸º <code>true</code>ã€‚ä½ å¯ä»¥åœ¨è‡ªåŠ¨é…ç½®çš„ <code>EntityManagerFactory</code> ä¸Šå¯ç”¨å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.jpa.properties.hibernate.generate_statistics</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p><a id="production-ready-metrics-rabbitmq"></a></p><h4 id="57-3-8ã€RabbitMQ-æŒ‡æ ‡">57.3.8ã€RabbitMQ æŒ‡æ ‡</h4><p>è‡ªåŠ¨é…ç½®å°†ä½¿ç”¨åä¸º <code>rabbitmq</code> çš„åº¦é‡æŒ‡æ ‡å¯ç”¨å¯¹æ‰€æœ‰å¯ç”¨ RabbitMQ è¿æ¥å·¥å‚è¿›è¡ŒæŒ‡æ ‡è®°å½•ã€‚</p><p><a id="production-ready-metrics-custom"></a></p><h3 id="57-4ã€æ³¨å†Œè‡ªå®šä¹‰æŒ‡æ ‡">57.4ã€æ³¨å†Œè‡ªå®šä¹‰æŒ‡æ ‡</h3><p>è¦æ³¨å†Œè‡ªå®šä¹‰æŒ‡æ ‡ï¼Œè¯·å°† <code>MeterRegistry</code> æ³¨å…¥ä½ çš„ç»„ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dictionary</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> List&lt;String&gt; words = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">Dictionary(MeterRegistry registry) &#123;</span><br><span class="line">registry.gaugeCollectionSize(<span class="string">&quot;dictionary.size&quot;</span>, Tags.empty(), <span class="built_in">this</span>.words);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// â€¦</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ å‘ç°è·¨ç»„ä»¶æˆ–åº”ç”¨ç¨‹åºé‡å¤è®°å½•ä¸€å¥—åº¦é‡æŒ‡æ ‡ï¼Œåˆ™å¯ä»¥å°†æ­¤å¥—ä»¶å°è£…åœ¨ <code>MeterBinder</code> å®ç°ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ <code>MeterBinder</code> bean çš„æŒ‡æ ‡éƒ½å°†è‡ªåŠ¨ç»‘å®šåˆ° Spring ç®¡ç†çš„ <code>MeterRegistry</code>ã€‚</p><p><a id="production-ready-metrics-per-meter-properties"></a></p><h3 id="57-5ã€è‡ªå®šä¹‰å•ç‹¬æŒ‡æ ‡">57.5ã€è‡ªå®šä¹‰å•ç‹¬æŒ‡æ ‡</h3><p>å¦‚æœéœ€è¦å°†è‡ªå®šä¹‰ç‰¹å®šçš„ <code>Meter</code> å®ä¾‹ï¼Œå¯ä»¥ä½¿ç”¨ <code>io.micrometer.core.instrument.config.MeterFilter</code> æ¥å£ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ <code>MeterFilter</code> bean éƒ½å°†è‡ªåŠ¨åº”ç”¨äº <code>MeterRegistry.Config</code>ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœè¦å°† <code>mytag.region</code> æ ‡è®°é‡å‘½åä¸º <code>mytag.area</code> ä»¥è·å–ä»¥ <code>com.example</code> å¼€å¤´çš„æ‰€æœ‰ meter IDï¼Œåˆ™å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MeterFilter <span class="title function_">renameRegionTagMeterFilter</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> MeterFilter.renameTag(<span class="string">&quot;com.example&quot;</span>, <span class="string">&quot;mytag.region&quot;</span>, <span class="string">&quot;mytag.area&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="production-ready-metrics-common-tags"></a></p><h4 id="57-5-1ã€è‡ªå®šä¹‰æ ‡ç­¾">57.5.1ã€è‡ªå®šä¹‰æ ‡ç­¾</h4><p>é€šç”¨æ ‡ç­¾é€šå¸¸ç”¨äºæ“ä½œç¯å¢ƒä¸­çš„ç»´åº¦ä¸‹é’»ï¼Œä¾‹å¦‚ä¸»æœºã€å®ä¾‹ã€åŒºåŸŸã€å †æ ˆç­‰ã€‚é€šç”¨æ ‡ç­¾åº”ç”¨äºæ‰€æœ‰ meterï¼Œå¹¶ä¸”å¯ä»¥æŒ‰ç…§ä»¥ä¸‹ç¤ºä¾‹è¿›è¡Œé…ç½®ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.tags.region</span>=us-east-<span class="number">1</span></span><br><span class="line"><span class="attr">management.metrics.tags.stack</span>=prod</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç¤ºä¾‹å°† <code>region</code> å’Œ <code>stack</code> æ ‡ç­¾æ·»åŠ åˆ°æ‰€æœ‰ meter ä¸­ï¼Œå…¶å€¼åˆ†åˆ«ä¸º <code>us-east-1</code> å’Œ <code>prod</code>ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœä½ ä½¿ç”¨ Graphiteï¼Œé‚£ä¹ˆæ ‡ç­¾çš„é¡ºåºå¾ˆé‡è¦ã€‚ç”±äºä½¿ç”¨æ­¤æ–¹æ³•æ— æ³•ä¿è¯é€šç”¨æ ‡ç­¾çš„é¡ºåºï¼Œå› æ­¤å»ºè®® Graphite ç”¨æˆ·å®šä¹‰è‡ªå®šä¹‰ <code>MeterFilter</code>ã€‚</p></blockquote><p><a id="_per_meter_properties"></a></p><h4 id="57-5-2ã€Per-meter-å±æ€§">57.5.2ã€Per-meter å±æ€§</h4><p>é™¤äº† <code>MeterFilter</code> bean ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ properties åœ¨ per-meter åŸºç¡€ä¸Šè‡ªå®šä¹‰ã€‚Per-meter å®šä¹‰é€‚ç”¨äºä»¥ç»™å®šåç§°å¼€å¤´çš„æ‰€æœ‰ meter IDã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å°†ç¦ç”¨ä»»ä½•ä»¥ <code>example.remote</code> å¼€å¤´çš„ ID çš„ meterï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.metrics.enable.example.remote</span>=<span class="literal">false</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹å±æ€§å…è®¸ per-meter è‡ªå®šä¹‰ï¼š</p><p><strong>è¡¨ 57.1ã€Per-meter è‡ªå®šä¹‰</strong></p><p>| å±æ€§ | æè¿° |<br>| <code>management.metrics.enable</code> | æ˜¯å¦æ‹’ç» meter å‘å¸ƒä»»ä½•æŒ‡æ ‡ã€‚ |<br>| <code>management.metrics.distribution.percentiles-histogram</code> | æ˜¯å¦å‘å¸ƒä¸€ä¸ªé€‚ç”¨äºè®¡ç®—å¯èšåˆï¼ˆè·¨ç»´åº¦ï¼‰çš„ç™¾åˆ†æ¯”è¿‘ä¼¼æŸ±çŠ¶å›¾ã€‚ |<br>| <code>management.metrics.distribution.minimum-expected-value</code>ï¼Œ<br/> <code>management.metrics.distribution.maximum-expected-value</code>| é€šè¿‡é™åˆ¶é¢„æœŸå€¼çš„èŒƒå›´æ¥å‘å¸ƒè¾ƒå°‘çš„æŸ±çŠ¶å›¾æ¡¶ã€‚ |<br>| <code>management.metrics.distribution.percentiles</code> | å‘å¸ƒåœ¨ä½ è‡ªå·±çš„åº”ç”¨ç¨‹åºä¸­è®¡ç®—çš„ç™¾åˆ†æ¯”æ•°å€¼ |<br>| <code>management.metrics.distribution.sla</code> | å‘ä¸€ä¸ªä½¿ç”¨ SLA å®šä¹‰çš„å­˜å‚¨æ¡¶å‘å¸ƒç´¯ç§¯æŸ±çŠ¶å›¾ã€‚ |</p><p>æœ‰å…³ <code>percentiles-histogram</code>ã€<code>percentiles</code> å’Œ <code>sla</code> æ¦‚å¿µçš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ã€Œ<a href="https://micrometer.io/docs/concepts#_histograms_and_percentiles">æŸ±çŠ¶å›¾ä¸ç™¾åˆ†ä½æ•°</a>ã€éƒ¨åˆ†çš„æ–‡æ¡£ã€‚</p><p><a id="production-ready-metrics-endpoint"></a></p><h3 id="57-6ã€æŒ‡æ ‡ç«¯ç‚¹">57.6ã€æŒ‡æ ‡ç«¯ç‚¹</h3><p>Spring Boot æä¾›äº†ä¸€ä¸ª <code>metrics</code> ç«¯ç‚¹ï¼Œå¯ä»¥åœ¨è¯Šæ–­ä¸­ç”¨äºæ£€æŸ¥åº”ç”¨ç¨‹åºæ”¶é›†çš„åº¦é‡æŒ‡æ ‡ã€‚é»˜è®¤æƒ…å†µä¸‹ç«¯ç‚¹ä¸å¯ç”¨ï¼Œå¿…é¡»æ‰‹åŠ¨æš´éœ²ï¼Œè¯·å‚é˜…<a href="#production-ready-endpoints-exposing-endpoints">æš´éœ²ç«¯ç‚¹</a>ä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p><p>è®¿é—® <code>/actuator/metrics</code> ä¼šæ˜¾ç¤ºå¯ç”¨çš„ meter åç§°åˆ—è¡¨ã€‚ä½ å¯ä»¥æŸ¥çœ‹æŸä¸€ä¸ª meter çš„ä¿¡æ¯ï¼Œæ–¹æ³•æ˜¯å°†å…¶åç§°ä½œä¸ºé€‰æ‹©å™¨ï¼Œä¾‹å¦‚ï¼Œ<code>/actuator/metrics/jvm.memory.max</code>ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>ä½ åœ¨æ­¤å¤„ä½¿ç”¨çš„åç§°åº”ä¸ä»£ç ä¸­ä½¿ç”¨çš„åç§°ç›¸åŒ¹é…ï¼Œè€Œä¸æ˜¯åœ¨å‘½åçº¦å®šè§„èŒƒåŒ–åçš„åç§° â€”â€” ä¸ºäº†å‘é€åˆ°ç›‘æ§ç³»ç»Ÿã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœ <code>jvm.memory.max</code> ç”±äº Prometheus å‘½åçº¦å®šè€Œæ˜¾ç¤ºä¸º <code>jvm_memory_max</code>ï¼Œåˆ™åœ¨å®¡æŸ¥åº¦é‡æŒ‡æ ‡ç«¯ç‚¹ä¸­çš„ meter æ—¶ï¼Œåº”ä»ä½¿ç”¨ <code>jvm.memory.max</code> ä½œä¸ºé€‰æ‹©å™¨ã€‚</p></blockquote><p>ä½ è¿˜å¯ä»¥åœ¨ URL çš„æœ«å°¾æ·»åŠ ä»»æ„æ•°é‡çš„ <code>tag=KEY:VALUE</code> æŸ¥è¯¢å‚æ•°ï¼Œä»¥ä¾¿å¤šç»´åº¦å‘ä¸‹é’»å– meterï¼Œä¾‹å¦‚ <code>/actuator/metrics/jvm.memory.max?tag=area:nonheap</code>ã€‚</p><p><strong>æç¤º</strong></p><p>æŠ¥å‘Šçš„æµ‹é‡å€¼æ˜¯ä¸ meter åç§°å’Œå·²åº”ç”¨çš„ä»»ä½•æ ‡ç­¾åŒ¹é…çš„æ‰€æœ‰ meter çš„ç»Ÿè®¡æ•°æ®çš„æ€»å’Œã€‚å› æ­¤ï¼Œåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œè¿”å›çš„ Value ç»Ÿè®¡ä¿¡æ¯æ˜¯å †çš„ Code Cacheï¼ŒCompressed Class Space å’Œ Metaspace åŒºåŸŸçš„æœ€å¤§å†…å­˜å ç”¨é‡çš„æ€»å’Œã€‚å¦‚æœä½ åªæƒ³æŸ¥çœ‹ Metaspace çš„æœ€å¤§å¤§å°ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªé¢å¤–çš„ <code>tag=id:Metaspace</code>ï¼Œå³ <code>/actuator/metrics/jvm.memory.max?tag=area:nonheap&amp;tag=id:Metaspace</code>ã€‚</p><p><a id="production-ready-auditing"></a></p><h2 id="58ã€å®¡è®¡">58ã€å®¡è®¡</h2><p>ä¸€æ—¦ Spring Security ç”Ÿæ•ˆï¼ŒSpring Boot Actuator å°±æ‹¥æœ‰ä¸€ä¸ªçµæ´»çš„å®¡è®¡æ¡†æ¶ï¼Œå®ƒå¯ä»¥å‘å¸ƒäº‹ä»¶ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>authentication success</code>ã€<code>failure</code> å’Œ <code>access denied</code> ä¾‹å¤–ï¼‰ã€‚æ­¤åŠŸèƒ½å¯¹äº‹ä»¶æŠ¥å‘Šå’ŒåŸºäºèº«ä»½éªŒè¯å¤±è´¥å®ç°ä¸€ä¸ªé”å®šç­–ç•¥éå¸¸æœ‰ç”¨ã€‚è¦è‡ªå®šä¹‰å‘å¸ƒçš„å®‰å…¨äº‹ä»¶ï¼Œä½ å¯ä»¥æä¾›è‡ªå·±çš„ <code>AbstractAuthenticationAuditListener</code> å’Œ <code>AbstractAuthorizationAuditListener</code> å®ç°ã€‚</p><p>ä½ è¿˜å¯ä»¥å°†å®¡è®¡æœåŠ¡ç”¨äºè‡ªå·±çš„ä¸šåŠ¡äº‹ä»¶ã€‚ä¸ºæ­¤ï¼Œè¯·å°†ç°æœ‰çš„ <code>AuditEventRepository</code> æ³¨å…¥è‡ªå·±çš„ç»„ä»¶å¹¶ç›´æ¥ä½¿ç”¨å®ƒæˆ–ä½¿ç”¨ Spring <code>ApplicationEventPublisher</code>ï¼ˆé€šè¿‡å®ç° <code>ApplicationEventPublisherAware</code>ï¼‰å‘å¸ƒ <code>AuditApplicationEvent</code>ã€‚</p><p><a id="production-ready-http-tracing"></a></p><h2 id="59ã€HTTP-è¿½è¸ª">59ã€HTTP è¿½è¸ª</h2><p>æ‰€æœ‰ HTTP è¯·æ±‚å°†è‡ªåŠ¨å¯ç”¨è¿½è¸ªåŠŸèƒ½ã€‚ä½ å¯ä»¥é€šè¿‡æŸ¥çœ‹ <code>httptrace</code> ç«¯ç‚¹æ¥è·å–æœ€è¿‘ç›¸å…³çš„ 100 ä¸ªè¯·æ±‚å“åº”ä¿¡æ¯ã€‚</p><p><a id="production-ready-http-tracing-custom"></a></p><h3 id="59-1ã€è‡ªå®šä¹‰-HTTP-è¿½è¸ª">59.1ã€è‡ªå®šä¹‰ HTTP è¿½è¸ª</h3><p>è¦è‡ªå®šä¹‰æ¯ä¸ªè¿½è¸ªä¿¡æ¯ä¸­åŒ…å«çš„é¡¹ï¼Œè¯·ä½¿ç”¨ <code>management.trace.http.include</code> å±æ€§é…ç½®ã€‚å¯¹äºé«˜çº§è‡ªå®šä¹‰ï¼Œè¯·è€ƒè™‘æ³¨å†Œè‡ªå·±çš„ <code>HttpExchangeTracer</code> å®ç°ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä¸€ä¸ª <code>InMemoryHttpTraceRepository</code> å­˜å‚¨æœ€æ–°çš„ 100 ä¸ªè¯·æ±‚å“åº”ä¿¡æ¯ã€‚å¦‚æœéœ€è¦æ‰©å±•å®¹é‡ï¼Œå¯å®šä¹‰è‡ªå·±çš„ <code>InMemoryHttpTraceRepository</code> bean å®ä¾‹ã€‚ä½ è¿˜å¯ä»¥åˆ›å»ºè‡ªå·±çš„ <code>HttpTraceRepository</code> å®ç°æ¥æ›¿ä»£é»˜è®¤é…ç½®ã€‚</p><p><a id="production-ready-process-monitoring"></a></p><h2 id="60ã€è¿›ç¨‹ç›‘æ§">60ã€è¿›ç¨‹ç›‘æ§</h2><p>åœ¨ <code>spring-boot</code> æ¨¡å—ä¸­ï¼Œä½ å¯ä»¥æ‰¾åˆ°ä¸¤ä¸ªç±»æ¥åˆ›å»ºæ–‡ä»¶ï¼Œä»–ä»¬é€šå¸¸ç”¨äºè¿›ç¨‹ç›‘æ§ï¼š</p><ul><li><code>ApplicationPidFileWriter</code> åˆ›å»ºä¸€ä¸ªåŒ…å«åº”ç”¨ç¨‹åº PID çš„æ–‡ä»¶ï¼ˆé»˜è®¤åœ¨åº”ç”¨ç¨‹åºç›®å½•ä¸­ï¼Œæ–‡ä»¶åä¸º <code>application.pid</code>ï¼‰ã€‚</li><li><code>WebServerPortFileWriter</code> åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ï¼Œå…¶åŒ…å«æ­£åœ¨è¿è¡Œçš„ Web æœåŠ¡å™¨çš„ç«¯å£ï¼ˆé»˜è®¤åœ¨åº”ç”¨ç¨‹åºç›®å½•ä¸­ï¼Œæ–‡ä»¶åä¸º <code>application.port</code>ï¼‰ã€‚</li></ul><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº› writer æœªæ¿€æ´»ï¼Œä½†ä½ å¯ä»¥å¯ç”¨ï¼š</p><ul><li><a href="#production-ready-process-monitoring-configuration">æ‰©å±•é…ç½®</a></li><li><a href="#production-ready-process-monitoring-programmatically">ç¬¬ 60.2 èŠ‚ã€ç¼–ç¨‹æ–¹å¼</a></li></ul><p><a id="production-ready-process-monitoring-configuration"></a></p><h3 id="60-1ã€æ‰©å±•é…ç½®">60.1ã€æ‰©å±•é…ç½®</h3><p>ä½ å¯ä»¥åœ¨ <code>META-INF/spring.factories</code> æ–‡ä»¶ä¸­æ¿€æ´»ç”Ÿæˆå’Œå†™å…¥ PID æ–‡ä»¶çš„ç›‘å¬å™¨ï¼ˆListenerï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org<span class="selector-class">.springframework</span><span class="selector-class">.context</span>.ApplicationListener=\</span><br><span class="line">org<span class="selector-class">.springframework</span><span class="selector-class">.boot</span><span class="selector-class">.context</span><span class="selector-class">.ApplicationPidFileWriter</span>,\</span><br><span class="line">org<span class="selector-class">.springframework</span><span class="selector-class">.boot</span><span class="selector-class">.web</span><span class="selector-class">.context</span>.WebServerPortFileWriter</span><br></pre></td></tr></table></figure><p><a id="production-ready-process-monitoring-configuration"></a></p><h3 id="60-2ã€ç¼–ç¨‹æ–¹å¼">60.2ã€ç¼–ç¨‹æ–¹å¼</h3><p>ä½ è¿˜å¯ä»¥é€šè¿‡è°ƒç”¨ <code>SpringApplication.addListeners(...)</code> æ–¹æ³•å¹¶ä¼ é€’ç›¸åº”çš„ <code>Writer</code> å¯¹è±¡æ¥æ¿€æ´»ç›‘å¬å™¨ã€‚æ­¤æ–¹æ³•è¿˜å…è®¸ä½ åœ¨ <code>Writer</code> æ„é€ æ–¹æ³•ä¸­è‡ªå®šä¹‰æ–‡ä»¶åå’Œè·¯å¾„ã€‚</p><p><a id="production-ready-cloudfoundry"></a></p><h2 id="61ã€Cloud-Foundry-æ”¯æŒ">61ã€Cloud Foundry æ”¯æŒ</h2><p>å½“ä½ éƒ¨ç½²åˆ°ä¸€ä¸ªå…¼å®¹ Cloud Foundry çš„å®ä¾‹æ—¶ï¼ŒSpring Boot çš„ Actuator æ¨¡å—åŒ…å«çš„å…¶ä»–æ”¯æŒå°†è¢«æ¿€æ´»ã€‚<code>/cloudfoundryapplication</code> è·¯å¾„ä¸ºæ‰€æœ‰ <code>@Endpoint</code> bean æä¾›äº†å¦å¤–ä¸€ä¸ªå®‰å…¨è·¯ç”±ã€‚</p><p>è¯¥æ‰©å±•æ”¯æŒå…è®¸ä½¿ç”¨ Spring Boot Actuator ä¿¡æ¯æ‰©å…… Cloud Foundry ç®¡ç† UIï¼ˆä¾‹å¦‚å¯ç”¨äºæŸ¥çœ‹å·²éƒ¨ç½²åº”ç”¨çš„ Web åº”ç”¨ï¼‰ã€‚æ¯”å¦‚ï¼Œåº”ç”¨ç¨‹åºçŠ¶æ€é¡µé¢å¯ä»¥åŒ…æ‹¬å®Œæ•´çš„å¥åº·ä¿¡æ¯è€Œä¸æ˜¯å¸¸è§çš„ running æˆ– stop çŠ¶æ€ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>å¸¸è§„ç”¨æˆ·æ— æ³•ç›´æ¥è®¿é—® <code>/cloudfoundryapplication</code> è·¯å¾„ã€‚ä¸ºäº†èƒ½è®¿é—®ç«¯ç‚¹ï¼Œä½ å¿…é¡»åœ¨è¯·æ±‚æ—¶ä¼ é€’ä¸€ä¸ªæœ‰æ•ˆçš„ UAA ä»¤ç‰Œã€‚</p></blockquote><p><a id="production-ready-cloudfoundry-disable"></a></p><h3 id="61-1ã€ç¦ç”¨-Cloud-Foundry-Actuator-æ‰©å±•æ”¯æŒ">61.1ã€ç¦ç”¨ Cloud Foundry Actuator æ‰©å±•æ”¯æŒ</h3><p>å¦‚æœè¦å®Œå…¨ç¦ç”¨ <code>/cloudfoundryapplication</code> ç«¯ç‚¹ï¼Œå¯ä»¥å°†ä»¥ä¸‹è®¾ç½®æ·»åŠ åˆ° <code>application.properties</code> æ–‡ä»¶ä¸­ï¼š</p><p><strong>application.properties</strong></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.cloudfoundry.enabled</span>=<span class="literal">false</span></span><br></pre></td></tr></table></figure><p><a id="production-ready-cloudfoundry-ssl"></a></p><h3 id="61-2ã€Cloud-Foundry-è‡ªç­¾åè¯ä¹¦">61.2ã€Cloud Foundry è‡ªç­¾åè¯ä¹¦</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>/cloudfoundryapplication</code> ç«¯ç‚¹çš„å®‰å…¨éªŒè¯ä¼šå¯¹å„ç§ Cloud Foundry æœåŠ¡è¿›è¡Œ SSL è°ƒç”¨ã€‚å¦‚æœä½ çš„ Cloud Foundry UAA æˆ– Cloud Controller æœåŠ¡ä½¿ç”¨è‡ªç­¾åè¯ä¹¦ï¼Œåˆ™éœ€è¦è®¾ç½®ä»¥ä¸‹å±æ€§ï¼š</p><p><strong>application.properties</strong></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management.cloudfoundry.skip-ssl-validation</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p><a id="_custom_context_path"></a></p><h3 id="61-3ã€è‡ªå®šä¹‰ä¸Šä¸‹æ–‡è·¯å¾„">61.3ã€è‡ªå®šä¹‰ä¸Šä¸‹æ–‡è·¯å¾„</h3><p>å¦‚æœæœåŠ¡å™¨çš„ context-path å·²é…ç½®ä¸º <code>/</code> ä»¥å¤–çš„å…¶ä»–å†…å®¹ï¼Œåˆ™ Cloud Foundry ç«¯ç‚¹å°†æ— æ³•åœ¨åº”ç”¨ç¨‹åºçš„æ ¹ç›®å½•ä¸­ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ <code>server.servlet.context-path=/app</code>ï¼ŒCloud Foundry ç«¯ç‚¹å°†åœ¨ <code>/app/cloudfoundryapplication/*</code> ä¸Šå¯ç”¨ã€‚</p><p>å¦‚æœä½ å¸Œæœ› Cloud Foundry ç«¯ç‚¹å§‹ç»ˆåœ¨ <code>/cloudfoundryapplication/*</code> ä¸Šå¯ç”¨ï¼Œåˆ™æ— è®ºæœåŠ¡å™¨çš„ context-path å¦‚ä½•ï¼Œä½ éƒ½éœ€è¦åœ¨åº”ç”¨ç¨‹åºä¸­æ˜ç¡®é…ç½®å®ƒã€‚é…ç½®å› ä½¿ç”¨çš„ Web æœåŠ¡å™¨è€Œæœ‰æ‰€ä¸åŒã€‚é’ˆå¯¹ Tomcatï¼Œå¯ä»¥æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> TomcatServletWebServerFactory <span class="title function_">servletWebServerFactory</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TomcatServletWebServerFactory</span>() &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">prepareContext</span><span class="params">(Host host,</span></span><br><span class="line"><span class="params">ServletContextInitializer[] initializers)</span> &#123;</span><br><span class="line"><span class="built_in">super</span>.prepareContext(host, initializers);</span><br><span class="line"><span class="type">StandardContext</span> <span class="variable">child</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardContext</span>();</span><br><span class="line">child.addLifecycleListener(<span class="keyword">new</span> <span class="title class_">Tomcat</span>.FixContextListener());</span><br><span class="line">child.setPath(<span class="string">&quot;/cloudfoundryapplication&quot;</span>);</span><br><span class="line"><span class="type">ServletContainerInitializer</span> <span class="variable">initializer</span> <span class="operator">=</span> getServletContextInitializer(</span><br><span class="line">getContextPath());</span><br><span class="line">child.addServletContainerInitializer(initializer, Collections.emptySet());</span><br><span class="line">child.setCrossContext(<span class="literal">true</span>);</span><br><span class="line">host.addChild(child);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> ServletContainerInitializer <span class="title function_">getServletContextInitializer</span><span class="params">(String contextPath)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> (c, context) -&gt; &#123;</span><br><span class="line"><span class="type">Servlet</span> <span class="variable">servlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericServlet</span>() &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(ServletRequest req, ServletResponse res)</span></span><br><span class="line"><span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"><span class="type">ServletContext</span> <span class="variable">context</span> <span class="operator">=</span> req.getServletContext()</span><br><span class="line">.getContext(contextPath);</span><br><span class="line">context.getRequestDispatcher(<span class="string">&quot;/cloudfoundryapplication&quot;</span>).forward(req,</span><br><span class="line">res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line">context.addServlet(<span class="string">&quot;cloudfoundry&quot;</span>, servlet).addMapping(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="production-ready-whats-next"></a></p><h2 id="62ã€ä¸‹ä¸€æ­¥">62ã€ä¸‹ä¸€æ­¥</h2><p>å¦‚æœä½ æƒ³äº†è§£æœ¬ç« ä¸­è®¨è®ºçš„ä¸€äº›æ¦‚å¿µï¼Œä½ å¯ä»¥æŸ¥çœ‹ actuator <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.5.RELEASE/spring-boot-samples">ç¤ºä¾‹åº”ç”¨ç¨‹åº</a>ã€‚æˆ–è®¸ä½ è¿˜æƒ³äº†è§£ <a href="https://graphite.wikidot.com/">Graphite</a> ç­‰å›¾å½¢å·¥å…·çš„ç›¸å…³çŸ¥è¯†ã€‚</p><p>æ­¤å¤–ï¼Œä½ å¯ä»¥ç»§ç»­é˜…è¯»<a href="deployment.md">åº”ç”¨éƒ¨ç½²</a>ç›¸å…³å†…å®¹ï¼Œæˆ–ç»§ç»­é˜…è¯»æœ‰å…³ Spring Boot <a href="build-tool-plugins.md">æ„å»ºå·¥å…·æ’ä»¶</a>çš„ç›¸å…³å†…å®¹ã€‚</p>]]></content>
    
    
    <summary type="html">Spring Bootåœ¨å®é™…å¼€å‘ä¸­çš„è¿ç”¨ï¼Œå¯å¸®åŠ©ä½ åœ¨å°†åº”ç”¨ç¨‹åºæ¨é€åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶ç›‘æ§å’Œç®¡ç†åº”ç”¨ç¨‹åºã€‚ä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨ HTTP ç«¯ç‚¹æˆ– JMX æ¥ç®¡ç†å’Œç›‘æ§åº”ç”¨ç¨‹åºã€‚å®¡è®¡ã€å¥åº·å’ŒæŒ‡æ ‡æ”¶é›†ä¹Ÿå¯ä»¥è‡ªåŠ¨åº”ç”¨äºä½ çš„åº”ç”¨ç¨‹åºã€‚</summary>
    
    
    
    <category term="Spring Boot" scheme="https://luoxiaohei520.github.io/categories/Spring-Boot/"/>
    
    
    <category term="Spring Boot" scheme="https://luoxiaohei520.github.io/tags/Spring-Boot/"/>
    
  </entry>
  
  <entry>
    <title>06pring Boot çš„éƒ¨ç½²</title>
    <link href="https://luoxiaohei520.github.io/posts/fed2c244.html"/>
    <id>https://luoxiaohei520.github.io/posts/fed2c244.html</id>
    <published>2023-11-09T02:50:23.333Z</published>
    <updated>2023-11-09T02:50:23.334Z</updated>
    
    <content type="html"><![CDATA[<p><a id="deployment"></a></p><h1>å…­ã€éƒ¨ç½² Spring Boot åº”ç”¨ç¨‹åº</h1><p>Spring Boot çš„å¯æ‰§è¡Œ jar æ˜¯ç°æˆçš„ï¼Œé€‚ç”¨äºå¤§å¤šæ•°æµè¡Œçš„äº‘ PaaSï¼ˆPlatform-as-a-Serviceï¼Œå¹³å°å³æœåŠ¡ï¼‰æä¾›å•†ã€‚è¿™äº›æä¾›å•†å¾€å¾€è¦æ±‚ä½ ã€Œè‡ªå¸¦å®¹å™¨ã€ã€‚å®ƒä»¬è´Ÿè´£ç®¡ç†åº”ç”¨ç¨‹åºè¿›ç¨‹ï¼ˆè€Œä¸æ˜¯ Java åº”ç”¨ç¨‹åºï¼‰ï¼Œå› æ­¤å®ƒä»¬éœ€è¦ä¸€ä¸ªä¸­é—´å±‚ï¼Œä½¿ä½ çš„åº”ç”¨ç¨‹åºé€‚åº”äº‘æ¦‚å¿µä¸­çš„è¿è¡Œè¿›ç¨‹ã€‚</p><p>æœ‰ä¸¤ä¸ªæµè¡Œçš„äº‘æä¾›å•† Heroku å’Œ Cloud Foundry é‡‡ç”¨äº† buildpack æ–¹å¼ã€‚buildpack å°†ä½ éƒ¨ç½²çš„ä»£ç åŒ…è£…åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºæ‰€éœ€çš„ç¯å¢ƒä¸­ã€‚å®ƒå¯èƒ½æ˜¯ä¸€ä¸ªç”¨äºè°ƒç”¨ <code>java</code> çš„ JDKã€ä¸€ä¸ªå†…åµŒ Web æœåŠ¡å™¨æˆ–ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨ç¨‹åºæœåŠ¡å™¨ã€‚buildpack æ˜¯å¯æ’æ‹”çš„ï¼Œä½†ç†æƒ³æƒ…å†µä¸‹ï¼Œä½ åº”å°½å¯èƒ½å°‘åœ°è¿›è¡Œè‡ªå®šä¹‰ã€‚å…¶å‡å°‘äº†ä¸å—æ§åˆ¶çš„åŠŸèƒ½æ•°ï¼Œæœ€å¤§é™åº¦åœ°å‡å°‘äº†å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒä¹‹é—´çš„å·®å¼‚ã€‚</p><p>ç†æƒ³æƒ…å†µä¸‹ï¼Œä½ çš„åº”ç”¨ç¨‹åºï¼ˆæ¯”å¦‚ä¸€ä¸ª Spring Boot å¯æ‰§è¡Œ jarï¼‰æ‰“åŒ…äº†è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰å†…å®¹ã€‚</p><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ã€Œ<a href="getting-started.md">èµ·æ­¥</a>ã€ç« èŠ‚ä¸­å¼€å‘çš„ä¸€ä¸ª<a href="getting-started.md#getting-started-first-application">ç®€å•åº”ç”¨ç¨‹åº</a>ä½œä¸ºèŒƒä¾‹ï¼Œå¹¶å°†å…¶è¿è¡Œåœ¨äº‘ä¸­ã€‚</p><p><strong>å¾…ç»­</strong></p>]]></content>
    
    
    <summary type="html">Spring Boot çš„å¯æ‰§è¡Œ jar æ˜¯ç°æˆçš„ï¼Œé€‚ç”¨äºå¤§å¤šæ•°æµè¡Œçš„äº‘ PaaSï¼ˆPlatform-as-a-Serviceï¼Œå¹³å°å³æœåŠ¡ï¼‰æä¾›å•†ã€‚è¿™äº›æä¾›å•†å¾€å¾€è¦æ±‚ä½ ã€Œè‡ªå¸¦å®¹å™¨ã€ã€‚å®ƒä»¬è´Ÿè´£ç®¡ç†åº”ç”¨ç¨‹åºè¿›ç¨‹ï¼ˆè€Œä¸æ˜¯ Java åº”ç”¨ç¨‹åºï¼‰ï¼Œå› æ­¤å®ƒä»¬éœ€è¦ä¸€ä¸ªä¸­é—´å±‚ï¼Œä½¿ä½ çš„åº”ç”¨ç¨‹åºé€‚åº”äº‘æ¦‚å¿µä¸­çš„è¿è¡Œè¿›ç¨‹ã€‚</summary>
    
    
    
    <category term="Spring Boot" scheme="https://luoxiaohei520.github.io/categories/Spring-Boot/"/>
    
    
    <category term="Spring Boot" scheme="https://luoxiaohei520.github.io/tags/Spring-Boot/"/>
    
  </entry>
  
  <entry>
    <title>04Spring Bootçš„ç‰¹æ€§</title>
    <link href="https://luoxiaohei520.github.io/posts/f0bff9f3.html"/>
    <id>https://luoxiaohei520.github.io/posts/f0bff9f3.html</id>
    <published>2023-11-09T02:50:23.332Z</published>
    <updated>2023-11-09T02:50:23.333Z</updated>
    
    <content type="html"><![CDATA[<p><a id="boot-features"></a></p><h1>å››ã€Spring Boot ç‰¹æ€§</h1><p>æœ¬éƒ¨åˆ†å°†ä»‹ç» Spring Boot ç›¸å…³çš„ç»†èŠ‚å†…å®¹ã€‚åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥å­¦ä¹ åˆ°å¯èƒ½éœ€è¦ä½¿ç”¨å’Œè‡ªå®šä¹‰çš„ä¸»è¦åŠŸèƒ½ã€‚æ‚¨å¦‚æœè¿˜æ²¡æœ‰åšå¥½å……åˆ†å‡†å¤‡ï¼Œå¯èƒ½éœ€è¦é˜…è¯»<a href="#getting-started">ç¬¬äºŒéƒ¨åˆ†ï¼šå…¥é—¨</a>å’Œ<a href="#using-boot">ç¬¬ä¸‰éƒ¨åˆ†ï¼šä½¿ç”¨ Spring Boot</a>ï¼Œä»¥ä¾¿æ‰“ä¸‹å‰æœŸåŸºç¡€ã€‚</p><p><a id="boot-features-spring-application"></a></p><h2 id="23ã€SpringApplication">23ã€SpringApplication</h2><p><code>SpringApplication</code> ç±»æä¾›äº†ä¸€ç§å¯é€šè¿‡è¿è¡Œ <code>main()</code> æ–¹æ³•æ¥å¯åŠ¨ Spring åº”ç”¨çš„ç®€å•æ–¹å¼ã€‚å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨åªéœ€è¦å§”æ‰˜ç»™é™æ€çš„ <code>SpringApplication.run</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    SpringApplication.run(MySpringConfiguration.class, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“åº”ç”¨å¯åŠ¨æ—¶ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„å†…å®¹è¾“å‡ºï¼š</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> /\\ / ___&#x27;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ |<span class="string"> &#x27;_ </span>|<span class="string"> &#x27;_</span>|<span class="string"> </span>|<span class="string"> &#x27;_ \/ _` </span>|<span class="string"> \ \ \ \</span></span><br><span class="line"><span class="string"> \\/  ___)</span>|<span class="string"> </span>|<span class="string">_)</span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>||<span class="string"> (_</span>|<span class="string"> </span>|<span class="string">  ) ) ) )</span></span><br><span class="line"><span class="string">  &#x27;  </span>|<span class="string">____</span>|<span class="string"> .__</span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string">_</span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string">_\__, </span>|<span class="string"> / / / /</span></span><br><span class="line"><span class="string"> =========</span>|<span class="string">_</span>|<span class="string">==============</span>|<span class="string">___/=/_/_/_/</span></span><br><span class="line"><span class="string"> :: Spring Boot ::   v2.1.1.RELEASE</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2013-07-31 00:08:16.117  INFO 56603 --- [           main] o.s.b.s.app.SampleApplication            : Starting SampleApplication v0.1.0 on mycomputer with PID 56603 (/apps/myapp.jar started by pwebb)</span></span><br><span class="line"><span class="string">2013-07-31 00:08:16.166  INFO 56603 --- [           main] ationConfigServletWebServerApplicationContext : Refreshing org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplicationContext@6e5a8246: startup date [Wed Jul 31 00:08:16 PDT 2013]; root of context hierarchy</span></span><br><span class="line"><span class="string">2014-03-04 13:09:54.912  INFO 41370 --- [           main] .t.TomcatServletWebServerFactory : Server initialized with port: 8080</span></span><br><span class="line"><span class="string">2014-03-04 13:09:56.501  INFO 41370 --- [           main] o.s.b.s.app.SampleApplication            : Started SampleApplication in 2.992 seconds (JVM running for 3.658)</span></span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†æ˜¾ç¤º <code>INFO</code> çº§åˆ«çš„æ—¥å¿—ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸€äº›åº”ç”¨å¯åŠ¨ç›¸å…³ä¿¡æ¯ã€‚å¦‚æœæ‚¨éœ€è¦ä¿®æ”¹ <code>INFO</code> æ—¥å¿—çº§åˆ«ï¼Œè¯·å‚è€ƒ <a href="#boot-features-custom-log-levels">26.4 éƒ¨åˆ†ï¼šæ—¥å¿—ç­‰çº§</a>ã€‚</p><p><a id="boot-features-startup-failure"></a></p><h3 id="23-1ã€å¯åŠ¨å¤±è´¥">23.1ã€å¯åŠ¨å¤±è´¥</h3><p>å¦‚æœæ‚¨çš„åº”ç”¨æ— æ³•å¯åŠ¨ï¼Œæ³¨å†Œçš„ <code>FailureAnalyzers</code> å¯èƒ½ä¼šæä¾›æœ‰ç›¸å…³çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³é—®é¢˜çš„å…·ä½“æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨å·²ç»è¢«å ç”¨çš„ <code>8080</code> ç«¯å£ä¸Šå¯åŠ¨äº†ä¸€ä¸ª web åº”ç”¨ï¼Œä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„é”™è¯¯ä¿¡æ¯ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">***</span></span><br><span class="line"><span class="strong">APPLICATION FAILED TO START</span></span><br><span class="line"><span class="strong">**</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span><span class="strong">****</span>*</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line"></span><br><span class="line">Embedded servlet container failed to start. Port 8080 was already in use.</span><br><span class="line"></span><br><span class="line">Action:</span><br><span class="line"></span><br><span class="line">Identify and stop the process that&#x27;s listening on port 8080 or configure this application to listen on another port.</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>Spring Boot æä¾›äº†è®¸å¤šçš„ <code>FailureAnalyzer</code> å®ç°ï¼Œæ‚¨ä¹Ÿå¯ä»¥<a href="#howto-failure-analyzer">æ·»åŠ è‡ªå·±çš„å®ç°</a>ã€‚</p></blockquote><p>å¦‚æœæ²¡æœ‰å¤±è´¥åˆ†æå™¨èƒ½å¤Ÿå¤„ç†çš„å¼‚å¸¸ï¼Œæ‚¨ä»ç„¶å¯ä»¥æ˜¾ç¤ºå®Œæ•´çš„æ¡ä»¶æŠ¥å‘Šä»¥ä¾¿æ›´å¥½åœ°äº†è§£å‡ºç°çš„é—®é¢˜ã€‚ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦é’ˆå¯¹ <code>org.springframework.boot.autoconfigure.logging.ConditionEvaluationReportLoggingListener</code> <a href="#boot-features-external-config">å¯ç”¨ <code>debug</code> å±æ€§</a>æˆ–è€…<a href="#boot-features-custom-log-levels">å¼€å¯ <code>DEBUG</code> æ—¥å¿—</a>ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ <code>java -jar</code> è¿è¡Œåº”ç”¨ï¼Œå¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼å¯ç”¨ <code>debug</code> å±æ€§ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">java </span>-<span class="keyword">jar </span>myproject<span class="number">-0</span>.<span class="number">0</span>.<span class="number">1</span>-SNAPSHOT.<span class="keyword">jar </span>--<span class="built_in">debug</span></span><br></pre></td></tr></table></figure><p><a id="boot-features-banner"></a></p><h3 id="23-2ã€è‡ªå®šä¹‰-banner">23.2ã€è‡ªå®šä¹‰ banner</h3><p>å¯ä»¥é€šè¿‡åœ¨ classpath ä¸‹æ·»åŠ ä¸€ä¸ª <code>banner.txt</code> æ–‡ä»¶ï¼Œæˆ–è€…å°† <code>spring.banner.location</code> å±æ€§æŒ‡å‘è¯¥æ–‡ä»¶çš„ä½ç½®æ¥æ›´æ”¹å¯åŠ¨æ—¶æ‰“å°çš„ bannerã€‚å¦‚æœæ–‡ä»¶é‡‡ç”¨äº†é UTF-8 ç¼–ç ï¼Œæ‚¨å¯ä»¥è®¾ç½® <code>spring.banner.charset</code> æ¥è§£å†³ã€‚é™¤äº†æ–‡æœ¬æ–‡ä»¶ï¼Œæ‚¨è¿˜å¯ä»¥å°† <code>banner.gif</code>ã€<code>banner.jpg</code> æˆ–è€… <code>banner.png</code> å›¾ç‰‡æ–‡ä»¶æ·»åŠ åˆ° classpath ä¸‹ï¼Œæˆ–è€…è®¾ç½® <code>spring.banner.image.location</code> å±æ€§ã€‚æŒ‡å®šçš„å›¾ç‰‡å°†ä¼šè¢«è½¬æ¢æˆ ASCII å½¢å¼å¹¶æ‰“å°åœ¨ banner æ–‡æœ¬ä¸Šæ–¹ã€‚</p><p>æ‚¨å¯ä»¥åœ¨ <code>banner.txt</code> æ–‡ä»¶ä¸­ä½¿ç”¨ä»¥ä¸‹å ä½ç¬¦ï¼š</p><table><thead><tr><th>å˜é‡</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>$&#123;application.version&#125;</code></td><td>æ‚¨çš„åº”ç”¨ç‰ˆæœ¬å·ï¼Œå£°æ˜åœ¨ <code>MANIFEST.MF</code> ä¸­ã€‚ä¾‹å¦‚ï¼Œ<code>Implementation-Version: 1.0</code> å°†è¢«æ‰“å°ä¸º <code>1.0</code>ã€‚</td></tr><tr><td><code>$&#123;application.formatted-version&#125;</code></td><td>æ‚¨çš„åº”ç”¨ç‰ˆæœ¬å·ï¼Œå£°æ˜åœ¨ <code>MANIFEST.MF</code> ä¸­ï¼Œæ ¼å¼åŒ–ä¹‹åæ‰“å°ï¼ˆç”¨æ‹¬å·æ‹¬èµ·æ¥ï¼Œä»¥ <code>v</code> ä¸ºå‰ç¼€ï¼‰ï¼Œä¾‹å¦‚ (<code>v1.0</code>)ã€‚</td></tr><tr><td><code>$&#123;spring-boot.version&#125;</code></td><td>æ‚¨ä½¿ç”¨çš„ Spring Boot ç‰ˆæœ¬ã€‚ä¾‹å¦‚ <code>2.1.1.RELEASE.</code>ã€‚</td></tr><tr><td><code>$&#123;spring-boot.formatted-version&#125;</code></td><td>æ‚¨ä½¿ç”¨çš„ Spring Boot ç‰ˆæœ¬æ ¼å¼åŒ–ä¹‹åæ˜¾ç¤ºï¼ˆç”¨æ‹¬å·æ‹¬èµ·æ¥ï¼Œä»¥ <code>v</code> ä¸ºå‰ç¼€ï¼‰ã€‚ä¾‹å¦‚ (<code>v2.1.1.RELEASE</code>)ã€‚</td></tr><tr><td><code>$&#123;Ansi.NAME&#125;</code>ï¼ˆæˆ– <code>$&#123;AnsiColor.NAME&#125;</code>ã€<br/><code>$&#123;AnsiBackground.NAME&#125;</code>ã€<br/><code>$&#123;AnsiStyle.NAME&#125;</code>ï¼‰</td><td>å…¶ä¸­ <code>NAME</code> æ˜¯ ANSI è½¬ä¹‰ç çš„åç§°ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/ansi/AnsiPropertySource.java">AnsiPropertySource</a>ã€‚</td></tr><tr><td><code>$&#123;application.title&#125;</code></td><td>æ‚¨çš„åº”ç”¨æ ‡é¢˜ï¼Œå£°æ˜åœ¨ <code>MANIFEST.MF</code> ä¸­ï¼Œä¾‹å¦‚ <code>Implementation-Title: MyApp</code> æ‰“å°ä¸º <code>MyApp</code>ã€‚</td></tr></tbody></table><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœæ‚¨æƒ³ä»¥ç¼–ç¨‹çš„æ–¹å¼ç”Ÿæˆ bannerï¼Œå¯ä»¥ä½¿ç”¨ <code>SpringApplication.setBanner(â€‹...)</code> æ–¹æ³•ã€‚ä½¿ç”¨ <code>org.springframework.boot.Banner</code> æ¥å£å¹¶å®ç°è‡ªå·±çš„ <code>printBanner()</code> æ–¹æ³•ã€‚</p></blockquote><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <code>spring.main.banner-mode</code> å±æ€§æ¥ç¡®å®šæ˜¯å¦å¿…é¡»åœ¨ <code>System.out</code>ï¼ˆ<code>console</code>ï¼‰ä¸Šæ‰“å° bannerï¼Œè¿˜æ˜¯ä½¿ç”¨æ—¥å¿—è®°å½•å™¨ï¼ˆ<code>log</code>ï¼‰æˆ–è€…éƒ½ä¸æ‰“å°ï¼ˆ<code>off</code>ï¼‰ã€‚</p><p>æ‰“å°çš„ banner è¢«æ³¨å†Œåä¸º <code>springBootBanner</code> çš„å•ä¾‹ beanã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>YAML å°† <code>off</code> æ˜ å°„ä¸º <code>false</code>ï¼Œå› æ­¤å¦‚æœè¦ç¦ç”¨åº”ç”¨ç¨‹åº bannerï¼Œè¯·ç¡®ä¿å±æ€§æ·»åŠ å¼•å·ã€‚</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">main:</span></span><br><span class="line">        <span class="attr">banner-mode:</span> <span class="string">&quot;off&quot;</span></span><br></pre></td></tr></table></figure><p><a id="boot-features-customizing-spring-application"></a></p><h3 id="23-3ã€è‡ªå®šä¹‰-SpringApplication">23.3ã€è‡ªå®šä¹‰ SpringApplication</h3><p>å¦‚æœ <code>SpringApplication</code> çš„é»˜è®¤è®¾ç½®ä¸ç¬¦åˆæ‚¨çš„æƒ³æ³•ï¼Œæ‚¨å¯ä»¥åˆ›å»ºæœ¬åœ°å®ä¾‹è¿›è¡Œå®šåˆ¶åŒ–ã€‚ä¾‹å¦‚ï¼Œè¦å…³é—­ bannerï¼Œæ‚¨å¯ä»¥è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="type">SpringApplication</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringApplication</span>(MySpringConfiguration.class);</span><br><span class="line">app.setBannerMode(Banner.Mode.OFF);</span><br><span class="line">app.run(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>ä¼ å…¥ <code>SpringApplication</code> çš„æ„é€ å‚æ•°æ˜¯ spring bean çš„é…ç½®æºã€‚å¤§å¤šæƒ…å†µä¸‹æ˜¯å¼•ç”¨ <code>@Configuration</code> ç±»ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥å¼•ç”¨ XML é…ç½®æˆ–è€…è¢«æ‰«æçš„åŒ…ã€‚</p></blockquote><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>application.properties</code> æ–‡ä»¶é…ç½® <code>SpringApplication</code>ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="#boot-features-external-config">ç¬¬ 24 ç« ï¼šå¤–éƒ¨åŒ–é…ç½®</a>ã€‚</p><p>å…³äºé…ç½®é€‰é¡¹çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜… <a href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/SpringApplication.html">SpringApplication Javadoc</a>ã€‚</p><p><a id="boot-features-customizing-spring-application"></a></p><h3 id="23-4ã€Fluent-Builder-API">23.4ã€Fluent Builder API</h3><p>å¦‚æœæ‚¨éœ€è¦æ„å»ºä¸€ä¸ªæœ‰å±‚çº§å…³ç³»çš„ <code>ApplicationContext</code>ï¼ˆå…·æœ‰çˆ¶/å­å…³ç³»çš„å¤šä¸Šä¸‹æ–‡ï¼‰ï¼Œæˆ–è€…åå‘ä½¿ç”¨ <strong>fluent</strong>ï¼ˆæµå¼ï¼‰æ„å»ºå™¨ APIï¼Œå¯ä»¥ä½¿ç”¨ <code>SpringApplicationBuilder</code>ã€‚</p><p><code>SpringApplicationBuilder</code> å…è®¸æ‚¨é“¾å¼è°ƒç”¨å¤šä¸ªæ–¹æ³•ï¼ŒåŒ…æ‹¬èƒ½åˆ›å»ºå‡ºå…·æœ‰å±‚æ¬¡ç»“æ„çš„ <code>parent</code> å’Œ <code>child</code> æ–¹æ³•ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">SpringApplicationBuilder</span>()</span><br><span class="line">        .sources(Parent.class)</span><br><span class="line">        .child(Application.class)</span><br><span class="line">        .bannerMode(Banner.Mode.OFF)</span><br><span class="line">        .run(args);</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>åˆ›å»ºå±‚çº§çš„ <code>ApplicationContext</code> æ—¶æœ‰éƒ¨åˆ†é™åˆ¶ï¼Œæ¯”å¦‚ Web ç»„ä»¶<strong>å¿…é¡»</strong>åŒ…å«åœ¨å­ä¸Šä¸‹æ–‡ä¸­ï¼Œå¹¶ä¸”ç›¸åŒçš„ <code>Environment</code> å°†ä½œç”¨äºçˆ¶å­ä¸Šä¸‹æ–‡ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/builder/SpringApplicationBuilder.html">SpringApplicationBuilder Javadoc</a>ã€‚</p></blockquote><p><a id="boot-features-application-events-and-listeners"></a></p><h3 id="23-5ã€åº”ç”¨ç¨‹åºäº‹ä»¶ä¸ç›‘å¬å™¨">23.5ã€åº”ç”¨ç¨‹åºäº‹ä»¶ä¸ç›‘å¬å™¨</h3><p>é™¤äº†å¸¸è§çš„ Spring Framework äº‹ä»¶ï¼Œæ¯”å¦‚ <a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/javadoc-api/org/springframework/context/event/ContextRefreshedEvent.html"><code>ContextRefreshedEvent</code></a>ï¼Œ<code>SpringApplication</code> è¿˜ä¼šå‘é€å…¶ä»–åº”ç”¨ç¨‹åºäº‹ä»¶ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>åœ¨ <code>ApplicationContext</code> åˆ›å»ºä¹‹å‰ï¼Œå®é™…ä¸Šè§¦å‘äº†ä¸€äº›äº‹ä»¶ï¼Œå› æ­¤æ‚¨ä¸èƒ½åƒ <code>@Bean</code> ä¸€æ ·æ³¨å†Œç›‘å¬å™¨ã€‚æ‚¨å¯ä»¥é€šè¿‡ <code>SpringApplication.addListeners(â€‹...)</code> æˆ–è€… <code>SpringApplicationBuilder.listeners(...â€‹)</code> æ–¹æ³•æ³¨å†Œå®ƒä»¬ã€‚å¦‚æœæ‚¨å¸Œæœ›æ— è®ºåº”ç”¨ä½¿ç”¨ä½•ç§åˆ›å»ºæ–¹å¼éƒ½èƒ½è‡ªåŠ¨æ³¨å†Œè¿™äº›ç›‘å¬å™¨ï¼Œæ‚¨éƒ½å¯ä»¥å°† <code>META-INF/spring.factories</code> æ–‡ä»¶æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼Œå¹¶ä½¿ç”¨ <code>org.springframework.context.ApplicationListener </code> å±æ€§é”®æŒ‡å‘æ‚¨çš„ç›‘å¬å™¨ã€‚æ¯”å¦‚ï¼š<code>org.springframework.context.ApplicationListener=com.example.project.MyListener</code></p></blockquote><p>å½“æ‚¨è¿è¡Œåº”ç”¨æ—¶ï¼Œåº”ç”¨ç¨‹åºäº‹ä»¶å°†æŒ‰ç…§ä»¥ä¸‹é¡ºåºå‘é€ï¼š</p><ol><li>åœ¨å¼€å§‹åº”ç”¨å¼€å§‹è¿è¡Œä½†è¿˜æ²¡æœ‰è¿›è¡Œä»»ä½•å¤„ç†æ—¶ï¼ˆé™¤äº†æ³¨å†Œç›‘å¬å™¨å’Œåˆå§‹åŒ–å™¨[initializer]ï¼‰ï¼Œå°†å‘é€ <code>ApplicationStartingEvent</code>ã€‚</li><li>å½“ <code>Environment</code> è¢«ä¸Šä¸‹æ–‡ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨ä¸Šä¸‹æ–‡åˆ›å»ºä¹‹å‰ï¼Œå°†å‘é€ <code>ApplicationEnvironmentPreparedEvent</code>ã€‚</li><li>åœ¨å¼€å§‹åˆ·æ–°ä¹‹å‰ï¼Œbean å®šä¹‰è¢«åŠ è½½ä¹‹åå‘é€ <code>ApplicationPreparedEvent</code>ã€‚</li><li>åœ¨ä¸Šä¸‹æ–‡åˆ·æ–°ä¹‹åä¸”æ‰€æœ‰çš„åº”ç”¨å’Œå‘½ä»¤è¡Œè¿è¡Œå™¨ï¼ˆcommand-line runnerï¼‰è¢«è°ƒç”¨ä¹‹å‰å‘é€ <code>ApplicationStartedEvent</code>ã€‚</li><li>åœ¨åº”ç”¨ç¨‹åºå’Œå‘½ä»¤è¡Œè¿è¡Œå™¨ï¼ˆcommand-line runnerï¼‰è¢«è°ƒç”¨ä¹‹åï¼Œå°†å‘å‡º <code>ApplicationReadyEvent</code>ï¼Œè¯¥äº‹ä»¶ç”¨äºé€šçŸ¥åº”ç”¨å·²ç»å‡†å¤‡å¤„ç†è¯·æ±‚ã€‚</li><li>å¦‚æœå¯åŠ¨æ—¶å‘ç”Ÿå¼‚å¸¸ï¼Œå°†å‘é€ <code>ApplicationFailedEvent</code>ã€‚</li></ol><p><strong>æç¤º</strong></p><blockquote><p>æ‚¨å¯èƒ½ä¸ä¼šç»å¸¸ä½¿ç”¨åº”ç”¨ç¨‹åºäº‹ä»¶ï¼Œä½†äº†è§£ä»–ä»¬çš„å­˜åœ¨è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚åœ¨æ¡†æ¶å†…éƒ¨ï¼ŒSpring Boot ä½¿ç”¨è¿™äº›äº‹ä»¶æ¥å¤„ç†å„ç§ä»»åŠ¡ã€‚</p></blockquote><p>åº”ç”¨ç¨‹åºäº‹ä»¶å‘é€ä½¿ç”¨äº† Spring Framework çš„äº‹ä»¶å‘å¸ƒæœºåˆ¶ã€‚è¯¥éƒ¨åˆ†æœºåˆ¶ç¡®ä¿åœ¨å­ä¸Šä¸‹æ–‡ä¸­å‘å¸ƒç»™ç›‘å¬å™¨çš„äº‹ä»¶ä¹Ÿä¼šå‘å¸ƒç»™æ‰€æœ‰ç¥–å…ˆä¸Šä¸‹æ–‡ä¸­çš„ç›‘å¬å™¨ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºä½¿ç”¨æœ‰å±‚çº§ç»“æ„çš„ SpringApplication å®ä¾‹ï¼Œåˆ™ç›‘å¬å™¨å¯èƒ½ä¼šæ”¶åˆ°åŒç§ç±»å‹åº”ç”¨ç¨‹åºäº‹ä»¶çš„å¤šä¸ªå®ä¾‹ã€‚</p><p>ä¸ºäº†è®©ç›‘å¬å™¨èƒ½å¤ŸåŒºåˆ†å…¶ä¸Šä¸‹æ–‡äº‹ä»¶å’Œåä»£ä¸Šä¸‹æ–‡äº‹ä»¶ï¼Œæ‚¨åº”è¯¥æ³¨å…¥å…¶åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œç„¶åå°†æ³¨å…¥çš„ä¸Šä¸‹æ–‡ä¸äº‹ä»¶çš„ä¸Šä¸‹æ–‡è¿›è¡Œæ¯”è¾ƒã€‚å¯ä»¥é€šè¿‡å®ç° <code>ApplicationContextAware</code> æ¥æ³¨å…¥ä¸Šä¸‹æ–‡ï¼Œå¦‚æœç›‘å¬å™¨æ˜¯ beanï¼Œåˆ™ä½¿ç”¨ <code>@Autowired</code> æ³¨å…¥ä¸Šä¸‹æ–‡ã€‚</p><p><a id="boot-features-web-environment"></a></p><h3 id="23-6ã€Web-ç¯å¢ƒ">23.6ã€Web ç¯å¢ƒ</h3><p><code>SpringApplication</code> è¯•å›¾ä¸ºæ‚¨åˆ›å»ºæ­£ç¡®ç±»å‹çš„ <code>ApplicationContext</code>ã€‚ç¡®å®š <code>WebApplicationType</code> çš„ç®—æ³•éå¸¸ç®€å•ï¼š</p><ul><li>å¦‚æœå­˜åœ¨ Spring MVCï¼Œåˆ™ä½¿ç”¨ <code>AnnotationConfigServletWebServerApplicationContext</code></li><li>å¦‚æœ Spring MVC ä¸å­˜åœ¨ä¸”å­˜åœ¨ Spring WebFluxï¼Œåˆ™ä½¿ç”¨ <code>AnnotationConfigReactiveWebServerApplicationContext</code></li><li>å¦åˆ™ï¼Œä½¿ç”¨ <code>AnnotationConfigApplicationContext</code></li></ul><p>è¿™æ„å‘³ç€å¦‚æœæ‚¨åœ¨åŒä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨äº† Spring MVC å’Œ Spring WebFlux ä¸­çš„æ–° <code>WebClient</code>ï¼Œé»˜è®¤æƒ…å†µä¸‹å°†ä½¿ç”¨ Spring MVCã€‚æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨ <code>setWebApplicationType(WebApplicationType)</code> ä¿®æ”¹é»˜è®¤è¡Œä¸ºã€‚</p><p>ä¹Ÿå¯ä»¥è°ƒç”¨ <code>setApplicationContextClass(...)</code> æ¥å®Œå…¨æ§åˆ¶ <code>ApplicationContext</code> ç±»å‹ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>åœ¨ JUnit æµ‹è¯•ä¸­ä½¿ç”¨ <code>SpringApplication</code> æ—¶ï¼Œé€šå¸¸éœ€è¦è°ƒç”¨ <code>setWebApplicationType(WebApplicationType.NONE)</code>ã€‚</p></blockquote><p><a id="boot-features-application-arguments"></a></p><h3 id="23-7ã€è®¿é—®åº”ç”¨ç¨‹åºå‚æ•°">23.7ã€è®¿é—®åº”ç”¨ç¨‹åºå‚æ•°</h3><p>å¦‚æœæ‚¨éœ€è¦è®¿é—®ä» <code>SpringApplication.run(â€‹...) </code> ä¼ å…¥çš„åº”ç”¨ç¨‹åºå‚æ•°ï¼Œå¯ä»¥æ³¨å…¥ä¸€ä¸ª <code>org.springframework.boot.ApplicationArguments</code> beanã€‚<code>ApplicationArguments</code> æ¥å£æä¾›äº†è®¿é—®åŸå§‹ <code>String[]</code> å‚æ•°ä»¥åŠè§£æåçš„ <code>option</code> å’Œ <code>non-option</code> å‚æ•°çš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyBean</span><span class="params">(ApplicationArguments args)</span> &#123;</span><br><span class="line"><span class="type">boolean</span> <span class="variable">debug</span> <span class="operator">=</span> args.containsOption(<span class="string">&quot;debug&quot;</span>);</span><br><span class="line">List&lt;String&gt; files = args.getNonOptionArgs();</span><br><span class="line"><span class="comment">// if run with &quot;--debug logfile.txt&quot; debug=true, files=[&quot;logfile.txt&quot;]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>Spring Boot è¿˜å‘ Spring <code>Environment</code> æ³¨å†Œäº†ä¸€ä¸ª <code>CommandLinePropertySource</code>ã€‚è¿™å…è®¸æ‚¨å¯ä»¥ä½¿ç”¨ <code>@Value</code> æ³¨è§£æ³¨å…¥å•ä¸ªåº”ç”¨å‚æ•°ã€‚</p></blockquote><p><a id="boot-features-command-line-runner"></a></p><h3 id="23-8ã€ä½¿ç”¨-ApplicationRunner-æˆ–-ApplicationRunner">23.8ã€ä½¿ç”¨ ApplicationRunner æˆ– ApplicationRunner</h3><p>å¦‚æœæ‚¨éœ€è¦åœ¨ SpringApplication å¯åŠ¨æ—¶è¿è¡Œä¸€äº›ä»£ç ï¼Œå¯ä»¥å®ç° <code>ApplicationRunner</code> æˆ–è€… <code>CommandLineRunner</code> æ¥å£ã€‚è¿™ä¸¤ä¸ªæ¥å£çš„å·¥ä½œæ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æä¾›äº†ä¸€ä¸ªå•ç‹¬çš„ <code>run</code> æ–¹æ³•ï¼Œå®ƒå°†åœ¨ <code>SpringApplication.run(â€‹...)</code> å®Œæˆä¹‹å‰è°ƒç”¨ã€‚</p><p><code>CommandLineRunner</code> æ¥å£æä¾›äº†è®¿é—®åº”ç”¨ç¨‹åºå­—ç¬¦ä¸²æ•°ç»„å½¢å¼å‚æ•°çš„æ–¹æ³•ï¼Œè€Œ <code>ApplicationRunner</code> åˆ™ä½¿ç”¨äº†ä¸Šè¿°çš„ <code>ApplicationArguments</code> æ¥å£ã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤º <code>CommandLineRunner</code> å’Œ <code>run</code> æ–¹æ³•çš„ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... args)</span> &#123;</span><br><span class="line"><span class="comment">// Do something...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨å®šä¹‰äº†å¤šä¸ª <code>CommandLineRunner</code> æˆ–è€… <code>ApplicationRunner</code> beanï¼Œåˆ™å¿…é¡»æŒ‡å®šè°ƒç”¨é¡ºåºï¼Œæ‚¨å¯ä»¥å®ç° <code>org.springframework.core.Ordered</code> æ¥å£ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>org.springframework.core.annotation.Order</code> æ³¨è§£è§£å†³é¡ºåºé—®é¢˜ã€‚</p><p><a id="boot-features-application-exit"></a></p><h3 id="23-9ã€åº”ç”¨ç¨‹åºé€€å‡º">23.9ã€åº”ç”¨ç¨‹åºé€€å‡º</h3><p>æ¯ä¸ª <code>SpringApplication</code> æ³¨å†Œäº†ä¸€ä¸ª JVM å…³é—­é’©å­ï¼Œä»¥ç¡®ä¿ <code>ApplicationContext</code> åœ¨é€€å‡ºæ—¶å¯ä»¥ä¼˜é›…å…³é—­ã€‚æ‰€æœ‰æ ‡å‡†çš„ Spring ç”Ÿå‘½å‘¨æœŸå›è°ƒï¼ˆæ¯”å¦‚ <code>DisposableBean</code> æ¥å£ï¼Œæˆ–è€… <code>@PreDestroy</code> æ³¨è§£ï¼‰éƒ½å¯ä»¥ä½¿ç”¨ã€‚</p><p>æ­¤å¤–ï¼Œå¦‚æœå¸Œæœ›åœ¨è°ƒç”¨ <code>SpringApplication.exit()</code> æ—¶è¿”å›ç‰¹å®šçš„é€€å‡ºç ï¼Œåˆ™ bean å¯ä»¥å®ç° <code>org.springframework.boot.ExitCodeGenerator</code> æ¥å£ã€‚ä¹‹åé€€å‡ºç å°†ä¼ é€’ç»™ <code>System.exit()</code> ä»¥å°†å…¶ä½œä¸ºçŠ¶æ€ç è¿”å›ï¼Œå¦‚ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExitCodeApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ExitCodeGenerator <span class="title function_">exitCodeGenerator</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> () -&gt; <span class="number">42</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">System.exit(SpringApplication</span><br><span class="line">.exit(SpringApplication.run(ExitCodeApplication.class, args)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œ<code>ExitCodeGenerator</code> æ¥å£å¯ä»¥é€šè¿‡å¼‚å¸¸å®ç°ã€‚é‡åˆ°è¿™ç±»å¼‚å¸¸æ—¶ï¼ŒSpring Boot å°†è¿”å›å®ç°çš„ <code>getExitCode()</code> æ–¹æ³•æä¾›çš„é€€å‡ºç ã€‚</p><p><a id="boot-features-application-admin"></a></p><h3 id="23-10ã€ç®¡ç†åŠŸèƒ½">23.10ã€ç®¡ç†åŠŸèƒ½</h3><p>å¯ä»¥é€šè¿‡æŒ‡å®š <code>spring.application.admin.enabled</code> å±æ€§æ¥ä¸ºåº”ç”¨ç¨‹åºå¯ç”¨ç®¡ç†ç›¸å…³çš„åŠŸèƒ½ã€‚å…¶å°†åœ¨ <code>MBeanServer</code> å¹³å°ä¸Šæš´éœ² <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/admin/SpringApplicationAdminMXBean.java"><code>SpringApplicationAdminMXBean</code></a>ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½æ¥è¿œç¨‹ç®¡ç† Spring Boot åº”ç”¨ã€‚è¯¥åŠŸèƒ½å¯¹æœåŠ¡åŒ…è£…å™¨çš„å®ç°ä¹Ÿæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœæ‚¨æƒ³çŸ¥é“åº”ç”¨ç¨‹åºåœ¨å“ªä¸€ä¸ª HTTP ç«¯å£ä¸Šè¿è¡Œï¼Œè¯·ä½¿ç”¨ <code>local.server.port</code> é”®è·å–è¯¥å±æ€§ã€‚</p></blockquote><p><strong>æ³¨æ„</strong></p><blockquote><p>å¯ç”¨æ­¤åŠŸèƒ½æ—¶è¯·å°å¿ƒï¼Œå› ä¸º MBean æš´éœ²äº†å…³é—­åº”ç”¨ç¨‹åºçš„æ–¹æ³•ã€‚</p></blockquote><p><a id="boot-features-external-config"></a></p><h2 id="24ã€å¤–éƒ¨åŒ–é…ç½®">24ã€å¤–éƒ¨åŒ–é…ç½®</h2><p>Spring Boot å¯ä»¥è®©æ‚¨çš„é…ç½®å¤–éƒ¨åŒ–ï¼Œä»¥ä¾¿å¯ä»¥åœ¨ä¸åŒç¯å¢ƒä¸­ä½¿ç”¨ç›¸åŒçš„åº”ç”¨ç¨‹åºä»£ç ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ properties æ–‡ä»¶ã€YAML æ–‡ä»¶ã€ç¯å¢ƒå˜é‡æˆ–è€…å‘½ä»¤è¡Œå‚æ•°æ¥å¤–éƒ¨åŒ–é…ç½®ã€‚å¯ä»¥ä½¿ç”¨ <code>@Value</code> æ³¨è§£å°†å±æ€§å€¼ç›´æ¥æ³¨å…¥åˆ° bean ä¸­ï¼Œå¯é€šè¿‡ Spring çš„ <code>Environment</code> è®¿é—®ï¼Œæˆ–è€…é€šè¿‡ <code>@ConfigurationProperties</code> ç»‘å®šåˆ°<a href="#boot-features-external-config-typesafe-configuration-properties">ç»“æ„åŒ–å¯¹è±¡</a>ã€‚</p><p>Spring Boot ä½¿ç”¨äº†ä¸€ä¸ªéå¸¸ç‰¹åˆ«çš„ <code>PropertySource</code> æŒ‡ä»¤ï¼Œç”¨äºæ™ºèƒ½è¦†ç›–é»˜è®¤å€¼ã€‚å±æ€§å°†æŒ‰ç…§ä»¥ä¸‹é¡ºåºå¤„ç†ï¼š</p><ol><li>åœ¨æ‚¨çš„ä¸»ç›®å½•ï¼ˆå½“ devtools è¢«æ¿€æ´»ï¼Œåˆ™ä¸º <code>~/.spring-boot-devtools.properties</code> ï¼‰ä¸­çš„ <a href="#using-boot-devtools-globalsettings">Devtools å…¨å±€è®¾ç½®å±æ€§</a>ã€‚</li><li>åœ¨æµ‹è¯•ä¸­ä½¿ç”¨åˆ°çš„ <code>@TestPropertySource</code> æ³¨è§£ã€‚</li><li>åœ¨æµ‹è¯•ä¸­ä½¿ç”¨åˆ°çš„ <code>properties</code> å±æ€§ï¼Œå¯ä»¥æ˜¯ <a href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/test/context/SpringBootTest.html"><code>@SpringBootTest</code></a> å’Œ<a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-tests">ç”¨äºæµ‹è¯•åº”ç”¨ç¨‹åºæŸéƒ¨åˆ†çš„æµ‹è¯•æ³¨è§£</a>ã€‚</li><li>å‘½ä»¤è¡Œå‚æ•°ã€‚</li><li>æ¥è‡ª <code>SPRING_APPLICATION_JSON</code> çš„å±æ€§ï¼ˆåµŒå…¥åœ¨ç¯å¢ƒå˜é‡æˆ–è€…ç³»ç»Ÿå±æ€§ã€system propertã€‘ä¸­çš„å†…è” JSONï¼‰ã€‚</li><li><code>ServletConfig</code> åˆå§‹åŒ–å‚æ•°ã€‚</li><li><code>ServletContext</code> åˆå§‹åŒ–å‚æ•°ã€‚</li><li>æ¥è‡ª <code>java:comp/env</code> çš„ JNDI å±æ€§ã€‚</li><li>Java ç³»ç»Ÿå±æ€§ï¼ˆ<code>System.getProperties()</code>ï¼‰ã€‚</li><li>æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡ã€‚</li><li>åªæœ‰ <code>random.*</code> å±æ€§çš„ <code>RandomValuePropertySource</code>ã€‚</li><li>åœ¨å·²æ‰“åŒ…çš„ jar å¤–éƒ¨çš„<a href="#boot-features-external-config-profile-specific-properties">æŒ‡å®š profile çš„åº”ç”¨å±æ€§æ–‡ä»¶</a>ï¼ˆ<code>application-&#123;profile&#125;.properties</code> å’Œ YAML å˜é‡ï¼‰ã€‚</li><li>åœ¨å·²æ‰“åŒ…çš„ jar å†…éƒ¨çš„<a href="#boot-features-external-config-profile-specific-properties">æŒ‡å®š profile çš„åº”ç”¨å±æ€§æ–‡ä»¶</a>ï¼ˆ<code>application-&#123;profile&#125;.properties</code> å’Œ YAML å˜é‡ï¼‰ã€‚</li><li>åœ¨å·²æ‰“åŒ…çš„ jar å¤–éƒ¨çš„åº”ç”¨å±æ€§æ–‡ä»¶ï¼ˆ<code>application.properties</code> å’Œ YAML å˜é‡ï¼‰ã€‚</li><li>åœ¨å·²æ‰“åŒ…çš„ jar å†…éƒ¨çš„åº”ç”¨å±æ€§æ–‡ä»¶ï¼ˆ<code>application.properties</code> å’Œ YAML å˜é‡ï¼‰ã€‚</li><li>åœ¨ <code>@Configuration</code> ç±»ä¸Šçš„ <code>@PropertySource</code> æ³¨è§£ã€‚</li><li>é»˜è®¤å±æ€§ï¼ˆä½¿ç”¨ <code>SpringApplication.setDefaultProperties</code> æŒ‡å®šï¼‰ã€‚</li></ol><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾å¼€å‘çš„ <code>@Component</code> ä½¿ç”¨äº† <code>name</code> å±æ€§ï¼Œå¯ä»¥è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºçš„ classpath ä¸­ï¼ˆæ¯”å¦‚åœ¨ jar ä¸­ï¼‰ï¼Œæ‚¨å¯ä»¥æœ‰ä¸€ä¸ª <code>application.properties</code>ï¼Œå®ƒä¸º <code>name</code> æä¾›äº†ä¸€ä¸ªåˆé€‚çš„é»˜è®¤å±æ€§å€¼ã€‚å½“åœ¨æ–°ç¯å¢ƒä¸­è¿è¡Œæ—¶ï¼Œæ‚¨å¯ä»¥åœ¨ jar å¤–é¢æä¾›ä¸€ä¸ª <code>application.properties</code> æ¥è¦†ç›– <code>name</code>ã€‚å¯¹äºä¸€æ¬¡æ€§æµ‹è¯•ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡ŒæŒ‡å®šå½¢å¼å¯åŠ¨ï¼ˆæ¯”å¦‚ <code>java -jar app.jar --name=&quot;Spring&quot;</code>ï¼‰ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p><code>SPRING_APPLICATION_JSON</code> å±æ€§å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­æä¾›ä¸€ä¸ªç¯å¢ƒå˜é‡ã€‚æ¯”å¦‚åœ¨ UN*X shell ä¸­ï¼š</p><figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ SPRING_APPLICATION_JSON=<span class="string">&#x27;&#123;&quot;</span>acme<span class="string">&quot;:&#123;&quot;</span>name<span class="string">&quot;:&quot;</span>test<span class="string">&quot;&#125;&#125;&#x27;</span> java -jar myapp.jar</span><br></pre></td></tr></table></figure><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‚¨å¯ä»¥åœ¨ Spring <code>Environment</code> ä¸­ä½¿ç”¨ <code>acme.name=test</code>ï¼Œä¹Ÿå¯ä»¥åœ¨ç³»ç»Ÿå±æ€§ï¼ˆSystem propertyï¼‰ä¸­å°† JSON ä½œä¸º <code>spring.application.json</code> å±æ€§æä¾›ï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -Dspring.<span class="built_in">application</span>.json=&#x27;&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;test&quot;</span>&#125;&#x27; -jar myapp.jar</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä»¥å‘½ä»¤è¡Œå‚æ•°å½¢å¼ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar myapp<span class="selector-class">.jar</span> <span class="attr">--spring</span><span class="selector-class">.application</span>.json=<span class="string">&#x27;&#123;&quot;name&quot;:&quot;test&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…å°† JSON ä½œä¸ºä¸€ä¸ª JNDI å˜é‡ï¼š<code>java:comp/env/spring.application.json</code>ã€‚</p></blockquote><p><a id="boot-features-external-config-random-values"></a></p><h3 id="24-1ã€é…ç½®éšæœºå€¼">24.1ã€é…ç½®éšæœºå€¼</h3><p><code>RandomValuePropertySource</code> å¯¹äºéšæœºå€¼æ³¨å…¥éå¸¸æœ‰ç”¨ï¼ˆæ¯”å¦‚åœ¨ä¿å¯†åœºæ™¯æˆ–è€…æµ‹è¯•ç”¨ä¾‹ä¸­)ã€‚å®ƒå¯ä»¥äº§ç”Ÿ integerã€longã€uuid å’Œ stringã€‚å¦‚ä¸‹ç¤ºä¾‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">my.secret</span>=<span class="variable">$&#123;random.value&#125;</span></span><br><span class="line"><span class="attr">my.number</span>=<span class="variable">$&#123;random.int&#125;</span></span><br><span class="line"><span class="attr">my.bignumber</span>=<span class="variable">$&#123;random.long&#125;</span></span><br><span class="line"><span class="attr">my.uuid</span>=<span class="variable">$&#123;random.uuid&#125;</span></span><br><span class="line"><span class="attr">my.number.less.than.ten</span>=<span class="variable">$&#123;random.int(10)&#125;</span></span><br><span class="line"><span class="attr">my.number.in.range</span>=<span class="variable">$&#123;random.int[1024,65536]&#125;</span></span><br></pre></td></tr></table></figure><p><code>random.int*</code> è¯­æ³•ä¸º <code>OPEN value (,max) CLOSE</code>ï¼Œ<code>OPEN,CLOSE</code> å¯ä¸ºä»»æ„å­—ç¬¦ï¼Œ<code>value,max</code> ä¸ºæ•´æ•°ã€‚å¦‚æœä½¿ç”¨äº† <code>max</code>ï¼Œ<code>value</code> åˆ™ä¸ºæœ€å°å€¼ï¼Œ<code>max</code> ä¸ºæœ€å¤§å€¼ã€‚</p><p><a id="boot-features-external-config-command-line-args"></a></p><h3 id="24-2ã€è®¿é—®å‘½ä»¤è¡Œå±æ€§">24.2ã€è®¿é—®å‘½ä»¤è¡Œå±æ€§</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>SpringApplication</code> å°†æ‰€æœ‰å‘½ä»¤è¡Œé€‰é¡¹å‚æ•°ï¼ˆå³ä»¥ <code>--</code> å¼€å¤´çš„å‚æ•°ï¼Œæ¯”å¦‚ <code>--server.port=9000</code>ï¼‰è½¬æ¢ä¸ºå±æ€§ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ° Spring <code>Environment</code> ä¸­ã€‚å¦‚ä¹‹å‰æ‰€è¿°ï¼Œå‘½ä»¤è¡Œå±æ€§å§‹ç»ˆä¼˜å…ˆäºå…¶ä»–å±æ€§æºã€‚</p><p>å¦‚æœæ‚¨ä¸å¸Œæœ›å°†å‘½ä»¤è¡Œå±æ€§æ·»åŠ åˆ° <code>Environment</code>ï¼Œå¯ä»¥ä½¿ç”¨ <code>SpringApplication.setAddCommandLineProperties(false)</code> æ¥ç¦ç”¨å®ƒä»¬ã€‚</p><p><a id="boot-features-external-config-application-property-files"></a></p><h3 id="24-3ã€åº”ç”¨ç¨‹åºå±æ€§æ–‡ä»¶">24.3ã€åº”ç”¨ç¨‹åºå±æ€§æ–‡ä»¶</h3><p><code>SpringApplication</code> ä»ä»¥ä¸‹ä½ç½®çš„ <code>application.properties</code> æ–‡ä»¶ä¸­åŠ è½½å±æ€§ï¼ˆpropertiesï¼‰ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ° Spring <code>Environment</code> ä¸­ï¼š</p><ol><li>å½“å‰ç›®å½•çš„ <code>/config</code> å­ç›®å½•</li><li>å½“å‰ç›®å½•</li><li>classpath ä¸Šçš„ <code>/config</code> åŒ…</li><li>classpath æ ¹è·¯å¾„</li></ol><p>åˆ—è¡¨æŒ‰åºå·ä¼˜å…ˆçº§æ’åºï¼Œåºå·è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <a href="#boot-features-external-config-yaml">YAMLï¼ˆ.ymlï¼‰</a>æ–‡ä»¶æ¥æ›¿ä»£ <strong>.properties</strong>ã€‚</p></blockquote><p>å¦‚æœæ‚¨ä¸å–œæ¬¢ <code>application.properties</code> ä½œä¸ºé…ç½®æ–‡ä»¶åï¼Œåˆ™å¯ä»¥é€šè¿‡æŒ‡å®š <code>spring.config.name</code> ç¯å¢ƒå±æ€§æ¥åˆ‡æ¢åˆ°å¦ä¸€ä¸ªæ–‡ä»¶åã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <code>spring.config.location</code> ç¯å¢ƒå±æ€§æ¥å¼•ç”¨ä¸€ä¸ªæ˜¾å¼ä½ç½®ï¼ˆä»¥é€—å·åˆ†éš”çš„ç›®å½•ä½ç½®æˆ–æ–‡ä»¶è·¯å¾„åˆ—è¡¨ï¼‰ã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æŒ‡å®šå…¶ä»–æ–‡ä»¶åï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">java </span>-<span class="keyword">jar </span>myproject.<span class="keyword">jar </span>--spring.config.name=myproject</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æŒ‡å®šä¸¤ä¸ªä½ç½®ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar myproject<span class="selector-class">.jar</span> <span class="attr">--spring</span><span class="selector-class">.config</span>.location=classpath:/default<span class="selector-class">.properties</span>,classpath:/override.properties</span><br></pre></td></tr></table></figure><p><strong>è­¦å‘Š</strong></p><blockquote><p><code>spring.config.name</code> å’Œ <code>spring.config.location</code> åœ¨ç¨‹åºå¯åŠ¨æ—©æœŸå°±ç”¨æ¥ç¡®å®šå“ªäº›æ–‡ä»¶å¿…é¡»åŠ è½½ï¼Œå› æ­¤å¿…é¡»å°†å®ƒä»¬å®šä¹‰ä¸ºç¯å¢ƒå±æ€§ï¼ˆé€šå¸¸æ˜¯ OS ç¯å¢ƒå˜é‡ã€ç³»ç»Ÿå±æ€§æˆ–å‘½ä»¤è¡Œå‚æ•°ï¼‰ã€‚</p></blockquote><p>å¦‚æœ <code>spring.config.location</code> åŒ…å«ç›®å½•ï¼ˆè€Œä¸æ˜¯æ–‡ä»¶ï¼‰ï¼Œåˆ™å®ƒä»¬åº”è¯¥ä»¥ <code>/</code> ç»“å°¾ï¼ˆå¹¶ä¸”åœ¨è¿è¡ŒæœŸé—´ï¼Œåœ¨åŠ è½½ä¹‹å‰è¿½åŠ ä» <code>spring.config.name</code> ç”Ÿæˆçš„åç§°ï¼ŒåŒ…æ‹¬æŒ‡å®š profile çš„æ–‡ä»¶åï¼‰ã€‚ <code>spring.config.location</code> ä¸­æŒ‡å®šçš„æ–‡ä»¶æŒ‰åŸæ ·ä½¿ç”¨ï¼Œä¸æ”¯æŒæŒ‡å®š profile å½¢å¼ï¼Œå¹¶ä¸”å¯è¢«ä»»ä½•æŒ‡å®š profile çš„æ–‡ä»¶çš„å±æ€§æ‰€è¦†ç›–ã€‚</p><p>é…ç½®ä½ç½®ä»¥ç›¸åçš„é¡ºåºæœç´¢ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé…ç½®çš„ä½ç½®ä¸º <code>classpath:/,classpath:/config/,file:./,file:./config/</code>ã€‚ç”Ÿæˆçš„æœç´¢é¡ºåºå¦‚ä¸‹ï¼š</p><ol><li><code>file:./config/</code></li><li><code>file:./</code></li><li><code>classpath:/config/</code></li><li><code>classpath:/</code></li></ol><p>ä½¿ç”¨äº† <code>spring.config.location</code> é…ç½®è‡ªå®šä¹‰é…ç½®ä½ç½®æ—¶ï¼Œé»˜è®¤ä½ç½®é…ç½®å°†è¢«æ›¿ä»£ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ <code>spring.config.location</code> é…ç½®ä¸º <code>classpath:/custom-config/,file:./custom-config/</code>ï¼Œæœç´¢é¡ºåºå°†å˜ä¸ºä»¥ä¸‹ï¼š</p><ol><li><code>file:./custom-config/</code></li><li><code>classpath:custom-config/</code></li></ol><p>æˆ–è€…ï¼Œå½“ä½¿ç”¨ <code>spring.config.additional-location</code> é…ç½®è‡ªå®šä¹‰é…ç½®ä½ç½®æ—¶ï¼Œé™¤äº†ä½¿ç”¨é»˜è®¤ä½ç½®å¤–ï¼Œè¿˜ä¼šä½¿ç”¨å®ƒä»¬ã€‚è¿™äº›å…¶ä»–ï¼ˆadditionalï¼‰ä½ç½®å°†åœ¨é»˜è®¤ä½ç½®ä¹‹å‰æœç´¢ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°†å…¶ä»–ä½ç½®é…ç½®ä¸º <code>classpath:/custom-config/,file:./custom-config/</code>ï¼Œåˆ™æœç´¢é¡ºåºå°†å˜ä¸ºä»¥ä¸‹å†…å®¹ï¼š</p><ol><li><code>file:./custom-config/</code></li><li><code>classpath:custom-config/</code></li><li><code>file:./config/</code></li><li><code>file:./</code></li><li><code>classpath:/config/</code></li><li><code>classpath:/</code></li></ol><p>è¯¥æœç´¢é¡ºåºå…è®¸æ‚¨åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­æŒ‡å®šé»˜è®¤å€¼ï¼Œç„¶åæœ‰é€‰æ‹©åœ°è¦†ç›–å¦ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­çš„å€¼ã€‚æ‚¨å¯ä»¥åœ¨ <code>application.properties</code>ï¼ˆæˆ–æ‚¨ä½¿ç”¨ <code>spring.config.name</code> æŒ‡å®šçš„å…¶ä»–æ–‡ä»¶ï¼‰ä¸­çš„æŸä¸ªé»˜è®¤ä½ç½®ä¸ºåº”ç”¨ç¨‹åºæä¾›é»˜è®¤å€¼ã€‚ä¹‹åï¼Œåœ¨è¿è¡Œæ—¶ï¼Œè¿™äº›é»˜è®¤å€¼å°†è¢«è‡ªå®šä¹‰ä½ç½®ä¸­çš„æŸä¸ªæ–‡ä»¶æ‰€è¦†ç›–ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ç¯å¢ƒå˜é‡è€Œä¸æ˜¯ç³»ç»Ÿå±æ€§ï¼Œå¤§éƒ¨åˆ†æ“ä½œç³»ç»Ÿéƒ½ä¸å…è®¸ä½¿ç”¨ <code>.</code> åˆ†éš”çš„é”®åï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿æ¥ä»£æ›¿ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ <code>SPRING_CONFIG_NAME</code> è€Œä¸æ˜¯ <code>spring.config.name</code>ï¼‰ã€‚</p></blockquote><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœåº”ç”¨ç¨‹åºåœ¨å®¹å™¨ä¸­è¿è¡Œï¼Œåˆ™å¯ä»¥ä½¿ç”¨ JNDI å±æ€§ï¼ˆ<code>java:comp/env</code>ï¼‰æˆ– servlet ä¸Šä¸‹æ–‡åˆå§‹åŒ–å‚æ•°æ¥ä»£æ›¿ç¯å¢ƒå˜é‡æˆ–ç³»ç»Ÿå±æ€§ã€‚</p></blockquote><p><a id="boot-features-external-config-profile-specific-properties"></a></p><h3 id="24-4ã€ç‰¹å®š-Profile-çš„å±æ€§æ–‡ä»¶">24.4ã€ç‰¹å®š Profile çš„å±æ€§æ–‡ä»¶</h3><p>é™¤ <code>application.properties</code> æ–‡ä»¶å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½åçº¦å®šå®šä¹‰ç‰¹å®š profile çš„å±æ€§æ–‡ä»¶ï¼š<code>application-&#123;profile&#125;.properties</code>ã€‚<code>Environment</code> æœ‰ä¸€ç»„é»˜è®¤é…ç½®æ–‡ä»¶ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¸º <code>default</code>ï¼‰ï¼Œå¦‚æœæœªè®¾ç½®æ¿€æ´»çš„ï¼ˆactiveï¼‰profileï¼Œåˆ™ä½¿ç”¨è¿™äº›é…ç½®æ–‡ä»¶ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼æ¿€æ´» profileï¼Œåˆ™ä¼šåŠ è½½ <code>application-default.properties</code> ä¸­çš„å±æ€§ã€‚</p><p>ç‰¹å®š profile çš„å±æ€§æ–‡ä»¶ä»ä¸æ ‡å‡† <code>application.properties</code> ç›¸åŒçš„ä½ç½®åŠ è½½ï¼Œç‰¹å®š profile çš„å±æ€§æ–‡ä»¶æ— è®ºæ˜¯å¦åœ¨æ‰“åŒ…çš„ jar å†…éƒ¨ï¼Œéƒ½å§‹ç»ˆè¦†ç›–éç‰¹å®šæ–‡ä»¶ã€‚</p><p>å¦‚æœæŒ‡å®šäº†å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œåˆ™åº”ç”¨ last-wins ç­–ç•¥ï¼ˆä¼˜å…ˆé‡‡å–æœ€åä¸€ä¸ªï¼‰ã€‚ä¾‹å¦‚ï¼Œ<code>spring.profiles.active</code> å±æ€§æŒ‡å®šçš„é…ç½®æ–‡ä»¶æ˜¯åœ¨ä½¿ç”¨ <code>SpringApplication</code> API é…ç½®çš„é…ç½®æ–‡ä»¶ä¹‹åæ·»åŠ çš„ï¼Œå› æ­¤ä¼˜å…ˆåº”ç”¨ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœåœ¨ <code>spring.config.location</code> ä¸­æŒ‡å®šäº†æ–‡ä»¶ï¼Œåˆ™ä¸è€ƒè™‘è¿™äº›æ–‡ä»¶çš„ç‰¹å®š profile å½¢å¼ã€‚å¦‚æœæ‚¨è¿˜æƒ³ä½¿ç”¨ç‰¹å®š profile çš„å±æ€§æ–‡ä»¶ï¼Œè¯·åœ¨ <code>spring.config.location</code> ä¸­ä½¿ç”¨ç›®å½•å½¢å¼ã€‚</p></blockquote><p><a id="boot-features-external-config-placeholders-in-properties"></a></p><h3 id="24-5ã€å±æ€§ä¸­çš„å ä½ç¬¦">24.5ã€å±æ€§ä¸­çš„å ä½ç¬¦</h3><p><code>application.properties</code> ä¸­çš„å€¼åœ¨ä½¿ç”¨æ—¶é€šè¿‡ç°æœ‰çš„ <code>Environment</code> è¿›è¡Œè¿‡æ»¤ï¼Œå› æ­¤æ‚¨å¯ä»¥è¿”å›ä¹‹å‰å®šä¹‰çš„å€¼ï¼ˆä¾‹å¦‚ï¼Œä»ç³»ç»Ÿå±æ€§ï¼‰ã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">app.name</span>=MyApp</span><br><span class="line"><span class="attr">app.description</span>=<span class="variable">$&#123;app.name&#125;</span> is a Spring Boot application</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨æ­¤æŠ€æœ¯åˆ›å»ºç°æœ‰ Spring Boot å±æ€§çš„<strong>ç®€çŸ­</strong>å½¢å¼ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="hwo-to.md#howto-use-short-command-line-arguments">ç¬¬ 77.4 ç« èŠ‚ï¼šä½¿ç”¨<strong>ç®€çŸ­</strong>å‘½ä»¤è¡Œå‚æ•°</a>ã€‚</p></blockquote><p><a id="boot-features-encrypting-properties"></a></p><h3 id="24-6ã€åŠ å¯†å±æ€§">24.6ã€åŠ å¯†å±æ€§</h3><p>Spring Boot æ²¡æœ‰ä¸ºåŠ å¯†å±æ€§å€¼æä¾›ä»»ä½•å†…ç½®æ”¯æŒï¼Œç„¶è€Œï¼Œå®ƒæä¾›äº†ä¿®æ”¹ Spring <code>Environment</code> åŒ…å«çš„å€¼æ‰€å¿…éœ€çš„é’©å­ã€‚<code>EnvironmentPostProcessor</code> æ¥å£å…è®¸æ‚¨åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨ä¹‹å‰æ“ä½œ <code>Environment</code>ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="how-to.md#howto-customize-the-environment-or-application-context">ç¬¬ 76.3 ç« èŠ‚ï¼šåœ¨å¯åŠ¨å‰è‡ªå®šä¹‰ Environment æˆ– ApplicationContext</a>ã€‚</p><p>å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾ä¸€ç§å¯ç”¨äºå­˜å‚¨å‡­æ®å’Œå¯†ç çš„å®‰å…¨æ–¹æ³•ï¼Œ<a href="https://cloud.spring.io/spring-cloud-vault/">Spring Cloud Vault</a> é¡¹ç›®æ”¯æŒåœ¨ <a href="https://www.vaultproject.io/">HashiCorp Vault</a> ä¸­å­˜å‚¨å¤–éƒ¨åŒ–é…ç½®ã€‚</p><p><a id="boot-features-external-config-yaml"></a></p><h3 id="24-7ã€ä½¿ç”¨-YAML-ä»£æ›¿å±æ€§æ–‡ä»¶">24.7ã€ä½¿ç”¨ YAML ä»£æ›¿å±æ€§æ–‡ä»¶</h3><p><a href="http://yaml.org/">YAML</a> æ˜¯ JSON çš„è¶…é›†ï¼Œæ˜¯ä¸€ä¸ªå¯ç”¨äºæŒ‡å®šå±‚çº§é…ç½®æ•°æ®çš„ä¾¿æ·æ ¼å¼ã€‚åªè¦åœ¨ classpath ä¸Šæœ‰ <a href="http://www.snakeyaml.org/">SnakeYAML</a> åº“ï¼Œ<code>SpringApplication</code> ç±»å°±ä¼šè‡ªåŠ¨æ”¯æŒ YAML ä½œä¸ºå±æ€§æ–‡ä»¶ï¼ˆpropertiesï¼‰çš„æ›¿ä»£ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœä½¿ç”¨ <strong>starter</strong>ï¼Œåˆ™ <code>spring-boot-starter</code> ä¼šè‡ªåŠ¨æä¾› SnakeYAMLã€‚</p></blockquote><p><a id="boot-features-external-config-loading-yaml"></a></p><h4 id="24-7-1ã€åŠ è½½-YAML">24.7.1ã€åŠ è½½ YAML</h4><p>Spring Framework æä¾›äº†ä¸¤ä¸ªä¾¿æ·ç±»ï¼Œå¯ç”¨äºåŠ è½½ YAML æ–‡æ¡£ã€‚<code>YamlPropertiesFactoryBean</code> å°† YAML åŠ è½½ä¸º <code>Properties</code>ï¼Œ<code>YamlMapFactoryBean</code> å°† YAML åŠ è½½ä¸º <code>Map</code>ã€‚</p><p>ä¾‹å¦‚ä»¥ä¸‹ YAML æ–‡æ¡£ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">environments:</span></span><br><span class="line">  <span class="attr">dev:</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">http://dev.example.com</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Developer</span> <span class="string">Setup</span></span><br><span class="line">  <span class="attr">prod:</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">http://another.example.com</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">My</span> <span class="string">Cool</span> <span class="string">App</span></span><br></pre></td></tr></table></figure><p>å‰é¢çš„ç¤ºä¾‹å°†è½¬æ¢ä¸ºä»¥ä¸‹å±æ€§ï¼ˆpropertiesï¼‰ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">environments.dev.url</span>=http://dev.example.com</span><br><span class="line"><span class="attr">environments.dev.name</span>=Developer Setup</span><br><span class="line"><span class="attr">environments.prod.url</span>=http://another.example.com</span><br><span class="line"><span class="attr">environments.prod.name</span>=My Cool App</span><br></pre></td></tr></table></figure><p>YAML åˆ—è¡¨è¡¨ç¤ºå¸¦æœ‰ <code>[index]</code> ä¸‹æ ‡å¼•ç”¨çš„å±æ€§é”®ã€‚ä¾‹å¦‚ä»¥ä¸‹ YAMLï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">my:</span></span><br><span class="line"><span class="attr">servers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">dev.example.com</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">another.example.com</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šç¤ºä¾‹å°†è½¬æˆä»¥ä¸‹å±æ€§ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">my.servers<span class="section">[0]</span>=dev.example.com</span><br><span class="line">my.servers<span class="section">[1]</span>=another.example.com</span><br></pre></td></tr></table></figure><p>è¦ä½¿ç”¨ Spring Boot çš„ <code>Binder</code> å·¥å…·æ¥ç»‘å®šè¿™æ ·é…ç½®åˆ°å±æ€§ï¼ˆè¿™æ˜¯ <code>@ConfigurationProperties</code> æ‰€åšçš„ï¼‰ï¼Œä½ éœ€è¦åœ¨ç›®æ ‡ bean ä¸­æœ‰ä¸€ä¸ª <code>java.util.List</code>ï¼ˆæˆ– <code>Set</code>ï¼‰ç±»å‹çš„å±æ€§ï¼Œä½ éœ€è¦ä¸ºå…¶æä¾›ä¸€ä¸ª setter æˆ–è€…ä½¿ç”¨å¯å˜å€¼åˆå§‹åŒ–å®ƒã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºå°†ä¸Šè¿°çš„é…ç½®ä¸å±æ€§ç»‘å®šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix=&quot;my&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Config</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List&lt;String&gt; servers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getServers</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.servers;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="boot-features-external-config-exposing-yaml-to-spring"></a></p><h4 id="24-7-2ã€åœ¨-Spring-Environment-ä¸­å°†-YAML-æš´éœ²ä¸ºå±æ€§">24.7.2ã€åœ¨ Spring Environment ä¸­å°† YAML æš´éœ²ä¸ºå±æ€§</h4><p><code>YamlPropertySourceLoader</code> ç±»å¯ç”¨äºåœ¨ Spring <code>Environment</code> ä¸­å°† YAML æš´éœ²ä¸º <code>PropertySource</code>ã€‚è¿™æ ·åšå¯ä»¥è®©æ‚¨ä½¿ç”¨å¸¦å ä½ç¬¦è¯­æ³•çš„ <code>@Value</code> æ³¨è§£æ¥è®¿é—® YAML å±æ€§ã€‚</p><p><a id="boot-features-external-config-multi-profile-yaml"></a></p><h4 id="24-7-3ã€å¤š-profile-YAML-æ–‡æ¡£">24.7.3ã€å¤š profile YAML æ–‡æ¡£</h4><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>spring.profiles</code> key åœ¨å•ä¸ªæ–‡ä»¶ä¸­æŒ‡å®šå¤šä¸ªç‰¹å®š profile çš„ YAML æ–‡æ¡£ï¼Œä»¥æŒ‡ç¤ºæ–‡æ¡£ä½•æ—¶åº”ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">address:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">development</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">production</span> <span class="string">&amp;</span> <span class="string">eu-central</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">address:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.120</span></span><br></pre></td></tr></table></figure><p>åœ¨å‰é¢ç¤ºä¾‹ä¸­ï¼Œå¦‚æœ <code>development</code> profile å¤„äºæ¿€æ´»çŠ¶æ€ï¼Œåˆ™ <code>server.address</code> å±æ€§å¾—å€¼ä¸º <code>127.0.0.1</code>ã€‚ åŒæ ·ï¼Œå¦‚æœ <code>production</code> å’Œ <code>eu-central</code> profile å¤„äºæ¿€æ´»çŠ¶æ€ï¼Œåˆ™ <code>server.address</code> å±æ€§çš„å€¼ä¸º <code>192.168.1.120</code>ã€‚å¦‚æœæœªæ¿€æ´» <code>development</code>ã€<code>production</code> æˆ– <code>eu-central</code> profileï¼Œåˆ™è¯¥å±æ€§çš„å€¼ä¸º <code>192.168.1.100</code>ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>å› æ­¤ï¼Œ<code>spring.profiles</code> å¯ä»¥åŒ…å«ä¸€ä¸ªç®€å•çš„ profile åç§°ï¼ˆä¾‹å¦‚ <code>production</code>ï¼‰æˆ–ä¸€ä¸ª profile è¡¨è¾¾å¼ã€‚profile è¡¨è¾¾å¼å…è®¸è¡¨è¾¾æ›´å¤æ‚çš„ profile é€»è¾‘ï¼Œä¾‹å¦‚ <code>production &amp; (eu-central | eu-west)</code>ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥é˜…<a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/core.html#beans-definition-profiles-java">å‚è€ƒæŒ‡å—</a>ã€‚</p></blockquote><p>å¦‚æœåœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡å¯åŠ¨æ—¶æ²¡æœ‰æ˜¾å¼æ¿€æ´»ï¼Œåˆ™æ¿€æ´»é»˜è®¤ profileã€‚å› æ­¤ï¼Œåœ¨ä»¥ä¸‹ YAML ä¸­ï¼Œæˆ‘ä»¬ä¸º <code>spring.security.user.password</code> è®¾ç½®äº†ä¸€ä¸ªå€¼ï¼Œè¯¥å€¼<strong>ä»…</strong>åœ¨ <code>default</code> profile ä¸­å¯ç”¨ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8000</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">security:</span></span><br><span class="line">    <span class="attr">user:</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">weak</span></span><br></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œåœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œå§‹ç»ˆè®¾ç½®å¯†ç ï¼Œå› ä¸ºå®ƒæœªé™„åŠ åˆ°ä»»ä½• profileï¼Œå¦‚æœéœ€è¦æ›´æ”¹ï¼Œå¿…é¡»åœ¨æ‰€æœ‰å…¶ä»– profile ä¸­æ˜¾å¼é‡ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">security:</span></span><br><span class="line">    <span class="attr">user:</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">weak</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>spring.profiles</code> å…ƒç´ æ¥æŒ‡å®š Spring profile å¯ä»¥é€‰æ‹©é€šè¿‡ä½¿ç”¨ <code>!</code> å­—ç¬¦æ¥å–åï¼ˆå¦å®šï¼‰ã€‚å¦‚æœä¸ºå•ä¸ªæ–‡æ¡£æŒ‡å®šäº†å¦å®šå’Œéå¦å®šçš„ profileï¼Œåˆ™è‡³å°‘ä¸€ä¸ªéå¦å®šçš„ profile å¿…é¡»åŒ¹é…ï¼Œæ²¡æœ‰å¦å®šçš„ profile å¯ä»¥åŒ¹é…ã€‚</p><p><a id="boot-features-external-config-yaml-shortcomings"></a></p><h4 id="24-7-4ã€YAML-çš„ç¼ºç‚¹">24.7.4ã€YAML çš„ç¼ºç‚¹</h4><p>æ— æ³•ä½¿ç”¨ <code>@PropertySource</code> æ³¨è§£åŠ è½½ YAML æ–‡ä»¶ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨éœ€è¦ä»¥è¿™ç§æ–¹å¼åŠ è½½å€¼ï¼Œè¯·ä½¿ç”¨å±æ€§æ–‡ä»¶ï¼ˆpropertiesï¼‰ã€‚</p><p><a id="boot-features-external-config-typesafe-configuration-properties"></a></p><h3 id="24-8ã€ç±»å‹å®‰å…¨çš„é…ç½®å±æ€§">24.8ã€ç±»å‹å®‰å…¨çš„é…ç½®å±æ€§</h3><p>ä½¿ç”¨ <code>@Value(&quot;$&#123;property&#125;&quot;)</code> æ³¨è§£æ¥æ³¨å…¥é…ç½®å±æ€§æœ‰æ—¶ä¼šå¾ˆéº»çƒ¦ï¼Œç‰¹åˆ«æ˜¯å¦‚æœæ‚¨ä½¿ç”¨äº†å¤šä¸ªå±æ€§æˆ–è€…æ‚¨çš„æ•°æ®æœ¬è´¨ä¸Šæ˜¯åˆ†å±‚ç»“æ„ã€‚Spring Boot æä¾›äº†å¦ä¸€ç§ä½¿ç”¨å±æ€§çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä½¿ç”¨å¼ºç±»å‹çš„ bean æ¥ç®¡ç†å’ŒéªŒè¯åº”ç”¨ç¨‹åºçš„é…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;acme&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AcmeProperties</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> enabled;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> InetAddress remoteAddress;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Security</span> <span class="variable">security</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Security</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEnabled</span><span class="params">(<span class="type">boolean</span> enabled)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> InetAddress <span class="title function_">getRemoteAddress</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRemoteAddress</span><span class="params">(InetAddress remoteAddress)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Security <span class="title function_">getSecurity</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Security</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List&lt;String&gt; roles = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(Collections.singleton(<span class="string">&quot;USER&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getRoles</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRoles</span><span class="params">(List&lt;String&gt; roles)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‰é¢çš„ POJO å®šä¹‰äº†ä»¥ä¸‹å±æ€§ï¼š</p><ul><li><code>acme.enabled</code>ï¼Œé»˜è®¤å€¼ä¸º <code>false</code>ã€‚</li><li><code>acme.remote-address</code>ï¼Œå¯ä»¥ä» String å¼ºåˆ¶è½¬æ¢çš„ç±»å‹ã€‚</li><li><code>acme.security.username</code>ï¼Œå†…åµŒä¸€ä¸ª <strong>security</strong> å¯¹è±¡ï¼Œå…¶åç§°ç”±å±æ€§åç§°å†³å®šã€‚ç‰¹åˆ«æ˜¯ï¼Œè¿”å›ç±»å‹æ ¹æœ¬æ²¡æœ‰ä½¿ç”¨ï¼Œå¯èƒ½æ˜¯ <code>SecurityProperties</code>ã€‚</li><li><code>acme.security.password</code>ã€‚</li><li><code>acme.security.roles</code>ï¼ŒString é›†åˆã€‚</li></ul><p><strong>æ³¨æ„</strong></p><blockquote><p>getter å’Œ setter é€šå¸¸æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºç»‘å®šæ˜¯é€šè¿‡æ ‡å‡†çš„ Java Bean å±æ€§æè¿°ç¬¦æ¥å®Œæˆï¼Œå°±åƒåœ¨ Spring MVC ä¸­ä¸€æ ·ã€‚ä»¥ä¸‹æƒ…å†µå¯ä»¥çœç•¥ setterï¼š</p><ul><li>Mapï¼Œåªè¦å®ƒä»¬è¦åˆå§‹åŒ–ï¼Œå°±éœ€è¦ä¸€ä¸ª getter ä½†ä¸ä¸€å®šéœ€è¦setterï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥è¢« binder ä¿®æ”¹ã€‚</li><li>é›†åˆå’Œæ•°ç»„å¯ä»¥é€šè¿‡ä¸€ä¸ªç´¢å¼•ï¼ˆé€šå¸¸ä½¿ç”¨ YAMLï¼‰æˆ–ä½¿ç”¨å•ä¸ªé€—å·åˆ†éš”å€¼ï¼ˆå±æ€§ï¼‰è¿›è¡Œè®¿é—®ã€‚æœ€åä¸€ç§æƒ…å†µå¿…é¡»ä½¿ç”¨ setterã€‚æˆ‘ä»¬å»ºè®®å§‹ç»ˆä¸ºæ­¤ç±»å‹æ·»åŠ  setterã€‚å¦‚æœåˆå§‹åŒ–é›†åˆï¼Œè¯·ç¡®ä¿å®ƒæ˜¯å¯å˜çš„ï¼ˆå¦‚ä¸Šä¾‹æ‰€ç¤ºï¼‰ã€‚</li><li>å¦‚æœåˆå§‹åŒ–åµŒå¥—çš„ POJO å±æ€§ï¼ˆå¦‚å‰é¢ç¤ºä¾‹ä¸­çš„ <code>Security</code> å­—æ®µï¼‰ï¼Œåˆ™ä¸éœ€è¦ setterã€‚å¦‚æœæ‚¨å¸Œæœ› binder ä½¿ç”¨å…¶é»˜è®¤æ„é€ å‡½æ•°åŠ¨æ€åˆ›å»ºå®ä¾‹ï¼Œåˆ™éœ€è¦ä¸€ä¸ª setterã€‚</li></ul><p>æœ‰äº›äººå¯èƒ½ä¼šä½¿ç”¨ Project Lombok æ¥è‡ªåŠ¨ç”Ÿæˆ getter å’Œ setterã€‚è¯·ç¡®ä¿ Lombok ä¸ä¸ºæ­¤ç±»å‹ç”Ÿæˆä»»ä½•ç‰¹å®šæ„é€ å‡½æ•°ï¼Œå› ä¸ºå®¹å™¨ä¼šè‡ªåŠ¨ä½¿ç”¨å®ƒæ¥å®ä¾‹åŒ–å¯¹è±¡ã€‚</p><p>æœ€åï¼Œè€ƒè™‘åˆ°æ ‡å‡† Java Bean å±æ€§ï¼Œä¸æ”¯æŒå¯¹é™æ€å±æ€§çš„ç»‘å®šã€‚</p></blockquote><p><strong>æç¤º</strong></p><blockquote><p>å¦è¯·å‚é˜… <a href="#boot-features-external-config-vs-value">@Value å’Œ @ConfigurationProperties ä¹‹é—´çš„å·®å¼‚</a>ã€‚</p></blockquote><p>æ‚¨è¿˜éœ€è¦åˆ—å‡ºè¦åœ¨ <code>@EnableConfigurationProperties</code> æ³¨è§£ä¸­æ³¨å†Œçš„å±æ€§ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(AcmeProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfiguration</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>å½“ä»¥è¿™ç§æ–¹å¼æ³¨å†Œ <code>@ConfigurationProperties</code> bean æ—¶ï¼Œbean å…·æœ‰ä¸€ä¸ªå›ºå®šæ ¼å¼çš„åç§°ï¼š<code>&lt;prefix&gt;-&lt;fqn&gt;</code>ï¼Œå…¶ä¸­ <code>&lt;prefix&gt;</code> æ˜¯ <code>@ConfigurationProperties</code> æ³¨è§£ä¸­æŒ‡å®šçš„ç¯å¢ƒ key å‰ç¼€ï¼Œ<code>&lt;fqn&gt;</code> æ˜¯ bean çš„å®Œå…¨é™å®šç±»åã€‚å¦‚æœæ³¨è§£æœªæä¾›ä»»ä½•å‰ç¼€ï¼Œåˆ™ä»…ä½¿ç”¨ bean çš„å®Œå…¨é™å®šç±»åã€‚</p><p>ä¸Šé¢ç¤ºä¾‹ä¸­çš„ bean åç§°ä¸º <code>acme-com.example.AcmeProperties</code>ã€‚</p></blockquote><p>å³ä½¿å‰é¢çš„é…ç½®ä¸º <code>AcmeProperties</code> åˆ›å»ºäº†ä¸€ä¸ª beanï¼Œæˆ‘ä»¬ä¹Ÿå»ºè®® <code>@ConfigurationProperties</code> åªå¤„ç†ç¯å¢ƒï¼ˆenvironmentï¼‰ï¼Œç‰¹åˆ«æ˜¯ä¸è¦ä»ä¸Šä¸‹æ–‡ä¸­æ³¨å…¥å…¶ä»– beanã€‚è¯è™½å¦‚æ­¤ï¼Œ<code>@EnableConfigurationProperties</code> æ³¨è§£ä¹Ÿä¼šè‡ªåŠ¨åº”ç”¨åˆ°æ‚¨çš„é¡¹ç›®ï¼Œä»¥ä¾¿ä» <code>Environment</code> é…ç½®ä½¿ç”¨äº† <code>@ConfigurationProperties</code> æ³¨è§£çš„æ‰€æœ‰<strong>ç°æœ‰</strong>çš„ beanã€‚æ‚¨å¯ä»¥é€šè¿‡ç¡®ä¿ <code>AcmeProperties</code> å·²ç»æ˜¯ä¸€ä¸ª bean æ¥å¿«æ·ç”Ÿæˆ <code>MyConfiguration</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix=&quot;acme&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AcmeProperties</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... see the preceding example</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§é…ç½®é£æ ¼ç‰¹åˆ«é€‚ç”¨äº <code>SpringApplication</code> å¤–éƒ¨ YAML é…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">acme:</span></span><br><span class="line"><span class="attr">remote-address:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line"><span class="attr">security:</span></span><br><span class="line"><span class="attr">username:</span> <span class="string">admin</span></span><br><span class="line"><span class="attr">roles:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">USER</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ADMIN</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># additional configuration as required</span></span><br></pre></td></tr></table></figure><p>è¦ä½¿ç”¨ <code>@ConfigurationProperties</code> beanï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸å…¶ä»– bean ç›¸åŒçš„æ–¹å¼æ³¨å…¥å®ƒä»¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> AcmeProperties properties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyService</span><span class="params">(AcmeProperties properties)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.properties = properties;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">openConnection</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">Server</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Server</span>(<span class="built_in">this</span>.properties.getRemoteAddress());</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>ä½¿ç”¨ <code>@ConfigurationProperties</code> è¿˜å¯ä»¥ç”Ÿæˆå…ƒæ•°æ®æ–‡ä»¶ï¼ŒIDE å¯ä»¥é€šè¿‡è¿™äº›æ–‡ä»¶æ¥ä¸ºæ‚¨è‡ªå·±çš„ key æä¾›è‡ªåŠ¨å®ŒæˆåŠŸèƒ½ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/reference/htmlsingle/#configuration-metadata">é™„å½• Bï¼šé…ç½®å…ƒæ•°æ®</a>ã€‚</p></blockquote><p><a id="boot-features-external-config-3rd-party-configuration"></a></p><h4 id="24-8-1ã€ç¬¬ä¸‰æ–¹é…ç½®">24.8.1ã€ç¬¬ä¸‰æ–¹é…ç½®</h4><p><code>@ConfigurationProperties</code> é™¤äº†å¯ä»¥ä½¿ç”¨æ¥æ³¨è§£ç±»ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥åœ¨å…¬å…±çš„ @Bean æ–¹æ³•ä¸Šä½¿ç”¨ã€‚å½“æ‚¨æƒ³è¦å°†å±æ€§ç»‘å®šåˆ°æ‚¨æŒæ§ä¹‹å¤–çš„ç¬¬ä¸‰æ–¹ç»„ä»¶æ—¶ï¼Œè¿™æ ·åšç‰¹åˆ«æœ‰ç”¨ã€‚</p><p>è¦ä½¿ç”¨ <code>Environment</code> å±æ€§é…ç½® beanï¼Œè¯·å°† <code>@ConfigurationProperties</code> æ·»åŠ åˆ° bean æ³¨å†Œä¸Šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;another&quot;)</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> AnotherComponent <span class="title function_">anotherComponent</span><span class="params">()</span> &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>another</code> å‰ç¼€å®šä¹‰çš„æ‰€æœ‰å±æ€§éƒ½ä½¿ç”¨ä¸å‰é¢çš„ <code>AcmeProperties</code> ç¤ºä¾‹ç±»ä¼¼çš„æ–¹å¼æ˜ å°„åˆ° <code>AnotherComponent</code> beanã€‚</p><p><a id="boot-features-external-config-relaxed-binding"></a></p><h4 id="24-8-2ã€å®½æ¾ç»‘å®š">24.8.2ã€å®½æ¾ç»‘å®š</h4><p>Spring Boot ä½¿ç”¨ä¸€äº›å®½æ¾çš„è§„åˆ™å°† <code>Environment</code> å±æ€§ç»‘å®šåˆ° <code>@ConfigurationProperties</code> beanï¼Œå› æ­¤ <code>Environment</code> å±æ€§åä¸éœ€è¦å’Œ bean å±æ€§åç²¾ç¡®åŒ¹é…ã€‚å¸¸è§çš„ç¤ºä¾‹åŒ…æ‹¬ä½¿ç”¨äº† <code>-</code> ç¬¦å·åˆ†å‰²çš„ç¯å¢ƒå±æ€§ï¼ˆä¾‹å¦‚ï¼Œ<code>context-path</code> ç»‘å®šåˆ° <code>contextPath</code>ï¼‰å’Œå¤§å†™ç¯å¢ƒå±æ€§ï¼ˆä¾‹å¦‚ï¼Œ<code>PORT</code> ç»‘å®šåˆ° <code>port</code>ï¼‰ã€‚</p><p>å¦‚ä¸‹ <code>@ConfigurationProperties</code> ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix=&quot;acme.my-project.person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OwnerProperties</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String firstName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getFirstName</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.firstName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFirstName</span><span class="params">(String firstName)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.firstName = firstName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å±æ€§åç§°ï¼š</p><p><strong>è¡¨ 24.1ã€å®½æ¾ç»‘å®š</strong></p><table><thead><tr><th>å±æ€§</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>acme.my-project.person.first-name</code></td><td>Kebab é£æ ¼ï¼ˆçŸ­æ¨ªçº¿å‘½åï¼‰ï¼Œå»ºè®®åœ¨ <code>.properties</code> å’Œ <code>.yml</code> æ–‡ä»¶ä¸­ä½¿ç”¨ã€‚</td></tr><tr><td><code>acme.myProject.person.firstName</code></td><td>æ ‡å‡†é©¼å³°å¼é£æ ¼ã€‚</td></tr><tr><td><code>acme.my_project.person.first_name</code></td><td>ä¸‹åˆ’çº¿è¡¨ç¤ºæ³•ï¼Œ<code>.properties</code> å’Œ <code>.yaml</code> æ–‡ä»¶ä¸­çš„å¦å¤–ä¸€ç§æ ¼å¼ã€‚</td></tr><tr><td><code>ACME_MYPROJECT_PERSON_FIRSTNAME</code></td><td>å¤§å†™é£æ ¼ï¼Œå½“ä½¿ç”¨ç³»ç»Ÿç¯å¢ƒå˜é‡æ—¶æ¨èä½¿ç”¨è¯¥é£æ ¼ã€‚</td></tr></tbody></table><p><strong>æ³¨æ„</strong></p><blockquote><p>æ³¨è§£çš„ <code>prefix</code> å€¼å¿…é¡»æ˜¯ kebab (çŸ­æ¨ªçº¿å‘½å)é£æ ¼ï¼ˆå°å†™å¹¶ç”¨ <code>-</code> åˆ†éš”ï¼Œä¾‹å¦‚ <code>acme.my-project.person</code>ï¼‰ã€‚</p></blockquote><p><strong>è¡¨ 24.2ã€æ¯ç§å±æ€§æºï¼ˆproperty sourceï¼‰çš„å®½æ¾ç»‘å®šè§„åˆ™</strong></p><table><thead><tr><th>å±æ€§æº</th><th>ç®€å•ç±»å‹</th><th>åˆ—è¡¨é›†åˆç±»å‹</th></tr></thead><tbody><tr><td>properties æ–‡ä»¶</td><td>é©¼å³°å¼ã€çŸ­æ¨ªçº¿å¼æˆ–ä¸‹åˆ’çº¿å¼</td><td>æ ‡å‡†åˆ—è¡¨è¯­æ³•ä½¿ç”¨ <code>[]</code> æˆ–é€—å·åˆ†éš”å€¼</td></tr><tr><td>YAML æ–‡ä»¶</td><td>é©¼å³°å¼ã€çŸ­æ¨ªçº¿å¼æˆ–è€…ä¸‹åˆ’çº¿å¼</td><td>æ ‡å‡† YAML åˆ—è¡¨è¯­æ³•æˆ–è€…é€—å·åˆ†éš”å€¼</td></tr><tr><td>ç¯å¢ƒå˜é‡</td><td>å¤§å†™å¹¶ä¸”ä»¥ä¸‹åˆ’çº¿ä½œä¸ºå®šç•Œç¬¦ï¼Œ<code>_</code> ä¸èƒ½æ”¾åœ¨å±æ€§åä¹‹é—´ä½¿ç”¨</td><td>æ•°å­—å€¼ä¸¤è¾¹ä½¿ç”¨ä¸‹åˆ’çº¿è¿æ¥ï¼Œä¾‹å¦‚ <code>MY_ACME_1_OTHER = my.acme[1].other</code></td></tr><tr><td>ç³»ç»Ÿå±æ€§</td><td>é©¼å³°å¼ã€çŸ­æ¨ªçº¿å¼æˆ–è€…ä¸‹åˆ’çº¿å¼</td><td>æ ‡å‡†åˆ—è¡¨è¯­æ³•ä½¿ç”¨ <code>[]</code> æˆ–é€—å·åˆ†éš”å€¼</td></tr></tbody></table><p><strong>æç¤º</strong></p><blockquote><p>æˆ‘ä»¬å»ºè®®ï¼Œå±æ€§å°½å¯èƒ½ä»¥å°å†™çš„çŸ­æ¨ªçº¿æ ¼å¼å­˜å‚¨ï¼Œæ¯”å¦‚ <code>my.property-name=acme</code>ã€‚</p></blockquote><p>å½“ç»‘å®šåˆ° <code>Map</code> å±æ€§æ—¶ï¼Œå¦‚æœ key åŒ…å«é™¤å°å†™å­—æ¯æ•°å­—å­—ç¬¦æˆ– <code>-</code> ä»¥å¤–çš„ä»»ä½•å†…å®¹ï¼Œåˆ™éœ€è¦ä½¿ç”¨æ‹¬å·è¡¨ç¤ºæ³•æ¥ä¿ç•™åŸå§‹å€¼ã€‚å¦‚æœ key æ²¡æœ‰ä½¿ç”¨ <code>[]</code> åŒ…è£¹ï¼Œåˆ™é‡Œé¢çš„ä»»ä½•éå­—æ¯æ•°å­—å­—ç¬¦æˆ– <code>-</code> çš„å­—ç¬¦éƒ½å°†è¢«åˆ é™¤ã€‚ä¾‹å¦‚ï¼Œå°†ä»¥ä¸‹å±æ€§ç»‘å®šåˆ°ä¸€ä¸ª <code>Map</code>ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">acme:</span></span><br><span class="line">  <span class="attr">map:</span></span><br><span class="line">    <span class="string">&quot;[/key1]&quot;</span><span class="string">:</span> <span class="string">value1</span></span><br><span class="line">    <span class="string">&quot;[/key2]&quot;</span><span class="string">:</span> <span class="string">value2</span></span><br><span class="line">    <span class="string">/key3:</span> <span class="string">value3</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„å±æ€§å°†ç»‘å®šåˆ°ä¸€ä¸ª <code>Map</code> ä¸Šï¼Œå…¶ä¸­ <code>/key1</code>ï¼Œ<code>/key2</code> å’Œ <code>key3</code> ä½œä¸º map çš„ keyã€‚</p><p><a id="boot-features-external-config-complex-type-merge"></a></p><h4 id="24-8-3ã€åˆå¹¶å¤æ‚ç±»å‹">24.8.3ã€åˆå¹¶å¤æ‚ç±»å‹</h4><p>å½“åˆ—è¡¨é›†åˆï¼ˆlistï¼‰åœ¨å¤šä¸ªåœ°æ–¹é…ç½®æ—¶ï¼Œæ•´ä¸ªåˆ—è¡¨é›†åˆå°†è¢«æ›¿æ¢ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾å¸¦æœ‰ <code>name</code> å’Œ <code>description</code> å±æ€§çš„ <code>MyPojo</code> å¯¹è±¡é»˜è®¤ä¸º <code>null</code>ã€‚ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œ<code>AcmeProperties</code> æš´éœ²äº†ä¸€ä¸ª <code>MyPojo</code> å¯¹è±¡åˆ—è¡¨é›†åˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(&quot;acme&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AcmeProperties</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> List&lt;MyPojo&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List&lt;MyPojo&gt; <span class="title function_">getList</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®å¯ä»¥å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">acme:</span></span><br><span class="line">  <span class="attr">list:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my</span> <span class="string">name</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">my</span> <span class="string">description</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">acme:</span></span><br><span class="line">  <span class="attr">list:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my</span> <span class="string">another</span> <span class="string">name</span></span><br></pre></td></tr></table></figure><p>å¦‚æœ <code>dev</code> é…ç½®æ–‡ä»¶æœªæ¿€æ´»ï¼Œåˆ™ <code>AcmeProperties.list</code> åªåŒ…å«ä¸€æ¡ <code>MyPojo</code> æ¡ç›®ï¼Œå¦‚ä¹‹å‰æ‰€è¿°ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ¿€æ´»äº† <code>dev</code> é…ç½®æ–‡ä»¶ï¼Œåˆ—è¡¨é›†åˆä»ç„¶åªåŒ…å«ä¸€ä¸ªæ¡ç›®ï¼ˆ<code>name</code> å±æ€§å€¼ä¸º <code>my another name</code>ï¼Œ<code>description</code> ä¸º <code>null</code>ï¼‰ã€‚æ­¤é…ç½®ä¸ä¼šå‘åˆ—è¡¨é›†åˆä¸­æ·»åŠ ç¬¬äºŒä¸ª <code>MyPojo</code> å®ä¾‹ï¼Œä¹Ÿä¸ä¼šåˆå¹¶æ¡ç›®ã€‚</p><p>åœ¨å¤šä¸ªé…ç½®æ–‡ä»¶ä¸­æŒ‡å®šä¸€ä¸ª <code>List</code> æ—¶ï¼Œæœ€é«˜ä¼˜å…ˆçº§ï¼ˆå¹¶ä¸”åªæœ‰ä¸€ä¸ªï¼‰çš„åˆ—è¡¨é›†åˆå°†è¢«ä½¿ç”¨ã€‚å¯åšå¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">acme:</span></span><br><span class="line">  <span class="attr">list:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my</span> <span class="string">name</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">my</span> <span class="string">description</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">another</span> <span class="string">name</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">another</span> <span class="string">description</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">acme:</span></span><br><span class="line">  <span class="attr">list:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my</span> <span class="string">another</span> <span class="string">name</span></span><br></pre></td></tr></table></figure><p>åœ¨å‰é¢ç¤ºä¾‹ä¸­ï¼Œå¦‚æœ <code>dev</code> é…ç½®æ–‡ä»¶å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™ <code>AcmeProperties.list</code> åŒ…å«ä¸€ä¸ª <code>MyPojo</code> æ¡ç›®ï¼ˆ<code>name</code> ä¸º <code>my another name</code>ï¼Œ<code>description</code> ä¸º <code>null</code>ï¼‰ã€‚å¯¹äº YAML è€Œè¨€ï¼Œé€—å·åˆ†éš”çš„åˆ—è¡¨å’ŒYAML åˆ—è¡¨åŒæ ·ä¼šå®Œå…¨è¦†ç›–åˆ—è¡¨é›†åˆçš„å†…å®¹ã€‚</p><p>å¯¹äº <code>Map</code> å±æ€§ï¼Œæ‚¨å¯ä»¥ç»‘å®šæ¥è‡ªå¤šä¸ªæºä¸­æå–çš„å±æ€§å€¼ã€‚ä½†æ˜¯ï¼Œå¯¹äºå¤šä¸ªæºä¸­çš„ç›¸åŒå±æ€§ï¼Œåˆ™ä½¿ç”¨é«˜ä¼˜å…ˆçº§æœ€é«˜çš„å±æ€§ã€‚ä»¥ä¸‹ç¤ºä¾‹ä» <code>AcmeProperties</code> æš´éœ²äº†ä¸€ä¸ª <code>Map&lt;String, MyPojo&gt;</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(&quot;acme&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AcmeProperties</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, MyPojo&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, MyPojo&gt; <span class="title function_">getMap</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.map;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥è€ƒè™‘ä»¥ä¸‹é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">acme:</span></span><br><span class="line">  <span class="attr">map:</span></span><br><span class="line">    <span class="attr">key1:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">my</span> <span class="string">name</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">my</span> <span class="string">description</span> <span class="number">1</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">acme:</span></span><br><span class="line">  <span class="attr">map:</span></span><br><span class="line">    <span class="attr">key1:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">dev</span> <span class="string">name</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">key2:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">dev</span> <span class="string">name</span> <span class="number">2</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">dev</span> <span class="string">description</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><p>å¦‚æœ <code>dev</code> é…ç½®æ–‡ä»¶æœªæ¿€æ´»ï¼Œåˆ™ <code>AcmeProperties.map</code> åªåŒ…å«ä¸€ä¸ªå¸¦ <code>key1</code> key çš„æ¡ç›®ï¼ˆ<code>name</code> ä¸º <code>my name 1</code>ï¼Œ<code>description</code> ä¸º <code>my description 1</code>ï¼‰ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ¿€æ´»äº† dev é…ç½®æ–‡ä»¶ï¼Œåˆ™ <code>map</code> å°†åŒ…å«ä¸¤ä¸ªæ¡ç›®ï¼Œ key åˆ†åˆ«ä¸º <code>key1</code>ï¼ˆ<code>name</code> ä¸º <code>dev name 1</code> å’Œ <code>description</code> ä¸º <code>my description 1</code>ï¼‰å’Œ <code>key2</code>ï¼ˆ<code>name</code> ä¸º <code>dev name 2</code> å’Œ <code>description</code> ä¸º <code>dev description 2</code>ï¼‰ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>å‰é¢çš„åˆå¹¶è§„åˆ™é€‚ç”¨äºæ‰€æœ‰ä¸åŒå±æ€§æºçš„å±æ€§ï¼Œè€Œä¸ä»…ä»…æ˜¯ YAML æ–‡ä»¶ã€‚</p></blockquote><p><a id="boot-features-external-config-conversion"></a></p><h4 id="24-8-4ã€å±æ€§è½¬æ¢">24.8.4ã€å±æ€§è½¬æ¢</h4><p>å½“å¤–éƒ¨åº”ç”¨ç¨‹åºå±æ€§ï¼ˆapplication propertiesï¼‰ ç»‘å®šåˆ° <code>@ConfigurationProperties</code> bean æ—¶ï¼ŒSpring Boot ä¼šå°è¯•å°†å…¶å±æ€§å¼ºåˆ¶è½¬æ¢ä¸ºæ­£ç¡®çš„ç±»å‹ã€‚å¦‚æœéœ€è¦è‡ªå®šä¹‰ç±»å‹è½¬æ¢ï¼Œå¯ä»¥æä¾› <code>ConversionService</code> beanï¼ˆåä¸º <code>conversionService</code> çš„ beanï¼‰æˆ–è‡ªå®šä¹‰å±æ€§ç¼–è¾‘å™¨ï¼ˆé€šè¿‡ <code>CustomEditorConfigurer</code> beanï¼‰æˆ–è‡ªå®šä¹‰è½¬æ¢å™¨ï¼ˆå¸¦æœ‰æ³¨è§£ä¸º <code>@ConfigurationPropertiesBinding</code> çš„ bean å®šä¹‰ï¼‰ã€‚</p><p><strong>æ³¨æ„</strong></p><p>ç”±äºè¯¥ bean åœ¨åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸæ—©æœŸå°±è¢«è¯·æ±‚ ï¼Œå› æ­¤è¯·é™åˆ¶ <code>ConversionService</code> ä½¿ç”¨çš„ä¾èµ–ã€‚æ‚¨åœ¨åˆ›å»ºæ—¶å¯èƒ½æ— æ³•å®Œå…¨åˆå§‹åŒ–æ‰€éœ€çš„ä¾èµ–ã€‚å¦‚æœé…ç½® key ä¸ºéå¼ºåˆ¶éœ€è¦ï¼Œæ‚¨å¯èƒ½å¸Œæœ›é‡å‘½åè‡ªå®šä¹‰çš„ <code>ConversionService</code>ï¼Œå¹¶ä»…ä¾èµ–äºä½¿ç”¨ <code>@ConfigurationPropertiesBinding</code> é™å®šçš„è‡ªå®šä¹‰è½¬æ¢å™¨ã€‚</p><p><a id="boot-features-external-config-conversion-duration"></a></p><h5 id="è½¬æ¢-duration">è½¬æ¢ duration</h5><p>Spring Boot æ”¯æŒæŒç»­æ—¶é—´ï¼ˆdurationï¼‰è¡¨è¾¾ã€‚å¦‚æœæ‚¨æš´éœ²ä¸€ä¸ª <code>java.time.Duration</code> å±æ€§ï¼Œåˆ™å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå±æ€§ä¸­ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š</p><ul><li>å¸¸è§„ <code>long</code> è¡¨ç¤ºï¼ˆé™¤éæŒ‡å®š <code>@DurationUnit</code>ï¼Œå¦åˆ™ä½¿ç”¨æ¯«ç§’ä½œä¸ºé»˜è®¤å•ä½ï¼‰</li><li><a href="https://docs.oracle.com/javase/8/docs/api//java/time/Duration.html#parse-java.lang.CharSequence-"><code>java.util.Duration</code></a> ä½¿ç”¨çš„æ ‡å‡† ISO-8601 æ ¼å¼</li><li>ä¸€ç§æ›´æ˜“è¯»çš„æ ¼å¼ï¼Œå€¼å’Œå•ä½åœ¨ä¸€èµ·ï¼ˆä¾‹å¦‚ <code>10s</code> è¡¨ç¤º 10 ç§’ï¼‰</li></ul><p>æ€è€ƒä»¥ä¸‹ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(&quot;app.system&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppSystemProperties</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@DurationUnit(ChronoUnit.SECONDS)</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">Duration</span> <span class="variable">sessionTimeout</span> <span class="operator">=</span> Duration.ofSeconds(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">Duration</span> <span class="variable">readTimeout</span> <span class="operator">=</span> Duration.ofMillis(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Duration <span class="title function_">getSessionTimeout</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.sessionTimeout;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSessionTimeout</span><span class="params">(Duration sessionTimeout)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.sessionTimeout = sessionTimeout;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Duration <span class="title function_">getReadTimeout</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.readTimeout;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setReadTimeout</span><span class="params">(Duration readTimeout)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.readTimeout = readTimeout;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‡å®šä¸€ä¸ªä¼šè¯è¶…æ—¶æ—¶é—´ä¸º 30 ç§’ï¼Œä½¿ç”¨ <code>30</code>ã€<code>PT30S</code> å’Œ <code>30s</code> ç­‰å½¢å¼éƒ½æ˜¯å¯ä»¥çš„ã€‚è¯»å–è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º 500msï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹ä»»ä½•ä¸€ç§å½¢å¼ï¼š<code>500</code>ã€<code>PT0.5S</code> å’Œ <code>500ms</code>ã€‚</p><p>æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ä»»ä½•æ”¯æŒçš„å•ä½æ¥æ ‡è¯†ï¼š</p><ul><li><code>ns</code> ä¸ºçº³ç§’</li><li><code>us</code> ä¸ºå¾®ç§’</li><li><code>ms</code> ä¸ºæ¯«ç§’</li><li><code>s</code> ä¸ºç§’</li><li><code>m</code> ä¸ºåˆ†é’Ÿ</li><li><code>h</code> ä¸ºå°æ—¶</li><li><code>d</code> ä¸ºå¤©</li></ul><p>é»˜è®¤å•ä½æ˜¯æ¯«ç§’ï¼Œå¯ä»¥ä½¿ç”¨ <code>@DurationUnit</code> é…åˆä¸Šé¢çš„å•ä½ç¤ºä¾‹é‡å†™ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>è¦ä»å…ˆå‰ä»…ä½¿ç”¨ <code>Long</code> æ¥è¡¨ç¤ºæŒç»­æ—¶é—´çš„ç‰ˆæœ¬è¿›è¡Œå‡çº§ï¼Œå¦‚æœåˆ‡æ¢åˆ° <code>Duration</code> æ—¶ä¸æ˜¯æ¯«ç§’ï¼Œè¯·å®šä¹‰å•ä½ï¼ˆä½¿ç”¨ <code>@DurationUnit</code>ï¼‰ã€‚è¿™æ ·åšå¯ä»¥æä¾›é€æ˜çš„å‡çº§è·¯å¾„ï¼ŒåŒæ—¶æ”¯æŒæ›´ä¸°å¯Œçš„æ ¼å¼ã€‚</p></blockquote><p><a id="boot-features-external-config-conversion-datasize"></a></p><h5 id="è½¬æ¢-Data-Size">è½¬æ¢ Data Size</h5><p>Spring Framework æœ‰ä¸€ä¸ª <code>DataSize</code> å€¼ç±»å‹ï¼Œå…è®¸ä»¥å­—èŠ‚è¡¨ç¤ºå¤§å°ã€‚å¦‚æœæš´éœ²ä¸€ä¸ª <code>DataSize</code> å±æ€§ï¼Œåˆ™å¯ä»¥åœ¨åº”ç”¨ç¨‹åºå±æ€§ä¸­ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š</p><ul><li>å¸¸è§„çš„ <code>Long</code> è¡¨ç¤ºï¼ˆä½¿ç”¨å­—èŠ‚ä½œä¸ºé»˜è®¤å•ä½ï¼Œé™¤éæŒ‡å®šäº† <code>@DataSizeUnit</code>ï¼‰</li><li>æ›´å…·æœ‰å¯è¯»æ€§çš„æ ¼å¼ï¼Œå€¼å’Œå•ä½åœ¨ä¸€èµ·ï¼ˆä¾‹å¦‚ <code>10MB</code> è¡¨ç¤º <code>10</code> å…†å­—èŠ‚ï¼‰</li></ul><p>è¯·æ€è€ƒä»¥ä¸‹ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(&quot;app.io&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppIoProperties</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@DataSizeUnit(DataUnit.MEGABYTES)</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">DataSize</span> <span class="variable">bufferSize</span> <span class="operator">=</span> DataSize.ofMegabytes(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">DataSize</span> <span class="variable">sizeThreshold</span> <span class="operator">=</span> DataSize.ofBytes(<span class="number">512</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> DataSize <span class="title function_">getBufferSize</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.bufferSize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBufferSize</span><span class="params">(DataSize bufferSize)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.bufferSize = bufferSize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> DataSize <span class="title function_">getSizeThreshold</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.sizeThreshold;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSizeThreshold</span><span class="params">(DataSize sizeThreshold)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.sizeThreshold = sizeThreshold;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦æŒ‡å®š 10 å…†å­—èŠ‚çš„ç¼“å†²å¤§å°ï¼Œä½¿ç”¨ <code>10</code> å’Œ <code>10MB</code> æ˜¯ç­‰æ•ˆçš„ã€‚256 å­—èŠ‚çš„å¤§å°å¯ä»¥æŒ‡å®šä¸º <code>256</code> æˆ– <code>256B</code>ã€‚</p><p>æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ä»»ä½•æ”¯æŒçš„å•ä½ï¼š</p><ul><li><code>B</code> è¡¨ç¤ºå­—èŠ‚</li><li><code>KB</code> ä¸ºåƒå­—èŠ‚</li><li><code>MB</code> ä¸ºå…†å­—èŠ‚</li><li><code>GB</code> ä¸ºåƒå…†å­—èŠ‚</li><li><code>TB</code> ä¸ºå…†å…†å­—èŠ‚</li></ul><p>é»˜è®¤å•ä½æ˜¯å­—èŠ‚ï¼Œå¯ä»¥ä½¿ç”¨ <code>@DataSizeUnit</code> é…åˆä¸Šé¢çš„ç¤ºä¾‹å•ä½é‡å†™ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>è¦ä»å…ˆå‰ä»…ä½¿ç”¨ <code>Long</code> æ¥è¡¨ç¤ºå¤§å°çš„ç‰ˆæœ¬è¿›è¡Œå‡çº§ï¼Œè¯·ç¡®ä¿åœ¨åˆ‡æ¢åˆ° <code>DataSize</code> ä¸æ˜¯å­—èŠ‚çš„æƒ…å†µä¸‹å®šä¹‰å•ä½ï¼ˆä½¿ç”¨ <code>@DataSizeUnit</code>ï¼‰ã€‚è¿™æ ·åšå¯ä»¥æä¾›é€æ˜çš„å‡çº§è·¯å¾„ï¼ŒåŒæ—¶æ”¯æŒæ›´ä¸°å¯Œçš„æ ¼å¼ã€‚</p></blockquote><p><a id="boot-features-external-config-validation"></a></p><h4 id="24-8-5ã€-ConfigurationProperties-éªŒè¯">24.8.5ã€@ConfigurationProperties éªŒè¯</h4><p>åªè¦ä½¿ç”¨äº† Spring çš„ <code>@Validated</code> æ³¨è§£ï¼ŒSpring Boot å°±ä¼šå°è¯•éªŒè¯ <code>@ConfigurationProperties</code> ç±»ã€‚æ‚¨å¯ä»¥ç›´æ¥åœ¨é…ç½®ç±»ä¸Šä½¿ç”¨ JSR-303 <code>javax.validation</code> çº¦æŸæ³¨è§£ã€‚ä¸ºæ­¤ï¼Œè¯·ç¡®ä¿ JSR-303 å®ç°åœ¨ classpath ä¸Šï¼Œç„¶åå°†çº¦æŸæ³¨è§£æ·»åŠ åˆ°å­—æ®µä¸Šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix=&quot;acme&quot;)</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AcmeProperties</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NotNull</span></span><br><span class="line"><span class="keyword">private</span> InetAddress remoteAddress;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... getters and setters</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>æ‚¨è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>@Validated</code> æ³¨è§£åˆ›å»ºé…ç½®å±æ€§çš„ <code>@Bean</code> æ–¹æ³•æ¥è§¦å‘éªŒè¯ã€‚</p></blockquote><p>è™½ç„¶ç»‘å®šæ—¶ä¹Ÿä¼šéªŒè¯åµŒå¥—å±æ€§ï¼Œä½†æœ€å¥½çš„åšæ³•è¿˜æ˜¯å°†å…³è”å­—æ®µæ³¨è§£ä¸Š <code>@Valid</code>ã€‚è¿™å¯ç¡®ä¿å³ä½¿æœªæ‰¾åˆ°åµŒå¥—å±æ€§ä¹Ÿä¼šè§¦å‘éªŒè¯ã€‚ä»¥ä¸‹ç¤ºä¾‹åŸºäºå‰é¢çš„ <code>AcmeProperties</code> ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix=&quot;acme&quot;)</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AcmeProperties</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NotNull</span></span><br><span class="line"><span class="keyword">private</span> InetAddress remoteAddress;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Valid</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Security</span> <span class="variable">security</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Security</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... getters and setters</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Security</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NotEmpty</span></span><br><span class="line"><span class="keyword">public</span> String username;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... getters and setters</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªåä¸º <code>configurationPropertiesValidator</code> çš„ bean å®šä¹‰æ¥æ·»åŠ è‡ªå®šä¹‰ Spring <code>Validator</code>ã€‚åº”è¯¥å°† <code>@Bean</code> æ–¹æ³•å£°æ˜ä¸º <code>static</code>ã€‚é…ç½®å±æ€§éªŒè¯å™¨åœ¨åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸçš„æ—©æœŸåˆ›å»ºï¼Œå°† <code>@Bean</code> æ–¹æ³•å£°æ˜ä¸º <code>static</code> å¯ä»¥æ— éœ€å®ä¾‹åŒ– <code>@Configuration</code> ç±»æ¥åˆ›å»º beanã€‚è¿™æ ·åšå¯ä»¥é¿å…æ—©æœŸå®ä¾‹åŒ–å¯èƒ½å¯¼è‡´çš„æ„å¤–é—®é¢˜ã€‚è¿™é‡Œæœ‰ä¸€ä¸ª<a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-property-validation">å±æ€§éªŒè¯ç¤ºä¾‹</a>ï¼Œè®²è§£äº†å¦‚ä½•è®¾ç½®ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p><code>spring-boot-actuator</code> æ¨¡å—åŒ…æ‹¬ä¸€ä¸ªæš´éœ²æ‰€æœ‰ <code>@ConfigurationProperties</code> bean çš„ç«¯ç‚¹ã€‚å¯å°† Web æµè§ˆå™¨æŒ‡å‘ <code>/actuator/configprops</code> æˆ–ä½¿ç”¨ç­‰æ•ˆçš„ JMX ç«¯ç‚¹ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="#production-ready-endpoints">ç”Ÿäº§å°±ç»ªåŠŸèƒ½</a>éƒ¨åˆ†ã€‚</p></blockquote><p><a id="boot-features-external-config-vs-value"></a></p><h4 id="24-8-6ã€-ConfigurationProperties-ä¸-Value-å¯¹æ¯”">24.8.6ã€@ConfigurationProperties ä¸ @Value å¯¹æ¯”</h4><p><code>@Value</code> æ³¨è§£æ˜¯æ ¸å¿ƒå®¹å™¨åŠŸèƒ½ï¼Œå®ƒä¸æä¾›ä¸ç±»å‹å®‰å…¨é…ç½®å±æ€§ç›¸åŒçš„åŠŸèƒ½ã€‚ä¸‹è¡¨æ€»ç»“äº† <code>@ConfigurationProperties</code> å’Œ <code>@Value</code> æ”¯æŒçš„åŠŸèƒ½ï¼š</p><table><thead><tr><th>åŠŸèƒ½</th><th><code>@ConfigurationProperties</code></th><th><code>@Value</code></th></tr></thead><tbody><tr><td><a href="#boot-features-external-config-relaxed-binding">å®½æ¾ç»‘å®š</a></td><td>æ˜¯</td><td>å¦</td></tr><tr><td><a href="#configuration-metadata">å…ƒæ•°æ®æ”¯æŒ</a></td><td>æ˜¯</td><td>å¦</td></tr><tr><td><code>SpEL</code> è¡¨è¾¾å¼</td><td>å¦</td><td>æ˜¯</td></tr></tbody></table><p>å¦‚æœæ‚¨è¦ä¸ºè‡ªå·±çš„ç»„ä»¶å®šä¹‰ä¸€ç»„é…ç½® keyï¼Œæˆ‘ä»¬å»ºè®®æ‚¨å°†å®ƒä»¬åˆ†ç»„åˆ°ä½¿ç”¨ <code>@ConfigurationProperties</code> æ³¨è§£çš„ POJO ä¸­ã€‚æ‚¨åº”è¯¥çŸ¥é“ï¼Œç”±äº <code>@Value</code> ä¸æ”¯æŒå®½æ¾ç»‘å®šï¼Œå› æ­¤å¦‚æœæ‚¨éœ€è¦é€šè¿‡ç¯å¢ƒå˜é‡æ¥æä¾›å€¼ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚</p><p>æœ€åï¼Œè™½ç„¶æ‚¨å¯ä»¥åœ¨ <code>@Value</code> ä¸­ç¼–å†™ <code>SpEL</code> è¡¨è¾¾å¼ï¼Œä½†æ¥è‡ªåº”ç”¨ç¨‹åºå±æ€§æ–‡ä»¶çš„æ­¤ç±»è¡¨è¾¾å¼å¹¶ä¸ä¼šè¢«å¤„ç†ã€‚</p><p><a id="boot-features-profiles"></a></p><h2 id="25ã€Profile">25ã€Profile</h2><p>Spring Profile æä¾›äº†ä¸€ç§åº”ç”¨ç¨‹åºé…ç½®éƒ¨åˆ†éš”ç¦»å¹¶ä½¿å…¶ä»…åœ¨ç‰¹å®šç¯å¢ƒä¸­å¯ç”¨çš„æ–¹æ³•ã€‚å¯ä»¥ä½¿ç”¨ <code>@Profile</code> æ¥æ³¨è§£ä»»ä½• <code>@Component</code> æˆ– <code>@Configuration</code> ä»¥æŒ‡å®šä½•æ—¶åŠ è½½å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Profile(&quot;production&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductionConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>spring.profiles.active</code> <code>Environment</code> å±æ€§æŒ‡å®šå“ªäº›é…ç½®æ–‡ä»¶å¤„äºæ¿€æ´»çŠ¶æ€ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æœ¬ç« å‰é¢ä»‹ç»çš„ä»»ä½•æ–¹æ³•æŒ‡å®šå±æ€§ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°†å…¶åŒ…å«åœ¨ <code>application.properties</code> ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.profiles.active</span>=dev,hsqldb</span><br></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸Šä½¿ç”¨ä»¥ä¸‹å¼€å…³æŒ‡å®šå®ƒï¼š<code>--spring.profiles.active=dev,hsqldb</code>ã€‚</p><p><a id="boot-features-adding-active-profiles"></a></p><h3 id="25-1ã€æ·»åŠ æ¿€æ´»-Profile">25.1ã€æ·»åŠ æ¿€æ´» Profile</h3><p><code>spring.profiles.active</code> å±æ€§éµå¾ªä¸å…¶ä»–å±æ€§ç›¸åŒçš„æ’åºè§„åˆ™ï¼šåº”ç”¨ä¼˜å…ˆçº§æœ€é«˜çš„ <code>PropertySource</code>ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥åœ¨ <code>application.properties</code> ä¸­æŒ‡å®šæ¿€æ´»é…ç½®æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨å‘½ä»¤è¡Œå¼€å…³<strong>æ›¿æ¢</strong>å®ƒä»¬ã€‚</p><p>æœ‰æ—¶ï¼Œå°†ç‰¹å®š profile çš„å±æ€§<strong>æ·»åŠ </strong>åˆ°æ¿€æ´»é…ç½®æ–‡ä»¶è€Œä¸æ˜¯æ›¿æ¢å®ƒä»¬ï¼Œè¿™ç§æ–¹å¼ä¹Ÿæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚<code>spring.profiles.include</code> å±æ€§å¯æ— æ¡ä»¶åœ°æ·»åŠ æ¿€æ´»é…ç½®æ–‡ä»¶ã€‚<code>SpringApplication</code> å…¥å£è¿˜æœ‰ä¸€ä¸ª Java APIï¼Œç”¨äºè®¾ç½®å…¶ä»– profileï¼ˆå³ï¼Œåœ¨ <code>spring.profiles.active</code> å±æ€§æ¿€æ´»çš„ profile ä¹‹ä¸Šï¼‰ã€‚è¯·å‚é˜…SpringApplication ä¸­çš„ <code>setAdditionalProfiles()</code> æ–¹æ³•ã€‚</p><p>ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨å¼€å…³ <code>--spring.profiles.active=prod</code> è¿è¡Œæœ‰ä»¥ä¸‹å±æ€§çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œ<code>proddb</code> å’Œ <code>prodmq</code> é…ç½®æ–‡ä»¶ä¹Ÿä¼šè¢«æ¿€æ´»ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">my.property:</span> <span class="string">fromyamlfile</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring.profiles:</span> <span class="string">prod</span></span><br><span class="line"><span class="attr">spring.profiles.include:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">proddb</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">prodmq</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>è¯·è®°ä½ï¼Œå¯ä»¥åœ¨ YAML æ–‡æ¡£ä¸­å®šä¹‰ <code>spring.profiles</code> å±æ€§ï¼Œä»¥ç¡®å®šæ­¤ç‰¹å®šæ–‡æ¡£ä½•æ—¶åŒ…å«åœ¨é…ç½®ä¸­ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ç¬¬ 77.7 ç« èŠ‚ï¼š<a href="howto.md#howto-change-configuration-depending-on-the-environment">æ ¹æ®ç¯å¢ƒæ›´æ”¹é…ç½®</a>ã€‚</p></blockquote><p><a id="boot-features-programmatically-setting-profiles"></a></p><h3 id="25-2ã€ä»¥ç¼–ç¨‹æ–¹å¼è®¾ç½®-Profile">25.2ã€ä»¥ç¼–ç¨‹æ–¹å¼è®¾ç½® Profile</h3><p>æ‚¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºè¿è¡Œä¹‹å‰ä»¥ç¼–ç¨‹æ–¹å¼é€šè¿‡è°ƒç”¨ <code>SpringApplication.setAdditionalProfiles(...)</code> è®¾ç½®æ¿€æ´» profileã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ Spring çš„ <code>ConfigurableEnvironment</code> æ¥å£æ¿€æ´» profileã€‚</p><p><a id="boot-features-profile-specific-configuration"></a></p><h3 id="25-3ã€ç‰¹å®š-Profile-çš„é…ç½®æ–‡ä»¶">25.3ã€ç‰¹å®š Profile çš„é…ç½®æ–‡ä»¶</h3><p>ç‰¹å®š profile çš„ <code>application.properties</code>ï¼ˆæˆ– <code>application.yml</code>ï¼‰å’Œé€šè¿‡ <code>@ConfigurationProperties</code> å¼•ç”¨çš„æ–‡ä»¶è¢«å½“åšæ–‡ä»¶å¹¶åŠ è½½ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="#boot-features-external-config-profile-specific-properties">ç¬¬ 24.4 ç« èŠ‚ï¼šç‰¹å®š Profile çš„å±æ€§æ–‡ä»¶</a>ã€‚</p><p><a id="boot-features-logging"></a></p><h2 id="26ã€æ—¥å¿—è®°å½•">26ã€æ—¥å¿—è®°å½•</h2><p>Spring Boot ä½¿ç”¨ <a href="https://commons.apache.org/logging">Commons Logging</a> è®°å½•æ‰€æœ‰å†…éƒ¨æ—¥å¿—ï¼Œä½†å¼€æ”¾æ—¥å¿—çš„åº•å±‚å®ç°ã€‚å…¶ä¸º <a href="https://docs.oracle.com/javase/8/docs/api//java/util/logging/package-summary.html">Java Util Logging<br></a>ã€<a href="https://logging.apache.org/log4j/2.x/">Log4J2</a> å’Œ <a href="http://logback.qos.ch/">Logback</a> æä¾›äº†é»˜è®¤é…ç½®ã€‚åœ¨æ¯ç§æƒ…å†µä¸‹ï¼Œæ—¥å¿—è®°å½•å™¨éƒ½é¢„å…ˆé…ç½®ä¸ºä½¿ç”¨æ§åˆ¶å°è¾“å‡ºï¼Œå¹¶ä¸”è¿˜æä¾›å¯é€‰çš„æ–‡ä»¶è¾“å‡ºã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ‚¨ä½¿ç”¨äº† <strong>Starter</strong>ï¼Œåˆ™ä½¿ç”¨ Logback è¿›è¡Œæ—¥å¿—è®°å½•ã€‚è¿˜åŒ…æ‹¬åˆé€‚çš„ Logback è·¯ç”±ï¼Œä»¥ç¡®ä¿åœ¨ä½¿ç”¨ Java Util Loggingã€Commons Loggingã€Log4J æˆ– SLF4J çš„ä¾èµ–åº“éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>Java æœ‰å¾ˆå¤šæ—¥å¿—æ¡†æ¶å¯ä¾›ä½¿ç”¨ã€‚å¦‚æœä»¥ä¸Šåˆ—è¡¨è®©æ‚¨æ„Ÿåˆ°å›°æƒ‘ï¼Œè¯·ä¸è¦æ‹…å¿ƒã€‚é€šå¸¸ï¼Œæ‚¨ä¸éœ€è¦æ›´æ”¹æ—¥å¿—ä¾èµ–ï¼Œå¹¶ä¸” Spring Boot æä¾›çš„é»˜è®¤é…ç½®å¯ä»¥ä¿è¯æ—¥å¿—æ­£å¸¸å·¥ä½œã€‚</p></blockquote><p><a id="boot-features-logging-format"></a></p><h3 id="26-1ã€æ—¥å¿—æ ¼å¼">26.1ã€æ—¥å¿—æ ¼å¼</h3><p>Spring Boot é»˜è®¤æ—¥å¿—è¾“å‡ºç±»ä¼¼äºä»¥ä¸‹ç¤ºä¾‹ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2014</span>-<span class="number">03</span>-<span class="number">05</span> <span class="number">10</span>:<span class="number">57</span>:<span class="number">51.112</span>  INFO <span class="number">45469</span> --- <span class="selector-attr">[           main]</span> org<span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.core</span><span class="selector-class">.StandardEngine</span>  : Starting Servlet Engine: Apache Tomcat/<span class="number">7.0</span>.<span class="number">52</span></span><br><span class="line"><span class="number">2014</span>-<span class="number">03</span>-<span class="number">05</span> <span class="number">10</span>:<span class="number">57</span>:<span class="number">51.253</span>  INFO <span class="number">45469</span> --- <span class="selector-attr">[ost-startStop-1]</span> o<span class="selector-class">.a</span><span class="selector-class">.c</span><span class="selector-class">.c</span><span class="selector-class">.C</span>.<span class="selector-attr">[Tomcat]</span>.<span class="selector-attr">[localhost]</span>.<span class="selector-attr">[/]</span>       : Initializing Spring embedded WebApplicationContext</span><br><span class="line"><span class="number">2014</span>-<span class="number">03</span>-<span class="number">05</span> <span class="number">10</span>:<span class="number">57</span>:<span class="number">51.253</span>  INFO <span class="number">45469</span> --- <span class="selector-attr">[ost-startStop-1]</span> o<span class="selector-class">.s</span><span class="selector-class">.web</span><span class="selector-class">.context</span><span class="selector-class">.ContextLoader</span>            : Root WebApplicationContext: initialization completed <span class="keyword">in</span> <span class="number">1358</span> ms</span><br><span class="line"><span class="number">2014</span>-<span class="number">03</span>-<span class="number">05</span> <span class="number">10</span>:<span class="number">57</span>:<span class="number">51.698</span>  INFO <span class="number">45469</span> --- <span class="selector-attr">[ost-startStop-1]</span> o<span class="selector-class">.s</span><span class="selector-class">.b</span><span class="selector-class">.c</span><span class="selector-class">.e</span><span class="selector-class">.ServletRegistrationBean</span>        : Mapping servlet: <span class="string">&#x27;dispatcherServlet&#x27;</span> to <span class="selector-attr">[/]</span></span><br><span class="line"><span class="number">2014</span>-<span class="number">03</span>-<span class="number">05</span> <span class="number">10</span>:<span class="number">57</span>:<span class="number">51.702</span>  INFO <span class="number">45469</span> --- <span class="selector-attr">[ost-startStop-1]</span> o<span class="selector-class">.s</span><span class="selector-class">.b</span><span class="selector-class">.c</span><span class="selector-class">.embedded</span><span class="selector-class">.FilterRegistrationBean</span>  : Mapping <span class="attribute">filter</span>: <span class="string">&#x27;hiddenHttpMethodFilter&#x27;</span> to: [<span class="comment">/*]</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºä»¥ä¸‹é¡¹ï¼š</p><ul><li>æ—¥æœŸå’Œæ—¶é—´ï¼šæ¯«ç§’ç²¾åº¦ï¼Œæ˜“äºæ’åºã€‚</li><li>æ—¥å¿—çº§åˆ«ï¼š<code>ERROR</code>ã€<code>WARN</code>ã€<code>INFO</code>ã€<code>DEBUG</code> æˆ– <code>TRACE</code>ã€‚</li><li>è¿›ç¨‹ IDã€‚</li><li>ä¸€ä¸ª <code>---</code> åˆ†éš”ç¬¦ï¼Œç”¨äºåŒºåˆ†å®é™…æ—¥å¿—å†…å®¹çš„å¼€å§‹ã€‚</li><li>çº¿ç¨‹åç§°ï¼šåœ¨æ–¹æ‹¬å·ä¸­ï¼ˆå¯èƒ½ä¼šæˆªæ–­æ§åˆ¶å°è¾“å‡ºï¼‰ã€‚</li><li>æ—¥å¿—è®°å½•å™¨åç§°ï¼šè¿™é€šå¸¸æ˜¯æºç±»åç§°ï¼ˆé€šå¸¸ä¸ºç¼©å†™ï¼‰ã€‚</li><li>æ—¥å¿—å†…å®¹ã€‚</li></ul><p><strong>æ³¨æ„</strong></p><blockquote><p>Logback æ²¡æœ‰ <code>FATAL</code> çº§åˆ«ã€‚è¯¥çº§åˆ«æ˜ å°„åˆ° <code>ERROR</code>ã€‚</p></blockquote><p><a id="boot-features-logging-console-output"></a></p><h3 id="26-2ã€æ§åˆ¶å°è¾“å‡º">26.2ã€æ§åˆ¶å°è¾“å‡º</h3><p>é»˜è®¤æ—¥å¿—é…ç½®ä¼šåœ¨å†™å…¥æ—¶å°†æ¶ˆæ¯å›æ˜¾åˆ°æ§åˆ¶å°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šè®°å½• <code>ERROR</code>ã€<code>WARN</code> å’Œ <code>INFO</code> çº§åˆ«çš„æ—¥å¿—ã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>--debug</code> æ ‡å¿—å¯åŠ¨åº”ç”¨ç¨‹åºæ¥å¯ç”¨<strong>è°ƒè¯•</strong>æ¨¡å¼ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar myapp.jar --debug</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>æ‚¨è¿˜å¯ä»¥åœ¨ <code>application.properties</code> ä¸­æŒ‡å®š <code>debug=true</code>ã€‚</p></blockquote><p>å¯ç”¨è°ƒè¯•æ¨¡å¼åï¼Œæ ¸å¿ƒæ—¥å¿—è®°å½•å™¨ï¼ˆå†…åµŒå®¹å™¨ã€Hibernate å’Œ Spring Bootï¼‰å°†è¢«é…ç½®ä¸ºè¾“å‡ºæ›´å¤šæ—¥å¿—ä¿¡æ¯ã€‚å¯ç”¨è°ƒè¯•æ¨¡å¼ä¸ä¼šå°†åº”ç”¨ç¨‹åºé…ç½®ä¸ºä½¿ç”¨ <code>DEBUG</code> çº§åˆ«è®°å½•æ‰€æœ‰æ—¥å¿—å†…å®¹ã€‚</p><p>æˆ–è€…ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>--trace</code> æ ‡å¿—ï¼ˆæˆ–åœ¨ <code>application.properties</code> ä¸­çš„è®¾ç½® <code>trace=true</code>ï¼‰å¯åŠ¨åº”ç”¨ç¨‹åºæ¥å¯ç”¨<strong>è·Ÿè¸ª</strong>æ¨¡å¼ã€‚è¿™æ ·åšå¯ä»¥ä¸ºé€‰æ‹©çš„æ ¸å¿ƒæ—¥å¿—è®°å½•å™¨ï¼ˆå†…åµŒå®¹å™¨ã€Hibernate æ¨¡å¼ç”Ÿæˆå’Œæ•´ä¸ª Spring ç»„åˆï¼‰å¯ç”¨æ—¥å¿—è¿½è¸ªã€‚</p><p><a id="boot-features-logging-color-coded-output"></a></p><h3 id="26-2-1ã€ç€è‰²è¾“å‡º">26.2.1ã€ç€è‰²è¾“å‡º</h3><p>å¦‚æœæ‚¨çš„ç»ˆç«¯æ”¯æŒ ANSIï¼Œåˆ™å¯ä»¥ä½¿ç”¨é¢œè‰²è¾“å‡ºæ¥æé«˜å¯è¯»æ€§ã€‚æ‚¨å¯ä»¥å°† <code>spring.output.ansi.enabled</code> è®¾ç½®ä¸º<a href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/ansi/AnsiOutput.Enabled.html">å—æ”¯æŒçš„å€¼</a>ä»¥è¦†ç›–è‡ªåŠ¨æ£€æµ‹ã€‚</p><p>å¯ä½¿ç”¨ <code>ï¼…clr</code> è½¬æ¢å­—é…ç½®é¢œè‰²ç¼–ç ã€‚æœ€ç®€å•å½¢å¼æ˜¯ï¼Œè½¬æ¢å™¨æ ¹æ®æ—¥å¿—çº§åˆ«å¯¹è¾“å‡ºè¿›è¡Œç€è‰²ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">%<span class="selector-tag">clr</span>(%5p)</span></span><br></pre></td></tr></table></figure><p>ä¸‹è¡¨æè¿°æ—¥å¿—çº§åˆ«ä¸é¢œè‰²çš„æ˜ å°„å…³ç³»ï¼š</p><table><thead><tr><th>çº§åˆ«</th><th>é¢œè‰²</th></tr></thead><tbody><tr><td><code>FATAL</code></td><td>çº¢ï¼ˆRedï¼‰</td></tr><tr><td><code>ERROR</code></td><td>çº¢ï¼ˆRedï¼‰</td></tr><tr><td><code>WARN</code></td><td>é»„ï¼ˆYellowï¼‰</td></tr><tr><td><code>INFO</code></td><td>ç»¿ï¼ˆGreenï¼‰</td></tr><tr><td><code>DEBUG</code></td><td>ç»¿ï¼ˆGreenï¼‰</td></tr><tr><td><code>TRACE</code></td><td>ç»¿ï¼ˆGreenï¼‰</td></tr></tbody></table><p>æˆ–è€…ï¼Œæ‚¨å¯ä»¥é€šè¿‡å°†å…¶ä½œä¸ºè½¬æ¢é€‰é¡¹æŒ‡å®šåº”ä½¿ç”¨çš„é¢œè‰²æˆ–æ ·å¼ã€‚ä¾‹å¦‚ï¼Œè¦å°†æ–‡æœ¬å˜ä¸ºé»„è‰²ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹è®¾ç½®ï¼š</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">%<span class="selector-tag">clr</span>(%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125;)&#123;yellow&#125;</span></span><br></pre></td></tr></table></figure><p>æ”¯æŒä»¥ä¸‹é¢œè‰²å’Œæ ·å¼ï¼š</p><ul><li><code>blue</code></li><li><code>cyan</code></li><li><code>faint</code></li><li><code>green</code></li><li><code>magenta</code></li><li><code>red</code></li><li><code>yellow</code></li></ul><p><a id="boot-features-logging-file-output"></a></p><h3 id="26-3ã€æ–‡ä»¶è¾“å‡º">26.3ã€æ–‡ä»¶è¾“å‡º</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot ä»…è®°å½•åˆ°æ§åˆ¶å°ï¼Œä¸ä¼šå†™å…¥æ—¥å¿—æ–‡ä»¶ã€‚æƒ³é™¤äº†æ§åˆ¶å°è¾“å‡ºä¹‹å¤–è¿˜è¦å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼Œåˆ™éœ€è¦è®¾ç½® <code>logging.file</code> æˆ– <code>logging.path</code> å±æ€§ï¼ˆä¾‹å¦‚ï¼Œåœ¨ <code>application.properties</code> ä¸­ï¼‰ã€‚</p><p>ä¸‹è¡¨å±•ç¤ºäº†å¦‚ä½•ä¸ <code>logging.*</code> å±æ€§ä¸€èµ·ä½¿ç”¨ï¼š</p><p><strong>è¡¨ 26.1ã€Logging å±æ€§</strong></p><table><thead><tr><th><code>logging.file</code></th><th><code>logging.path</code></th><th>ç¤ºä¾‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>ï¼ˆæ— ï¼‰</td><td>ï¼ˆæ— ï¼‰</td><td></td><td>ä»…åœ¨æ§åˆ¶å°è¾“å‡º</td></tr><tr><td>æŒ‡å®šæ–‡ä»¶</td><td>(æ— )</td><td><code>my.log</code></td><td>å†™å…¥æŒ‡å®šçš„æ—¥å¿—æ–‡ä»¶ã€‚åç§°å¯ä»¥æ˜¯ç»å¯¹ä½ç½®æˆ–ç›¸å¯¹äºå½“å‰ç›®å½•ã€‚</td></tr><tr><td>ï¼ˆæ— ï¼‰</td><td>æŒ‡å®šç›®å½•</td><td><code>/var/log</code></td><td>å°† <code>spring.log</code> å†™å…¥æŒ‡å®šçš„ç›®å½•ã€‚åç§°å¯ä»¥æ˜¯ç»å¯¹ä½ç½®æˆ–ç›¸å¯¹äºå½“å‰ç›®å½•ã€‚</td></tr></tbody></table><p>æ—¥å¿—æ–‡ä»¶åœ¨è¾¾åˆ° 10MB æ—¶ä¼šè½®è½¬ï¼Œå¹¶ä¸”ä¸æ§åˆ¶å°è¾“å‡ºä¸€æ ·ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šè®°å½• <code>ERROR</code>ã€<code>WARN</code> å’Œ <code>INFO</code> çº§åˆ«çš„å†…å®¹ã€‚å¯ä»¥ä½¿ç”¨ <code>logging.file.max-size</code> å±æ€§æ›´æ”¹å¤§å°é™åˆ¶ã€‚é™¤éå·²è®¾ç½® <code>logging.file.max-history</code> å±æ€§ï¼Œå¦åˆ™ä»¥å‰è½®è½¬çš„æ–‡ä»¶å°†æ— é™æœŸå½’æ¡£ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>æ—¥å¿—è®°å½•ç³»ç»Ÿåœ¨åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸçš„æ—©æœŸå¼€å§‹åˆå§‹åŒ–ã€‚å› æ­¤ï¼Œé€šè¿‡ <code>@PropertySource</code> æ³¨è§£åŠ è½½çš„å±æ€§æ–‡ä»¶ä¸­æ˜¯æ‰¾ä¸åˆ°æ—¥å¿—å±æ€§çš„ã€‚</p></blockquote><p><strong>æç¤º</strong></p><blockquote><p>æ—¥å¿—å±æ€§ç‹¬ç«‹äºå®é™…çš„æ—¥å¿—åº•å±‚ã€‚å› æ­¤ï¼Œspring Boot ä¸ç®¡ç†ç‰¹å®šçš„é…ç½® keyï¼ˆä¾‹å¦‚ Logback çš„ <code>logback.configurationFile</code>ï¼‰ã€‚</p></blockquote><p><a id="boot-features-custom-log-levels"></a></p><h3 id="26-4ã€æ—¥å¿—ç­‰çº§">26.4ã€æ—¥å¿—ç­‰çº§</h3><p>æ‰€æœ‰å—æ”¯æŒçš„æ—¥å¿—è®°å½•ç³»ç»Ÿéƒ½å¯ä»¥ä½¿ç”¨ <code>logging.level.&lt;logger-name&gt;=&lt;level&gt;</code> æ¥è®¾ç½® Spring <code>Environment</code> ä¸­çš„è®°å½•å™¨ç­‰çº§ï¼ˆä¾‹å¦‚ï¼Œåœ¨ <code>application.properties</code> ä¸­ï¼‰ã€‚å…¶ä¸­ <code>level</code> æ˜¯ TRACEã€DEBUGã€INFOã€WARNã€ERRORã€FATAL å’Œ OFF å…¶ä¸­ä¹‹ä¸€ã€‚å¯ä»¥ä½¿ç”¨ <code>logging.level.root</code> é…ç½® <code>root</code> è®°å½•å™¨ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº† <code>application.properties</code> ä¸­é»˜è®¤çš„æ—¥å¿—è®°å½•è®¾ç½®ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging.level.root</span>=WARN</span><br><span class="line"><span class="attr">logging.level.org.springframework.web</span>=DEBUG</span><br><span class="line"><span class="attr">logging.level.org.hibernate</span>=ERROR</span><br></pre></td></tr></table></figure><p><a id="boot-features-custom-log-groups"></a></p><h3 id="26-5ã€æ—¥å¿—ç»„">26.5ã€æ—¥å¿—ç»„</h3><p>å°†ç›¸å…³è®°å½•å™¨ç»„åˆåœ¨ä¸€èµ·ä»¥ä¾¿å¯ä»¥åŒæ—¶é…ç½®ï¼Œè¿™é€šå¸¸å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æ›´æ”¹<strong>æ‰€æœ‰</strong> Tomcat ç›¸å…³è®°å½•å™¨çš„æ—¥å¿—è®°å½•çº§åˆ«ï¼Œä½†æ‚¨æ— æ³•è½»æ¾è®°ä½é¡¶å±‚çš„åŒ…åã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒSpring Boot å…è®¸æ‚¨åœ¨ Spring <code>Environment</code> ä¸­å®šä¹‰æ—¥å¿—è®°å½•ç»„ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹é€šè¿‡å°† <strong>tomcat</strong> ç»„æ·»åŠ åˆ° <code>application.properties</code> æ¥å®šä¹‰ <strong>tomcat</strong> ç»„ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging.group.tomcat</span>=org.apache.catalina, org.apache.coyote, org.apache.tomcat</span><br></pre></td></tr></table></figure><p>å®šä¹‰åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸€è¡Œé…ç½®æ¥æ›´æ”¹ç»„ä¸­æ‰€æœ‰è®°å½•å™¨çš„çº§åˆ«ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging.level.tomcat</span>=TRACE</span><br></pre></td></tr></table></figure><p>Spring Boot åŒ…å«ä»¥ä¸‹é¢„å®šä¹‰çš„æ—¥å¿—è®°å½•ç»„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š</p><table><thead><tr><th>åç§°</th><th>æ—¥å¿—è®°å½•å™¨</th></tr></thead><tbody><tr><td>web</td><td><code>org.springframework.core.codec</code>ã€<code>org.springframework.http</code>ã€<code>org.springframework.web</code></td></tr><tr><td>sql</td><td><code>org.springframework.jdbc.core</code>ã€<code>org.hibernate.SQL</code></td></tr></tbody></table><p><a id="boot-features-custom-log-configuration"></a></p><h3 id="26-6ã€è‡ªå®šä¹‰æ—¥å¿—é…ç½®">26.6ã€è‡ªå®šä¹‰æ—¥å¿—é…ç½®</h3><p>å¯ä»¥é€šè¿‡åœ¨ classpath ä¸­å¼•å…¥é€‚åˆçš„åº“æ¥æ¿€æ´»å„ç§æ—¥å¿—è®°å½•ç³»ç»Ÿï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡åœ¨ classpath çš„æ ¹ç›®å½•ä¸­æˆ–åœ¨ä»¥ä¸‹ Spring <code>Environment</code> å±æ€§æŒ‡å®šçš„ä½ç½®æä¾›åˆé€‚çš„é…ç½®æ–‡ä»¶æ¥è¿›ä¸€æ­¥è‡ªå®šä¹‰ï¼š<code>logging.config</code>ã€‚</p><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>org.springframework.boot.logging.LoggingSystem</code> ç³»ç»Ÿå±æ€§å¼ºåˆ¶ Spring Boot ä½¿ç”¨ç‰¹å®šçš„æ—¥å¿—è®°å½•ç³»ç»Ÿã€‚è¯¥å€¼åº”è¯¥æ˜¯ä¸€ä¸ªå®ç°äº† <code>LoggingSystem</code> çš„ç±»çš„å®Œå…¨é™å®šç±»åã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <code>none</code> å€¼å®Œå…¨ç¦ç”¨ Spring Boot çš„æ—¥å¿—è®°å½•é…ç½®ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>ç”±äºæ—¥å¿—è®°å½•åœ¨åˆ›å»º <code>ApplicationContext</code> ä¹‹å‰åˆå§‹åŒ–ï¼Œå› æ­¤æ— æ³•åœ¨ Spring <code>@Configuration</code> æ–‡ä»¶ä¸­æ§åˆ¶æ¥è‡ª <code>@PropertySources</code> çš„æ—¥å¿—è®°å½•ã€‚æ›´æ”¹æ—¥å¿—è®°å½•ç³»ç»Ÿæˆ–å®Œå…¨ç¦ç”¨å®ƒçš„å”¯ä¸€æ–¹æ³•æ˜¯é€šè¿‡ç³»ç»Ÿå±æ€§è®¾ç½®ã€‚</p></blockquote><p>æ ¹æ®æ‚¨çš„æ—¥å¿—è®°å½•ç³»ç»Ÿï¼Œå°†åŠ è½½ä»¥ä¸‹æ–‡ä»¶ï¼š</p><table><thead><tr><th>æ—¥å¿—è®°å½•ç³»ç»Ÿ</th><th>æ–‡ä»¶</th></tr></thead><tbody><tr><td>Logback</td><td><code>logback-spring.xml</code>ã€<code>logback-spring.groovy</code>ã€<code>logback.xml</code> æˆ–è€… <code>logback.groovy</code></td></tr><tr><td>Log4j2</td><td><code>log4j2-spring.xml</code> æˆ–è€… <code>log4j2.xml</code></td></tr><tr><td>JDKï¼ˆJava Util Loggingï¼‰</td><td><code>logging.properties</code></td></tr></tbody></table><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœå¯èƒ½ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨ <code>-spring</code> çš„å½¢å¼æ¥é…ç½®æ—¥å¿—è®°å½•ï¼ˆæ¯”å¦‚ <code>logback-spring.xml</code> è€Œä¸æ˜¯ <code>logback.xml</code>ï¼‰ã€‚å¦‚æœä½¿ç”¨æ ‡å‡†çš„é…ç½®ä½ç½®ï¼ŒSpring æ— æ³•å®Œå…¨æ§åˆ¶æ—¥å¿—åˆå§‹åŒ–ã€‚</p></blockquote><p><strong>è­¦å‘Š</strong></p><blockquote><p>Java Util Logging å­˜åœ¨å·²çŸ¥çš„ç±»åŠ è½½é—®é¢˜ï¼Œè¿™äº›é—®é¢˜åœ¨ä»¥<strong>å¯æ‰§è¡Œ jar</strong> è¿è¡Œæ—¶ä¼šè§¦å‘ã€‚å¦‚æœå¯èƒ½çš„è¯ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨åœ¨ä½¿ç”¨<strong>å¯æ‰§è¡Œ jar</strong> æ–¹å¼è¿è¡Œæ—¶é¿å…ä½¿ç”¨å®ƒã€‚</p></blockquote><p>ä¸ºäº†è¿›è¡Œè‡ªå®šä¹‰ï¼Œéƒ¨åˆ†å…¶ä»–å±æ€§ä¼šä» Spring <code>Environment</code> ä¼ è¾“åˆ° System å±æ€§ï¼Œå¦‚ä¸‹è¡¨æ‰€è¿°ï¼š</p><table><thead><tr><th>Spring Environment</th><th>ç³»ç»Ÿå±æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>logging.exception-conversion-word</code></td><td><code>LOG_EXCEPTION_CONVERSION_WORD</code></td><td>è®°å½•å¼‚å¸¸æ—¶ä½¿ç”¨çš„è½¬æ¢å­—ã€‚</td></tr><tr><td><code>logging.file</code></td><td><code>LOG_FILE</code></td><td>å¦‚æœå·²å®šä¹‰ï¼Œåˆ™åœ¨é»˜è®¤æ—¥å¿—é…ç½®ä¸­ä½¿ç”¨å®ƒã€‚</td></tr><tr><td><code>logging.file.max-size</code></td><td><code>LOG_FILE_MAX_SIZE</code></td><td>æœ€å¤§æ—¥å¿—æ–‡ä»¶å¤§å°ï¼ˆå¦‚æœå¯ç”¨äº† LOG_FILEï¼‰ã€‚ï¼ˆä»…æ”¯æŒé»˜è®¤çš„ Logback è®¾ç½®ã€‚ï¼‰</td></tr><tr><td><code>logging.file.max-history</code></td><td><code>LOG_FILE_MAX_HISTORY</code></td><td>è¦ä¿ç•™çš„å½’æ¡£æ—¥å¿—æ–‡ä»¶æœ€å¤§æ•°é‡ï¼ˆå¦‚æœå¯ç”¨äº† LOG_FILEï¼‰ã€‚ï¼ˆä»…æ”¯æŒé»˜è®¤çš„ Logback è®¾ç½®ã€‚ï¼‰</td></tr><tr><td><code>logging.path</code></td><td><code>LOG_PATH</code></td><td>å¦‚æœå·²å®šä¹‰ï¼Œåˆ™åœ¨é»˜è®¤æ—¥å¿—é…ç½®ä¸­ä½¿ç”¨å®ƒã€‚</td></tr><tr><td><code>logging.pattern.console</code></td><td><code>CONSOLE_LOG_PATTERN</code></td><td>è¦åœ¨æ§åˆ¶å°ä¸Šä½¿ç”¨çš„æ—¥å¿—æ¨¡å¼ï¼ˆstdoutï¼‰ã€‚ï¼ˆä»…æ”¯æŒé»˜è®¤çš„ Logback è®¾ç½®ã€‚ï¼‰</td></tr><tr><td><code>logging.pattern.dateformat</code></td><td><code>LOG_DATEFORMAT_PATTERN</code></td><td>æ—¥å¿—æ—¥æœŸæ ¼å¼çš„ Appender æ¨¡å¼ã€‚ï¼ˆä»…æ”¯æŒé»˜è®¤çš„ Logback è®¾ç½®ã€‚ï¼‰</td></tr><tr><td><code>logging.pattern.file</code></td><td><code>FILE_LOG_PATTERN</code></td><td>è¦åœ¨æ–‡ä»¶ä¸­ä½¿ç”¨çš„æ—¥å¿—æ¨¡å¼ï¼ˆå¦‚æœå¯ç”¨äº† <code>LOG_FILE</code>ï¼‰ã€‚ï¼ˆä»…æ”¯æŒé»˜è®¤çš„ Logback è®¾ç½®ã€‚ï¼‰</td></tr><tr><td><code>logging.pattern.level</code></td><td><code>LOG_LEVEL_PATTERN</code></td><td>æ¸²æŸ“æ—¥å¿—çº§åˆ«æ—¶ä½¿ç”¨çš„æ ¼å¼ï¼ˆé»˜è®¤å€¼ä¸º <code>ï¼…5p</code>ï¼‰ã€‚ï¼ˆä»…æ”¯æŒé»˜è®¤çš„ Logback è®¾ç½®ã€‚ï¼‰</td></tr><tr><td><code>PID</code></td><td><code>PID</code></td><td>å½“å‰è¿›ç¨‹ IDï¼ˆå¦‚æœå¯èƒ½ï¼Œåˆ™åœ¨æœªå®šä¹‰ä¸º OS ç¯å¢ƒå˜é‡æ—¶å‘ç°ï¼‰ã€‚</td></tr></tbody></table><p>æ‰€æœ‰å—æ”¯æŒçš„æ—¥å¿—è®°å½•ç³»ç»Ÿåœ¨è§£æå…¶é…ç½®æ–‡ä»¶æ—¶éƒ½å¯ä»¥å‚è€ƒç³»ç»Ÿå±æ€§ã€‚æœ‰å…³ç¤ºä¾‹ï¼Œè¯·å‚é˜… <code>spring-boot.jar</code> ä¸­çš„é»˜è®¤é…ç½®ï¼š</p><ul><li><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/logback/defaults.xml">Logback</a></li><li><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/log4j2/log4j2.xml">Log4j 2</a></li><li><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/java/logging-file.properties">Java Util logging</a></li></ul><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœè¦åœ¨æ—¥å¿—è®°å½•å±æ€§ä¸­ä½¿ç”¨å ä½ç¬¦ï¼Œåˆ™åº”ä½¿ç”¨ <a href="#boot-features-external-config-placeholders-in-properties">Spring Boot çš„è¯­æ³•</a>ï¼Œè€Œä¸æ˜¯ä½¿ç”¨åº•å±‚æ¡†æ¶çš„è¯­æ³•ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½¿ç”¨ Logbackï¼Œåˆ™åº”ä½¿ç”¨ <code>:</code> ä½œä¸ºå±æ€§åç§°ä¸å…¶é»˜è®¤å€¼ä¹‹é—´çš„åˆ†éš”ç¬¦ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <code>:-</code>ã€‚</p></blockquote><p><strong>æç¤º</strong></p><blockquote><p>æ‚¨å¯ä»¥é€šè¿‡ä»…è¦†ç›– <code>LOG_LEVEL_PATTERN</code>ï¼ˆæˆ–å¸¦ Logback çš„ <code>logging.pattern.level</code>ï¼‰å°† MDC å’Œå…¶ä»–ç‰¹åˆ«çš„å†…å®¹æ·»åŠ åˆ°æ—¥å¿—è¡Œã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨ <code>logging.pattern.level=user:%X&#123;user&#125; %5p</code>ï¼Œåˆ™é»˜è®¤æ—¥å¿—æ ¼å¼åŒ…å« <strong>user</strong> MDC é¡¹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">2015</span>-<span class="number">09</span>-<span class="number">30</span> <span class="number">12</span>:<span class="number">30</span>:<span class="number">04</span>.<span class="number">031</span> user:someone INFO <span class="number">22174</span> ---<span class="meta"> [  nio-8080-exec-0] demo.Controller</span></span><br><span class="line"><span class="meta">Handling authenticated request</span></span><br></pre></td></tr></table></figure></blockquote><p><a id="boot-features-logback-extensions"></a></p><h3 id="26-7ã€Logback-æ‰©å±•">26.7ã€Logback æ‰©å±•</h3><p>Spring Boot åŒ…å«è®¸å¤š Logback æ‰©å±•ï¼Œå¯ç”¨äºè¿›è¡Œé«˜çº§é…ç½®ã€‚æ‚¨å¯ä»¥åœ¨ <code>logback-spring.xml</code> é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨è¿™äº›æ‰©å±•ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>ç”±äºæ ‡å‡†çš„ logback.xml é…ç½®æ–‡ä»¶åŠ è½½è¿‡æ—©ï¼Œå› æ­¤æ— æ³•åœ¨å…¶ä¸­ä½¿ç”¨æ‰©å±•ã€‚æ‚¨éœ€è¦ä½¿ç”¨ <code>logback-spring.xml</code> æˆ–å®šä¹‰ <code>logging.config</code> å±æ€§ã€‚</p></blockquote><p><strong>è­¦å‘Š</strong></p><blockquote><p>æ‰©å±•ä¸èƒ½ä¸ Logback çš„<a href="http://logback.qos.ch/manual/configuration.html#autoScan">é…ç½®æ‰«æ</a>ä¸€èµ·ä½¿ç”¨ã€‚å¦‚æœå°è¯•è¿™æ ·åšï¼Œæ›´æ”¹é…ç½®æ–‡ä»¶ä¼šå¯¼è‡´å‘ç”Ÿç±»ä¼¼ä»¥ä¸‹é”™è¯¯æ—¥å¿—ï¼š</p></blockquote><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ERROR </span>in ch.qos.logback.core.joran.spi.Interpreter@4:71 - no applicable action for [springProperty], current ElementPath is [[configuration][springProperty]]</span><br><span class="line"><span class="keyword">ERROR </span>in ch.qos.logback.core.joran.spi.Interpreter@4:71 - no applicable action for [springProfile], current ElementPath is [[configuration][springProfile]]</span><br></pre></td></tr></table></figure><p><a id="_profile_specific_configuration"></a></p><h3 id="26-7-1ã€ç‰¹å®š-Profile-é…ç½®">26.7.1ã€ç‰¹å®š Profile é…ç½®</h3><p><code>&lt;springProfile&gt;</code> æ ‡ç­¾å…è®¸æ‚¨æ ¹æ®æ¿€æ´»çš„ Spring profile é€‰æ‹©æ€§åœ°åŒ…å«æˆ–æ’é™¤é…ç½®éƒ¨åˆ†ã€‚åœ¨ <code>&lt;configuration&gt;</code> å…ƒç´ ä¸­çš„ä»»ä½•ä½ç½®éƒ½æ”¯æŒé…ç½® profileã€‚ä½¿ç”¨ <code>name</code> å±æ€§æŒ‡å®šå“ªä¸ª proifle æ¥å—é…ç½®ã€‚<code>&lt;springProfile&gt;</code> æ ‡è®°å¯ä»¥åŒ…å«ç®€å•çš„ proifle åç§°ï¼ˆä¾‹å¦‚ <code>staging</code>ï¼‰æˆ– profile è¡¨è¾¾å¼ã€‚profile è¡¨è¾¾å¼å…è®¸è¡¨è¾¾æ›´å¤æ‚çš„ profile é€»è¾‘ï¼Œä¾‹å¦‚ <code>production &amp; (eu-central | eu-west)</code>ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥é˜…<a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/core.html#beans-definition-profiles-java">å‚è€ƒæŒ‡å—</a>ã€‚ä»¥ä¸‹æ¸…å•å±•ç¤ºäº†ä¸‰ä¸ªç¤ºä¾‹ profileï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;staging&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- configuration to be enabled when the &quot;staging&quot; profile is active --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;dev | staging&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- configuration to be enabled when the &quot;dev&quot; or &quot;staging&quot; profiles are active --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;!production&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- configuration to be enabled when the &quot;production&quot; profile is not active --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a id="_environment_properties"></a></p><h3 id="26-7-2ã€ç¯å¢ƒå±æ€§">26.7.2ã€ç¯å¢ƒå±æ€§</h3><p>ä½¿ç”¨ <code>&lt;springProperty&gt;</code> æ ‡è®°å¯ä»¥è®©æ‚¨æš´éœ² Spring ç¯å¢ƒï¼ˆ<code>Environment</code>ï¼‰ä¸­çš„å±æ€§ï¼Œä»¥ä¾¿åœ¨ Logback ä¸­ä½¿ç”¨ã€‚å¦‚æœåœ¨ Logback é…ç½®ä¸­è®¿é—®æ¥è‡ª <code>application.properties</code> æ–‡ä»¶çš„å€¼ï¼Œè¿™æ ·åšå¾ˆæœ‰ç”¨ã€‚æ ‡ç­¾çš„å·¥ä½œæ–¹å¼ä¸ Logback çš„æ ‡å‡† <code>&lt;property&gt;</code> æ ‡ç­¾ç±»ä¼¼ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥æŒ‡å®šå±æ€§ï¼ˆæ¥è‡ª <code>Environment</code>ï¼‰çš„ <code>source</code>ï¼Œè€Œä¸æ˜¯æŒ‡å®šç›´æ¥çš„ <code>value</code>ã€‚å¦‚æœéœ€è¦å°†å±æ€§å­˜å‚¨åœ¨ <code>local</code> èŒƒå›´ä»¥å¤–çš„å…¶ä»–ä½ç½®ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code>scope</code> å±æ€§ã€‚å¦‚æœéœ€è¦å›é€€å€¼ï¼ˆå¦‚æœæœªåœ¨ <code>Environment</code> ä¸­è®¾ç½®è¯¥å±æ€§ï¼‰ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code>defaultValue</code> å±æ€§ã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æš´éœ²å±æ€§ä»¥ä¾¿åœ¨ Logback ä¸­ä½¿ç”¨ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">springProperty</span> <span class="attr">scope</span>=<span class="string">&quot;context&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fluentHost&quot;</span> <span class="attr">source</span>=<span class="string">&quot;myapp.fluentd.host&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">defaultValue</span>=<span class="string">&quot;localhost&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FLUENT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.more.appenders.DataFluentAppender&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">remoteHost</span>&gt;</span>$&#123;fluentHost&#125;<span class="tag">&lt;/<span class="name">remoteHost</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>å¿…é¡»ä»¥ kebab é£æ ¼ï¼ˆçŸ­æ¨ªçº¿å°å†™é£æ ¼ï¼‰æŒ‡å®š <code>source</code>ï¼ˆä¾‹å¦‚ <code>my.property-name</code>ï¼‰ã€‚ä½†å¯ä»¥ä½¿ç”¨å®½æ¾è§„åˆ™å°†å±æ€§æ·»åŠ åˆ° <code>Environment</code> ä¸­ã€‚</p></blockquote><p><a id="boot-features-json"></a></p><h2 id="27ã€JSON">27ã€JSON</h2><p>Spring Boot ä¸ºä¸‰ä¸ª JSON æ˜ å°„åº“æä¾›äº†å†…ç½®é›†æˆï¼š</p><ul><li>GSON</li><li>Jackson</li><li>JSON-B</li></ul><p>Jackson æ˜¯é¦–é€‰å’Œé»˜è®¤çš„åº“ã€‚</p><p><a id="boot-features-json-jackson"></a></p><h2 id="27-1ã€Jackson">27.1ã€Jackson</h2><p>Spring Boot æä¾›äº† Jackson çš„è‡ªåŠ¨é…ç½®ï¼ŒJackson æ˜¯ <code>spring-boot-starter-json</code> çš„ä¸€éƒ¨åˆ†ã€‚å½“ Jackson åœ¨ classpath ä¸Šæ—¶ï¼Œä¼šè‡ªåŠ¨é…ç½® <code>ObjectMapper</code> beanã€‚Spring Boot æä¾›äº†å‡ ä¸ªé…ç½®å±æ€§æ¥<a href="howto.md#howto-customize-the-jackson-objectmapper">è‡ªå®šä¹‰ <code>ObjectMapper</code> çš„é…ç½®</a>ã€‚</p><p><a id="boot-features-json-gson"></a></p><h2 id="27-2ã€Gson">27.2ã€Gson</h2><p>Spring Boot æä¾› Gson çš„è‡ªåŠ¨é…ç½®ã€‚å½“ Gson åœ¨ classpath ä¸Šæ—¶ï¼Œä¼šè‡ªåŠ¨é…ç½® <code>Gson</code> beanã€‚Spring Boot æä¾›äº†å‡ ä¸ª <code>spring.gson.*</code> é…ç½®å±æ€§æ¥è‡ªå®šä¹‰é…ç½®ã€‚ä¸ºäº†è·å¾—æ›´å¤šæ§åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ª <code>GsonBuilderCustomizer</code> beanã€‚</p><p><a id="boot-features-json-json-b"></a></p><h2 id="27-3ã€JSON-B">27.3ã€JSON-B</h2><p>Spring Boot æä¾›äº† JSON-B çš„è‡ªåŠ¨é…ç½®ã€‚å½“ JSON-B API å’Œå®ç°åœ¨ classpath ä¸Šæ—¶ï¼Œå°†è‡ªåŠ¨é…ç½® <code>Jsonb</code> beanã€‚é¦–é€‰çš„ JSON-B å®ç°æ˜¯ Apache Johnzonï¼Œå®ƒæä¾›äº†ä¾èµ–ç®¡ç†ã€‚</p><p><a id="boot-features-developing-web-applications"></a></p><h2 id="28ã€å¼€å‘-Web-åº”ç”¨ç¨‹åº">28ã€å¼€å‘ Web åº”ç”¨ç¨‹åº</h2><p>Spring Boot éå¸¸é€‚åˆç”¨äºå¼€å‘ web åº”ç”¨ç¨‹åºã€‚æ‚¨å¯ä»¥ä½¿ç”¨åµŒå…¥å¼ Tomcatã€Jetty æˆ–è€… Undertow æ¥åˆ›å»ºä¸€ä¸ªç‹¬ç«‹ï¼ˆself-containedï¼‰çš„ HTTP æœåŠ¡å™¨ã€‚å¤§å¤šæ•° web åº”ç”¨ç¨‹åºä½¿ç”¨ <code>spring-boot-starter-web</code> æ¨¡å—æ¥å¿«é€Ÿæ­å»ºå’Œè¿è¡Œï¼Œæ‚¨ä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨ <code>spring-boot-starter-webflux</code> æ¨¡å—æ¥æ„å»ºå“åº”å¼ï¼ˆreactiveï¼‰ web åº”ç”¨ç¨‹åºã€‚</p><p>å¦‚æœæ‚¨å°šæœªå¼€å‘è¿‡ Spring Boot web åº”ç”¨ç¨‹åºï¼Œåˆ™å¯ä»¥æŒ‰ç…§<a href="#getting-started-first-application">å…¥é—¨</a>ç« èŠ‚ä¸­çš„â€œHello World!â€ç¤ºä¾‹è¿›è¡Œæ“ä½œã€‚</p><p><a id="boot-features-spring-mvc"></a></p><h3 id="28-1ã€Spring-Web-MVC-æ¡†æ¶">28.1ã€Spring Web MVC æ¡†æ¶</h3><p><a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#mvc">Spring Web MVC æ¡†æ¶</a>ï¼ˆé€šå¸¸ç®€ç§°â€œSpring MVCâ€ï¼‰æ˜¯ä¸€ä¸ªå¯Œ<strong>æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨</strong>çš„ web æ¡†æ¶ã€‚Spring MVC å…è®¸æ‚¨åˆ›å»º <code>@Controller</code> æˆ–è€… <code>@RestController</code> bean æ¥å¤„ç†ä¼ å…¥çš„ HTTP è¯·æ±‚ã€‚æ§åˆ¶å™¨ä¸­çš„æ–¹æ³•é€šè¿‡ <code>@RequestMapping</code> æ³¨è§£æ˜ å°„åˆ° HTTPã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨äº† <code>@RestController</code> æ¥å“åº” JSON æ•°æ®çš„å…¸å‹ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value=&quot;/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRestController</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(value=&quot;/&#123;user&#125;&quot;, method=RequestMethod.GET)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable</span> Long user)</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(value=&quot;/&#123;user&#125;/customers&quot;, method=RequestMethod.GET)</span></span><br><span class="line">List&lt;Customer&gt; <span class="title function_">getUserCustomers</span><span class="params">(<span class="meta">@PathVariable</span> Long user)</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(value=&quot;/&#123;user&#125;&quot;, method=RequestMethod.DELETE)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> Long user)</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Spring MVC æ˜¯ Spring Framework æ ¸å¿ƒçš„ä¸€éƒ¨åˆ†ï¼Œè¯¦ç»†ä»‹ç»å¯å‚è€ƒå…¶<a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#mvc">å‚è€ƒæ–‡æ¡£</a>ã€‚<a href="https://spring.io/guides">spring.io/guides</a> è¿˜æä¾›äº†å‡ ä¸ª Spring MVC ç›¸å…³çš„æŒ‡å—ã€‚</p><p><a id="boot-features-spring-mvc-auto-configuration"></a></p><h4 id="28-1-1ã€Spring-MVC-è‡ªåŠ¨é…ç½®">28.1.1ã€Spring MVC è‡ªåŠ¨é…ç½®</h4><p>Spring Boot æä¾›äº†é€‚ç”¨äºå¤§å¤šæ•° Spring MVC åº”ç”¨çš„è‡ªåŠ¨é…ç½®ï¼ˆauto-configurationï¼‰ã€‚</p><p>è‡ªåŠ¨é…ç½®åœ¨ Spring é»˜è®¤åŠŸèƒ½ä¸Šæ·»åŠ äº†ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ul><li>å¼•å…¥ <code>ContentNegotiatingViewResolver</code> å’Œ <code>BeanNameViewResolver</code> beanã€‚</li><li>æ”¯æŒæœåŠ¡é™æ€èµ„æºï¼ŒåŒ…æ‹¬å¯¹ WebJar çš„æ”¯æŒï¼ˆ<a href="#boot-features-spring-mvc-static-content">è§ä¸‹æ–‡</a>ï¼‰ã€‚</li><li>è‡ªåŠ¨æ³¨å†Œ <code>Converter</code>ã€<code>GenericConverter</code> å’Œ <code>Formatter</code> beanã€‚</li><li>æ”¯æŒ <code>HttpMessageConverter</code>ï¼ˆè§<a href="#boot-features-spring-mvc-message-converters">ä¸‹æ–‡</a>ï¼‰ã€‚</li><li>è‡ªåŠ¨æ³¨å†Œ <code>MessageCodesResolver</code>ï¼ˆè§<a href="#boot-features-spring-message-codes">ä¸‹æ–‡</a>ï¼‰ã€‚</li><li>æ”¯æŒé™æ€ index.htmlã€‚</li><li>æ”¯æŒè‡ªå®šä¹‰ Favicon ï¼ˆè§<a href="#boot-features-spring-mvc-favicon">ä¸‹æ–‡</a>ï¼‰ã€‚</li><li>è‡ªåŠ¨ä½¿ç”¨ <code>ConfigurableWebBindingInitializer</code> beanï¼ˆè§<a href="#boot-features-spring-mvc-web-binding-initializer">ä¸‹æ–‡</a>ï¼‰ã€‚</li></ul><p>å¦‚æœæ‚¨æƒ³ä¿ç•™ Spring Boot MVC çš„åŠŸèƒ½ï¼Œå¹¶ä¸”éœ€è¦æ·»åŠ å…¶ä»– <a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#mvc">MVC é…ç½®</a>ï¼ˆinterceptorã€formatter å’Œè§†å›¾æ§åˆ¶å™¨ç­‰ï¼‰ï¼Œå¯ä»¥æ·»åŠ è‡ªå·±çš„ <code>WebMvcConfigurerAdapter</code> ç±»å‹çš„ <code>@Configuration</code> ç±»ï¼Œä½†<strong>ä¸èƒ½</strong>å¸¦ <code>@EnableWebMvc</code> æ³¨è§£ã€‚å¦‚æœæ‚¨æƒ³è‡ªå®šä¹‰ <code>RequestMappingHandlerMapping</code>ã€<code>RequestMappingHandlerAdapter</code> æˆ–è€… <code>ExceptionHandlerExceptionResolver</code> å®ä¾‹ï¼Œå¯ä»¥å£°æ˜ä¸€ä¸ª <code>WebMvcRegistrationsAdapter</code> å®ä¾‹æ¥æä¾›è¿™äº›ç»„ä»¶ã€‚</p><p>å¦‚æœæ‚¨æƒ³å®Œå…¨æŒæ§ Spring MVCï¼Œå¯ä»¥æ·»åŠ è‡ªå®šä¹‰æ³¨è§£äº† <code>@EnableWebMvc</code> çš„ @Configuration é…ç½®ç±»ã€‚</p><p><a id="boot-features-spring-mvc-message-converters"></a></p><h4 id="28-1-2ã€HttpMessageConverters">28.1.2ã€HttpMessageConverters</h4><p>Spring MVC ä½¿ç”¨ <code>HttpMessageConverter</code> æ¥å£æ¥è½¬æ¢ HTTP çš„è¯·æ±‚å’Œå“åº”ã€‚å¼€ç®±å³ç”¨åŠŸèƒ½åŒ…å«äº†åˆé€‚çš„é»˜è®¤å€¼ï¼Œæ¯”å¦‚å¯¹è±¡å¯ä»¥è‡ªåŠ¨è½¬æ¢ä¸º JSONï¼ˆä½¿ç”¨ Jackson åº“ï¼‰æˆ–è€… XMLï¼ˆä¼˜å…ˆä½¿ç”¨ Jackson XML æ‰©å±•ï¼Œå…¶æ¬¡ä¸º JAXBï¼‰ã€‚å­—ç¬¦ä¸²é»˜è®¤ä½¿ç”¨ <code>UTF-8</code> ç¼–ç ã€‚</p><p>å¦‚æœæ‚¨éœ€è¦æ·»åŠ æˆ–è€…è‡ªå®šä¹‰è½¬æ¢å™¨ï¼ˆconverterï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ Spring Boot çš„ <code>HttpMessageConverters</code> ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.web.HttpMessageConverters;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> HttpMessageConverters <span class="title function_">customConverters</span><span class="params">()</span> &#123;</span><br><span class="line">HttpMessageConverter&lt;?&gt; additional = ...</span><br><span class="line">HttpMessageConverter&lt;?&gt; another = ...</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HttpMessageConverters</span>(additional, another);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šä¸‹æ–‡ä¸­çš„æ‰€æœ‰ <code>HttpMessageConverter</code> bean éƒ½å°†è¢«æ·»åŠ åˆ°è½¬æ¢å™¨åˆ—è¡¨ä¸­ã€‚æ‚¨ä¹Ÿå¯ä»¥ç”¨è¿™ç§æ–¹å¼æ¥è¦†ç›–é»˜è®¤è½¬æ¢å™¨ã€‚</p><p><a id="boot-features-json-components"></a></p><h4 id="28-1-3ã€è‡ªå®šä¹‰-JSON-Serializer-å’Œ-Deserializer">28.1.3ã€è‡ªå®šä¹‰ JSON Serializer å’Œ Deserializer</h4><p>å¦‚æœæ‚¨ä½¿ç”¨ Jackson åºåˆ—åŒ–å’Œååºåˆ—åŒ– JSON æ•°æ®ï¼Œå¯èƒ½éœ€è¦è‡ªå·±ç¼–å†™ <code>JsonSerializer</code> å’Œ <code>JsonDeserializer</code> ç±»ã€‚è‡ªå®šä¹‰åºåˆ—åŒ–å™¨ï¼ˆserializerï¼‰çš„åšæ³•é€šå¸¸æ˜¯é€šè¿‡<a href="https://github.com/FasterXML/jackson-docs/wiki/JacksonHowToCustomSerializers">ä¸€ä¸ªæ¨¡å—æ¥æ³¨å†Œ Jackson</a>ï¼Œ ç„¶è€Œ Spring Boot æä¾›äº†ä¸€ä¸ªå¤‡é€‰çš„ <code>@JsonComponent</code> æ³¨è§£ï¼Œå®ƒå¯ä»¥æ›´åŠ å®¹æ˜“åœ°ç›´æ¥æ³¨å†Œ Spring Beanã€‚</p><p>æ‚¨å¯ä»¥ç›´æ¥åœ¨ <code>JsonSerializer</code> æˆ–è€… <code>JsonDeserializer</code> å®ç°ä¸Šä½¿ç”¨ <code>@JsonComponent</code> æ³¨è§£ã€‚æ‚¨ä¹Ÿå¯ä»¥åœ¨å°†åºåˆ—åŒ–å™¨/ååºåˆ—åŒ–å™¨ï¼ˆdeserializerï¼‰ä½œä¸ºå†…éƒ¨ç±»çš„ç±»ä¸Šä½¿ç”¨ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.*;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.jackson.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JsonComponent</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Example</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Serializer</span> <span class="keyword">extends</span> <span class="title class_">JsonSerializer</span>&lt;SomeObject&gt; &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Deserializer</span> <span class="keyword">extends</span> <span class="title class_">JsonDeserializer</span>&lt;SomeObject&gt; &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ApplicationContext</code> ä¸­æ‰€æœ‰çš„ <code>@JsonComponent</code> bean å°†è¢«è‡ªåŠ¨æ³¨å†Œåˆ° Jackson ä¸­ï¼Œç”±äº <code>@JsonComponent</code> ä½¿ç”¨ <code>@Component</code> æ³¨è§£æ ‡è®°ï¼Œå› æ­¤ç»„ä»¶æ‰«æï¼ˆcomponent-scanningï¼‰è§„åˆ™å°†å¯¹å…¶ç”Ÿæ•ˆã€‚</p><p>Spring Boot è¿˜æä¾›äº† <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jackson/JsonObjectSerializer.java">JsonObjectSerializer</a> å’Œ <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jackson/JsonObjectDeserializer.java">JsonObjectDeserializer</a> åŸºç±»ï¼Œå®ƒä»¬åœ¨åºåˆ—åŒ–å¯¹è±¡æ—¶ä¸ºæ ‡å‡†çš„ Jackson ç‰ˆæœ¬æä¾›äº†æœ‰ç”¨çš„æ›¿ä»£æ–¹æ¡ˆã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… Javadoc ä¸­çš„ <a href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/jackson/JsonObjectSerializer.html">JsonObjectSerializer</a> å’Œ <a href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/jackson/JsonObjectDeserializer.html">JsonObjectDeserializer</a>ã€‚</p><p><a id="boot-features-spring-message-codes"></a></p><h4 id="28-1-4ã€MessageCodesResolver">28.1.4ã€MessageCodesResolver</h4><p>Spring MVC æœ‰ä¸€ä¸ªä»ç»‘å®šé”™è¯¯ä¸­ç”Ÿæˆé”™è¯¯ç çš„ç­–ç•¥ï¼Œç”¨äºæ¸²æŸ“é”™è¯¯ä¿¡æ¯ï¼š<code>MessageCodesResolver</code>ã€‚å¦‚æœæ‚¨è®¾ç½®äº† <code>spring.mvc.message-codes-resolver.format</code> å±æ€§å€¼ä¸º <code>PREFIX_ERROR_CODE</code> æˆ– <code>POSTFIX_ERROR_CODE</code>ï¼ŒSpring Boot å°†ä¸ºä½ åˆ›å»ºè¯¥ç­–ç•¥ï¼ˆè¯·å‚é˜… <a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/javadoc-api/org/springframework/validation/DefaultMessageCodesResolver.Format.html">DefaultMessageCodesResolver.Format</a> ä¸­çš„æšä¸¾ï¼‰ã€‚</p><p><a id="boot-features-spring-mvc-static-content"></a></p><h4 id="28-1-5ã€é™æ€å†…å®¹">28.1.5ã€é™æ€å†…å®¹</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot å°†åœ¨ classpath æˆ–è€… <code>ServletContext</code> æ ¹ç›®å½•ä¸‹ä»åä¸º <code>/static</code> ï¼ˆ<code>/public</code>ã€<code>/resources</code> æˆ– <code>/META-INF/resources</code>ï¼‰ç›®å½•ä¸­æœåŠ¡é™æ€å†…å®¹ã€‚å®ƒä½¿ç”¨äº† Spring MVC çš„ <code>ResourceHttpRequestHandler</code>ï¼Œå› æ­¤æ‚¨å¯ä»¥é€šè¿‡æ·»åŠ è‡ªå·±çš„ <code>WebMvcConfigurerAdapter</code> å¹¶é‡å†™ <code>addResourceHandlers</code> æ–¹æ³•æ¥ä¿®æ”¹æ­¤è¡Œä¸ºã€‚</p><p>åœ¨ä¸€ä¸ªç‹¬ç«‹çš„ï¼ˆstand-aloneï¼‰ web åº”ç”¨ç¨‹åºä¸­ï¼Œæ¥è‡ªå®¹å™¨çš„é»˜è®¤ servlet ä¹Ÿæ˜¯è¢«å¯ç”¨çš„ï¼Œå¹¶å……å½“ä¸€ä¸ªå›é€€æ”¯æ´ï¼ŒSpring å†³å®šä¸å¤„ç† <code>ServletContext</code> æ ¹ç›®å½•ä¸‹çš„é™æ€èµ„æºï¼Œå®¹å™¨çš„é»˜è®¤ servlet ä¹Ÿå°†ä¼šå¤„ç†ã€‚å¤§å¤šæƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä¸ä¼šå‘ç”Ÿçš„ï¼ˆé™¤éæ‚¨ä¿®æ”¹äº†é»˜è®¤çš„ MVC é…ç½®ï¼‰ï¼Œå› ä¸º Spring å§‹ç»ˆèƒ½é€šè¿‡ <code>DispatcherServlet</code> æ¥å¤„ç†è¯·æ±‚ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œèµ„æºè¢«æ˜ å°„åˆ° <code>/**</code>ï¼Œä½†å¯ä»¥é€šè¿‡ <code>spring.mvc.static-path-pattern</code> å±æ€§è°ƒæ•´ã€‚æ¯”å¦‚ï¼Œå°†æ‰€æœ‰èµ„æºé‡å®šä½åˆ° <code>/resources/**</code>ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.mvc.<span class="keyword">static</span>-path-pattern=<span class="regexp">/resources/</span>**</span><br></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <code>spring.resources.static-locations</code> å±æ€§æ¥è‡ªå®šä¹‰é™æ€èµ„æºçš„ä½ç½®ï¼ˆä½¿ç”¨ä¸€ä¸ªç›®å½•ä½ç½®åˆ—è¡¨æ›¿æ¢é»˜è®¤å€¼ï¼‰ã€‚æ ¹ Servlet context path <code>/</code> è‡ªåŠ¨ä½œä¸ºä¸€ä¸ª location æ·»åŠ è¿›æ¥ã€‚</p><p>é™¤äº†ä¸Šè¿°æåˆ°çš„<strong>æ ‡å‡†</strong>é™æ€èµ„æºä½ç½®ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µæ˜¯ç”¨äº <a href="https://www.webjars.org/">Webjar å†…å®¹</a>ã€‚å¦‚æœä»¥ Webjar æ ¼å¼æ‰“åŒ…ï¼Œåˆ™æ‰€æœ‰ç¬¦åˆ <code>/webjars/**</code> çš„èµ„æºéƒ½å°†ä» jar æ–‡ä»¶ä¸­æœåŠ¡ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºè¦åŒ…æˆ jarï¼Œè¯·ä¸è¦ä½¿ç”¨ <code>src/main/webapp</code> ç›®å½•ã€‚è™½ç„¶æ­¤ç›®å½•æ˜¯ä¸€ä¸ªé€šç”¨æ ‡å‡†ï¼Œä½†å®ƒ<strong>åª</strong>é€‚ç”¨äº war æ‰“åŒ…ï¼Œå¦‚æœç”Ÿæˆçš„æ˜¯ä¸€ä¸ª jarï¼Œå®ƒå°†è¢«ç»å¤§å¤šæ•°çš„æ„å»ºå·¥å…·æ‰€å¿½ç•¥ã€‚</p></blockquote><p>Spring Boot è¿˜æ”¯æŒ Spring MVC æä¾›çš„é«˜çº§èµ„æºå¤„ç†åŠŸèƒ½ï¼Œå…è®¸ä½¿ç”¨ä¾‹å¦‚é™æ€èµ„æºç¼“å­˜æ¸…é™¤ï¼ˆcache bustingï¼‰æˆ–è€… Webjar ç‰ˆæœ¬æ— å…³ URLã€‚</p><p>è¦ä½¿ç”¨ Webjar ç‰ˆæœ¬æ— å…³ URL åŠŸèƒ½ï¼Œåªéœ€è¦æ·»åŠ  <code>webjars-locator-core</code> ä¾èµ–ã€‚ç„¶åå£°æ˜æ‚¨çš„ Webjarï¼Œä»¥ jQuery ä¸ºä¾‹ï¼Œæ·»åŠ çš„ <code>&quot;/webjars/jquery/dist/jquery.min.js&quot;</code> å°†å˜æˆ <code>&quot;/webjars/jquery/x.y.z/dist/jquery.min.js&quot;</code>ï¼Œå…¶ä¸­ <code>x.y.z</code> æ˜¯ Webjar çš„ç‰ˆæœ¬ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœæ‚¨ä½¿ç”¨ JBossï¼Œåˆ™éœ€è¦å£°æ˜ <code>webjars-locator-jboss-vfs</code> ä¾èµ–ï¼Œè€Œä¸æ˜¯ <code>webjars-locator-core</code>ï¼Œå¦åˆ™æ‰€æœ‰ Webjar å°†è¢«è§£ææˆ <code>404</code>ã€‚</p></blockquote><p>è¦ä½¿ç”¨ç¼“å­˜æ¸…é™¤åŠŸèƒ½ï¼Œä»¥ä¸‹é…ç½®ä¸ºæ‰€æœ‰é™æ€èµ„æºé…ç½®äº†ä¸€ä¸ªç¼“å­˜æ¸…é™¤æ–¹æ¡ˆï¼Œå®é™…ä¸Šæ˜¯åœ¨ URL ä¸Šæ·»åŠ äº†ä¸€ä¸ªå†…å®¹å“ˆå¸Œï¼Œä¾‹å¦‚ <code>&lt;link href=&quot;/css/spring-2a2d595e6ed9a0b24f027f2b63b134d6.css&quot;/&gt;</code>ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pring<span class="selector-class">.resources</span><span class="selector-class">.chain</span><span class="selector-class">.strategy</span><span class="selector-class">.content</span>.enabled=true</span><br><span class="line">spring<span class="selector-class">.resources</span><span class="selector-class">.chain</span><span class="selector-class">.strategy</span><span class="selector-class">.content</span>.paths=<span class="comment">/**</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>æ¨¡æ¿ä¸­çš„èµ„æºé“¾æ¥åœ¨è¿è¡Œæ—¶è¢«é‡å†™ï¼Œè¿™å¾—ç›Šäº <code>ResourceUrlEncodingFilter</code> ä¸º Thymeleaf å’Œ FreeMarker è‡ªåŠ¨é…ç½®ã€‚åœ¨ä½¿ç”¨ JSP æ—¶ï¼Œæ‚¨åº”è¯¥æ‰‹åŠ¨å£°æ˜æ­¤è¿‡æ»¤å™¨ã€‚å…¶ä»–æ¨¡æ¿å¼•æ“ç°åœ¨è¿˜ä¸ä¼šè‡ªåŠ¨æ”¯æŒï¼Œä½†å¯ä»¥ä¸è‡ªå®šä¹‰æ¨¡æ¿å®ï¼ˆmacroï¼‰/helper å’Œ <a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/servlet/resource/ResourceUrlProvider.html"><code>ResourceUrlProvider</code></a> ç»“åˆä½¿ç”¨ã€‚</p></blockquote><p>å½“ä½¿ç”¨ä¾‹å¦‚ Javascript æ¨¡å—åŠ è½½å™¨åŠ¨æ€åŠ è½½èµ„æºæ—¶ï¼Œé‡å‘½åæ–‡ä»¶æ˜¯ä¸å¯é€‰çš„ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ”¯æŒå…¶ä»–ç­–ç•¥å¹¶ä¸”å¯ä»¥ç»„åˆä½¿ç”¨çš„åŸå› ã€‚<strong>fixed</strong>ç­–ç•¥å°†åœ¨ URL ä¸­æ·»åŠ ä¸€ä¸ªé™æ€ç‰ˆæœ¬å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯æ›´æ”¹æ–‡ä»¶åï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.resources.chain.strategy.content.enabled</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">spring.resources.chain.strategy.content.paths</span>=/**</span><br><span class="line"><span class="attr">spring.resources.chain.strategy.fixed.enabled</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">spring.resources.chain.strategy.fixed.paths</span>=/js/lib/</span><br><span class="line"><span class="attr">spring.resources.chain.strategy.fixed.version</span>=v12</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ­¤é…ç½®ï¼ŒJavaScript æ¨¡å—å®šä½åœ¨ <code>&quot;/js/lib/&quot;</code> ä¸‹ä½¿ç”¨å›ºå®šç‰ˆæœ¬ç­–ç•¥ï¼ˆ<code>&quot;/v12/js/lib/mymodule.js&quot;</code>ï¼‰ï¼Œè€Œå…¶ä»–èµ„æºä»ä½¿ç”¨å†…å®¹ç­–ç•¥ï¼ˆ<code>&lt;link href=&quot;/css/spring-2a2d595e6ed9a0b24f027f2b63b134d6.css&quot;/&gt;</code>ï¼‰ã€‚</p><p>æœ‰å…³æ›´å¤šæ”¯æŒé€‰é¡¹ï¼Œè¯·å‚é˜… <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ResourceProperties.java">ResourceProperties</a>ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>è¯¥åŠŸèƒ½å·²ç»åœ¨ä¸€ä¸ªä¸“é—¨çš„<a href="https://spring.io/blog/2014/07/24/spring-framework-4-1-handling-static-web-resources">åšå®¢æ–‡ç« </a>å’Œ Spring æ¡†æ¶çš„<a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#mvc-config-static-resources">å‚è€ƒæ–‡æ¡£</a>ä¸­è¿›è¡Œäº†è¯¦ç»†æè¿°ã€‚</p></blockquote><p><a id="boot-features-spring-mvc-welcome-page"></a></p><h4 id="28-1-6ã€æ¬¢è¿é¡µé¢">28.1.6ã€æ¬¢è¿é¡µé¢</h4><p>Spring Boot æ”¯æŒé™æ€å’Œæ¨¡æ¿åŒ–çš„æ¬¢è¿é¡µé¢ã€‚å®ƒé¦–å…ˆåœ¨é…ç½®çš„é™æ€å†…å®¹ä½ç½®ä¸­æŸ¥æ‰¾ <code>index.html</code> æ–‡ä»¶ã€‚å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™æŸ¥æ‰¾ <code>index</code> æ¨¡æ¿ã€‚å¦‚æœæ‰¾åˆ°å…¶ä¸­ä»»ä½•ä¸€ä¸ªï¼Œå®ƒå°†è‡ªåŠ¨ç”¨ä½œåº”ç”¨ç¨‹åºçš„æ¬¢è¿é¡µé¢ã€‚</p><p><a id="boot-features-spring-mvc-favicon"></a></p><h4 id="28-1-7ã€è‡ªå®šä¹‰-Favicon">28.1.7ã€è‡ªå®šä¹‰ Favicon</h4><p>Spring Boot åœ¨é…ç½®çš„é™æ€å†…å®¹ä½ç½®å’Œæ ¹ classpath ä¸­æŸ¥æ‰¾ <code>favicon.ico</code>ï¼ˆæŒ‰é¡ºåºï¼‰ã€‚å¦‚æœè¯¥æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™å°†è¢«è‡ªåŠ¨ç”¨ä½œåº”ç”¨ç¨‹åºçš„ faviconã€‚</p><p><a id="boot-features-spring-mvc-pathmatch"></a></p><h4 id="28-1-8ã€è·¯å¾„åŒ¹é…ä¸å†…å®¹åå•†">28.1.8ã€è·¯å¾„åŒ¹é…ä¸å†…å®¹åå•†</h4><p>Spring MVC å¯ä»¥é€šè¿‡æŸ¥çœ‹è¯·æ±‚è·¯å¾„å¹¶å°†å…¶ä¸åº”ç”¨ç¨‹åºä¸­å®šä¹‰çš„æ˜ å°„ç›¸åŒ¹é…ï¼Œå°†ä¼ å…¥çš„ HTTP è¯·æ±‚æ˜ å°„åˆ°å¤„ç†ç¨‹åºï¼ˆä¾‹å¦‚ Controller æ–¹æ³•ä¸Šçš„ <code>@GetMapping</code> æ³¨è§£ï¼‰ã€‚</p><p>Spring Boot é»˜è®¤é€‰æ‹©ç¦ç”¨åç¼€æ¨¡å¼åŒ¹é…ï¼Œè¿™æ„å‘³ç€åƒ <code>&quot;GET /projects/spring-boot.json&quot;</code> è¿™æ ·çš„è¯·æ±‚å°†ä¸ä¼šä¸ <code>@GetMapping(&quot;/projects/spring-boot&quot;)</code> æ˜ å°„åŒ¹é…ã€‚è¿™è¢«è§†ä¸ºæ˜¯ <a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#mvc-ann-requestmapping-suffix-pattern-match">Spring MVC åº”ç”¨ç¨‹åºçš„æœ€ä½³å®è·µ</a>ã€‚æ­¤åŠŸèƒ½åœ¨è¿‡å»å¯¹äº HTTP å®¢æˆ·ç«¯æ²¡æœ‰å‘é€æ­£ç¡®çš„ <strong>Accept</strong> è¯·æ±‚å¤´çš„æƒ…å†µè¿˜æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿å°†æ­£ç¡®çš„å†…å®¹ç±»å‹å‘é€ç»™å®¢æˆ·ç«¯ã€‚å¦‚ä»Šï¼Œå†…å®¹åå•†ï¼ˆContent Negotiationï¼‰æ›´åŠ å¯é ã€‚</p><p>è¿˜æœ‰å…¶ä»–æ–¹æ³•å¯ä»¥å¤„ç† HTTP å®¢æˆ·ç«¯å‘é€ä¸ä¸€è‡´ <strong>Accept</strong> è¯·æ±‚å¤´é—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŸ¥è¯¢å‚æ•°æ¥ç¡®ä¿åƒ <code>&quot;GET /projects/spring-boot?format=json&quot;</code> è¿™æ ·çš„è¯·æ±‚æ˜ å°„åˆ° <code>@GetMapping(&quot;/projects/spring-boot&quot;)</code>ï¼Œè€Œä¸æ˜¯ä½¿ç”¨åç¼€åŒ¹é…ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.mvc.contentnegotiation.favor-parameter</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># We can change the parameter name, which is &quot;format&quot; by default:</span></span><br><span class="line"><span class="comment"># spring.mvc.contentnegotiation.parameter-name=myparam</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># We can also register additional file extensions/media types with:</span></span><br><span class="line"><span class="attr">spring.mvc.contentnegotiation.media-types.markdown</span>=text/markdown</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨äº†è§£ç›¸å…³æ³¨æ„äº‹é¡¹å¹¶ä»å¸Œæœ›åº”ç”¨ç¨‹åºä½¿ç”¨åç¼€æ¨¡å¼åŒ¹é…ï¼Œåˆ™éœ€è¦ä»¥ä¸‹é…ç½®ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.mvc.contentnegotiation.favor-path-extension</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">spring.mvc.pathmatch.use-suffix-pattern</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œä¸æ‰“å¼€æ‰€æœ‰åç¼€æ¨¡å¼ï¼Œä»…æ‰“å¼€æ”¯æŒå·²æ³¨å†Œçš„åç¼€æ¨¡å¼æ›´åŠ å®‰å…¨ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.mvc.contentnegotiation.favor-path-extension</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">spring.mvc.pathmatch.use-registered-suffix-pattern</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># You can also register additional file extensions/media types with:</span></span><br><span class="line"><span class="comment"># spring.mvc.contentnegotiation.media-types.adoc=text/asciidoc</span></span><br></pre></td></tr></table></figure><p><a id="boot-features-spring-mvc-web-binding-initializer"></a></p><h4 id="28-1-9ã€ConfigurableWebBindingInitializer">28.1.9ã€ConfigurableWebBindingInitializer</h4><p>Spring MVC ä½¿ç”¨ä¸€ä¸ª <code>WebBindingInitializer</code> ä¸ºç‰¹å®šçš„è¯·æ±‚åˆå§‹åŒ– <code>WebDataBinder</code>ã€‚å¦‚æœæ‚¨åˆ›å»ºäº†è‡ªå·±çš„ <code>ConfigurableWebBindingInitializer</code> <code>@Bean</code>ï¼ŒSpring Boot å°†è‡ªåŠ¨é…ç½® Spring MVC ä½¿ç”¨å®ƒã€‚</p><p><a id="boot-features-spring-mvc-template-engines"></a></p><h4 id="28-1-10ã€æ¨¡æ¿å¼•æ“">28.1.10ã€æ¨¡æ¿å¼•æ“</h4><p>é™¤äº† REST web æœåŠ¡ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨ Spring MVC æ¥æœåŠ¡åŠ¨æ€ HTML å†…å®¹ã€‚Spring MVC æ”¯æŒå¤šç§æ¨¡æ¿æŠ€æœ¯ï¼ŒåŒ…æ‹¬ Thymeleafã€FreeMarker å’Œ JSPã€‚å½“ç„¶ï¼Œè®¸å¤šå…¶ä»–æ¨¡æ¿å¼•æ“ä¹Ÿæœ‰è‡ªå·±çš„ Spring MVC é›†æˆã€‚</p><p>Spring Boot åŒ…å«äº†ä»¥ä¸‹çš„æ¨¡æ¿å¼•æ“çš„è‡ªåŠ¨é…ç½®æ”¯æŒï¼š</p><ul><li><a href="https://freemarker.apache.org/docs/">FreeMarker</a></li><li><a href="http://docs.groovy-lang.org/docs/next/html/documentation/template-engines.html#_the_markuptemplateengine">Groovy</a></li><li><a href="http://www.thymeleaf.org/">Thymeleaf</a></li><li><a href="https://mustache.github.io/">Mustache</a></li></ul><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœå¯ä»¥ï¼Œè¯·å°½é‡é¿å…ä½¿ç”¨ JSPï¼Œå½“ä½¿ç”¨äº†å†…åµŒ servlet å®¹å™¨ï¼Œä¼šæœ‰å‡ ä¸ª<a href="#boot-features-jsp-limitations">å·²çŸ¥é™åˆ¶</a>ã€‚</p></blockquote><p>å½“æ‚¨ä½¿ç”¨è¿™äº›æ¨¡æ¿å¼•æ“çš„å…¶ä¸­ä¸€ä¸ªå¹¶é™„å¸¦äº†é»˜è®¤é…ç½®æ—¶ï¼Œæ‚¨çš„æ¨¡æ¿å°†ä» <code>src/main/resources/templates</code> è‡ªåŠ¨è·å–ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>IntelliJ IDEA æ ¹æ®æ‚¨è¿è¡Œåº”ç”¨ç¨‹åºçš„æ–¹å¼æ¥å¯¹ classpath è¿›è¡Œä¸åŒçš„æ’åºã€‚åœ¨ IDE ä¸­é€šè¿‡ main æ–¹æ³•æ¥è¿è¡Œåº”ç”¨ç¨‹åºå°†å¯¼è‡´ä¸ä½¿ç”¨ Maven æˆ– Gradle æˆ–æ¥ä»¥ jar åŒ…æ–¹å¼å¼•ç”¨ç¨‹åºçš„æ’åºæœ‰æ‰€ä¸åŒï¼Œå¯èƒ½ä¼šå¯¼è‡´ Spring Boot æ‰¾ä¸åˆ° classpath ä¸­çš„æ¨¡æ¿ã€‚å¦‚æœæ‚¨ç¢°åˆ°åˆ°æ­¤é—®é¢˜ï¼Œå¯ä»¥é‡æ–°æ’åº IDE çš„ classpath æ¥æ”¾ç½®æ¨¡å—çš„ classes å’Œ resources åˆ°é¦–ä½ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥é…ç½®æ¨¡æ¿å‰ç¼€æ¥æœç´¢ classpath ä¸­çš„æ¯ä¸€ä¸ª <code>templates</code> ç›®å½•ï¼Œæ¯”å¦‚ï¼š<code>classpath*:/templates/</code>ã€‚</p></blockquote><p><a id="boot-features-error-handling"></a></p><h4 id="28-1-11ã€é”™è¯¯å¤„ç†">28.1.11ã€é”™è¯¯å¤„ç†</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot æä¾›äº†ä¸€ä¸ªä½¿ç”¨äº†æ¯”è¾ƒåˆç†çš„æ–¹å¼æ¥å¤„ç†æ‰€æœ‰é”™è¯¯çš„ <code>/error</code> æ˜ å°„ï¼Œå…¶åœ¨ servlet å®¹å™¨ä¸­æ³¨å†Œäº†ä¸€ä¸ª<strong>å…¨å±€</strong>é”™è¯¯é¡µé¢ã€‚å¯¹äºæœºå™¨å®¢æˆ·ç«¯è€Œè¨€ï¼Œå®ƒå°†äº§ç”Ÿä¸€ä¸ªåŒ…å«é”™è¯¯ã€HTTP çŠ¶æ€å’Œå¼‚å¸¸æ¶ˆæ¯çš„ JSON å“åº”ã€‚å¯¹äºæµè§ˆå™¨å®¢æˆ·ç«¯è€Œè¨€ï¼Œå°†ä»¥ HTML æ ¼å¼å‘ˆç°ç›¸åŒæ•°æ®çš„ <strong>whitelabel</strong> é”™è¯¯è§†å›¾ï¼ˆå¯æ·»åŠ ä¸€ä¸ªè§£æåˆ° <code>error</code> çš„ <code>View</code> è¿›è¡Œè‡ªå®šä¹‰ï¼‰ã€‚è¦å®Œå…¨æ›¿æ¢é»˜è®¤è¡Œä¸ºï¼Œæ‚¨å¯ä»¥å®ç° <code>ErrorController</code> å¹¶æ³¨å†Œè¯¥ç±»å‹çš„ beanï¼Œæˆ–è€…ç®€å•åœ°æ·»åŠ ä¸€ä¸ªç±»å‹ä¸º <code>ErrorAttributes</code> çš„ bean æ¥æ›¿æ¢å†…å®¹ï¼Œä½†ç»§ç»­ä½¿ç”¨ç°ç”¨æœºåˆ¶ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p><code>BasicErrorController</code> å¯ä»¥ä½œä¸ºè‡ªå®šä¹‰ <code>ErrorController</code> çš„åŸºç±»ï¼Œè¿™éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨æ‚¨æƒ³æ·»åŠ ä¸€ä¸ªæ–°çš„å†…å®¹ç±»å‹ï¼ˆé»˜è®¤ä¸“é—¨å¤„ç† <code>text/html</code>ï¼Œå¹¶ä¸ºå…¶ä»–å†…å®¹æä¾›åå¤‡ï¼‰å¤„ç†å™¨çš„æƒ…å†µä¸‹ã€‚è¦åšåˆ°è¿™ç‚¹ï¼Œæ‚¨åªéœ€è¦ç»§æ‰¿ <code>BasicErrorController</code> å¹¶æ·»åŠ ä¸€ä¸ªå¸¦æœ‰ <code>produces</code> å±æ€§çš„ <code>@RequestMapping</code> æ³¨è§£çš„å…¬å…±æ–¹æ³•ï¼Œä¹‹ååˆ›å»ºä¸€ä¸ªæ–°ç±»å‹çš„ beanã€‚</p></blockquote><p>æ‚¨è¿˜å¯ä»¥å®šä¹‰ä¸€ä¸ªå¸¦æœ‰ <code>@ControllerAdvice</code> æ³¨è§£çš„ç±»æ¥è‡ªå®šä¹‰ä¸ºç‰¹å®šæ§åˆ¶å™¨æˆ–å¼‚å¸¸ç±»å‹è¿”å›çš„ JSON æ–‡æ¡£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice(basePackageClasses = AcmeController.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AcmeControllerAdvice</span> <span class="keyword">extends</span> <span class="title class_">ResponseEntityExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ExceptionHandler(YourException.class)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line">ResponseEntity&lt;?&gt; handleControllerException(HttpServletRequest request, Throwable ex) &#123;</span><br><span class="line"><span class="type">HttpStatus</span> <span class="variable">status</span> <span class="operator">=</span> getStatus(request);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">CustomErrorType</span>(status.value(), ex.getMessage()), status);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> HttpStatus <span class="title function_">getStatus</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line"><span class="type">Integer</span> <span class="variable">statusCode</span> <span class="operator">=</span> (Integer) request.getAttribute(<span class="string">&quot;javax.servlet.error.status_code&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (statusCode == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> HttpStatus.INTERNAL_SERVER_ERROR;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> HttpStatus.valueOf(statusCode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œå¦‚æœåŒåŒ…ä¸‹å®šä¹‰çš„æ§åˆ¶å™¨ <code>AcmeController</code> æŠ›å‡ºäº† <code>YourException</code>ï¼Œåˆ™å°†ä½¿ç”¨ <code>CustomerErrorType</code> ç±»å‹çš„ POJO æ¥ä»£æ›¿ <code>ErrorAttributes</code> åš JSON å‘ˆç°ã€‚</p><p><a id="boot-features-error-handling-custom-error-pages"></a></p><h5 id="28-1-11-1ã€è‡ªå®šä¹‰é”™è¯¯é¡µé¢">28.1.11.1ã€è‡ªå®šä¹‰é”™è¯¯é¡µé¢</h5><p>å¦‚æœæ‚¨æƒ³åœ¨è‡ªå®šä¹‰çš„ HTML é”™è¯¯é¡µé¢ä¸Šæ˜¾ç¤ºç»™å®šçš„çŠ¶æ€ç ï¼Œè¯·å°†æ–‡ä»¶æ·»åŠ åˆ° <code>/error</code> æ–‡ä»¶å¤¹ä¸­ã€‚é”™è¯¯é¡µé¢å¯ä»¥æ˜¯é™æ€ HTMLï¼ˆæ·»åŠ åœ¨ä»»æ„é™æ€èµ„æºæ–‡ä»¶å¤¹ä¸‹) æˆ–è€…ä½¿ç”¨æ¨¡æ¿æ„å»ºã€‚æ–‡ä»¶çš„åç§°åº”è¯¥æ˜¯ç¡®åˆ‡çš„çŠ¶æ€ç æˆ–è€…ä¸€ä¸ªåºåˆ—æ©ç ã€‚</p><p>ä¾‹å¦‚ï¼Œè¦å°† <code>404</code> æ˜ å°„åˆ°ä¸€ä¸ªé™æ€ HTML æ–‡ä»¶ï¼Œæ–‡ä»¶å¤¹ç»“æ„å¯ä»¥å¦‚ä¸‹ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">src/</span><br><span class="line"> +- main/</span><br><span class="line">     +- java/</span><br><span class="line">     |   + &lt;source code&gt;</span><br><span class="line">     +- resources/</span><br><span class="line">         +- <span class="keyword">public</span>/</span><br><span class="line">             +- <span class="keyword">error</span>/</span><br><span class="line">             |   +- <span class="number">404.</span>html</span><br><span class="line">             +- &lt;other <span class="keyword">public</span> assets&gt;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ FreeMarker æ¨¡æ¿æ¥æ˜ å°„æ‰€æœ‰ <code>5xx</code> é”™è¯¯ï¼Œæ–‡ä»¶å¤¹çš„ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">src/</span><br><span class="line"> +- main/</span><br><span class="line">     +- java/</span><br><span class="line">     <span class="string">|   + &lt;source code&gt;</span></span><br><span class="line">     +- resources/</span><br><span class="line">         +- templates/</span><br><span class="line">             +- error/</span><br><span class="line">             <span class="string">|   +- 5xx.ftl</span></span><br><span class="line">             +- &lt;other templates&gt;</span><br></pre></td></tr></table></figure><p>å¯¹äºæ›´å¤æ‚çš„æ˜ å°„ï¼Œæ‚¨è¿˜é€šè¿‡å¯ä»¥æ·»åŠ å®ç°äº† <code>ErrorViewResolver</code> æ¥å£çš„ bean æ¥å¤„ç†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyErrorViewResolver</span> <span class="keyword">implements</span> <span class="title class_">ErrorViewResolver</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">resolveErrorView</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">HttpStatus status, Map&lt;String, Object&gt; model)</span> &#123;</span><br><span class="line"><span class="comment">// Use the request or status to optionally return a ModelAndView</span></span><br><span class="line"><span class="keyword">return</span> ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨å¸¸è§„çš„ Spring MVC åŠŸèƒ½ï¼Œæ¯”å¦‚ <a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#mvc-exceptionhandlers"><code>@ExceptionHandler</code> æ–¹æ³•</a>å’Œ <a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#mvc-ann-controller-advice">@ControllerAdvice</a><code>ã€‚ä¹‹åï¼ŒErrorController</code> å°†èƒ½æ¥æ”¶ä»»ä½•æœªå¤„ç†çš„å¼‚å¸¸ã€‚</p><p><a id="boot-features-error-handling-mapping-error-pages-without-mvc"></a></p><h5 id="28-1-11-2ã€æ˜ å°„åˆ°-Spring-MVC-ä¹‹å¤–çš„é”™è¯¯é¡µé¢">28.1.11.2ã€æ˜ å°„åˆ° Spring MVC ä¹‹å¤–çš„é”™è¯¯é¡µé¢</h5><p>å¯¹äºä¸ä½¿ç”¨ Spring MVC çš„åº”ç”¨ç¨‹åºï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>ErrorPageRegistrar</code> æ¥å£æ¥ç›´æ¥æ³¨å†Œ <code>ErrorPages</code>ã€‚æŠ½è±¡éƒ¨åˆ†ç›´æ¥ä¸åº•å±‚çš„å†…åµŒ servlet å®¹å™¨ä¸€èµ·å·¥ä½œï¼Œå³ä½¿æ‚¨æ²¡æœ‰ Spring MVC <code>DispatcherServlet</code> ä¹Ÿèƒ½ä½¿ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ErrorPageRegistrar <span class="title function_">errorPageRegistrar</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyErrorPageRegistrar</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyErrorPageRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ErrorPageRegistrar</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerErrorPages</span><span class="params">(ErrorPageRegistry registry)</span> &#123;</span><br><span class="line">registry.addErrorPages(<span class="keyword">new</span> <span class="title class_">ErrorPage</span>(HttpStatus.BAD_REQUEST, <span class="string">&quot;/400&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœæ‚¨æ³¨å†Œäº†ä¸€ä¸ª <code>ErrorPage</code>ï¼Œå®ƒçš„è·¯å¾„æœ€ç»ˆç”±ä¸€ä¸ª <code>Filter</code>ï¼ˆä¾‹å¦‚ï¼Œåƒä¸€äº›é Spring web æ¡†æ¶ä¸€æ ·ï¼Œæ¯”å¦‚ Jersey å’Œ Wicketï¼‰å¤„ç†ï¼Œåˆ™å¿…é¡»å°† Filter æ˜¾å¼æ³¨å†Œä¸ºä¸€ä¸ª <code>ERROR</code> dispatcherï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> FilterRegistrationBean <span class="title function_">myFilter</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">FilterRegistrationBean</span> <span class="variable">registration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>();</span><br><span class="line">registration.setFilter(<span class="keyword">new</span> <span class="title class_">MyFilter</span>());</span><br><span class="line">...</span><br><span class="line">registration.setDispatcherTypes(EnumSet.allOf(DispatcherType.class));</span><br><span class="line"><span class="keyword">return</span> registration;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œé»˜è®¤çš„ <code>FilterRegistrationBean</code> ä¸åŒ…å« <code>ERROR</code> è°ƒåº¦å™¨ï¼ˆdispatcherï¼‰ç±»å‹ã€‚</p><p><strong>å½“å¿ƒ</strong>ï¼šå½“éƒ¨ç½²åˆ° servlet å®¹å™¨æ—¶ï¼ŒSpring Boot ä½¿ç”¨å…¶é”™è¯¯é¡µé¢è¿‡æ»¤å™¨ä¼šå°†æœ‰é”™è¯¯çŠ¶æ€çš„è¯·æ±‚è½¬å‘åˆ°ç›¸åº”çš„é”™è¯¯é¡µé¢ã€‚å¦‚æœå°šæœªæäº¤å“åº”ï¼Œåˆ™åªèƒ½å°†è¯·æ±‚è½¬å‘åˆ°æ­£ç¡®çš„é”™è¯¯é¡µé¢ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒWebSphere Application Server 8.0 åŠæ›´é«˜ç‰ˆæœ¬åœ¨æˆåŠŸå®Œæˆ servlet çš„ service æ–¹æ³•åæäº¤å“åº”ã€‚æ‚¨åº”è¯¥å°† <code>com.ibm.ws.webcontainer.invokeFlushAfterService</code> è®¾ç½®ä¸º <code>false</code> æ¥ç¦ç”¨æ­¤è¡Œä¸ºã€‚</p><p><a id="boot-features-spring-hateoas"></a></p><h4 id="28-1-12ã€Spring-HATEOAS">28.1.12ã€Spring HATEOAS</h4><p>å¦‚æœæ‚¨æƒ³å¼€å‘ä¸€ä¸ªä½¿ç”¨è¶…åª’ä½“ï¼ˆhypermediaï¼‰çš„ RESTful APIï¼ŒSpring Boot æä¾›çš„ Spring HATEOAS è‡ªåŠ¨é…ç½®åœ¨å¤§å¤šæ•°åº”ç”¨ç¨‹åºéƒ½å·¥ä½œå¾—éå¸¸å¥½ã€‚è‡ªåŠ¨é…ç½®å–ä»£äº† <code>@EnableHypermediaSupport</code> çš„éœ€è¦ï¼Œå¹¶æ³¨å†Œäº†ä¸€äº› beanï¼Œä»¥ä¾¿èƒ½è½»æ¾æ„å»ºåŸºäºè¶…åª’ä½“çš„åº”ç”¨ç¨‹åºï¼Œå…¶åŒ…æ‹¬äº†ä¸€ä¸ª <code>LinkDiscoverers</code> ï¼ˆç”¨äºå®¢æˆ·ç«¯æ”¯æŒï¼‰å’Œä¸€ä¸ªç”¨äºé…ç½®å°†å“åº”æ­£ç¡®å‘ˆç°çš„ <code>ObjectMapper</code>ã€‚<code>ObjectMapper</code> å¯ä»¥é€šè¿‡è®¾ç½® <code>spring.jackson.*</code> å±æ€§æˆ–è€… <code>Jackson2ObjectMapperBuilder</code> bean ï¼ˆå¦‚æœå­˜åœ¨ï¼‰è‡ªå®šä¹‰ã€‚</p><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>@EnableHypermediaSupport</code> æ¥æ§åˆ¶ Spring HATEOAS çš„é…ç½®ã€‚è¯·æ³¨æ„ï¼Œè¿™ä½¿å¾—ä¸Šè¿°çš„è‡ªå®šä¹‰ ObjectMapper è¢«ç¦ç”¨ã€‚</p><p><a id="boot-features-cors"></a></p><h4 id="28-1-13ã€CORS-æ”¯æŒ">28.1.13ã€CORS æ”¯æŒ</h4><p><a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">è·¨åŸŸèµ„æºå…±äº«</a>ï¼ˆCross-origin resource sharingï¼ŒCORSï¼‰æ˜¯<a href="https://caniuse.com/#feat=cors">å¤§å¤šæ•°æµè§ˆå™¨</a>å®ç°çš„ä¸€ä¸ª <a href="https://www.w3.org/TR/cors/">W3C è§„èŒƒ</a>ï¼Œå…¶å¯å…è®¸æ‚¨ä»¥çµæ´»çš„æ–¹å¼æŒ‡å®šä½•ç§è·¨åŸŸè¯·æ±‚å¯ä»¥è¢«æˆæƒï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¸€äº›ä¸å¤ªå®‰å…¨å’Œä¸å¤ªå¼ºå¤§çš„æ–¹å¼ï¼ˆæ¯”å¦‚ IFRAME æˆ–è€… JSONPï¼‰ã€‚</p><p>Spring MVC ä» 4.2 ç‰ˆæœ¬èµ·å¼€å§‹<a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#cors">æ”¯æŒ CORS</a>ã€‚æ‚¨å¯åœ¨ Spring Boot åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ <a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#controller-method-cors-configuration"><code>@CrossOrigin</code></a> æ³¨è§£é…ç½®<a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#controller-method-cors-configuration">æ§åˆ¶å™¨æ–¹æ³•å¯ç”¨ CORS</a>ã€‚è¿˜å¯ä»¥é€šè¿‡æ³¨å†Œä¸€ä¸ª WebMvcConfigurer bean å¹¶è‡ªå®šä¹‰ <code>addCorsMappings(CorsRegistry)</code> æ–¹æ³•æ¥å®šä¹‰<a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#global-cors-configuration">å…¨å±€ CORS é…ç½®</a>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> WebMvcConfigurer <span class="title function_">corsConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;</span><br><span class="line">registry.addMapping(<span class="string">&quot;/api/**&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="boot-features-webflux"></a></p><h3 id="28-2ã€Spring-WebFlux-æ¡†æ¶">28.2ã€Spring WebFlux æ¡†æ¶</h3><p>Spring WebFlux æ˜¯ Spring Framework 5.0 ä¸­æ–°å¼•å…¥çš„ä¸€ä¸ªå“åº”å¼ Web æ¡†æ¶ã€‚ä¸ Spring MVC ä¸åŒï¼Œå®ƒä¸éœ€è¦ Servlet APIï¼Œå®Œå…¨å¼‚æ­¥ä¸”æ— é˜»å¡ï¼Œå¹¶é€šè¿‡ <a href="http://www.reactive-streams.org/">Reactor é¡¹ç›®</a>å®ç°<a href="http://www.reactive-streams.org/">å“åº”å¼æµï¼ˆReactive Streamsï¼‰</a>è§„èŒƒã€‚</p><p>Spring WebFlux æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼šå‡½æ•°å¼å’ŒåŸºäºæ³¨è§£ã€‚åŸºäºæ³¨è§£çš„æ–¹å¼éå¸¸æ¥è¿‘ Spring MVC æ¨¡å‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRestController</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;user&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable</span> Long user)</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;user&#125;/customers&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Flux&lt;Customer&gt; <span class="title function_">getUserCustomers</span><span class="params">(<span class="meta">@PathVariable</span> Long user)</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/&#123;user&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;User&gt; <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@PathVariable</span> Long user)</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>WebFlux.fn</strong> ä¸ºå‡½æ•°å¼è°ƒç”¨æ–¹å¼ï¼Œå®ƒå°†è·¯ç”±é…ç½®ä¸è¯·æ±‚å¤„ç†åˆ†å¼€ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoutingConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="title function_">monoRouterFunction</span><span class="params">(UserHandler userHandler)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> route(GET(<span class="string">&quot;/&#123;user&#125;&quot;</span>).and(accept(APPLICATION_JSON)), userHandler::getUser)</span><br><span class="line">.andRoute(GET(<span class="string">&quot;/&#123;user&#125;/customers&quot;</span>).and(accept(APPLICATION_JSON)), userHandler::getUserCustomers)</span><br><span class="line">.andRoute(DELETE(<span class="string">&quot;/&#123;user&#125;&quot;</span>).and(accept(APPLICATION_JSON)), userHandler::deleteUser);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserHandler</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">getUser</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">getUserCustomers</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Mono&lt;ServerResponse&gt; <span class="title function_">deleteUser</span><span class="params">(ServerRequest request)</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>WebFlux æ˜¯ Spring Framework çš„ä¸€éƒ¨åˆ†ï¼Œè¯¦ç»†ä¿¡æ¯å¯æŸ¥çœ‹å…¶<a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web-reactive.html#webflux-fn">å‚è€ƒæ–‡æ¡£</a>ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>æ‚¨å¯ä»¥æ ¹æ®éœ€è¦å®šä¹‰å°½å¯èƒ½å¤šçš„ <code>RouterFunction</code> bean æ¥æ¨¡å—åŒ–è·¯ç”±å®šä¹‰ã€‚å¦‚æœéœ€è¦è®¾å®šä¼˜å…ˆçº§ï¼ŒBean å¯ä»¥æŒ‡å®šé¡ºåºã€‚</p></blockquote><p>é¦–å…ˆï¼Œå°† <code>spring-boot-starter-webflux</code> æ¨¡å—æ·»åŠ åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>åœ¨åº”ç”¨ç¨‹åºä¸­åŒæ—¶æ·»åŠ  <code>spring-boot-starter-web</code> å’Œ <code>spring-boot-starter-webflux</code> æ¨¡å—ä¼šå¯¼è‡´Spring Boot è‡ªåŠ¨é…ç½® Spring MVCï¼Œè€Œä¸æ˜¯ä½¿ç”¨ WebFluxã€‚è¿™æ ·åšçš„åŸå› æ˜¯å› ä¸ºè®¸å¤š Spring å¼€å‘äººå‘˜å°† <code>spring-boot-starter-webflux</code> æ·»åŠ åˆ°ä»–ä»¬çš„ Spring MVC åº”ç”¨ç¨‹åºä¸­åªæ˜¯ä¸ºäº†ä½¿ç”¨å“åº”å¼ <code>WebClient</code>ã€‚ æ‚¨ä»ç„¶å¯ä»¥é€šè¿‡è®¾ç½® <code>SpringApplication.setWebApplicationType(WebApplicationType.REACTIVE)</code> æ¥å¼ºåˆ¶æ‰§è¡Œæ‚¨é€‰æ‹©çš„åº”ç”¨ç¨‹åºç±»å‹ã€‚</p></blockquote><p><a id="boot-features-webflux-auto-configuration"></a></p><h4 id="28-2-1ã€Spring-WebFlux-è‡ªåŠ¨é…ç½®">28.2.1ã€Spring WebFlux è‡ªåŠ¨é…ç½®</h4><p>Spring Boot ä¸º Spring WebFlux æä¾›è‡ªåŠ¨é…ç½®ï¼Œé€‚ç”¨äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºã€‚</p><p>è‡ªåŠ¨é…ç½®åœ¨ Spring çš„é»˜è®¤åŸºç¡€ä¸Šæ·»åŠ äº†ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ul><li>ä¸º <code>HttpMessageReader</code> å’Œ <code>HttpMessageWriter</code> å®ä¾‹é…ç½®ç¼–è§£ç å™¨ï¼ˆ<a href="#boot-features-webflux-httpcodecs">ç¨åå°†ä»‹ç»</a>ï¼‰ã€‚</li><li>æ”¯æŒæä¾›é™æ€èµ„æºï¼ŒåŒ…æ‹¬å¯¹ WebJars çš„æ”¯æŒï¼ˆ<a href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/reference/htmlsingle/#boot-features-spring-mvc-static-content">åé¢å°†ä»‹ç»</a>ï¼‰ã€‚</li></ul><p>å¦‚æœä½ è¦ä¿ç•™ Spring Boot WebFlux åŠŸèƒ½å¹¶ä¸”æƒ³è¦æ·»åŠ å…¶ä»– <a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web.html#web-reactive">WebFlux é…ç½®</a>ï¼Œå¯ä»¥æ·»åŠ è‡ªå·±çš„ <code>@Configuration</code> ç±»ï¼Œç±»å‹ä¸º <code>WebFluxConfigurer</code>ï¼Œä½†ä¸åŒ…å« <code>@EnableWebFlux</code>ã€‚</p><p>å¦‚æœæ‚¨æƒ³å®Œå…¨æ§åˆ¶ Spring WebFluxï¼Œå¯ä»¥å°† <code>@EnableWebFlux</code> æ³¨è§£åˆ°è‡ªå·±çš„ @Configurationã€‚</p><p><a id="boot-features-webflux-httpcodecs"></a></p><h4 id="28-2-2ã€ä½¿ç”¨-HttpMessageReader-å’Œ-HttpMessageWriter-ä½œä¸º-HTTP-ç¼–è§£ç å™¨">28.2.2ã€ä½¿ç”¨ HttpMessageReader å’Œ HttpMessageWriter ä½œä¸º HTTP ç¼–è§£ç å™¨</h4><p>Spring WebFlux ä½¿ç”¨ <code>HttpMessageReader</code> å’Œ <code>HttpMessageWriter</code> æ¥å£æ¥è½¬æ¢ HTTP çš„è¯·æ±‚å’Œå“åº”ã€‚å®ƒä»¬é€šè¿‡æ£€æµ‹ classpath ä¸­å¯ç”¨çš„ç±»åº“ï¼Œé…ç½®äº† <code>CodecConfigurer</code> ç”Ÿæˆåˆé€‚çš„é»˜è®¤å€¼ã€‚</p><p>Spring Boot é€šè¿‡ä½¿ç”¨ <code>CodecCustomizer</code> å®ä¾‹åŠ å¼ºå®šåˆ¶ã€‚ä¾‹å¦‚ï¼Œ<code>spring.jackson.*</code> é…ç½® key åº”ç”¨äº Jackson ç¼–è§£ç å™¨ã€‚</p><p>å¦‚æœéœ€è¦æ·»åŠ æˆ–è‡ªå®šä¹‰ç¼–è§£ç å™¨ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>CodecCustomizer</code> ç»„ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.web.codec.CodecCustomizer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> CodecCustomizer <span class="title function_">myCodecCustomizer</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> codecConfigurer -&gt; &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥åˆ©ç”¨ <a href="#boot-features-json-components">Boot çš„è‡ªå®šä¹‰ JSON åºåˆ—åŒ–å™¨å’Œååºåˆ—åŒ–å™¨</a>ã€‚</p><p><a id="boot-features-webflux-static-content"></a></p><h4 id="28-2-3ã€é™æ€å†…å®¹">28.2.3ã€é™æ€å†…å®¹</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot å°†åœ¨ classpath æˆ–è€… <code>ServletContext</code> æ ¹ç›®å½•ä¸‹ä»åä¸º <code>/static</code> ï¼ˆ<code>/public</code>ã€<code>/resources</code> æˆ– <code>/META-INF/resources</code>ï¼‰ç›®å½•ä¸­æœåŠ¡é™æ€å†…å®¹ã€‚å®ƒä½¿ç”¨äº† Spring WebFlux çš„ <code>ResourceWebHandler</code>ï¼Œå› æ­¤æ‚¨å¯ä»¥é€šè¿‡æ·»åŠ è‡ªå·±çš„ <code>WebFluxConfigurer</code> å¹¶é‡å†™ <code>addResourceHandlers</code> æ–¹æ³•æ¥ä¿®æ”¹æ­¤è¡Œä¸ºã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œèµ„æºè¢«æ˜ å°„åˆ° <code>/**</code>ï¼Œä½†å¯ä»¥é€šè¿‡ <code>spring.webflux.static-path-pattern</code> å±æ€§è°ƒæ•´ã€‚æ¯”å¦‚ï¼Œå°†æ‰€æœ‰èµ„æºé‡å®šä½åˆ° <code>/resources/**</code>ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.webflux.<span class="keyword">static</span>-path-pattern=<span class="regexp">/resources/</span>**</span><br></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <code>spring.resources.static-locations</code> å±æ€§æ¥è‡ªå®šä¹‰é™æ€èµ„æºçš„ä½ç½®ï¼ˆä½¿ç”¨ä¸€ä¸ªç›®å½•ä½ç½®åˆ—è¡¨æ›¿æ¢é»˜è®¤å€¼ï¼‰ï¼Œå¦‚æœè¿™æ ·åšï¼Œé»˜è®¤çš„æ¬¢è¿é¡µé¢æ£€æµ‹ä¼šåˆ‡æ¢åˆ°æ‚¨è‡ªå®šä¹‰çš„ä½ç½®ã€‚å› æ­¤ï¼Œå¦‚æœå¯åŠ¨æ—¶æœ‰ä»»ä½•å…¶ä¸­ä¸€ä¸ªä½ç½®å­˜åœ¨ <code>index.html</code>ï¼Œé‚£ä¹ˆå®ƒå°†æ˜¯åº”ç”¨ç¨‹åºçš„ä¸»é¡µã€‚</p><p>é™¤äº†ä¸Šè¿°æåˆ°çš„<strong>æ ‡å‡†</strong>é™æ€èµ„æºä½ç½®ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µæ˜¯ç”¨äº <a href="https://www.webjars.org/">Webjar å†…å®¹</a>ã€‚å¦‚æœä»¥ Webjar æ ¼å¼æ‰“åŒ…ï¼Œåˆ™æ‰€æœ‰ç¬¦åˆ <code>/webjars/**</code> çš„èµ„æºéƒ½å°†ä» jar æ–‡ä»¶ä¸­æœåŠ¡ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>Spring WebFlux åº”ç”¨ç¨‹åºå¹¶ä¸ä¸¥æ ¼ä¾èµ–äº Servlet APIï¼Œå› æ­¤å®ƒä»¬ä¸èƒ½ä½œä¸º war æ–‡ä»¶éƒ¨ç½²ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨ <code>src/main/webapp</code> ç›®å½•ã€‚</p></blockquote><p><a id="boot-features-webflux-template-engines"></a></p><h4 id="28-2-4ã€æ¨¡æ¿å¼•æ“">28.2.4ã€æ¨¡æ¿å¼•æ“</h4><p>é™¤äº† REST web æœåŠ¡ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨ Spring WebFlux æ¥æœåŠ¡åŠ¨æ€ HTML å†…å®¹ã€‚Spring WebFlux æ”¯æŒå¤šç§æ¨¡æ¿æŠ€æœ¯ï¼ŒåŒ…æ‹¬ Thymeleafã€FreeMarker å’Œ Mustacheã€‚</p><p>Spring Boot åŒ…å«äº†ä»¥ä¸‹çš„æ¨¡æ¿å¼•æ“çš„è‡ªåŠ¨é…ç½®æ”¯æŒï¼š</p><ul><li><a href="https://freemarker.apache.org/docs/">FreeMarker</a></li><li><a href="http://www.thymeleaf.org/">Thymeleaf</a></li><li><a href="https://mustache.github.io/">Mustache</a></li></ul><p>å½“æ‚¨ä½¿ç”¨è¿™äº›æ¨¡æ¿å¼•æ“çš„å…¶ä¸­ä¸€ä¸ªå¹¶é™„å¸¦äº†é»˜è®¤é…ç½®æ—¶ï¼Œæ‚¨çš„æ¨¡æ¿å°†ä» <code>src/main/resources/templates</code> è‡ªåŠ¨è·å–ã€‚</p><p><a id="boot-features-webflux-error-handling"></a></p><h4 id="28-2-5ã€é”™è¯¯å¤„ç†">28.2.5ã€é”™è¯¯å¤„ç†</h4><p>Spring Boot æä¾›äº†ä¸€ä¸ª <code>WebExceptionHandler</code>ï¼Œå®ƒä»¥åˆç†çš„æ–¹å¼å¤„ç†æ‰€æœ‰é”™è¯¯ã€‚å®ƒåœ¨å¤„ç†é¡ºåºä¸­çš„ä½ç½®ç´§æ¥åœ¨ WebFlux æä¾›çš„å¤„ç†ç¨‹åºä¹‹å‰ï¼Œè¿™äº›å¤„ç†å™¨æ’åºæ˜¯æœ€åçš„ã€‚å¯¹äºæœºå™¨å®¢æˆ·ç«¯ï¼Œå®ƒä¼šç”Ÿæˆä¸€ä¸ª JSON å“åº”ï¼Œå…¶ä¸­åŒ…å«é”™è¯¯è¯¦æƒ…ã€HTTP çŠ¶æ€å’Œå¼‚å¸¸æ¶ˆæ¯ã€‚å¯¹äºæµè§ˆå™¨å®¢æˆ·ç«¯ï¼Œæœ‰ä¸€ä¸ª <strong>whitelabel</strong> é”™è¯¯å¤„ç†ç¨‹åºï¼Œå®ƒä»¥ HTML æ ¼å¼å‘ˆç°åŒæ ·çš„æ•°æ®ã€‚æ‚¨è¿˜å¯ä»¥æä¾›è‡ªå·±çš„ HTML æ¨¡æ¿æ¥æ˜¾ç¤ºé”™è¯¯ï¼ˆ<a href="#boot-features-webflux-error-handling-custom-error-pages">è¯·å‚é˜…ä¸‹ä¸€èŠ‚</a>ï¼‰ã€‚</p><p>è‡ªå®šä¹‰æ­¤åŠŸèƒ½çš„ç¬¬ä¸€æ­¥é€šå¸¸ä¼šæ²¿ç”¨ç°æœ‰æœºåˆ¶ï¼Œä½†æ›¿æ¢æˆ–æ‰©å……äº†é”™è¯¯å†…å®¹ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥æ·»åŠ  <code>ErrorAttributes</code> ç±»å‹çš„ beanã€‚</p><p>æƒ³è¦æ›´æ”¹é”™è¯¯å¤„ç†è¡Œä¸ºï¼Œå¯ä»¥å®ç° <code>ErrorWebExceptionHandler</code> å¹¶æ³¨å†Œè¯¥ç±»å‹çš„ beanã€‚å› ä¸º <code>WebExceptionHandler</code> æ˜¯ä¸€ä¸ªéå¸¸åº•å±‚çš„å¼‚å¸¸å¤„ç†å™¨ï¼Œæ‰€ä»¥ Spring Boot è¿˜æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„ <code>AbstractErrorWebExceptionHandler</code> æ¥è®©ä½ ä»¥ WebFlux çš„æ–¹å¼å¤„ç†é”™è¯¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomErrorWebExceptionHandler</span> <span class="keyword">extends</span> <span class="title class_">AbstractErrorWebExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Define constructor here</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> RouterFunction&lt;ServerResponse&gt; <span class="title function_">getRoutingFunction</span><span class="params">(ErrorAttributes errorAttributes)</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> RouterFunctions</span><br><span class="line">.route(aPredicate, aHandler)</span><br><span class="line">.andRoute(anotherPredicate, anotherHandler);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦è·å¾—æ›´å®Œæ•´çš„åŠŸèƒ½ï¼Œæ‚¨è¿˜å¯ä»¥ç›´æ¥ç»§æ‰¿ <code>DefaultErrorWebExceptionHandler</code> å¹¶è¦†ç›–ç›¸å…³æ–¹æ³•ã€‚</p><p><a id="boot-features-webflux-error-handling-custom-error-pages"></a></p><h5 id="28-2-5-1ã€è‡ªå®šä¹‰é”™è¯¯é¡µé¢">28.2.5.1ã€è‡ªå®šä¹‰é”™è¯¯é¡µé¢</h5><p>å¦‚æœæ‚¨æƒ³åœ¨è‡ªå®šä¹‰çš„ HTML é”™è¯¯é¡µé¢ä¸Šæ˜¾ç¤ºç»™å®šçš„çŠ¶æ€ç ï¼Œè¯·å°†æ–‡ä»¶æ·»åŠ åˆ° <code>/error</code> æ–‡ä»¶å¤¹ä¸­ã€‚é”™è¯¯é¡µé¢å¯ä»¥æ˜¯é™æ€ HTMLï¼ˆæ·»åŠ åœ¨ä»»æ„é™æ€èµ„æºæ–‡ä»¶å¤¹ä¸‹) æˆ–è€…ä½¿ç”¨æ¨¡æ¿æ„å»ºã€‚æ–‡ä»¶çš„åç§°åº”è¯¥æ˜¯ç¡®åˆ‡çš„çŠ¶æ€ç æˆ–è€…ä¸€ä¸ªåºåˆ—æ©ç ã€‚</p><p>ä¾‹å¦‚ï¼Œè¦å°† <code>404</code> æ˜ å°„åˆ°ä¸€ä¸ªé™æ€ HTML æ–‡ä»¶ï¼Œæ–‡ä»¶å¤¹ç»“æ„å¯ä»¥å¦‚ä¸‹ï¼š</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">src/</span><br><span class="line"> +- main/</span><br><span class="line">     +- java/</span><br><span class="line">     |   + &lt;source code&gt;</span><br><span class="line">     +- resources/</span><br><span class="line">         +- <span class="keyword">public</span>/</span><br><span class="line">             +- <span class="keyword">error</span>/</span><br><span class="line">             |   +- <span class="number">404.</span>html</span><br><span class="line">             +- &lt;other <span class="keyword">public</span> assets&gt;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ Mustache æ¨¡æ¿æ¥æ˜ å°„æ‰€æœ‰ <code>5xx</code> é”™è¯¯ï¼Œæ–‡ä»¶å¤¹çš„ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">src/</span><br><span class="line"> +- main/</span><br><span class="line">     +- java/</span><br><span class="line">     <span class="string">|   + &lt;source code&gt;</span></span><br><span class="line">     +- resources/</span><br><span class="line">         +- templates/</span><br><span class="line">             +- error/</span><br><span class="line">             <span class="string">|   +- 5xx.mustache</span></span><br><span class="line">             +- &lt;other templates&gt;</span><br></pre></td></tr></table></figure><p><a id="boot-features-webflux-web-filters"></a></p><h4 id="28-2-6ã€Web-è¿‡æ»¤å™¨">28.2.6ã€Web è¿‡æ»¤å™¨</h4><p>Spring WebFlux æä¾›äº†ä¸€ä¸ª <code>WebFilter</code> æ¥å£ï¼Œå¯ä»¥é€šè¿‡å®ç°è¯¥æ¥å£æ¥è¿‡æ»¤ HTTP è¯·æ±‚/å“åº”æ¶ˆæ¯äº¤æ¢ã€‚åœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­æ‰¾åˆ°çš„ WebFilter bean å°†è‡ªåŠ¨ç”¨äºè¿‡æ»¤æ¯ä¸ªæ¶ˆæ¯äº¤æ¢ã€‚</p><p>å¦‚æœè¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºå¾ˆé‡è¦ï¼Œåˆ™å¯ä»¥å®ç° <code>Ordered</code> æ¥å£æˆ–ä½¿ç”¨ <code>@Order</code> æ³¨è§£æ¥æŒ‡å®šé¡ºåºã€‚Spring Boot è‡ªåŠ¨é…ç½®å¯èƒ½ä¸ºæ‚¨é…ç½®äº†å‡ ä¸ª Web è¿‡æ»¤å™¨ã€‚æ‰§è¡Œæ­¤æ“ä½œæ—¶ï¼Œå°†ä½¿ç”¨ä¸‹è¡¨ä¸­çš„é¡ºåºï¼š</p><table><thead><tr><th>Web è¿‡æ»¤å™¨</th><th>é¡ºåº</th></tr></thead><tbody><tr><td><code>MetricsWebFilter</code></td><td><code>Ordered.HIGHEST_PRECEDENCE + 1</code></td></tr><tr><td><code>WebFilterChainProxy</code>ï¼ˆSpring Securityï¼‰</td><td><code>-100</code></td></tr><tr><td><code>HttpTraceWebFilter</code></td><td><code>Ordered.LOWEST_PRECEDENCE - 10</code></td></tr></tbody></table><p><a id="boot-features-jersey"></a></p><h3 id="28-3ã€JAX-RS-ä¸-Jersey">28.3ã€JAX-RS ä¸ Jersey</h3><p>å¦‚æœæ‚¨å–œæ¬¢ JAX-RS ç¼–ç¨‹æ¨¡å‹çš„ REST ç«¯ç‚¹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå®ç°æ¥æ›¿ä»£ Spring MVCã€‚<a href="https://jersey.github.io/">Jersey</a> å’Œ <a href="https://cxf.apache.org/">Apache CXF</a> éƒ½èƒ½å¼€ç®±å³ç”¨ã€‚CXF è¦æ±‚åœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ä»¥ <code>@Bean</code> çš„æ–¹å¼å°†å®ƒæ³¨å†Œä¸ºä¸€ä¸ª <code>Servlet</code> æˆ–è€… <code>Filter</code>ã€‚Jersey æœ‰éƒ¨åˆ†åŸç”Ÿ Spring æ”¯æŒï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿåœ¨ starter ä¸­æä¾›äº†ä¸ Spring Boot æ•´åˆçš„è‡ªåŠ¨é…ç½®æ”¯æŒã€‚</p><p>è¦ä½¿ç”¨ Jerseyï¼Œåªéœ€è¦å°† <code>spring-boot-starter-jersey</code> ä½œä¸ºä¾èµ–å¼•å…¥ï¼Œç„¶åæ‚¨éœ€è¦ä¸€ä¸ª <code>ResourceConfig</code> ç±»å‹çš„ <code>@Bean</code>ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æ³¨å†Œæ‰€æœ‰ç«¯ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JerseyConfig</span> <span class="keyword">extends</span> <span class="title class_">ResourceConfig</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">JerseyConfig</span><span class="params">()</span> &#123;</span><br><span class="line">register(Endpoint.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è­¦å‘Š</strong></p><blockquote><p>Jersey å¯¹äºæ‰«æå¯æ‰§è¡Œå½’æ¡£æ–‡ä»¶çš„æ”¯æŒæ˜¯ç›¸å½“æœ‰é™çš„ã€‚ä¾‹å¦‚ï¼Œå®ƒæ— æ³•æ‰«æä¸€ä¸ª<a href="#deployment-install">å®Œæ•´çš„å¯æ‰§è¡Œ jar æ–‡ä»¶</a>ä¸­çš„ç«¯ç‚¹ï¼ŒåŒæ ·ï¼Œå½“è¿è¡Œä¸€ä¸ªå¯æ‰§è¡Œçš„ war æ–‡ä»¶æ—¶ï¼Œå®ƒä¹Ÿæ— æ³•æ‰«æåŒ…ä¸­ <code>WEB-INF/classes</code> ä¸‹çš„ç«¯ç‚¹ã€‚ä¸ºäº†é¿å…è¯¥é™åˆ¶ï¼Œæ‚¨ä¸åº”è¯¥ä½¿ç”¨ <code>packages</code> æ–¹æ³•ï¼Œåº”è¯¥ä½¿ç”¨ä¸Šè¿°çš„ <code>register</code> æ–¹æ³•æ¥å•ç‹¬æ³¨å†Œæ¯ä¸€ä¸ªç«¯ç‚¹ã€‚</p></blockquote><p>æ‚¨å¯ä»¥æ³¨å†Œä»»æ„æ•°é‡å®ç°äº† <code>ResourceConfigCustomizer</code> çš„ beanï¼Œä»¥å®ç°æ›´é«˜çº§çš„å®šåˆ¶åŒ–ã€‚</p><p>æ‰€æœ‰æ³¨å†Œçš„ç«¯ç‚¹éƒ½åº”æ³¨è§£äº† <code>@Components</code> å¹¶å…·æœ‰ HTTP èµ„æºæ³¨è§£ï¼ˆ <code>@GET</code> ç­‰ï¼‰ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Path(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Endpoint</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GET</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">message</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äº <code>Endpoint</code> æ˜¯ä¸€ä¸ª Spring <code>@Component</code>ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸç”± Spring ç®¡ç†ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>@Autowired</code> æ³¨å…¥ä¾èµ–å¹¶ä½¿ç”¨ <code>@Value</code> æ³¨å…¥å¤–éƒ¨é…ç½®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒJersey servlet å°†è¢«æ³¨å†Œå¹¶æ˜ å°„åˆ° <code>/*</code>ã€‚æ‚¨å¯ä»¥é€šè¿‡å°† <code>@ApplicationPath</code> æ·»åŠ åˆ° <code>ResourceConfig</code> æ¥æ”¹å˜æ­¤è¡Œä¸ºã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒJersey åœ¨ <code>ServletRegistrationBean</code> ç±»å‹çš„ <code>@Bean</code> ä¸­è¢«è®¾ç½®ä¸ºä¸€ä¸ªåä¸º <code>jerseyServletRegistration</code> çš„ Servletã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥ servlet å°†è¢«å»¶è¿Ÿåˆå§‹åŒ–ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>spring.jersey.servlet.load-on-startup</code> è‡ªå®šä¹‰ã€‚æ‚¨å¯ä»¥ç¦ç”¨æˆ–é€šè¿‡åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„åŒå bean æ¥è¦†ç›–è¯¥ beanã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡è®¾ç½® <code>spring.jersey.type=filter</code> ä½¿ç”¨è¿‡æ»¤å™¨æ›¿ä»£ servletï¼ˆè¯¥æƒ…å†µä¸‹ï¼Œ æ›¿ä»£æˆ–è¦†ç›– <code>@Bean</code> çš„ä¸º<code>jerseyFilterRegistration</code>ï¼‰ã€‚è¯¥è¿‡æ»¤å™¨æœ‰ä¸€ä¸ª <code>@Order</code>ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>spring.jersey.filter.order</code> è®¾ç½®ã€‚å¯ä»¥ä½¿ç”¨ <code>spring.jersey.init.*</code> æŒ‡å®šä¸€ä¸ª map ç±»å‹çš„ property ä»¥ç»™å®š servlet å’Œè¿‡æ»¤å™¨çš„åˆå§‹åŒ–å‚æ•°ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ä¸ª <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-jersey">Jersey ç¤ºä¾‹</a>ï¼Œæ‚¨å¯ä»¥è§£å¦‚ä½•è®¾ç½®ã€‚</p><p><a id="boot-features-embedded-container"></a></p><h3 id="28-4ã€å†…åµŒ-Servlet-å®¹å™¨æ”¯æŒ">28.4ã€å†…åµŒ Servlet å®¹å™¨æ”¯æŒ</h3><p>Spring Boot åŒ…å«äº†å¯¹å†…åµŒ <a href="https://tomcat.apache.org/">Tomcat</a>ã€<a href="https://www.eclipse.org/jetty/">Jetty</a> å’Œ <a href="http://undertow.io/">Undertow</a> æœåŠ¡å™¨çš„æ”¯æŒã€‚å¤§éƒ¨åˆ†å¼€å‘äººå‘˜åªéœ€ç®€å•åœ°ä½¿ç”¨å¯¹åº”çš„ Starter æ¥è·å–å®Œæ•´çš„é…ç½®å®ä¾‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå†…åµŒæœåŠ¡å™¨å°†ç›‘å¬ <code>8080</code> ä¸Šçš„ HTTP è¯·æ±‚ã€‚</p><p><strong>è­¦å‘Š</strong></p><blockquote><p>å¦‚æœæ‚¨é€‰æ‹©åœ¨ <a href="https://www.centos.org/">CentOS</a> ä½¿ç”¨ Tomcatï¼Œè¯·æ³¨æ„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸´æ—¶ç›®å½•ç”¨äºå‚¨å­˜ç¼–è¯‘åçš„ JSPã€ä¸Šä¼ çš„æ–‡ä»¶ç­‰ã€‚å½“æ‚¨çš„åº”ç”¨ç¨‹åºè¿è¡Œæ—¶å‘ç”Ÿäº†æ•…éšœï¼Œè¯¥ç›®å½•å¯èƒ½ä¼šè¢« <code>tmpwatch</code> åˆ é™¤ã€‚ä¸ºäº†é¿å…å‡ºç°è¯¥æƒ…å†µï¼Œæ‚¨å¯èƒ½éœ€è¦è‡ªå®šä¹‰ <code>tmpwatch</code> é…ç½®ï¼Œä½¿ <code>tomcat.* </code>ç›®å½•ä¸è¢«åˆ é™¤ï¼Œæˆ–è€…é…ç½® <code>server.tomcat.basedir</code> è®© Tomcat ä½¿ç”¨å…¶ä»–ä½ç½®ã€‚</p></blockquote><p><a id="boot-features-embedded-container-servlets-filters-listeners"></a></p><h4 id="28-4-1ã€Servletã€Filter-ä¸-Listener">28.4.1ã€Servletã€Filter ä¸ Listener</h4><p>ä½¿ç”¨å†…åµŒ servlet å®¹å™¨æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Spring bean æˆ–è€…æ‰«ææ–¹å¼æ¥æ³¨å†Œ Servlet è§„èŒƒä¸­çš„ Servletã€Filter å’Œæ‰€æœ‰ç›‘å¬å™¨ï¼ˆæ¯”å¦‚ <code>HttpSessionListener</code>ï¼‰ã€‚</p><p><a id="boot-features-embedded-container-servlets-filters-listeners-beans"></a></p><h5 id="28-4-1-1ã€å°†-Servletã€Filter-å’Œ-Listener-æ³¨å†Œä¸º-Spring-Bean">28.4.1.1ã€å°† Servletã€Filter å’Œ Listener æ³¨å†Œä¸º Spring Bean</h5><p>ä»»ä½• <code>Servlet</code>ã€<code>Filter</code> æˆ– <code>*Listener</code> çš„ Spring bean å®ä¾‹éƒ½å°†è¢«æ³¨å†Œåˆ°å†…åµŒå®¹å™¨ä¸­ã€‚å¦‚æœæ‚¨æƒ³å¼•ç”¨ <code>application.properties</code> ä¸­çš„æŸä¸ªå€¼ï¼Œè¿™å¯èƒ½ä¼šç‰¹åˆ«æ–¹ä¾¿ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸Šä¸‹æ–‡åªåŒ…å«å•ä¸ª Servletï¼Œå®ƒå°†æ˜ å°„åˆ° <code>/</code>ã€‚åœ¨å¤šä¸ª Servlet bean çš„æƒ…å†µä¸‹ï¼Œbean çš„åç§°å°†ç”¨ä½œè·¯å¾„çš„å‰ç¼€ã€‚Filter å°†æ˜ å°„åˆ° <code>/*</code>ã€‚</p><p>å¦‚æœåŸºäºçº¦å®šé…ç½®çš„æ˜ å°„ä¸å¤Ÿçµæ´»ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>ServletRegistrationBean</code>ã€<code>FilterRegistrationBean</code> å’Œ <code>ServletListenerRegistrationBean</code> ç±»æ¥å®Œå…¨æ§åˆ¶ã€‚</p><p>Spring Boot é™„å¸¦äº†è®¸å¤šå¯ä»¥å®šä¹‰ Filter bean çš„è‡ªåŠ¨é…ç½®ã€‚ä»¥ä¸‹æ˜¯éƒ¨åˆ†è¿‡æ»¤å™¨åŠå…¶æ‰§è¡Œé¡ºåºçš„ï¼ˆé¡ºåºå€¼è¶Šä½ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼‰ï¼š</p><table><thead><tr><th>Servlet Filter</th><th>é¡ºåº</th></tr></thead><tbody><tr><td><code>OrderedCharacterEncodingFilter</code></td><td><code>Ordered.HIGHEST_PRECEDENCE</code></td></tr><tr><td><code>WebMvcMetricsFilter</code></td><td><code>Ordered.HIGHEST_PRECEDENCE + 1</code></td></tr><tr><td><code>ErrorPageFilter</code></td><td><code>Ordered.HIGHEST_PRECEDENCE + 1</code></td></tr><tr><td><code>HttpTraceFilter</code></td><td><code>Ordered.LOWEST_PRECEDENCE - 10</code></td></tr></tbody></table><p>é€šå¸¸ Filter bean æ— åºæ”¾ç½®ä¹Ÿæ˜¯å®‰å…¨çš„ã€‚</p><p>å¦‚æœéœ€è¦æŒ‡å®šé¡ºåºï¼Œåˆ™åº”é¿å…åœ¨ <code>Ordered.HIGHEST_PRECEDENCE</code> é¡ºåºç‚¹é…ç½®è¯»å–è¯·æ±‚ä½“çš„è¿‡æ»¤å™¨ï¼Œå› ä¸ºå®ƒçš„å­—ç¬¦ç¼–ç å¯èƒ½ä¸åº”ç”¨ç¨‹åºçš„å­—ç¬¦ç¼–ç é…ç½®ä¸ä¸€è‡´ã€‚å¦‚æœä¸€ä¸ª Servlet è¿‡æ»¤å™¨åŒ…è£…äº†è¯·æ±‚ï¼Œåˆ™åº”ä½¿ç”¨å°äºæˆ–ç­‰äº <code>OrderedFilter.REQUEST_WRAPPER_FILTER_MAX_ORDER </code>çš„é¡ºåºç‚¹å¯¹å…¶è¿›è¡Œé…ç½®ã€‚</p><p><a id="boot-features-embedded-container-context-initializer"></a></p><h4 id="28-4-2ã€Servlet-ä¸Šä¸‹æ–‡åˆå§‹åŒ–">28.4.2ã€Servlet ä¸Šä¸‹æ–‡åˆå§‹åŒ–</h4><p>å†…åµŒ servlet å®¹å™¨ä¸ä¼šç›´æ¥æ‰§è¡Œ Servlet 3.0+ çš„ <code>javax.servlet.ServletContainerInitializer</code> æ¥å£æˆ– Spring çš„ <code>org.springframework.web.WebApplicationInitializer</code> æ¥å£ã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰æ„çš„è®¾è®¡å†³ç­–ï¼Œæ—¨åœ¨é™ä½åœ¨ war å†…è¿è¡Œæ—¶ç¬¬ä¸‰æ–¹ç±»åº“äº§ç”Ÿçš„é£é™©ï¼Œé˜²æ­¢ç ´å Sring Boot åº”ç”¨ç¨‹åºã€‚</p><p>å¦‚æœæ‚¨éœ€è¦åœ¨ Spring Boot åº”ç”¨ç¨‹åºä¸­æ‰§è¡Œ servlet ä¸Šä¸‹æ–‡åˆå§‹åŒ–ï¼Œåˆ™åº”æ³¨å†Œä¸€ä¸ªå®ç°äº† <code>org.springframework.boot.context.embedded.ServletContextInitializer</code> æ¥å£çš„ beanã€‚<code>onStartup</code> æ–¹æ³•æä¾›äº†é’ˆå¯¹ <code>ServletContext</code> çš„è®¿é—®å…¥å£ï¼Œå¦‚æœéœ€è¦ï¼Œå®ƒå¯ä»¥å®¹æ˜“ä½œä¸ºç°æœ‰ <code>WebApplicationInitializer</code> çš„é€‚é…å™¨ã€‚</p><p><a id="boot-features-embedded-container-servlets-filters-listeners-scanning"></a></p><h5 id="28-4-2-1ã€æ‰«æ-Servletã€Filter-å’Œ-Listener">28.4.2.1ã€æ‰«æ Servletã€Filter å’Œ Listener</h5><p>ä½¿ç”¨å†…åµŒå®¹å™¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>@ServletComponentScan</code> å¯ç”¨å¸¦ <code>@WebServlet</code>ã€<code>@WebFilter</code> å’Œ <code>@WebListener</code> æ³¨è§£çš„ç±»è‡ªåŠ¨æ³¨å†Œã€‚</p><p><strong>æç¤º</strong></p><p><code>@ServletComponentScan</code> åœ¨ç‹¬ç«‹ï¼ˆstandaloneï¼‰å®¹å™¨ä¸­ä¸èµ·ä½œç”¨ï¼Œå› å®¹å™¨å°†ä½¿ç”¨å†…ç½®å‘ç°æœºåˆ¶æ¥ä»£æ›¿ã€‚</p><p><a id="boot-features-embedded-container-application-context"></a></p><h4 id="28-4-3ã€ServletWebServerApplicationContext">28.4.3ã€ServletWebServerApplicationContext</h4><p>Spring Boot åº•å±‚ä½¿ç”¨äº†ä¸€ä¸ªä¸åŒçš„ <code>ApplicationContext</code> ç±»å‹æ¥æ”¯æŒå†…åµŒ servletã€‚<code>ServletWebServerApplicationContext</code> æ˜¯ä¸€ä¸ªç‰¹æ®Š <code>WebApplicationContext</code> ç±»å‹ï¼Œå®ƒé€šè¿‡æœç´¢å•ä¸ª <code>ServletWebServerFactory</code> bean æ¥å¼•å¯¼è‡ªèº«ã€‚é€šå¸¸ï¼Œ<code>TomcatServletWebServerFactory</code>ã€ <code>JettyServletWebServerFactory</code> æˆ–è€… <code>UndertowServletWebServerFactory</code> ä¸­çš„ä¸€ä¸ªå°†è¢«è‡ªåŠ¨é…ç½®ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>é€šå¸¸ï¼Œä½ ä¸éœ€è¦çŸ¥é“è¿™äº›å®ç°ç±»ã€‚å¤§éƒ¨åˆ†åº”ç”¨ç¨‹åºä¼šè‡ªåŠ¨é…ç½®ï¼Œå¹¶ä¸ºæ‚¨åˆ›å»ºåˆé€‚çš„ <code>ApplicationContext</code> å’Œ <code>ServletWebServerFactory</code>ã€‚</p></blockquote><p><a id="boot-features-customizing-embedded-containers"></a></p><h5 id="28-4-4ã€è‡ªå®šä¹‰å†…åµŒ-Servlet-å®¹å™¨">28.4.4ã€è‡ªå®šä¹‰å†…åµŒ Servlet å®¹å™¨</h5><p>å¯ä»¥ä½¿ç”¨ Spring <code>Environment</code> å±æ€§æ¥é…ç½®é€šç”¨çš„ servlet å®¹å™¨è®¾ç½®ã€‚é€šå¸¸ï¼Œæ‚¨å¯ä»¥åœ¨ <code>application.properties</code> æ–‡ä»¶ä¸­å®šä¹‰è¿™äº›å±æ€§ã€‚</p><p>é€šç”¨çš„æœåŠ¡å™¨è®¾ç½®åŒ…æ‹¬ï¼š</p><ul><li>ç½‘ç»œè®¾ç½®ï¼šç›‘å¬ HTTP è¯·æ±‚çš„ç«¯å£ï¼ˆ<code>server.port</code>ï¼‰ï¼Œç»‘å®šæ¥å£åœ°å€åˆ° <code>server.address</code> ç­‰ã€‚</li><li>ä¼šè¯è®¾ç½®ï¼šæ˜¯å¦æŒä¹…ä¼šè¯ï¼ˆ<code>server.session.persistence</code>ï¼‰ã€session è¶…æ—¶ï¼ˆ<code>server.session.timeout</code>ï¼‰ã€ä¼šè¯æ•°æ®å­˜æ”¾ä½ç½®ï¼ˆ<code>server.session.store-dir</code>ï¼‰å’Œ session-cookie é…ç½®ï¼ˆ<code>server.session.cookie.*</code>ï¼‰ã€‚</li><li>é”™è¯¯ç®¡ç†ï¼šé”™è¯¯é¡µé¢ä½ç½®ï¼ˆ<code>server.error.path</code>ï¼‰ç­‰ã€‚</li><li><a href="#howto-configure-ssl">SSL</a></li><li><a href="#how-to-enable-http-response-compression">HTTP å‹ç¼©</a></li></ul><p>Spring Boot å°½å¯èƒ½æš´éœ²é€šç”¨çš„è®¾ç½®ï¼Œä½†å¹¶ä¸æ€»æ˜¯éƒ½å¯ä»¥ã€‚é’ˆå¯¹è¿™äº›æƒ…å†µï¼Œä¸“ç”¨çš„å‘½åç©ºé—´ä¸ºç‰¹å®šçš„æœåŠ¡å™¨æä¾›äº†è‡ªå®šä¹‰åŠŸèƒ½ï¼ˆè¯·å‚é˜… <code>server.tomcat</code> å’Œ <code>server.undertow</code>ï¼‰ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å†…åµŒ servlet å®¹å™¨çš„ç‰¹å®šåŠŸèƒ½æ¥é…ç½®<a href="#howto-configure-accesslogs">è®¿é—®æ—¥å¿—</a>ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>æœ‰å…³å®Œæ•´çš„å†…å®¹åˆ—è¡¨ï¼Œè¯·å‚é˜… <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ServerProperties.java">ServerProperties</a> ç±»ã€‚</p></blockquote><p><a id="boot-features-programmatic-embedded-container-customization"></a></p><h6 id="28-4-4-1ã€ä»¥ç¼–ç¨‹æ–¹å¼è‡ªå®šä¹‰">28.4.4.1ã€ä»¥ç¼–ç¨‹æ–¹å¼è‡ªå®šä¹‰</h6><p>å¦‚æœæ‚¨éœ€è¦ä»¥ç¼–ç¨‹çš„æ–¹å¼é…ç½®å†…åµŒ servlet å®¹å™¨ï¼Œå¯ä»¥æ³¨å†Œä¸€ä¸ªæ˜¯å®ç°äº† <code>WebServerFactoryCustomizer</code> æ¥å£çš„ Spring beanã€‚<code>WebServerFactoryCustomizer</code> æä¾›äº†å¯¹ <code>ConfigurableServletWebServerFactory</code> çš„è®¿é—®å…¥å£ï¼Œå…¶ä¸­åŒ…å«äº†è®¸å¤šè‡ªå®šä¹‰ setter æ–¹æ³•ã€‚ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨äº†ç¼–ç¨‹æ–¹å¼æ¥è®¾ç½®ç«¯å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.web.server.WebServerFactoryCustomizer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.server.ConfigurableServletWebServerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomizationBean</span> <span class="keyword">implements</span> <span class="title class_">WebServerFactoryCustomizer</span>&lt;ConfigurableServletWebServerFactory&gt; &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(ConfigurableServletWebServerFactory server)</span> &#123;</span><br><span class="line">server.setPort(<span class="number">9000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p><code>TomcatServletWebServerFactory</code>ã€<code>JettyServletWebServerFactory</code> å’Œ <code>UndertowServletWebServerFactory</code> æ˜¯ ConfigurableServletWebServerFactory çš„å…·ä½“å­ç±»ï¼Œå®ƒä»¬åˆ†åˆ«ä¸º Tomcatã€Jetty å’Œ Undertow æä¾›äº†é¢å¤–çš„è‡ªå®šä¹‰ setter æ–¹æ³•ã€‚</p></blockquote><p><a id="boot-features-customizing-configurableservletwebserverfactory-directly"></a></p><h6 id="28-4-4-2ã€ç›´æ¥è‡ªå®šä¹‰-ConfigurableServletWebServerFactory">28.4.4.2ã€ç›´æ¥è‡ªå®šä¹‰ ConfigurableServletWebServerFactory</h6><p>å¦‚æœä¸Šè¿°çš„è‡ªå®šä¹‰æ–¹å¼å¤ªå±€é™ï¼Œæ‚¨å¯ä»¥è‡ªå·±æ³¨å†Œ <code>TomcatServletWebServerFactory</code>ã€<code>JettyServletWebServerFactory</code> æˆ– <code>UndertowServletWebServerFactory</code> beanã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ConfigurableServletWebServerFactory <span class="title function_">webServerFactory</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">TomcatServletWebServerFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TomcatServletWebServerFactory</span>();</span><br><span class="line">factory.setPort(<span class="number">9000</span>);</span><br><span class="line">factory.setSessionTimeout(<span class="number">10</span>, TimeUnit.MINUTES);</span><br><span class="line">factory.addErrorPages(<span class="keyword">new</span> <span class="title class_">ErrorPage</span>(HttpStatus.NOT_FOUND, <span class="string">&quot;/notfound.html&quot;</span>));</span><br><span class="line"><span class="keyword">return</span> factory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Setter æ–¹æ³•æä¾›äº†è®¸å¤šé…ç½®é€‰é¡¹ã€‚è¿˜æœ‰å‡ ä¸ª <strong>hook</strong> ä¿æŠ¤æ–¹æ³•ä¾›æ‚¨æ·±å…¥å®šåˆ¶ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/web/servlet/server/ConfigurableServletWebServerFactory.html">æºç æ–‡æ¡£</a>ã€‚</p><p><a id="boot-features-jsp-limitations"></a></p><h4 id="28-4-5ã€JSP-å±€é™">28.4.5ã€JSP å±€é™</h4><p>å½“è¿è¡Œä½¿ç”¨äº†å†…åµŒ servlet å®¹å™¨çš„ Spring Boot åº”ç”¨ç¨‹åºæ—¶ï¼ˆæ‰“åŒ…ä¸ºå¯æ‰§è¡Œå½’æ¡£æ–‡ä»¶ï¼‰ï¼ŒJSP æ”¯æŒå°†å­˜åœ¨ä¸€äº›é™åˆ¶ã€‚</p><ul><li>å¦‚æœæ‚¨ä½¿ç”¨ war æ‰“åŒ…ï¼Œåœ¨ Jetty å’Œ Tomcat ä¸­å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä½¿ç”¨ <code>java -jar</code> å¯åŠ¨æ—¶ï¼Œå¯æ‰§è¡Œçš„ war å¯æ­£å¸¸ä½¿ç”¨ï¼Œå¹¶ä¸”è¿˜å¯ä»¥éƒ¨ç½²åˆ°ä»»ä½•æ ‡å‡†å®¹å™¨ã€‚ä½¿ç”¨å¯æ‰§è¡Œ jar æ—¶ä¸æ”¯æŒ JSPã€‚</li><li>Undertow ä¸æ”¯æŒ JSPã€‚</li><li>åˆ›å»ºè‡ªå®šä¹‰çš„ error.jsp é¡µé¢ä¸ä¼šè¦†ç›–é»˜è®¤<a href="#boot-features-error-handling">é”™è¯¯å¤„ç†</a>è§†å›¾ï¼Œåº”è¯¥ä½¿ç”¨<a href="#boot-features-error-handling-custom-error-pages">è‡ªå®šä¹‰é”™è¯¯é¡µé¢</a>æ¥ä»£æ›¿ã€‚</li></ul><p>è¿™é‡Œæœ‰ä¸€ä¸ª <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/spring-boot-sample-web-jsp">JSP ç¤ºä¾‹</a>ï¼Œæ‚¨å¯ä»¥äº†è§£åˆ°å¦‚ä½•é…ç½®ã€‚</p><p><a id="boot-features-reactive-server"></a></p><h3 id="28-5ã€å†…åµŒå“åº”å¼æœåŠ¡å™¨æ”¯æŒ">28.5ã€å†…åµŒå“åº”å¼æœåŠ¡å™¨æ”¯æŒ</h3><p>Spring Boot åŒ…æ‹¬å¯¹ä»¥ä¸‹å†…åµŒå“åº”å¼ Web æœåŠ¡å™¨çš„æ”¯æŒï¼šReactor Nettyã€Tomcatã€Jetty å’Œ Undertowã€‚å¤§å¤šæ•°å¼€å‘äººå‘˜ä½¿ç”¨å¯¹åº”çš„ <strong>Starter</strong> æ¥è·å–ä¸€ä¸ªå®Œå…¨é…ç½®çš„å®ä¾‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå†…åµŒæœåŠ¡å™¨åœ¨ 8080 ç«¯å£ä¸Šç›‘å¬ HTTP è¯·æ±‚ã€‚</p><p><a id="boot-features-reactive-server-resources"></a></p><h3 id="28-6ã€å“åº”å¼æœåŠ¡å™¨èµ„æºé…ç½®">28.6ã€å“åº”å¼æœåŠ¡å™¨èµ„æºé…ç½®</h3><p>åœ¨è‡ªåŠ¨é…ç½® Reactor Netty æˆ– Jetty æœåŠ¡å™¨æ—¶ï¼ŒSpring Boot å°†åˆ›å»ºç‰¹å®šçš„ bean ä¸ºæœåŠ¡å™¨å®ä¾‹æä¾› HTTP èµ„æºï¼š<code>ReactorResourceFactory</code> æˆ– <code>JettyResourceFactory</code>ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›èµ„æºä¹Ÿå°†ä¸ Reactor Netty å’Œ Jetty å®¢æˆ·ç«¯å…±äº«ä»¥è·å¾—æœ€ä½³æ€§èƒ½ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><ul><li>ç”¨äºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„çš„ç›¸åŒæŠ€æœ¯</li><li>å®¢æˆ·ç«¯å®ä¾‹ä½¿ç”¨äº† Spring Boot è‡ªåŠ¨é…ç½®çš„ <code>WebClient.Builder</code> bean æ„å»ºã€‚</li></ul><p>å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡æä¾›è‡ªå®šä¹‰çš„ <code>ReactorResourceFactory</code> æˆ– <code>JettyResourceFactory</code> bean æ¥é‡å†™ Jetty å’Œ Reactor Netty çš„èµ„æºé…ç½® â€”â€” å°†åº”ç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ã€‚</p><p>æ‚¨å¯ä»¥åœ¨ <a href="#boot-features-webclient-runtime">WebClient Runtime</a> ç« èŠ‚ä¸­äº†è§£æœ‰å…³å®¢æˆ·ç«¯èµ„æºé…ç½®çš„æ›´å¤šå†…å®¹ã€‚</p><p><a id="boot-features-security"></a></p><h2 id="29ã€å®‰å…¨">29ã€å®‰å…¨</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœ <a href="https://projects.spring.io/spring-security/">Spring Security</a> åœ¨ classpath ä¸Šï¼Œåˆ™ Web åº”ç”¨ç¨‹åºæ˜¯å—ä¿æŠ¤çš„ã€‚Spring Boot ä¾èµ– Spring Security çš„å†…å®¹åå•†ç­–ç•¥æ¥ç¡®å®šæ˜¯ä½¿ç”¨ <code>httpBasic</code> è¿˜æ˜¯ <code>formLogin</code>ã€‚è¦ç»™ Web åº”ç”¨ç¨‹åºæ·»åŠ æ–¹æ³•çº§åˆ«çš„å®‰å…¨ä¿æŠ¤ï¼Œå¯ä»¥ä½¿ç”¨ <code>@EnableGlobalMethodSecurity</code> æ³¨è§£è®¾ç½®ã€‚æœ‰å…³æ›´å¤šå…¶ä»–ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥åœ¨ <a href="https://docs.spring.io/spring-security/site/docs/5.1.2.RELEASE/reference/htmlsingle#jc-method">Spring Security å‚è€ƒæŒ‡å—</a>ä¸­æ‰¾åˆ°ã€‚</p><p>é»˜è®¤çš„ <code>UserDetailsSâ€‹â€‹ervice</code> åªæœ‰ä¸€ä¸ªç”¨æˆ·ã€‚ç”¨æˆ·åä¸º <code>user</code>ï¼Œå¯†ç æ˜¯éšæœºçš„ï¼Œåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ä¼šä»¥ INFO çº§åˆ«æ‰“å°å‡ºæ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Using generated security password: 78fa095d-3f4c-<span class="number">48b1</span>-ad50-e24c31d5cf35</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœæ‚¨å¯¹æ—¥å¿—é…ç½®è¿›è¡Œå¾®è°ƒï¼Œè¯·ç¡®ä¿å°† <code>org.springframework.boot.autoconfigure.security</code> çš„çº§åˆ«è®¾ç½®ä¸º <code>INFO</code>ã€‚å¦åˆ™ï¼Œé»˜è®¤å¯†ç ä¸ä¼šæ‰“å°å‡ºæ¥ã€‚</p></blockquote><p>æ‚¨å¯ä»¥é€šè¿‡æä¾› <code>spring.security.user.name</code> å’Œ <code>spring.security.user.password</code> æ¥æ›´æ”¹ç”¨æˆ·åå’Œå¯†ç ã€‚</p><p>æ‚¨åœ¨ Web åº”ç”¨ç¨‹åºä¸­é»˜è®¤ä¼šè·å¾—ä»¥ä¸‹åŸºæœ¬åŠŸèƒ½ï¼š</p><ul><li>ä¸€ä¸ª <code>UserDetailsSâ€‹â€‹ervice</code>ï¼ˆæˆ– WebFlux åº”ç”¨ç¨‹åºä¸­çš„ <code>ReactiveUserDetailsSâ€‹â€‹ervice</code>ï¼‰beanï¼Œé‡‡ç”¨å†…å­˜å­˜å‚¨å½¢å¼ï¼Œæœ‰ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆå¯†ç çš„ç”¨æˆ·ï¼ˆæœ‰å…³ç”¨æˆ·å±æ€§ï¼Œè¯·å‚é˜… <a href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/autoconfigure/security/SecurityProperties.User.html"><code>SecurityProperties.User</code></a>ï¼‰ã€‚</li><li>ç”¨äºæ•´ä¸ªåº”ç”¨ç¨‹åºï¼ˆå¦‚æœ actuator åœ¨ classpath ä¸Šï¼Œåˆ™åŒ…æ‹¬ actuator ç«¯ç‚¹ï¼‰åŸºäºè¡¨å•ç™»å½•æˆ– HTTP Basic è®¤è¯ï¼ˆå–å†³äº Content-Typeï¼‰ã€‚</li><li>ä¸€ä¸ªç”¨äºå‘å¸ƒèº«ä»½éªŒè¯äº‹ä»¶çš„ <code>DefaultAuthenticationEventPublisher</code>ã€‚</li></ul><p>æ‚¨å¯ä»¥é€šè¿‡ä¸ºå…¶æ·»åŠ ä¸€ä¸ª bean æ¥æä¾›ä¸åŒçš„ <code>AuthenticationEventPublisher</code>ã€‚</p><p><a id="boot-features-security-mvc"></a></p><h3 id="29-1ã€MVC-å®‰å…¨">29.1ã€MVC å®‰å…¨</h3><p>é»˜è®¤çš„å®‰å…¨é…ç½®åœ¨ <code>SecurityAutoConfiguration</code> å’Œ <code>UserDetailsSâ€‹â€‹erviceAutoConfiguration</code> ä¸­å®ç°ã€‚ <code>SecurityAutoConfiguration</code> å¯¼å…¥ç”¨äº Web å®‰å…¨çš„ <code>SpringBootWebSecurityConfiguration</code>ï¼Œ<code>UserDetailsSâ€‹â€‹erviceAutoConfiguration</code> é…ç½®èº«ä»½éªŒè¯ï¼Œè¿™åŒæ ·é€‚ç”¨äºé Web åº”ç”¨ç¨‹åºã€‚è¦å®Œå…¨å…³é—­é»˜è®¤çš„ Web åº”ç”¨ç¨‹åºå®‰å…¨é…ç½®ï¼Œå¯ä»¥æ·»åŠ  <code>WebSecurityConfigurerAdapter</code> ç±»å‹çš„ beanï¼ˆè¿™æ ·åšä¸ä¼šç¦ç”¨ <code>UserDetailsSâ€‹â€‹ervice</code> é…ç½®æˆ– Actuator çš„å®‰å…¨ä¿æŠ¤ï¼‰ã€‚</p><p>è¦åŒæ—¶å…³é—­ <code>UserDetailsSâ€‹â€‹ervice</code> é…ç½®ï¼Œæ‚¨å¯ä»¥æ·»åŠ  <code>UserDetailsSâ€‹â€‹ervice</code>ã€<code>AuthenticationProvider</code> æˆ– <code>AuthenticationManager</code> ç±»å‹çš„ beanã€‚<a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-samples/">Spring Boot ç¤ºä¾‹</a>ä¸­æœ‰å‡ ä¸ªä½¿ç”¨äº†å®‰å…¨ä¿æŠ¤çš„åº”ç”¨ç¨‹åºï¼Œä»–ä»¬æˆ–è®¸å¯ä»¥å¸®åŠ©åˆ°æ‚¨ã€‚</p><p>å¯ä»¥é€šè¿‡æ·»åŠ è‡ªå®šä¹‰ <code>WebSecurityConfigurerAdapter</code> æ¥é‡å†™è®¿é—®è§„åˆ™ã€‚Spring Boot æä¾›äº†ä¾¿æ·æ–¹æ³•ï¼Œå¯ç”¨äºé‡å†™ actuator ç«¯ç‚¹å’Œé™æ€èµ„æºçš„è®¿é—®è§„åˆ™ã€‚<code>EndpointRequest</code> å¯ç”¨äºåˆ›å»ºä¸€ä¸ªåŸºäº <code>management.endpoints.web.base-path</code> å±æ€§çš„ <code>RequestMatcher</code>ã€‚<code>PathRequest</code> å¯ç”¨äºä¸ºå¸¸ç”¨ä½ç½®ä¸­çš„èµ„æºåˆ›å»ºä¸€ä¸ª <code>RequestMatcher</code>ã€‚</p><p><a id="boot-features-security-webflux"></a></p><h3 id="29-2ã€WebFlux-å®‰å…¨">29.2ã€WebFlux å®‰å…¨</h3><p>ä¸ Spring MVC åº”ç”¨ç¨‹åºç±»ä¼¼ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ·»åŠ  <code>spring-boot-starter-security</code> ä¾èµ–æ¥ä¿æŠ¤ WebFlux åº”ç”¨ç¨‹åºã€‚é»˜è®¤çš„å®‰å…¨é…ç½®åœ¨ <code>ReactiveSecurityAutoConfiguration</code> å’Œ <code>UserDetailsServiceAutoConfiguration</code> ä¸­å®ç°ã€‚<code>ReactiveSecurityAutoConfiguration</code> å¯¼å…¥ç”¨äº Web å®‰å…¨çš„ <code>WebFluxSecurityConfiguration</code>ï¼Œ<code>UserDetailsServiceAutoConfiguration</code> é…ç½®èº«ä»½éªŒè¯ï¼Œè¿™åŒæ ·é€‚ç”¨äºé Web åº”ç”¨ç¨‹åºã€‚è¦å®Œå…¨å…³é—­é»˜è®¤çš„ Web åº”ç”¨ç¨‹åºå®‰å…¨é…ç½®ï¼Œå¯ä»¥æ·»åŠ  <code>WebFilterChainProxy</code> ç±»å‹çš„ beanï¼ˆè¿™æ ·åšä¸ä¼šç¦ç”¨ <code>UserDetailsSâ€‹â€‹ervice</code> é…ç½®æˆ– Actuator çš„å®‰å…¨ä¿æŠ¤ï¼‰ã€‚</p><p>è¦åŒæ—¶å…³é—­ <code>UserDetailsSâ€‹â€‹ervice</code> é…ç½®ï¼Œæ‚¨å¯ä»¥æ·»åŠ  <code>ReactiveUserDetailsService</code> æˆ– <code>ReactiveAuthenticationManager</code> ç±»å‹çš„ beanã€‚</p><p>å¯ä»¥é€šè¿‡æ·»åŠ è‡ªå®šä¹‰ <code>SecurityWebFilterChain</code> æ¥é‡å†™è®¿é—®è§„åˆ™ã€‚Spring Boot æä¾›äº†ä¾¿æ·æ–¹æ³•ï¼Œå¯ç”¨äºé‡å†™ actuator ç«¯ç‚¹å’Œé™æ€èµ„æºçš„è®¿é—®è§„åˆ™ã€‚<code>EndpointRequest</code> å¯ç”¨äºåˆ›å»ºä¸€ä¸ªåŸºäº <code>management.endpoints.web.base-path</code> å±æ€§çš„ <code>ServerWebExchangeMatcher</code>ã€‚</p><p><code>PathRequest</code> å¯ç”¨äºä¸ºå¸¸ç”¨ä½ç½®ä¸­çš„èµ„æºåˆ›å»ºä¸€ä¸ª <code>ServerWebExchangeMatcher</code>ã€‚</p><p>ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ·»åŠ ä»¥ä¸‹å†…å®¹æ¥è‡ªå®šä¹‰å®‰å…¨é…ç½®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SecurityWebFilterChain <span class="title function_">springSecurityFilterChain</span><span class="params">(ServerHttpSecurity http)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> http</span><br><span class="line">.authorizeExchange()</span><br><span class="line">.matchers(PathRequest.toStaticResources().atCommonLocations()).permitAll()</span><br><span class="line">.pathMatchers(<span class="string">&quot;/foo&quot;</span>, <span class="string">&quot;/bar&quot;</span>)</span><br><span class="line">.authenticated().and()</span><br><span class="line">.formLogin().and()</span><br><span class="line">.build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="boot-features-security-oauth2"></a></p><h3 id="29-3ã€OAuth2">29.3ã€OAuth2</h3><p><a href="https://oauth.net/2/">OAuth2</a> æ˜¯ Spring æ”¯æŒçš„ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„æˆæƒæ¡†æ¶ã€‚</p><p><a id="boot-features-security-oauth2-client"></a></p><h4 id="29-3-1ã€å®¢æˆ·ç«¯">29.3.1ã€å®¢æˆ·ç«¯</h4><p>å¦‚æœæ‚¨çš„ classpath ä¸Šæœ‰ <code>spring-security-oauth2-client</code>ï¼Œåˆ™å¯ä»¥åˆ©ç”¨ä¸€äº›è‡ªåŠ¨é…ç½®æ¥è½»æ¾è®¾ç½® <code>OAuth2/Open ID Connect å®¢æˆ·ç«¯ã€‚è¯¥é…ç½®ä½¿ç”¨ </code>OAuth2ClientProperties` çš„å±æ€§ã€‚ç›¸åŒçš„å±æ€§é€‚ç”¨äº servlet å’Œå“åº”å¼åº”ç”¨ç¨‹åºã€‚</p><p>æ‚¨å¯ä»¥åœ¨ <code>spring.security.oauth2.client</code> å‰ç¼€ä¸‹æ³¨å†Œå¤šä¸ª OAuth2 å®¢æˆ·ç«¯å’Œæä¾›è€…ï¼ˆproviderï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.security.oauth2.client.registration.my-client-1.client-id</span>=abcd</span><br><span class="line"><span class="attr">spring.security.oauth2.client.registration.my-client-1.client-secret</span>=password</span><br><span class="line"><span class="attr">spring.security.oauth2.client.registration.my-client-1.client-name</span>=Client for user scope</span><br><span class="line"><span class="attr">spring.security.oauth2.client.registration.my-client-1.provider</span>=my-oauth-provider</span><br><span class="line"><span class="attr">spring.security.oauth2.client.registration.my-client-1.scope</span>=user</span><br><span class="line"><span class="attr">spring.security.oauth2.client.registration.my-client-1.redirect-uri-template</span>=http://my-redirect-uri.com</span><br><span class="line"><span class="attr">spring.security.oauth2.client.registration.my-client-1.client-authentication-method</span>=basic</span><br><span class="line"><span class="attr">spring.security.oauth2.client.registration.my-client-1.authorization-grant-type</span>=authorization_code</span><br><span class="line"></span><br><span class="line"><span class="attr">spring.security.oauth2.client.registration.my-client-2.client-id</span>=abcd</span><br><span class="line"><span class="attr">spring.security.oauth2.client.registration.my-client-2.client-secret</span>=password</span><br><span class="line"><span class="attr">spring.security.oauth2.client.registration.my-client-2.client-name</span>=Client for email scope</span><br><span class="line"><span class="attr">spring.security.oauth2.client.registration.my-client-2.provider</span>=my-oauth-provider</span><br><span class="line"><span class="attr">spring.security.oauth2.client.registration.my-client-2.scope</span>=email</span><br><span class="line"><span class="attr">spring.security.oauth2.client.registration.my-client-2.redirect-uri-template</span>=http://my-redirect-uri.com</span><br><span class="line"><span class="attr">spring.security.oauth2.client.registration.my-client-2.client-authentication-method</span>=basic</span><br><span class="line"><span class="attr">spring.security.oauth2.client.registration.my-client-2.authorization-grant-type</span>=authorization_code</span><br><span class="line"></span><br><span class="line"><span class="attr">spring.security.oauth2.client.provider.my-oauth-provider.authorization-uri</span>=http://my-auth-server/oauth/authorize</span><br><span class="line"><span class="attr">spring.security.oauth2.client.provider.my-oauth-provider.token-uri</span>=http://my-auth-server/oauth/token</span><br><span class="line"><span class="attr">spring.security.oauth2.client.provider.my-oauth-provider.user-info-uri</span>=http://my-auth-server/userinfo</span><br><span class="line"><span class="attr">spring.security.oauth2.client.provider.my-oauth-provider.user-info-authentication-method</span>=header</span><br><span class="line"><span class="attr">spring.security.oauth2.client.provider.my-oauth-provider.jwk-set-uri</span>=http://my-auth-server/token_keys</span><br><span class="line"><span class="attr">spring.security.oauth2.client.provider.my-oauth-provider.user-name-attribute</span>=name</span><br></pre></td></tr></table></figure><p>å¯¹äºæ”¯æŒ <a href="https://openid.net/specs/openid-connect-discovery-1_0.html">OpenID Connect å‘ç°</a>çš„ OpenID Connect æä¾›è€…ï¼Œå¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–é…ç½®ã€‚éœ€è¦ä½¿ç”¨ <code>issuer-uri</code> é…ç½®æä¾›è€…ï¼Œ<code>issuer-uri</code> æ˜¯å…¶ Issuer Identifier çš„ URIã€‚ä¾‹å¦‚ï¼Œå¦‚æœæä¾›çš„ <code>issuer-uri</code> æ˜¯ â€œ<a href="https://example.com">https://example.com</a>â€ï¼Œåˆ™å°†å¯¹ â€œ<a href="https://example.com/.well-known/openid-configuration%E2%80%9D">https://example.com/.well-known/openid-configurationâ€</a> å‘èµ·ä¸€ä¸ª <code>OpenID Provider Configuration Request</code>ã€‚æœŸæœ›ç»“æœæ˜¯ä¸€ä¸ª <code>OpenID Provider Configuration Response</code>ã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>issuer-uri</code> é…ç½®ä¸€ä¸ª OpenID Connect Providerï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.security</span><span class="selector-class">.oauth2</span><span class="selector-class">.client</span><span class="selector-class">.provider</span><span class="selector-class">.oidc-provider</span>.issuer-uri=https:<span class="comment">//dev-123456.oktapreview.com/oauth2/default/</span></span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Security çš„ <code>OAuth2LoginAuthenticationFilter</code> ä»…å¤„ç†ä¸ <code>/login/oauth2/code/*</code> ç›¸åŒ¹é…çš„ URLã€‚å¦‚æœè¦è‡ªå®šä¹‰ <code>redirect-uri</code> ä»¥ä½¿ç”¨å…¶ä»–åŒ¹é…æ¨¡å¼ï¼Œåˆ™éœ€è¦æä¾›é…ç½®ä»¥å¤„ç†è¯¥è‡ªå®šä¹‰æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œå¯¹äº servlet åº”ç”¨ç¨‹åºï¼Œæ‚¨å¯ä»¥æ·»åŠ ç±»ä¼¼äºä»¥ä¸‹ <code>WebSecurityConfigurerAdapter</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OAuth2LoginSecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">http</span><br><span class="line">.authorizeRequests()</span><br><span class="line">.anyRequest().authenticated()</span><br><span class="line">.and()</span><br><span class="line">.oauth2Login()</span><br><span class="line">.redirectionEndpoint()</span><br><span class="line">.baseUri(<span class="string">&quot;/custom-callback&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="boot-features-security-oauth2-common-providers"></a></p><p><strong>OAuth2 å®¢æˆ·ç«¯æ³¨å†Œå¸¸è§çš„æä¾›è€…</strong></p><p>å¯¹äºå¸¸è§çš„ OAuth2 å’Œ OpenID æä¾›è€…ï¼ˆproviderï¼‰ï¼ŒåŒ…æ‹¬ Googleã€Githubã€Facebook å’Œ Oktaï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ç»„æä¾›è€…é»˜è®¤è®¾ç½®ï¼ˆåˆ†åˆ«æ˜¯ <code>google</code>ã€<code>github</code>ã€<code>facebook</code> å’Œ <code>okta</code>ï¼‰ã€‚</p><p>å¦‚æœæ‚¨ä¸éœ€è¦è‡ªå®šä¹‰è¿™äº›æä¾›è€…ï¼Œåˆ™å¯ä»¥å°† <code>provider</code> å±æ€§è®¾ç½®ä¸ºæ‚¨éœ€è¦æ¨æ–­é»˜è®¤å€¼çš„å±æ€§ã€‚æ­¤å¤–ï¼Œå¦‚æœå®¢æˆ·ç«¯æ³¨å†Œçš„ key ä¸é»˜è®¤æ”¯æŒçš„æä¾›è€…åŒ¹é…ï¼Œåˆ™ Spring Boot ä¹Ÿä¼šæ¨æ–­å‡ºæ¥ã€‚</p><p>æ¢è€Œè¨€ä¹‹ï¼Œä»¥ä¸‹ç¤ºä¾‹ä¸­çš„ä¸¤ä¸ªé…ç½®ä½¿ç”¨äº† Google æä¾›è€…ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.security.oauth2.client.registration.my-client.client-id</span>=abcd</span><br><span class="line"><span class="attr">spring.security.oauth2.client.registration.my-client.client-secret</span>=password</span><br><span class="line"><span class="attr">spring.security.oauth2.client.registration.my-client.provider</span>=google</span><br><span class="line"></span><br><span class="line"><span class="attr">spring.security.oauth2.client.registration.google.client-id</span>=abcd</span><br><span class="line"><span class="attr">spring.security.oauth2.client.registration.google.client-secret</span>=password</span><br></pre></td></tr></table></figure><p><a id="boot-features-security-oauth2-server"></a></p><h4 id="29-3-2ã€èµ„æºæœåŠ¡å™¨">29.3.2ã€èµ„æºæœåŠ¡å™¨</h4><p>å¦‚æœåœ¨ classpath ä¸Šæœ‰ <code>spring-security-oauth2-resource-server</code>ï¼Œåªè¦æŒ‡å®šäº† JWK Set URI æˆ– OIDC Issuer URIï¼ŒSpring Boot å°±å¯ä»¥è®¾ç½® OAuth2 èµ„æºæœåŠ¡å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.security.oauth2.resourceserver.jwt.jwk-set-uri</span>=https://example.com/oauth2/default/v1/keys</span><br></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.security.oauth2.resourceserver.jwt.issuer-uri</span>=https://dev-<span class="number">123456</span>.oktapreview.com/oauth2/default/</span><br></pre></td></tr></table></figure><p>ç›¸åŒçš„å±æ€§é€‚ç”¨äº servlet å’Œå“åº”å¼åº”ç”¨ç¨‹åºã€‚</p><p>æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä¸º servlet åº”ç”¨ç¨‹åºå®šä¹‰è‡ªå·±çš„ <code>JwtDecoder</code> beanï¼Œæˆ–ä¸ºå“åº”å¼åº”ç”¨ç¨‹åºå®šä¹‰ <code>ReactiveJwtDecoder</code>ã€‚</p><p><a id="_authorization_server"></a></p><h4 id="29-3-3ã€æˆæƒæœåŠ¡å™¨">29.3.3ã€æˆæƒæœåŠ¡å™¨</h4><p>ç›®å‰ï¼ŒSpring Security æ²¡æœ‰æä¾› OAuth 2.0 æˆæƒæœåŠ¡å™¨å®ç°ã€‚ä½†æ­¤åŠŸèƒ½å¯ä» <a href="https://projects.spring.io/spring-security-oauth/">Spring Security OAuth</a> é¡¹ç›®è·å¾—ï¼Œè¯¥é¡¹ç›®æœ€ç»ˆä¼šè¢« Spring Security æ‰€å–ä»£ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>spring-security-oauth2-autoconfigure</code> æ¨¡å—è½»æ¾è®¾ç½® OAuth 2.0 æˆæƒæœåŠ¡å™¨ï¼Œè¯·å‚é˜…å…¶<a href="https://docs.spring.io/spring-security-oauth2-boot">æ–‡æ¡£</a>ä»¥è·å–è¯¦ç»†ä¿¡æ¯ã€‚</p><p><a id="boot-features-security-actuator"></a></p><h3 id="29-4ã€Actuator-å®‰å…¨">29.4ã€Actuator å®‰å…¨</h3><p>å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œé»˜è®¤æƒ…å†µä¸‹ç¦ç”¨é™¤ <code>/health</code> å’Œ <code>/info</code> ä¹‹å¤–çš„æ‰€æœ‰ actuatorã€‚å¯ç”¨ <code>management.endpoints.web.exposure.include</code> å±æ€§å¯ç”¨ actuatorã€‚</p><p>å¦‚æœ Spring Security ä½äº classpath ä¸Šä¸”æ²¡æœ‰å…¶ä»– <code>WebSecurityConfigurerAdapter</code>ï¼Œåˆ™é™¤äº† <code>/health</code> å’Œ <code>/info</code> ä¹‹å¤–çš„æ‰€æœ‰ actuator éƒ½ç”± Spring Boot è‡ªåŠ¨é…ç½®ä¿æŠ¤ã€‚å¦‚æœæ‚¨å®šä¹‰äº†è‡ªå®šä¹‰ <code>WebSecurityConfigurerAdapter</code>ï¼Œåˆ™ Spring Boot è‡ªåŠ¨é…ç½®å°†ä¸å†ç”Ÿæ•ˆï¼Œæ‚¨å¯ä»¥å®Œå…¨æ§åˆ¶ actuator çš„è®¿é—®è§„åˆ™ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>åœ¨è®¾ç½® <code>management.endpoints.web.exposure.include</code> ä¹‹å‰ï¼Œè¯·ç¡®ä¿æš´éœ²çš„ actuator æ²¡æœ‰åŒ…å«æ•æ„Ÿä¿¡æ¯å’Œ <code>/</code> æˆ–è¢«é˜²ç«å¢™ä¿æŠ¤äº¦æˆ–å— Spring Security ä¹‹ç±»çš„ä¿æŠ¤ã€‚</p></blockquote><p><a id="boot-features-security-csrf"></a></p><h4 id="29-4-1ã€è·¨ç«™è¯·æ±‚ä¼ªé€ ä¿æŠ¤">29.4.1ã€è·¨ç«™è¯·æ±‚ä¼ªé€ ä¿æŠ¤</h4><p>ç”±äº Spring Boot ä¾èµ– Spring Security çš„é»˜è®¤å€¼é…ç½®ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹ä¼šå¯ç”¨ CSRF ä¿æŠ¤ã€‚è¿™æ„å‘³ç€å½“ä½¿ç”¨é»˜è®¤å®‰å…¨é…ç½®æ—¶ï¼Œéœ€è¦ <code>POST</code>ï¼ˆshutdown å’Œ loggers ç«¯ç‚¹ï¼‰ã€<code>PUT</code> æˆ– <code>DELETE</code> çš„ actuator ç«¯ç‚¹å°†è¿”å› 403 ç¦æ­¢è®¿é—®é”™è¯¯ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>æˆ‘ä»¬å»ºè®®ä»…åœ¨åˆ›å»ºéæµè§ˆå™¨å®¢æˆ·ç«¯ä½¿ç”¨çš„æœåŠ¡æ—¶æ‰å®Œå…¨ç¦ç”¨ CSRF ä¿æŠ¤ã€‚</p></blockquote><p>æœ‰å…³ CSRF ä¿æŠ¤çš„å…¶ä»–ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://docs.spring.io/spring-security/site/docs/5.1.2.RELEASE/reference/htmlsingle#csrf">Spring Security å‚è€ƒæŒ‡å—</a>ã€‚</p><p><a id="boot-features-sql"></a></p><h2 id="30ã€ä½¿ç”¨-SQL-æ•°æ®åº“">30ã€ä½¿ç”¨ SQL æ•°æ®åº“</h2><p><a href="https://projects.spring.io/spring-framework/">Spring Framework</a> ä¸º SQL æ•°æ®åº“æä¾›äº†å¹¿æ³›çš„æ”¯æŒã€‚ä»ç›´æ¥ä½¿ç”¨ <code>JdbcTemplate</code> è¿›è¡Œ JDBC è®¿é—®åˆ°å®Œå…¨çš„<strong>å¯¹è±¡å…³ç³»æ˜ å°„</strong>ï¼ˆobject relational mappingï¼‰æŠ€æœ¯ï¼Œæ¯”å¦‚ Hibernateã€‚<a href="https://projects.spring.io/spring-data/">Spring Data</a> æä¾›äº†æ›´å¤šçº§åˆ«çš„åŠŸèƒ½ï¼Œç›´æ¥ä»æ¥å£åˆ›å»ºçš„ <code>Repository</code> å®ç°ï¼Œå¹¶ä½¿ç”¨äº†çº¦å®šä»æ–¹æ³•åç”ŸæˆæŸ¥è¯¢ã€‚</p><p><a id="boot-features-configure-datasource"></a></p><h3 id="30-1ã€é…ç½®æ•°æ®æº">30.1ã€é…ç½®æ•°æ®æº</h3><p>Java çš„ <code>javax.sql.DataSource</code> æ¥å£æä¾›äº†ä¸€ä¸ªä½¿ç”¨æ•°æ®åº“è¿æ¥çš„æ ‡å‡†æ–¹æ³•ã€‚é€šå¸¸ï¼Œæ•°æ®æºä½¿ç”¨ <code>URL</code> å’Œä¸€äº›å‡­æ®ä¿¡æ¯æ¥å»ºç«‹æ•°æ®åº“è¿æ¥ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>æŸ¥çœ‹ <a href="#howto-configure-a-datasource">How-to</a> éƒ¨åˆ†è·å–æ›´å¤šé«˜çº§ç¤ºä¾‹ï¼Œé€šå¸¸æ‚¨å¯ä»¥å®Œå…¨æ§åˆ¶æ•°æ®åº“çš„é…ç½®ã€‚</p></blockquote><p><a id="boot-features-embedded-database-support"></a></p><h4 id="30-1-1ã€å†…åµŒæ•°æ®åº“æ”¯æŒ">30.1.1ã€å†…åµŒæ•°æ®åº“æ”¯æŒ</h4><p>ä½¿ç”¨å†…åµŒå†…å­˜æ•°æ®åº“æ¥å¼€å‘åº”ç”¨ç¨‹åºéå¸¸æ–¹ä¾¿çš„ã€‚æ˜¾ç„¶ï¼Œå†…å­˜æ•°æ®åº“ä¸æä¾›æŒä¹…å­˜å‚¨ã€‚åœ¨åº”ç”¨å¯åŠ¨æ—¶ï¼Œæ‚¨éœ€è¦å¡«å……æ•°æ®åº“ï¼Œå¹¶åœ¨åº”ç”¨ç¨‹åºç»“æŸæ—¶ä¸¢å¼ƒæ•°æ®ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p><strong>How-to</strong> éƒ¨åˆ†åŒ…å«äº†<a href="#howto-database-initialization">å¦‚ä½•åˆå§‹åŒ–æ•°æ®åº“</a>æ–¹é¢çš„å†…å®¹ã€‚</p></blockquote><p>Spring Boot å¯ä»¥è‡ªåŠ¨é…ç½®å†…åµŒ <a href="http://www.h2database.com/">H2</a>ã€<a href="http://hsqldb.org/">HSQL</a> å’Œ <a href="https://db.apache.org/derby/">Derby</a> æ•°æ®åº“ã€‚æ‚¨ä¸éœ€è¦æä¾›ä»»ä½•è¿æ¥ URLï¼Œåªéœ€ä¸ºæ‚¨æƒ³è¦ä½¿ç”¨çš„å†…åµŒæ•°æ®åº“å¼•å…¥ç‰¹å®šçš„æ„å»ºä¾èµ–ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœæ‚¨åœ¨æµ‹è¯•ä¸­ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œæ— è®ºä½¿ç”¨äº†å¤šå°‘åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ï¼Œæ•´ä¸ªæµ‹è¯•å¥—ä»¶éƒ½ä¼šé‡å¤ä½¿ç”¨ç›¸åŒçš„æ•°æ®åº“ã€‚å¦‚æœæ‚¨æƒ³ç¡®ä¿æ¯ä¸ªä¸Šä¸‹æ–‡éƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„å†…åµŒæ•°æ®åº“ï¼Œåˆ™åº”è¯¥å°† <code>spring.datasource.generate-unique-name</code> è®¾ç½®ä¸º <code>true</code>ã€‚</p></blockquote><p>ä»¥ä¸‹æ˜¯ POM ä¾èµ–ç¤ºä¾‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hsqldb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hsqldb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>è¦è‡ªåŠ¨é…ç½®å†…åµŒæ•°æ®åº“ï¼Œæ‚¨éœ€è¦ä¸€ä¸ª <code>spring-jdbc</code> ä¾èµ–ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒæ˜¯é€šè¿‡ <code>spring-boot-starter-data-jpa</code> å¼•å…¥ã€‚</p></blockquote><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœå‡ºäºæŸäº›åŸå› ï¼Œæ‚¨éœ€è¦é…ç½®å†…åµŒæ•°æ®åº“çš„è¿æ¥ URLï¼Œåˆ™åº”æ³¨æ„ç¡®ä¿ç¦ç”¨æ•°æ®åº“çš„è‡ªåŠ¨å…³é—­åŠŸèƒ½ã€‚å¦‚æœæ‚¨ä½¿ç”¨ H2ï¼Œåˆ™åº”è¯¥ä½¿ç”¨ <code>DB_CLOSE_ON_EXIT=FALSE</code> æ¥è®¾ç½®ã€‚å¦‚æœæ‚¨ä½¿ç”¨ <code>HSQLDB</code>ï¼Œåˆ™ç¡®ä¿ä¸ä½¿ç”¨ <code>shutdown=true</code>ã€‚ç¦ç”¨æ•°æ®åº“çš„è‡ªåŠ¨å…³é—­åŠŸèƒ½å…è®¸ Spring Boot æ§åˆ¶æ•°æ®åº“ä½•æ—¶å…³é—­ï¼Œä»è€Œç¡®ä¿ä¸€æ—¦ä¸å†éœ€è¦è®¿é—®æ•°æ®åº“æ—¶å°±è§¦å‘ã€‚</p></blockquote><p><a id="boot-features-connect-to-production-database"></a></p><h4 id="30-1-2ã€è¿æ¥ç”Ÿäº§æ•°æ®åº“">30.1.2ã€è¿æ¥ç”Ÿäº§æ•°æ®åº“</h4><p>ç”Ÿäº§æ•°æ®åº“è¿æ¥ä¹Ÿå¯ä»¥ä½¿ç”¨ä½¿ç”¨ <code>DataSource</code> è‡ªåŠ¨é…ç½®ã€‚Spring Boot ä½¿ç”¨ä»¥ä¸‹ç®—æ³•æ¥é€‰æ‹©ä¸€ä¸ªç‰¹å®šçš„å®ç°ï¼š</p><ul><li>å‡ºäºæ€§èƒ½å’Œå¹¶å‘æ€§çš„è€ƒè™‘ï¼Œæˆ‘ä»¬æ›´å–œæ¬¢ <a href="https://github.com/brettwooldridge/HikariCP">HikariCP</a> è¿æ¥æ± ã€‚å¦‚æœ HikariCP å¯ç”¨ï¼Œæˆ‘ä»¬æ€»æ˜¯é€‰æ‹©å®ƒã€‚</li><li>å¦åˆ™ï¼Œå¦‚æœ Tomcat æ±  <code>DataSource</code> å¯ç”¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒã€‚</li><li>å¦‚æœ HikariCP å’Œ Tomcat æ± æ•°æ®æºä¸å¯ç”¨ï¼Œä½† <a href="https://commons.apache.org/proper/commons-dbcp/">Commons DBCP</a> å¯ç”¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒã€‚</li></ul><p>å¦‚æœæ‚¨ä½¿ç”¨äº† <code>spring-boot-starter-jdbc</code> æˆ–è€… <code>spring-boot-starter-data-jpa</code> starterï¼Œæ‚¨å°†è‡ªåŠ¨å¾—åˆ° <code>HikariCP</code> ä¾èµ–ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>æ‚¨å®Œå…¨å¯ä»¥ç»•è¿‡è¯¥ç®—æ³•ï¼Œå¹¶é€šè¿‡ <code>spring.datasource.type</code> å±æ€§æŒ‡å®šè¦ä½¿ç”¨çš„è¿æ¥æ± ã€‚å¦‚æœæ‚¨åœ¨ Tomcat å®¹å™¨ä¸­è¿è¡Œåº”ç”¨ç¨‹åºï¼Œé»˜è®¤æä¾› <code>tomcat-jdbc</code>ï¼Œè¿™ç‚¹å°¤å…¶é‡è¦ã€‚</p></blockquote><p><strong>æç¤º</strong></p><blockquote><p>å¯ä»¥æ‰‹åŠ¨é…ç½®å…¶ä»–è¿æ¥æ± ã€‚å¦‚æœæ‚¨å®šä¹‰äº†è‡ªå·±çš„ <code>DataSource</code> beanï¼Œåˆ™è‡ªåŠ¨é…ç½®å°†ä¸ä¼šè§¦å‘ã€‚</p></blockquote><p>æ•°æ®æºé…ç½®ç”± <code>spring.datasource.*</code> ä¸­çš„å¤–éƒ¨å±æ€§æ‰€æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨ <code>application.properties</code> ä¸­å£°æ˜ä»¥ä¸‹éƒ¨åˆ†ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.url</span>=jdbc:mysql://localhost/test</span><br><span class="line"><span class="attr">spring.datasource.username</span>=dbuser</span><br><span class="line"><span class="attr">spring.datasource.password</span>=dbpass</span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=com.mysql.jdbc.Driver</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>æ‚¨è‡³å°‘åº”è¯¥ä½¿ç”¨ <code>spring.datasource.url</code> å±æ€§æ¥æŒ‡å®š URLï¼Œå¦åˆ™ Spring Boot å°†å°è¯•è‡ªåŠ¨é…ç½®å†…åµŒæ•°æ®åº“ã€‚</p></blockquote><p><strong>æç¤º</strong></p><blockquote><p>é€šå¸¸æ‚¨ä¸éœ€è¦æŒ‡å®š <code>driver-class-name</code>ï¼Œå› ä¸º Spring boot å¯ä»¥ä» <code>url</code> æ¨å¯¼å‡ºå¤§å¤šæ•°æ•°æ®åº“ã€‚</p></blockquote><p><strong>æ³¨æ„</strong></p><blockquote><p>å¯¹äºè¦åˆ›å»ºçš„æ±  <code>DataSource</code>ï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤ŸéªŒè¯æœ‰æ•ˆçš„ <code>Driver</code> ç±»æ˜¯å¦å¯ç”¨ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ä½¿ç”¨ä¹‹å‰è¿›è¡Œæ£€æŸ¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨è®¾ç½®äº† <code>spring.datasource.driver-class-name=com.mysql.jdbc.Driver</code>ï¼Œé‚£ä¹ˆè¯¥ç±»å¿…é¡»å¯åŠ è½½ã€‚</p></blockquote><p>æœ‰å…³æ›´å¤šæ”¯æŒé€‰é¡¹ï¼Œè¯·å‚é˜… <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jdbc/DataSourceProperties.java">DataSourceProperties</a>ã€‚è¿™äº›éƒ½æ˜¯æ ‡å‡†é€‰é¡¹ï¼Œä¸å®é™…çš„å®ç°æ— å…³ã€‚è¿˜å¯ä»¥ä½¿ç”¨å„è‡ªçš„å‰ç¼€ï¼ˆ<code>spring.datasource.hikari.*</code>ã€<code>spring.datasource.tomcat.*</code> å’Œ <code>spring.datasource.dbcp2.*</code>ï¼‰å¾®è°ƒå®ç°ç‰¹å®šçš„è®¾ç½®ã€‚è¯·å‚è€ƒæ‚¨ç°åœ¨ä½¿ç”¨çš„è¿æ¥æ± å®ç°çš„æ–‡æ¡£æ¥è·å–æ›´å¤šä¿¡æ¯ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ ä½¿ç”¨ <a href="https://tomcat.apache.org/tomcat-8.0-doc/jdbc-pool.html#Common_Attributes">Tomcat è¿æ¥æ± </a>ï¼Œåˆ™å¯ä»¥è‡ªå®šä¹‰è®¸å¤šå…¶ä»–è®¾ç½®ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Number of ms to wait before throwing an exception if no connection is available.</span></span><br><span class="line"><span class="attr">spring.datasource.tomcat.max-wait</span>=<span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Maximum number of active connections that can be allocated from this pool at the same time.</span></span><br><span class="line"><span class="attr">spring.datasource.tomcat.max-active</span>=<span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Validate the connection before borrowing it from the pool.</span></span><br><span class="line"><span class="attr">spring.datasource.tomcat.test-on-borrow</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p><a id="boot-features-connecting-to-a-jndi-datasource"></a></p><h4 id="30-1-3ã€è¿æ¥-JNDI-æ•°æ®æº">30.1.3ã€è¿æ¥ JNDI æ•°æ®æº</h4><p>å¦‚æœè¦å°† Spring Boot åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°åº”ç”¨æœåŠ¡å™¨ï¼ˆApplication Serverï¼‰ä¸Šï¼Œæ‚¨å¯èƒ½æƒ³ä½¿ç”¨åº”ç”¨æœåŠ¡å™¨çš„å†…ç½®åŠŸèƒ½å’Œ JNDI è®¿é—®æ–¹å¼æ¥é…ç½®å’Œç®¡ç†æ•°æ®æºã€‚</p><p><code>spring.datasource.jndi-name</code> å±æ€§å¯ä½œä¸º <code>spring.datasource.url</code>ã€<code>spring.datasource.username</code> å’Œ <code>spring.datasource.password</code> å±æ€§çš„æ›¿ä»£æ–¹æ³•ï¼Œç”¨äºä»ç‰¹å®šçš„ JNDI ä½ç½®è®¿é—® <code>DataSource</code>ã€‚ä¾‹å¦‚ï¼Œ<code>application.properties</code> ä¸­çš„ä»¥ä¸‹éƒ¨åˆ†å±•ç¤ºäº†å¦‚ä½•è®¿é—® JBoss AS å®šä¹‰çš„ <code>DataSource</code>ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.jndi-name</span>=java:jboss/datasources/customers</span><br></pre></td></tr></table></figure><p><a id="boot-features-using-jdbc-template"></a></p><h3 id="30-2ã€ä½¿ç”¨-JdbcTemplate">30.2ã€ä½¿ç”¨ JdbcTemplate</h3><p>Spring çš„ <code>JdbcTemplate</code> å’Œ <code>NamedParameterJdbcTemplate</code> ç±»æ˜¯è‡ªåŠ¨é…ç½®çš„ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>@Autowire</code> å°†å®ƒä»¬ç›´æ¥æ³¨å…¥æ‚¨çš„ bean ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyBean</span><span class="params">(JdbcTemplate jdbcTemplate)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.jdbcTemplate = jdbcTemplate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>spring.jdbc.template.*</code> å±æ€§æ¥è‡ªå®šä¹‰ä¸€äº› template çš„å±æ€§ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.jdbc.template.max-rows</span>=<span class="number">500</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p><code>NamedParameterJdbcTemplate</code> åœ¨åº•å±‚é‡ç”¨äº†ç›¸åŒçš„ <code>JdbcTemplate</code> å®ä¾‹ã€‚å¦‚æœå®šä¹‰äº†å¤šä¸ª <code>JdbcTemplate</code> ä¸”æ²¡æœ‰å£°æ˜ primary ä¸»å€™é€‰ï¼Œåˆ™ä¸ä¼šè‡ªåŠ¨é…ç½® <code>NamedParameterJdbcTemplate</code>ã€‚</p></blockquote><p><a id="boot-features-jpa-and-spring-data"></a></p><h3 id="30-3ã€JPA-ä¸-Spring-Data-JPA">30.3ã€JPA ä¸ Spring Data JPA</h3><p>Java Persistence APIï¼ˆJava æŒä¹…åŒ– APIï¼‰æ˜¯ä¸€é¡¹æ ‡å‡†æŠ€æœ¯ï¼Œå¯è®©æ‚¨å°†å¯¹è±¡<strong>æ˜ å°„</strong>åˆ°å…³ç³»æ•°æ®åº“ã€‚<code>spring-boot-starter-data-jpa</code> POM æä¾›äº†ä¸€ä¸ªå¿«é€Ÿèµ·æ­¥çš„æ–¹æ³•ã€‚å®ƒæä¾›äº†ä»¥ä¸‹å…³é”®ä¾èµ–ï¼š</p><ul><li><strong>Hibernate</strong> â€‰â€”â€”â€‰ æœ€å—æ¬¢è¿çš„ JPA å®ç°ä¹‹ä¸€ã€‚</li><li><strong>Spring Data JPA</strong> â€”â€” â€‰å¯ä»¥è½»æ¾åœ°å®ç°åŸºäº JPA çš„èµ„æºåº“ã€‚</li><li><strong>Spring ORM</strong> â€‰â€”â€” â€‰Spring Framework çš„æ ¸å¿ƒ ORM æ”¯æŒ</li></ul><p><strong>æç¤º</strong></p><blockquote><p>æˆ‘ä»¬ä¸ä¼šåœ¨è¿™é‡Œä»‹ç»å¤ªå¤šå…³äº JPA æˆ–è€… <a href="https://projects.spring.io/spring-data/">Spring Data</a> çš„ç›¸å…³å†…å®¹ã€‚æ‚¨å¯ä»¥åœ¨ <a href="https://spring.io/">spring.io</a> ä¸ŠæŸ¥çœ‹<a href="https://spring.io/guides/gs/accessing-data-jpa/">ä½¿ç”¨ JPA è®¿é—®æ•°æ®</a>ï¼Œè·å–é˜…è¯» <a href="https://projects.spring.io/spring-data-jpa/">Spring Data JPA</a> å’Œ <a href="https://hibernate.org/orm/documentation/">Hibernate</a> çš„å‚è€ƒæ–‡æ¡£ã€‚</p></blockquote><p><a id="boot-features-jpa-and-spring-data"></a></p><h4 id="30-3-1ã€å®ä½“ç±»">30.3.1ã€å®ä½“ç±»</h4><p>é€šå¸¸ï¼ŒJPA <strong>Entity</strong>ï¼ˆå®ä½“ï¼‰ç±»æ˜¯åœ¨ <code>persistence.xml</code> æ–‡ä»¶ä¸­æŒ‡å®šçš„ã€‚ä½¿ç”¨äº† Spring Bootï¼Œè¯¥æ–‡ä»¶å°†ä¸æ˜¯å¿…éœ€çš„ï¼Œå¯ä»¥ä½¿ç”¨ <strong>Entity Scanning</strong>ï¼ˆå®ä½“æ‰«æï¼‰æ¥ä»£æ›¿ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†æœç´¢ä¸»é…ç½®ç±»ï¼ˆä½¿ç”¨äº† <code>@EnableAutoConfiguration</code> æˆ– <code>@SpringBootApplication</code> æ³¨è§£ï¼‰ä¸‹é¢çš„æ‰€æœ‰åŒ…ã€‚</p><p>ä»»ä½•ç”¨äº† <code>@Entity</code>ã€<code>@Embeddable</code> æˆ–è€… <code>@MappedSuperclass</code> æ³¨è§£çš„ç±»å°†è¢«è€ƒè™‘ã€‚ä¸€ä¸ªå…¸å‹çš„å®ä½“ç±»å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapp.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">City</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span></span><br><span class="line"><span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Column(nullable = false)</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Column(nullable = false)</span></span><br><span class="line"><span class="keyword">private</span> String state;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... additional members, often include @OneToMany mappings</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="title function_">City</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">// no-args constructor required by JPA spec</span></span><br><span class="line"><span class="comment">// this one is protected since it shouldn&#x27;t be used directly</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">City</span><span class="params">(String name, String state)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.name = name;</span><br><span class="line"><span class="built_in">this</span>.state = state;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getState</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.state;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... etc</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>@EntityScan</code> æ³¨è§£è‡ªå®šä¹‰å®ä½“ç±»çš„æ‰«æä½ç½®ã€‚è¯·å‚è§<a href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/reference/htmlsingle/#howto-separate-entity-definitions-from-spring-configuration">84.4ã€ä» Spring configuration é…ç½®ä¸­åˆ†ç¦» @Entity å®šä¹‰</a>ç« èŠ‚ã€‚</p></blockquote><p><a id="boot-features-spring-data-jpa-repositories"></a></p><h4 id="30-3-2ã€Spring-Data-JPA-èµ„æºåº“">30.3.2ã€Spring Data JPA èµ„æºåº“</h4><p><a href="https://projects.spring.io/spring-data-jpa/">Spring Data JPA</a> èµ„æºåº“ï¼ˆrepositoryï¼‰æ˜¯æ¥å£ï¼Œæ‚¨å¯ä»¥å®šä¹‰ç”¨äºè®¿é—®æ•°æ®ã€‚JAP æŸ¥è¯¢æ˜¯æ ¹æ®æ‚¨çš„æ–¹æ³•åè‡ªåŠ¨åˆ›å»ºã€‚ä¾‹å¦‚ï¼Œ<code>CityRepository</code> æ¥å£å¯ä»¥å£°æ˜ <code>findAllByState(String state)</code> æ–¹æ³•æ¥æŸ¥æ‰¾æŒ‡å®šçŠ¶æ€ä¸‹çš„æ‰€æœ‰åŸå¸‚ã€‚</p><p>å¯¹äºæ›´åŠ å¤æ‚çš„æŸ¥è¯¢ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Spring Data çš„ <a href="https://docs.spring.io/spring-data/jpa/docs/current/api/org/springframework/data/jpa/repository/Query.html"><code>Query</code></a> æ³¨è§£</p><p>Spring Data èµ„æºåº“é€šå¸¸ç»§æ‰¿è‡ª <a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/Repository.html">Repository</a> æˆ–è€… <a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/CrudRepository.html">CrudRepository</a> æ¥å£ã€‚å¦‚æœæ‚¨ä½¿ç”¨äº†è‡ªåŠ¨é…ç½®ï¼Œåˆ™å°†ä»åŒ…å«ä¸»é…ç½®ç±»ï¼ˆä½¿ç”¨äº† <code>@EnableAutoConfiguration</code> æˆ– <code>@SpringBootApplication</code> æ³¨è§£ï¼‰çš„åŒ…ä¸­æœç´¢èµ„æºåº“ï¼š</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…¸å‹çš„ Spring Data èµ„æºåº“æ¥å£å®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapp.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.repository.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CityRepository</span> <span class="keyword">extends</span> <span class="title class_">Repository</span>&lt;City, Long&gt; &#123;</span><br><span class="line"></span><br><span class="line">Page&lt;City&gt; <span class="title function_">findAll</span><span class="params">(Pageable pageable)</span>;</span><br><span class="line"></span><br><span class="line">City <span class="title function_">findByNameAndStateAllIgnoringCase</span><span class="params">(String name, String state)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Spring Data JPA èµ„æºåº“æ”¯æŒä¸‰ç§ä¸åŒçš„å¼•å¯¼æ¨¡å¼ï¼šdefaultã€deferred å’Œ lazyã€‚è¦å¯ç”¨å»¶è¿Ÿæˆ–æ‡’æƒ°å¼•å¯¼ï¼Œè¯·å°† <code>spring.data.jpa.repositories.bootstrap-mode</code> åˆ†åˆ«è®¾ç½®ä¸º <code>deferred</code> æˆ– <code>lazy</code>ã€‚ä½¿ç”¨å»¶è¿Ÿæˆ–å»¶è¿Ÿå¼•å¯¼æ—¶ï¼Œè‡ªåŠ¨é…ç½®çš„ <code>EntityManagerFactoryBuilder</code> å°†ä½¿ç”¨ä¸Šä¸‹æ–‡çš„å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå™¨ï¼ˆå¦‚æœæœ‰ï¼‰ä½œä¸ºå¼•å¯¼ç¨‹åºæ‰§è¡Œå™¨ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>æˆ‘ä»¬å‡ ä¹æ²¡æœ‰æ¥è§¦åˆ° Spring Data JPA çš„è¡¨é¢å†…å®¹ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥é˜… <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/">Spring Data JPA å‚è€ƒæ–‡æ¡£</a>ã€‚</p></blockquote><p><a id="boot-features-creating-and-dropping-jpa-databases"></a></p><h4 id="30-3-3ã€åˆ›å»ºå’Œåˆ é™¤-JPA-æ•°æ®åº“">30.3.3ã€åˆ›å»ºå’Œåˆ é™¤ JPA æ•°æ®åº“</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong>ä»…</strong>å½“æ‚¨ä½¿ç”¨äº†å†…åµŒæ•°æ®åº“ï¼ˆH2ã€HSQL æˆ– Derbyï¼‰æ—¶æ‰ä¼šè‡ªåŠ¨åˆ›å»º JPA æ•°æ®åº“ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ <code>spring.jpa.*</code> å±æ€§æ˜¾å¼é…ç½® JPA è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œè¦åˆ›å»ºå’Œåˆ é™¤è¡¨ï¼Œæ‚¨å¯ä»¥å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ° <code>application.properties</code> ä¸­ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.jpa.hibernate.ddl-auto</span>=create-drop</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>å…³äºä¸Šè¿°åŠŸèƒ½ï¼ŒHibernate è‡ªå·±çš„å†…éƒ¨å±æ€§åç§°ï¼ˆå¦‚æœæ‚¨è®°ä½æ›´å¥½ï¼‰ä¸º <code>hibernate.hbm2ddl.auto</code>ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ <code>spring.jpa.properties.*</code>ï¼ˆåœ¨æ·»åŠ åˆ°å®ä½“ç®¡ç†å™¨ä¹‹å‰ï¼Œè¯¥å‰ç¼€å°†è¢«åˆ é™¤ï¼‰æ¥å°† Hibernate åŸç”Ÿå±æ€§ä¸€åŒè®¾ç½®ï¼š</p></blockquote><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.jpa.properties.hibernate.globally_quoted_identifiers</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ç¤ºä¾‹ä¸­å°† <code>true</code> å€¼è®¾ç½®ç»™ <code>hibernate.globally_quoted_identifiers</code> å±æ€§ï¼Œè¯¥å±æ€§å°†ä¼ ç»™ Hibernate å®ä½“ç®¡ç†å™¨ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒDDL æ‰§è¡Œï¼ˆæˆ–éªŒè¯ï¼‰å°†å»¶è¿Ÿåˆ° <code>ApplicationContext</code> å¯åŠ¨åã€‚è¿˜æœ‰ä¸€ä¸ª <code>spring.jpa.generate-ddl</code> æ ‡å¿—ï¼Œå¦‚æœ Hibernate è‡ªåŠ¨é…ç½®æ˜¯æ¿€æ´»çš„ï¼Œé‚£ä¹ˆå®ƒå°†ä¸ä¼šè¢«ä½¿ç”¨ï¼Œå› ä¸º <code>ddl-auto</code> è®¾ç½®æ›´ç»†ç²’åº¦ã€‚</p><p><a id="boot-features-jpa-in-web-environment"></a></p><h4 id="30-3-4ã€åœ¨è§†å›¾ä¸­æ‰“å¼€-EntityManager">30.3.4ã€åœ¨è§†å›¾ä¸­æ‰“å¼€ EntityManager</h4><p>å¦‚æœæ‚¨æ­£åœ¨è¿è¡Œ web åº”ç”¨ç¨‹åºï¼ŒSpring Boot å°†é»˜è®¤æ³¨å†Œ <a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/javadoc-api/org/springframework/orm/jpa/support/OpenEntityManagerInViewInterceptor.html"><code>OpenEntityManagerInViewInterceptor</code></a> ç”¨äº<strong>åœ¨è§†å›¾ä¸­æ‰“å¼€ EntityManager</strong> æ¨¡å¼ï¼Œå³è¿å…è®¸åœ¨ web è§†å›¾ä¸­å»¶è¿ŸåŠ è½½ã€‚å¦‚æœæ‚¨ä¸æƒ³å¼€å¯è¿™ä¸ªè¡Œä¸ºï¼Œåˆ™åº”åœ¨ <code>application.properties</code> ä¸­å°† <code>spring.jpa.open-in-view</code> è®¾ç½®ä¸º <code>false</code>ã€‚</p><p><a id="boot-features-data-jdbc"></a></p><h3 id="30-4ã€Spring-Data-JDBC">30.4ã€Spring Data JDBC</h3><p>Spring Data åŒ…å«äº†å¯¹ JDBC èµ„æºåº“çš„æ”¯æŒï¼Œå¹¶å°†è‡ªåŠ¨ä¸º <code>CrudRepository</code> ä¸Šçš„æ–¹æ³•ç”Ÿæˆ SQLã€‚å¯¹äºæ›´é«˜çº§çš„æŸ¥è¯¢ï¼Œå®ƒæä¾›äº† <code>@Query</code> æ³¨è§£ã€‚</p><p>å½“ classpath ä¸‹å­˜åœ¨å¿…è¦çš„ä¾èµ–æ—¶ï¼ŒSpring Boot å°†è‡ªåŠ¨é…ç½® Spring Data çš„ JDBC èµ„æºåº“ã€‚å¯ä»¥é€šè¿‡æ·»åŠ å•ä¸ª <code>spring-boot-starter-data-jdbc</code> ä¾èµ–å¼•å…¥åˆ°é¡¹ç›®ä¸­ã€‚å¦‚æœ‰å¿…è¦ï¼Œå¯é€šè¿‡åœ¨åº”ç”¨ç¨‹åºä¸­æ·»åŠ  <code>@EnableJdbcRepositories</code> æ³¨è§£æˆ– <code>JdbcConfiguration</code> å­ç±»æ¥æ§åˆ¶ Spring Data JDBC çš„é…ç½®ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>æœ‰å…³ Spring Data JDBC çš„å®Œæ•´è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://projects.spring.io/spring-data-jdbc/">å‚è€ƒæ–‡æ¡£</a>ã€‚</p></blockquote><p><a id="boot-features-sql-h2-console"></a></p><h3 id="30-5ã€ä½¿ç”¨-H2-çš„-Web-æ§åˆ¶å°">30.5ã€ä½¿ç”¨ H2 çš„ Web æ§åˆ¶å°</h3><p><a href="http://www.h2database.com/">H2 æ•°æ®åº“</a>æä¾›äº†ä¸€ä¸ª<a href="http://www.h2database.com/html/quickstart.html#h2_console">åŸºäºæµè§ˆå™¨çš„æ§åˆ¶å°</a>ï¼ŒSpring Boot å¯ä»¥ä¸ºæ‚¨è‡ªåŠ¨é…ç½®ã€‚å½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œæ§åˆ¶å°å°†è‡ªåŠ¨é…ç½®ï¼š</p><ul><li>æ‚¨å¼€å‘çš„æ˜¯ä¸€ä¸ªåŸºäº servlet çš„ web åº”ç”¨ç¨‹åº</li><li><code>com.h2database:h2</code> åœ¨ classpath ä¸Š</li><li>æ‚¨ä½¿ç”¨äº† <a href="#using-boot-devtools">Spring Boot çš„å¼€å‘è€…å·¥å…·</a></li></ul><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœæ‚¨ä¸ä½¿ç”¨ Spring Boot çš„å¼€å‘è€…å·¥å…·ï¼Œä½†ä»å¸Œæœ›ä½¿ç”¨ H2 çš„æ§åˆ¶å°ï¼Œåˆ™å¯ä»¥é€šè¿‡å°† <code>spring.h2.console.enabled</code> å±æ€§è®¾ç½®ä¸º <code>true</code> æ¥å®ç°ã€‚</p></blockquote><p><strong>æ³¨æ„</strong></p><blockquote><p>H2 æ§åˆ¶å°ä»…ç”¨äºå¼€å‘æœŸé—´ï¼Œå› æ­¤åº”æ³¨æ„ç¡®ä¿ <code>spring.h2.console.enabled</code> åœ¨ç”Ÿäº§ç¯å¢ƒä¸­<strong>æ²¡æœ‰</strong>è®¾ç½®ä¸º <code>true</code>ã€‚</p></blockquote><p><a id="boot-features-sql-h2-console-custom-path"></a></p><h4 id="30-5-1ã€æ›´æ”¹-H2-æ§åˆ¶å°çš„è·¯å¾„">30.5.1ã€æ›´æ”¹ H2 æ§åˆ¶å°çš„è·¯å¾„</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ§åˆ¶å°çš„è·¯å¾„ä¸º <code>/h2-console</code>ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>spring.h2.console.path</code> å±æ€§æ¥è‡ªå®šä¹‰æ§åˆ¶å°çš„è·¯å¾„ã€‚</p><p><a id="boot-features-jooq"></a></p><h3 id="30-6ã€ä½¿ç”¨-jOOQ">30.6ã€ä½¿ç”¨ jOOQ</h3><p>Java é¢å‘å¯¹è±¡æŸ¥è¯¢ï¼ˆ<a href="http://www.jooq.org/">Java Object Oriented Queryingï¼ŒjOOQ</a>ï¼‰æ˜¯ä¸€æ¬¾å¹¿å—æ¬¢è¿çš„äº§å“ï¼Œå‡ºè‡ª <a href="http://www.datageekery.com/">Data Geekery</a>ï¼Œå®ƒå¯ä»¥é€šè¿‡æ•°æ®åº“ç”Ÿæˆ Java ä»£ç ï¼Œå¹¶å…è®¸æ‚¨ä½¿ç”¨æµå¼ API æ¥æ„å»ºç±»å‹å®‰å…¨çš„ SQL æŸ¥è¯¢ã€‚å•†ä¸šç‰ˆå’Œå¼€æºç‰ˆéƒ½å¯ä»¥ä¸ Spring Boot ä¸€èµ·ä½¿ç”¨ã€‚</p><p><a id="_code_generation"></a></p><h4 id="30-6-1ã€ä»£ç ç”Ÿæˆ">30.6.1ã€ä»£ç ç”Ÿæˆ</h4><p>è¦ä½¿ç”¨ jOOQ çš„ç±»å‹å®‰å…¨æŸ¥è¯¢ï¼Œæ‚¨éœ€è¦ä»æ•°æ®åº“æ¨¡å¼ç”Ÿæˆ Java ç±»ã€‚æ‚¨å¯ä»¥æŒ‰ç…§ <a href="https://www.jooq.org/doc/3.11.7/manual-single-page/#jooq-in-7-steps-step3">jOOQ ç”¨æˆ·æ‰‹å†Œ</a>ä¸­çš„è¯´æ˜è¿›è¡Œæ“ä½œã€‚å¦‚æœæ‚¨ä½¿ç”¨äº† <code>jooq-codegen-maven</code> æ’ä»¶ï¼Œå¹¶ä¸”è¿˜ä½¿ç”¨äº† <code>spring-boot-starter-parent</code> çˆ¶ POMï¼Œåˆ™å¯ä»¥å®‰å…¨åœ°çœç•¥æ‰æ’ä»¶çš„ <code>&lt;version&gt;</code> æ ‡ç­¾ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ Spring Boot å®šä¹‰çš„ç‰ˆæœ¬å˜é‡ï¼ˆä¾‹å¦‚ <code>h2.version</code>ï¼‰æ¥å£°æ˜æ’ä»¶çš„æ•°æ®åº“ä¾èµ–ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jooq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jooq-codegen-maven<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;h2.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jdbc</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">driver</span>&gt;</span>org.h2.Driver<span class="tag">&lt;/<span class="name">driver</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>jdbc:h2:~/yourdatabase<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">jdbc</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a id="_using_dslcontext"></a></p><h4 id="30-6-2ã€ä½¿ç”¨-DSLContext">30.6.2ã€ä½¿ç”¨ DSLContext</h4><p>jOOQ æä¾›çš„æµå¼ API æ˜¯é€šè¿‡ <code>org.jooq.DSLContext</code> æ¥å£åˆå§‹åŒ–çš„ã€‚Spring Boot å°†è‡ªåŠ¨é…ç½®ä¸€ä¸ª <code>DSLContext</code> ä½œä¸º Spring Beanï¼Œå¹¶ä¸”å°†å…¶è¿æ¥åˆ°åº”ç”¨ç¨‹åºçš„ <code>DataSource</code>ã€‚<code>è¦ä½¿ç”¨ DSLContext</code>ï¼Œæ‚¨åªéœ€è¦ <code>@Autowire</code> å®ƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JooqExample</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> DSLContext create;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">JooqExample</span><span class="params">(DSLContext dslContext)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.create = dslContext;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>jOOQ æ‰‹å†Œå»ºè®®ä½¿ç”¨åä¸º <code>create</code> çš„å˜é‡æ¥ä¿å­˜ <code>DSLContext</code>ã€‚</p></blockquote><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>DSLContext</code> æ„å»ºæŸ¥è¯¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;GregorianCalendar&gt; <span class="title function_">authorsBornAfter1980</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.create.selectFrom(AUTHOR)</span><br><span class="line">.where(AUTHOR.DATE_OF_BIRTH.greaterThan(<span class="keyword">new</span> <span class="title class_">GregorianCalendar</span>(<span class="number">1980</span>, <span class="number">0</span>, <span class="number">1</span>)))</span><br><span class="line">.fetch(AUTHOR.DATE_OF_BIRTH);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="_jooq_sql_dialect"></a></p><h4 id="30-6-3ã€jOOQ-SQL-æ–¹è¨€">30.6.3ã€jOOQ SQL æ–¹è¨€</h4><p>é™¤éé…ç½®äº† <code>spring.jooq.sql-dialect</code> å±æ€§ï¼Œå¦åˆ™ Spring Boot ä¼šè‡ªåŠ¨åˆ¤å®šç”¨äºæ•°æ®æºçš„ SQL æ–¹è¨€ã€‚å¦‚æœ Spring Boot æ— æ³•æ£€æµ‹åˆ°æ–¹è¨€ï¼Œåˆ™ä½¿ç”¨ <code>DEFAULT</code>ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>Spring Boot åªèƒ½è‡ªåŠ¨é…ç½® jOOQ å¼€æºç‰ˆæœ¬æ”¯æŒçš„æ–¹è¨€ã€‚</p></blockquote><p><a id="_customizing_jooq"></a></p><h4 id="30-6-4ã€è‡ªå®šä¹‰-jOOQ">30.6.4ã€è‡ªå®šä¹‰ jOOQ</h4><p>å¯é€šè¿‡å®šä¹‰è‡ªå·±çš„ <code>@Bean</code> æ¥å®ç°æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œè¿™äº›è‡ªå®šä¹‰å°†åœ¨åˆ›å»º jOOQ <code>Configuration</code> æ—¶ä½¿ç”¨ã€‚æ‚¨å¯ä»¥ä¸ºä»¥ä¸‹ jOOQ ç±»å‹å®šä¹‰ beanï¼š</p><ul><li><code>ConnectionProvider</code></li><li><code>ExecutorProvider</code></li><li><code>TransactionProvider</code></li><li><code>RecordMapperProvider</code></li><li><code>RecordUnmapperProvider</code></li><li><code>RecordListenerProvider</code></li><li><code>ExecuteListenerProvider</code></li><li><code>VisitListenerProvider</code></li><li><code>TransactionListenerProvider</code></li></ul><p>å¦‚æœè¦å®Œå…¨æ§åˆ¶ jOOQ é…ç½®ï¼Œæ‚¨å¯ä»¥åˆ›å»ºè‡ªå·±çš„ <code>org.jooq.Configuration</code> <code>@Bean</code>ã€‚</p><p><a id="boot-features-nosql"></a></p><h2 id="31ã€ä½¿ç”¨-NoSQL-æŠ€æœ¯">31ã€ä½¿ç”¨ NoSQL æŠ€æœ¯</h2><p>Spring Data æä¾›äº†å…¶ä»–é¡¹ç›®ï¼Œå¯ä»¥å¸®åŠ©æ‚¨è®¿é—®å„ç§ NoSQL æŠ€æœ¯ï¼ŒåŒ…æ‹¬ <a href="https://projects.spring.io/spring-data-mongodb/">MongoDB</a>ã€<a href="https://projects.spring.io/spring-data-neo4j/">Neo4J</a>ã€<a href="https://github.com/spring-projects/spring-data-elasticsearch/">Elasticsearch</a>ã€<a href="https://projects.spring.io/spring-data-solr/">Solr</a>ã€<a href="https://projects.spring.io/spring-data-redis/">Redis</a>ã€<a href="https://projects.spring.io/spring-data-gemfire/">Gemfire</a>ã€<a href="https://projects.spring.io/spring-data-cassandra/">Cassandra</a>ã€<a href="https://projects.spring.io/spring-data-couchbase/">Couchbase</a> å’Œ <a href="https://projects.spring.io/spring-data-ldap/">LDAP</a>ã€‚Spring Boot ä¸º Redisã€MongoDBã€Neo4jã€Elasticsearchã€Solrã€Cassandraã€Couchbase å’Œ LDAP æä¾›äº†è‡ªåŠ¨é…ç½®ã€‚æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–é¡¹ç›®ï¼Œä½†æ‚¨éœ€è¦è‡ªè¡Œé…ç½®ä»–ä»¬ã€‚è¯·å‚é˜… <a href="https://projects.spring.io/spring-data">projects.spring.io/spring-data</a> ä¸­ç›¸åº”çš„å‚è€ƒæ–‡æ¡£ã€‚</p><p><a id="boot-features-redis"></a></p><h3 id="31-1ã€Redis">31.1ã€Redis</h3><p><a href="http://redis.io/">Redis</a> æ˜¯ä¸€ä¸ªé›†ç¼“å­˜ã€æ¶ˆæ¯ä»£ç†å’Œé”®å€¼å­˜å‚¨ç­‰ä¸°å¯ŒåŠŸèƒ½çš„æ•°æ®åº“ã€‚Spring Boot ä¸º <a href="https://github.com/lettuce-io/lettuce-core/">Lettuce</a> å’Œ <a href="https://github.com/xetorthio/jedis/">Jedis å®¢æˆ·ç«¯ç±»åº“</a>æä¾›äº†åŸºæœ¬è‡ªåŠ¨é…ç½®ï¼Œ<a href="https://github.com/spring-projects/spring-data-redis">Spring Data Redis</a> ä¸ºä»–ä»¬æä¾›äº†ä¸Šå±‚æŠ½è±¡ã€‚</p><p>ä½¿ç”¨ <code>spring-boot-starter-data-redis</code> starter å¯æ–¹ä¾¿åœ°å¼•å…¥ç›¸å…³ä¾èµ–ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä½¿ç”¨ <a href="https://github.com/lettuce-io/lettuce-core/">Lettuce</a>ã€‚è¯¥ starter å¯å¤„ç†ä¼ ç»Ÿåº”ç”¨ç¨‹åºå’Œå“åº”å¼åº”ç”¨ç¨‹åºã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>æˆ‘ä»¬è¿˜æä¾›äº†ä¸€ä¸ª <code>spring-boot-starter-data-redis-reactive</code> starterï¼Œä»¥ä¾¿ä¸å…¶ä»–å¸¦æœ‰å“åº”å¼æ”¯æŒçš„å­˜å‚¨ä¿æŒä¸€è‡´ã€‚</p></blockquote><p><a id="boot-features-connecting-to-redis"></a></p><h4 id="31-1-1ã€è¿æ¥-Redis">31.1.1ã€è¿æ¥ Redis</h4><p>æ‚¨å¯ä»¥åƒæ‰€æœ‰ Spring Bean ä¸€æ ·æ³¨å…¥è‡ªåŠ¨é…ç½®çš„ <code>RedisConnectionFactory</code>ã€<code>StringRedisTemplate</code> æˆ–æ™®é€šçš„ <code>RedisTemplate</code> å®ä¾‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ä¾‹å°†å°è¯•åœ¨ <code>localhost:6379</code> ä¸Šè¿æ¥ Redis æœåŠ¡å™¨ï¼Œä»¥ä¸‹æ˜¯ bean ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate template;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyBean</span><span class="params">(StringRedisTemplate template)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.template = template;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>æ‚¨è¿˜å¯ä»¥æ³¨å†Œä»»æ„æ•°é‡ä¸ªå®ç°äº† <code>LettuceClientConfigurationBuilderCustomizer</code> çš„ beanï¼Œä»¥è¿›è¡Œæ›´é«˜çº§çš„è‡ªå®šä¹‰ã€‚å¦‚æœä½ ä½¿ç”¨ Jedisï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code>JedisClientConfigurationBuilderCustomizer</code>ã€‚</p></blockquote><p>å¦‚æœæ‚¨æ·»åŠ äº†è‡ªå·±çš„ä»»ä½•ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»å‹çš„ <code>@Bean</code>ï¼Œå®ƒå°†æ›¿æ¢é»˜è®¤è®¾ç½®ï¼ˆé™¤äº† <code>RedisTemplate</code>ï¼Œç”±äºæ’é™¤æ˜¯åŸºäº bean åç§°ï¼Œè€Œ <code>redisTemplate</code> ä¸æ˜¯å®ƒçš„ç±»å‹ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœ <code>commons-pool2</code> åœ¨ classpath ä¸Šï¼Œæ‚¨å°†è·å¾—ä¸€ä¸ªè¿æ¥æ± å·¥å‚ã€‚</p><p><a id="boot-features-mongodb"></a></p><h3 id="31-2ã€MongoDB">31.2ã€MongoDB</h3><p><a href="https://www.mongodb.com/">MongoDB</a> æ˜¯ä¸€ä¸ªå¼€æºçš„ NoSQL æ–‡æ¡£æ•°æ®åº“ï¼Œå…¶ä½¿ç”¨äº†ç±»ä¼¼ JSON çš„æ¨¡å¼ï¼ˆschemaï¼‰æ¥æ›¿ä»£ä¼ ç»ŸåŸºäºè¡¨çš„å…³ç³»æ•°æ®ã€‚Spring Boot ä¸º MongoDB æä¾›äº†å‡ ç§ä¾¿åˆ©çš„ä½¿ç”¨æ–¹å¼ï¼ŒåŒ…æ‹¬ <code>spring-boot-starter-data-mongodb</code> å’Œ <code>spring-boot-starter-data-mongodb-reactive</code> starterã€‚</p><p><a id="boot-features-connecting-to-mongodb"></a></p><h4 id="31-2-1ã€è¿æ¥-MongoDB-æ•°æ®åº“">31.2.1ã€è¿æ¥ MongoDB æ•°æ®åº“</h4><p>æ‚¨å¯ä»¥æ³¨å…¥ä¸€ä¸ªè‡ªåŠ¨é…ç½®çš„ <code>org.springframework.data.mongodb.MongoDbFactory</code> æ¥è®¿é—® Mongo æ•°æ®åº“ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å®ä¾‹å°†å°è¯•åœ¨ <code>mongodb://localhost/test</code> ä¸Šè¿æ¥ MongoDB æœåŠ¡å™¨ï¼Œä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•è¿æ¥åˆ° MongoDB æ•°æ®åº“ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.MongoDbFactory;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.DB;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> MongoDbFactory mongo;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyBean</span><span class="params">(MongoDbFactory mongo)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.mongo = mongo;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">example</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="type">DB</span> <span class="variable">db</span> <span class="operator">=</span> mongo.getDb();</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥é€šè¿‡è®¾ç½® <code>spring.data.mongodb.uri</code> å±æ€§æ¥æ›´æ”¹ URL å’Œé…ç½®å…¶ä»–è®¾ç½®ï¼Œå¦‚<strong>å‰¯æœ¬é›†</strong>ï¼ˆreplica setï¼‰ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.data.mongodb.uri</span>=mongodb://user:secret@mongo1.example.com:<span class="number">12345</span>,mongo2.example.com:<span class="number">23456</span>/test</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œåªè¦æ‚¨ä½¿ç”¨äº† Mongo 2.xï¼Œè¯·æŒ‡å®š <code>host</code>/<code>port</code>ã€‚æ¯”å¦‚ï¼Œæ‚¨å¯èƒ½è¦åœ¨ <code>application.properties</code> ä¸­å£°æ˜ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.data.mongodb.host</span>=mongoserver</span><br><span class="line"><span class="attr">spring.data.mongodb.port</span>=<span class="number">27017</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨å·²ç»å®šä¹‰äº†è‡ªå·±çš„ <code>MongoClient</code>ï¼Œå®ƒå°†è¢«ç”¨äºè‡ªåŠ¨é…ç½®åˆé€‚çš„ <code>MongoDbFactory</code>ã€‚æ”¯æŒ <code>com.mongodb.MongoClient</code> å’Œ <code>com.mongodb.client.MongoClient</code>ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœæ‚¨ä½¿ç”¨ Mongo 3.0 Java é©±åŠ¨ï¼Œåˆ™ä¸æ”¯æŒ <code>spring.data.mongodb.host</code> å’Œ <code>spring.data.mongodb.port</code>ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œåº”è¯¥ä½¿ç”¨ <code>spring.data.mongodb.uri</code> æ¥æä¾›æ‰€æœ‰é…ç½®ã€‚</p></blockquote><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœæœªæŒ‡å®š <code>spring.data.mongodb.port</code>ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ <code>27017</code>ã€‚æ‚¨å¯ä»¥å°†ä¸Šè¿°ç¤ºä¾‹ä¸­çš„æ”¹è¡Œé…ç½®åˆ é™¤æ‰ã€‚</p></blockquote><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœæ‚¨ä¸ä½¿ç”¨ Spring Data Mongoï¼Œåˆ™å¯ä»¥æ³¨å…¥ <code>com.mongodb.MongoClient</code> bean æ¥ä»£æ›¿ <code>MongoDbFactory</code>ã€‚å¦‚æœè¦å®Œå…¨æ§åˆ¶å»ºç«‹ MongoDB è¿æ¥ï¼Œæ‚¨è¿˜å¯ä»¥å£°æ˜è‡ªå·±çš„ <code>MongoDbFactory</code> æˆ–è€… <code>MongoClient</code> beanã€‚</p></blockquote><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯å“åº”å¼é©±åŠ¨ï¼Œåˆ™ SSL éœ€è¦ Nettyã€‚ å¦‚æœ Netty å¯ç”¨ä¸” factory å°šæœªè‡ªå®šä¹‰ï¼Œåˆ™è‡ªåŠ¨é…ç½®ä¼šè‡ªåŠ¨é…ç½®æ­¤ factoryã€‚</p></blockquote><p><a id="boot-features-mongo-template"></a></p><h4 id="31-2-2ã€MongoTemplate">31.2.2ã€MongoTemplate</h4><p><a href="https://projects.spring.io/spring-data-mongodb/">Spring Data Mongo</a> æä¾›äº†ä¸€ä¸ª <a href="https://docs.spring.io/spring-data/mongodb/docs/current/api/org/springframework/data/mongodb/core/MongoTemplate.html"><code>MongoTemplate</code></a> ç±»ï¼Œå®ƒçš„è®¾è®¡ä¸ Spring çš„ <code>JdbcTemplate</code> éå¸¸ç›¸ä¼¼ã€‚ä¸ <code>JdbcTemplate</code> ä¸€æ ·ï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½®ä¸€ä¸ª beanï¼Œä»¥ä¾¿æ‚¨èƒ½æ³¨å…¥æ¨¡æ¿ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyBean</span><span class="params">(MongoTemplate mongoTemplate)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.mongoTemplate = mongoTemplate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œå‚ç…§ <a href="https://docs.spring.io/spring-data/mongodb/docs/current/api/org/springframework/data/mongodb/core/MongoOperations.html"><code>MongoOperations</code></a> Javadocã€‚</p><p><a id="boot-features-spring-data-mongo-repositories"></a></p><h4 id="31-2-3ã€Spring-Data-MongoDB-èµ„æºåº“">31.2.3ã€Spring Data MongoDB èµ„æºåº“</h4><p>Spring Data åŒ…å«äº†å¯¹ MongoDB èµ„æºåº“ï¼ˆrepositoryï¼‰çš„æ”¯æŒã€‚ä¸ä¹‹å‰è®¨è®ºçš„ JPA èµ„æºåº“ä¸€æ ·ï¼ŒåŸºæœ¬åŸç†æ˜¯æ ¹æ®æ–¹æ³•åç§°è‡ªåŠ¨æ„å»ºæŸ¥è¯¢ã€‚</p><p>äº‹å®ä¸Šï¼ŒSpring Data JPA å’Œ Spring Data MongoDB å…±äº«é€šç”¨çš„åº•å±‚ä»£ç ï¼Œå› æ­¤ä½ å¯ä»¥æ‹¿ä¹‹å‰æåˆ°çš„ JPA ç¤ºä¾‹ä½œä¸ºåŸºç¡€ï¼Œå‡è®¾ <code>City</code> ç°åœ¨æ˜¯ä¸€ä¸ª Mongo æ•°æ®ç±»ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª JPA <code>@Entity</code>ï¼Œä»–ä»¬æ–¹å¼å·¥ä½œç›¸åŒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapp.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.repository.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CityRepository</span> <span class="keyword">extends</span> <span class="title class_">Repository</span>&lt;City, Long&gt; &#123;</span><br><span class="line"></span><br><span class="line">Page&lt;City&gt; <span class="title function_">findAll</span><span class="params">(Pageable pageable)</span>;</span><br><span class="line"></span><br><span class="line">City <span class="title function_">findByNameAndStateAllIgnoringCase</span><span class="params">(String name, String state)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>@EntityScan</code> æ³¨è§£æ¥è‡ªå®šä¹‰æ–‡æ¡£æ‰«æä½ç½®ã€‚</p></blockquote><p><strong>æç¤º</strong></p><blockquote><p>æœ‰å…³ Spring Data MongoDB çš„å®Œæ•´è¯¦ç»†å†…å®¹ï¼ŒåŒ…æ‹¬å…¶ä¸°å¯Œçš„å¯¹è±¡å…³ç³»æ˜ å°„æŠ€æœ¯ï¼Œè¯·å‚è€ƒå…¶<a href="https://projects.spring.io/spring-data-mongodb/">å‚è€ƒæ–‡æ¡£</a>ã€‚</p></blockquote><p><a id="boot-features-mongo-embedded"></a></p><h4 id="31-2-4ã€å†…åµŒ-Mongo">31.2.4ã€å†…åµŒ Mongo</h4><p>Spring Boot æä¾›äº†<a href="https://github.com/flapdoodle-oss/de.flapdoodle.embed.mongo">å†…åµŒ Mongo</a> çš„è‡ªåŠ¨é…ç½®ã€‚è¦åœ¨ Spring Boot åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒï¼Œè¯·æ·»åŠ ä¾èµ– <code>de.flapdoodle.embed:de.flapdoodle.embed.mongo</code>ã€‚</p><p>å¯ä»¥ä½¿ç”¨ <code>spring.data.mongodb.port</code> å±æ€§æ¥é…ç½® Mongo çš„ç›‘å¬ç«¯å£ã€‚å¦‚æœæƒ³éšæœºåˆ†é…ç©ºé—²ç«¯å£ï¼Œè¯·æŠŠå€¼è®¾ç½®ä¸º 0ã€‚<code>MongoAutoConfiguration</code> åˆ›å»ºçš„ <code>MongoClient</code> å°†è‡ªåŠ¨é…ç½®éšæœºåˆ†é…çš„ç«¯å£ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœæ‚¨ä¸é…ç½®ä¸€ä¸ªè‡ªå®šä¹‰ç«¯å£ï¼Œå†…åµŒæ”¯æŒå°†é»˜è®¤ä½¿ç”¨ä¸€ä¸ªéšæœºç«¯å£ï¼ˆè€Œä¸æ˜¯ 27017ï¼‰ã€‚</p></blockquote><p>å¦‚æœæ‚¨çš„ classpath ä¸Šæœ‰ SLF4Jï¼ŒMongo äº§ç”Ÿçš„è¾“å‡ºå°†è‡ªåŠ¨è·¯ç”±åˆ°åä¸º <code>org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongo</code> çš„ loggerã€‚</p><p>æ‚¨å¯ä»¥å£°æ˜è‡ªå·±çš„ <code>IMongodConfig</code> å’Œ <code>IRuntimeConfig</code> bean æ¥æ§åˆ¶ Mongo å®ä¾‹çš„é…ç½®å’Œæ—¥å¿—è·¯ç”±ã€‚</p><p><a id="boot-features-neo4j"></a></p><h3 id="31-3ã€Neo4j">31.3ã€Neo4j</h3><p><a href="http://neo4j.com/">Neo4j</a> æ˜¯ä¸€ä¸ªå¼€æºçš„ NoSQL å›¾å½¢æ•°æ®åº“ï¼Œå®ƒä½¿ç”¨äº†ä¸€ä¸ªèŠ‚ç‚¹ç”±å…³ç³»è¿æ¥çš„å¯Œæ•°æ®æ¨¡å‹ï¼Œæ¯”ä¼ ç»Ÿ RDBMS çš„æ–¹å¼æ›´é€‚åˆè¿æ¥å¤§æ•°æ®ã€‚Spring Boot ä¸º Neo4j æä¾›äº†ä¾¿æ·å¼•å…¥æ–¹å¼ï¼ŒåŒ…æ‹¬ <code>spring-boot-starter-data-neo4j</code> starterã€‚</p><p><a id="boot-features-connecting-to-neo4j"></a></p><h4 id="31-3-1ã€è¿æ¥-Neo4j-æ•°æ®åº“">31.3.1ã€è¿æ¥ Neo4j æ•°æ®åº“</h4><p>æ‚¨å¯ä»¥åƒä»»ä½• Spring Bean ä¸€æ ·æ³¨å…¥ä¸€ä¸ªè‡ªåŠ¨é…ç½®çš„ <code>org.neo4j.ogm.session.Session</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ è¯¥å®ä¾‹å°†å°è¯•ä½¿ç”¨åœ¨ <code>localhost:7687</code> ä¸Šä½¿ç”¨ Bolt åè®®è¿æ¥åˆ° Neo4j æœåŠ¡å™¨ï¼Œä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æ³¨å…¥ ä¸€ä¸ª Neo4j <code>Session</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Session session;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyBean</span><span class="params">(Session session)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.session = session;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥é€šè¿‡é…ç½® <code>spring.data.neo4j.*</code> å±æ€§æ¥è®¾ç½® uri å’Œå‡­æ®ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.data.neo4j.uri</span>=bolt://my-server:<span class="number">7687</span></span><br><span class="line"><span class="attr">spring.data.neo4j.username</span>=neo4j</span><br><span class="line"><span class="attr">spring.data.neo4j.password</span>=secret</span><br></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥é€šè¿‡æ·»åŠ è‡ªå·±çš„ <code>org.neo4j.ogm.config.Configuration</code> @Bean æ¥å®Œå…¨æ§åˆ¶ session åˆ›å»ºã€‚æ­¤å¤–ï¼Œæ·»åŠ  <code>SessionFactory</code> ç±»å‹çš„ @Bean ä¼šç¦ç”¨è‡ªåŠ¨é…ç½®ï¼Œå› æ­¤æ‚¨å¯ä»¥æŒæ§æ‰€æœ‰ã€‚</p><p><a id="boot-features-connecting-to-neo4j-embedded"></a></p><h4 id="31-3-2ã€ä½¿ç”¨å†…åµŒæ¨¡å¼">31.3.2ã€ä½¿ç”¨å†…åµŒæ¨¡å¼</h4><p>å¦‚æœæ‚¨å°† <code>org.neo4j:neo4j-ogm-embedded-driver</code> æ·»åŠ åˆ°åº”ç”¨ç¨‹åºçš„ä¾èµ–ä¸­ï¼ŒSpring Boot å°†è‡ªåŠ¨é…ç½®ä¸€ä¸ªè¿›ç¨‹å†…å†…åµŒçš„ Neo4j å®ä¾‹ï¼Œå½“æ‚¨çš„åº”ç”¨ç¨‹åºå…³é—­æ—¶ï¼Œè¯¥å®ä¾‹å°†ä¸ä¼šä¿ç•™ä»»ä½•æ•°æ®ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>å†…åµŒ Neo4j OGM é©±åŠ¨æœ¬èº«ä¸æä¾› Neo4j æ‚¨å¿…é¡»è‡ªå·±å£°æ˜ <code>org.neo4j:neo4j</code> ä¾èµ–ï¼Œè¯·å‚è€ƒ <a href="https://neo4j.com/docs/ogm-manual/current/reference/#reference:getting-started">Neo4j OGM æ–‡æ¡£</a> è·å–å…¼å®¹ç‰ˆæœ¬åˆ—è¡¨ã€‚</p></blockquote><p>å½“ classpath ä¸Šæœ‰å¤šä¸ªé©±åŠ¨æ—¶ï¼Œå†…åµŒé©±åŠ¨ä¼˜å…ˆäºå…¶ä»–é©±åŠ¨ã€‚æ‚¨å¯ä»¥é€šè¿‡è®¾ç½® <code>spring.data.neo4j.embedded.enabled=false</code> æ¥æ˜¾å¼ç¦ç”¨å†…åµŒæ¨¡å¼ã€‚</p><p>å¦‚æœå†…åµŒé©±åŠ¨å’Œ Neo4j å†…æ ¸å¦‚ä¸Šæ‰€è¿°ä½äº classpath ä¸Šï¼Œåˆ™ <a href="#boot-features-testing-spring-boot-applications-testing-autoconfigured-neo4j-test">Data Neo4j æµ‹è¯•</a> ä¼šè‡ªåŠ¨ä½¿ç”¨å†…åµŒ Neo4j å®ä¾‹ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>æ‚¨å¯ä»¥é€šè¿‡åœ¨é…ç½®ä¸­æä¾›æ•°æ®åº“æ–‡ä»¶è·¯å¾„æ¥ä¸ºå†…åµŒæ¨¡å¼å¯ç”¨æŒä¹…åŒ–ï¼Œä¾‹å¦‚ï¼š<code>spring.data.neo4j.uri=file://var/tmp/graph.db</code>ã€‚</p></blockquote><p><a id="boot-features-neo4j-ogm-session"></a></p><h4 id="31-3-3ã€Neo4jSession">31.3.3ã€Neo4jSession</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ‚¨æ­£åœ¨è¿è¡Œ Web åº”ç”¨ç¨‹åºï¼Œä¼šè¯ï¼ˆsessionï¼‰å°†è¢«ç»‘å®šåˆ°å½“å‰è¯·æ±‚çš„æ•´ä¸ªå¤„ç†çº¿ç¨‹ï¼ˆå³ <strong>Open Session in View</strong> æ¨¡å¼ï¼‰ã€‚å¦‚æœä¸å¸Œæœ›æ­¤è¡Œä¸ºï¼Œæ‚¨å¯ä»¥åœ¨ <code>application.properties</code> ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.data.neo4j.open-in-view</span>=<span class="literal">false</span></span><br></pre></td></tr></table></figure><p><a id="boot-features-spring-data-neo4j-repositories"></a></p><h4 id="31-3-4ã€Spring-Data-Neo4j-èµ„æºåº“">31.3.4ã€Spring Data Neo4j èµ„æºåº“</h4><p>Spring Data åŒ…æ‹¬äº†å¯¹ Neo4j èµ„æºåº“çš„æ”¯æŒã€‚</p><p>Spring Data Neo4j ä¸ Spring Data JPA å…±äº«ç›¸åŒçš„é€šç”¨åº•å±‚ä»£ç ï¼Œå› æ­¤æ‚¨å¯ä»¥ç›´æ¥æŠŠä¹‹å‰çš„ JPA ç¤ºä¾‹ä½œä¸ºåŸºç¡€ï¼Œå‡è®¾ <code>City</code> ç°åœ¨æ˜¯ä¸€ä¸ª Neo4j OGM <code>@NodeEntity</code>ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª JPA <code>@Entity</code>ï¼Œå¹¶ä¸”èµ„æºåº“æŠ½è±¡ä»¥ç›¸åŒçš„æ–¹å¼å·¥ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapp.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.neo4j.repository.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CityRepository</span> <span class="keyword">extends</span> <span class="title class_">Neo4jRepository</span>&lt;City, Long&gt; &#123;</span><br><span class="line"></span><br><span class="line">Optional&lt;City&gt; <span class="title function_">findOneByNameAndState</span><span class="params">(String name, String state)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>spring-boot-starter-data-neo4j</code> starter æ”¯æŒèµ„æºåº“å’Œäº‹åŠ¡ç®¡ç†ã€‚æ‚¨å¯ä»¥åœ¨ <code>@Configuration</code> bean ä¸Šåˆ†åˆ«ä½¿ç”¨ <code>@EnableNeo4jRepositories</code> å’Œ <code>@EntityScan</code> æ¥è‡ªå®šä¹‰ä½ç½®ä»¥æŸ¥æ‰¾èµ„æºåº“å’Œå®ä½“ã€‚</p><p><strong>æç¤º</strong></p><p>æœ‰å…³ Spring Data Neo4j çš„å®Œæ•´è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶å¯¹è±¡æ˜ å°„æŠ€æœ¯ï¼Œè¯·å‚é˜…<a href="https://projects.spring.io/spring-data-neo4j/">å‚è€ƒæ–‡æ¡£</a>ã€‚</p><p><a id="boot-features-gemfire"></a></p><h3 id="31-4ã€Gemfire">31.4ã€Gemfire</h3><p><a href="https://github.com/spring-projects/spring-data-gemfire">Spring Data Gemfire</a> æä¾›äº†ä¾¿æ·çš„ Spring æ•´åˆå·¥å…·ï¼Œç”¨äºè®¿é—® <a href="https://pivotal.io/big-data/pivotal-gemfire#details">Pivotal Gemfire</a> æ•°æ®ç®¡ç†å¹³å°ã€‚<code>spring-boot-starter-data-gemfire</code> starter åŒ…å«äº†ç›¸å…³ä¾èµ–ã€‚ç›®å‰æ²¡æœ‰é’ˆå¯¹ Gemfire çš„è‡ªåŠ¨é…ç½®æ”¯æŒï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ª<a href="https://github.com/spring-projects/spring-data-gemfire/blob/master/src/main/java/org/springframework/data/gemfire/repository/config/EnableGemfireRepositories.java">å•ç‹¬çš„æ³¨è§£ï¼ˆ@EnableGemfireRepositoriesï¼‰</a>æ¥å¯ç”¨ Spring Data èµ„æºåº“ã€‚</p><p><a id="boot-features-solr"></a></p><h3 id="31-5ã€Solr">31.5ã€Solr</h3><p><a href="https://lucene.apache.org/solr/">Apache Solr</a> æ˜¯ä¸€ä¸ªæœç´ å¼•æ“ã€‚Spring Boot ä¸º Solr 5 å®¢æˆ·ç«¯ç±»åº“æä¾›äº†åŸºæœ¬çš„è‡ªåŠ¨é…ç½®ï¼Œå¹¶ä¸” <a href="https://github.com/spring-projects/spring-data-solr">Spring Data Solr</a> ä¸ºå…¶æä¾›ç»™äº†é¡¶å±‚æŠ½è±¡ã€‚ç›¸å…³çš„ä¾èµ–åŒ…å«åœ¨äº† <code>spring-boot-starter-data-solr</code> starter ä¸­ã€‚</p><p><a id="boot-features-solr"></a></p><h4 id="31-5-1ã€è¿æ¥-Solr">31.5.1ã€è¿æ¥ Solr</h4><p>æ‚¨å¯ä»¥åƒå…¶ä»– Spring Bean ä¸€æ ·æ³¨å…¥ä¸€ä¸ªè‡ªåŠ¨é…ç½®çš„ <code>SolrClient</code> å®ä¾‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å®ä¾‹å°†å°è¯•é€šè¿‡ <a href="http://localhost:8983/solr"><code>localhost:8983/solr</code></a> è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æ³¨å…¥ä¸€ä¸ª Solr beanï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> SolrClient solr;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyBean</span><span class="params">(SolrClient solr)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.solr = solr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨æ·»åŠ äº†è‡ªå·±çš„ <code>SolrClient</code> ç±»å‹çš„ <code>@Bean</code>ï¼Œå®ƒå°†æ›¿æ¢æ‰é»˜è®¤é…ç½®ã€‚</p><p><a id="boot-features-spring-data-solr-repositories"></a></p><h4 id="31-5-2ã€Spring-Data-Solr-èµ„æºåº“">31.5.2ã€Spring Data Solr èµ„æºåº“</h4><p>Spring Data åŒ…å«äº†å¯¹ Apache Solr èµ„æºåº“çš„æ”¯æŒã€‚ä¸ä¹‹å‰è®¨è®ºçš„ JPA èµ„æºåº“ä¸€æ ·ï¼ŒåŸºæœ¬åŸç†æ˜¯æ ¹æ®æ–¹æ³•åç§°è‡ªåŠ¨æ„é€ æŸ¥è¯¢ã€‚</p><p>äº‹å®ä¸Šï¼ŒSpring Data JPA å’Œ Spring Data Solr å…±äº«äº†ç›¸åŒçš„é€šç”¨åº•å±‚ä»£ç ï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨ä¹‹å‰çš„ JPA ç¤ºä¾‹ä½œä¸ºåŸºç¡€ï¼Œå‡è®¾ <code>City</code> ç°åœ¨æ˜¯ä¸€ä¸ª <code>@SolrDocument</code> ç±»ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª JPA <code>@Entity</code>ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼ç›¸åŒã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>æœ‰å…³ Spring Data Solr çš„å®Œæ•´è¯¦ç»†å†…å®¹ï¼Œè¯·å‚è€ƒå…¶<a href="https://projects.spring.io/spring-data-solr/">å‚è€ƒæ–‡æ¡£</a>ã€‚</p></blockquote><p><a id="boot-features-elasticsearch"></a></p><h3 id="31-6ã€Elasticsearch">31.6ã€Elasticsearch</h3><p><a href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a> æ˜¯ä¸€ä¸ªå¼€æºã€åˆ†å¸ƒå¼ã€RESTful çš„å®æ—¶æœç´¢åˆ†æå¼•æ“ã€‚Spring Boot ä¸º Elasticsearch æä¾›äº†åŸºæœ¬çš„è‡ªåŠ¨é…ç½®ã€‚</p><p>Spring Boot æ”¯æŒä»¥ä¸‹ HTTP å®¢æˆ·ç«¯ï¼š</p><ul><li>å®˜æ–¹ Java <strong>Low Levelï¼ˆä½çº§ï¼‰</strong> å’Œ <strong>High Levelï¼ˆé«˜çº§ï¼‰</strong> REST å®¢æˆ·ç«¯</li><li><a href="https://github.com/searchbox-io/Jest">Jest</a></li></ul><p><a href="https://github.com/spring-projects/spring-data-elasticsearch">Spring Data Elasticsearch</a> ä¾æ—§ä½¿ç”¨ä¼ è¾“å®¢æˆ·ç«¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>spring-boot-starter-data-elasticsearch</code> starter å¼•å…¥ä½¿ç”¨å®ƒã€‚</p><p><a id="boot-features-connecting-to-elasticsearch-rest"></a></p><h4 id="31-6-1ã€ä½¿ç”¨-REST-å®¢æˆ·ç«¯è¿æ¥-Elasticsearch">31.6.1ã€ä½¿ç”¨ REST å®¢æˆ·ç«¯è¿æ¥ Elasticsearch</h4><p>Elasticsearch æä¾›äº†ä¸¤ä¸ªå¯ç”¨äºæŸ¥è¯¢é›†ç¾¤çš„ <a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/index.html">REST å®¢æˆ·ç«¯</a>ï¼š<strong>Low Levelï¼ˆä½çº§ï¼‰</strong> å’Œ <strong>High Levelï¼ˆé«˜çº§ï¼‰</strong>ã€‚</p><p>å¦‚æœæ‚¨çš„ classpath ä¸Šå­˜åœ¨ <code>org.elasticsearch.client:elasticsearch-rest-client</code> ä¾èµ–ï¼Œåˆ™ Spring Boot å°†è‡ªåŠ¨é…ç½®å¹¶æ³¨å†Œé»˜è®¤ç›®æ ‡ä¸º <a href="http://localhost:9200/"><code>localhost:9200</code></a> çš„ <code>RestClient</code> beanã€‚æ‚¨å¯ä»¥è¿›ä¸€æ­¥è°ƒæ•´ <code>RestClient</code> çš„é…ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.elasticsearch.rest.uris</span>=http://search.example.com:<span class="number">9200</span></span><br><span class="line"><span class="attr">spring.elasticsearch.rest.username</span>=user</span><br><span class="line"><span class="attr">spring.elasticsearch.rest.password</span>=secret</span><br></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥æ³¨å†Œå®ç°ä»»æ„æ•°é‡çš„ <code>RestClientBuilderCustomizer</code> beanï¼Œä»¥è¿›è¡Œæ›´é«˜çº§çš„è‡ªå®šä¹‰ã€‚è¦å®Œå…¨æ§åˆ¶æ³¨å†Œæµç¨‹ï¼Œè¯·å®šä¹‰ <code>RestClient</code> beanã€‚</p><p>å¦‚æœä½  classpath ä¸Šæœ‰ <code>org.elasticsearch.client:elasticsearch-rest-high-level-client</code> ä¾èµ–ï¼ŒSpring Boot å°†è‡ªåŠ¨é…ç½®ä¸€ä¸ª <code>RestHighLevelClient</code>ï¼Œå®ƒåŒ…è£…äº†æ‰€æœ‰ç°æœ‰çš„ <code>RestClient</code> beanï¼Œé‡ç”¨å…¶ HTTP é…ç½®ã€‚</p><p><a id="boot-features-connecting-to-elasticsearch-jest"></a></p><h4 id="31-6-2ã€ä½¿ç”¨-Jest-è¿æ¥-Elasticsearch">31.6.2ã€ä½¿ç”¨ Jest è¿æ¥ Elasticsearch</h4><p>å¦‚æœæ‚¨çš„ classpath ä¸Šå­˜åœ¨ <code>Jest</code>ï¼Œåˆ™å¯ä»¥æ³¨å…¥ä¸€ä¸ªé»˜è®¤ç›®æ ‡ä¸º <a href="http://localhost:9200/"><code>localhost:9200</code></a> çš„è‡ªåŠ¨é…ç½® <code>JestClient</code>ã€‚æ‚¨è¿˜å¯ä»¥è¿›ä¸€æ­¥è°ƒæ•´å®¢æˆ·ç«¯é…ç½®ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.elasticsearch.jest.uris</span>=http://search.example.com:<span class="number">9200</span></span><br><span class="line"><span class="attr">spring.elasticsearch.jest.read-timeout</span>=<span class="number">10000</span></span><br><span class="line"><span class="attr">spring.elasticsearch.jest.username</span>=user</span><br><span class="line"><span class="attr">spring.elasticsearch.jest.password</span>=secret</span><br></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥æ³¨å†Œä»»ä½•æ•°é‡å®ç°äº† <code>HttpClientConfigBuilderCustomizer</code> çš„ beanï¼Œä»¥è¿›è¡Œæ›´åŠ é«˜çº§çš„è‡ªå®šä¹‰ã€‚ä»¥ä¸‹ç¤ºä¾‹è°ƒæ•´äº†å…¶ä»– HTTP è®¾ç½®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">HttpSettingsCustomizer</span> <span class="keyword">implements</span> <span class="title class_">HttpClientConfigBuilderCustomizer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(HttpClientConfig.Builder builder)</span> &#123;</span><br><span class="line">        builder.maxTotalConnection(<span class="number">100</span>).defaultMaxTotalConnectionPerRoute(<span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦å®Œå…¨æ§åˆ¶æ³¨å†Œæµç¨‹ï¼Œè¯·å®šä¹‰ä¸€ä¸ª <code>JestClient</code> beanã€‚</p><p><a id="boot-features-connecting-to-elasticsearch-spring-data"></a></p><h4 id="31-6-3ã€ä½¿ç”¨-Spring-Data-è¿æ¥-Elasticsearch">31.6.3ã€ä½¿ç”¨ Spring Data è¿æ¥ Elasticsearch</h4><p>è¦è¿æ¥ Elasticsearchï¼Œæ‚¨å¿…é¡»æä¾›ä¸€ä¸ªæˆ–å¤šä¸ªç¾¤é›†èŠ‚ç‚¹çš„åœ°å€ã€‚å¯ä»¥é€šè¿‡å°† <code>spring.data.elasticsearch.cluster-nodes</code> å±æ€§è®¾ç½®ä¸ºä»¥é€—å·åˆ†éš”çš„ <code>host:port</code> åˆ—è¡¨æ¥æŒ‡å®šåœ°å€ã€‚ä½¿ç”¨æ­¤é…ç½®ï¼Œå¯ä»¥åƒå…¶ä»– Spring bean ä¸€æ ·æ³¨å…¥ <code>ElasticsearchTemplate</code> æˆ– <code>TransportClient</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ElasticsearchTemplate template;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyBean</span><span class="params">(ElasticsearchTemplate template)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.template = template;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨æ·»åŠ äº†è‡ªå·±çš„ <code>ElasticsearchTemplate</code> æˆ–è€… <code>TransportClient</code> <code>@Bean</code>ï¼Œåˆ™å…¶å°†æ›¿ä»£é»˜è®¤é…ç½®ã€‚</p><p><a id="boot-features-spring-data-elasticsearch-repositories"></a></p><h4 id="31-6-4ã€Spring-Data-Elasticsearch-èµ„æºåº“">31.6.4ã€Spring Data Elasticsearch èµ„æºåº“</h4><p>Spring Data åŒ…å«äº†å¯¹ Elasticsearch èµ„æºåº“çš„æ”¯æŒï¼Œä¸ä¹‹å‰è®¨è®ºçš„ JPA èµ„æºåº“ä¸€æ ·ï¼Œå…¶åŸç†æ˜¯æ ¹æ®æ–¹æ³•åç§°è‡ªåŠ¨æ„é€ æŸ¥è¯¢ã€‚</p><p>äº‹å®ä¸Šï¼ŒSpring Data JPA ä¸ Spring Data Elasticsearch å…±äº«äº†ç›¸åŒçš„é€šç”¨åº•å±‚ä»£ç ï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨ä¹‹å‰çš„ JPA ç¤ºä¾‹ä½œä¸ºåŸºç¡€ï¼Œå‡è®¾ <code>City</code> æ­¤æ—¶æ˜¯ä¸€ä¸ª Elasticsearch <code>@Document</code> ç±»ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª JPA <code>@Entity</code>ï¼Œå®ƒä»¥ç›¸åŒçš„æ–¹å¼å·¥ä½œã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>æœ‰å…³ Spring Data Elasticsearch çš„å®Œæ•´è¯¦ç»†å†…å®¹ï¼Œè¯·å‚é˜…å…¶<a href="https://docs.spring.io/spring-data/elasticsearch/docs/">å‚è€ƒæ–‡æ¡£</a>ã€‚</p></blockquote><p><a id="boot-features-cassandra"></a></p><h3 id="31-7ã€Cassandra">31.7ã€Cassandra</h3><p><a href="https://cassandra.apache.org/">Cassandra</a> æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œæ—¨åœ¨å¤„ç†å•†ç”¨æœåŠ¡å™¨ä¸Šçš„å¤§é‡æ•°æ®ã€‚Spring Boot ä¸º Cassandra æä¾›äº†è‡ªåŠ¨é…ç½®ï¼Œä¸” <a href="https://github.com/spring-projects/spring-data-cassandra">Spring Data Cassandra</a> ä¸ºå…¶æä¾›äº†é¡¶å±‚æŠ½è±¡ã€‚ç›¸å…³ä¾èµ–åŒ…å«åœ¨ <code>spring-boot-starter-data-cassandra</code> starter ä¸­ã€‚</p><p><a id="boot-features-connecting-to-cassandra"></a></p><h4 id="31-7-1ã€è¿æ¥-Cassandra">31.7.1ã€è¿æ¥ Cassandra</h4><p>æ‚¨å¯ä»¥åƒå…¶ä»– Spring Bean ä¸€æ ·æ³¨å…¥ä¸€ä¸ªè‡ªåŠ¨é…ç½®çš„ <code>CassandraTemplate</code> æˆ– Cassandra <code>Session</code> å®ä¾‹ã€‚<code>spring.data.cassandra.*</code> å±æ€§å¯ç”¨äºè‡ªå®šä¹‰è¿æ¥ã€‚é€šå¸¸ï¼Œæ‚¨ä¼šæä¾› <code>keyspace-name</code> å’Œ <code>contact-points </code>å±æ€§ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.data.cassandra.keyspace-name</span>=mykeyspace</span><br><span class="line"><span class="attr">spring.data.cassandra.contact-points</span>=cassandrahost1,cassandrahost2</span><br></pre></td></tr></table></figure><p>æ‚¨è¿˜å¯ä»¥æ³¨å†Œä»»æ„æ•°é‡å®ç°äº† ClusterBuilderCustomizer çš„ beanï¼Œä»¥è¿›è¡Œæ›´é«˜çº§çš„è‡ªå®šä¹‰ã€‚</p><p>ä»¥ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•æ³¨å…¥ä¸€ä¸ª Cassandra beanï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> CassandraTemplate template;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyBean</span><span class="params">(CassandraTemplate template)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.template = template;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨æ·»åŠ äº†è‡ªå·±çš„ç±»çš„ä¸º <code>@CassandraTemplate</code> çš„ <code>@Bean</code>ï¼Œåˆ™å…¶å°†æ›¿ä»£é»˜è®¤å€¼ã€‚</p><p><a id="boot-features-spring-data-cassandra-repositories"></a></p><h4 id="31-7-2ã€Spring-Data-Cassandra-èµ„æºåº“">31.7.2ã€Spring Data Cassandra èµ„æºåº“</h4><p>Spring Data åŒ…å«äº†åŸºæœ¬çš„ Cassandra èµ„æºåº“æ”¯æŒã€‚ç›®å‰ï¼Œå…¶é™åˆ¶è¦æ¯”ä¹‹å‰è®¨è®ºçš„ JPA èµ„æºåº“è¦å¤šï¼Œå¹¶ä¸”éœ€è¦åœ¨ finder æ–¹æ³•ä¸Šä½¿ç”¨ <code>@Query</code> æ³¨è§£ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>æœ‰å…³ Spring Data Cassandra çš„å®Œæ•´è¯¦ç»†å†…å®¹ï¼Œè¯·å‚é˜…å…¶<a href="https://docs.spring.io/spring-data/cassandra/docs/">å‚è€ƒæ–‡æ¡£</a>ã€‚</p></blockquote><p><a id="boot-features-couchbase"></a></p><h3 id="31-8ã€Couchbase">31.8ã€Couchbase</h3><p><a href="https://www.couchbase.com/">Couchbase</a> æ˜¯ä¸€ä¸ªå¼€æºã€åˆ†å¸ƒå¼å¤šæ¨¡å‹çš„ NoSQL é¢å‘æ–‡æ¡£æ•°æ®åº“ï¼Œå…¶é’ˆå¯¹äº¤äº’å¼åº”ç”¨ç¨‹åºåšäº†ä¼˜åŒ–ã€‚Spring Boot ä¸º Couchbase æä¾›äº†è‡ªåŠ¨é…ç½®ï¼Œä¸” <a href="https://github.com/spring-projects/spring-data-couchbase">Spring Data Couchbase</a> ä¸ºå…¶æä¾›äº†é¡¶å±‚æŠ½è±¡ã€‚ç›¸å…³çš„ä¾èµ–åŒ…å«åœ¨äº† <code>spring-boot-starter-data-couchbase</code> starter ä¸­ã€‚</p><p><a id="boot-features-connecting-to-couchbase"></a></p><h4 id="31-8-1ã€è¿æ¥-Couchbase">31.8.1ã€è¿æ¥ Couchbase</h4><p>æ‚¨å¯ä»¥é€šè¿‡æ·»åŠ  Couchbase SDK å’Œä¸€äº›é…ç½®æ¥è½»æ¾è·å– <code>Bucket</code> å’Œ <code>Cluster</code>ã€‚<code>spring.couchbase.*</code> å±æ€§å¯ç”¨äºè‡ªå®šä¹‰è¿æ¥ã€‚é€šå¸¸æ‚¨ä¼šé…ç½® bootstrap hostã€bucket name å’Œ passwordï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.couchbase.bootstrap-hosts</span>=my-host-<span class="number">1</span>,<span class="number">192.168</span>.<span class="number">1.123</span></span><br><span class="line"><span class="attr">spring.couchbase.bucket.name</span>=my-bucket</span><br><span class="line"><span class="attr">spring.couchbase.bucket.password</span>=secret</span><br></pre></td></tr></table></figure><blockquote><p>æ‚¨<strong>è‡³å°‘</strong>éœ€è¦æä¾› bootstrap hostï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œbucket name ä¸º <code>default</code> ä¸” password ä¸ºç©ºå­—ç¬¦ä¸²ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥å®šä¹‰è‡ªå·±çš„ <code>org.springframework.data.couchbase.config.CouchbaseConfigurer</code> @Bean æ¥æ§åˆ¶æ•´ä¸ªé…ç½®ã€‚</p></blockquote><p>ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸€äº› <code>CouchbaseEnvironment</code> è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹é…ç½®ä¿®æ”¹äº†æ‰“å¼€ä¸€ä¸ªæ–° <code>Bucket</code> çš„è¶…æ—¶æ—¶é—´å’Œå¼€å¯äº† SSL æ”¯æŒï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.couchbase.env.timeouts.connect</span>=<span class="number">3000</span></span><br><span class="line"><span class="attr">spring.couchbase.env.ssl.key-store</span>=/location/of/keystore.jks</span><br><span class="line"><span class="attr">spring.couchbase.env.ssl.key-store-password</span>=secret</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ <code>spring.couchbase.env.*</code> è·å–æ›´å¤šè¯¦ç»†å†…å®¹ã€‚</p><p><a id="boot-features-spring-data-couchbase-repositories"></a></p><h4 id="31-8-2ã€Spring-Data-Couchbase-èµ„æºåº“">31.8.2ã€Spring Data Couchbase èµ„æºåº“</h4><p>Spring Data åŒ…å«äº† Couchbase èµ„æºåº“æ”¯æŒã€‚æœ‰å…³ Spring Data Couchbase çš„å®Œæ•´è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å…¶<a href="https://docs.spring.io/spring-data/couchbase/docs/current/reference/html/">å‚è€ƒæ–‡æ¡£</a>ã€‚</p><p>æ‚¨å¯ä»¥åƒä½¿ç”¨å…¶ä»– Spring Bean ä¸€æ ·æ³¨å…¥è‡ªåŠ¨é…ç½®çš„ <code>CouchbaseTemplate</code> å®ä¾‹ï¼Œå‰ææ˜¯æœ‰ä¸€ä¸ªé»˜è®¤çš„<code>CouchbaseConfigurer</code>ï¼ˆå½“æ‚¨å¯ç”¨ Couchbase æ”¯æŒæ—¶ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œå¦‚ä¹‹å‰æ‰€è¿°ï¼‰ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æ³¨å…¥ä¸€ä¸ª Couchbase beanï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> CouchbaseTemplate template;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyBean</span><span class="params">(CouchbaseTemplate template)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.template = template;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥åœ¨è‡ªå·±çš„é…ç½®ä¸­å®šä¹‰ä»¥ä¸‹å‡ ä¸ª beanï¼Œä»¥è¦†ç›–è‡ªåŠ¨é…ç½®æä¾›çš„é…ç½®ï¼š</p><ul><li>ä¸€ä¸ªåä¸º <code>couchbaseTemplate</code> çš„ <code>CouchbaseTemplate</code> @Bean</li><li>ä¸€ä¸ªåä¸º <code>couchbaseIndexManager</code> çš„ <code>IndexManager</code> @Bean</li><li>ä¸€ä¸ªåä¸º <code>couchbaseCustomConversions</code> çš„ <code>CustomConversions</code> @Bean</li></ul><p>ä¸ºäº†é¿å…åœ¨è‡ªå·±çš„é…ç½®ä¸­ç¡¬ç¼–ç è¿™äº›åç§°ï¼Œæ‚¨å¯ä»¥é‡ç”¨ Spring Data Couchbase æä¾›çš„ <code>BeanNames</code>ï¼Œä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥è‡ªå®šä¹‰è½¬æ¢å™¨ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SomeConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean(BeanNames.COUCHBASE_CUSTOM_CONVERSIONS)</span></span><br><span class="line"><span class="keyword">public</span> CustomConversions <span class="title function_">myCustomConversions</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CustomConversions</span>(...);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><p>å¦‚æœæ‚¨æƒ³è¦å®‰å…¨ç»•å¼€ Spring Data Couchbase çš„è‡ªåŠ¨é…ç½®ï¼Œè¯·æä¾›è‡ªå·±çš„ <code>org.springframework.data.couchbase.config.AbstractCouchbaseDataConfiguration</code> å®ç°ã€‚</p><p><a id="boot-features-ldap"></a></p><h3 id="31-9ã€LDAP">31.9ã€LDAP</h3><p><a href="https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol">LDAP</a>ï¼ˆLightweight Directory Access Protocolï¼Œè½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼‰æ˜¯ä¸€ä¸ªå¼€æ”¾ã€å‚å•†ä¸­ç«‹çš„è¡Œä¸šæ ‡å‡†åº”ç”¨åè®®ï¼Œå…¶é€šè¿‡ IP ç½‘ç»œè®¿é—®å’Œç»´æŠ¤åˆ†å¸ƒå¼ç›®å½•ä¿¡æ¯æœåŠ¡ã€‚Spring Boot ä¸ºå…¼å®¹ LDAP æœåŠ¡å™¨æä¾›äº†è‡ªåŠ¨é…ç½®ï¼Œä»¥åŠæ”¯æŒä» <a href="https://www.ldap.com/unboundid-ldap-sdk-for-java">UnboundID</a> å†…åµŒå†…å­˜å¼ LDAP æœåŠ¡å™¨ã€‚</p><p><a href="https://github.com/spring-projects/spring-data-ldap">Spring Data LDAP</a> æä¾›äº† LDAP æŠ½è±¡ã€‚ç›¸å…³ä¾èµ–åŒ…å«åœ¨äº† <code>spring-boot-starter-data-ldap</code> starter ä¸­ã€‚</p><p><a id="boot-features-ldap-connecting"></a></p><h4 id="31-9-1ã€è¿æ¥-LDAP-æœåŠ¡å™¨">31.9.1ã€è¿æ¥ LDAP æœåŠ¡å™¨</h4><p>è¦è¿æ¥ LDAP æœåŠ¡å™¨ï¼Œè¯·ç¡®ä¿æ‚¨å·²ç»å£°æ˜äº† <code>spring-boot-starter-data-ldap</code> starter æˆ–è€… <code>spring-ldap-core</code> ä¾èµ–ï¼Œç„¶ååœ¨ <code>application.properties</code> å£°æ˜æœåŠ¡å™¨çš„ URLï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.ldap.urls</span>=ldap://myserver:<span class="number">1235</span></span><br><span class="line"><span class="attr">spring.ldap.username</span>=admin</span><br><span class="line"><span class="attr">spring.ldap.password</span>=secret</span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦è‡ªå®šä¹‰è¿æ¥è®¾ç½®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>spring.ldap.base</code> å’Œ <code>spring.ldap.base-environment</code> å±æ€§ã€‚</p><p><code>LdapContextSource</code> å°†æ ¹æ®è¿™äº›è®¾ç½®è‡ªåŠ¨é…ç½®ã€‚å¦‚æœæ‚¨éœ€è¦è‡ªå®šä¹‰å®ƒï¼Œä¾‹å¦‚ä½¿ç”¨ä¸€ä¸ª <code>PooledContextSource</code>ï¼Œåˆ™ä»ç„¶å¯ä»¥æ³¨å…¥è‡ªåŠ¨é…ç½®çš„ <code>LdapContextSource</code>ã€‚ç¡®ä¿å°†è‡ªå®šä¹‰çš„ <code>ContextSource</code> æ ‡è®°ä¸º <code>@Primary</code>ï¼Œä»¥ä¾¿è‡ªåŠ¨é…ç½®çš„ <code>LdapTemplate</code> èƒ½ä½¿ç”¨å®ƒã€‚</p><p><a id="boot-features-ldap-spring-data-repositories"></a></p><h4 id="31-9-2ã€Spring-Data-LDAP-èµ„æºåº“">31.9.2ã€Spring Data LDAP èµ„æºåº“</h4><p>Spring Data åŒ…å«äº† LDAP èµ„æºåº“æ”¯æŒã€‚æœ‰å…³ Spring Data LDAP çš„å®Œæ•´è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å…¶<a href="https://docs.spring.io/spring-data/ldap/docs/1.0.x/reference/html/">å‚è€ƒæ–‡æ¡£</a>ã€‚</p><p>æ‚¨è¿˜å¯ä»¥åƒå…¶ä»– Spring Bean ä¸€æ ·æ³¨å…¥ä¸€ä¸ªè‡ªåŠ¨é…ç½®çš„ <code>LdapTemplate</code> å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> LdapTemplate template;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyBean</span><span class="params">(LdapTemplate template)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.template = template;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="boot-features-ldap-embedded"></a></p><h4 id="31-9-3ã€å†…åµŒå†…å­˜å¼-LDAP-æœåŠ¡å™¨">31.9.3ã€å†…åµŒå†…å­˜å¼ LDAP æœåŠ¡å™¨</h4><p>ä¸ºäº†æµ‹è¯•ç›®çš„ï¼ŒSpring Boot æ”¯æŒä» <a href="https://www.ldap.com/unboundid-ldap-sdk-for-java">UnboundID</a> è‡ªåŠ¨é…ç½®ä¸€ä¸ªå†…å­˜å¼ LDAP æœåŠ¡å™¨ã€‚è¦é…ç½®æœåŠ¡å™¨ï¼Œè¯·æ·»åŠ  <code>com.unboundid:unboundid-ldapsdk</code> ä¾èµ–å¹¶å£°æ˜ä¸€ä¸ª <code>base-dn</code> å±æ€§ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.ldap.embedded.base-dn</span>=dc=spring,dc=io</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>å¯ä»¥å®šä¹‰å¤šä¸ª <code>base-dn</code> å€¼ï¼Œä½†æ˜¯ï¼Œç”±äºåç§°åŒ…å«é€—å·ï¼Œå­˜åœ¨æ­§ä¹‰ï¼Œå› æ­¤å¿…é¡»ä½¿ç”¨æ­£ç¡®çš„ç¬¦å·æ¥å®šä¹‰å®ƒä»¬ã€‚</p><p>åœ¨ yaml æ–‡ä»¶ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ yaml åˆ—è¡¨è¡¨ç¤ºæ³•ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.ldap.embedded.base-dn:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">dc=spring,dc=io</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">dc=pivotal,dc=io</span></span><br></pre></td></tr></table></figure><p>åœ¨å±æ€§æ–‡ä»¶ä¸­ï¼Œå¿…é¡»ä½¿ç”¨ç´¢å¼•æ–¹å¼ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.ldap.embedded.base-dn<span class="section">[0]</span>=<span class="attr">dc</span>=spring,dc=io</span><br><span class="line">spring.ldap.embedded.base-dn<span class="section">[1]</span>=<span class="attr">dc</span>=pivotal,dc=io</span><br></pre></td></tr></table></figure></blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å°†åœ¨ä¸€ä¸ªéšæœºç«¯å£ä¸Šå¯åŠ¨ï¼Œå¹¶è§¦å‘å¸¸è§„çš„ LDAP æ”¯æŒï¼ˆä¸éœ€è¦æŒ‡å®š <code>spring.ldap.urls</code> å±æ€§ï¼‰ã€‚</p><p>å¦‚æœæ‚¨çš„ classpath ä¸Šå­˜åœ¨ä¸€ä¸ª <code>schema.ldif</code> æ–‡ä»¶ï¼Œå…¶å°†ç”¨äºåˆå§‹åŒ–æœåŠ¡å™¨ã€‚å¦‚æœæ‚¨æƒ³ä»ä¸åŒçš„èµ„æºä¸­åŠ è½½è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ <code>spring.ldap.embedded.ldif</code> å±æ€§ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†ä½¿ç”¨ä¸€ä¸ªæ ‡å‡†æ¨¡å¼ï¼ˆschemaï¼‰æ¥æ ¡éªŒ <code>LDIF</code> æ–‡ä»¶ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ <code>spring.ldap.embedded.validation.enabled</code> å±æ€§æ¥å…³é—­æ‰€æœ‰æ ¡éªŒã€‚å¦‚æœæ‚¨æœ‰è‡ªå®šä¹‰çš„å±æ€§ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code>spring.ldap.embedded.validation.schema</code> æ¥å®šä¹‰è‡ªå®šä¹‰å±æ€§ç±»å‹æˆ–è€…å¯¹è±¡ç±»ã€‚</p><p><a id="boot-features-influxdb"></a></p><h3 id="31-10ã€InfluxDB">31.10ã€InfluxDB</h3><p><a href="https://www.influxdata.com/">InfluxDB</a> æ˜¯ä¸€ä¸ªå¼€æºæ—¶åˆ—æ•°æ®åº“ï¼Œå…¶é’ˆå¯¹è¿è¥ç›‘æ§ã€åº”ç”¨ç¨‹åºæŒ‡æ ‡ã€ç‰©è”ç½‘ä¼ æ„Ÿå™¨æ•°æ®å’Œå®æ—¶åˆ†æç­‰é¢†åŸŸä¸­çš„æ—¶é—´åºåˆ—æ•°æ®åœ¨é€Ÿåº¦ã€é«˜å¯ç”¨å­˜å‚¨å’Œæ£€ç´¢æ–¹é¢è¿›è¡Œäº†ä¼˜åŒ–ã€‚</p><p><a id="boot-features-connecting-to-influxdb"></a></p><h4 id="31-10-1ã€è¿æ¥-InfluxDB">31.10.1ã€è¿æ¥ InfluxDB</h4><p>Spring Boot è‡ªåŠ¨é…ç½® <code>InfluxDB</code> å®ä¾‹ï¼Œå‰ææ˜¯ <code>Influxdb-java</code> å®¢æˆ·ç«¯åœ¨ classpath ä¸Šå¹¶ä¸”è®¾ç½®äº†æ•°æ®åº“çš„ URLï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.influx.url</span>=HTTP://<span class="number">172.0</span>.<span class="number">0.1</span>:<span class="number">8086</span></span><br></pre></td></tr></table></figure><p>å¦‚æœä¸ InfluxDB çš„è¿æ¥éœ€è¦ç”¨æˆ·å’Œå¯†ç ï¼Œåˆ™å¯ä»¥ç›¸åº”åœ°è®¾ç½® <code>spring.influx.user</code> å’Œ <code>spring.influx.password</code> å±æ€§ã€‚</p><p>InfluxDB ä¾èµ–äº OkHttpã€‚å¦‚æœä½ éœ€è¦è°ƒæ•´ <code>InfluxDB</code> åœ¨åº•å±‚ä½¿ç”¨çš„ http å®¢æˆ·ç«¯ï¼Œåˆ™å¯ä»¥æ³¨å†Œä¸€ä¸ª <code>InfluxDbOkHttpClientBuilderProvider</code> beanã€‚</p><p><a id="boot-features-caching"></a></p><h2 id="32ã€ç¼“å­˜">32ã€ç¼“å­˜</h2><p>Spring Framework æ”¯æŒä»¥é€æ˜çš„æ–¹å¼å‘åº”ç”¨ç¨‹åºæ·»åŠ ç¼“å­˜ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼Œå°†ç¼“å­˜åº”ç”¨äºæ–¹æ³•ä¸Šï¼Œæ ¹æ®ç¼“å­˜æ•°æ®å‡å°‘æ–¹æ³•çš„æ‰§è¡Œæ¬¡æ•°ã€‚ç¼“å­˜é€»è¾‘æ˜¯é€æ˜çš„ï¼Œä¸ä¼šå¯¹è°ƒç”¨è€…é€ æˆä»»ä½•å¹²æ‰°ã€‚é€šè¿‡ <code>@EnableCaching</code> æ³¨è§£å¯ç”¨ç¼“å­˜æ”¯æŒï¼ŒSpring Boot å°±ä¼šè‡ªåŠ¨é…ç½®ç¼“å­˜è®¾ç½®ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ Spring Framework å‚è€ƒæ–‡æ¡£çš„<a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/integration.html#cache">ç›¸å…³éƒ¨åˆ†</a>ã€‚</p></blockquote><p>ç®€è€Œè¨€ä¹‹ï¼Œä¸ºæœåŠ¡æ·»åŠ ç¼“å­˜çš„æ“ä½œå°±åƒåœ¨å…¶æ–¹æ³•ä¸­æ·»åŠ æ³¨è§£ä¸€æ ·ç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MathService</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Cacheable(&quot;piDecimals&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">computePiDecimal</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨ä»£ä»·å¯èƒ½é«˜æ˜‚çš„æ“ä½œä¸Šä½¿ç”¨ç¼“å­˜ã€‚åœ¨è°ƒç”¨ <code>computePiDecimal</code> ä¹‹å‰ï¼Œç¼“å­˜æ”¯æŒä¼šåœ¨ <code>piDecimals</code> ç¼“å­˜ä¸­æŸ¥æ‰¾ä¸ <code>i</code> å‚æ•°åŒ¹é…çš„é¡¹ã€‚å¦‚æœæ‰¾åˆ°ï¼Œåˆ™ç¼“å­˜ä¸­çš„å†…å®¹ä¼šç«‹å³è¿”å›ç»™è°ƒç”¨è€…ï¼Œå¹¶ä¸ä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚å¦åˆ™ï¼Œå°†è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå¹¶åœ¨è¿”å›å€¼ä¹‹å‰æ›´æ–°ç¼“å­˜ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨æ ‡å‡† JSR-107ï¼ˆJCacheï¼‰æ³¨è§£ï¼ˆä¾‹å¦‚ <code>@CacheResult</code>ï¼‰ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨<strong>ä¸è¦</strong>å°† Spring Cache å’Œ JCache æ³¨è§£æ··åˆä½¿ç”¨ã€‚</p></blockquote><p>å¦‚æœæ‚¨ä¸æ·»åŠ ä»»ä½•æŒ‡å®šçš„ç¼“å­˜åº“ï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½®ä¸€ä¸ªä½¿ç”¨å¹¶å‘ map çš„ <a href="#boot-features-caching-provider-simple">simple provider</a>ã€‚å½“éœ€è¦ç¼“å­˜æ—¶ï¼ˆä¾‹å¦‚å‰é¢ç¤ºä¾‹ä¸­çš„ <code>piDecimals</code>ï¼‰ï¼Œè¯¥ simple provider ä¼šä¸ºæ‚¨åˆ›å»ºç¼“å­˜ã€‚ä¸æ¨èå°† simple provider ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œä½†å®ƒéå¸¸é€‚åˆå…¥é—¨å¹¶å¸®åŠ©æ‚¨äº†è§£è¿™äº›åŠŸèƒ½ã€‚å½“æ‚¨å†³å®šä½¿ç”¨ç¼“å­˜æä¾›è€…æ—¶ï¼Œè¯·åŠ¡å¿…é˜…è¯»å…¶æ–‡æ¡£ä»¥äº†è§£å¦‚ä½•é…ç½®åº”ç”¨ç¨‹åºã€‚å‡ ä¹æ‰€æœ‰æä¾›è€…éƒ½è¦æ±‚æ‚¨æ˜¾å¼é…ç½®åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çš„æ¯ä¸ªç¼“å­˜ã€‚æœ‰äº›æä¾›äº†è‡ªå®šä¹‰ <code>spring.cache.cache-names</code> å±æ€§ä»¥å®šä¹‰é»˜è®¤ç¼“å­˜ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>è¿˜å¯ä»¥é€æ˜åœ°<a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/integration.html#cache-annotations-put">æ›´æ–°</a>æˆ–<a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/integration.html#cache-annotations-evict">å›æ”¶</a>ç¼“å­˜ä¸­çš„æ•°æ®ã€‚</p></blockquote><p><a id="boot-features-caching-provider"></a></p><h3 id="32-1ã€æ”¯æŒçš„ç¼“å­˜æä¾›è€…">32.1ã€æ”¯æŒçš„ç¼“å­˜æä¾›è€…</h3><p>ç¼“å­˜æŠ½è±¡ä¸æä¾›å­˜å‚¨å®ç°ï¼Œå…¶ä¾èµ–äº <code>org.springframework.cache.Cache</code> å’Œ <code>org.springframework.cache.CacheManager</code> æ¥å£å®ç°çš„æŠ½è±¡ã€‚</p><p>å¦‚æœæ‚¨æœªå®šä¹‰ <code>CacheManager</code> ç±»å‹çš„ bean æˆ–åä¸º <code>cacheResolver</code> çš„ <code>CacheResolver</code>ï¼ˆè¯·å‚é˜… <a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/javadoc-api/org/springframework/cache/annotation/CachingConfigurer.html"><code>CachingConfigurer</code></a>ï¼‰ï¼Œåˆ™ Spring Boot ä¼šå°è¯•æ£€æµ‹ä»¥ä¸‹æä¾›è€…ï¼ˆæŒ‰åºå·é¡ºåºï¼‰ï¼š</p><ol><li><a href="#boot-features-caching-provider-generic">Generic</a></li><li><a href="#boot-features-caching-provider-jcache">JCache (JSR-107)</a>(EhCache 3ã€Hazelcastã€Infinispan æˆ–å…¶ä»–)</li><li><a href="#boot-features-caching-provider-ehcache2">EhCache 2.x</a></li><li><a href="#boot-features-caching-provider-hazelcast">Hazelcast</a></li><li><a href="#boot-features-caching-provider-infinispan">Infinispan</a></li><li><a href="#boot-features-caching-provider-couchbase">Couchbase</a></li><li><a href="#boot-features-caching-provider-redis">Redis</a><br>8 <a href="#boot-features-caching-provider-caffeine">Caffeine</a></li><li><a href="#boot-features-caching-provider-simple">Simple</a></li></ol><p><strong>æç¤º</strong></p><blockquote><p>ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½® <code>spring.cache.type</code> å±æ€§æ¥å¼ºåˆ¶æŒ‡å®šç¼“å­˜æä¾›è€…ã€‚å¦‚æœæ‚¨éœ€è¦åœ¨æŸäº›ç¯å¢ƒï¼ˆæ¯”å¦‚æµ‹è¯•ï¼‰ä¸­<a href="#boot-features-caching-provider-none">å®Œå…¨ç¦ç”¨ç¼“å­˜</a>ï¼Œè¯·ä½¿ç”¨æ­¤å±æ€§ã€‚</p></blockquote><p><strong>æç¤º</strong></p><blockquote><p>ä½¿ç”¨ <code>spring-boot-starter-cache</code> starter å¿«é€Ÿæ·»åŠ åŸºæœ¬çš„ç¼“å­˜ä¾èµ–ã€‚starter å¼•å…¥äº† <code>spring-context-support</code>ã€‚å¦‚æœæ‰‹åŠ¨æ·»åŠ ä¾èµ–ï¼Œåˆ™å¿…é¡»åŒ…å« <code>spring-context-support</code> æ‰èƒ½ä½¿ç”¨ JCacheã€EhCache 2.x æˆ– Guava æ”¯æŒã€‚</p></blockquote><p>å¦‚æœé€šè¿‡ Spring Boot è‡ªåŠ¨é…ç½® <code>CacheManager</code>ï¼Œåˆ™å¯ä»¥é€šè¿‡æš´éœ²ä¸€ä¸ªå®ç°äº† <code>CacheManagerCustomizer</code> æ¥å£çš„ beanï¼Œåœ¨å®Œå…¨åˆå§‹åŒ–ä¹‹å‰è¿›ä¸€æ­¥è°ƒæ•´å…¶é…ç½®ã€‚ä»¥ä¸‹ç¤ºä¾‹è®¾ç½®äº†ä¸€ä¸ª flagï¼Œè¡¨ç¤ºåº”å°† null å€¼ä¼ é€’ç»™åº•å±‚ mapï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> CacheManagerCustomizer&lt;ConcurrentMapCacheManager&gt; <span class="title function_">cacheManagerCustomizer</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CacheManagerCustomizer</span>&lt;ConcurrentMapCacheManager&gt;() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(ConcurrentMapCacheManager cacheManager)</span> &#123;</span><br><span class="line">cacheManager.setAllowNullValues(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>åœ¨å‰é¢ç¤ºä¾‹ä¸­ï¼Œéœ€è¦ä¸€ä¸ªè‡ªåŠ¨é…ç½®çš„ <code>ConcurrentMapCacheManager</code>ã€‚å¦‚æœä¸æ˜¯è¿™ç§æƒ…å†µï¼ˆæ‚¨æä¾›äº†è‡ªå·±çš„é…ç½®æˆ–è‡ªåŠ¨é…ç½®äº†ä¸åŒçš„ç¼“å­˜æä¾›è€…ï¼‰ï¼Œåˆ™æ ¹æœ¬ä¸ä¼šè°ƒç”¨ customizerã€‚æ‚¨å¯ä»¥æ‹¥æœ‰å¤šä¸ª customizerï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>@Order</code> æˆ– <code>Ordered</code> æ¥æ’åºå®ƒä»¬ã€‚</p></blockquote><p><a id="boot-features-caching-provider-generic"></a></p><h4 id="32-1-1ã€Generic">32.1.1ã€Generic</h4><p>å¦‚æœä¸Šä¸‹æ–‡å®šä¹‰äº†<strong>è‡³å°‘</strong>ä¸€ä¸ª <code>org.springframework.cache.Cache</code> beanï¼Œåˆ™ä½¿ç”¨ Generic ç¼“å­˜ã€‚å°†åˆ›å»ºä¸€ä¸ªåŒ…è£…æ‰€æœ‰è¯¥ç±»å‹ bean çš„ <code>CacheManager</code>ã€‚</p><p><a id="boot-features-caching-provider-jcache"></a></p><h4 id="32-1-2ã€JCache-JSR-107">32.1.2ã€JCache (JSR-107)</h4><p><a href="https://jcp.org/en/jsr/detail?id=107">JCache</a> é€šè¿‡ classpath ä¸Šçš„ <code>javax.cache.spi.CachingProvider</code>ï¼ˆå³ classpath ä¸Šå­˜åœ¨ç¬¦åˆ JSR-107 çš„ç¼“å­˜åº“ï¼‰æ¥å¼•å¯¼ï¼Œ<code>jCacheCacheManager</code> ç”± <code>spring-boot-starter-cache</code> starter æä¾›ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å„ç§å…¼å®¹åº“ï¼ŒSpring Boot ä¸º Ehcache 3ã€Hazelcast å’Œ Infinispan æä¾›ä¾èµ–ç®¡ç†ã€‚æ‚¨è¿˜å¯ä»¥æ·»åŠ ä»»ä½•å…¶ä»–å…¼å®¹åº“ã€‚</p><p>å¯èƒ½å­˜åœ¨å¤šä¸ªæä¾›è€…ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å¿…é¡»æ˜ç¡®æŒ‡å®šæä¾›è€…ã€‚å³ä½¿ JSR-107 æ ‡å‡†æ²¡æœ‰å¼ºåˆ¶è§„å®šä¸€ä¸ªå®šä¹‰é…ç½®æ–‡ä»¶ä½ç½®çš„æ ‡å‡†åŒ–æ–¹æ³•ï¼ŒSpring Boot ä¹Ÿä¼šå°½å…¶æ‰€èƒ½è®¾ç½®ä¸€ä¸ªåŒ…å«å®ç°ç»†èŠ‚çš„ç¼“å­˜ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å­˜åœ¨å¤šä¸ª provider æ‰éœ€è¦è¿™æ ·åš</span></span><br><span class="line"><span class="attr">spring.cache.jcache.provider</span>=com.acme.MyCachingProvider</span><br><span class="line"><span class="attr">spring.cache.jcache.config</span>=classpath:acme.xml</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>å½“ç¼“å­˜åº“åŒæ—¶æä¾›åŸç”Ÿå®ç°å’Œ JSR-107 æ”¯æŒæ—¶ï¼ŒSpring Boot æ›´å€¾å‘ JSR-107 æ”¯æŒï¼Œå› æ­¤å½“æ‚¨åˆ‡æ¢åˆ°ä¸åŒçš„ JSR-107 å®ç°æ—¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç›¸åŒçš„åŠŸèƒ½ã€‚</p></blockquote><p><strong>æç¤º</strong></p><blockquote><p>Spring Boot å¯¹ <a href="#boot-features-hazelcast">Hazelcast</a> çš„æ”¯æŒä¸€èˆ¬ã€‚å¦‚æœæœ‰ä¸€ä¸ª <code>HazelcastInstance</code> å¯ç”¨ï¼Œå®ƒä¹Ÿä¼šè‡ªåŠ¨ä¸º <code>CacheManager</code> å¤ç”¨ï¼Œé™¤éæŒ‡å®šäº† <code>spring.cache.jcache.config</code> å±æ€§ã€‚</p></blockquote><p>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è‡ªå®šä¹‰åº•å±‚çš„ <code>javax.cache.cacheManager</code>ï¼š</p><ul><li>å¯ä»¥é€šè¿‡è®¾ç½® <code>spring.cache.cache-names</code> å±æ€§åœ¨å¯åŠ¨æ—¶åˆ›å»ºç¼“å­˜ã€‚å¦‚æœå®šä¹‰äº†è‡ªå®šä¹‰ <code>javax.cache.configuration.Configuration</code> beanï¼Œåˆ™ä¼šä½¿ç”¨å®ƒæ¥è‡ªå®šä¹‰ã€‚</li><li>ä½¿ç”¨ <code>CacheManager</code> çš„å¼•ç”¨è°ƒç”¨ <code>org.springframework.boot.autoconfigure.cache.JCacheManagerCustomizer</code> bean ä»¥è¿›è¡Œå®Œå…¨è‡ªå®šä¹‰ã€‚</li></ul><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœå®šä¹‰äº†ä¸€ä¸ªæ ‡å‡†çš„ <code>javax.cache.CacheManager</code> beanï¼Œå®ƒå°†è‡ªåŠ¨åŒ…è£…è¿›ä¸€ä¸ªæŠ½è±¡æ‰€éœ€çš„ <code>org.springframework.cache.CacheManager</code> å®ç°ä¸­ï¼Œè€Œä¸ä¼šåº”ç”¨è‡ªå®šä¹‰é…ç½®ã€‚</p></blockquote><p><a id="boot-features-caching-provider-ehcache2"></a></p><h4 id="32-1-3ã€EhCache-2-x">32.1.3ã€EhCache 2.x</h4><p>å¦‚æœå¯ä»¥åœ¨ classpath çš„æ ¹ç›®å½•ä¸­æ‰¾åˆ°åä¸º <code>ehcache.xml</code> çš„æ–‡ä»¶ï¼Œåˆ™ä½¿ç”¨ EhCache 2.xã€‚å¦‚æœæ‰¾åˆ° EhCache 2.xï¼Œåˆ™ä½¿ç”¨ <code>spring-boot-starter-cache</code> starter æä¾›çš„ <code>EhCacheCacheManager</code> æ¥å¯åŠ¨ç¼“å­˜ç®¡ç†å™¨ã€‚è¿˜å¯ä»¥æä¾›å…¶ä»–é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cache.ehcache.config</span>=classpath:config/another-config.xml</span><br></pre></td></tr></table></figure><p><a id="boot-features-caching-provider-hazelcast"></a></p><h4 id="32-1-4ã€Hazelcast">32.1.4ã€Hazelcast</h4><p>Spring Boot å¯¹ <a href="#boot-features-hazelcast">Hazelcast</a> çš„æ”¯æŒä¸€èˆ¬ã€‚å¦‚æœè‡ªåŠ¨é…ç½®äº†ä¸€ä¸ª <code>HazelcastInstance</code>ï¼Œå®ƒå°†è‡ªåŠ¨åŒ…è£…è¿› <code>CacheManager</code> ä¸­ã€‚</p><p><a id="boot-features-caching-provider-infinispan"></a></p><h4 id="32-1-5ã€Infinispan">32.1.5ã€Infinispan</h4><p><a href="http://infinispan.org/">Infinispan</a> æ²¡æœ‰é»˜è®¤çš„é…ç½®æ–‡ä»¶ä½ç½®ï¼Œå› æ­¤å¿…é¡»æ˜ç¡®æŒ‡å®šã€‚å¦åˆ™å°†ä½¿ç”¨é»˜è®¤é…ç½®å¼•å¯¼ã€‚</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cache.infinispan.config</span>=infinispan.xml</span><br></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡è®¾ç½® <code>spring.cache.cache-names</code> å±æ€§åœ¨å¯åŠ¨æ—¶åˆ›å»ºç¼“å­˜ã€‚å¦‚æœå®šä¹‰äº†è‡ªå®šä¹‰ <code>ConfigurationBuilder</code> beanï¼Œåˆ™å®ƒå°†ç”¨äºè‡ªå®šä¹‰ç¼“å­˜ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>Infinispan åœ¨ Spring Boot ä¸­çš„æ”¯æŒä»…é™äºå†…åµŒæ¨¡å¼ï¼Œéå¸¸ç®€å•ã€‚å¦‚æœä½ æƒ³è¦æ›´å¤šé€‰é¡¹ï¼Œä½ åº”è¯¥ä½¿ç”¨å®˜æ–¹çš„ Infinispan Spring Boot starterã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://github.com/infinispan/infinispan-spring-boot">Infinispan æ–‡æ¡£</a>ã€‚</p></blockquote><p><a id="boot-features-caching-provider-couchbase"></a></p><h4 id="32-1-6ã€Couchbase">32.1.6ã€Couchbase</h4><p>å¦‚æœ <a href="https://www.couchbase.com/">Couchbase</a> Java å®¢æˆ·ç«¯å’Œ <code>couchbase-spring-cache</code> å®ç°å¯ç”¨ä¸”å·²ç»<a href="#boot-features-couchbase">é…ç½®</a>äº† Couchbaseï¼Œåˆ™åº”ç”¨ç¨‹åºä¼šè‡ªåŠ¨é…ç½®ä¸€ä¸ª <code> CouchbaseCacheManager</code>ã€‚ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½® <code>spring.cache.cache-names</code> å±æ€§åœ¨å¯åŠ¨æ—¶åˆ›å»ºå…¶ä»–ç¼“å­˜ã€‚è¿™äº›ç¼“å­˜åœ¨è‡ªåŠ¨é…ç½®çš„ Bucket ä¸Šæ“ä½œã€‚æ‚¨<strong>è¿˜</strong>å¯ä»¥ä½¿ç”¨ customizer åœ¨å…¶ä»– <code>Bucket</code> ä¸Šåˆ›å»ºç¼“å­˜ã€‚å‡è®¾æ‚¨éœ€è¦åœ¨ <strong>main</strong> <code>Bucket</code> ä¸Šæœ‰ä¸¤ä¸ªç¼“å­˜ï¼ˆ<code>cache1</code> å’Œ <code>cache2</code>ï¼‰ï¼Œå¹¶ä¸” <strong>another</strong> <code>Bucket</code> æœ‰ä¸€ä¸ªè¿‡æœŸæ—¶é—´ä¸º 2 ç§’çš„ç¼“å­˜ï¼ˆ<code>cache3</code>ï¼‰ã€‚æ‚¨å¯ä»¥é€šè¿‡é…ç½®åˆ›å»ºè¿™ä¸¤ä¸ªç¼“å­˜ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cache.cache-names</span>=cache1,cache2</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæ‚¨å¯ä»¥å®šä¹‰ä¸€ä¸ª <code>@Configuration</code> ç±»æ¥é…ç½®å…¶ä»– <code>Bucket</code> å’Œ <code>cache3</code> ç¼“å­˜ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CouchbaseCacheConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Cluster cluster;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">CouchbaseCacheConfiguration</span><span class="params">(Cluster cluster)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.cluster = cluster;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Bucket <span class="title function_">anotherBucket</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.cluster.openBucket(<span class="string">&quot;another&quot;</span>, <span class="string">&quot;secret&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> CacheManagerCustomizer&lt;CouchbaseCacheManager&gt; <span class="title function_">cacheManagerCustomizer</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> c -&gt; &#123;</span><br><span class="line">c.prepareCache(<span class="string">&quot;cache3&quot;</span>, CacheBuilder.newInstance(anotherBucket())</span><br><span class="line">.withExpiration(<span class="number">2</span>));</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤ç¤ºä¾‹é…ç½®å¤ç”¨äº†é€šè¿‡è‡ªåŠ¨é…ç½®åˆ›å»ºçš„ <code>Cluster</code>ã€‚</p><p><a id="boot-features-caching-provider-redis"></a></p><h4 id="32-1-7ã€Redis">32.1.7ã€Redis</h4><p>å¦‚æœ <a href="http://redis.io/">Redis</a> å¯ç”¨å¹¶å·²ç»é…ç½®ï¼Œåˆ™åº”ç”¨ç¨‹åºä¼šè‡ªåŠ¨é…ç½®ä¸€ä¸ª <code>RedisCacheManager</code>ã€‚é€šè¿‡è®¾ç½® <code>spring.cache.cache-names</code> å±æ€§å¯ä»¥åœ¨å¯åŠ¨æ—¶åˆ›å»ºå…¶ä»–ç¼“å­˜ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ <code>spring.cache.redis.*</code> å±æ€§é…ç½®ç¼“å­˜é»˜è®¤å€¼ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹é…ç½®åˆ›å»º <code>cache1</code> å’Œ <code>cache2</code> ç¼“å­˜ï¼Œä»–ä»¬çš„<strong>æœ‰æ•ˆæ—¶é—´</strong>ä¸º 10 åˆ†é’Ÿï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cache.cache-names</span>=cache1,cache2</span><br><span class="line"><span class="attr">spring.cache.redis.time-to-live</span>=<span class="number">600000</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šæ·»åŠ ä¸€ä¸ª key å‰ç¼€ï¼Œè¿™æ ·åšæ˜¯å› ä¸ºå¦‚æœä¸¤ä¸ªå•ç‹¬çš„ç¼“å­˜ä½¿ç”¨äº†ç›¸åŒçš„é”®ï¼ŒRedis ä¸æ”¯æŒé‡å  keyï¼Œè€Œç¼“å­˜ä¹Ÿä¸èƒ½è¿”å›æ— æ•ˆå€¼ã€‚å¦‚æœæ‚¨åˆ›å»ºè‡ªå·±çš„ <code>RedisCacheManager</code>ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨å¯ç”¨æ­¤è®¾ç½®ã€‚</p></blockquote><p><strong>æç¤º</strong></p><blockquote><p>æ‚¨å¯ä»¥é€šè¿‡æ·»åŠ è‡ªå·±çš„ <code>RedisCacheConfiguration</code> <code>@Bean</code> æ¥å®Œå…¨æ§åˆ¶é…ç½®ã€‚å¦‚æœæ‚¨æƒ³è‡ªå®šä¹‰åºåˆ—åŒ–ç­–ç•¥ï¼Œè¿™ç§æ–¹å¼å¯èƒ½å¾ˆæœ‰ç”¨ã€‚</p></blockquote><p><a id="boot-features-caching-provider-caffeine"></a></p><h4 id="32-1-8ã€Caffeine">32.1.8ã€Caffeine</h4><p><a href="https://github.com/ben-manes/caffeine">Caffeine</a> æ˜¯ä¸€ä¸ªä½¿ç”¨äº† Java 8 é‡å†™ Guava ç¼“å­˜ï¼Œç”¨äºå–ä»£ Guava æ”¯æŒçš„ç¼“å­˜åº“ã€‚å¦‚æœ Caffeine å­˜åœ¨ï¼Œåˆ™åº”ç”¨ç¨‹åºä¼šè‡ªåŠ¨é…ç½®ä¸€ä¸ª <code>CaffeineCacheManager</code>ï¼ˆç”± <code>spring-boot-starter-cache</code> starter æä¾›ï¼‰ã€‚å¯ä»¥é€šè¿‡è®¾ç½® <code>spring.cache.cache-names</code> å±æ€§åœ¨å¯åŠ¨æ—¶åˆ›å»ºç¼“å­˜ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¹‹ä¸€ï¼ˆæŒ‰åºå·é¡ºåºï¼‰è‡ªå®šä¹‰ç¼“å­˜ï¼š</p><ol><li>ä¸€ä¸ªç”± <code>spring.cache.caffeine.spec</code> å®šä¹‰çš„ç¼“å­˜è§„èŒƒ</li><li>ä¸€ä¸ªå·²å®šä¹‰çš„ <code>com.github.benmanes.caffeine.cache.CaffeineSpec</code> bean</li><li>ä¸€ä¸ªå·²å®šä¹‰çš„ <code>com.github.benmanes.caffeine.cache.Caffeine</code> bean</li></ol><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹é…ç½®åˆ›å»º <code>cache1</code> å’Œ <code>cache2</code> ç¼“å­˜ï¼Œæœ€å¤§å¤§å°ä¸º 500ï¼Œ<strong>æœ‰æ•ˆæ—¶é—´</strong> ä¸º 10 åˆ†é’Ÿï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cache.cache-names</span>=cache1,cache2</span><br><span class="line"><span class="attr">spring.cache.caffeine.spec</span>=maximumSize=<span class="number">500</span>,expireAfterAccess=<span class="number">600</span>s</span><br></pre></td></tr></table></figure><p>å¦‚æœå®šä¹‰äº† <code>com.github.benmanes.caffeine.cache.CacheLoader</code> beanï¼Œå®ƒå°†è‡ªåŠ¨ä¸ <code>CaffeineCacheManager</code> å…³è”ã€‚ç”±äº <code>CacheLoader</code> å°†ä¸ç¼“å­˜ç®¡ç†å™¨ç®¡ç†çš„<strong>æ‰€æœ‰</strong>ç¼“å­˜ç›¸å…³è”ï¼Œå› æ­¤å¿…é¡»å°†å…¶å®šä¹‰ä¸º <code>CacheLoader&lt;Object, Object&gt;</code>ã€‚è‡ªåŠ¨é…ç½®ä¼šå¿½ç•¥æ‰€æœ‰å…¶ä»–æ³›å‹ç±»å‹ã€‚</p><p><a id="boot-features-caching-provider-simple"></a></p><h4 id="32-1-9ã€Simple">32.1.9ã€Simple</h4><p>å¦‚æœæ‰¾ä¸åˆ°å…¶ä»–æä¾›è€…ï¼Œåˆ™é…ç½®ä½¿ç”¨ä¸€ä¸ª <code>ConcurrentHashMap</code> ä½œä¸ºç¼“å­˜å­˜å‚¨çš„ç®€å•å®ç°ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºä¸­æ²¡æœ‰ç¼“å­˜åº“ï¼Œåˆ™è¯¥é¡¹ä¸ºé»˜è®¤å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šæ ¹æ®éœ€è¦åˆ›å»ºç¼“å­˜ï¼Œä½†æ‚¨å¯ä»¥é€šè¿‡è®¾ç½® <code>cache-names</code> å±æ€§æ¥é™åˆ¶å¯ç”¨ç¼“å­˜çš„åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåªéœ€è¦ <code>cache1</code> å’Œ <code>cache2</code> ç¼“å­˜ï¼Œè¯·æŒ‰å¦‚ä¸‹è®¾ç½® <code>cache-names</code> å±æ€§ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cache.cache-names</span>=cache1,cache2</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿™æ ·åšäº†ï¼Œå¹¶ä¸”æ‚¨çš„åº”ç”¨ç¨‹åºä½¿ç”¨äº†æœªåˆ—å‡ºçš„ç¼“å­˜ï¼Œåˆ™è¿è¡Œæ—¶åœ¨å®ƒéœ€è¦ç¼“å­˜æ—¶ä¼šè§¦å‘å¤±è´¥ï¼Œä½†åœ¨å¯åŠ¨æ—¶åˆ™ä¸ä¼šã€‚è¿™ç±»ä¼¼äº<strong>çœŸå®</strong>ç¼“å­˜æä¾›è€…åœ¨ä½¿ç”¨æœªå£°æ˜çš„ç¼“å­˜æ—¶è§¦å‘çš„è¡Œä¸ºæ–¹å¼ã€‚</p><p><a id="boot-features-caching-provider-none"></a></p><h4 id="32-1-10ã€None">32.1.10ã€None</h4><p>å½“é…ç½®ä¸­å­˜åœ¨ <code>@EnableCaching</code> æ—¶ï¼Œä¹Ÿéœ€è¦åˆé€‚çš„ç¼“å­˜é…ç½®ã€‚å¦‚æœéœ€è¦åœ¨æŸäº›ç¯å¢ƒä¸­å®Œå…¨ç¦ç”¨ç¼“å­˜ï¼Œè¯·å°†ç¼“å­˜ç±»å‹å¼ºåˆ¶è®¾ç½®ä¸º <code>none</code> ä»¥ä½¿ç”¨ no-op å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cache.type</span>=none</span><br></pre></td></tr></table></figure><p><a id="boot-features-messaging"></a></p><h2 id="33ã€æ¶ˆæ¯ä¼ é€’">33ã€æ¶ˆæ¯ä¼ é€’</h2><p>Spring Framework ä¸ºæ¶ˆæ¯ä¼ é€’ç³»ç»Ÿé›†æˆæä¾›äº†å¹¿æ³›çš„æ”¯æŒï¼Œä»ä½¿ç”¨ <code>JmsTemplate</code> ç®€åŒ– JMS API çš„ä½¿ç”¨åˆ°å¼‚æ­¥æ¥æ”¶æ¶ˆæ¯çš„å®Œæ•´åŸºç¡€è®¾æ–½ã€‚Spring AMQP ä¸ºé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼ˆAdvanced Message Queuing Protocolï¼ŒAMQPï¼‰æä¾›äº†ç±»ä¼¼çš„åŠŸèƒ½é›†åˆã€‚Spring Boot è¿˜ä¸º <code>RabbitTemplate</code> å’Œ RabbitMQ æä¾›è‡ªåŠ¨é…ç½®é€‰é¡¹ã€‚Spring WebSocket æœ¬èº«åŒ…å«äº†å¯¹ STOMP æ¶ˆæ¯ä¼ é€’çš„æ”¯æŒï¼ŒSpring Boot é€šè¿‡ starter å’Œå°‘é‡è‡ªåŠ¨é…ç½®å³å¯æ”¯æŒå®ƒã€‚Spring Boot åŒæ ·æ”¯æŒ Apache Kafkaã€‚</p><p><a id="boot-features-jms"></a></p><h3 id="33-1ã€JMS">33.1ã€JMS</h3><p><code>javax.jms.ConnectionFactory</code> æ¥å£æä¾›äº†ä¸€ç§åˆ›å»º <code>javax.jms.Connection</code> çš„æ ‡å‡†æ–¹æ³•ï¼Œå¯ä¸ JMS brokerï¼ˆä»£ç†ï¼‰è¿›è¡Œäº¤äº’ã€‚è™½ç„¶ Spring éœ€è¦ä¸€ä¸ª <code>ConnectionFactory</code> æ¥ä¸ JMS ä¸€åŒå·¥ä½œï¼Œä½†æ˜¯æ‚¨é€šå¸¸ä¸éœ€è¦è‡ªå·±ç›´æ¥ä½¿ç”¨å®ƒï¼Œè€Œæ˜¯å¯ä»¥ä¾èµ–æ›´é«˜çº§åˆ«çš„æ¶ˆæ¯ä¼ é€’æŠ½è±¡ã€‚ï¼ˆæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… Spring Framework å‚è€ƒæ–‡æ¡£çš„<a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/integration.html#jms">ç›¸å…³éƒ¨åˆ†</a>ã€‚ï¼‰Spring Boot è¿˜ä¼šè‡ªåŠ¨é…ç½®å‘é€å’Œæ¥æ”¶æ¶ˆæ¯æ‰€éœ€çš„åŸºç¡€è®¾æ–½ã€‚</p><p><a id="boot-features-activemq"></a></p><h4 id="33-1-1ã€ActiveMQ-æ”¯æŒ">33.1.1ã€ActiveMQ æ”¯æŒ</h4><p>å½“ <a href="http://activemq.apache.org/">ActiveMQ</a> åœ¨ classpath ä¸Šå¯ç”¨æ—¶ï¼ŒSpring Boot ä¹Ÿå¯ä»¥é…ç½®ä¸€ä¸ª <code>ConnectionFactory</code>ã€‚å¦‚æœ broker å­˜åœ¨ï¼Œåˆ™ä¼šè‡ªåŠ¨å¯åŠ¨å¹¶é…ç½®ä¸€ä¸ªå†…åµŒå¼ brokerï¼ˆå‰ææ˜¯æœªé€šè¿‡é…ç½®æŒ‡å®š broder URLï¼‰ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœä½¿ç”¨ <code>spring-boot-starter-activemq</code>ï¼Œåˆ™æä¾›äº†è¿æ¥åˆ° ActiveMQ å®ä¾‹å¿…é¡»ä¾èµ–æˆ–å†…åµŒä¸€ä¸ª ActiveMQ å®ä¾‹ï¼Œä»¥åŠä¸ JMS é›†æˆçš„ Spring åŸºç¡€è®¾æ–½ã€‚</p></blockquote><p>ActiveMQ é…ç½®ç”± <code>spring.activemq.*</code> ä¸­çš„å¤–éƒ¨é…ç½®å±æ€§æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨ <code>application.properties</code> ä¸­å£°æ˜ä»¥ä¸‹éƒ¨åˆ†ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.activemq.broker-url</span>=tcp://<span class="number">192.168</span>.<span class="number">1.210</span>:<span class="number">9876</span></span><br><span class="line"><span class="attr">spring.activemq.user</span>=admin</span><br><span class="line"><span class="attr">spring.activemq.password</span>=secret</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>CachingConnectionFactory</code> å°†åŸç”Ÿçš„ <code>ConnectionFactory</code> ä½¿ç”¨å¯ç”± <code>spring.jms.*</code> ä¸­çš„å¤–éƒ¨é…ç½®å±æ€§æ§åˆ¶çš„åˆç†è®¾ç½®åŒ…è£…èµ·æ¥ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.jms.cache.session-cache-size</span>=<span class="number">5</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨æ›´æ„¿æ„ä½¿ç”¨åŸç”Ÿæ± ï¼Œåˆ™å¯ä»¥é€šè¿‡å‘ <code>org.messaginghub:pooled-jms</code> æ·»åŠ ä¸€ä¸ªä¾èµ–å¹¶ç›¸åº”åœ°é…ç½® <code>JmsPoolConnectionFactory</code> æ¥å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.activemq.pool.enabled</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">spring.activemq.pool.max-connections</span>=<span class="number">50</span></span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>æœ‰å…³æ›´å¤šæ”¯æŒçš„é€‰é¡¹ï¼Œè¯·å‚é˜… <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jms/activemq/ActiveMQProperties.java"><code>ActiveMQProperties</code></a>ã€‚æ‚¨è¿˜å¯ä»¥æ³¨å†Œå¤šä¸ªå®ç°äº† <code>ActiveMQConnectionFactoryCustomizer</code> çš„çš„ beanï¼Œä»¥è¿›è¡Œæ›´é«˜çº§çš„è‡ªå®šä¹‰ã€‚</p></blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒActiveMQ ä¼šåˆ›å»ºä¸€ä¸ª destinationï¼ˆç›®æ ‡ï¼‰ï¼ˆå¦‚æœå®ƒå°šä¸å­˜åœ¨ï¼‰ï¼Œä»¥ä¾¿æ ¹æ®æä¾›çš„åç§°è§£æ destinationã€‚</p><p><a id="boot-features-artemis"></a></p><h4 id="33-1-2ã€Artemis-æ”¯æŒ">33.1.2ã€Artemis æ”¯æŒ</h4><p>Spring Boot å¯ä»¥åœ¨æ£€æµ‹åˆ° <a href="http://activemq.apache.org/artemis/">Artemis</a> åœ¨ classpath ä¸Šå¯ç”¨æ—¶è‡ªåŠ¨é…ç½®ä¸€ä¸ª <code>ConnectionFactory</code>ã€‚å¦‚æœå­˜åœ¨ brokerï¼Œåˆ™ä¼šè‡ªåŠ¨å¯åŠ¨å¹¶é…ç½®ä¸€ä¸ªå†…åµŒ brokerï¼ˆé™¤éå·²æ˜ç¡®è®¾ç½® mode å±æ€§ï¼‰ã€‚æ”¯æŒçš„ mode ä¸º <code>embedded</code>ï¼ˆæ˜ç¡®è¡¨ç¤ºéœ€è¦ä¸€ä¸ªå†…åµŒ brokerï¼Œå¦‚æœ broker åœ¨ classpath ä¸Šä¸å¯ç”¨åˆ™å‘ç”Ÿé”™è¯¯ï¼‰å’Œ <code>native</code>ï¼ˆä½¿ç”¨ netty ä¼ è¾“åè®®è¿æ¥åˆ° brokerï¼‰ã€‚é…ç½®åè€…åï¼ŒSpring Boot ä¼šä½¿ç”¨é»˜è®¤è®¾ç½®é…ç½®ä¸€ä¸ª <code>ConnectionFactory</code>ï¼Œè¯¥ <code>ConnectionFactory</code> è¿æ¥åˆ°åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šè¿è¡Œçš„ brokerã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœä½¿ç”¨äº† <code>spring-boot-starter-artemis</code>ï¼Œåˆ™ä¼šæä¾›è¿æ¥åˆ°ç°æœ‰çš„ Artemis å®ä¾‹çš„å¿…é¡»ä¾èµ–ï¼Œä»¥åŠä¸ JMS é›†æˆçš„Spring åŸºç¡€è®¾æ–½ã€‚å°† <code>org.apache.activemq:artemis-jms-server</code> æ·»åŠ åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºå¯è®©æ‚¨ä½¿ç”¨å†…åµŒæ¨¡å¼ã€‚</p></blockquote><p>Artemis é…ç½®ç”± <code>spring.artemis.*</code> ä¸­çš„å¤–éƒ¨é…ç½®å±æ€§æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨ <code>application.properties</code> ä¸­å£°æ˜ä»¥ä¸‹éƒ¨åˆ†ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.artemis.mode</span>=native</span><br><span class="line"><span class="attr">spring.artemis.host</span>=<span class="number">192.168</span>.<span class="number">1.210</span></span><br><span class="line"><span class="attr">spring.artemis.port</span>=<span class="number">9876</span></span><br><span class="line"><span class="attr">spring.artemis.user</span>=admin</span><br><span class="line"><span class="attr">spring.artemis.password</span>=secret</span><br></pre></td></tr></table></figure><p>å†…åµŒ broker æ—¶ï¼Œæ‚¨å¯ä»¥é€‰æ‹©æ˜¯å¦è¦å¯ç”¨æŒä¹…åŒ–å¹¶åˆ—å‡ºåº”è¯¥å¯ç”¨çš„ destinationã€‚å¯ä»¥å°†è¿™äº›æŒ‡å®šä¸ºä»¥é€—å·åˆ†éš”çš„åˆ—è¡¨ï¼Œä»¥ä½¿ç”¨é»˜è®¤é€‰é¡¹åˆ›å»ºå®ƒä»¬ï¼Œä¹Ÿå¯ä»¥å®šä¹‰ç±»å‹ä¸º <code>org.apache.activemq.artemis.jms.server.config.JMSQueueConfiguration</code> æˆ– <code>org.apache.activemq.artemis.jms.server.config.TopicConfiguration</code> çš„ beanï¼Œåˆ†åˆ«ç”¨äºé«˜çº§é˜Ÿåˆ—å’Œ topicï¼ˆä¸»é¢˜ï¼‰é…ç½®ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>CachingConnectionFactory</code> å°†åŸç”Ÿçš„ <code>ConnectionFactory</code> ä½¿ç”¨å¯ç”± <code>spring.jms.*</code> ä¸­çš„å¤–éƒ¨é…ç½®å±æ€§æ§åˆ¶çš„åˆç†è®¾ç½®åŒ…è£…èµ·æ¥ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.jms.cache.session-cache-size</span>=<span class="number">5</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨æ›´æ„¿æ„ä½¿ç”¨åŸç”Ÿæ± ï¼Œåˆ™å¯ä»¥é€šè¿‡å‘ <code>org.messaginghub:pooled-jms</code> æ·»åŠ ä¸€ä¸ªä¾èµ–å¹¶ç›¸åº”åœ°é…ç½® <code>JmsPoolConnectionFactory</code> æ¥å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.artemis.pool.enabled</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">spring.artemis.pool.max-connections</span>=<span class="number">50</span></span><br></pre></td></tr></table></figure><p>æœ‰å…³æ›´å¤šæ”¯æŒçš„é€‰é¡¹ï¼Œè¯·å‚é˜… <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jms/artemis/ArtemisProperties.java"><code>ArtemisProperties</code></a>ã€‚</p><p>ä¸æ¶‰åŠ JNDI æŸ¥æ‰¾ï¼Œä½¿ç”¨ Artemis é…ç½®ä¸­çš„ <code>name</code> å±æ€§æˆ–é€šè¿‡é…ç½®æä¾›çš„åç§°æ¥è§£æç›®æ ‡ï¼ˆdestinationï¼‰åç§°ã€‚</p><p><a id="boot-features-jms-jndi"></a></p><h4 id="33-1-3ã€ä½¿ç”¨-JNDI-ConnectionFactory">33.1.3ã€ä½¿ç”¨ JNDI ConnectionFactory</h4><p>å¦‚æœæ‚¨åœ¨åº”ç”¨ç¨‹åºæœåŠ¡å™¨ä¸­è¿è¡Œåº”ç”¨ç¨‹åºï¼ŒSpring Boot ä¼šå°è¯•ä½¿ç”¨ JNDI æ‰¾åˆ° JMS <code>ConnectionFactory</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†æ£€æŸ¥ <code>java:/JmsXA</code> å’Œ <code>java:/XAConnectionFactory</code> è¿™ä¸¤ä¸ªä½ç½®ã€‚å¦‚æœéœ€è¦æŒ‡å®šå…¶ä»–ä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨ <code>spring.jms.jndi-name</code> å±æ€§ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.jms.jndi-name</span>=java:/MyConnectionFactory</span><br></pre></td></tr></table></figure><p><a id="boot-features-using-jms-sending"></a></p><h4 id="33-1-4ã€å‘é€æ¶ˆæ¯">33.1.4ã€å‘é€æ¶ˆæ¯</h4><p>Spring çš„ <code>JmsTemplate</code> æ˜¯è‡ªåŠ¨é…ç½®çš„ï¼Œä½ å¯ä»¥ç›´æ¥å°†å®ƒæ³¨å…¥åˆ°ä½ è‡ªå·±çš„ bean ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jms.core.JmsTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> JmsTemplate jmsTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyBean</span><span class="params">(JmsTemplate jmsTemplate)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.jmsTemplate = jmsTemplate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p><code>JmsMessagingTemplate</code> å¯ä»¥ä»¥ç±»ä¼¼çš„æ–¹å¼æ³¨å…¥ã€‚å¦‚æœå®šä¹‰äº† <code>DestinationResolver</code> æˆ– <code>MessageConverter</code> beanï¼Œå®ƒå°†è‡ªåŠ¨å…³è”åˆ°è‡ªåŠ¨é…ç½®çš„ <code>JmsTemplate</code>ã€‚</p></blockquote><p><a id="boot-features-using-jms-receiving"></a></p><h4 id="33-1-5ã€æ¥æ”¶æ¶ˆæ¯">33.1.5ã€æ¥æ”¶æ¶ˆæ¯</h4><p>å½“å­˜åœ¨ JMS åŸºç¡€è®¾æ–½æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>@JmsListener</code> å¯¹ä»»ä½• bean è¿›è¡Œæ³¨è§£ä»¥åˆ›å»ºç›‘å¬å™¨ï¼ˆlistenerï¼‰ç«¯ç‚¹ã€‚å¦‚æœæœªå®šä¹‰ <code>JmsListenerContainerFactory</code>ï¼Œåˆ™ä¼šè‡ªåŠ¨é…ç½®ä¸€ä¸ªé»˜è®¤çš„ï¼ˆfactoryï¼‰ã€‚å¦‚æœå®šä¹‰äº† <code>DestinationResolver</code> æˆ– <code>MessageConverter</code> beanï¼Œå®ƒå°†è‡ªåŠ¨å…³è”åˆ°é»˜è®¤çš„ factoryã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé»˜è®¤ factory æ˜¯å…·æœ‰äº‹åŠ¡ç‰¹æ€§çš„ã€‚å¦‚æœæ‚¨åœ¨å­˜åœ¨æœ‰ <code>JtaTransactionManager</code> çš„åŸºç¡€è®¾æ–½ä¸­è¿è¡Œï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹å®ƒä¸ç›‘å¬å™¨å®¹å™¨ç›¸å…³è”ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™ <code>sessionTransacted</code> flag å°†ä¸ºå¯ç”¨ï¼ˆenabledï¼‰ã€‚åœ¨åä¸€ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨ç›‘å¬å™¨æ–¹æ³•ï¼ˆæˆ–å…¶å§”æ‰˜ï¼‰ä¸Šæ·»åŠ  <code>@Transactional</code>ï¼Œå°†æœ¬åœ°æ•°æ®å­˜å‚¨äº‹åŠ¡ä¸ä¼ å…¥æ¶ˆæ¯çš„å¤„ç†ç›¸å…³è”ã€‚è¿™ç¡®ä¿äº†åœ¨æœ¬åœ°äº‹åŠ¡å®Œæˆåä¼ å…¥æ¶ˆæ¯èƒ½è¢«å‘ŠçŸ¥ã€‚è¿™è¿˜åŒ…æ‹¬äº†å‘é€å·²åœ¨åŒä¸€ JMS ä¼šè¯ä¸Šæ‰§è¡Œçš„å“åº”æ¶ˆæ¯ã€‚</p><p>ä»¥ä¸‹ç»„ä»¶åœ¨ <code>someQueue</code> destination ä¸Šåˆ›å»ºä¸€ä¸ªç›‘å¬å™¨ç«¯ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JmsListener(destination = &quot;someQueue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processMessage</span><span class="params">(String content)</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/javadoc-api/org/springframework/jms/annotation/EnableJms.html"><code>@EnableJms</code> çš„ Javadoc</a>ã€‚</p></blockquote><p>å¦‚æœéœ€è¦åˆ›å»ºæ›´å¤š <code>JmsListenerContainerFactory</code> å®ä¾‹æˆ–è¦†ç›–ç¼ºçœå€¼ï¼ŒSpring Boot ä¼šæä¾›ä¸€ä¸ª <code>DefaultJmsListenerContainerFactoryConfigurer</code>ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥åˆå§‹åŒ– <code>DefaultJmsListenerContainerFactory</code>ï¼Œå…¶è®¾ç½®ä¸è‡ªåŠ¨é…ç½®çš„ factory è®¾ç½®ç›¸åŒã€‚</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ç¤ºä¾‹æš´éœ²äº†å¦ä¸€ä¸ªä½¿ç”¨ç‰¹å®š <code>MessageConverter</code> çš„ factoryï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">JmsConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> DefaultJmsListenerContainerFactory <span class="title function_">myFactory</span><span class="params">(</span></span><br><span class="line"><span class="params">DefaultJmsListenerContainerFactoryConfigurer configurer)</span> &#123;</span><br><span class="line"><span class="type">DefaultJmsListenerContainerFactory</span> <span class="variable">factory</span> <span class="operator">=</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">DefaultJmsListenerContainerFactory</span>();</span><br><span class="line">configurer.configure(factory, connectionFactory());</span><br><span class="line">factory.setMessageConverter(myMessageConverter());</span><br><span class="line"><span class="keyword">return</span> factory;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæ‚¨å¯ä»¥åœ¨ä»»ä½• <code>@JmsListener</code> æ³¨è§£çš„æ–¹æ³•ä¸­ä½¿ç”¨è¯¥ factoryï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JmsListener(destination = &quot;someQueue&quot;, containerFactory=&quot;myFactory&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processMessage</span><span class="params">(String content)</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="boot-features-amqp"></a></p><h3 id="33-2ã€AMQP">33.2ã€AMQP</h3><p>é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼ˆAdvanced Message Queuing Protocolï¼ŒAMQPï¼‰æ˜¯ä¸€ä¸ªå¹³å°æ— å…³ï¼Œé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶çš„è¿æ¥çº§åè®®ã€‚Spring AMQP é¡¹ç›®å°†æ ¸å¿ƒ Spring æ¦‚å¿µåº”ç”¨äºåŸºäº AMQP æ¶ˆæ¯ä¼ é€’è§£å†³æ–¹æ¡ˆçš„å¼€å‘ã€‚Spring Boot ä¸ºé€šè¿‡ RabbitMQ ä½¿ç”¨ AMQP æä¾›äº†ä¸€äº›å¿«æ·æ–¹æ³•ï¼ŒåŒ…æ‹¬ <code>spring-boot-starter-amqp</code> starterã€‚</p><p><a id="boot-features-rabbitmq"></a></p><h4 id="33-2-1ã€RabbitMQ-æ”¯æŒ">33.2.1ã€RabbitMQ æ”¯æŒ</h4><p><a href="https://www.rabbitmq.com/">RabbitMQ</a> æ˜¯ä¸€ä¸ªåŸºäº AMQP åè®®çš„è½»é‡çº§ã€å¯é ã€å¯æ‰©å±•ä¸”å¯ç§»æ¤çš„æ¶ˆæ¯ä»£ç†ã€‚Spring ä½¿ç”¨ RabbitMQ é€šè¿‡ AMQP åè®®è¿›è¡Œé€šä¿¡ã€‚</p><p>RabbitMQ é…ç½®ç”± <code>spring.rabbitmq.*</code> ä¸­çš„å¤–éƒ¨é…ç½®å±æ€§æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨ <code>application.properties</code> ä¸­å£°æ˜ä»¥ä¸‹éƒ¨åˆ†ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.rabbitmq.host</span>=localhost</span><br><span class="line"><span class="attr">spring.rabbitmq.port</span>=<span class="number">5672</span></span><br><span class="line"><span class="attr">spring.rabbitmq.username</span>=admin</span><br><span class="line"><span class="attr">spring.rabbitmq.password</span>=secret</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸Šä¸‹æ–‡ä¸­å­˜åœ¨ <code>ConnectionNameStrategy</code> beanï¼Œå®ƒå°†è‡ªåŠ¨ç”¨äºå‘½åç”±è‡ªåŠ¨é…ç½®çš„ <code>ConnectionFactory</code> æ‰€åˆ›å»ºçš„è¿æ¥ã€‚æœ‰å…³æ›´å¤šæ”¯æŒçš„é€‰é¡¹ï¼Œè¯·å‚é˜… <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/amqp/RabbitProperties.java">RabbitProperties</a>ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://spring.io/blog/2010/06/14/understanding-amqp-the-protocol-used-by-rabbitmq/">ç†è§£ AMQPã€RabbitMQ ä½¿ç”¨çš„åè®®</a>ã€‚</p></blockquote><p><a id="boot-features-using-amqp-sending"></a></p><h4 id="33-2-2ã€å‘é€æ¶ˆæ¯">33.2.2ã€å‘é€æ¶ˆæ¯</h4><p>Spring çš„ <code>AmqpTemplate</code> å’Œ <code>AmqpAdmin</code> æ˜¯è‡ªåŠ¨é…ç½®çš„ï¼Œæ‚¨å¯ä»¥å°†å®ƒä»¬ç›´æ¥æ³¨å…¥è‡ªå·±çš„ bean ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.AmqpAdmin;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.AmqpTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> AmqpAdmin amqpAdmin;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> AmqpTemplate amqpTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyBean</span><span class="params">(AmqpAdmin amqpAdmin, AmqpTemplate amqpTemplate)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.amqpAdmin = amqpAdmin;</span><br><span class="line"><span class="built_in">this</span>.amqpTemplate = amqpTemplate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>RabbitMessagingTemplate å¯ä»¥ä»¥ç±»ä¼¼çš„æ–¹å¼æ³¨å…¥ã€‚å¦‚æœå®šä¹‰äº† <code>MessageConverter</code> beanï¼Œå®ƒå°†è‡ªåŠ¨å…³è”åˆ°è‡ªåŠ¨é…ç½®çš„ <code>AmqpTemplate</code>ã€‚</p></blockquote><p>å¦‚æœ‰å¿…è¦ï¼Œæ‰€æœ‰å®šä¹‰ä¸º bean çš„ <code>org.springframework.amqp.core.Queue</code> éƒ½ä¼šè‡ªåŠ¨åœ¨ RabbitMQ å®ä¾‹ä¸Šå£°æ˜ç›¸åº”çš„é˜Ÿåˆ—ã€‚</p><p>è¦é‡è¯•æ“ä½œï¼Œå¯ä»¥åœ¨ <code>AmqpTemplate</code> ä¸Šå¯ç”¨é‡è¯•ï¼ˆä¾‹å¦‚ï¼Œåœ¨ broker è¿æ¥ä¸¢å¤±çš„æƒ…å†µä¸‹ï¼‰ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.rabbitmq.template.retry.enabled</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">spring.rabbitmq.template.retry.initial-interval</span>=<span class="number">2</span>s</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨é‡è¯•ã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡å£°æ˜ <code>RabbitRetryTemplateCustomizer</code> bean ä»¥ç¼–ç¨‹æ–¹å¼è‡ªå®šä¹‰ <code>RetryTemplate</code>ã€‚</p><p><a id="boot-features-using-amqp-receiving"></a></p><h4 id="33-2-3ã€æ¥æ”¶æ¶ˆæ¯">33.2.3ã€æ¥æ”¶æ¶ˆæ¯</h4><p>å½“ Rabbit åŸºç¡€è®¾æ–½å­˜åœ¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>@RabbitListener</code> æ³¨è§£ä»»ä½• bean ä»¥åˆ›å»ºç›‘å¬å™¨ç«¯ç‚¹ã€‚å¦‚æœæœªå®šä¹‰ <code>RabbitListenerContainerFactory</code>ï¼Œåˆ™ä¼šè‡ªåŠ¨é…ç½®ä¸€ä¸ªé»˜è®¤çš„ <code>SimpleRabbitListenerContainerFactory</code>ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>spring.rabbitmq.listener.type</code> å±æ€§åˆ‡æ¢åˆ°ä¸€ä¸ªç›´æ¥å®¹å™¨ã€‚å¦‚æœå®šä¹‰äº† <code>MessageConverter</code> æˆ– <code>MessageRecoverer</code> beanï¼Œå®ƒå°†è‡ªåŠ¨ä¸é»˜è®¤ factory å…³è”ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹ç»„ä»¶åœ¨ <code>someQueue</code> é˜Ÿåˆ—ä¸Šåˆ›å»ºä¸€ä¸ªä¾¦å¬ç›‘å¬å™¨ç«¯ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;someQueue&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processMessage</span><span class="params">(String content)</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://docs.spring.io/spring-amqp/docs/current/api/org/springframework/amqp/rabbit/annotation/EnableRabbit.html"><code>@EnableRabbit</code> çš„ Javadoc</a>ã€‚</p></blockquote><p>å¦‚æœéœ€è¦åˆ›å»ºæ›´å¤š <code>RabbitListenerContainerFactory</code> å®ä¾‹æˆ–è¦†ç›–ç¼ºçœå€¼ï¼ŒSpring Boot æä¾›äº†ä¸€ä¸ª <code>SimpleRabbitListenerContainerFactoryConfigurer</code> å’Œä¸€ä¸ª <code>DirectRabbitListenerContainerFactoryConfigurer</code>ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥åˆå§‹åŒ– <code>SimpleRabbitListenerContainerFactory</code> å’Œ <code>DirectRabbitListenerContainerFactory</code>ï¼Œå…¶è®¾ç½®ä¸ä½¿ç”¨è‡ªåŠ¨é…ç½®çš„ factory ç›¸åŒã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>è¿™ä¸¤ä¸ª bean ä¸æ‚¨é€‰æ‹©çš„å®¹å™¨ç±»å‹æ²¡æœ‰å…³ç³»ï¼Œå®ƒä»¬é€šè¿‡è‡ªåŠ¨é…ç½®æš´éœ²ã€‚</p></blockquote><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹é…ç½®ç±»æš´éœ²äº†å¦ä¸€ä¸ªä½¿ç”¨ç‰¹å®š <code>MessageConverter</code> çš„ factoryï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">RabbitConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SimpleRabbitListenerContainerFactory <span class="title function_">myFactory</span><span class="params">(</span></span><br><span class="line"><span class="params">SimpleRabbitListenerContainerFactoryConfigurer configurer)</span> &#123;</span><br><span class="line"><span class="type">SimpleRabbitListenerContainerFactory</span> <span class="variable">factory</span> <span class="operator">=</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">SimpleRabbitListenerContainerFactory</span>();</span><br><span class="line">configurer.configure(factory, connectionFactory);</span><br><span class="line">factory.setMessageConverter(myMessageConverter());</span><br><span class="line"><span class="keyword">return</span> factory;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæ‚¨å¯ä»¥åœ¨ä»»ä½• <code>@RabbitListener</code> æ³¨è§£çš„æ–¹æ³•ä¸­ä½¿ç”¨è¯¥ factoryï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;someQueue&quot;, containerFactory=&quot;myFactory&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processMessage</span><span class="params">(String content)</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥å¯ç”¨é‡è¯•æœºåˆ¶æ¥å¤„ç†ç›‘å¬å™¨çš„å¼‚å¸¸æŠ›å‡ºæƒ…å†µã€‚é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ <code>RejectAndDontRequeueRecoverer</code>ï¼Œä½†æ‚¨å¯ä»¥å®šä¹‰è‡ªå·±çš„ <code>MessageRecoverer</code>ã€‚å¦‚æœ broker é…ç½®äº†é‡è¯•æœºåˆ¶ï¼Œå½“é‡è¯•æ¬¡æ•°è€—å°½æ—¶ï¼Œåˆ™æ‹’ç»æ¶ˆæ¯å¹¶å°†å…¶ä¸¢å¼ƒæˆ–è·¯ç”±åˆ°æ­»ä¿¡ï¼ˆdead-letterï¼‰exchange ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹é‡è¯•æœºåˆ¶ä¸ºç¦ç”¨ã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡å£°æ˜ <code>RabbitRetryTemplateCustomizer</code> bean ä»¥ç¼–ç¨‹æ–¹å¼è‡ªå®šä¹‰ <code>RetryTemplate</code>ã€‚</p><p><strong>é‡è¦</strong></p><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœç¦ç”¨é‡è¯•å¹¶ä¸”ç›‘å¬å™¨å¼‚å¸¸æŠ›å‡ºï¼Œåˆ™ä¼šæ— é™æœŸåœ°é‡è¯•ä¼ é€’ã€‚æ‚¨å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ä¿®æ”¹æ­¤è¡Œä¸ºï¼šå°† <code>defaultRequeueRejected</code> å±æ€§è®¾ç½®ä¸º <code>false</code>ï¼Œä»¥ä¾¿å°è¯•é›¶é‡ä¼ æˆ–æŠ›å‡º <code>AmqpRejectAndDontRequeueException</code> ä»¥æŒ‡ç¤ºæ‹’ç»è¯¥æ¶ˆæ¯ã€‚åè€…æ˜¯å¯ç”¨é‡è¯•å¹¶ä¸”è¾¾åˆ°æœ€å¤§ä¼ é€’å°è¯•æ¬¡æ•°æ—¶ä½¿ç”¨çš„æœºåˆ¶ã€‚</p></blockquote><p><a id="boot-features-kafka"></a></p><h3 id="33-3ã€Apache-Kafka-æ”¯æŒ">33.3ã€Apache Kafka æ”¯æŒ</h3><p>é€šè¿‡æä¾› <code>spring-kafka</code> é¡¹ç›®çš„è‡ªåŠ¨é…ç½®æ¥æ”¯æŒ <a href="https://kafka.apache.org/">Apache Kafka</a>ã€‚</p><p>Kafka é…ç½®ç”± <code>spring.kafka.*</code> ä¸­çš„å¤–éƒ¨é…ç½®å±æ€§æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨ <code>application.properties</code> ä¸­å£°æ˜ä»¥ä¸‹éƒ¨åˆ†ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.kafka.bootstrap-servers</span>=localhost:<span class="number">9092</span></span><br><span class="line"><span class="attr">spring.kafka.consumer.group-id</span>=myGroup</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>è¦åœ¨å¯åŠ¨æ—¶åˆ›å»ºä¸»é¢˜ï¼ˆtopicï¼‰ï¼Œè¯·æ·»åŠ  <code>NewTopic</code> ç±»å‹çš„ Beanã€‚å¦‚æœä¸»é¢˜å·²å­˜åœ¨ï¼Œåˆ™å¿½ç•¥è¯¥ beanã€‚</p></blockquote><p>æœ‰å…³æ›´å¤šæ”¯æŒçš„é€‰é¡¹ï¼Œè¯·å‚é˜… <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/kafka/KafkaProperties.java"><code>KafkaProperties</code></a>ã€‚</p><p><a id="boot-features-kafka-sending-a-message"></a></p><h4 id="33-3-1ã€å‘é€æ¶ˆæ¯">33.3.1ã€å‘é€æ¶ˆæ¯</h4><p>Spring çš„ <code>KafkaTemplate</code> æ˜¯è‡ªåŠ¨é…ç½®çš„ï¼Œæ‚¨å¯ä»¥ç›´æ¥åœ¨è‡ªå·±çš„ bean ä¸­è£…é…å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> KafkaTemplate kafkaTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyBean</span><span class="params">(KafkaTemplate kafkaTemplate)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.kafkaTemplate = kafkaTemplate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœå®šä¹‰äº†å±æ€§ <code>spring.kafka.producer.transaction-id-prefix</code>ï¼Œåˆ™ä¼šè‡ªåŠ¨é…ç½®ä¸€ä¸ª <code>KafkaTransactionManager</code>ã€‚æ­¤å¤–ï¼Œå¦‚æœå®šä¹‰äº† <code>RecordMessageConverter</code> beanï¼Œå®ƒå°†è‡ªåŠ¨å…³è”åˆ°è‡ªåŠ¨é…ç½®çš„ <code>KafkaTemplate</code>ã€‚</p></blockquote><p><a id="boot-features-kafka-receiving-a-message"></a></p><h4 id="33-3-2ã€æ¥æ”¶æ¶ˆæ¯">33.3.2ã€æ¥æ”¶æ¶ˆæ¯</h4><p>å½“å­˜åœ¨ Apache Kafka åŸºç¡€è®¾æ–½æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>@KafkaListener</code> æ³¨è§£ä»»ä½• bean ä»¥åˆ›ç›‘å¬å™¨ç«¯ç‚¹ã€‚å¦‚æœæœªå®šä¹‰ <code>KafkaListenerContainerFactory</code>ï¼Œåˆ™ä¼šä½¿ç”¨ <code>spring.kafka.listener.*</code> ä¸­å®šä¹‰çš„ key è‡ªåŠ¨é…ç½®ä¸€ä¸ªé»˜è®¤çš„ factoryã€‚</p><p>ä»¥ä¸‹ç»„ä»¶åœ¨ <code>someTopic</code> topic ä¸Šåˆ›å»ºä¸€ä¸ªç›‘å¬å™¨ç«¯ç‚¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@KafkaListener(topics = &quot;someTopic&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processMessage</span><span class="params">(String content)</span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå®šä¹‰äº† <code>KafkaTransactionManager</code> beanï¼Œå®ƒå°†è‡ªåŠ¨å…³è”åˆ°å®¹å™¨ factoryã€‚åŒæ ·ï¼Œå¦‚æœå®šä¹‰äº† <code>RecordMessageConverter</code>ã€<code>ErrorHandler</code> æˆ– <code>AfterRollbackProcessor</code> beanï¼Œå®ƒå°†è‡ªåŠ¨å…³è”åˆ°é»˜è®¤çš„ factoryã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>è‡ªå®šä¹‰ <code>ChainedKafkaTransactionManager</code> å¿…é¡»æ ‡è®°ä¸º <code>@Primary</code>ï¼Œå› ä¸ºå®ƒé€šå¸¸å¼•ç”¨è‡ªåŠ¨é…ç½®çš„ <code>KafkaTransactionManager</code> beanã€‚</p></blockquote><p><a id="boot-features-kafka-streams"></a></p><h3 id="33-3-3ã€Kafka-Stream">33.3.3ã€Kafka Stream</h3><p>Spring for Apache Kafka æä¾›äº†ä¸€ä¸ªå·¥å‚ bean æ¥åˆ›å»º <code>StreamsBuilder</code> å¯¹è±¡å¹¶ç®¡ç†å…¶ streamï¼ˆæµï¼‰çš„ç”Ÿå‘½å‘¨æœŸã€‚åªè¦ <code>kafka-streams</code> åœ¨ classpath ä¸Šå¹¶ä¸”é€šè¿‡ <code>@EnableKafkaStreams</code> æ³¨è§£å¯ç”¨äº† Kafka Streamï¼ŒSpring Boot å°±ä¼šè‡ªåŠ¨é…ç½®æ‰€éœ€çš„ <code>KafkaStreamsConfiguration</code> beanã€‚</p><p>å¯ç”¨ Kafka Stream æ„å‘³ç€å¿…é¡»è®¾ç½®åº”ç”¨ç¨‹åº id å’Œå¼•å¯¼æœåŠ¡å™¨ï¼ˆbootstrap serverï¼‰ã€‚å¯ä»¥ä½¿ç”¨ <code>spring.kafka.streams.application-id</code> é…ç½®å‰è€…ï¼Œå¦‚æœæœªè®¾ç½®åˆ™é»˜è®¤ä¸º <code>spring.application.name</code>ã€‚åè€…å¯ä»¥å…¨å±€è®¾ç½®æˆ–ä¸“é—¨ä¸º stream è€Œé‡å†™ã€‚</p><p>ä½¿ç”¨ä¸“ç”¨ properties å¯ä»¥è®¾ç½®å¤šä¸ªå…¶ä»–å±æ€§ï¼Œå¯ä»¥ä½¿ç”¨ <code>spring.kafka.streams.properties</code> å‘½åç©ºé—´è®¾ç½®å…¶ä»–ä»»æ„ Kafka å±æ€§ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œå¦è¯·å‚è§<a href="#boot-features-kafka-extra-props">ç¬¬ 33.3.4 èŠ‚ï¼šå…¶ä»– Kafka å±æ€§</a>ã€‚</p><p>è¦ä½¿ç”¨ factory beanï¼Œåªéœ€å°† <code>StreamsBuilder</code> è£…é…åˆ°æ‚¨çš„ <code>@Bean</code> ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableKafkaStreams</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">KafkaStreamsExampleConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> KStream&lt;Integer, String&gt; <span class="title function_">kStream</span><span class="params">(StreamsBuilder streamsBuilder)</span> &#123;</span><br><span class="line">KStream&lt;Integer, String&gt; stream = streamsBuilder.stream(<span class="string">&quot;ks1In&quot;</span>);</span><br><span class="line">stream.map((k, v) -&gt; <span class="keyword">new</span> <span class="title class_">KeyValue</span>&lt;&gt;(k, v.toUpperCase())).to(<span class="string">&quot;ks1Out&quot;</span>,</span><br><span class="line">Produced.with(Serdes.Integer(), <span class="keyword">new</span> <span class="title class_">JsonSerde</span>&lt;&gt;()));</span><br><span class="line"><span class="keyword">return</span> stream;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç”±å…¶åˆ›å»ºçš„ <code>StreamBuilder</code> å¯¹è±¡ç®¡ç†çš„æµä¼šè‡ªåŠ¨å¯åŠ¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ <code>spring.kafka.streams.auto-startup</code> å±æ€§è‡ªå®šä¹‰æ­¤è¡Œä¸ºã€‚</p><p><a id="boot-features-kafka-extra-props"></a></p><h3 id="33-3-4ã€å…¶ä»–-Kafka-å±æ€§">33.3.4ã€å…¶ä»– Kafka å±æ€§</h3><p>è‡ªåŠ¨é…ç½®æ”¯æŒçš„å±æ€§å¯åœ¨<a href="#common-application-properties">é™„å½• Aã€å¸¸è§åº”ç”¨ç¨‹åºå±æ€§</a>ä¸­æ‰¾åˆ°ã€‚è¯·æ³¨æ„ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™äº›å±æ€§ï¼ˆè¿æ¥ç¬¦æˆ–é©¼å³°å‘½åï¼‰ç›´æ¥æ˜ å°„åˆ° Apache Kafka ç‚¹è¿å½¢å¼å±æ€§ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… Apache Kafka æ–‡æ¡£ã€‚</p><p>è¿™äº›å±æ€§ä¸­çš„å‰å‡ ä¸ªé€‚ç”¨äºæ‰€æœ‰ç»„ä»¶ï¼ˆç”Ÿäº§è€…ã€producerã€‘ã€ä½¿ç”¨è€…ã€consumerã€‘ã€ç®¡ç†è€…ã€adminã€‘å’Œæµã€streamã€‘ï¼‰ï¼Œä½†å¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨ä¸åŒçš„å€¼ï¼Œåˆ™å¯ä»¥åœ¨ç»„ä»¶çº§åˆ«æŒ‡å®šã€‚Apache Kafka é‡è¦æ€§ï¼ˆä¼˜å…ˆçº§ï¼‰å±æ€§è®¾å®šä¸º HIGHã€MEDIUM æˆ– LOWã€‚Spring Boot è‡ªåŠ¨é…ç½®æ”¯æŒæ‰€æœ‰ HIGH é‡è¦æ€§å±æ€§ï¼Œä¸€äº›é€‰æ‹©çš„ MEDIUM å’Œ LOW å±æ€§ï¼Œä»¥åŠæ‰€æœ‰æ²¡æœ‰é»˜è®¤å€¼çš„å±æ€§ã€‚</p><p>åªæœ‰ Kafka æ”¯æŒçš„å±æ€§çš„å­é›†å¯ä»¥ç›´æ¥é€šè¿‡ <code>KafkaProperties</code> ç±»è·å¾—ã€‚å¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨ä¸å—æ”¯æŒçš„å…¶ä»–å±æ€§é…ç½®ç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å±æ€§ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.kafka.properties.prop.one</span>=first</span><br><span class="line"><span class="attr">spring.kafka.admin.properties.prop.two</span>=second</span><br><span class="line"><span class="attr">spring.kafka.consumer.properties.prop.three</span>=third</span><br><span class="line"><span class="attr">spring.kafka.producer.properties.prop.four</span>=fourth</span><br><span class="line"><span class="attr">spring.kafka.streams.properties.prop.five</span>=fifth</span><br></pre></td></tr></table></figure><p>è¿™å°†å¸¸è§çš„ <code>prop.one</code> Kafka å±æ€§è®¾ç½®ä¸º <code>first</code>ï¼ˆé€‚ç”¨äºç”Ÿäº§è€…ã€æ¶ˆè´¹è€…å’Œç®¡ç†è€…ï¼‰ï¼Œ<code>prop.two</code> ç®¡ç†è€…å±æ€§ä¸º <code>second</code>ï¼Œ<code>prop.three</code> æ¶ˆè´¹è€…å±æ€§ä¸º <code>third</code>ï¼Œ<code>prop.four</code> ç”Ÿäº§è€…å±æ€§ä¸º <code>fourth</code>ï¼Œ<code>prop.five</code> æµå±æ€§ä¸º <code>fifth</code>ã€‚</p><p>æ‚¨è¿˜å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼é…ç½® Spring Kafka <code>JsonDeserializer</code>ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.kafka.consumer.value-deserializer</span>=org.springframework.kafka.support.serializer.JsonDeserializer</span><br><span class="line"><span class="attr">spring.kafka.consumer.properties.spring.json.value.default.type</span>=com.example.Invoice</span><br><span class="line"><span class="attr">spring.kafka.consumer.properties.spring.json.trusted.packages</span>=com.example,org.acme</span><br></pre></td></tr></table></figure><p>åŒæ ·ï¼Œæ‚¨å¯ä»¥ç¦ç”¨ <code>JsonSerializer</code> åœ¨ header ä¸­å‘é€ç±»å‹ä¿¡æ¯çš„é»˜è®¤è¡Œä¸ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.kafka.producer.value-serializer</span>=org.springframework.kafka.support.serializer.JsonSerializer</span><br><span class="line"><span class="attr">spring.kafka.producer.properties.spring.json.add.type.headers</span>=<span class="literal">false</span></span><br></pre></td></tr></table></figure><p><strong>é‡è¦</strong></p><blockquote><p>ä»¥è¿™ç§æ–¹å¼è®¾ç½®çš„å±æ€§å°†è¦†ç›– Spring Boot æ˜ç¡®æ”¯æŒçš„ä»»ä½•é…ç½®é¡¹ã€‚</p></blockquote><p><a id="boot-features-resttemplate"></a></p><h2 id="34ã€ä½¿ç”¨-RestTemplate-è°ƒç”¨-REST-æœåŠ¡">34ã€ä½¿ç”¨ <code>RestTemplate</code> è°ƒç”¨ REST æœåŠ¡</h2><p>å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºéœ€è¦è°ƒç”¨è¿œç¨‹ REST æœåŠ¡ï¼Œè¿™å¯ä»¥ä½¿ç”¨ Spring Framework çš„ <a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/javadoc-api/org/springframework/web/client/RestTemplate.html"><code>RestTemplate</code></a> ç±»ã€‚ç”±äº <code>RestTemplate</code> å®ä¾‹åœ¨ä½¿ç”¨ä¹‹å‰é€šå¸¸éœ€è¦è¿›è¡Œè‡ªå®šä¹‰ï¼Œå› æ­¤ Spring Boot ä¸æä¾›ä»»ä½•è‡ªåŠ¨é…ç½®çš„ <code>RestTemplate</code> beanã€‚ä½†æ˜¯ï¼Œå®ƒä¼šè‡ªåŠ¨é…ç½® <code>RestTemplateBuilder</code>ï¼Œå¯åœ¨éœ€è¦æ—¶åˆ›å»º <code>RestTemplate</code> å®ä¾‹ã€‚è‡ªåŠ¨é…ç½®çš„ <code>RestTemplateBuilder</code> ç¡®ä¿å°†åˆé€‚çš„ <code>HttpMessageConverters</code> åº”ç”¨äº <code>RestTemplate</code> å®ä¾‹ã€‚</p><p>ä»¥ä¸‹ä»£ç å±•ç¤ºäº†ä¸€ä¸ªå…¸å‹ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyService</span><span class="params">(RestTemplateBuilder restTemplateBuilder)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.restTemplate = restTemplateBuilder.build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Details <span class="title function_">someRestCall</span><span class="params">(String name)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.restTemplate.getForObject(<span class="string">&quot;/&#123;name&#125;/details&quot;</span>, Details.class, name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p><code>RestTemplateBuilder</code> åŒ…å«è®¸å¤šå¯ç”¨äºå¿«é€Ÿé…ç½® Â·RestTemplateÂ· çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œè¦æ·»åŠ  BASIC auth æ”¯æŒï¼Œå¯ä»¥ä½¿ç”¨ <code>builder.basicAuthentication(&quot;user&quot;, &quot;password&quot;).build()</code>ã€‚</p></blockquote><p><a id="boot-features-resttemplate-customization"></a></p><h3 id="34-1ã€è‡ªå®šä¹‰-RestTemplate">34.1ã€è‡ªå®šä¹‰ RestTemplate</h3><p><code>RestTemplate</code> è‡ªå®šä¹‰æœ‰ä¸‰ç§ä¸»è¦æ–¹æ³•ï¼Œå…·ä½“å–å†³äºæ‚¨å¸Œæœ›è‡ªå®šä¹‰çš„ç¨‹åº¦ã€‚</p><p>è¦æƒ³è‡ªå®šä¹‰çš„èŒƒå›´å°½å¯èƒ½åœ°çª„ï¼Œè¯·æ³¨å…¥è‡ªåŠ¨é…ç½®çš„ <code>RestTemplateBuilder</code>ï¼Œç„¶åæ ¹æ®éœ€è¦è°ƒç”¨å…¶æ–¹æ³•ã€‚æ¯ä¸ªæ–¹æ³•è°ƒç”¨éƒ½è¿”å›ä¸€ä¸ªæ–°çš„ <code>RestTemplateBuilder</code> å®ä¾‹ï¼Œå› æ­¤è‡ªå®šä¹‰åªä¼šå½±å“å½“å‰æ„å»ºå™¨ã€‚</p><p>è¦åœ¨åº”ç”¨ç¨‹åºèŒƒå›´å†…æ·»åŠ è‡ªå®šä¹‰é…ç½®ï¼Œè¯·ä½¿ç”¨ <code>RestTemplateCustomizer</code> beanã€‚æ‰€æœ‰è¿™äº› bean éƒ½ä¼šè‡ªåŠ¨æ³¨å†Œåˆ°è‡ªåŠ¨é…ç½®çš„ <code>RestTemplateBuilder</code>ï¼Œå¹¶åº”ç”¨äºä½¿ç”¨å®ƒæ„å»ºçš„æ‰€æœ‰æ¨¡æ¿ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†ä¸€ä¸ª customizerï¼Œå®ƒä¸ºé™¤ <code>192.168.0.5</code> ä¹‹å¤–çš„æ‰€æœ‰ä¸»æœºé…ç½®ä»£ç†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ProxyCustomizer</span> <span class="keyword">implements</span> <span class="title class_">RestTemplateCustomizer</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customize</span><span class="params">(RestTemplate restTemplate)</span> &#123;</span><br><span class="line"><span class="type">HttpHost</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;proxy.example.com&quot;</span>);</span><br><span class="line"><span class="type">HttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClientBuilder.create()</span><br><span class="line">.setRoutePlanner(<span class="keyword">new</span> <span class="title class_">DefaultProxyRoutePlanner</span>(proxy) &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> HttpHost <span class="title function_">determineProxy</span><span class="params">(HttpHost target,</span></span><br><span class="line"><span class="params">HttpRequest request, HttpContext context)</span></span><br><span class="line"><span class="keyword">throws</span> HttpException &#123;</span><br><span class="line"><span class="keyword">if</span> (target.getHostName().equals(<span class="string">&quot;192.168.0.5&quot;</span>)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">super</span>.determineProxy(target, request, context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;).build();</span><br><span class="line">restTemplate.setRequestFactory(</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">HttpComponentsClientHttpRequestFactory</span>(httpClient));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œæœ€æç«¯ï¼ˆä¹Ÿå¾ˆå°‘ä½¿ç”¨ï¼‰çš„é€‰æ‹©æ˜¯åˆ›å»ºè‡ªå·±çš„ <code>RestTemplateBuilder</code> beanã€‚è¿™æ ·åšä¼šå…³é—­ <code>RestTemplateBuilder</code> çš„è‡ªåŠ¨é…ç½®ï¼Œå¹¶é˜»æ­¢ä½¿ç”¨ä»»ä½• <code>RestTemplateCustomizer</code> beanã€‚</p><p><a id="boot-features-webclient"></a></p><h2 id="35ã€ä½¿ç”¨-WebClient-è°ƒç”¨-REST-æœåŠ¡">35ã€ä½¿ç”¨ <code>WebClient</code> è°ƒç”¨ REST æœåŠ¡</h2><p>å¦‚æœåœ¨ classpath ä¸Šå­˜åœ¨ Spring WebFluxï¼Œåˆ™è¿˜å¯ä»¥é€‰æ‹©ä½¿ç”¨ <code>WebClient</code> æ¥è°ƒç”¨è¿œç¨‹ REST æœåŠ¡ã€‚ä¸ <code>RestTemplate</code> ç›¸æ¯”ï¼Œè¯¥å®¢æˆ·ç«¯æ›´å…·å‡½æ•°å¼é£æ ¼å¹¶ä¸”å®Œå…¨å“åº”å¼ã€‚æ‚¨å¯ä»¥åœ¨ <a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web-reactive.html#webflux-client">Spring Framework æ–‡æ¡£çš„ç›¸å…³éƒ¨åˆ†</a>ä¸­äº†è§£æœ‰å…³ <code>WebClient</code> çš„æ›´å¤šä¿¡æ¯ã€‚</p><p>Spring Boot ä¸ºæ‚¨åˆ›å»ºå¹¶é¢„é…ç½®äº†ä¸€ä¸ª <code>WebClient.Builder</code>ã€‚å¼ºçƒˆå»ºè®®å°†å…¶æ³¨å…¥æ‚¨çš„ç»„ä»¶ä¸­å¹¶ä½¿ç”¨å®ƒæ¥åˆ›å»º <code>WebClient</code> å®ä¾‹ã€‚Spring Boot é…ç½®è¯¥æ„å»ºå™¨ä»¥å…±äº« HTTP èµ„æºï¼Œä»¥ä¸æœåŠ¡å™¨ç›¸åŒçš„æ–¹å¼åå°„ç¼–è§£ç å™¨è®¾ç½®ï¼ˆè¯·å‚é˜… <a href="#boot-features-webflux-httpcodecs">WebFlux HTTP ç¼–è§£ç å™¨è‡ªåŠ¨é…ç½®</a>ï¼‰ç­‰ã€‚</p><p>ä»¥ä¸‹ä»£ç æ˜¯ä¸€ä¸ªå…¸å‹ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> WebClient webClient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyService</span><span class="params">(WebClient.Builder webClientBuilder)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.webClient = webClientBuilder.baseUrl(<span class="string">&quot;http://example.org&quot;</span>).build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Mono&lt;Details&gt; <span class="title function_">someRestCall</span><span class="params">(String name)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>.webClient.get().uri(<span class="string">&quot;/&#123;name&#125;/details&quot;</span>, name)</span><br><span class="line">.retrieve().bodyToMono(Details.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="boot-features-webclient-runtime"></a></p><h3 id="35-1ã€WebClient-è¿è¡Œæ—¶">35.1ã€WebClient è¿è¡Œæ—¶</h3><p>Spring Boot å°†è‡ªåŠ¨æ£€æµ‹ç”¨äºé©±åŠ¨ <code>WebClient</code> çš„ <code>ClientHttpConnector</code>ï¼Œå…·ä½“å–å†³äºåº”ç”¨ç¨‹åº classpath ä¸Šå¯ç”¨çš„ç±»åº“ã€‚ç›®å‰æ”¯æŒ Reactor Netty å’Œ Jetty RS å®¢æˆ·ç«¯ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ <code>spring-boot-starter-webflux</code> starter ä¾èµ–äº <code>io.projectreactor.netty:reactor-netty</code>ï¼Œå®ƒåŒ…å«äº†æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„å®ç°ã€‚å¦‚æœæ‚¨é€‰æ‹©å°† <code>Jetty</code> ç”¨ä½œå“åº”å¼æœåŠ¡å™¨ï¼Œåˆ™åº”æ·»åŠ  Jetty Reactive HTTP å®¢æˆ·ç«¯åº“ä¾èµ–é¡¹ <code>org.eclipse.jetty:jetty-reactive-httpclient</code>ã€‚æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä½¿ç”¨ç›¸åŒçš„æŠ€æœ¯å…·æœ‰ä¸€å®šä¼˜åŠ¿ï¼Œå› ä¸ºå®ƒä¼šè‡ªåŠ¨åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å…±äº« HTTP èµ„æºã€‚</p><p>å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡æä¾›è‡ªå®šä¹‰çš„ <code>ReactorResourceFactory</code> æˆ– <code>JettyResourceFactory</code> bean æ¥è¦†ç›– Jetty å’Œ Reactor Netty çš„èµ„æºé…ç½® â€”â€” è¿™å°†åŒæ—¶åº”ç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ã€‚</p><p>å¦‚æœæ‚¨åªå¸Œæœ›è¦†ç›–å®¢æˆ·ç«¯é€‰é¡¹ï¼Œåˆ™å¯ä»¥å®šä¹‰è‡ªå·±çš„ <code>ClientHttpConnector</code> bean å¹¶å®Œå…¨æ§åˆ¶å®¢æˆ·ç«¯é…ç½®ã€‚</p><p>æ‚¨å¯ä»¥åœ¨ <a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/web-reactive.html#webflux-client-builder">Spring Framework å‚è€ƒæ–‡æ¡£ä¸­äº†è§£æœ‰å…³ <code>WebClient</code> é…ç½®é€‰é¡¹çš„æ›´å¤šä¿¡æ¯</a>ã€‚</p><p><a id="boot-features-webclient-customization"></a></p><h3 id="35-2ã€è‡ªå®šä¹‰-WebClient">35.2ã€è‡ªå®šä¹‰ WebClient</h3><p><code>WebClient</code> è‡ªå®šä¹‰æœ‰ä¸‰ç§ä¸»è¦æ–¹æ³•ï¼Œå…·ä½“å–å†³äºæ‚¨å¸Œæœ›è‡ªå®šä¹‰çš„ç¨‹åº¦ã€‚</p><p>è¦æƒ³è‡ªå®šä¹‰çš„èŒƒå›´å°½å¯èƒ½åœ°çª„ï¼Œè¯·æ³¨å…¥è‡ªåŠ¨é…ç½®çš„ <code>WebClient.Builder</code>ï¼Œç„¶åæ ¹æ®éœ€è¦è°ƒç”¨å…¶æ–¹æ³•ã€‚<code>WebClient.Builder</code> å®ä¾‹æ˜¯æœ‰çŠ¶æ€çš„ï¼šæ„å»ºå™¨ä¸Šçš„ä»»ä½•æ›´æ”¹éƒ½ä¼šå½±å“åˆ°ä¹‹åæ‰€æœ‰ä½¿ç”¨å®ƒåˆ›å»ºçš„å®¢æˆ·ç«¯ã€‚å¦‚æœè¦ä½¿ç”¨ç›¸åŒçš„æ„å»ºå™¨åˆ›å»ºå¤šä¸ªå®¢æˆ·ç«¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ <code>WebClient.Builder other = builder.clone();</code> çš„æ–¹å¼å…‹éš†æ„å»ºå™¨ã€‚</p><p>è¦åœ¨åº”ç”¨ç¨‹åºèŒƒå›´å†…å¯¹æ‰€æœ‰ <code>WebClient.Builder</code> å®ä¾‹æ·»åŠ è‡ªå®šä¹‰ï¼Œå¯ä»¥å£°æ˜ <code>WebClientCustomizer</code> bean å¹¶åœ¨æ³¨å…¥ç‚¹å±€éƒ¨æ›´æ”¹ <code>WebClient.Builder</code>ã€‚</p><p>æœ€åï¼Œæ‚¨å¯ä»¥å›é€€åˆ°åŸå§‹ API å¹¶ä½¿ç”¨ <code>WebClient.create()</code>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ä¼šåº”ç”¨è‡ªåŠ¨é…ç½®æˆ– <code>WebClientCustomizer</code>ã€‚</p><p><a id="boot-features-validation"></a></p><h2 id="36ã€éªŒè¯">36ã€éªŒè¯</h2><p>åªè¦ classpath ä¸Šå­˜åœ¨ JSR-303 å®ç°ï¼ˆä¾‹å¦‚ Hibernate éªŒè¯å™¨ï¼‰ï¼Œå°±ä¼šè‡ªåŠ¨å¯ç”¨ Bean Validation 1.1 æ”¯æŒçš„æ–¹æ³•éªŒè¯åŠŸèƒ½ã€‚è¿™å…è®¸ bean æ–¹æ³•åœ¨å…¶å‚æ•°å’Œ/æˆ–è¿”å›å€¼ä¸Šä½¿ç”¨ <code>javax.validation</code> çº¦æŸè¿›è¡Œæ³¨è§£ã€‚å¸¦æœ‰æ­¤ç±»æ³¨è§£æ–¹æ³•çš„ç›®æ ‡ç±»éœ€è¦åœ¨ç±»çº§åˆ«ä¸Šä½¿ç”¨ <code>@Validated</code> è¿›è¡Œæ³¨è§£ï¼Œä»¥ä¾¿æœç´¢å…¶å†…è”çº¦æŸæ³¨è§£çš„æ–¹æ³•ã€‚</p><p>ä¾‹å¦‚ï¼Œä»¥ä¸‹æœåŠ¡è§¦å‘ç¬¬ä¸€ä¸ªå‚æ•°çš„éªŒè¯ï¼Œç¡®ä¿å…¶å¤§å°åœ¨ 8 åˆ° 10 ä¹‹é—´ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Archive <span class="title function_">findByCodeAndAuthor</span><span class="params">(<span class="meta">@Size(min = 8, max = 10)</span> String code,</span></span><br><span class="line"><span class="params">Author author)</span> &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="boot-features-email"></a></p><h2 id="37ã€å‘é€é‚®ä»¶">37ã€å‘é€é‚®ä»¶</h2><p>Spring Framework æä¾›äº†ä¸€ä¸ªä½¿ç”¨ <code>JavaMailSender</code> æ¥å£å‘é€ç”µå­é‚®ä»¶çš„ç®€å•æŠ½è±¡ï¼ŒSpring Boot ä¸ºå…¶æä¾›äº†è‡ªåŠ¨é…ç½®ä»¥åŠä¸€ä¸ª starter æ¨¡å—ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>æœ‰å…³å¦‚ä½•ä½¿ç”¨ <code>JavaMailSender</code> çš„è¯¦ç»†è¯´æ˜ï¼Œè¯·å‚é˜…<a href="https://docs.spring.io/spring/docs/5.1.3.RELEASE/spring-framework-reference/integration.html#mail">å‚è€ƒæ–‡æ¡£</a>ã€‚</p></blockquote><p>å¦‚æœ <code>spring.mail.host</code> å’Œç›¸å…³åº“ï¼ˆç”± <code>spring-boot-starter-mail</code> å®šä¹‰ï¼‰å¯ç”¨ï¼Œåˆ™åˆ›å»ºé»˜è®¤çš„ <code>JavaMailSender</code>ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ã€‚å¯ä»¥é€šè¿‡ <code>spring.mail</code> å‘½åç©ºé—´ä¸­çš„é…ç½®é¡¹è¿›ä¸€æ­¥è‡ªå®šä¹‰å‘ä»¶äººã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/mail/MailProperties.java"><code>MailProperties</code></a>ã€‚</p><p>ç‰¹åˆ«æ˜¯ï¼ŒæŸäº›é»˜è®¤è¶…æ—¶æ—¶é—´çš„å€¼æ˜¯æ— é™çš„ï¼Œæ‚¨å¯èƒ½æƒ³æ›´æ”¹å®ƒä»¥é¿å…çº¿ç¨‹è¢«æ— å“åº”çš„é‚®ä»¶æœåŠ¡å™¨é˜»å¡ï¼Œå¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.mail.properties.mail.smtp.connectiontimeout</span>=<span class="number">5000</span></span><br><span class="line"><span class="attr">spring.mail.properties.mail.smtp.timeout</span>=<span class="number">3000</span></span><br><span class="line"><span class="attr">spring.mail.properties.mail.smtp.writetimeout</span>=<span class="number">5000</span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ JNDI ä¸­çš„ç°æœ‰ <code>Session</code> é…ç½®ä¸€ä¸ª <code>JavaMailSender</code>ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.mail.jndi-name</span>=mail/Session</span><br></pre></td></tr></table></figure><p>è®¾ç½® <code>jndi-name</code> æ—¶ï¼Œå®ƒä¼˜å…ˆäºæ‰€æœ‰å…¶ä»–ä¸ <code>Session</code> ç›¸å…³çš„è®¾ç½®ã€‚</p><p><a id="boot-features-jta"></a></p><h2 id="38ã€JTA-åˆ†å¸ƒå¼äº‹åŠ¡">38ã€JTA åˆ†å¸ƒå¼äº‹åŠ¡</h2><p>Spring Boot é€šè¿‡ä½¿ç”¨ <a href="http://www.atomikos.com/">Atomikos</a> æˆ– <a href="https://github.com/bitronix/btm">Bitronix</a> åµŒå…¥å¼äº‹åŠ¡ç®¡ç†å™¨æ¥æ”¯æŒè·¨å¤šä¸ª XA èµ„æºçš„åˆ†å¸ƒå¼ JTA äº‹åŠ¡ã€‚éƒ¨ç½²åœ¨æŸäº› Java EE åº”ç”¨æœåŠ¡å™¨ï¼ˆApplication Serverï¼‰ä¸Šä¹Ÿæ”¯æŒ JTA äº‹åŠ¡ã€‚</p><p>å½“æ£€æµ‹åˆ° JTA ç¯å¢ƒæ—¶ï¼ŒSpring çš„ <code>JtaTransactionManager</code> å°†ç”¨äºç®¡ç†äº‹åŠ¡ã€‚è‡ªåŠ¨é…ç½®çš„ JMSã€DataSource å’Œ JPA bean å·²å‡çº§ä¸ºæ”¯æŒ XA äº‹åŠ¡ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ Spring æ–¹å¼ï¼ˆä¾‹å¦‚ <code>@Transactional</code>ï¼‰æ¥ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ã€‚å¦‚æœæ‚¨å¤„äº JTA ç¯å¢ƒä¸­å¹¶ä¸”ä»æƒ³ä½¿ç”¨æœ¬åœ°äº‹åŠ¡ï¼Œåˆ™å¯ä»¥å°† <code>spring.jta.enabled</code> å±æ€§è®¾ç½®ä¸º <code>false</code> ä»¥ç¦ç”¨ JTA è‡ªåŠ¨é…ç½®ã€‚</p><p><a id="boot-features-jta-atomikos"></a></p><h3 id="38-1ã€ä½¿ç”¨-Atomikos-äº‹åŠ¡ç®¡ç†å™¨">38.1ã€ä½¿ç”¨ Atomikos äº‹åŠ¡ç®¡ç†å™¨</h3><p><a href="https://www.atomikos.com/">Atomikos</a> æ˜¯ä¸€ä¸ªæµè¡Œçš„å¼€æºäº‹åŠ¡ç®¡ç†å™¨ï¼Œå¯ä»¥åµŒå…¥åˆ° Spring Boot åº”ç”¨ç¨‹åºä¸­ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ <code>spring-boot-starter-jta-atomikos</code> starter æ¥è·å–ç›¸åº”çš„ Atomikos åº“ã€‚Spring Boot è‡ªåŠ¨é…ç½® Atomikos å¹¶ç¡®ä¿å°†åˆé€‚çš„ä¾èµ–è®¾ç½®åº”ç”¨äº Spring beanï¼Œä»¥ç¡®ä¿å¯åŠ¨å’Œå…³é—­é¡ºåºæ­£ç¡®ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒAtomikos äº‹åŠ¡æ—¥å¿—å°†å†™å…¥åº”ç”¨ç¨‹åºä¸»ç›®å½•ï¼ˆåº”ç”¨ç¨‹åº jar æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼‰ä¸­çš„ <code>transaction-logs</code> ç›®å½•ã€‚æ‚¨å¯ä»¥é€šè¿‡åœ¨ <code>application.properties</code> æ–‡ä»¶ä¸­è®¾ç½® <code>spring.jta.log-dir</code> å±æ€§æ¥è‡ªå®šä¹‰æ­¤ç›®å½•çš„ä½ç½®ã€‚ä¹Ÿå¯ç”¨ <code>spring.jta.atomikos.properties</code> å¼€å¤´çš„å±æ€§æ¥è‡ªå®šä¹‰ Atomikos <code>UserTransactionServiceImp</code>ã€‚æœ‰å…³å®Œæ•´çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://docs.spring.io/spring-boot/docs/2.1.1.RELEASE/api/org/springframework/boot/jta/atomikos/AtomikosProperties.html">AtomikosProperties Javadoc</a>ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>ä¸ºç¡®ä¿å¤šä¸ªäº‹åŠ¡ç®¡ç†å™¨å¯ä»¥å®‰å…¨åœ°åè°ƒç›¸åŒçš„èµ„æºç®¡ç†å™¨ï¼Œå¿…é¡»ä¸ºæ¯ä¸ª Atomikos å®ä¾‹é…ç½®å”¯ä¸€ IDã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤ ID æ˜¯è¿è¡Œ Atomikos çš„è®¡ç®—æœºçš„ IP åœ°å€ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¦ç¡®ä¿å”¯ä¸€æ€§ï¼Œåº”ä¸ºåº”ç”¨ç¨‹åºçš„æ¯ä¸ªå®ä¾‹é…ç½® <code>spring.jta.transaction-manager-id</code> å±æ€§ï¼Œå¹¶ä½¿ç”¨ä¸åŒçš„å€¼ã€‚</p></blockquote><p><a id="boot-features-jta-bitronix"></a></p><h3 id="38-2ã€ä½¿ç”¨-Bitronix-äº‹åŠ¡ç®¡ç†å™¨">38.2ã€ä½¿ç”¨ Bitronix äº‹åŠ¡ç®¡ç†å™¨</h3><p><a href="https://github.com/bitronix/btm">Bitronix</a> æ˜¯ä¸€ä¸ªæµè¡Œçš„å¼€æº JTA äº‹åŠ¡ç®¡ç†å™¨å®ç°ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ <code>spring-boot-starter-jta-bitronix</code> starter ä¸ºæ‚¨çš„é¡¹ç›®æ·»åŠ åˆé€‚çš„ Bitronix ä¾èµ–ã€‚ä¸ Atomikos ä¸€æ ·ï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½® Bitronix å¹¶å¯¹ bean è¿›è¡Œåå¤„ç†ï¼ˆpost-processesï¼‰ï¼Œä»¥ç¡®ä¿å¯åŠ¨å’Œå…³é—­é¡ºåºæ­£ç¡®ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒBitronix äº‹åŠ¡æ—¥å¿—æ–‡ä»¶ï¼ˆ<code>part1.btm</code> å’Œ <code>part2.btm</code>ï¼‰å°†å†™å…¥åº”ç”¨ç¨‹åºä¸»ç›®å½•ä¸­çš„ <code>transaction-logs</code> ç›®å½•ã€‚æ‚¨å¯ä»¥é€šè¿‡è®¾ç½® <code>spring.jta.log-dir</code> å±æ€§æ¥è‡ªå®šä¹‰æ­¤ç›®å½•çš„ä½ç½®ã€‚ä»¥ <code>spring.jta.bitronix.properties</code> å¼€å¤´çš„å±æ€§ç»‘å®šåˆ°äº† <code>bitronix.tm.Configuration</code> beanï¼Œå…è®¸å®Œå…¨è‡ªå®šä¹‰ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://github.com/bitronix/btm/wiki/Transaction-manager-configuration">Bitronix æ–‡æ¡£</a>ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>ä¸ºç¡®ä¿å¤šä¸ªäº‹åŠ¡ç®¡ç†å™¨èƒ½å¤Ÿå®‰å…¨åœ°åè°ƒç›¸åŒçš„èµ„æºç®¡ç†å™¨ï¼Œå¿…é¡»ä¸ºæ¯ä¸ª Bitronix å®ä¾‹é…ç½®å”¯ä¸€çš„ IDã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤ ID æ˜¯è¿è¡Œ Bitronix çš„è®¡ç®—æœºçš„ IP åœ°å€ã€‚ç”Ÿäº§ç¯å¢ƒè¦ç¡®ä¿å”¯ä¸€æ€§ï¼Œåº”ä¸ºåº”ç”¨ç¨‹åºçš„æ¯ä¸ªå®ä¾‹é…ç½® <code>spring.jta.transaction-manager-id</code> å±æ€§ï¼Œå¹¶ä½¿ç”¨ä¸åŒçš„å€¼ã€‚</p></blockquote><p><a id="boot-features-jta-javaee"></a></p><h3 id="38-3ã€ä½¿ç”¨-Java-EE-ç®¡ç†çš„äº‹åŠ¡ç®¡ç†å™¨">38.3ã€ä½¿ç”¨ Java EE ç®¡ç†çš„äº‹åŠ¡ç®¡ç†å™¨</h3><p>å¦‚æœå°† Spring Boot åº”ç”¨ç¨‹åºæ‰“åŒ…ä¸º <code>war</code> æˆ– <code>ear</code> æ–‡ä»¶å¹¶å°†å…¶éƒ¨ç½²åˆ° Java EE åº”ç”¨ç¨‹åºæœåŠ¡å™¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨åº”ç”¨ç¨‹åºæœåŠ¡å™¨çš„å†…ç½®äº‹åŠ¡ç®¡ç†å™¨ã€‚Spring Boot å°è¯•é€šè¿‡æŸ¥æ‰¾å¸¸è§çš„ JNDI ä½ç½®ï¼ˆ<code>java:comp/UserTransaction</code>ã€<code>java:comp/TransactionManager</code> ç­‰ï¼‰æ¥è‡ªåŠ¨é…ç½®äº‹åŠ¡ç®¡ç†å™¨ã€‚å¦‚æœä½¿ç”¨åº”ç”¨ç¨‹åºæœåŠ¡å™¨æä¾›çš„äº‹åŠ¡æœåŠ¡ï¼Œé€šå¸¸è¿˜éœ€è¦ç¡®ä¿æ‰€æœ‰èµ„æºéƒ½ç”±æœåŠ¡å™¨ç®¡ç†å¹¶é€šè¿‡ JNDI æš´éœ²ã€‚Spring Boot å°è¯•é€šè¿‡åœ¨ JNDI è·¯å¾„ï¼ˆ<code>java:/JmsXA</code> æˆ– <code>java:/JmsXA</code>ï¼‰ä¸­æŸ¥æ‰¾ <code>ConnectionFactory</code> æ¥è‡ªåŠ¨é…ç½® JMSï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ <a href="#boot-features-connecting-to-a-jndi-datasource"><code>spring.datasource.jndi-name</code> å±æ€§</a>æ¥é…ç½® <code>DataSource</code>ã€‚</p><p><a id="boot-features-jta-mixed-jms"></a></p><h3 id="38-4ã€æ··åˆä½¿ç”¨-XA-ä¸é-XA-JMS-è¿æ¥">38.4ã€æ··åˆä½¿ç”¨ XA ä¸é XA JMS è¿æ¥</h3><p>ä½¿ç”¨ JTA æ—¶ï¼Œä¸» JMS <code>ConnectionFactory</code> bean å¯è¯†åˆ« XA å¹¶å‚ä¸åˆ†å¸ƒå¼äº‹åŠ¡ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½å¸Œæœ›ä½¿ç”¨é XA <code>ConnectionFactory</code> å¤„ç†æŸäº› JMS æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œæ‚¨çš„ JMS å¤„ç†é€»è¾‘å¯èƒ½éœ€è¦æ¯” XA è¶…æ—¶æ—¶é—´æ›´é•¿çš„æ—¶é—´ã€‚</p><p>å¦‚æœè¦ä½¿ç”¨é XA <code>ConnectionFactory</code>ï¼Œå¯ä»¥æ³¨å…¥ <code>nonXaJmsConnectionFactory</code> bean è€Œä¸æ˜¯ <code>@Primary</code> <code>jmsConnectionFactory</code> beanã€‚ä¸ºäº†ä¿æŒä¸€è‡´æ€§ï¼Œæä¾›çš„ <code>jmsConnectionFactory</code> bean è¿˜éœ€è¦ä½¿ç”¨ <code>xaJmsConnectionFactory</code> åˆ«åã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•æ³¨å…¥ <code>ConnectionFactory</code> å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Inject the primary (XA aware) ConnectionFactory</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ConnectionFactory defaultConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inject the XA aware ConnectionFactory (uses the alias and injects the same as above)</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;xaJmsConnectionFactory&quot;)</span></span><br><span class="line"><span class="keyword">private</span> ConnectionFactory xaConnectionFactory;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inject the non-XA aware ConnectionFactory</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;nonXaJmsConnectionFactory&quot;)</span></span><br><span class="line"><span class="keyword">private</span> ConnectionFactory nonXaConnectionFactory;</span><br></pre></td></tr></table></figure><p><a id="boot-features-jta-supporting-alternative-embedded"></a></p><h3 id="38-5ã€æ”¯æŒåµŒå…¥å¼äº‹åŠ¡ç®¡ç†å™¨">38.5ã€æ”¯æŒåµŒå…¥å¼äº‹åŠ¡ç®¡ç†å™¨</h3><p><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jms/XAConnectionFactoryWrapper.java"><code>XAConnectionFactoryWrapper</code></a> å’Œ <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jdbc/XADataSourceWrapper.java"><code>XADataSourceWrapper</code></a> æ¥å£å¯ç”¨äºæ”¯æŒå…¶ä»–åµŒå…¥å¼äº‹åŠ¡ç®¡ç†å™¨ã€‚æ¥å£è´Ÿè´£åŒ…è£… <code>XAConnectionFactory</code> å’Œ <code>XADataSource</code> beanï¼Œå¹¶å°†å®ƒä»¬å…¬å¼€ä¸ºæ™®é€šçš„ <code>ConnectionFactory</code> å’Œ <code>DataSource</code> beanï¼Œå®ƒä»¬é€æ˜åœ°åŠ å…¥åˆ†å¸ƒå¼äº‹åŠ¡ã€‚<code>DataSource</code> å’Œ JMS è‡ªåŠ¨é…ç½®ä½¿ç”¨ JTA å˜ä½“ï¼Œå‰ææ˜¯æ‚¨éœ€è¦æœ‰ä¸€ä¸ª <code>JtaTransactionManager</code> bean å’Œåœ¨ <code>ApplicationContext</code> ä¸­æ³¨å†Œæœ‰çš„ç›¸åº” XA åŒ…è£…å™¨ï¼ˆwrapperï¼‰ beanã€‚</p><p><a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jta/bitronix/BitronixXAConnectionFactoryWrapper.java">BitronixXAConnectionFactoryWrapper</a> å’Œ <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.1.RELEASE/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/jta/bitronix/BitronixXADataSourceWrapper.java">BitronixXADataSourceWrapper</a> ä¸ºå¦‚ä½•ç¼–å†™ XA åŒ…è£…å™¨æä¾›äº†å¾ˆå¥½ç¤ºä¾‹ã€‚</p><p><a id="boot-features-hazelcast"></a></p><h2 id="39ã€Hazelcast">39ã€Hazelcast</h2><p>å¦‚æœ <a href="https://hazelcast.com/">Hazelcast</a> åœ¨ classpath ä¸Šå¹¶æœ‰åˆé€‚çš„é…ç½®ï¼Œåˆ™ Spring Boot ä¼šè‡ªåŠ¨é…ç½®ä¸€ä¸ªå¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­æ³¨å…¥çš„ <code>HazelcastInstance</code>ã€‚</p><p>å¦‚æœå®šä¹‰äº† <code>com.hazelcast.config.Config</code> beanï¼Œåˆ™ Spring Boot ä¼šä½¿ç”¨å®ƒã€‚å¦‚æœæ‚¨çš„é…ç½®å®šä¹‰äº†å®ä¾‹åç§°ï¼ŒSpring Boot ä¼šå°è¯•æŸ¥æ‰¾ç°æœ‰çš„å®ä¾‹ï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°å®ä¾‹ã€‚</p><p>æ‚¨è¿˜å¯ä»¥é€šè¿‡é…ç½®æŒ‡å®šè¦ä½¿ç”¨çš„ <code>hazelcast.xml</code> é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.hazelcast.config</span>=classpath:config/my-hazelcast.xml</span><br></pre></td></tr></table></figure><p>å¦åˆ™ï¼ŒSpring Boot ä¼šå°è¯•ä»é»˜è®¤ä½ç½®æŸ¥æ‰¾ Hazelcast é…ç½®ï¼šå·¥ä½œç›®å½•æˆ– classpath æ ¹ç›®å½•ä¸­çš„ <code>hazelcast.xml</code> ã€‚æˆ‘ä»¬è¿˜æ£€æŸ¥æ˜¯å¦è®¾ç½®äº† <code>hazelcast.config</code> ç³»ç»Ÿå±æ€§ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="http://docs.hazelcast.org/docs/latest/manual/html-single/">Hazelcast æ–‡æ¡£</a>ã€‚</p><p>å¦‚æœ classpath ä¸­å­˜åœ¨ <code>hazelcast-client</code>ï¼Œåˆ™ Spring Boot ä¼šé¦–å…ˆå°è¯•é€šè¿‡æ£€æŸ¥ä»¥ä¸‹é…ç½®é¡¹æ¥åˆ›å»ºå®¢æˆ·ç«¯ï¼š</p><ul><li>å­˜åœ¨ <code>com.hazelcast.client.config.ClientConfig</code> beanã€‚</li><li><code>spring.hazelcast.config</code> å±æ€§å®šä¹‰çš„é…ç½®æ–‡ä»¶ã€‚</li><li>å­˜åœ¨ <code>hazelcast.client.config</code> ç³»ç»Ÿå±æ€§ã€‚</li><li>å·¥ä½œç›®å½•ä¸­æˆ– classpath æ ¹ç›®å½•ä¸‹çš„ <code>hazelcast-client.xml</code>ã€‚</li></ul><p><strong>æ³¨æ„</strong></p><blockquote><p>Spring Boot è¿˜ä¸º Hazelcast æä¾›äº†<a href="#boot-features-caching-provider-hazelcast">ç¼“å­˜æ”¯æŒ</a>ã€‚å¦‚æœå¯ç”¨äº†ç¼“å­˜ï¼Œ<code>HazelcastInstance</code> å°†è‡ªåŠ¨åŒ…è£…åœ¨ <code>CacheManager</code> å®ç°ä¸­ã€‚</p></blockquote><p><a id="boot-features-quartz"></a></p><h2 id="40ã€Quartz-è°ƒåº¦å™¨">40ã€Quartz è°ƒåº¦å™¨</h2><p>Spring Boot æä¾›äº†å‡ ç§ä½¿ç”¨ <a href="http://www.quartz-scheduler.org/">Quartz è°ƒåº¦å™¨</a>çš„ä¾¿æ·æ–¹å¼ï¼Œå®ƒä»¬æ¥è‡ª <code>spring-boot-starter-quartz</code> starterã€‚å¦‚æœ Quartz å¯ç”¨ï¼Œåˆ™ Spring Boot å°†è‡ªåŠ¨é…ç½® <code>Scheduler</code>ï¼ˆé€šè¿‡ <code>SchedulerFactoryBean</code> æŠ½è±¡ï¼‰ã€‚</p><p>è‡ªåŠ¨é€‰å–ä»¥ä¸‹ç±»å‹çš„ Bean å¹¶å°†å…¶ä¸ <code>Scheduler</code> å…³è”èµ·æ¥ï¼š</p><ul><li><code>JobDetail</code>ï¼šå®šä¹‰ä¸€ä¸ªç‰¹å®šçš„ jobã€‚å¯ä»¥ä½¿ç”¨ <code>JobBuilder</code> API æ„å»º <code>JobDetail</code> å®ä¾‹ã€‚</li><li><code>Calendar</code>ã€‚</li><li><code>Trigger</code>ï¼šå®šä¹‰ä½•æ—¶è§¦å‘ jobã€‚</li></ul><p>é»˜è®¤ä½¿ç”¨å†…å­˜å­˜å‚¨æ–¹å¼çš„ <code>JobStore</code>ã€‚ ä½†å¦‚æœåº”ç”¨ç¨‹åºä¸­æœ‰ <code>DataSource</code> beanï¼Œå¹¶ä¸”é…ç½®äº† <code>spring.quartz.job-store-type</code> å±æ€§ï¼Œåˆ™å¯ä»¥é…ç½®åŸºäº JDBC çš„å­˜å‚¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.quartz.job-store-type</span>=jdbc</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ JDBC å­˜å‚¨æ—¶ï¼Œå¯ä»¥åœ¨å¯åŠ¨æ—¶åˆå§‹åŒ– schemaï¼ˆè¡¨ç»“æ„ï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.quartz.jdbc.initialize-schema</span>=always</span><br></pre></td></tr></table></figure><p><strong>è­¦å‘Š</strong></p><blockquote><p>é»˜è®¤å°†ä½¿ç”¨ Quartz åº“æä¾›çš„æ ‡å‡†è„šæœ¬æ£€æµ‹å¹¶åˆå§‹åŒ–æ•°æ®åº“ã€‚è¿™äº›è„šæœ¬ä¼šåˆ é™¤ç°æœ‰è¡¨ï¼Œåœ¨æ¯æ¬¡é‡å¯æ—¶åˆ é™¤æ‰€æœ‰è§¦å‘å™¨ã€‚å¯ä»¥é€šè¿‡è®¾ç½® <code>spring.quartz.jdbc.schema</code> å±æ€§æ¥æä¾›è‡ªå®šä¹‰è„šæœ¬ã€‚</p></blockquote><p>è¦è®© Quartz ä½¿ç”¨é™¤åº”ç”¨ç¨‹åºä¸» <code>DataSource</code> ä¹‹å¤–çš„ <code>DataSource</code>ï¼Œè¯·å£°æ˜ä¸€ä¸ª <code>DataSource</code> beanï¼Œä½¿ç”¨ <code>@QuartzDataSource</code> æ³¨è§£å…¶ <code>@Bean</code> æ–¹æ³•ã€‚è¿™æ ·åšå¯ç¡®ä¿ <code>SchedulerFactoryBean</code> å’Œ schema åˆå§‹åŒ–éƒ½ä½¿ç”¨ Quartz æŒ‡å®šçš„ <code>DataSource</code>ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé…ç½®åˆ›å»ºçš„ job ä¸ä¼šè¦†ç›–å·²ä»æŒä¹… job å­˜å‚¨è¯»å–çš„å·²æ³¨å†Œçš„ jobã€‚è¦å¯ç”¨è¦†ç›–ç°æœ‰çš„ job å®šä¹‰ï¼Œè¯·è®¾ç½® <code>spring.quartz.overwrite-existing-jobs</code> å±æ€§ã€‚</p><p>Quartz è°ƒå–å™¨é…ç½®å¯ä»¥ä½¿ç”¨ <code>spring.quartz</code> å±æ€§å’Œ <code>SchedulerFactoryBeanCustomizer</code> bean è¿›è¡Œè‡ªå®šä¹‰ï¼Œå®ƒä»¬å…è®¸ä»¥ç¼–ç¨‹æ–¹å¼çš„ SchedulerFactoryBean è‡ªå®šä¹‰ã€‚å¯ä»¥ä½¿ç”¨ <code>spring.quartz.properties.*</code> è‡ªå®šä¹‰é«˜çº§ Quartz é…ç½®å±æ€§ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œ<code>Executor</code> bean ä¸è°ƒåº¦ç¨‹åºæ²¡æœ‰å…³è”ï¼Œå› ä¸º Quartz æä¾›äº†é€šè¿‡ <code>spring.quartz.properties</code> é…ç½®è°ƒåº¦å™¨çš„æ–¹æ³•ã€‚å¦‚æœéœ€è¦è‡ªå®šä¹‰æ‰§è¡Œå™¨ï¼Œè¯·è€ƒè™‘å®ç° <code>SchedulerFactoryBeanCustomizer</code>ã€‚</p></blockquote><p>job å¯ä»¥å®šä¹‰ <code>setter</code> ä»¥æ³¨å…¥æ•°æ®æ˜ å°„å±æ€§ã€‚ä¹Ÿå¯ä»¥ä»¥ç±»ä¼¼çš„æ–¹å¼æ³¨å…¥å¸¸è§„çš„ beanï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SampleJob</span> <span class="keyword">extends</span> <span class="title class_">QuartzJobBean</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> MyService myService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inject &quot;MyService&quot; bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMyService</span><span class="params">(MyService myService)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Inject the &quot;name&quot; job data property</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">executeInternal</span><span class="params">(JobExecutionContext context)</span></span><br><span class="line"><span class="keyword">throws</span> JobExecutionException &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="boot-features-task-execution-scheduling"></a></p><h2 id="41ã€ä»»åŠ¡æ‰§è¡Œä¸è°ƒåº¦">41ã€ä»»åŠ¡æ‰§è¡Œä¸è°ƒåº¦</h2><p>åœ¨ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰ <code>Executor</code> bean çš„æƒ…å†µä¸‹ï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½®ä¸€ä¸ªæœ‰åˆç†é»˜è®¤å€¼çš„ <code>ThreadPoolTaskâ€‹â€‹Executor</code>ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨ä¸å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œï¼ˆ<code>@EnableAsync</code>ï¼‰å’Œ Spring MVC å¼‚æ­¥è¯·æ±‚å¤„ç†ç›¸å…³è”ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœæ‚¨åœ¨ä¸Šä¸‹æ–‡ä¸­å®šä¹‰äº†è‡ªå®šä¹‰ <code>Executor</code>ï¼Œåˆ™å¸¸è§„ä»»åŠ¡æ‰§è¡Œï¼ˆå³ <code>@EnableAsync</code>ï¼‰å°†é€æ˜åœ°ä½¿ç”¨å®ƒï¼Œä½†ä¸ä¼šé…ç½® Spring MVC æ”¯æŒï¼Œå› ä¸ºå®ƒéœ€è¦ <code>AsyncTaskExecutor</code> å®ç°ï¼ˆåä¸º <code>applicationTaskExecutor</code>ï¼‰ã€‚æ ¹æ®æ‚¨çš„ç›®æ ‡å®‰æ’ï¼Œæ‚¨å¯ä»¥å°† <code>Executor</code> æ›´æ”¹ä¸º <code>ThreadPoolTaskâ€‹â€‹Executor</code>ï¼Œæˆ–è€…å®šä¹‰ <code>Executorçš„ThreadPoolTaskâ€‹â€‹Executor</code> å’Œ <code>AsyncConfigurer</code> æ¥åŒ…è£…è‡ªå®šä¹‰çš„ <code>Executor</code>ã€‚</p><p>æ‚¨å¯ä»¥ä½¿ç”¨è‡ªåŠ¨é…ç½®çš„ <code>TaskExecutorBuilder</code> æ¥è½»æ¾åˆ›å»ºå®ä¾‹ï¼Œä»¥å¤åˆ¶é»˜è®¤çš„è‡ªåŠ¨é…ç½®ã€‚</p></blockquote><p>çº¿ç¨‹æ± ä½¿ç”¨ 8 ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼Œå¯æ ¹æ®è´Ÿè½½æƒ…å†µå¢åŠ å’Œå‡å°‘ã€‚å¯ä»¥ä½¿ç”¨ <code>spring.task.execution</code> å‘½åç©ºé—´å¯¹è¿™äº›é»˜è®¤è®¾ç½®è¿›è¡Œå¾®è°ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.task.execution.pool.max-threads</span>=<span class="number">16</span></span><br><span class="line"><span class="attr">spring.task.execution.pool.queue-capacity</span>=<span class="number">100</span></span><br><span class="line"><span class="attr">spring.task.execution.pool.keep-alive</span>=<span class="number">10</span>s</span><br></pre></td></tr></table></figure><p>è¿™ä¼šå°†çº¿ç¨‹æ± æ›´æ”¹ä¸ºä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—ï¼Œåœ¨é˜Ÿåˆ—æ»¡ï¼ˆ100 ä¸ªä»»åŠ¡ï¼‰æ—¶ï¼Œçº¿ç¨‹æ± å°†å¢åŠ åˆ°æœ€å¤š 16 ä¸ªçº¿ç¨‹ã€‚å½“çº¿ç¨‹åœ¨é—²ç½®10 ç§’ï¼ˆè€Œä¸æ˜¯é»˜è®¤çš„ 60 ç§’ï¼‰æ—¶å›æ”¶çº¿ç¨‹ï¼Œæ± çš„æ”¶ç¼©æ›´ä¸ºæ˜æ˜¾ã€‚</p><p>å¦‚æœéœ€è¦ä¸è°ƒåº¦ä»»åŠ¡æ‰§è¡Œï¼ˆ<code>@EnableScheduling</code>ï¼‰ç›¸å…³è”ï¼Œå¯ä»¥è‡ªåŠ¨é…ç½®ä¸€ä¸ª <code>ThreadPoolTaskScheduler</code>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ± ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ <code>spring.task.scheduling</code> å‘½åç©ºé—´å¯¹è¿™äº›è®¾ç½®è¿›è¡Œå¾®è°ƒã€‚</p><p>å¦‚æœéœ€è¦åˆ›å»ºè‡ªå®šä¹‰æ‰§è¡Œå™¨æˆ–è°ƒåº¦å™¨ï¼Œåˆ™åœ¨ä¸Šä¸‹æ–‡ä¸­å¯ä»¥ä½¿ç”¨ <code>TaskExecutorBuilder</code> bean å’Œ <code>TaskSchedulerBuilder</code> beanã€‚</p><p><a id="boot-features-integration"></a></p><h2 id="42ã€Spring-Integration">42ã€Spring Integration</h2><p>Spring Boot ä¸º <a href="https://projects.spring.io/spring-integration/">Spring Integration</a> æä¾›äº†ä¸€äº›ä¾¿æ·çš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä»¬åŒ…å«åœ¨ <code>spring-boot-starter-integration</code> starter ä¸­ã€‚Spring Integration ä¸ºæ¶ˆæ¯ä¼ é€’ä»¥åŠå…¶ä»–ä¼ è¾“ï¼ˆå¦‚ HTTPã€TCP ç­‰ï¼‰æä¾›äº†æŠ½è±¡ã€‚å¦‚æœ classpath ä¸Šå­˜åœ¨ Spring Integrationï¼Œåˆ™ Spring Boot ä¼šé€šè¿‡ <code>@EnableIntegration</code> æ³¨è§£å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ã€‚</p><p>Spring Boot è¿˜é…ç½®äº†ä¸€äº›ç”±å…¶ä»– Spring Integration æ¨¡å—è§¦å‘çš„åŠŸèƒ½ã€‚å¦‚æœ <code>spring-integration-jmx</code> ä¹Ÿåœ¨ classpath ä¸Šï¼Œåˆ™æ¶ˆæ¯å¤„ç†ç»Ÿè®¡ä¿¡æ¯å°†é€šè¿‡ JMX å‘å¸ƒã€‚å¦‚æœ <code>spring-integration-jdbc</code> å¯ç”¨ï¼Œåˆ™å¯ä»¥åœ¨å¯åŠ¨æ—¶åˆ›å»ºé»˜è®¤æ•°æ®åº“æ¨¡å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.integration.jdbc.initialize-schema</span>=always</span><br></pre></td></tr></table></figure><p>æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/integration/IntegrationAutoConfiguration.java">IntegrationAutoConfiguration</a> å’Œ <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/integration/IntegrationProperties.java">IntegrationProperties</a> ç±»ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœå­˜åœ¨ Micrometer <code>meterRegistry</code> beanï¼Œåˆ™ Micrometer å°†ç®¡ç† Spring Integration çš„æŒ‡æ ‡ã€‚å¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨æ—§ç‰ˆ Spring Integration åº¦é‡ï¼Œè¯·å°† <code>DefaultMetricsFactory</code> bean æ·»åŠ åˆ°åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ã€‚</p><p><a id="boot-features-session"></a></p><h2 id="43ã€Spring-Session">43ã€Spring Session</h2><p>Spring Boot ä¸ºå„ç§æ•°æ®å­˜å‚¨æä¾› <a href="https://projects.spring.io/spring-session/">Spring Session</a> è‡ªåŠ¨é…ç½®ã€‚åœ¨æ„å»º Servlet Web åº”ç”¨ç¨‹åºæ—¶ï¼Œå¯ä»¥è‡ªåŠ¨é…ç½®ä»¥ä¸‹å­˜å‚¨ï¼š</p><ul><li>JDBC</li><li>Redis</li><li>Hazelcast</li><li>MongoDB</li></ul><p>æ„å»ºå“åº”å¼ Web åº”ç”¨ç¨‹åºæ—¶ï¼Œå¯ä»¥è‡ªåŠ¨é…ç½®ä»¥ä¸‹å­˜å‚¨ï¼š</p><ul><li>Redis</li><li>MongoDB</li></ul><p>å¦‚æœ classpath ä¸Šå­˜åœ¨å•ä¸ª Spring Session æ¨¡å—ï¼Œåˆ™ Spring Boot ä¼šè‡ªåŠ¨ä½¿ç”¨è¯¥å­˜å‚¨å®ç°ã€‚å¦‚æœæ‚¨æœ‰å¤šä¸ªå®ç°ï¼Œåˆ™å¿…é¡»é€‰æ‹©è¦ç”¨äºå­˜å‚¨ä¼šè¯çš„ <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/session/StoreType.java"><code>StoreType</code></a>ã€‚ ä¾‹å¦‚ï¼Œè¦ä½¿ç”¨ JDBC ä½œä¸ºåç«¯å­˜å‚¨ï¼Œæ‚¨å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼é…ç½®åº”ç”¨ç¨‹åºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.session.store-type</span>=jdbc</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>å¯ä»¥å°† <code>store-type</code> è®¾ç½®ä¸º <code>none</code> æ¥ç¦ç”¨ Spring Sessionã€‚</p></blockquote><p>æ¯ä¸ª store éƒ½æœ‰è‡ªå·±çš„é¢å¤–è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä¸º JDBC å­˜å‚¨å®šåˆ¶è¡¨çš„åç§°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.session.jdbc.table-name</span>=SESSIONS</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨ <code>spring.session.timeout</code> å±æ€§æ¥è®¾ç½®ä¼šè¯çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœæœªè®¾ç½®è¯¥å±æ€§ï¼Œåˆ™è‡ªåŠ¨é…ç½®å°†ä½¿ç”¨ <code>server.servlet.session.timeout</code> çš„å€¼ã€‚</p><p><a id="boot-features-jmx"></a></p><h2 id="44ã€é€šè¿‡-JMX-ç›‘æ§å’Œç®¡ç†">44ã€é€šè¿‡ JMX ç›‘æ§å’Œç®¡ç†</h2><p>Java Management Extensionsï¼ˆJMXï¼ŒJava ç®¡ç†æ‰©å±•ï¼‰æä¾›äº†ä¸€ç§ç›‘è§†å’Œç®¡ç†åº”ç”¨ç¨‹åºçš„æ ‡å‡†æœºåˆ¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot ä¼šåˆ›å»ºä¸€ä¸ª ID ä¸º <code>mbeanServer</code> çš„ <code>MBeanServer</code> beanï¼Œå¹¶æš´éœ²ä½¿ç”¨ Spring JMX æ³¨è§£ï¼ˆ<code>@ManagedResource</code>ã€<code>@ManagedAttribute</code> æˆ– <code>@ManagedOperation</code>ï¼‰çš„ beanã€‚</p><p>æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.2.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jmx/JmxAutoConfiguration.java"><code>JmxAutoConfiguration</code></a> ç±»ã€‚</p><p><a id="boot-features-testing"></a></p><h2 id="45ã€æµ‹è¯•">45ã€æµ‹è¯•</h2><p><a id="boot-features-websockets"></a></p><h2 id="46ã€WebSocket">46ã€WebSocket</h2><p>Spring Boot ä¸ºå†…åµŒå¼ Tomcatã€Jetty å’Œ Undertow æä¾›äº† WebSocket è‡ªåŠ¨é…ç½®ã€‚å¦‚æœå°† war æ–‡ä»¶éƒ¨ç½²åˆ°ç‹¬ç«‹å®¹å™¨ï¼Œåˆ™ Spring Boot å‡å®šå®¹å™¨è´Ÿè´£é…ç½®å…¶ WebSocket æ”¯æŒã€‚</p><p>Spring Framework ä¸º MVC Web åº”ç”¨ç¨‹åºæä¾›äº†<a href="https://docs.spring.io/spring/docs/5.1.4.RELEASE/spring-framework-reference/web.html#websocket">ä¸°å¯Œçš„ WebSocket æ”¯æŒ</a>ï¼Œå¯ä»¥é€šè¿‡ <code>spring-boot-starter-websocket</code> æ¨¡å—è½»æ¾è®¿é—®ã€‚</p><p>WebSocket æ”¯æŒä¹Ÿå¯ç”¨äº<a href="https://docs.spring.io/spring/docs/5.1.4.RELEASE/spring-framework-reference/web-reactive.html#webflux-websocket">å“åº”å¼ Web åº”ç”¨ç¨‹åº</a>ï¼Œå¹¶ä¸”å¼•å…¥ WebSocket API ä»¥åŠ <code>spring-boot-starter-webflux</code>ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.websocket<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.websocket-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a id="boot-features-webservices"></a></p><h2 id="47ã€Web-Service">47ã€Web Service</h2><p>Spring Boot æä¾› Web Service è‡ªåŠ¨é…ç½®ï¼Œå› æ­¤æ‚¨è¦åšçš„å°±æ˜¯å®šä¹‰ <code>Endpoints</code>ã€‚</p><p>å¯ä»¥ä½¿ç”¨ <code>spring-boot-starter-webservices</code> æ¨¡å—è½»æ¾è®¿é—® <a href="https://docs.spring.io/spring-ws/docs/3.0.6.RELEASE/reference/">Spring Web Service åŠŸèƒ½</a>ã€‚</p><p>å¯ä»¥åˆ†åˆ«ä¸º WSDL å’Œ XSD è‡ªåŠ¨åˆ›å»º <code>SimpleWsdl11Definition</code> å’Œ <code>SimpleXsdSchema</code> beanã€‚ä¸ºæ­¤ï¼Œè¯·é…ç½®å…¶ä½ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.webservices.wsdl-locations</span>=classpath:/wsdl</span><br></pre></td></tr></table></figure><p><a id="boot-features-webservices-template"></a></p><h3 id="47-1ã€ä½¿ç”¨-WebServiceTemplate-è°ƒç”¨-Web-Service">47.1ã€ä½¿ç”¨ <code>WebServiceTemplate</code> è°ƒç”¨ Web Service</h3><p>å¦‚æœæ‚¨éœ€è¦ä»åº”ç”¨ç¨‹åºè°ƒç”¨è¿œç¨‹ Web æœåŠ¡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code>WebServiceTemplate</code> ç±»ã€‚ç”±äº <code>WebServiceTemplate</code> å®ä¾‹åœ¨ä½¿ç”¨ä¹‹å‰é€šå¸¸éœ€è¦è¿›è¡Œè‡ªå®šä¹‰ï¼Œå› æ­¤ Spring Boot ä¸æä¾›ä»»ä½•è‡ªåŠ¨é…ç½®çš„ <code>WebServiceTemplate</code> beanã€‚ä½†æ˜¯ï¼Œå®ƒä¼šè‡ªåŠ¨é…ç½® <code>WebServiceTemplateBuilder</code>ï¼Œå¯åœ¨éœ€è¦åˆ›å»º <code>WebServiceTemplate</code> å®ä¾‹æ—¶ä½¿ç”¨ã€‚</p><p>ä»¥ä¸‹ä»£ç ä¸ºä¸€ä¸ªå…¸å‹ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> WebServiceTemplate webServiceTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">MyService</span><span class="params">(WebServiceTemplateBuilder webServiceTemplateBuilder)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.webServiceTemplate = webServiceTemplateBuilder.build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> DetailsResp <span class="title function_">someWsCall</span><span class="params">(DetailsReq detailsReq)</span> &#123;</span><br><span class="line"> <span class="keyword">return</span> (DetailsResp) <span class="built_in">this</span>.webServiceTemplate.marshalSendAndReceive(detailsReq, <span class="keyword">new</span> <span class="title class_">SoapActionCallback</span>(ACTION));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>WebServiceTemplateBuilder</code> ä½¿ç”¨ classpath ä¸Šçš„å¯ç”¨ HTTP å®¢æˆ·ç«¯åº“æ£€æµ‹åˆé€‚çš„åŸºäº HTTP çš„ <code>WebServiceMessageSender</code>ã€‚æ‚¨è¿˜å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼è‡ªå®šä¹‰è¯»å–å’Œè¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> WebServiceTemplate <span class="title function_">webServiceTemplate</span><span class="params">(WebServiceTemplateBuilder builder)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> builder.messageSenders(<span class="keyword">new</span> <span class="title class_">HttpWebServiceMessageSenderBuilder</span>()</span><br><span class="line">.setConnectTimeout(<span class="number">5000</span>).setReadTimeout(<span class="number">2000</span>).build()).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="boot-features-developing-auto-configuration"></a></p><h2 id="49ã€åˆ›å»ºè‡ªå·±çš„è‡ªåŠ¨é…ç½®">49ã€åˆ›å»ºè‡ªå·±çš„è‡ªåŠ¨é…ç½®</h2><p>å¦‚æœæ‚¨åœ¨å…¬å¸è´Ÿè´£å¼€å‘å…¬å…±ç±»åº“ï¼Œæˆ–è€…å¦‚æœæ‚¨åœ¨å¼€å‘ä¸€ä¸ªå¼€æºæˆ–å•†ä¸šåº“ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å¼€å‘è‡ªå·±çš„è‡ªåŠ¨é…ç½®ã€‚è‡ªåŠ¨é…ç½®ç±»å¯ä»¥æ†ç»‘åœ¨å¤–éƒ¨ jar ä¸­ï¼Œä»–ä»ç„¶å¯ä»¥è¢« Spring Boot è·å–ã€‚</p><p>è‡ªåŠ¨é…ç½®å¯ä»¥ä¸æä¾›è‡ªåŠ¨é…ç½®ä»£ç çš„ starter ä»¥åŠæ‚¨å°†ä½¿ç”¨çš„ç±»åº“åº“ç›¸å…³è”ã€‚æˆ‘ä»¬é¦–å…ˆä»‹ç»æ„å»ºè‡ªå·±çš„è‡ªåŠ¨é…ç½®éœ€è¦äº†è§£çš„å†…å®¹ï¼Œç„¶åæˆ‘ä»¬å°†ç»§ç»­ä»‹ç»<a href="#boot-features-custom-starter">åˆ›å»ºè‡ªå®šä¹‰ starter æ‰€éœ€çš„æ­¥éª¤</a>ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>è¿™é‡Œæœ‰ä¸€ä¸ª<a href="https://github.com/snicoll-demos/spring-boot-master-auto-configuration">æ¼”ç¤ºé¡¹ç›®</a>å±•ç¤ºäº†å¦‚ä½•é€æ­¥åˆ›å»º starterã€‚</p></blockquote><p><a id="boot-features-understanding-auto-configured-beans"></a></p><h3 id="49-1ã€ç†è§£è‡ªå®šé…ç½®-Bean">49.1ã€ç†è§£è‡ªå®šé…ç½® Bean</h3><p>åœ¨å†…éƒ¨ï¼Œè‡ªåŠ¨é…ç½®ä½¿ç”¨äº†æ ‡å‡†çš„ <code>@Configuration</code> ç±»æ¥å®ç°ã€‚<code>@Conditional</code> æ³¨è§£ç”¨äºçº¦æŸä½•æ—¶åº”ç”¨è‡ªåŠ¨é…ç½®ã€‚é€šå¸¸ï¼Œè‡ªåŠ¨é…ç½®ç±»ä½¿ç”¨ <code>@ConditionalOnClass</code> å’Œ <code>@ConditionalOnMissingBean</code> æ³¨è§£ã€‚è¿™å¯ç¡®ä¿ä»…åœ¨æ‰¾åˆ°ç›¸å…³ç±»æ—¶ä»¥åŠæœªå£°æ˜æ‚¨è‡ªå·±çš„ <code>@Configuration</code> æ—¶æ‰åº”ç”¨è‡ªåŠ¨é…ç½®ã€‚</p><p>æ‚¨å¯ä»¥æµè§ˆ <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure"><code>spring-boot-autoconfigure</code></a> çš„æºä»£ç ï¼Œä»¥æŸ¥çœ‹ Spring æä¾›çš„ <code>@Configuration</code> ç±»ï¼ˆè¯·å‚é˜… <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/resources/META-INF/spring.factories"><code>META-INF/spring.factories</code></a> æ–‡ä»¶ï¼‰ã€‚</p><p><a id="boot-features-locating-auto-configuration-candidates"></a></p><h3 id="49-2ã€æ‰¾åˆ°å€™é€‰çš„è‡ªåŠ¨é…ç½®">49.2ã€æ‰¾åˆ°å€™é€‰çš„è‡ªåŠ¨é…ç½®</h3><p>Spring Boot ä¼šæ£€æŸ¥å·²å‘å¸ƒ jar ä¸­æ˜¯å¦å­˜åœ¨ <code>META-INF/spring.factories</code> æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶åº”åˆ—å‡º <code>EnableAutoConfiguration</code> key ä¸‹çš„é…ç½®ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=\</span><br><span class="line">com.mycorp.libx.autoconfigure.LibXAutoConfiguration,\</span><br><span class="line">com.mycorp.libx.autoconfigure.LibXWebAutoConfiguration</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p><strong>å¿…é¡»</strong>ä»¥è¿™ç§æ–¹å¼åŠ è½½è‡ªåŠ¨é…ç½®ã€‚ç¡®ä¿å®ƒä»¬åœ¨ç‰¹å®šçš„åŒ…ç©ºé—´ä¸­å®šä¹‰ï¼Œå¹¶ä¸”å®ƒä»¬ä¸èƒ½æ˜¯ç»„ä»¶æ‰«æçš„ç›®æ ‡ã€‚æ­¤å¤–ï¼Œè‡ªåŠ¨é…ç½®ç±»ä¸åº”å¯ç”¨ç»„ä»¶æ‰«æä»¥æŸ¥æ‰¾å…¶ä»–ç»„ä»¶ã€‚åº”è¯¥ä½¿ç”¨ç‰¹å®šçš„<code>@Imports</code> æ¥ä»£æ›¿ã€‚</p></blockquote><p>å¦‚æœéœ€è¦æŒ‰ç‰¹å®šé¡ºåºåº”ç”¨é…ç½®ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/AutoConfigureAfter.java"><code>@AutoConfigureAfter</code></a> æˆ– <a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/AutoConfigureBefore.java"><code>@AutoConfigureBefore</code></a> æ³¨è§£ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æä¾›ç‰¹å®šäº Web çš„é…ç½®ï¼Œåˆ™å¯èƒ½éœ€è¦åœ¨<code>WebMvcAutoConfiguration</code> ä¹‹ååº”ç”¨æ‚¨çš„ç±»ã€‚</p><p>å¦‚æœæ‚¨æƒ³æ’åºæŸäº›ä¸åº”è¯¥å½¼æ­¤ç›´æ¥äº†è§£çš„è‡ªåŠ¨é…ç½®ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>@AutoConfigureOrder</code>ã€‚è¯¥æ³¨è§£ä¸å¸¸è§„ <code>@Order</code> æ³¨è§£æœ‰ç›¸åŒçš„è¯­ä¹‰ï¼Œä½†å®ƒä¸ºè‡ªåŠ¨é…ç½®ç±»æä¾›äº†ä¸“ç”¨é¡ºåºã€‚</p><p><a id="boot-features-condition-annotations"></a></p><h3 id="49-3ã€æ¡ä»¶æ³¨è§£">49.3ã€æ¡ä»¶æ³¨è§£</h3><p>æ‚¨å‡ ä¹æ€»å¸Œæœ›åœ¨è‡ªåŠ¨é…ç½®ç±»ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª <code>@Conditional</code> æ³¨è§£ã€‚<code>@ConditionalOnMissingBean</code> æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ³¨è§£ï¼Œå…¶å…è®¸å¼€å‘äººå‘˜åœ¨å¯¹æ‚¨çš„é»˜è®¤å€¼ä¸æ»¡æ„ç”¨äºè¦†ç›–è‡ªåŠ¨é…ç½®ã€‚</p><p>Spring Boot åŒ…å«è®¸å¤š <code>@Conditional</code> æ³¨è§£ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ³¨è§£ <code>@Configuration</code> ç±»æˆ–å•ç‹¬çš„ <code>@Bean</code> æ–¹æ³•åœ¨æ‚¨è‡ªå·±çš„ä»£ç ä¸­å¤ç”¨å®ƒä»¬ã€‚è¿™äº›æ³¨è§£åŒ…æ‹¬ï¼š</p><ul><li><a href="#boot-features-class-conditions">ç¬¬ 49.3.1 èŠ‚ï¼Œç±»æ¡ä»¶</a></li><li><a href="#boot-features-bean-conditions">ç¬¬ 49.3.2 èŠ‚ï¼ŒBean æ¡ä»¶</a></li><li><a href="#boot-features-property-conditions">ç¬¬ 49.3.3 èŠ‚ï¼Œå±æ€§æ¡ä»¶</a></li><li><a href="#boot-features-resource-conditions">ç¬¬ 49.3.4 èŠ‚ï¼Œèµ„æºæ¡ä»¶</a></li><li><a href="#boot-features-web-application-conditions">ç¬¬ 49.3.5 èŠ‚ï¼ŒWeb åº”ç”¨ç¨‹åºæ¡ä»¶</a></li><li><a href="#boot-features-spel-conditions">ç¬¬ 49.3.6 èŠ‚ï¼ŒSpEL è¡¨è¾¾å¼æ¡ä»¶</a></li></ul><p><a id="boot-features-class-conditions"></a></p><h4 id="49-3-1ã€ç±»æ¡ä»¶">49.3.1ã€ç±»æ¡ä»¶</h4><p><code>@ConditionalOnClass</code> å’Œ <code>@ConditionalOnMissingClass</code> æ³¨è§£å…è®¸æ ¹æ®ç‰¹å®šç±»çš„æ˜¯å¦å­˜åœ¨æ¥åŒ…å« <code>@Configuration</code> ç±»ã€‚ç”±äºä½¿ç”¨ <a href="http://asm.ow2.org/">ASM</a> è§£ææ³¨è§£å…ƒæ•°æ®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>value</code> å±æ€§æ¥å¼•ç”¨çœŸå®ç±»ï¼Œå³ä½¿è¯¥ç±»å®é™…ä¸Šå¯èƒ½ä¸ä¼šå‡ºç°åœ¨æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºçš„ classpath ä¸­ã€‚å¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨ <code>String</code> å€¼æ¥æŒ‡å®šç±»åï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>name</code> å±æ€§ã€‚</p><p>æ­¤æœºåˆ¶ä¸ä¼šä»¥ç›¸åŒçš„æ–¹å¼åº”ç”¨äºè¿”å›ç±»å‹æ˜¯æ¡ä»¶çš„ç›®æ ‡çš„ <code>@Bean</code> æ–¹æ³•ï¼šåœ¨æ–¹æ³•ä¸Šçš„æ¡ä»¶åº”ç”¨ä¹‹å‰ï¼ŒJVM å°†åŠ è½½ç±»å’Œå¯èƒ½å¤„ç†çš„æ–¹æ³•å¼•ç”¨ï¼Œå¦‚æœæ‰¾ä¸åˆ°ç±»ï¼Œå°†å‘ç”Ÿå¤±è´¥ã€‚</p><p>è¦å¤„ç†è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨å•ç‹¬çš„ <code>@Configuration</code> ç±»æ¥éš”ç¦»æ¡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// Some conditions</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Auto-configured beans</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(EmbeddedAcmeService.class)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EmbeddedConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="keyword">public</span> EmbeddedAcmeService <span class="title function_">embeddedAcmeService</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœä½¿ç”¨ <code>@ConditionalOnClass</code> æˆ– <code>@ConditionalOnMissingClass</code> ä½œä¸ºå…ƒæ³¨è§£çš„ä¸€éƒ¨åˆ†æ¥ç»„æˆè‡ªå·±çš„ç»„åˆæ³¨è§£ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ <code>name</code> æ¥å¼•ç”¨ç±»ï¼Œåœ¨è¿™ç§æƒ…å†µå°†ä¸ä½œå¤„ç†ã€‚</p></blockquote><p><a id="boot-features-bean-conditions"></a></p><h4 id="49-3-2ã€Bean-æ¡ä»¶">49.3.2ã€Bean æ¡ä»¶</h4><p><code>@ConditionalOnBean</code> å’Œ <code>@ConditionalOnMissingBean</code> æ³¨è§£å…è®¸æ ¹æ®ç‰¹å®š bean æ˜¯å¦å­˜åœ¨æ¥åŒ…å« beanã€‚æ‚¨å¯ä»¥ä½¿ç”¨ <code>value</code> å±æ€§æŒ‰ç±»å‹æˆ–ä½¿ç”¨ <code>name</code> æ¥æŒ‡å®š beanã€‚<code>search</code> å±æ€§å…è®¸æ‚¨é™åˆ¶åœ¨æœç´¢ bean æ—¶åº”è€ƒè™‘çš„ <code>ApplicationContext</code> å±‚æ¬¡ç»“æ„ã€‚</p><p>æ”¾ç½®åœ¨ <code>@Bean</code> æ–¹æ³•ä¸Šæ—¶ï¼Œç›®æ ‡ç±»å‹é»˜è®¤ä¸ºæ–¹æ³•çš„è¿”å›ç±»å‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="keyword">public</span> MyService <span class="title function_">myService</span><span class="params">()</span> &#123; ... &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œå¦‚æœ <code>ApplicationContext</code> ä¸­ä¸åŒ…å« <code>MyService</code> ç±»å‹çš„ beanï¼Œåˆ™å°†åˆ›å»º <code>myService</code> beanã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>æ‚¨éœ€è¦éå¸¸å°å¿ƒåœ°æ·»åŠ  bean å®šä¹‰çš„é¡ºåºï¼Œå› ä¸ºè¿™äº›æ¡ä»¶æ˜¯æ ¹æ®åˆ°ç›®å‰ä¸ºæ­¢å·²å¤„ç†çš„å†…å®¹è¿›è¡Œè®¡ç®—çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å»ºè®®åœ¨è‡ªåŠ¨é…ç½®ç±»ä¸Šä»…ä½¿ç”¨ <code>@ConditionalOnBean</code> å’Œ <code>@ConditionalOnMissingBean</code> æ³¨è§£ï¼ˆå› ä¸ºè¿™äº›æ³¨è§£ä¿è¯åœ¨æ·»åŠ æ‰€æœ‰ç”¨æˆ·å®šä¹‰çš„ bean å®šä¹‰ååŠ è½½ï¼‰ã€‚</p></blockquote><p><strong>æ³¨æ„</strong></p><blockquote><p><code>@ConditionalOnBean</code> å’Œ <code>@ConditionalOnMissingBean</code> ä¸ä¼šé˜»æ­¢åˆ›å»º <code>@Configuration</code> ç±»ã€‚åœ¨ç±»çº§åˆ«ä½¿ç”¨è¿™äº›æ¡ä»¶å¹¶ä½¿ç”¨æ³¨è§£æ ‡è®°æ¯ä¸ªåŒ…å« <code>@Bean</code> æ–¹æ³•çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼Œå¦‚æœæ¡ä»¶ä¸åŒ¹é…ï¼Œå‰è€…ä¼šé˜»æ­¢å°† <code>@Configuration</code> ç±»æ³¨å†Œä¸º beanã€‚</p></blockquote><p><a id="boot-features-property-conditions"></a></p><h4 id="49-3-3ã€å±æ€§æ¡ä»¶">49.3.3ã€å±æ€§æ¡ä»¶</h4><p><code>@ConditionalOnProperty</code> æ³¨è§£å…è®¸åŸºäº Spring Environment å±æ€§åŒ…å«é…ç½®ã€‚ä½¿ç”¨ <code>prefix</code> å’Œ <code>name</code> å±æ€§æŒ‡å®šéœ€è¦æ£€æŸ¥çš„å±æ€§ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒ¹é…å­˜åœ¨ä¸”ä¸ç­‰äº <code>false</code> çš„æ‰€æœ‰å±æ€§ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <code>havingValue</code> å’Œ <code>matchIfMissing</code> å±æ€§åˆ›å»ºæ›´é«˜çº§çš„æ£€æŸ¥ã€‚</p><p><a id="boot-features-resource-conditions"></a></p><h4 id="49-3-4ã€èµ„æºæ¡ä»¶">49.3.4ã€èµ„æºæ¡ä»¶</h4><p><code>@ConditionalOnResource</code> æ³¨è§£ä»…å…è®¸åœ¨å­˜åœ¨ç‰¹å®šèµ„æºæ—¶åŒ…å«é…ç½®ã€‚å¯ä»¥ä½¿ç”¨å¸¸ç”¨çš„ Spring çº¦å®šæ¥æŒ‡å®šèµ„æºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<code>file:/home/user/test.dat</code>ã€‚</p><p><a id="boot-features-web-application-conditions"></a></p><h4 id="49-3-5ã€Web-åº”ç”¨ç¨‹åºæ¡ä»¶">49.3.5ã€Web åº”ç”¨ç¨‹åºæ¡ä»¶</h4><p><code>@ConditionalOnWebApplication</code> å’Œ <code>@ConditionalOnNotWebApplication</code> æ³¨è§£åœ¨åº”ç”¨ç¨‹åºä¸º <strong>Web åº”ç”¨ç¨‹åº</strong>çš„æƒ…å†µä¸‹æ˜¯å¦åŒ…å«é…ç½®ã€‚Web åº”ç”¨ç¨‹åºæ˜¯ä½¿ç”¨ Spring <code>WebApplicationContext</code>ï¼Œå®šä¹‰ä¸€ä¸ª <code>session</code> èŒƒå›´æˆ–å…·æœ‰ <code>StandardServletEnvironment</code> çš„ä»»ä½•åº”ç”¨ç¨‹åºã€‚</p><p><a id="boot-features-spel-conditions"></a></p><h4 id="49-3-6ã€SpEL-è¡¨è¾¾å¼æ¡ä»¶">49.3.6ã€SpEL è¡¨è¾¾å¼æ¡ä»¶</h4><p><code>@ConditionalOnExpression</code> æ³¨è§£å…è®¸æ ¹æ® <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/core.html#expressions">SpEL è¡¨è¾¾å¼</a>çš„ç»“æœåŒ…å«é…ç½®ã€‚</p><p><a id="boot-features-test-autoconfig"></a></p><h4 id="49-4ã€æµ‹è¯•è‡ªåŠ¨é…ç½®">49.4ã€æµ‹è¯•è‡ªåŠ¨é…ç½®</h4><p>è‡ªåŠ¨é…ç½®å¯èƒ½å—è®¸å¤šå› ç´ çš„å½±å“ï¼šç”¨æˆ·é…ç½®ï¼ˆ<code>@Bean</code> å®šä¹‰å’Œ <code>Environment</code> è‡ªå®šä¹‰ï¼‰ã€æ¡ä»¶è¯„ä¼°ï¼ˆå­˜åœ¨ç‰¹å®šçš„ç±»åº“ï¼‰ç­‰ã€‚å…·ä½“è€Œè¨€ï¼Œæ¯ä¸ªæµ‹è¯•éƒ½åº”è¯¥åˆ›å»ºä¸€ä¸ªå®šä¹‰è‰¯å¥½çš„ <code>ApplicationContext</code>ï¼Œå®ƒè¡¨ç¤ºè¿™äº›è‡ªå®šä¹‰çš„ç»„åˆã€‚<code>ApplicationContextRunner</code> æä¾›äº†ä¸€ä¸ªå¥½çš„å®ç°æ–¹æ³•ã€‚</p><p><code>ApplicationContextRunner</code> é€šå¸¸è¢«å®šä¹‰ä¸ºæµ‹è¯•ç±»çš„ä¸€ä¸ªå­—æ®µï¼Œç”¨äºæ”¶é›†åŸºæœ¬çš„é€šç”¨é…ç½®ã€‚ä»¥ä¸‹ç¤ºä¾‹ç¡®ä¿å§‹ç»ˆè°ƒç”¨ <code>UserServiceAutoConfiguration</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ApplicationContextRunner</span> <span class="variable">contextRunner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApplicationContextRunner</span>()</span><br><span class="line">.withConfiguration(AutoConfigurations.of(UserServiceAutoConfiguration.class));</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœå¿…é¡»å®šä¹‰å¤šä¸ªè‡ªåŠ¨é…ç½®ï¼Œåˆ™æ— éœ€æŒ‰ç…§ä¸è¿è¡Œåº”ç”¨ç¨‹åºæ—¶å®Œå…¨ç›¸åŒçš„é¡ºåºè°ƒç”¨å®ƒä»¬çš„å£°æ˜ã€‚</p></blockquote><p>æ¯ä¸ªæµ‹è¯•éƒ½å¯ä»¥ä½¿ç”¨ runner æ¥è¡¨ç¤ºç‰¹å®šçš„ç”¨ä¾‹ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ç¤ºä¾‹è°ƒç”¨ç”¨æˆ·é…ç½®ï¼ˆ<code>UserConfiguration</code>ï¼‰å¹¶æ£€æŸ¥è‡ªåŠ¨é…ç½®æ˜¯å¦æ­£ç¡®é€€å›ã€‚è°ƒç”¨ <code>run</code> æä¾›äº†ä¸€ä¸ªå¯ä»¥ä¸ <code>Assert4J</code> ä¸€èµ·ä½¿ç”¨çš„å›è°ƒä¸Šä¸‹æ–‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">defaultServiceBacksOff</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.contextRunner.withUserConfiguration(UserConfiguration.class)</span><br><span class="line">.run((context) -&gt; &#123;</span><br><span class="line">assertThat(context).hasSingleBean(UserService.class);</span><br><span class="line">assertThat(context.getBean(UserService.class)).isSameAs(</span><br><span class="line">context.getBean(UserConfiguration.class).myUserService());</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">UserConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> UserService <span class="title function_">myUserService</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserService</span>(<span class="string">&quot;mine&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è½»æ¾è‡ªå®šä¹‰ <code>Environment</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">serviceNameCanBeConfigured</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.contextRunner.withPropertyValues(<span class="string">&quot;user.name=test123&quot;</span>).run((context) -&gt; &#123;</span><br><span class="line">assertThat(context).hasSingleBean(UserService.class);</span><br><span class="line">assertThat(context.getBean(UserService.class).getName()).isEqualTo(<span class="string">&quot;test123&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>runner è¿˜å¯ç”¨äºå±•ç¤º <code>ConditionEvaluationReport</code>ã€‚æŠ¥å‘Šå¯ä»¥åœ¨ <code>INFO</code> æˆ– <code>DEBUG</code> çº§åˆ«ä¸‹æ‰“å°ã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºå¦‚ä½•ä½¿ç”¨ <code>ConditionEvaluationReportLoggingListener</code> åœ¨è‡ªåŠ¨é…ç½®æµ‹è¯•ä¸­æ‰“å°æŠ¥è¡¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> autoConfigTest &#123;</span><br><span class="line"><span class="type">ConditionEvaluationReportLoggingListener</span> <span class="variable">initializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConditionEvaluationReportLoggingListener</span>(</span><br><span class="line">LogLevel.INFO);</span><br><span class="line"><span class="type">ApplicationContextRunner</span> <span class="variable">contextRunner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApplicationContextRunner</span>()</span><br><span class="line">.withInitializer(initializer).run((context) -&gt; &#123;</span><br><span class="line"><span class="comment">// Do something...</span></span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="_simulating_a_web_context"></a></p><h4 id="49-4-1ã€æ¨¡æ‹Ÿä¸€ä¸ª-Web-ä¸Šä¸‹æ–‡">49.4.1ã€æ¨¡æ‹Ÿä¸€ä¸ª Web ä¸Šä¸‹æ–‡</h4><p>å¦‚æœéœ€è¦æµ‹è¯•ä¸€ä¸ªä»…åœ¨ Servlet æˆ–å“åº”å¼ Web åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­è¿è¡Œçš„è‡ªåŠ¨é…ç½®ï¼Œè¯·åˆ†åˆ«ä½¿ç”¨ <code>WebApplicationContextRunner</code> æˆ– <code>ReactiveWebApplicationContextRunner</code>ã€‚</p><p><a id="_overriding_the_classpath"></a></p><h4 id="49-4-2ã€è¦†ç›–-Classpath">49.4.2ã€è¦†ç›– Classpath</h4><p>è¿˜å¯ä»¥æµ‹è¯•åœ¨è¿è¡Œæ—¶ä¸å­˜åœ¨ç‰¹å®šç±»å’Œ/æˆ–åŒ…æ—¶å‘ç”Ÿçš„æƒ…å†µã€‚ Spring Booté™„å¸¦äº†ä¸€ä¸ªå¯ä»¥ç”±è·‘æ­¥è€…è½»æ¾ä½¿ç”¨çš„FilteredClassLoaderã€‚ åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å£°æ˜å¦‚æœUserServiceä¸å­˜åœ¨ï¼Œåˆ™ä¼šæ­£ç¡®ç¦ç”¨è‡ªåŠ¨é…ç½®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">serviceIsIgnoredIfLibraryIsNotPresent</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.contextRunner.withClassLoader(<span class="keyword">new</span> <span class="title class_">FilteredClassLoader</span>(UserService.class))</span><br><span class="line">.run((context) -&gt; assertThat(context).doesNotHaveBean(<span class="string">&quot;userService&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="boot-features-custom-starter"></a></p><h3 id="49-5ã€åˆ›å»ºè‡ªå·±çš„-Starter">49.5ã€åˆ›å»ºè‡ªå·±çš„ Starter</h3><p>ä¸€ä¸ªå®Œæ•´çš„ Spring Boot starter ç±»åº“å¯èƒ½åŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š</p><ul><li><code>autoconfigure</code> æ¨¡å—ï¼ŒåŒ…å«è‡ªåŠ¨é…ç½®ä»£ç ã€‚</li><li><code>starter</code> æ¨¡å—ï¼Œå®ƒæä¾›å¯¹ <code>autoconfigure</code> æ¨¡å—ä¾èµ–å…³ç³»ä»¥åŠç±»åº“å’Œå¸¸ç”¨çš„å…¶ä»–ä¾èµ–å…³ç³»ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæ·»åŠ  starter åº”è¯¥æä¾›è¯¥åº“å¼€å§‹ä½¿ç”¨æ‰€éœ€çš„ä¸€åˆ‡ã€‚</li></ul><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœæ‚¨ä¸æƒ³å°†è¿™ä¸¤ä¸ªæ¨¡å—åˆ†å¼€ï¼Œåˆ™å¯ä»¥å°†è‡ªåŠ¨é…ç½®ä»£ç å’Œä¾èµ–å…³ç³»ç®¡ç†ç»„åˆåœ¨ä¸€ä¸ªæ¨¡å—ä¸­ã€‚</p></blockquote><p><a id="boot-features-custom-starter-naming"></a></p><h4 id="49-5-1ã€å‘½å">49.5.1ã€å‘½å</h4><p>æ‚¨åº”è¯¥ç¡®ä¿ä¸ºæ‚¨çš„ starter æä¾›ä¸€ä¸ªåˆé€‚çš„å‘½åç©ºé—´ã€‚å³ä½¿æ‚¨ä½¿ç”¨å…¶ä»– Maven <code>groupId</code>ï¼Œä¹Ÿä¸è¦ä½¿ç”¨ <code>spring-boot</code> ä½œä¸ºæ¨¡å—åç§°çš„å¼€å¤´ã€‚æˆ‘ä»¬å¯èƒ½ä¼šä¸ºæ‚¨ä»¥åè‡ªåŠ¨é…ç½®çš„å†…å®¹æä¾›å®˜æ–¹æ”¯æŒã€‚</p><p>æ ¹æ®ç»éªŒï¼Œæ‚¨åº”è¯¥åœ¨ starter åå‘½åä¸€ä¸ªç»„åˆæ¨¡å—ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æ­£åœ¨ä¸º <strong>acme</strong> åˆ›å»ºä¸€ä¸ª starterï¼Œå¹¶ä¸”æ‚¨å°†è‡ªåŠ¨é…ç½®æ¨¡å—å‘½åä¸º <code>acme-spring-boot-autoconfigure</code>ï¼Œå°† starter å‘½åä¸º <code>acme-spring-boot-starter</code>ã€‚å¦‚æœæ‚¨åªæœ‰ä¸€ä¸ªç»„åˆè¿™ä¸¤è€…çš„æ¨¡å—ï¼Œè¯·å°†å…¶å‘½åä¸º <code>acme-spring-boot-starter</code>ã€‚</p><p>æ­¤å¤–ï¼Œå¦‚æœæ‚¨çš„ starter æä¾›é…ç½® keyï¼Œè¯·ä¸ºå®ƒä»¬ä½¿ç”¨å”¯ä¸€çš„å‘½åç©ºé—´ã€‚å°¤å…¶æ˜¯ï¼Œä¸è¦å°†æ‚¨çš„ key åŒ…å«åœ¨ Spring Boot ä½¿ç”¨çš„å‘½åç©ºé—´ä¸­ï¼ˆä¾‹å¦‚ <code>server</code>ã€<code>management</code>ã€<code>spring</code> ç­‰ï¼‰ã€‚å¦‚æœæ‚¨ä½¿ç”¨äº†ç›¸åŒçš„å‘½åç©ºé—´ï¼Œæˆ‘ä»¬å°†æ¥å¯èƒ½ä¼šä»¥ç ´åæ‚¨çš„æ¨¡å—çš„æ–¹å¼æ¥ä¿®æ”¹è¿™äº›å‘½åç©ºé—´ã€‚</p><p>ç¡®<a href="#configuration-metadata-annotation-processor">ä¿è§¦å‘å…ƒæ•°æ®ç”Ÿæˆ</a>ï¼Œä»¥ä¾¿ä¸ºæ‚¨çš„ key æä¾› IDE å¸®åŠ©ã€‚æ‚¨å¯èƒ½æƒ³æŸ¥çœ‹ç”Ÿæˆçš„å…ƒæ•°æ®ï¼ˆ<code>META-INF/spring-configuration-metadata.json</code>ï¼‰ä»¥ç¡®ä¿æ‚¨çš„ key è®°å½•æ˜¯å¦æ­£ç¡®ã€‚</p><p><a id="boot-features-custom-starter-module-autoconfigure"></a></p><h4 id="49-5-2ã€autoconfigure-æ¨¡å—">49.5.2ã€<code>autoconfigure</code> æ¨¡å—</h4><p><code>autoconfigure</code> æ¨¡å—åŒ…å«ç±»åº“å¼€å§‹ä½¿ç”¨æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ã€‚å®ƒè¿˜å¯ä»¥åŒ…å«é…ç½® key å®šä¹‰ï¼ˆä¾‹å¦‚ <code>@ConfigurationProperties</code>ï¼‰å’Œä»»ä½•å¯ç”¨äºè¿›ä¸€æ­¥è‡ªå®šä¹‰ç»„ä»¶åˆå§‹åŒ–æ–¹å¼çš„å›è°ƒæ¥å£ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>æ‚¨åº”è¯¥å°†ç±»åº“çš„ä¾èµ–é¡¹æ ‡è®°ä¸ºå¯é€‰ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥æ›´è½»æ¾åœ°åœ¨é¡¹ç›®ä¸­åŒ…å« <code>autoconfigure</code> æ¨¡å—ã€‚å¦‚æœä»¥è¿™ç§æ–¹å¼æ‰§è¡Œï¼Œåˆ™ä¸æä¾›ç±»åº“ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot å°†ä¼šé€€å‡ºã€‚</p></blockquote><p>Spring Boot ä½¿ç”¨æ³¨è§£å¤„ç†å™¨æ¥æ”¶é›†å…ƒæ•°æ®æ–‡ä»¶ï¼ˆ<code>META-INF/spring-autoconfigure-metadata.properties</code>ï¼‰ä¸­è‡ªåŠ¨é…ç½®çš„æ¡ä»¶ã€‚å¦‚æœè¯¥æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™ç”¨äºå¿«é€Ÿè¿‡æ»¤ä¸åŒ¹é…çš„è‡ªåŠ¨é…ç½®ï¼Œç¼©çŸ­å¯åŠ¨æ—¶é—´ã€‚å»ºè®®åœ¨åŒ…å«è‡ªåŠ¨é…ç½®çš„æ¨¡å—ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–é¡¹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ Gradle 4.5 åŠæ›´æ—©ç‰ˆæœ¬æ—¶ï¼Œåº”åœ¨ <code>compileOnly</code> é…ç½®ä¸­å£°æ˜ä¾èµ–é¡¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">compileOnly <span class="string">&quot;org.springframework.boot:spring-boot-autoconfigure-processor&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ Gradle 4.6 åŠæ›´é«˜ç‰ˆæœ¬æ—¶ï¼Œåº”åœ¨ <code>annotationProcessor</code> é…ç½®ä¸­å£°æ˜ä¾èµ–é¡¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">annotationProcessor <span class="string">&quot;org.springframework.boot:spring-boot-autoconfigure-processor&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="boot-features-custom-starter-module-starter"></a></p><h4 id="49-5-3ã€Starter-æ¨¡å—">49.5.3ã€Starter æ¨¡å—</h4><p>starter çœŸçš„æ˜¯ä¸€ä¸ªç©º jarã€‚å®ƒçš„å”¯ä¸€ç›®çš„æ˜¯ä¸ºä½¿ç”¨ç±»åº“æä¾›å¿…è¦çš„ä¾èµ–é¡¹ã€‚æ‚¨å¯ä»¥å°†å…¶è§†ä¸ºä½¿ç”¨ç±»åº“çš„ä¸€åˆ‡åŸºç¡€ã€‚</p><p>ä¸è¦å¯¹æ·»åŠ  starter çš„é¡¹ç›®æŠ±æœ‰å‡è®¾æƒ³æ³•ã€‚å¦‚æœæ‚¨è‡ªåŠ¨é…ç½®çš„åº“ç»å¸¸éœ€è¦å…¶ä»– starterï¼Œè¯·ä¸€å¹¶å£°æ˜å®ƒä»¬ã€‚å¦‚æœå¯é€‰ä¾èµ–é¡¹çš„æ•°é‡å¾ˆå¤šï¼Œåˆ™æä¾›ä¸€ç»„é€‚å½“çš„é»˜è®¤ä¾èµ–é¡¹å¯èƒ½å¾ˆéš¾ï¼Œå› ä¸ºæ‚¨æœ¬åº”è¯¥é¿å…åŒ…å«å¯¹å¸¸ç”¨åº“çš„ä½¿ç”¨ä¸å¿…è¦çš„ä¾èµ–é¡¹ã€‚æ¢è€Œè¨€ä¹‹ï¼Œæ‚¨ä¸åº”è¯¥åŒ…å«å¯é€‰çš„ä¾èµ–é¡¹ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>æ— è®ºå“ªç§æ–¹å¼ï¼Œæ‚¨çš„ starter å¿…é¡»ç›´æ¥æˆ–é—´æ¥å¼•ç”¨æ ¸å¿ƒ Spring Boot starterï¼ˆ<code>spring-boot-starter</code>ï¼‰ï¼ˆå¦‚æœæ‚¨çš„ starter ä¾èµ–äºå¦ä¸€ä¸ª starter ï¼Œåˆ™æ— éœ€æ·»åŠ å®ƒï¼‰ã€‚å¦‚æœåªä½¿ç”¨è‡ªå®šä¹‰ starter åˆ›å»ºé¡¹ç›®ï¼Œåˆ™ Spring Boot çš„æ ¸å¿ƒåŠŸèƒ½å°†é€šè¿‡å­˜åœ¨çš„æ ¸å¿ƒ starter æ¥å®ç°ã€‚</p></blockquote><p><a id="boot-features-kotlin"></a></p><h2 id="50ã€Kotlin-æ”¯æŒ">50ã€Kotlin æ”¯æŒ</h2><p><a href="https://kotlinlang.org/">Kotlin</a> æ˜¯ä¸€ç§é’ˆå¯¹ JVMï¼ˆå’Œå…¶ä»–å¹³å°ï¼‰çš„é™æ€ç±»å‹è¯­è¨€ï¼Œå®ƒå¯ç¼–å†™å‡ºç®€æ´è€Œä¼˜é›…çš„ä»£ç ï¼ŒåŒæ—¶æä¾›ä¸ä½¿ç”¨ Java ç¼–å†™çš„ç°æœ‰åº“çš„<a href="https://kotlinlang.org/docs/reference/java-interop.html">äº’æ“ä½œæ€§</a>ã€‚</p><p>Spring Boot é€šè¿‡åˆ©ç”¨å…¶ä»– Spring é¡¹ç›®ï¼ˆå¦‚ Spring Frameworkã€Spring Data å’Œ Reactorï¼‰çš„æ”¯æŒæ¥æä¾› Kotlin æ”¯æŒã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://docs.spring.io/spring/docs/5.1.5.RELEASE/spring-framework-reference/languages.html#kotlin">Spring Framework Kotlin æ”¯æŒæ–‡æ¡£</a>ã€‚</p><p>å¼€å§‹å­¦ä¹  Spring Boot å’Œ Kotlin æœ€ç®€å•æ–¹æ³•æ˜¯éµå¾ªè¿™ä¸ª<a href="https://spring.io/guides/tutorials/spring-boot-kotlin/">å…¨é¢æ•™ç¨‹</a>ã€‚æ‚¨å¯ä»¥é€šè¿‡ <a href="https://start.spring.io/#!language=kotlin">start.spring.io</a> åˆ›å»ºæ–°çš„ Kotlin é¡¹ç›®ã€‚å¦‚æœæ‚¨éœ€è¦æ”¯æŒï¼Œè¯·å…è´¹åŠ å…¥ <a href="http://slack.kotlinlang.org/">Kotlin Slack</a> çš„ #spring é¢‘é“æˆ–ä½¿ç”¨ <a href="https://stackoverflow.com/questions/tagged/spring+kotlin">Stack Overflow</a> ä¸Šçš„ <code>spring</code> å’Œ <code>kotlin</code> æ ‡ç­¾æé—®ã€‚</p><p><a id="boot-features-kotlin-requirements"></a></p><h3 id="50-1ã€è¦æ±‚">50.1ã€è¦æ±‚</h3><p>Spring Boot æ”¯æŒ Kotlin 1.2.xã€‚è¦ä½¿ç”¨ Kotlinï¼Œclasspath ä¸‹å¿…é¡»å­˜åœ¨ <code>org.jetbrains.kotlin:kotlin-stdlib</code> å’Œ <code>org.jetbrains.kotlin:kotlin-reflect</code>ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>kotlin-stdlib</code> çš„å˜ä½“ <code>kotlin-stdlib-jdk7</code> å’Œ <code>kotlin-stdlib-jdk8</code>ã€‚</p><p>ç”±äº <a href="https://discuss.kotlinlang.org/t/classes-final-by-default/166">Kotlin ç±»é»˜è®¤ä¸º final</a>ï¼Œå› æ­¤æ‚¨å¯èƒ½éœ€è¦é…ç½® <a href="https://kotlinlang.org/docs/reference/compiler-plugins.html#spring-support">kotlin-spring</a> æ’ä»¶ä»¥è‡ªåŠ¨æ‰“å¼€ <code>Spring-annotated</code> ç±»ï¼Œä»¥ä¾¿å¯ä»¥ä»£ç†å®ƒä»¬ã€‚</p><p>åœ¨ Kotlin ä¸­åºåˆ—åŒ–/ååºåˆ—åŒ– JSON æ•°æ®éœ€è¦ä½¿ç”¨ <a href="https://github.com/FasterXML/jackson-module-kotlin">Jackson çš„ Kotlin æ¨¡å—</a>ã€‚åœ¨ classpath ä¸­æ‰¾åˆ°å®ƒæ—¶ä¼šè‡ªåŠ¨æ³¨å†Œã€‚å¦‚æœ Jackson å’Œ Kotlin å­˜åœ¨ä½† Jackson Kotlin æ¨¡å—ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè®°å½•è­¦å‘Šæ¶ˆæ¯ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœåœ¨ <a href="https://start.spring.io/#!language=kotlin">start.spring.io</a> ä¸Šåˆ›å»º Kotlin é¡¹ç›®ï¼Œåˆ™é»˜è®¤æä¾›è¿™äº›ä¾èµ–é¡¹å’Œæ’ä»¶ã€‚</p></blockquote><p><a id="boot-features-kotlin-null-safety"></a></p><h3 id="50-2ã€Null-å®‰å…¨">50.2ã€Null å®‰å…¨</h3><p>Kotlin çš„ä¸€ä¸ªå…³é”®ç‰¹æ€§æ˜¯ <a href="https://kotlinlang.org/docs/reference/null-safety.html">null å®‰å…¨</a>ã€‚å®ƒåœ¨ç¼–è¯‘æ—¶å¤„ç†ç©ºå€¼ï¼Œè€Œä¸æ˜¯å°†é—®é¢˜æ¨è¿Ÿåˆ°è¿è¡Œæ—¶å¹¶é‡åˆ° <code>NullPointerException</code>ã€‚è¿™æœ‰åŠ©äºæ¶ˆé™¤å¸¸è§çš„é”™è¯¯æ¥æºï¼Œè€Œæ— éœ€æ”¯ä»˜åƒ <code>Optional</code> è¿™æ ·çš„åŒ…è£…å™¨çš„æˆæœ¬ã€‚Kotlin è¿˜å…è®¸ä½¿ç”¨æœ‰å¯ç©ºå€¼çš„ï¼Œå¦‚ <a href="http://www.baeldung.com/kotlin-null-safety">Kotlin null å®‰å…¨ç»¼åˆæŒ‡å—</a>ä¸­æ‰€è¿°ã€‚</p><p>è™½ç„¶ Java ä¸å…è®¸åœ¨å…¶ç±»å‹ç³»ç»Ÿä¸­è¡¨ç¤º null å®‰å…¨ï¼Œä½† Spring Frameworkã€Spring Data å’Œ Reactor ç°åœ¨é€šè¿‡æ˜“äºä½¿ç”¨çš„å·¥å…·çš„æ³¨è§£æä¾›å…¶ API çš„å®‰å…¨æ€§ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒKotlin ä¸­ä½¿ç”¨çš„ Java API ç±»å‹è¢«è¯†åˆ«ä¸ºæ”¾å®½ç©ºæ£€æŸ¥çš„<a href="https://kotlinlang.org/docs/reference/java-interop.html#null-safety-and-platform-types">å¹³å°ç±»å‹</a>ã€‚<a href="https://kotlinlang.org/docs/reference/java-interop.html#jsr-305-support">Kotlin å¯¹ JSR 305 æ³¨è§£çš„æ”¯æŒ</a>ä¸å¯ç©ºæ³¨è§£ç›¸ç»“åˆï¼Œä¸º Kotlin ä¸­ Spring API ç›¸å…³çš„ä»£ç æä¾›äº†ç©ºå®‰å…¨ã€‚</p><p>å¯ä»¥é€šè¿‡ä½¿ç”¨ä»¥ä¸‹é€‰é¡¹æ·»åŠ  <code>-Xjsr305</code> ç¼–è¯‘å™¨æ ‡å¿—æ¥é…ç½® JSR 305 æ£€æŸ¥ï¼š<code>-Xjsr305=&#123;strict|warn|ignore&#125;</code>ã€‚é»˜è®¤è¡Œä¸ºä¸ <code>-Xjsr305=warn</code> ç›¸åŒã€‚åœ¨ä» Spring API æ¨æ–­å‡ºçš„ Kotlin ç±»å‹ä¸­éœ€è¦è€ƒè™‘ null å®‰å…¨çš„ <code>strict</code> å€¼ï¼Œä½†æ˜¯åº”è¯¥ä½¿ç”¨ Spring API å¯ç©ºå£°æ˜ç”šè‡³å¯ä»¥åœ¨æ¬¡è¦ç‰ˆæœ¬ä¹‹é—´å‘å±•å¹¶ä¸”å°†æ¥å¯èƒ½æ·»åŠ æ›´å¤šæ£€æŸ¥çš„æ–¹æ¡ˆã€‚</p><p><strong>è­¦å‘Š</strong></p><blockquote><p>å°šä¸æ”¯æŒæ³›å‹ç±»å‹å‚æ•°ã€<code>varargs</code> å’Œæ•°ç»„å…ƒç´ å¯ç©ºæ€§ã€‚æœ‰å…³æœ€æ–°ä¿¡æ¯ï¼Œè¯·å‚è§ <a href="https://jira.spring.io/browse/SPR-15942">SPR-15942</a>ã€‚å¦è¯·æ³¨æ„ï¼ŒSpring Boot è‡ªå·±çš„ API <a href="https://github.com/spring-projects/spring-boot/issues/10712">å°šæœªæ³¨è§£</a>ã€‚</p></blockquote><p><a id="boot-features-kotlin-api"></a></p><h3 id="50-3ã€Kotlin-API">50.3ã€Kotlin API</h3><p><a id="boot-features-kotlin-api-runapplication"></a></p><h4 id="50-3-1ã€runApplication">50.3.1ã€runApplication</h4><p>Spring Boot æä¾›äº†ä½¿ç”¨ <code>runApplication&lt;MyApplication&gt;(*args)</code> è¿è¡Œåº”ç”¨ç¨‹åºçš„æƒ¯ç”¨æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.runApplication</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyApplication</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">runApplication&lt;MyApplication&gt;(*args)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ <code>SpringApplication.run(MyApplication::class.java, *args)</code> çš„æ›¿ä»£æ–¹å¼ã€‚å®ƒè¿˜å…è®¸è‡ªå®šä¹‰åº”ç”¨ç¨‹åºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">runApplication&lt;MyApplication&gt;(*args) &#123;</span><br><span class="line">setBannerMode(OFF)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="boot-features-kotlin-api-extensions"></a></p><h4 id="50-3-2ã€æ‰©å±•">50.3.2ã€æ‰©å±•</h4><p>Kotlin <a href="https://kotlinlang.org/docs/reference/extensions.html">æ‰©å±•</a>æä¾›äº†ä½¿ç”¨é™„åŠ åŠŸèƒ½æ‰©å±•ç°æœ‰ç±»çš„èƒ½åŠ›ã€‚Spring Boot Kotlin API åˆ©ç”¨è¿™äº›æ‰©å±•ä¸ºç°æœ‰ API æ·»åŠ æ–°çš„ Kotlin ç‰¹å®šä¾¿åˆ©ã€‚</p><p>æä¾›çš„ <code>TestRestTemplate</code> æ‰©å±•ç±»ä¼¼äº Spring Framework ä¸º <code>RestOperations</code> æä¾›çš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ‰©å±•ä½¿å¾—åˆ©ç”¨ Kotlin reified ç±»å‹å‚æ•°å˜ä¸ºå¯èƒ½ã€‚</p><p><a id="boot-features-kotlin-dependency-management"></a></p><h3 id="50-4ã€ä¾èµ–ç®¡ç†">50.4ã€ä¾èµ–ç®¡ç†</h3><p>ä¸ºäº†é¿å…åœ¨ classpath ä¸Šæ··åˆä¸åŒç‰ˆæœ¬çš„ Kotlin ä¾èµ–é¡¹ï¼Œæä¾›äº†ä»¥ä¸‹ Kotlin ä¾èµ–é¡¹çš„ä¾èµ–é¡¹ç®¡ç†ï¼š</p><ul><li><code>kotlin-reflect</code></li><li><code>kotlin-runtime</code></li><li><code>kotlin-stdlib</code></li><li><code>kotlin-stdlib-jdk7</code></li><li><code>kotlin-stdlib-jdk8</code></li><li><code>kotlin-stdlib-jre7</code></li><li><code>kotlin-stdlib-jre8</code></li></ul><p>ä½¿ç”¨ Mavenï¼Œå¯ä»¥é€šè¿‡ <code>kotlin.version</code> å±æ€§è‡ªå®šä¹‰ Kotlin ç‰ˆæœ¬ï¼Œå¹¶ä¸º <code>kotlin-maven-plugin</code> æä¾›æ’ä»¶ç®¡ç†ã€‚ä½¿ç”¨ Gradleï¼ŒSpring Boot æ’ä»¶ä¼šè‡ªåŠ¨å°† <code>kotlin.version</code> ä¸ Kotlin æ’ä»¶çš„ç‰ˆæœ¬ä¿ä¸€è‡´ã€‚</p><p><a id="boot-features-kotlin-configuration-properties"></a></p><h3 id="50-5ã€-ConfigurationProperties">50.5ã€<code>@ConfigurationProperties</code></h3><p><code>@ConfigurationProperties</code> ç›®å‰ä»…é€‚ç”¨äº <code>lateinit</code> æˆ–å¯ç©ºçš„ <code>var</code> å±æ€§ï¼ˆå»ºè®®ä½¿ç”¨å‰è€…ï¼‰ï¼Œå› ä¸º<a href="https://github.com/spring-projects/spring-boot/issues/8762">å°šä¸æ”¯æŒ</a>ç”±æ„é€ å‡½æ•°åˆå§‹åŒ–çš„ä¸å¯å˜ç±»ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(<span class="string">&quot;example.kotlin&quot;</span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">KotlinExampleProperties</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">lateinit</span> <span class="keyword">var</span> name: String</span><br><span class="line"></span><br><span class="line"><span class="keyword">lateinit</span> <span class="keyword">var</span> description: String</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> myService = MyService()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">lateinit</span> <span class="keyword">var</span> apiToken: String</span><br><span class="line"></span><br><span class="line"><span class="keyword">lateinit</span> <span class="keyword">var</span> uri: URI</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>è¦ä½¿ç”¨æ³¨è§£å¤„ç†å™¨ç”Ÿæˆ<a href="#configuration-metadata-annotation-processor">æ‚¨è‡ªå·±çš„å…ƒæ•°æ®</a>ï¼Œåº”ä½¿ç”¨ <code>spring-boot-configuration-processor</code> ä¾èµ–<a href="https://kotlinlang.org/docs/reference/kapt.html">é…ç½® <code>kapt</code></a>ã€‚</p></blockquote><p><a id="boot-features-kotlin-testing"></a></p><h3 id="50-6ã€æµ‹è¯•">50.6ã€æµ‹è¯•</h3><p>è™½ç„¶å¯ä»¥ä½¿ç”¨ JUnit 4ï¼ˆ<code>spring-boot-starter-test</code> æä¾›çš„é»˜è®¤é…ç½®ï¼‰æ¥æµ‹è¯• Kotlin ä»£ç ï¼Œä½†å»ºè®®ä½¿ç”¨ JUnit 5ã€‚JUnit 5 å…è®¸æµ‹è¯•ç±»å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œå¹¶åœ¨æ‰€æœ‰ç±»çš„æµ‹è¯•ä¸­å¤ç”¨ã€‚è¿™ä½¿å¾—å¯ä»¥åœ¨éé™æ€æ–¹æ³•ä¸Šä½¿ç”¨ <code>@BeforeAll</code> å’Œ <code>@AfterAll</code> æ³¨è§£ï¼Œè¿™éå¸¸é€‚åˆ Kotlinã€‚</p><p>è¦ä½¿ç”¨ JUnit 5ï¼Œè¯·ä» <code>spring-boot-starter-test</code> ä¸­æ’é™¤ <code>junit:junit</code> ä¾èµ–é¡¹ï¼Œç„¶åæ·»åŠ  JUnit 5 ä¾èµ–é¡¹ï¼Œå¹¶ç›¸åº”åœ°é…ç½® Maven æˆ– Gradle æ’ä»¶ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://junit.org/junit5/docs/current/user-guide/#dependency-metadata-junit-jupiter-samples">JUnit 5 æ–‡æ¡£</a>ã€‚æ‚¨è¿˜éœ€è¦<a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-instance-lifecycle-changing-default">å°†æµ‹è¯•å®ä¾‹ç”Ÿå‘½å‘¨æœŸåˆ‡æ¢ä¸º <strong>per-class</strong></a>ã€‚</p><p>ä¸ºäº†æ¨¡æ‹Ÿ Kotlin ç±»ï¼Œå»ºè®®ä½¿ç”¨ <a href="https://mockk.io/">Mockk</a>ã€‚å¦‚æœéœ€è¦ Mockk ç­‰æ•ˆçš„ Mockito ç‰¹å®šçš„ <a href="boot-features-testing-spring-boot-applications-mocking-beans"><code>@MockBean</code> å’Œ <code>@SpyBean</code> æ³¨è§£</a>ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <a href="https://github.com/Ninja-Squad/springmockk">SpringMockK</a>ï¼Œå®ƒæä¾›ç±»ä¼¼çš„ <code>@MockkBean</code> å’Œ <code>@SpykBean</code> æ³¨è§£ã€‚</p><p><a id="boot-features-kotlin-resources"></a></p><h3 id="50-7ã€èµ„æº">50.7ã€èµ„æº</h3><p><a id="boot-features-kotlin-resources-further-reading"></a></p><h4 id="50-7-1ã€è¿›é˜¶é˜…è¯»">50.7.1ã€è¿›é˜¶é˜…è¯»</h4><ul><li><a href="https://kotlinlang.org/docs/reference/">Kotlin è¯­è¨€å‚è€ƒ</a></li><li><a href="http://slack.kotlinlang.org/">Kotlin Slack</a>ï¼ˆæœ‰ä¸“ç”¨çš„ #spring é¢‘é“ï¼‰</li><li><a href="https://stackoverflow.com/questions/tagged/spring+kotlin">Stackoverflow ä¸Š <code>spring</code> å’Œ <code>kotlin</code> æ ‡ç­¾</a></li><li><a href="https://try.kotlinlang.org/">åœ¨æµè§ˆå™¨ä¸­å°è¯• Kotlin</a></li><li><a href="https://blog.jetbrains.com/kotlin/">Kotlin åšå®¢</a></li><li><a href="https://kotlin.link/">Awesome Kotlin</a></li><li><a href="https://spring.io/guides/tutorials/spring-boot-kotlin/">æ•™ç¨‹ï¼šä½¿ç”¨ Spring Boot å’Œ Kotlin æ„å»º Web åº”ç”¨ç¨‹åº</a></li><li><a href="https://spring.io/blog/2016/02/15/developing-spring-boot-applications-with-kotlin">ä½¿ç”¨ Kotlin å¼€å‘ Spring Boot åº”ç”¨ç¨‹åº</a></li><li><a href="https://spring.io/blog/2016/03/20/a-geospatial-messenger-with-kotlin-spring-boot-and-postgresql">ä½¿ç”¨ Kotlinã€Spring Boot å’Œ PostgreSQL å¼€å‘åœ°ç†ä¿¡ä½¿</a></li><li><a href="https://spring.io/blog/2017/01/04/introducing-kotlin-support-in-spring-framework-5-0">åœ¨ Spring Framework 5.0 ä¸­å¼•å…¥ Kotlin æ”¯æŒ</a></li><li><a href="https://spring.io/blog/2017/08/01/spring-framework-5-kotlin-apis-the-functional-way">Spring Framework 5 Kotlin API å®ç°å‡½æ•°å¼</a></li></ul><p><a id="boot-features-kotlin-resources-examples"></a></p><h4 id="50-7-2ã€ç¤ºä¾‹">50.7.2ã€ç¤ºä¾‹</h4><ul><li><a href="https://github.com/sdeleuze/spring-boot-kotlin-demo">spring-boot-kotlin-demo</a>ï¼šå¸¸è§„çš„ Spring Boot + Spring Data JPA é¡¹ç›®</li><li><a href="https://github.com/mixitconf/mixit">mixit</a>ï¼šSpring Boot 2 + WebFlux + Reactive Spring Data MongoDB</li><li><a href="https://github.com/sdeleuze/spring-kotlin-fullstack">spring-kotlin-fullstack</a>ï¼šWebFlux Kotlin å…¨æ ˆç¤ºä¾‹ï¼Œåœ¨å‰ç«¯ä½¿ç”¨ Kotlin2js ä»£æ›¿ JavaScript å’Œ TypeScript</li><li><a href="https://github.com/spring-petclinic/spring-petclinic-kotlin">spring-petclinic-kotlin</a>ï¼šSpring PetClinic ç¤ºä¾‹åº”ç”¨çš„ Kotlin ç‰ˆæœ¬</li><li><a href="https://github.com/sdeleuze/spring-kotlin-deepdive">spring-kotlin-deepdive</a>ï¼šå°†Boot 1.0 + Java é€æ­¥è¿ç§»åˆ° Boot 2.0 + Kotlin</li></ul><p><a id="boot-features-whats-next"></a></p><h2 id="51ã€ä¸‹ä¸€æ­¥">51ã€ä¸‹ä¸€æ­¥</h2><p>å¦‚æœæ‚¨æƒ³äº†è§£æœ¬èŠ‚ä¸­è®¨è®ºçš„ä»»ä½•ç±»ç›®çš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥æŸ¥çœ‹ <a href="https://docs.spring.io/spring-boot/docs/2.1.3.RELEASE/api">Spring Boot API æ–‡æ¡£</a>ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æµè§ˆ<a href="https://github.com/spring-projects/spring-boot/tree/v2.1.3.RELEASE">æºä»£ç </a>ã€‚å¦‚æœæ‚¨æœ‰å…·ä½“é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ <a href="howto.md">how-to</a> éƒ¨åˆ†ã€‚</p><p>å¦‚æœæ‚¨å¯¹ Spring Boot çš„æ ¸å¿ƒåŠŸèƒ½æ„Ÿåˆ°æ»¡æ„ï¼Œå¯ä»¥ç»§ç»­é˜…è¯»æœ‰å…³ç”Ÿäº§å°±ç»ªåŠŸèƒ½çš„å†…å®¹ã€‚</p>]]></content>
    
    
    <summary type="html">Spring Bootçš„ç›¸å…³ç‰¹å¾ä¿¡æ¯ï¼Œé‡ç‚¹ï¼Œæœ¬ç¯‡å°†ä¼šæ˜¯æ•´ä¸ªSpring Bootçš„æ ¸å¿ƒç¯‡</summary>
    
    
    
    <category term="Spring Boot" scheme="https://luoxiaohei520.github.io/categories/Spring-Boot/"/>
    
    
    <category term="Spring Boot" scheme="https://luoxiaohei520.github.io/tags/Spring-Boot/"/>
    
  </entry>
  
  <entry>
    <title>03Spring Bootçš„æ­£å¼ä½¿ç”¨</title>
    <link href="https://luoxiaohei520.github.io/posts/5cfa102f.html"/>
    <id>https://luoxiaohei520.github.io/posts/5cfa102f.html</id>
    <published>2023-11-09T02:50:23.331Z</published>
    <updated>2023-11-09T02:50:23.331Z</updated>
    
    <content type="html"><![CDATA[<p><a id="using-boot"></a></p><h1>ä¸‰ã€ä½¿ç”¨ Spring Boot</h1><p>æœ¬ç« èŠ‚å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Spring Bootã€‚å®ƒè¦†ç›–äº†è¯¸å¦‚æ„å»ºç³»ç»Ÿã€è‡ªåŠ¨é…ç½®å’Œå¦‚ä½•è¿è¡Œåº”ç”¨ç­‰ä¸»é¢˜ã€‚æˆ‘ä»¬è¿˜ä»‹ç»ä¸€äº› Spring Boot æœ€ä½³å®è·µã€‚è™½ç„¶ Spring Boot å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«ï¼ˆå®ƒåªæ˜¯å¦ä¸€ä¸ªæ‚¨å¯ä»¥ä½¿ç”¨çš„ç±»åº“ï¼‰ï¼Œä½†ä»ç„¶æœ‰ä¸€äº›å»ºè®®å¯ä»¥è®©æ‚¨çš„å¼€å‘å·¥ä½œå˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p><p>å¦‚æœæ‚¨æ˜¯åˆšå¼€å§‹ä½¿ç”¨ Spring Bootï¼Œé‚£ä¹ˆåœ¨æ·±å…¥æœ¬éƒ¨åˆ†ä¹‹å‰ï¼Œæ‚¨åº”è¯¥å…ˆé˜…è¯»<a href="#getting-started">å…¥é—¨éƒ¨åˆ†</a>ã€‚</p><p><a id="using-boot-build-systems"></a></p><h2 id="13ã€æ„å»ºç³»ç»Ÿ">13ã€æ„å»ºç³»ç»Ÿ</h2><p>å¼ºçƒˆæ¨èæ‚¨é€‰æ‹©ä¸€ä¸ªæ”¯æŒ<a href="#using-boot-dependency-management">ä¾èµ–ç®¡ç†</a>çš„æ„å»ºç³»ç»Ÿ, æ‚¨å¯ä»¥ä½¿ç”¨å®ƒå°† artifact å‘å¸ƒåˆ° Maven Central ä»“åº“ã€‚æˆ‘ä»¬å»ºè®®æ‚¨é€‰æ‹© Maven æˆ–è€… Gradleã€‚è™½ç„¶å¯ä»¥è®© Spring Boot ä¸å…¶å®ƒæ„å»ºç³»ç»Ÿï¼ˆå¦‚ Antï¼‰é…åˆå·¥ä½œï¼Œä½†å®ƒä»¬ä¸ä¼šå¾—åˆ°ç‰¹åˆ«å¥½çš„æ”¯æŒã€‚</p><p><a id="using-boot-dependency-management"></a></p><h3 id="13-1ã€ä¾èµ–ç®¡ç†">13.1ã€ä¾èµ–ç®¡ç†</h3><p>æ¯ä¸€æ¬¡ Spring Boot å‘è¡Œéƒ½æä¾›äº†ä¸€ä¸ªå®ƒæ‰€æ”¯æŒçš„ä¾èµ–æ¸…å•ã€‚å®é™…ä¸Šï¼Œæ‚¨ä¸éœ€è¦ä¸ºæ„å»ºé…ç½®æä¾›ä»»ä½•ä¾èµ–çš„ç‰ˆæœ¬ï¼Œå› ä¸º Spring Boot å·²ç»å¸®æ‚¨ç®¡ç†è¿™äº›äº†ã€‚å½“æ‚¨å‡çº§ Spring Boot æ—¶ï¼Œè¿™äº›ä¾èµ–ä¹Ÿå°†ä»¥ä¸€è‡´çš„æ–¹å¼è¿›è¡Œå‡çº§ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœæ‚¨è§‰å¾—æœ‰å¿…è¦ï¼Œæ‚¨ä»ç„¶å¯ä»¥æŒ‡å®šä¸€ä¸ªç‰ˆæœ¬å¹¶è¦†ç›– Spring Boot æ‰€æ¨èçš„ã€‚</p></blockquote><p>è¯¥æ¸…å•åŒ…å«äº†å…¨éƒ¨å¯ä»¥ä¸ Spring Boot ä¸€èµ·ä½¿ç”¨çš„ spring æ¨¡å—ä»¥åŠç¬¬ä¸‰æ–¹ç±»åº“ï¼Œå¯ä½œä¸ºæ ‡å‡†<a href="#using-boot-maven-without-a-parent">ææ–™æ¸…å•ï¼ˆ<code>spring-boot-dependencies</code>ï¼‰</a>ï¼Œå¹¶ä¸”å¯ä»¥ä¸ <a href="#using-boot-maven-parent-pom">Maven</a> å’Œ <a href="#using-boot-gradle">Gradle</a> ä¸€èµ·ä½¿ç”¨ã€‚</p><p><strong>è­¦å‘Š</strong></p><blockquote><p>Spring Boot çš„æ¯ä¸€æ¬¡å‘è¡Œéƒ½ä¼šåŸºäºä¸€ä¸ª Spring Framework ç‰ˆæœ¬ï¼Œå› æ­¤æˆ‘ä»¬<strong>å¼ºçƒˆ</strong>å»ºè®®æ‚¨ä¸è¦æŒ‡å®šæŒ‡å®šå®ƒçš„ç‰ˆæœ¬ã€‚</p></blockquote><p><a id="using-boot-maven"></a></p><h3 id="13-2ã€Maven">13.2ã€Maven</h3><p>Maven ç”¨æˆ·å¯ä»¥ç»§æ‰¿ <code>spring-boot-starter-parent</code> é¡¹ç›®ä»¥è·å–åˆé€‚çš„é»˜è®¤å€¼ï¼Œçˆ¶é¡¹ç›®æä¾›äº†ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ul><li>Java 1.8 ä½œä¸ºé»˜è®¤ç¼–è¯‘å™¨çº§åˆ«ã€‚</li><li>æºä»£ç ä½¿ç”¨ UTF-8 ç¼–ç ã€‚</li><li><a href="#using-boot-dependency-management">ä¾èµ–ç®¡ç†éƒ¨åˆ†</a>ç»§æ‰¿è‡ª <code>spring-boot-dependencies</code> çš„ POMï¼Œå…è®¸æ‚¨çœç•¥å¸¸è§ä¾èµ–çš„ <code>&lt;version&gt;</code> æ ‡ç­¾ã€‚</li><li>åˆç†çš„<a href="https://maven.apache.org/plugins/maven-resources-plugin/examples/filter.html">èµ„æºè¿‡æ»¤</a>ã€‚</li><li>åˆé€‚çš„æ’ä»¶é…ç½®ï¼ˆ<a href="http://www.mojohaus.org/exec-maven-plugin/">exec plugin</a>ã€<a href="https://github.com/ktoso/maven-git-commit-id-plugin">Git commit ID</a>ã€<a href="https://maven.apache.org/plugins/maven-shade-plugin/">shade</a>ï¼‰ã€‚</li><li>é’ˆå¯¹ <code>application.properties</code> å’Œ <code>application.yml</code> èµ„æºçš„åˆç†è¿‡æ»¤ï¼ŒåŒ…æ‹¬ç‰¹å®š profile çš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ <code>application-foo.properties</code> å’Œ <code>application-foo.yml</code>ï¼‰</li></ul><p>æ³¨æ„ï¼šç”±äº <code>application.properties</code> å’Œ <code>application.yml</code> æ–‡ä»¶æ¥å— Spring é£æ ¼çš„å ä½ç¬¦ï¼ˆ<code>$&#123;â€‹...&#125;</code>ï¼‰ï¼Œå› æ­¤ Maven è¿‡æ»¤æ”¹ä¸ºä½¿ç”¨ <code>@..@</code> å ä½ç¬¦ï¼ˆæ‚¨å¯ä»¥ä½¿ç”¨ Maven çš„ <code>resource.delimiter</code> å±æ€§é‡å†™å®ƒï¼‰</p><p><a id="using-boot-maven-parent-pom"></a></p><h4 id="13-2-1ã€ç»§æ‰¿-Starter-Parent">13.2.1ã€ç»§æ‰¿ Starter Parent</h4><p>è¦å°†é¡¹ç›®é…ç½®ç»§æ‰¿ <code>spring-boot-starter-parent</code>ï¼Œåªéœ€è¦æŒ‰ä»¥ä¸‹æ–¹å¼è®¾ç½® <code>parent</code>ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä» Spring Boot ç»§æ‰¿é»˜è®¤é…ç½® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>æ‚¨åªéœ€è¦åœ¨æ­¤ä¾èµ–ä¸ŠæŒ‡å®š Spring Boot çš„ç‰ˆæœ¬å·ã€‚å¦‚æœæ‚¨è¦å¯¼å…¥å…¶å®ƒ starterï¼Œåˆ™å¯ä»¥æ”¾å¿ƒåœ°çœç•¥ç‰ˆæœ¬å·ã€‚</p></blockquote><p>é€šè¿‡è¯¥è®¾ç½®ï¼Œæ‚¨è¿˜å¯ä»¥é‡å†™è‡ªå·±é¡¹ç›®ä¸­çš„é…ç½®å±æ€§æ¥è¦†ç›–ä¸ªåˆ«ä¾èµ–ã€‚ä¾‹å¦‚ï¼Œè¦å‡çº§åˆ°å¦ä¸€ä¸ª Spring Data å‘è¡Œç‰ˆæœ¬ï¼Œæ‚¨éœ€è¦å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ° <code>pom.xml</code> æ–‡ä»¶ä¸­ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">spring-data-releasetrain.version</span>&gt;</span>Fowler-SR2<span class="tag">&lt;/<span class="name">spring-data-releasetrain.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>æŸ¥çœ‹ <a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-dependencies/pom.xml"><code>spring-boot-dependencies</code> pom</a> ä»¥è·å–å—æ”¯æŒçš„å±æ€§æ¸…å•ã€‚</p></blockquote><p><a id="using-boot-maven-without-a-parent"></a></p><h4 id="13-2-2ã€ä¸ä½¿ç”¨çˆ¶-POM">13.2.2ã€ä¸ä½¿ç”¨çˆ¶ POM</h4><p>ä¸æ˜¯æ¯ä¸ªäººéƒ½å–œæ¬¢ä» <code>spring-boot-starter-parent</code> ç»§æ‰¿ POMã€‚æ‚¨å¯èƒ½éœ€è¦ä½¿ç”¨è‡ªå·±å…¬å¸æ ‡å‡†çš„çˆ¶ POMï¼Œæˆ–è€…æ‚¨å¯èƒ½åªæ˜¯å¸Œæœ›æ˜ç¡®åœ°å£°æ˜æ‰€æœ‰ Maven é…ç½®ã€‚</p><p>å¦‚æœæ‚¨ä¸æƒ³ä½¿ç”¨ <code>spring-boot-starter-parent</code>ï¼Œåˆ™ä»ç„¶å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>scope=import</code> ä¾èµ–æ¥è·å¾—ä¾èµ–ç®¡ç†ï¼ˆä½†ä¸æ˜¯æ’ä»¶ç®¡ç†ï¼‰çš„å¥½å¤„ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ä» Spring Boot å¯¼å…¥ä¾èµ–ç®¡ç† --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šæ‰€è¿°ï¼Œä¸Šè¿°ç¤ºä¾‹è®¾ç½®ä¸ä¼šè®©æ‚¨ä½¿ç”¨å±æ€§æ¥è¦†ç›–ä¸ªåˆ«ä¾èµ–ã€‚è¦è¾¾åˆ°ç›¸åŒçš„ç›®çš„ï¼Œéœ€è¦åœ¨ <code>spring-boot-dependencies</code> é¡¹<strong>ä¹‹å‰</strong>åœ¨é¡¹ç›®çš„ <code>dependencyManagement</code> ä¸­æ·»åŠ ä¸€é¡¹ã€‚ä¾‹å¦‚ï¼Œè¦å‡çº§åˆ°å¦ä¸€ä¸ª Spring Data å‘è¡Œç‰ˆï¼Œæ‚¨å¯ä»¥å°†ä»¥ä¸‹å…ƒç´ æ·»åŠ åˆ° <code>pom.xml</code>ä¸­ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- è¦†ç›– Spring Boot æä¾›çš„ Spring Data --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-releasetrain<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>Fowler-SR2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šäº†ä¸€ä¸ª <strong>BOM</strong>ï¼Œä½†æ˜¯ä»»ä½•çš„ä¾èµ–ç±»å‹éƒ½å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•æ¥é‡å†™ã€‚</p></blockquote><p><a id="using-boot-maven-plugin"></a></p><h4 id="13-2-3ã€ä½¿ç”¨-Spring-Boot-Maven-æ’ä»¶">13.2.3ã€ä½¿ç”¨ Spring Boot Maven æ’ä»¶</h4><p>Spring Boot åŒ…æ‹¬äº†ä¸€ä¸ª <a href="#build-tool-plugins-maven-plugin">Maven æ’ä»¶</a>ï¼Œå®ƒå¯ä»¥å°†é¡¹ç›®æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œ jarã€‚å¦‚æœè¦ä½¿ç”¨å®ƒï¼Œè¯·å°†æ’ä»¶æ·»åŠ åˆ°æ‚¨çš„ <code>&lt;plugins&gt;</code> ä¸­ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœæ‚¨ä½¿ç”¨äº† Spring Boot starter çš„çˆ¶ pomï¼Œåˆ™åªéœ€è¦æ·»åŠ æ’ä»¶ã€‚é™¤éæ‚¨è¦ä¿®æ”¹çˆ¶çº§ä¸­å®šä¹‰çš„è®¾ç½®ï¼Œå¦åˆ™ä¸éœ€è¦è¿›è¡Œé…ç½®ã€‚</p></blockquote><p><a id="using-boot-gradle"></a></p><h3 id="13-3ã€Gradle">13.3ã€Gradle</h3><p>è¦äº†è§£å¦‚ä½•ä½¿ç”¨ Spring Boot å’Œ Gradleï¼Œè¯·å‚é˜… Spring Boot çš„ Gradle æ’ä»¶æ–‡æ¡£ï¼š</p><ul><li>å‚è€ƒæ–‡æ¡£ï¼ˆ<a href="https://docs.spring.io/spring-boot/docs/2.0.0.RELEASE/gradle-plugin/reference/html">HTML</a> ä¸ <a href="https://docs.spring.io/spring-boot/docs/2.0.0.RELEASE/gradle-plugin/reference/pdf/spring-boot-gradle-plugin-reference.pdf">PDF</a>ï¼‰</li><li><a href="https://docs.spring.io/spring-boot/docs/2.0.0.RELEASE/gradle-plugin/api">API</a></li></ul><p><a id="using-boot-ant"></a></p><h3 id="13-4ã€Ant">13.4ã€Ant</h3><p>å¯ä»¥ä½¿ç”¨ Apache Ant+Ivy æ„å»º Spring Boot é¡¹ç›®ã€‚<code>spring-boot-antlib</code> AntLib æ¨¡å—ä¹Ÿå¯ä»¥å¸®åŠ© Ant åˆ›å»ºå¯æ‰§è¡Œ jar æ–‡ä»¶ã€‚</p><p>è¦å£°æ˜ä¾èµ–ï¼Œå¯å‚è€ƒä»¥ä¸‹ä¸€ä¸ªå…¸å‹çš„ <code>ivy.xml</code> æ–‡ä»¶å†…å®¹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ivy-module</span> <span class="attr">version</span>=<span class="string">&quot;2.0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">info</span> <span class="attr">organisation</span>=<span class="string">&quot;org.springframework.boot&quot;</span> <span class="attr">module</span>=<span class="string">&quot;spring-boot-sample-ant&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configurations</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">conf</span> <span class="attr">name</span>=<span class="string">&quot;compile&quot;</span> <span class="attr">description</span>=<span class="string">&quot;everything needed to compile this module&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">conf</span> <span class="attr">name</span>=<span class="string">&quot;runtime&quot;</span> <span class="attr">extends</span>=<span class="string">&quot;compile&quot;</span> <span class="attr">description</span>=<span class="string">&quot;everything needed to run this module&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configurations</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span> <span class="attr">org</span>=<span class="string">&quot;org.springframework.boot&quot;</span> <span class="attr">name</span>=<span class="string">&quot;spring-boot-starter&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">rev</span>=<span class="string">&quot;$&#123;spring-boot.version&#125;&quot;</span> <span class="attr">conf</span>=<span class="string">&quot;compile&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ivy-module</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªå…¸å‹çš„ <code>build.xml</code> å¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:ivy</span>=<span class="string">&quot;antlib:org.apache.ivy.ant&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:spring-boot</span>=<span class="string">&quot;antlib:org.springframework.boot.ant&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">name</span>=<span class="string">&quot;myapp&quot;</span> <span class="attr">default</span>=<span class="string">&quot;build&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;spring-boot.version&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2.0.0.RELEASE&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">&quot;resolve&quot;</span> <span class="attr">description</span>=<span class="string">&quot;--&gt; retrieve dependencies with ivy&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ivy:retrieve</span> <span class="attr">pattern</span>=<span class="string">&quot;lib/[conf]/[artifact]-[type]-[revision].[ext]&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">&quot;classpaths&quot;</span> <span class="attr">depends</span>=<span class="string">&quot;resolve&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">path</span> <span class="attr">id</span>=<span class="string">&quot;compile.classpath&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fileset</span> <span class="attr">dir</span>=<span class="string">&quot;lib/compile&quot;</span> <span class="attr">includes</span>=<span class="string">&quot;*.jar&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">&quot;init&quot;</span> <span class="attr">depends</span>=<span class="string">&quot;classpaths&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">dir</span>=<span class="string">&quot;build/classes&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">&quot;compile&quot;</span> <span class="attr">depends</span>=<span class="string">&quot;init&quot;</span> <span class="attr">description</span>=<span class="string">&quot;compile&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">javac</span> <span class="attr">srcdir</span>=<span class="string">&quot;src/main/java&quot;</span> <span class="attr">destdir</span>=<span class="string">&quot;build/classes&quot;</span> <span class="attr">classpathref</span>=<span class="string">&quot;compile.classpath&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">&quot;build&quot;</span> <span class="attr">depends</span>=<span class="string">&quot;compile&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">spring-boot:exejar</span> <span class="attr">destfile</span>=<span class="string">&quot;build/myapp.jar&quot;</span> <span class="attr">classes</span>=<span class="string">&quot;build/classes&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">spring-boot:lib</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fileset</span> <span class="attr">dir</span>=<span class="string">&quot;lib/runtime&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">spring-boot:lib</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">spring-boot:exejar</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœæ‚¨ä¸æƒ³ä½¿ç”¨ <code>spring-boot-antlib</code> æ¨¡å—ï¼Œè¯·å‚é˜…ç¬¬ 84.10 èŠ‚ï¼š<a href="https://docs.spring.io/spring-boot/docs/2.0.0.RELEASE/reference/htmlsingle/#howto-build-an-executable-archive-with-ant"><strong>ä½¿ç”¨ Ant æ„å»ºå¯æ‰§è¡Œå½’æ¡£æ–‡ä»¶</strong></a>ï¼Œæ— éœ€ä½¿ç”¨ <code>spring-boot-antlib</code>ã€‚</p></blockquote><p><a id="using-boot-starter"></a></p><h3 id="13-5ã€Starter">13.5ã€Starter</h3><p>Starter æ˜¯ä¸€ç»„æƒ¯ä¾‹ä¾èµ–æè¿°èµ„æºï¼Œå¯ä»¥åŒ…å«åœ¨åº”ç”¨ä¸­ã€‚ä» starter ä¸­ï¼Œæ‚¨å¯ä»¥è·å¾—æ‰€éœ€çš„æ‰€æœ‰ Spring å’Œç›¸å…³æŠ€æœ¯çš„ä¸€ç«™å¼æ”¯æŒï¼Œæ— é¡»é€šè¿‡ç¤ºä¾‹ä»£ç å’Œå¤åˆ¶ç²˜è´´æ¥è·å–ä¾èµ–ã€‚æ¯”å¦‚ï¼Œå¦‚æœæ‚¨è¦ä½¿ç”¨ Spring å’Œ JPA è¿›è¡Œæ•°æ®åº“è®¿é—®ï¼Œé‚£ä¹ˆåªéœ€è¦åœ¨é¡¹ç›®ä¸­åŒ…å« <code>spring-boot-starter-data-jpa</code> ä¾èµ–é¡¹å³å¯ã€‚</p><p>starter åŒ…å«äº†è®¸å¤šæ‚¨éœ€è¦ç”¨äºä½¿é¡¹ç›®å¿«é€Ÿå¯åŠ¨å’Œè¿è¡Œï¼Œå¹¶ä¸”éœ€è¦ä¸€ç»„å—æ”¯æŒçš„å¯ä¼ é€’ä¾èµ–å…³ç³»çš„ä¾èµ–ã€‚</p><hr><p><strong>å‘½åå«ä¹‰</strong></p><p>å®˜æ–¹çš„æ‰€æœ‰ starter éƒ½éµå¾ªç±»ä¼¼çš„å‘½åè§„åˆ™ï¼š<code>spring-boot-starter-*</code>ï¼Œå…¶ä¸­ <code>*</code> æ˜¯ç‰¹å®šç±»å‹çš„åº”ç”¨ã€‚è¿™ä¸ªå‘½åç»“æ„æ—¨åœ¨å¸®åŠ©æ‚¨æ‰¾åˆ° starterã€‚è®¸å¤š IDE ä¸­ Maven é›†æˆå…è®¸æ‚¨æŒ‰åç§°æœç´¢ä¾èµ–ã€‚ä¾‹å¦‚ï¼Œå®‰è£…äº† Eclipse æˆ–è€… STS æ’ä»¶åï¼Œæ‚¨å¯ä»¥ç®€å•åœ°åœ¨ POM ç¼–è¾‘å™¨ä¸­æŒ‰ä¸‹ <code>ctrl-space</code> å¹¶è¾“å…¥ <strong>spring-boot-starter</strong> æ¥è·å–å®Œæ•´çš„åˆ—è¡¨ã€‚</p><p>æ­£å¦‚<a href="#boot-features-custom-starter"><strong>åˆ›å»ºè‡ªå·±çš„ starter</strong></a> ç« èŠ‚æ‰€è¿°ï¼Œç¬¬ä¸‰æ–¹çš„ starter å‘½åä¸åº”è¯¥ä»¥ <code>spring-boot</code> å¼€å¤´ï¼Œå› ä¸ºå®ƒæ˜¯å®˜æ–¹ Spring Boot æ„ä»¶æ‰€ä¿ç•™çš„è§„åˆ™ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªç¬¬ä¸‰æ–¹ starter é¡¹ç›®å«åš <code>thirdpartyproject</code>ï¼Œå®ƒé€šå¸¸ä¼šå‘½åä¸º <code>thirdpartyproject-spring-boot-starter</code>ã€‚</p><hr><p>Spring Boot åœ¨ <code>org.springframework.boot</code> group ä¸‹æä¾›äº†ä»¥ä¸‹åº”ç”¨ starterï¼š</p><p><strong>è¡¨ 13.1ã€Spring Boot åº”ç”¨ç±» Starter</strong></p><table><thead><tr><th style="text-align:left">åç§°</th><th style="text-align:left">æè¿°</th><th style="text-align:center">POM</th></tr></thead><tbody><tr><td style="text-align:left"><code>spring-boot-starter</code></td><td style="text-align:left">æ ¸å¿ƒ starterï¼ŒåŒ…å«è‡ªåŠ¨é…ç½®æ”¯æŒã€æ—¥å¿—å’Œ YAML</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-activemq</code></td><td style="text-align:left">æä¾› JMS æ¶ˆæ¯æ”¯æŒï¼Œä½¿ç”¨ Apache ActiveMQ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-activemq/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-amqp</code></td><td style="text-align:left">æä¾› Spring AMQP ä¸ Rabbit MQ æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-amqp/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-aop</code></td><td style="text-align:left">æä¾› Spring AOP ä¸ AspectJ é¢å‘åˆ‡é¢ç¼–ç¨‹æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-aop/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-artemis</code></td><td style="text-align:left">æä¾› JMS æ¶ˆæ¯æœåŠ¡æ”¯æŒï¼Œä½¿ç”¨ Apache Artemis</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-artemis/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-batch</code></td><td style="text-align:left">æä¾› Spring Batch æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-batch/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-cache</code></td><td style="text-align:left">æä¾› Spring Framework ç¼“å­˜æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-cache/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-cloud-connectors</code></td><td style="text-align:left">ä½¿ç”¨ Spring Cloud Connectors ç®€å•è¿æ¥åˆ°ç±»ä¼¼ Cloud Foundry å’Œ Heroku ç­‰äº‘å¹³å°</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-cloud-connectors/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-data-cassandra</code></td><td style="text-align:left">æä¾›å¯¹ Cassandra åˆ†å¸ƒå¼æ•°æ®åº“å’Œ Spring Data Cassandra çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-cassandra/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-data-cassandra-reactive</code></td><td style="text-align:left">æä¾›å¯¹ Cassandra åˆ†å¸ƒå¼æ•°æ®åº“å’Œ Spring Data Cassandra Reactive çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-cassandra-reactive/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-data-couchbase</code></td><td style="text-align:left">æä¾›å¯¹ Couchbase é¢å‘æ–‡æ¡£æ•°æ®åº“å’Œ Spring Data Couchbase çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-couchbase/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-data-couchbase-reactive</code></td><td style="text-align:left">æä¾›å¯¹ Couchbase é¢å‘æ–‡æ¡£æ•°æ®åº“å’Œ Spring Data Couchbase Reactive çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-couchbase-reactive/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-data-elasticsearch</code></td><td style="text-align:left">æä¾›å¯¹ Elasticseach æœç´¢ä¸åˆ†æå¼•æ“å’Œ Spring Data Elasticsearch çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-elasticsearch/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-data-jpa</code></td><td style="text-align:left">æä¾› Spring Data JPA ä¸ Hibernate çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-jpa/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-data-ldap</code></td><td style="text-align:left">æä¾›å¯¹ Spring Data LDAP çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-ldap/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-data-mongodb</code></td><td style="text-align:left">æä¾›å¯¹ MongoDB é¢å‘æ–‡æ¡£æ•°æ®åº“å’Œ Spring Data MongoDB çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-mongodb/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-data-mongodb-reactive</code></td><td style="text-align:left">æä¾›å¯¹ MongoDB é¢å‘æ–‡æ¡£æ•°æ®åº“å’Œ Spring Data MongoDB Reactive çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-mongodb-reactive/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-data-neo4j</code></td><td style="text-align:left">æä¾›å¯¹ Neo4j å›¾æ•°æ®åº“ä¸ SPring Data Neo4j çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-neo4j/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-data-redis</code></td><td style="text-align:left">æä¾›å¯¹ Redis é”®å€¼æ•°æ®å­˜å‚¨ã€Spring Data Redis å’Œ Lettuce å®¢æˆ·ç«¯çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-redis/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-data-redis-reactive</code></td><td style="text-align:left">æä¾›å¯¹ Redis é”®å€¼æ•°æ®å­˜å‚¨ã€Spring Data Redis Reactive å’Œ Lettuce å®¢æˆ·ç«¯çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-redis-reactive/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-data-rest</code></td><td style="text-align:left">æä¾›ä½¿ç”¨ Spring Data REST é€šè¿‡ REST æš´éœ² Spring Data èµ„æºåº“çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-rest/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-data-solr</code></td><td style="text-align:left">æä¾›å¯¹ Apache Solr æœç´¢å¹³å°ä¸ Spring Data Solr çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-data-solr/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-freemarker</code></td><td style="text-align:left">æä¾›ä½¿ç”¨ Freemakrer è§†å›¾æ„å»º MVC web åº”ç”¨çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-freemarker/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-groovy-templates</code></td><td style="text-align:left">æä¾›ä½¿ç”¨ Groovy æ¨¡æ¿è§†å›¾æ„å»º MVC web åº”ç”¨çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-groovy-templates/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-hateoas</code></td><td style="text-align:left">æä¾›ä½¿ç”¨ Spring MVC ä¸Spring HATEOAS æ„å»ºåŸºäºè¶…åª’ä½“çš„ RESTful web åº”ç”¨çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-hateoas/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-integration</code></td><td style="text-align:left">æä¾›å¯¹ Spring Integration çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-integration/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-jdbc</code></td><td style="text-align:left">æä¾› JDBC ä¸ Tomcat JDBC è¿æ¥æ± çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-jdbc/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-jersey</code></td><td style="text-align:left">æä¾›å¯¹ä½¿ç”¨ JAX-RS ä¸ Jersey æ„å»º RESTful web åº”ç”¨çš„æ”¯æŒã€‚<a href="https://docs.spring.io/spring-boot/docs/2.0.0.RELEASE/reference/htmlsingle/#spring-boot-starter-web"><code>spring-boot-starter-web</code></a> çš„æ›¿ä»£æ–¹æ¡ˆ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-jersey/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-jooq</code></td><td style="text-align:left">æä¾›å¯¹ä½¿ç”¨ JOOQ è®¿é—® SQL æ•°æ®åº“çš„æ”¯æŒã€‚<a href="https://docs.spring.io/spring-boot/docs/2.0.0.RELEASE/reference/htmlsingle/#spring-boot-starter-data-jpa"><code>spring-boot-starter-data-jpa</code></a> æˆ– <a href="https://docs.spring.io/spring-boot/docs/2.0.0.RELEASE/reference/htmlsingle/#spring-boot-starter-jdbc"><code>spring-boot-starter-jdbc</code></a> çš„æ›¿ä»£æ–¹æ¡ˆ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-jooq/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-json</code></td><td style="text-align:left">æä¾›äº†è¯»å†™ json çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-json/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-jta-atomikos</code></td><td style="text-align:left">æä¾› Atomikos JTA äº‹åŠ¡æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-atomikos/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-jta-bitronix</code></td><td style="text-align:left">æä¾› Bitronix JTA äº‹åŠ¡æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-bitronix/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-jta-narayana</code></td><td style="text-align:left">æä¾› Narayana JTA æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-jta-narayana/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-mail</code></td><td style="text-align:left">æä¾›ä½¿ç”¨ã€€Java Mail ä¸ Spring Framework çš„é‚®ä»¶å‘é€æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-mail/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-mustache</code></td><td style="text-align:left">æä¾›ä½¿ç”¨ Mustache è§†å›¾æ„å»º web åº”ç”¨çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-mustache/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-quartz</code></td><td style="text-align:left">Quartz æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-quartz/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-security</code></td><td style="text-align:left">Spring Security æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-security/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-test</code></td><td style="text-align:left">æä¾›åŒ…å«äº† JUnitã€Hamcrest ä¸ Mockito ç±»åº“çš„ Spring Boot å•å…ƒæµ‹è¯•æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-test/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-thymeleaf</code></td><td style="text-align:left">æä¾›ä½¿ç”¨ Thymeleaf è§†å›¾æ„å»º MVC web åº”ç”¨çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-thymeleaf/pom.xml">pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-validation</code></td><td style="text-align:left">æä¾› Hibernate Validator ä¸ Java Bean Validation çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-validation/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-web</code></td><td style="text-align:left">æä¾›ä½¿ç”¨ Spring MVC æ„å»º webï¼ˆåŒ…å« RESTfulï¼‰åº”ç”¨çš„æ”¯æŒï¼Œä½¿ç”¨ Tomcat ä½œä¸ºé»˜è®¤åµŒå…¥å¼å®¹å™¨</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-web/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-web-services</code></td><td style="text-align:left">Spring Web Services æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-web-services/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-webflux</code></td><td style="text-align:left">æä¾›ä½¿ç”¨ Spring Framework çš„ Reactive Web æ”¯æŒæ„å»º WebFlux åº”ç”¨çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-webflux/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-websocket</code></td><td style="text-align:left">æä¾›ä½¿ç”¨ Spring Framework çš„ WebSocket æ”¯æŒæ„å»º WebSocket åº”ç”¨çš„æ”¯æŒ</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-websocket/pom.xml">Pom</a></td></tr></tbody></table><p>é™¤äº†åº”ç”¨ starterï¼Œä»¥ä¸‹ starter å¯ç”¨äºæ·»åŠ <a href="https://docs.spring.io/spring-boot/docs/2.0.0.RELEASE/reference/htmlsingle/#production-ready">ç”Ÿäº§å°±ç»ª</a>ç‰¹æ€§ï¼š</p><p><strong>è¡¨ 13.2ã€Spring Boot ç”Ÿäº§ç±» starter</strong></p><table><thead><tr><th style="text-align:left">åç§°</th><th style="text-align:left">æè¿°</th><th style="text-align:center">POM</th></tr></thead><tbody><tr><td style="text-align:left"><code>spring-boot-starter-actuator</code></td><td style="text-align:left">Spring Boot çš„ Actuator æ”¯æŒï¼Œå…¶æä¾›äº†ç”Ÿäº§å°±ç»ªåŠŸèƒ½ï¼Œå¸®åŠ©æ‚¨ç›‘æ§å’Œç®¡ç†åº”ç”¨</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-actuator/pom.xml">Pom</a></td></tr></tbody></table><p>æœ€åï¼ŒSpring Boot è¿˜åŒ…å«ä»¥ä¸‹ starterï¼Œå¦‚æœæ‚¨æƒ³è¦æ’é™¤æˆ–åˆ‡æ¢ç‰¹å®šæŠ€æœ¯ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ starterï¼š</p><p><strong>è¡¨ 13.3ã€Spring Boot æŠ€æœ¯ç±» starter</strong></p><table><thead><tr><th style="text-align:left">åç§°</th><th style="text-align:left">æè¿°</th><th style="text-align:center">POM</th></tr></thead><tbody><tr><td style="text-align:left"><code>spring-boot-starter-jetty</code></td><td style="text-align:left">ä½¿ç”¨ Jetty ä½œä¸ºåµŒå…¥å¼ servlet å®¹å™¨ã€‚å¯ä»£æ›¿ <a href="https://docs.spring.io/spring-boot/docs/2.0.0.RELEASE/reference/htmlsingle/#spring-boot-starter-tomcat"><code>spring-boot-starter-tomcat</code></a></td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-jetty/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-log4j2</code></td><td style="text-align:left">ä½¿ç”¨ Log4j2 ä½œä¸ºæ—¥å¿—ç»„ä»¶ã€‚å¯ä»£æ›¿ <a href="https://docs.spring.io/spring-boot/docs/2.0.0.RELEASE/reference/htmlsingle/#spring-boot-starter-logging"><code>spring-boot-starter-logging</code></a></td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-log4j2/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-logging</code></td><td style="text-align:left">ä½¿ç”¨ Logback ä½œä¸ºæ—¥å¿—ç»„ä»¶ï¼Œæ­¤ starter ä¸ºé»˜è®¤çš„æ—¥å¿— starter</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-logging/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-reactor-netty</code></td><td style="text-align:left">ä½¿ç”¨ Reactor Netty ä½œä¸ºå†…åµŒå“åº”å¼ HTTP æœåŠ¡å™¨</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-reactor-netty/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-tomcat</code></td><td style="text-align:left">ä½¿ç”¨ Tomcat ä½œä¸ºåµŒå…¥å¼ servlet å®¹å™¨ï¼Œæ­¤ä¸º <a href="https://docs.spring.io/spring-boot/docs/2.0.0.RELEASE/reference/htmlsingle/#spring-boot-starter-web"><code>spring-boot-starter-web</code></a> é»˜è®¤çš„ servlet å®¹å™¨ starter</td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-tomcat/pom.xml">Pom</a></td></tr><tr><td style="text-align:left"><code>spring-boot-starter-undertow</code></td><td style="text-align:left">ä½¿ç”¨ Undertow ä½œä¸ºåµŒå…¥å¼ servlet å®¹å™¨ï¼Œå¯ä»£æ›¿ <a href="https://docs.spring.io/spring-boot/docs/2.0.0.RELEASE/reference/htmlsingle/#spring-boot-starter-tomcat"><code>spring-boot-starter-tomcat</code></a></td><td style="text-align:center"><a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-project/spring-boot-starters/spring-boot-starter-undertow/pom.xml">Pom</a></td></tr></tbody></table><p><strong>æç¤º</strong></p><blockquote><p>æœ‰å…³å…¶å®ƒç¤¾åŒºè´¡çŒ®çš„ starter åˆ—è¡¨ï¼Œè¯·å‚é˜… GitHub ä¸Šçš„ <code>spring-boot-starters</code> æ¨¡å—ä¸­çš„ <a href="https://github.com/spring-projects/spring-boot/tree/master/spring-boot-project/spring-boot-starters/README.adoc">README æ–‡ä»¶</a>ã€‚</p></blockquote><p><a id="using-boot-structuring-your-code"></a></p><h2 id="14ã€ç»„ç»‡ä»£ç ">14ã€ç»„ç»‡ä»£ç </h2><p>Spring Boot ä¸éœ€è¦ä»»ä½•ç‰¹å®šçš„ä»£ç å¸ƒå±€ï¼Œä½†æ˜¯æœ‰ä¸€äº›æœ€ä½³å®è·µæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚</p><p><a id="using-boot-using-the-default-package"></a></p><h3 id="14-1ã€ä½¿ç”¨-default-åŒ…">14.1ã€ä½¿ç”¨ default åŒ…</h3><p>å½“ä¸€ä¸ªç±»æ²¡æœ‰ <code>package</code> å£°æ˜æ—¶ï¼Œå®ƒå°±è¢«è®¤ä¸ºæ˜¯åœ¨ <strong>default</strong> åŒ…ä¸­ã€‚é€šå¸¸ä¸é¼“åŠ±ä½¿ç”¨ <strong>default åŒ…</strong>ï¼Œåº”è¯¥é¿å…ä½¿ç”¨ã€‚å¯¹äºä½¿ç”¨ <code>@ComponentScan</code>ã€<code>@EntityScan</code> æˆ–è€… <code>@SpringBootApplication</code> æ³¨è§£çš„ Spring Boot åº”ç”¨ï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´ç‰¹æ®Šé—®é¢˜å‘ç”Ÿï¼Œå› ä¸ºæ¯ä¸€ä¸ª jar ä¸­çš„æ¯ä¸€ä¸ªç±»å°†ä¼šè¢«è¯»å–åˆ°ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>æˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨ Java æ¨èçš„åŒ…å‘½åçº¦å®šï¼Œå¹¶ä½¿ç”¨åŸŸåçš„åå‘å½¢å¼å‘½åï¼ˆä¾‹å¦‚  <code>com.example.project</code>ï¼‰ã€‚</p></blockquote><p><a id="using-boot-locating-the-main-class"></a></p><h3 id="14-2ã€å®šä½ä¸»åº”ç”¨ç±»">14.2ã€å®šä½ä¸»åº”ç”¨ç±»</h3><p>æˆ‘ä»¬é€šå¸¸å»ºè®®æ‚¨å°†ä¸»åº”ç”¨ç±»æ”¾åœ¨å…¶å®ƒç±»ä¹‹ä¸Šçš„æ ¹åŒ…ä¸­ï¼Œ <code>@EnableAutoConfiguration</code> æ³¨è§£é€šå¸¸æ”¾åœ¨ä¸»ç±»ä¸Šï¼Œå®ƒéšå¼å®šä¹‰äº†æŸäº›é¡¹ç›®çš„ <strong>åŒ…æœç´¢</strong>çš„åŸºå‡†èµ·ç‚¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨ç¼–å†™ä¸€ä¸ª JPA åº”ç”¨ç¨‹åºï¼Œåˆ™è¢« <code>@EnableAutoConfiguration</code> æ³¨è§£çš„ç±»æ‰€å±çš„åŒ…å°†è¢«ç”¨äºæœç´¢æ ‡è®°æœ‰ <code>@Entity</code> æ³¨è§£çš„ç±»ã€‚</p><p>ä½¿ç”¨æ ¹åŒ…è¿˜å¯ä»¥å…è®¸ä½¿ç”¨æ²¡æœ‰æŒ‡å®š <code>basePackage</code> å±æ€§çš„ <code>@ComponentScan</code> æ³¨è§£ã€‚å¦‚æœæ‚¨çš„ä¸»ç±»åœ¨æ ¹åŒ…ä¸­ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>@SpringBootApplication</code> æ³¨è§£ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç»å…¸çš„åŒ…ç»“æ„ï¼š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">com</span><br><span class="line"> +- example</span><br><span class="line">     +- myapplication</span><br><span class="line">         +- Application.java</span><br><span class="line">         <span class="string">|</span></span><br><span class="line">         +- customer</span><br><span class="line">         <span class="string">|   +- Customer.java</span></span><br><span class="line">         <span class="string">|   +- CustomerController.java</span></span><br><span class="line">         <span class="string">|   +- CustomerService.java</span></span><br><span class="line">         <span class="string">|   +- CustomerRepository.java</span></span><br><span class="line">         <span class="string">|</span></span><br><span class="line">         +- order</span><br><span class="line">             +- Order.java</span><br><span class="line">             +- OrderController.java</span><br><span class="line">             +- OrderService.java</span><br><span class="line">             +- OrderRepository.java</span><br></pre></td></tr></table></figure><p><code>Application.java</code> æ–‡ä»¶å£°æ˜äº† <code>main</code> æ–¹æ³•ï¼Œé™„å¸¦äº† <code>@Configuration</code> æ³¨è§£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapplication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.EnableAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(Application.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="using-boot-configuration-classes"></a></p><h2 id="15ã€é…ç½®ç±»">15ã€é…ç½®ç±»</h2><p>Spring Boot æ”¯æŒåŸºäº Java çš„é…ç½®ã€‚è™½ç„¶å¯ä»¥åœ¨ <code>SpringApplication</code> ä¸­ä½¿ç”¨ XML é…ç½®æºï¼Œä½†æˆ‘ä»¬é€šå¸¸å»ºè®®ä¸»é…ç½®æºä¸º <code>@Configuration</code> ç±»ã€‚é€šå¸¸ï¼Œä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©æ˜¯å°†å®šä¹‰äº† <code>main</code> æ–¹æ³•çš„ç±»ä½œä¸º <code>@Configuration</code>ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>è®¸å¤š Spring çš„ XML é…ç½®ç¤ºä¾‹å·²ç»åœ¨ Internet ä¸Šå‘å¸ƒäº†ã€‚å¦‚æœå¯èƒ½çš„è¯ï¼Œæ‚¨æ— è®ºå¦‚ä½•éƒ½åº”è¯¥å°è¯•ç€ä½¿ç”¨ç­‰æ•ˆçš„åŸºäº Java çš„é…ç½®æ–¹å¼ï¼Œæœç´¢ <code>Enable*</code> æ³¨è§£å¯ä»¥å¸®åˆ°æ‚¨ä¸å°‘å¿™ã€‚</p></blockquote><p><a id="using-boot-importing-configuration"></a></p><h3 id="15-1ã€å¯¼å…¥é¢å¤–çš„é…ç½®ç±»">15.1ã€å¯¼å…¥é¢å¤–çš„é…ç½®ç±»</h3><p>ä½ ä¸éœ€è¦æŠŠæ‰€æœ‰çš„ <code>@Configuration</code> æ”¾åœ¨ä¸€ä¸ªç±»ä¸­ã€‚<code>@Import</code> æ³¨è§£å¯ç”¨äºå¯¼å…¥å…¶ä»–é…ç½®ç±»ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>@ComponentScan</code> è‡ªåŠ¨æ‰«ææ‰€æœ‰ Spring ç»„ä»¶ï¼ŒåŒ…æ‹¬ <code>@Configuration</code> ç±»ã€‚</p><p><a id="using-boot-importing-xml-configuration"></a></p><h3 id="15-2ã€å¯¼å…¥-XML-é…ç½®">15.2ã€å¯¼å…¥ XML é…ç½®</h3><p>å¦‚æœæ‚¨ä¸€å®šè¦ä½¿ç”¨åŸºäº XML çš„é…ç½®ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä»ç„¶ä½¿ç”¨ <code>@Configuration</code> ç±»ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ <code>@ImportResource</code> æ³¨è§£æ¥åŠ è½½ XML é…ç½®æ–‡ä»¶ã€‚</p><p><a id="using-boot-auto-configuration"></a></p><h2 id="16ã€è‡ªåŠ¨é…ç½®">16ã€è‡ªåŠ¨é…ç½®</h2><p>Spring Boot è‡ªåŠ¨é…ç½®å°è¯•æ ¹æ®æ‚¨æ·»åŠ çš„ jar ä¾èµ–è‡ªåŠ¨é…ç½® Spring åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ classpath ä¸‹å­˜åœ¨ HSQLDBï¼Œå¹¶ä¸”æ‚¨æ²¡æœ‰æ‰‹åŠ¨é…ç½®ä»»ä½•æ•°æ®åº“è¿æ¥ beanï¼Œé‚£ä¹ˆ Spring Boot å°†è‡ªåŠ¨é…ç½®ä¸€ä¸ªå†…å­˜æ•°æ®åº“ã€‚</p><p>æ‚¨éœ€è¦é€šè¿‡å°† <code>@EnableAutoConfiguration</code> æˆ–è€… <code>@SpringBootApplication</code> æ³¨è§£æ·»åŠ åˆ°å…¶ä¸­ä¸€ä¸ª <code>@Configuration</code> ç±»ä¹‹ä¸Šä»¥å¯ç”¨è‡ªåŠ¨é…ç½®ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>æ‚¨åº”è¯¥ä»…æ·»åŠ ä¸€ä¸ª <code>@EnableAutoConfiguration</code> æ³¨è§£ã€‚æˆ‘ä»¬é€šå¸¸å»ºè®®æ‚¨å°†å…¶æ·»åŠ åˆ°ä¸» <code>@Configuration</code> ç±»ä¸­ã€‚</p></blockquote><p><a id="using-boot-replacing-auto-configuration"></a></p><h3 id="16-1ã€å¹³æ»‘æ›¿æ¢è‡ªåŠ¨é…ç½®">16.1ã€å¹³æ»‘æ›¿æ¢è‡ªåŠ¨é…ç½®</h3><p>è‡ªåŠ¨é…ç½®æ˜¯éå…¥ä¾µçš„ï¼Œæ‚¨å¯ä»¥éšæ—¶å®šä¹‰è‡ªå·±çš„é…ç½®æ¥ä»£æ›¿è‡ªåŠ¨é…ç½®çš„ç‰¹å®šéƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ·»åŠ äº†è‡ªå·±çš„ <code>DataSource</code> beanï¼Œé»˜è®¤çš„åµŒå…¥å¼æ•°æ®åº“æ”¯æŒå°†ä¸ä¼šè‡ªåŠ¨é…ç½®ã€‚</p><p>å¦‚æœæ‚¨éœ€è¦äº†è§£å½“å‰æ­£åœ¨åº”ç”¨çš„è‡ªåŠ¨é…ç½®ï¼Œä»¥åŠä¸ºä»€ä¹ˆä½¿ç”¨ï¼Œè¯·ä½¿ç”¨ <code>--debug</code> å¼€å…³å¯åŠ¨åº”ç”¨ã€‚è¿™æ ·åšå¯ä»¥ä¸ºæ ¸å¿ƒ logger å¯ç”¨è°ƒè¯•æ—¥å¿—ï¼Œå¹¶è®°å½•åˆ°æ§åˆ¶å°ã€‚</p><p><a id="using-boot-disabling-specific-auto-configuration"></a></p><h3 id="16-2ã€ç¦ç”¨æŒ‡å®šçš„è‡ªåŠ¨é…ç½®ç±»">16.2ã€ç¦ç”¨æŒ‡å®šçš„è‡ªåŠ¨é…ç½®ç±»</h3><p>å¦‚æœæ‚¨å‘ç°åœ¨æ­£åœ¨ä½¿ç”¨ä¸éœ€è¦çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ <code>@EnableAutoConfiguration</code> çš„ <code>exclude</code> å±æ€§æ¥ç¦ç”¨å®ƒä»¬ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration(exclude=&#123;DataSourceAutoConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfiguration</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœç±»ä¸åœ¨ classpath ä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ³¨è§£çš„ <code>excludeName</code> å±æ€§å¹¶æŒ‡å®šå®Œå…¨ç±»åã€‚æœ€åï¼Œæ‚¨è¿˜å¯ä»¥é€šè¿‡ <code>spring.autoconfigure.exclude</code> property æ§åˆ¶è¦æ’é™¤çš„è‡ªåŠ¨é…ç½®ç±»åˆ—è¡¨ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>æ‚¨å¯ä»¥åŒæ—¶ä½¿ç”¨æ³¨è§£å’Œ property å®šä¹‰æ’é™¤é¡¹</p></blockquote><p><a id="using-boot-spring-beans-and-dependency-injection"></a></p><h2 id="17ã€Spring-Bean-ä¸ä¾èµ–æ³¨å…¥">17ã€Spring Bean ä¸ä¾èµ–æ³¨å…¥</h2><p>æ‚¨å¯ä»¥è‡ªç”±ä½¿ç”¨ä»»ä½•æ ‡å‡†çš„ Spring Framework æŠ€æœ¯æ¥å®šä¹‰æ‚¨çš„ bean ä»¥åŠå®ƒä»¬æ³¨å…¥çš„ä¾èµ–ã€‚æˆ‘ä»¬å‘ç°ä½¿ç”¨ <code>@ComponentScan</code> æ¥å¯»æ‰¾ bean å’Œç»“åˆ <code>@Autowired</code> æ„é€ å™¨æ³¨å…¥å¯ä»¥å¾ˆå¥½åœ°å·¥ä½œã€‚</p><p>å¦‚æœæ‚¨æŒ‰ç…§ä¸Šè¿°çš„å»ºè®®ï¼ˆå°†åº”ç”¨ç±»æ”¾åœ¨æ ¹åŒ…ä¸­ï¼‰æ¥ç»„ç»‡ä»£ç ï¼Œåˆ™å¯ä»¥æ·»åŠ æ— å‚çš„ <code>@ComponentScan</code>ã€‚æ‰€æœ‰åº”ç”¨ç»„ä»¶ï¼ˆ<code>@Component</code>ã€<code>@Service</code>ã€<code>@Repository</code>ã€<code>@Controller</code> ç­‰ï¼‰å°†è‡ªåŠ¨æ³¨å†Œä¸º Spring Beanã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ª <code>@Service</code> Beanï¼Œå…¶ä½¿ç”¨æ„é€ æ³¨å…¥æ–¹å¼è·å–ä¸€ä¸ªå¿…éœ€çš„ <code>RiskAssessor</code> beanã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatabaseAccountService</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> RiskAssessor riskAssessor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">DatabaseAccountService</span><span class="params">(RiskAssessor riskAssessor)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.riskAssessor = riskAssessor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ bean ä¸­åªæœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œæ‚¨å¯ä»¥å¿½ç•¥æ‰ <code>@Autowired</code> æ³¨è§£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatabaseAccountService</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> RiskAssessor riskAssessor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">DatabaseAccountService</span><span class="params">(RiskAssessor riskAssessor)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.riskAssessor = riskAssessor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>è¯·æ³¨æ„ï¼Œæ„é€ æ³¨å…¥å…è®¸ <code>riskAssessor</code> å­—æ®µè¢«ä¿®é¥°ä¸º <code>final</code>ï¼Œè¿™è¡¨ç¤ºä»¥åå®ƒä¸èƒ½è¢«æ›´æ”¹ã€‚</p></blockquote><p><a id="using-boot-using-springbootapplication-annotation"></a></p><h2 id="18ã€ä½¿ç”¨-SpringBootApplication-æ³¨è§£">18ã€ä½¿ç”¨ @SpringBootApplication æ³¨è§£</h2><p>å¾ˆå¤š Spring Boot å¼€å‘è€…æ€»æ˜¯ä½¿ç”¨ <code>@Configuration</code>ã€<code>@EnableAutoConfiguration</code> å’Œ <code>@ComponentScan</code> æ³¨è§£æ ‡è®°åœ¨ä¸»ç±»ä¸Šã€‚ç”±äº è¿™äº›æ³¨è§£ç»å¸¸ä¸€èµ·ä½¿ç”¨ï¼ˆç‰¹åˆ«æ˜¯å¦‚æœæ‚¨éµå¾ªä¸Šè¿°çš„<a href="#using-boot-structuring-your-code">æœ€ä½³å®è·µ</a>ï¼‰ã€‚Spring Boot æä¾›äº†ä¸€ä¸ªæ›´æ–¹ä¾¿çš„ <code>@SpringBootApplication</code> æ³¨è§£å¯ç”¨æ¥æ›¿ä»£è¿™ä¸ªç»„åˆã€‚</p><p><code>@SpringBootApplication</code> æ³¨è§£ç›¸å½“äºä½¿ç”¨ <code>@Configuration</code>ã€<code>@EnableAutoConfiguration</code> å’Œ <code>@ComponentScan</code> åŠä»–ä»¬çš„é»˜è®¤å±æ€§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapplication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span> <span class="comment">// ç›¸å½“äºä½¿ç”¨ @Configuration @EnableAutoConfiguration @ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(Application.class, args);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p><code>@SpringBootApplication</code> è¿˜æä¾›äº†åˆ«åæ¥è‡ªå®šä¹‰ <code>@EnableAutoConfiguration</code> å’Œ <code>@ComponentScan</code> çš„å±æ€§ã€‚</p></blockquote><p><a id="using-boot-running-your-application"></a></p><h2 id="19ã€è¿è¡Œæ‚¨çš„åº”ç”¨">19ã€è¿è¡Œæ‚¨çš„åº”ç”¨</h2><p>å°†åº”ç”¨ç¨‹åºæ‰“åŒ…æˆ <code>jar</code> å¯æ‰§è¡Œæ–‡ä»¶å¹¶ä½¿ç”¨åµŒå…¥å¼ HTTP æœåŠ¡å™¨çš„æœ€å¤§æœ‰ç‚¹ä¹‹ä¸€å°±æ˜¯å¯ä»¥æŒ‰ç…§æ‚¨æƒ³ä½¿ç”¨çš„å…¶å®ƒæ–¹å¼æ¥è¿è¡Œåº”ç”¨ã€‚è°ƒè¯• Spring Boot ä¹Ÿæ˜¯å¾ˆç®€å•ï¼Œæ‚¨ä¸éœ€è¦ä»»ä½•ç‰¹æ®Šçš„ IDE æ’ä»¶æˆ–è€…æ‰©å±•ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>æœ¬ç« èŠ‚ä»…æ¶µç›–åŸºäºã€€jarã€€çš„æ‰“åŒ…æ–¹å¼ï¼Œå¦‚æœæ‚¨é€‰æ‹©å°†åº”ç”¨æ‰“åŒ…ä¸ºã€€warã€€æ–‡ä»¶ï¼Œåˆ™åº”è¯¥å‚è€ƒæ‚¨çš„æœåŠ¡å™¨å’Œã€€IDEã€€æ–‡æ¡£ã€‚</p></blockquote><p><a id="using-boot-running-your-application"></a></p><h3 id="19-1ã€ä½¿ç”¨-IDE-è¿è¡Œ">19.1ã€ä½¿ç”¨ IDE è¿è¡Œ</h3><p>æ‚¨å¯ä»¥ä½¿ç”¨ IDE è¿è¡Œ Spring Bootåº”ç”¨ï¼Œå°±åƒè¿è¡Œä¸€ä¸ªç®€å•çš„ Java åº”ç”¨ç¨‹åºä¸€æ ·ï¼Œä½†æ˜¯é¦–å…ˆæ‚¨éœ€è¦å¯¼å…¥é¡¹ç›®ï¼Œå¯¼å…¥æ­¥éª¤å–å†³äºæ‚¨çš„ IDE å’Œæ„å»ºç³»ç»Ÿã€‚å¤§å¤šæ•° IDE å¯ä»¥ç›´æ¥å¯¼å…¥ Maven é¡¹ç›®ï¼Œä¾‹å¦‚ Eclipse ç”¨æˆ·å¯ä»¥ä» <code>File</code> èœå•ä¸­é€‰æ‹© <code>Import</code> â€‹ â†’ <code>Existing Maven Projects</code>ã€‚</p><p>å¦‚æœæ‚¨æ— æ³•å°†é¡¹ç›®ç›´æ¥å¯¼å…¥åˆ° IDE ä¸­ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ„å»ºæ’ä»¶ç”Ÿæˆ IDE å…ƒæ•°æ®ï¼ˆmetadataï¼‰ã€‚Maven åŒ…å«äº† <a href="https://maven.apache.org/plugins/maven-eclipse-plugin/">Eclipse</a> å’Œ <a href="https://maven.apache.org/plugins/maven-idea-plugin/">IDEA</a> çš„æ’ä»¶,Gradle ä¹Ÿä¸º<a href="https://docs.gradle.org/4.2.1/userguide/userguide.html">å„ç§ IDE</a> æä¾›äº†æ’ä»¶ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœæ‚¨ä¸å°å¿ƒè¿è¡Œäº†ä¸¤æ¬¡ web åº”ç”¨ï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ª <strong>Port already in use</strong> ï¼ˆç«¯å£å·²ç»è¢«ä½¿ç”¨ï¼‰é”™è¯¯ã€‚STS ç”¨æˆ·å¯ä»¥ä½¿ç”¨ <code>Relaunch</code> æŒ‰é’®è¿è¡Œä»¥ç¡®ä¿ç°æœ‰çš„ä»»ä½•å®ä¾‹éƒ½å·²å…³é—­ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ Run æŒ‰é’®ã€‚</p></blockquote><p><a id="using-boot-running-as-a-packaged-application"></a></p><h3 id="19-2ã€ä½œä¸ºæ‰“åŒ…åº”ç”¨è¿è¡Œ">19.2ã€ä½œä¸ºæ‰“åŒ…åº”ç”¨è¿è¡Œ</h3><p>å¦‚æœæ‚¨ä½¿ç”¨ Spring Boot Maven æˆ–è€… Gradle æ’ä»¶åˆ›å»ºå¯æ‰§è¡Œ jarï¼Œå¯ä»¥ä½¿ç”¨ <code>java -jar</code> å‘½ä»¤è¿è¡Œåº”ç”¨ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar target/myapplication-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ‰“åŒ…åº”ç”¨ç¨‹åºæ—¶å¼€å¯è¿œç¨‹è°ƒè¯•æ”¯æŒã€‚è¯¥åŠŸèƒ½å…è®¸æ‚¨å°†è°ƒè¯•å™¨é™„åŠ åˆ°æ‰“åŒ…çš„åº”ç”¨ä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ java -Xdebug -Xrunjdwp:server=y,transport=dt_socket,address=8000,<span class="built_in">suspend</span>=n \</span><br><span class="line">       -jar target/myapplication-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure><p><a id="using-boot-running-with-the-maven-plugin"></a></p><h3 id="19-3ã€ä½¿ç”¨-Maven-æ’ä»¶">19.3ã€ä½¿ç”¨ Maven æ’ä»¶</h3><p>Spring Boot Maven æ’ä»¶åŒ…å«ä¸€ä¸ªå¯ç”¨äºå¿«é€Ÿç¼–è¯‘å’Œè¿è¡Œåº”ç”¨ç¨‹åºçš„ <code>run</code> goalã€‚åº”ç”¨ç¨‹åºä»¥å¿«é€Ÿå½¢å¼è¿è¡Œï¼Œå°±åƒåœ¨ IDE ä¸­ä¸€æ ·ã€‚ä»¥ä¸‹ç¤ºä¾‹å±•ç¤ºäº†è¿è¡Œ Spring Boot åº”ç”¨ç¨‹åºçš„å…¸å‹ Maven å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mvn spring-boot:run</span><br></pre></td></tr></table></figure><p>æ‚¨å¯èƒ½è¿˜æƒ³ä½¿ç”¨ <code>MAVEN_OPTS</code> æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> MAVEN_OPTS=-Xmx1024m</span><br></pre></td></tr></table></figure><p><a id="using-boot-running-with-the-gradle-plugin"></a></p><h3 id="19-4ã€ä½¿ç”¨-Gradle-æ’ä»¶">19.4ã€ä½¿ç”¨ Gradle æ’ä»¶</h3><p>Spring Boot Gradle æ’ä»¶åŒ…å«ä¸€ä¸ª <code>bootRun</code> ä»»åŠ¡ï¼Œå¯ç”¨äºä»¥å¿«é€Ÿå½¢å¼è¿è¡Œåº”ç”¨ç¨‹åºã€‚æ¯å½“åº”ç”¨ <code>org.springframework.boot</code> å’Œ java æ’ä»¶æ—¶éƒ½ä¼šæ·»åŠ  <code>bootRun</code> ä»»åŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gradle bootRun</span><br></pre></td></tr></table></figure><p>æ‚¨å¯èƒ½è¿˜æƒ³ä½¿ç”¨ <code>JAVA_OPTS</code> æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> JAVA_OPTS=-Xmx1024m</span><br></pre></td></tr></table></figure><p><a id="using-boot-hot-swapping"></a></p><h3 id="19-5ã€çƒ­äº¤æ¢">19.5ã€çƒ­äº¤æ¢</h3><p>ç”±äº Spring Boot åº”ç”¨ç¨‹åºåªæ˜¯æ™®é€šçš„ Java åº”ç”¨ç¨‹åºï¼Œå› æ­¤ JVM çƒ­æ’æ‹”æ˜¯å¯ä»¥å¼€ç®±å³ç”¨ã€‚JVM çƒ­æ’æ‹”åœ¨å¯æ›¿æ¢å­—èŠ‚ç æ–¹é¢æœ‰æ‰€é™åˆ¶ã€‚æƒ³è¦æ›´å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://zeroturnaround.com/software/jrebel/">JRebel</a>ã€‚</p><p><code>spring-boot-devtools</code> æ¨¡å—åŒ…å«äº†å¯¹å¿«é€Ÿé‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºçš„æ”¯æŒã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æœ¬ç« åé¢çš„<a href="#using-boot-devtools">ç¬¬ 20 ç« ï¼šå¼€å‘äººå‘˜å·¥å…·</a>éƒ¨åˆ†ä»¥åŠ<a href="#howto-hotswapping">çƒ­æ’æ‹”çš„ How-to éƒ¨åˆ†</a>ã€‚</p><p><a id="using-boot-devtools"></a></p><h2 id="20ã€å¼€å‘è€…å·¥å…·">20ã€å¼€å‘è€…å·¥å…·</h2><p>Spring Boot åŒ…å«äº†ä¸€å¥—å·¥å…·ï¼Œå¯ä»¥ä½¿åº”ç”¨å¼€å‘ä½“éªŒæ›´åŠ æ„‰å¿«ã€‚<code>spring-boot-devtools</code> æ¨¡å—å¯åŒ…å«åœ¨ä»»ä½•é¡¹ç›®ä¸­ï¼Œä»¥æä¾›é¢å¤–çš„å¼€å‘æ—¶ï¼ˆdevelopment-timeï¼‰åŠŸèƒ½ã€‚è¦å¯ç”¨ devtools æ”¯æŒï¼Œåªéœ€è¦å°†æ¨¡å—ä¾èµ–æ·»åŠ åˆ°æ‚¨çš„æ„å»ºé…ç½®ä¸­å³å¯ï¼š</p><p><strong>Maven</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>Gradle</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">compile(&quot;org.springframework.boot:spring-boot-devtools&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>å½“è¿è¡Œå®Œå…¨æ‰“åŒ…çš„åº”ç”¨æ—¶ï¼Œå¼€å‘è€…å·¥å…·å°†ä¼šè‡ªåŠ¨ç¦ç”¨ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ä½¿ç”¨äº† <code>java -jar</code> æ–¹å¼æˆ–è€…ç‰¹æ®Šçš„ç±»åŠ è½½å™¨å¯åŠ¨ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ª<strong>ç”Ÿäº§çº§åˆ«åº”ç”¨</strong>ã€‚å°† Maven çš„ä¾èµ–æ ‡è®°ä¸ºå¯é€‰æˆ–è€…åœ¨ Gradle ä¸­ä½¿ç”¨ <code>compileOnly</code> æ˜¯é˜²æ­¢æ‚¨çš„é¡¹ç›®è¢«å…¶ä»–æ¨¡å—ä½¿ç”¨æ—¶ devtools è¢«åº”ç”¨åˆ°å…¶å®ƒæ¨¡å—çš„æœ€ä½³æ–¹æ³•ã€‚</p></blockquote><p><strong>æç¤º</strong></p><blockquote><p>é‡æ–°æ‰“åŒ…çš„å½’æ¡£é»˜è®¤æƒ…å†µä¸‹ä¸åŒ…å« devtoolsã€‚å¦‚æœè¦ä½¿ç”¨<a href="#using-boot-devtools-remote">æŸäº›è¿œç¨‹ devtools åŠŸèƒ½</a>, ä½ éœ€è¦ç¦ç”¨ <code>excludeDevtools</code> æ„å»ºå±æ€§ä»¥æŠŠ devtools åŒ…å«è¿›æ¥ã€‚è¯¥å±æ€§æ”¯æŒ Maven å’Œ Gradle æ’ä»¶ã€‚</p></blockquote><p><a id="using-boot-devtools-property-defaults"></a></p><h3 id="20-1ã€Property-é»˜è®¤å€¼">20.1ã€Property é»˜è®¤å€¼</h3><p>Spring Boot æ‰€æ”¯æŒçš„ä¸€äº›åº“ä½¿ç”¨äº†ç¼“å­˜æ¥æé«˜æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œ<a href="#boot-features-spring-mvc-template-engines">æ¨¡æ¿å¼•æ“</a>å°†ç¼“å­˜ç¼–è¯‘åçš„æ¨¡æ¿ï¼Œä»¥é¿å…é‡å¤è§£ææ¨¡æ¿æ–‡ä»¶ã€‚æ­¤å¤–ï¼ŒSpring MVC å¯ä»¥åœ¨æœåŠ¡é™æ€èµ„æºæ—¶æ·»åŠ  HTTP ç¼“å­˜å¤´ã€‚</p><p>è™½ç„¶ç¼“å­˜åœ¨ç”Ÿäº§ä¸­éå¸¸æœ‰ç”¨ï¼Œä½†å®ƒåœ¨å¼€å‘è¿‡ç¨‹å¯èƒ½ä¼šäº§ç”Ÿç›¸åçš„æ•ˆæœï¼Œè®©æ‚¨ä¸èƒ½åŠæ—¶çœ‹åˆ°åˆšæ‰åœ¨åº”ç”¨ä¸­ä½œå‡ºçš„æ›´æ”¹ã€‚å› æ­¤ï¼Œ<code>spring-boot-devtools</code> å°†é»˜è®¤ç¦ç”¨è¿™äº›ç¼“å­˜é€‰é¡¹ã€‚</p><p>ä¸€èˆ¬æ˜¯åœ¨ <code>application.properties</code> æ–‡ä»¶ä¸­è®¾ç½®ç¼“å­˜é€‰é¡¹ã€‚ä¾‹å¦‚ï¼ŒThymeleaf æä¾›äº† <code>spring.thymeleaf.cache</code> å±æ€§ã€‚æ‚¨ä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®è¿™äº›å±æ€§ï¼Œ<code>spring-boot-devtools</code> ä¼šè‡ªåŠ¨åº”ç”¨åˆé€‚çš„å¼€å‘æ—¶ï¼ˆdevelopment-timeï¼‰é…ç½®ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>æœ‰å…³åº”ç”¨å±æ€§çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜… <a href="https://github.com/spring-projects/spring-boot/tree/v2.0.1.RELEASE/spring-boot-project/spring-boot-devtools/src/main/java/org/springframework/boot/devtools/env/DevToolsPropertyDefaultsPostProcessor.java">DevToolsPropertyDefaultsPostProcessor</a>ã€‚</p></blockquote><p><a id="using-boot-devtools-restart"></a></p><h3 id="20-2ã€è‡ªåŠ¨é‡å¯">20.2ã€è‡ªåŠ¨é‡å¯</h3><p>ä½¿ç”¨ <code>spring-boot-devtools</code> çš„åº”ç”¨åœ¨ classpath ä¸‹çš„æ–‡ä»¶å‘ç”Ÿæ›´æ”¹æ—¶ä¼šè‡ªåŠ¨é‡å¯ã€‚è¿™å¯¹äºä½¿ç”¨ IDE å·¥ä½œè€Œè¨€å¯èƒ½æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„åŠŸèƒ½ï¼Œå› ä¸ºå®ƒä¸ºä»£ç å˜æ›´æä¾›äº†éå¸¸å—çš„åé¦ˆç¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†ç›‘è§† classpath æŒ‡å‘çš„æ‰€æœ‰æ–‡ä»¶å¤¹ã€‚è¯·æ³¨æ„ï¼ŒæŸäº›èµ„æºï¼ˆå¦‚é™æ€èµ„æºå’Œè§†å›¾æ¨¡æ¿ï¼‰<a href="using-boot-devtools-restart-exclude">ä¸éœ€è¦é‡å¯åº”ç”¨</a>ã€‚</p><hr><p><strong>è§¦å‘é‡å¯</strong></p><p>å½“ DevTools ç›‘è§† classpath èµ„æºæ—¶ï¼Œè§¦å‘é‡å¯çš„å”¯ä¸€æ–¹å¼æ˜¯æ›´æ–° classpathã€‚ä½¿ classpath æ›´æ–°çš„æ–¹å¼å–å†³äºæ‚¨ä½¿ç”¨çš„ IDEã€‚åœ¨ Eclipse ä¸­ï¼Œä¿å­˜ä¿®æ”¹çš„æ–‡ä»¶å°†æ›´æ–° classpathï¼Œä»è€Œè§¦å‘é‡å¯ã€‚åœ¨ IntelliJ IDEA ä¸­ï¼Œæ„å»ºé¡¹ç›®ï¼ˆ<code>Build -&gt; Make Project</code>) å°†äº§ç”Ÿç›¸åŒçš„æ•ˆæœã€‚</p><hr><p><strong>æ³¨æ„</strong></p><blockquote><p>åªè¦ forking è¢«å¼€å¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å—æ”¯æŒçš„æ„å»ºå·¥å…·ï¼ˆå¦‚ Maven æˆ– Gradleï¼‰æ¥å¯ç”¨åº”ç”¨ï¼Œå› ä¸º DevTools éœ€è¦éš”ç¦»åº”ç”¨ç±»åŠ è½½å™¨æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“åœ¨ classpath ä¸‹æ£€æµ‹åˆ° DevTools æ—¶ï¼ŒGradle å’Œ Maven ä¼šè¿™ä¹ˆåšã€‚</p></blockquote><p><strong>æç¤º</strong></p><blockquote><p>è‡ªåŠ¨é‡å¯åŠŸèƒ½ä¸ LiveReloadï¼ˆå®æ—¶é‡è½½ï¼‰ä¸€èµ·ä½¿ç”¨æ•ˆæœæ›´æ£’ã€‚<a href="#using-boot-devtools-livereload">é˜…è¯» LiveReload ç« èŠ‚</a>ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚å¦‚æœæ‚¨ä½¿ç”¨ JRebelï¼Œè‡ªåŠ¨é‡å¯å°†ä¼šè¢«ç¦ç”¨ï¼Œä»¥æ”¯æŒåŠ¨æ€ç±»é‡è½½ï¼Œä½†å…¶ä»– devtools åŠŸèƒ½ï¼ˆå¦‚ LiveReload å’Œ property è¦†ç›–ï¼‰ä»ç„¶å¯ä»¥ä½¿ç”¨ã€‚</p></blockquote><p><strong>æ³¨æ„</strong></p><blockquote><p>DevTools ä¾èµ–äºåº”ç”¨ä¸Šä¸‹æ–‡çš„å…³é—­é’©å­ï¼Œä»¥åœ¨é‡å¯æœŸé—´å…³é—­è‡ªå·±ã€‚å¦‚æœç¦ç”¨äº†å…³é—­é’©å­ï¼ˆ<code>SpringApplication.setRegisterShutdownHook(false)</code>ï¼‰ï¼Œå®ƒå°†ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚</p></blockquote><p><strong>æ³¨æ„</strong></p><blockquote><p>å½“ classpath ä¸‹çš„å†…å®¹å‘ç”Ÿæ›´æ”¹ï¼Œå†³å®šæ˜¯å¦è§¦å‘é‡å¯æ—¶ï¼ŒDevTools ä¼šè‡ªåŠ¨å¿½ç•¥åä¸º <code>spring-boot</code>ã€<code>spring-boot-devtools</code>ã€<code>spring-boot-autoconfigure</code>ã€<code>spring-boot-actuator</code> å’Œ <code>spring-boot-starter</code> çš„é¡¹ç›®ã€‚</p></blockquote><p><strong>æ³¨æ„</strong></p><blockquote><p>DevTools éœ€è¦è‡ªå®šä¹‰ <code>ApplicationContext</code> ä½¿ç”¨åˆ°çš„ <code>ResourceLoader</code>ã€‚å¦‚æœæ‚¨çš„åº”ç”¨å·²ç»æä¾›äº†ä¸€ä¸ªï¼Œå®ƒå°†è¢«åŒ…è£…èµ·æ¥ï¼Œå› ä¸ºä¸æ”¯æŒåœ¨ <code>ApplicationContext</code> ä¸Šç›´æ¥è¦†ç›– <code>getResource</code> æ–¹æ³•ã€‚</p></blockquote><hr><p><strong>é‡å¯ï¼ˆRestartï¼‰ä¸é‡è½½ï¼ˆReloadï¼‰</strong></p><p>Spring Boot é€šè¿‡ä½¿ç”¨ä¸¤ä¸ªç±»åŠ è½½å™¨æ¥æä¾›äº†é‡å¯æŠ€æœ¯ã€‚ä¸æ”¹å˜çš„ç±»ï¼ˆä¾‹å¦‚ï¼Œç¬¬ä¸‰æ–¹ jarï¼‰è¢«åŠ è½½åˆ° <strong>base</strong> ç±»åŠ è½½å™¨ä¸­ã€‚ç»å¸¸å¤„äºå¼€å‘çŠ¶æ€çš„ç±»è¢«åŠ è½½åˆ° <strong>restart</strong> ç±»åŠ è½½å™¨ä¸­ã€‚å½“åº”ç”¨é‡å¯æ—¶ï¼Œ<strong>restart</strong> ç±»åŠ è½½å™¨å°†è¢«ä¸¢å¼ƒï¼Œå¹¶é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ã€‚è¿™ç§æ–¹å¼æ„å‘³ç€åº”ç”¨é‡å¯æ¯”<strong>å†·å¯åŠ¨</strong>è¦å¿«å¾—å¤šï¼Œå› ä¸ºçœå» <strong>base</strong> ç±»åŠ è½½å™¨çš„å¤„ç†æ­¥éª¤ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p><p>å¦‚æœæ‚¨è§‰å¾—é‡å¯è¿˜ä¸å¤Ÿå¿«ï¼Œæˆ–è€…é‡åˆ°ç±»åŠ è½½é—®é¢˜ï¼Œæ‚¨å¯ä»¥è€ƒè™‘å¦‚ ZeroTurnaround çš„ <a href="https://zeroturnaround.com/software/jrebel/">JRebel</a> ç­‰å·¥å…·ã€‚ä»–ä»¬æ˜¯é€šè¿‡åœ¨åŠ è½½ç±»æ—¶é‡å†™ç±»æ¥åŠ å¿«é‡æ–°åŠ è½½ã€‚</p><hr><p><a id="using-boot-devtools-restart-logging-condition-delta"></a></p><h4 id="20-2-1ã€æ¡ä»¶è¯„ä¼°å˜æ›´æ—¥å¿—">20.2.1ã€æ¡ä»¶è¯„ä¼°å˜æ›´æ—¥å¿—</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯æ¬¡åº”ç”¨é‡å¯æ—¶ï¼Œéƒ½ä¼šè®°å½•æ˜¾ç¤ºæ¡ä»¶è¯„ä¼°å¢é‡çš„æŠ¥å‘Šã€‚è¯¥æŠ¥å‘Šå±•ç¤ºäº†åœ¨æ‚¨è¿›è¡Œæ›´æ”¹ï¼ˆå¦‚æ·»åŠ æˆ–åˆ é™¤ bean ä»¥åŠè®¾ç½®é…ç½®å±æ€§ï¼‰æ—¶å¯¹åº”ç”¨è‡ªåŠ¨é…ç½®æ‰€ä½œå‡ºçš„æ›´æ”¹ã€‚</p><p>è¦ç¦ç”¨æŠ¥å‘Šçš„æ—¥å¿—è®°å½•ï¼Œè¯·è®¾ç½®ä»¥ä¸‹å±æ€§ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.devtools.restart.log-condition-evaluation-delta</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure><p><a id="using-boot-devtools-restart-exclude"></a></p><h4 id="20-2-2ã€æ’é™¤èµ„æº">20.2.2ã€æ’é™¤èµ„æº</h4><p>æŸäº›èµ„æºåœ¨æ›´æ”¹æ—¶ä¸ä¸€å®šéœ€è¦è§¦å‘é‡å¯ã€‚ä¾‹å¦‚ï¼ŒThymeleaf æ¨¡æ¿å¯ä»¥å®æ—¶ç¼–è¾‘ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ›´æ”¹ <code>/META-INF/maven</code>ã€<code>/META-INF/resources</code>ã€<code>/resources</code>ã€<code>/static</code>ã€<code>/public</code> æˆ–è€… <code>/templates</code> ä¸ä¼šè§¦å‘é‡å¯ï¼Œä½†ä¼šè§¦å‘ <a href="#using-boot-devtools-livereload">LiveReload</a>ã€‚å¦‚æœæ‚¨æƒ³è‡ªå®šä¹‰æ’é™¤é¡¹ï¼Œå¯ä»¥ä½¿ç”¨ <code>spring.devtools.restart.exclude</code> å±æ€§ã€‚ä¾‹å¦‚ï¼Œä»…æ’é™¤ <code>/static</code> å’Œ <code>/public</code>ï¼Œæ‚¨å¯ä»¥è®¾ç½®ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.devtools.restart.exclude</span>=<span class="string">static/**,public/**</span></span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœè¦ä¿ç•™è¿™äº›é»˜è®¤å€¼å¹¶<strong>æ·»åŠ </strong>å…¶ä»–æ’é™¤é¡¹ ï¼Œè¯·æ”¹ç”¨ <code>spring.devtools.restart.additional-exclude</code> å±æ€§ã€‚</p></blockquote><p><a id="using-boot-devtools-restart-additional-paths"></a></p><h4 id="20-2-3ã€ç›‘è§†é™„åŠ è·¯å¾„">20.2.3ã€ç›‘è§†é™„åŠ è·¯å¾„</h4><p>å¦‚æœæ‚¨æƒ³åœ¨å¯¹ä¸åœ¨ classpath ä¸‹çš„æ–‡ä»¶è¿›è¡Œä¿®æ”¹æ—¶é‡å¯æˆ–é‡è½½åº”ç”¨ï¼Œè¯·ä½¿ç”¨ <code>spring.devtools.restart.additional-paths</code> å±æ€§æ¥é…ç½®ç›‘è§†å…¶ä»–è·¯å¾„çš„æ›´æ”¹æƒ…å†µã€‚æ‚¨å¯ä»¥ä½¿ç”¨<a href="#using-boot-devtools-restart-exclude">ä¸Šè¿°</a>çš„ <code>spring.devtools.restart.exclude</code> å±æ€§æ¥æ§åˆ¶é™„åŠ è·¯å¾„ä¸‹çš„æ–‡ä»¶è¢«ä¿®æ”¹æ—¶æ˜¯å¦è§¦å‘é‡å¯æˆ–åªæ˜¯ <a href="#using-boot-devtools-livereload">LiveReload</a>ã€‚</p><p><a id="using-boot-devtools-restart-disable"></a></p><h4 id="20-2-4ã€ç¦ç”¨é‡å¯">20.2.4ã€ç¦ç”¨é‡å¯</h4><p>æ‚¨å¦‚æœä¸æƒ³ä½¿ç”¨é‡å¯åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨ <code>spring.devtools.restart.enabled</code> å±æ€§æ¥ç¦ç”¨å®ƒã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥åœ¨ <code>application.properties</code> ä¸­è®¾ç½®æ­¤å±æ€§ï¼ˆé‡å¯ç±»åŠ è½½å™¨ä»å°†è¢«åˆå§‹åŒ–ï¼Œä½†ä¸ä¼šç›‘è§†æ–‡ä»¶æ›´æ”¹ï¼‰ã€‚</p><p>å¦‚æœæ‚¨éœ€è¦<strong>å®Œå…¨</strong>ç¦ç”¨é‡å¯æ”¯æŒï¼ˆä¾‹å¦‚ï¼Œå¯èƒ½å®ƒä¸é€‚ç”¨äºæŸäº›ç±»åº“ï¼‰ï¼Œæ‚¨éœ€è¦åœ¨è°ƒç”¨ <code>SpringApplication.run(â€‹...)</code> ä¹‹å‰å°† System å±æ€§ <code>spring.devtools.restart.enabled System</code> è®¾ç½®ä¸º <code>false</code>ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">System.setProperty(<span class="string">&quot;spring.devtools.restart.enabled&quot;</span>, <span class="string">&quot;false&quot;</span>);</span><br><span class="line">SpringApplication.run(MyApp.class, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="using-boot-devtools-restart-triggerfile"></a></p><h4 id="20-2-5ã€ä½¿ç”¨è§¦å‘æ–‡ä»¶">20.2.5ã€ä½¿ç”¨è§¦å‘æ–‡ä»¶</h4><p>å¦‚æœæ‚¨ä½¿ç”¨ IDE è¿›è¡Œå¼€å‘ï¼Œå¹¶ä¸”æ—¶æ—¶åˆ»åˆ»åœ¨ç¼–è¯‘æ›´æ”¹çš„æ–‡ä»¶ï¼Œæˆ–è®¸æ‚¨åªæ˜¯å¸Œæœ›åœ¨ç‰¹å®šçš„æ—¶é—´å†…è§¦å‘é‡å¯ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<strong>è§¦å‘æ–‡ä»¶</strong>ï¼Œè¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šæ–‡ä»¶ï¼Œæ‚¨æƒ³è¦è§¦å‘é‡å¯æ£€æŸ¥æ—¶ï¼Œå¿…é¡»ä¿®æ”¹å®ƒã€‚æ›´æ”¹æ–‡ä»¶åªä¼šè§¦å‘æ£€æŸ¥ï¼Œåªæœ‰åœ¨ Devtools æ£€æŸ¥åˆ°å®ƒéœ€è¦åšæŸäº›æ“ä½œæ—¶æ‰ä¼šè§¦å‘é‡å¯ï¼Œå¯ä»¥æ‰‹åŠ¨æ›´æ–°è§¦å‘æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ IDE æ’ä»¶æ›´æ–°ã€‚</p><p>è¦ä½¿ç”¨è§¦å‘æ–‡ä»¶ï¼Œè¯·è®¾ç½® <code>spring.devtools.restart.trigger-file</code> å±æ€§æŒ‡å‘è§¦å‘æ–‡ä»¶çš„è·¯å¾„ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>æ‚¨ä¹Ÿè®¸æƒ³å°† <code>spring.devtools.restart.trigger-file</code> è®¾ç½®æˆä¸€ä¸ª<a href="#using-boot-devtools-globalsettings">å…¨å±€é…ç½®</a>ï¼Œä»¥ä½¿å¾—æ‰€æœ‰çš„é¡¹ç›®éƒ½èƒ½åº”ç”¨æ­¤æ–¹å¼ã€‚</p></blockquote><p><a id="using-boot-devtools-customizing-classload"></a></p><h4 id="20-2-6ã€è‡ªå®šä¹‰é‡å¯ç±»åŠ è½½å™¨">20.2.6ã€è‡ªå®šä¹‰é‡å¯ç±»åŠ è½½å™¨</h4><p>æ­£å¦‚ä¹‹å‰çš„<a href="#using-spring-boot-restart-vs-reload">é‡å¯å’Œé‡è½½</a>éƒ¨åˆ†æ‰€è¿°ï¼Œé‡å¯åŠŸèƒ½æ˜¯é€šè¿‡ä½¿ç”¨ä¸¤ä¸ªç±»åŠ è½½å™¨æ¥å®ç°çš„ã€‚å¯¹äºå¤§å¤šæ•°åº”ç”¨è€Œè¨€ï¼Œè¿™ç§æ–¹å¼å¾ˆå¥½ï¼Œç„¶è€Œï¼Œæœ‰æ—¶å¯èƒ½ä¼šå¯¼è‡´ç±»åŠ è½½å‡ºç°é—®é¢˜ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒIDE ä¸­ä»»ä½•æ‰“å¼€çš„é¡¹ç›®å°†ä½¿ç”¨ <strong>restart</strong> ç±»åŠ è½½å™¨åŠ è½½ï¼Œä»»ä½•å¸¸è§„çš„ <code>.jar</code> æ–‡ä»¶å°†ä½¿ç”¨ <strong>base</strong> ç±»åŠ è½½å™¨åŠ è½½ã€‚æ‚¨å¦‚æœå¼€å‘çš„æ˜¯å¤šæ¨¡å—é¡¹ç›®ï¼Œè€Œä¸æ˜¯æ¯ä¸€ä¸ªæ¨¡å—éƒ½å¯¼å…¥åˆ° IDE ä¸­ï¼Œåˆ™å¯èƒ½éœ€è¦è‡ªå®šä¹‰ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ª <code>META-INF/spring-devtools.properties</code> æ–‡ä»¶ã€‚</p><p><code>spring-devtools.properties</code> æ–‡ä»¶å¯ä»¥åŒ…å«ä»¥ <code>restart.exclude.</code> å’Œ <code>restart.include.</code> ä¸ºå‰ç¼€çš„å±æ€§ã€‚<code>include</code> å…ƒç´ æ˜¯åŠ è½½åˆ° <strong>restart</strong> ç±»åŠ è½½å™¨çš„é¡¹ï¼Œ<code>exclude</code> å…ƒç´ æ˜¯åŠ è½½åˆ° <strong>base</strong> ç±»åŠ è½½å™¨çš„é¡¹ã€‚å±æ€§å€¼æ˜¯ä¸€ä¸ªåº”ç”¨åˆ° classpath çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">restart.exclude.companycommonlibs</span>=<span class="string">/mycorp-common-[\\w-]+\.jar</span></span><br><span class="line"><span class="attr">restart.include.projectcommon</span>=<span class="string">/mycorp-myproj-[\\w-]+\.jar</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>æ‰€æœ‰å±æ€§é”®åå¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚åªè¦æœ‰ä¸€ä¸ªå±æ€§ä»¥ <code>restart.include.</code> æˆ– <code>restart.exclude.</code> å¼€å¤´ï¼Œå®ƒå°†ä¼šè¢«è€ƒè™‘ã€‚</p></blockquote><p><strong>æç¤º</strong></p><blockquote><p>classpath ä¸‹çš„æ‰€æœ‰ <code>META-INF/spring-devtools.properties</code> æ–‡ä»¶å°†è¢«åŠ è½½ï¼Œæ‚¨å¯ä»¥å°†å®ƒä»¬æ‰“åŒ…è¿›å·¥ç¨‹æˆ–è€…ç±»åº“ä¸­ä¸ºé¡¹ç›®æ‰€ç”¨ã€‚</p></blockquote><p><a id="using-boot-devtools-known-restart-limitations"></a></p><h4 id="20-2-7ã€å·²çŸ¥é™åˆ¶">20.2.7ã€å·²çŸ¥é™åˆ¶</h4><p>é‡æ–°å¯åŠ¨åŠŸèƒ½å¯¹ä½¿ç”¨æ ‡å‡† <code>ObjectInputStream</code> ååºåˆ—åŒ–çš„å¯¹è±¡æ— æ•ˆã€‚æ‚¨å¦‚æœéœ€è¦ååºåˆ—åŒ–æ•°æ®ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ Spring çš„ <code>ConfigurableObjectInputStream</code> é…åˆ <code>Thread.currentThread().getContextClassLoader()</code>ã€‚</p><p>é—æ†¾çš„æ˜¯ï¼Œä¸€äº›ç¬¬ä¸‰æ–¹ç±»åº“åœ¨æ²¡æœ‰è€ƒè™‘ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨çš„æƒ…å†µä¸‹ä½¿ç”¨äº†ååºåˆ—åŒ–ã€‚æ‚¨å¦‚æœé‡åˆ°æ­¤é—®é¢˜ï¼Œéœ€è¦å‘åŸä½œè€…æäº¤ä¿®å¤è¯·æ±‚ã€‚</p><p><a id="using-boot-devtools-livereload"></a></p><h3 id="20-3ã€LiveReload">20.3ã€LiveReload</h3><p><code>spring-boot-devtools</code> æ¨¡å—åŒ…æ‹¬äº†ä¸€ä¸ªå†…åµŒ LiveReload æœåŠ¡å™¨ï¼Œå®ƒå¯åœ¨èµ„æºå‘ç”Ÿæ›´æ”¹æ—¶è§¦å‘æµè§ˆå™¨åˆ·æ–°ã€‚æ‚¨å¯ä»¥ä» <a href="http://livereload.com/extensions/">livereload.com</a> ä¸Šå…è´¹è·å– Chromeã€Firefox å’Œ Safari å¹³å°ä¸‹å¯¹åº”çš„ LiveReload æµè§ˆå™¨æ‰©å±•ç¨‹åºã€‚</p><p>å¦‚æœæ‚¨ä¸æƒ³åœ¨åº”ç”¨è¿è¡Œæ—¶å¯åŠ¨ LiveReload æœåŠ¡å™¨ï¼Œå¯ä»¥å°† <code>spring.devtools.livereload.enabled</code> å±æ€§è®¾ç½®ä¸º <code>false</code>ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>æ‚¨ä¸€æ¬¡åªèƒ½è¿è¡Œä¸€ä¸ª LiveReload æœåŠ¡å™¨ã€‚åœ¨å¯åŠ¨åº”ç”¨ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ²¡æœ‰å…¶ä»– LiveReload æœåŠ¡å™¨æ­£åœ¨è¿è¡Œã€‚å¦‚æœåœ¨ IDE ä¸­å¯åŠ¨äº†å¤šä¸ªåº”ç”¨ï¼Œé‚£ä¹ˆåªæœ‰ç¬¬ä¸€ä¸ªåº”ç”¨çš„ LiveReload ç”Ÿæ•ˆã€‚</p></blockquote><p><a id="using-boot-devtools-globalsettings"></a></p><h3 id="20-4ã€å…¨å±€è®¾ç½®">20.4ã€å…¨å±€è®¾ç½®</h3><p>æ‚¨å¯ä»¥é€šè¿‡åœ¨ <code>$HOME</code> ç›®å½•ä¸­æ·»åŠ åä¸º <code>.spring-boot-devtools.properties</code> çš„æ–‡ä»¶æ¥é…ç½®å…¨å±€ devtools è®¾ç½®ï¼ˆè¯·æ³¨æ„ï¼Œæ–‡ä»¶åä»¥â€œ.â€å¼€å¤´ï¼‰ã€‚åœ¨æ­¤æ–‡ä»¶ä¸­æ·»åŠ çš„ä»»ä½•å±æ€§å°†åº”ç”¨åˆ°æ‚¨çš„è®¡ç®—æœºä¸Š<strong>æ‰€æœ‰</strong>ä½¿ç”¨äº† devtools çš„ Spring Boot åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œå§‹ç»ˆä½¿ç”¨<a href="#using-boot-devtools-restart-triggerfile">è§¦å‘æ–‡ä»¶</a>æ¥é…ç½®é‡å¯åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><p><strong>~/.spring-boot-devtools.properties.</strong></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.devtools.reload.trigger-file</span>=.reloadtrigger</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>åœ¨ <code>.spring-boot-devtools.properties</code> ä¸­æ¿€æ´»çš„ profile å°†ä¸ä¼šå½±å“æŒ‡å®š profile çš„é…ç½®æ–‡ä»¶çš„åŠ è½½ã€‚</p></blockquote><p><a id="using-boot-devtools-remote"></a></p><h3 id="20-5ã€è¿œç¨‹åº”ç”¨">20.5ã€è¿œç¨‹åº”ç”¨</h3><p>Spring Boot å¼€å‘è€…å·¥å…·ä¸å±€é™äºæœ¬åœ°å¼€å‘ã€‚åœ¨è¿œç¨‹è¿è¡Œåº”ç”¨æ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨è®¸å¤šåŠŸèƒ½ã€‚è¿œç¨‹æ”¯æŒåŠŸèƒ½æ˜¯å¯é€‰çš„ï¼Œå¦‚æœè¦å¯ç”¨ï¼Œæ‚¨éœ€è¦ç¡®ä¿åœ¨é‡æ–°æ‰“åŒ…å½’æ¡£æ–‡ä»¶æ—¶åŒ…å« <code>devtools</code>ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">excludeDevtools</span>&gt;</span>false<span class="tag">&lt;/<span class="name">excludeDevtools</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¹‹åæ‚¨éœ€è¦è®¾ç½®ä¸€ä¸ª <code>spring.devtools.remote.secret</code> å±æ€§ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.devtools.remote.secret</span>=mysecret</span><br></pre></td></tr></table></figure><p><strong>è­¦å‘Š</strong></p><blockquote><p>åœ¨è¿œç¨‹åº”ç”¨ä¸Šå¯ç”¨ <code>spring-boot-devtools</code> æ˜¯å­˜åœ¨å®‰å…¨éšæ‚£çš„ã€‚æ‚¨ä¸åº”è¯¥åœ¨ç”Ÿäº§éƒ¨ç½²æ—¶å¯ç”¨å®ƒã€‚</p></blockquote><p>è¿œç¨‹ devtools æ”¯æŒåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šæ¥å—è¯·æ±‚è¿æ¥çš„æœåŠ¡å™¨ç«¯ç«¯ç‚¹å’Œåœ¨ IDE ä¸­è¿è¡Œçš„å®¢æˆ·ç«¯åº”ç”¨ã€‚å½“è®¾ç½®äº† <code>spring.devtools.remote.secret</code> å±æ€§æ—¶ï¼ŒæœåŠ¡å™¨ç»„ä»¶å°†è‡ªåŠ¨å¯ç”¨ã€‚å®¢æˆ·ç«¯ç»„ä»¶å¿…é¡»æ‰‹å¯ç”¨ã€‚</p><p><a id="_running_the_remote_client_application"></a></p><h4 id="20-5-1ã€è¿è¡Œè¿œç¨‹å®¢æˆ·ç«¯åº”ç”¨">20.5.1ã€è¿è¡Œè¿œç¨‹å®¢æˆ·ç«¯åº”ç”¨</h4><p>å‡è®¾è¿œç¨‹å®¢æˆ·ç«¯åº”ç”¨è¿è¡Œåœ¨ IDE ä¸­ã€‚æ‚¨éœ€è¦åœ¨ä¸è¦è¿æ¥çš„è¿œç¨‹é¡¹ç›®ç›¸åŒçš„ classpath ä¸‹è¿è¡Œ <code>org.springframework.boot.devtools.RemoteSpringApplication</code>ã€‚æŠŠè¦è¿æ¥çš„è¿œç¨‹ URL ä½œä¸ºå¿…é¡»å‚æ•°ä¼ å…¥ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Eclipse æˆ– STSï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªåä¸º <code>my-app</code> çš„é¡¹ç›®å·²éƒ¨ç½²åˆ°äº† Cloud Foundryï¼Œåˆ™å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ul><li>åœ¨ <code>Run</code> èœå•ä¸­é€‰æ‹©é€‰æ‹© <code>Run Configurations...</code>â€‹ã€‚</li><li>åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Java Application</code> launch configurationã€‚</li><li>æµè§ˆ <code>my-app</code> é¡¹ç›®ã€‚</li><li>ä½¿ç”¨ <code>org.springframework.boot.devtools.RemoteSpringApplication</code> ä½œä¸ºä¸»ç±»ã€‚</li><li>å°† <code>https://myapp.cfapps.io</code> ä½œä¸º <code>ç¨‹åºå‚æ•°</code> ï¼ˆæˆ–è€…ä»»ä½•è¿œç¨‹ URLï¼‰ä¼ å…¥ã€‚</li></ul><p>è¿è¡Œçš„è¿œç¨‹å®¢æˆ·ç«¯å°†å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  .   ____          _                                              __ _ _</span><br><span class="line"> /\\ / ___&#x27;_ __ _ _(_)_ __  __ _          ___               _      \ \ \ \</span><br><span class="line">( ( )\___ |<span class="string"> &#x27;_ </span>|<span class="string"> &#x27;_</span>|<span class="string"> </span>|<span class="string"> &#x27;_ \/ _` </span>|<span class="string">        </span>|<span class="string"> _ \___ _ __  ___</span>|<span class="string"> </span>|<span class="string">_ ___ \ \ \ \</span></span><br><span class="line"><span class="string"> \\/  ___)</span>|<span class="string"> </span>|<span class="string">_)</span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>||<span class="string"> (_</span>|<span class="string"> []::::::[]   / -_) &#x27;  \/ _ \  _/ -_) ) ) ) )</span></span><br><span class="line"><span class="string">  &#x27;  </span>|<span class="string">____</span>|<span class="string"> .__</span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string">_</span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string">_\__, </span>|<span class="string">        </span>|<span class="string">_</span>|<span class="string">_\___</span>|<span class="string">_</span>|<span class="string">_</span>|<span class="string">_\___/\__\___</span>|<span class="string">/ / / /</span></span><br><span class="line"><span class="string"> =========</span>|<span class="string">_</span>|<span class="string">==============</span>|<span class="string">___/===================================/_/_/_/</span></span><br><span class="line"><span class="string"> :: Spring Boot Remote :: 2.1.1.RELEASE</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2015-06-10 18:25:06.632  INFO 14938 --- [           main] o.s.b.devtools.RemoteSpringApplication   : Starting RemoteSpringApplication on pwmbp with PID 14938 (/Users/pwebb/projects/spring-boot/code/spring-boot-devtools/target/classes started by pwebb in /Users/pwebb/projects/spring-boot/code/spring-boot-samples/spring-boot-sample-devtools)</span></span><br><span class="line"><span class="string">2015-06-10 18:25:06.671  INFO 14938 --- [           main] s.c.a.AnnotationConfigApplicationContext : Refreshing org.springframework.context.annotation.AnnotationConfigApplicationContext@2a17b7b6: startup date [Wed Jun 10 18:25:06 PDT 2015]; root of context hierarchy</span></span><br><span class="line"><span class="string">2015-06-10 18:25:07.043  WARN 14938 --- [           main] o.s.b.d.r.c.RemoteClientConfiguration    : The connection to http://localhost:8080 is insecure. You should use a URL starting with &#x27;https://&#x27;.</span></span><br><span class="line"><span class="string">2015-06-10 18:25:07.074  INFO 14938 --- [           main] o.s.b.d.a.OptionalLiveReloadServer       : LiveReload server is running on port 35729</span></span><br><span class="line"><span class="string">2015-06-10 18:25:07.130  INFO 14938 --- [           main] o.s.b.devtools.RemoteSpringApplication   : Started RemoteSpringApplication in 0.74 seconds (JVM running for 1.105)</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>ç”±äºè¿œç¨‹å®¢æˆ·ç«¯ä¸å®é™…åº”ç”¨ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ª classpathï¼Œå› æ­¤å¯ä»¥ç›´æ¥è¯»å–åº”ç”¨çš„ propertiesã€‚è¿™ä¹Ÿæ˜¯ <code>spring.devtools.remote.secret</code> å±æ€§ä¸ºä»€ä¹ˆèƒ½è¢«è¯»å–å’Œä¼ é€’ç»™æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯çš„åŸå› ã€‚</p></blockquote><p><strong>æç¤º</strong></p><blockquote><p>å»ºè®®ä½¿ç”¨ <code>https://</code> ä½œä¸ºè¿æ¥åè®®ï¼Œä»¥ä¾¿åŠ å¯†ä¼ è¾“å¹¶é˜²æ­¢å¯†ç è¢«æ‹¦æˆªã€‚</p></blockquote><p><strong>æç¤º</strong></p><blockquote><p>å¦‚æœæ‚¨éœ€è¦é€šè¿‡ä»£ç†æ¥è®¿é—®è¿œç¨‹åº”ç”¨ï¼Œè¯·é…ç½® <code>spring.devtools.remote.proxy.host</code> å’Œ <code>spring.devtools.remote.proxy.port</code> å±æ€§ã€‚</p></blockquote><p><a id="using-boot-devtools-remote-update"></a></p><h4 id="20-5-2ã€è¿œç¨‹æ›´æ–°">20.5.2ã€è¿œç¨‹æ›´æ–°</h4><p>è¿œç¨‹å®¢æˆ·ç«¯ä½¿ç”¨äº†ä¸<a href="#using-boot-devtools-restart">æœ¬åœ°é‡å¯</a>ç›¸åŒçš„æ–¹å¼æ¥ç›‘æ§åº”ç”¨ classpath ä¸‹å‘ç”Ÿçš„æ›´æ”¹ã€‚ä»»ä½•æ›´æ–°çš„èµ„æºå°†è¢«æ¨é€åˆ°è¿œç¨‹åº”ç”¨å’Œè§¦å‘é‡å¯ï¼ˆ<strong>å¦‚æœè¦æ±‚</strong>ï¼‰ã€‚å¦‚æœæ‚¨æ­£åœ¨è¿­ä»£ä¸€ä¸ªä½¿ç”¨äº†æœ¬åœ°æ²¡æœ‰çš„äº‘æœåŠ¡çš„åŠŸèƒ½ï¼Œè¿™å¯èƒ½ä¼šéå¸¸æœ‰ç”¨ã€‚é€šå¸¸è¿œç¨‹æ›´æ–°å’Œé‡å¯æ¯”å®Œå…¨é‡æ–°æ„å»ºå’Œéƒ¨ç½²çš„å‘¨æœŸè¦å¿«å¾—å¤šã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>æ–‡ä»¶åªæœ‰åœ¨è¿œç¨‹å®¢æˆ·ç«¯è¿è¡Œæ—¶æ‰è¢«ç›‘æ§ã€‚å¦‚æœæ‚¨åœ¨å¯åŠ¨è¿œç¨‹å®¢æˆ·ç«¯ä¹‹å‰æ›´æ”¹äº†æ–‡ä»¶ï¼Œæ–‡ä»¶å°†ä¸ä¼šè¢«æ¨é€åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚</p></blockquote><p><a id="using-boot-packaging-for-production"></a></p><h2 id="21ã€æ‰“åŒ…ç”Ÿäº§åº”ç”¨">21ã€æ‰“åŒ…ç”Ÿäº§åº”ç”¨</h2><p>å¯æ‰§è¡Œ jar å¯ç”¨äºç”Ÿäº§éƒ¨ç½²ï¼Œå®ƒä»¬æ˜¯ç‹¬ç«‹ï¼ˆself-containedï¼Œç‹¬ç«‹ã€è‡ªåŒ…å«ï¼‰çš„ï¼ŒåŒæ ·ä¹Ÿé€‚åˆäº‘éƒ¨ç½²ã€‚</p><p>é’ˆå¯¹å…¶ä»–<strong>ç”Ÿäº§å°±ç»ª</strong>åŠŸèƒ½ï¼Œæ¯”å¦‚å¥åº·ã€å®¡è®¡å’Œ REST æˆ–è€… JMX ç«¯ç‚¹åº¦é‡ï¼Œå¯ä»¥æ·»åŠ  <code>spring-boot-actuator</code>ã€‚æœ‰å…³è¿™æ–¹é¢çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ <a href="#production-ready">ç¬¬äº”éƒ¨åˆ†ï¼šâ€œSpring Boot Actuatorï¼šç”Ÿäº§å°±ç»ªåŠŸèƒ½â€</a>ã€‚</p><p><a id="using-boot-whats-next"></a></p><h2 id="22ã€ä¸‹ä¸€æ­¥">22ã€ä¸‹ä¸€æ­¥</h2><p>æ‚¨ç°åœ¨åº”è¯¥çŸ¥é“å¦‚ä½•ä½¿ç”¨ Spring Boot ä»¥åŠåº”è¯¥éµå¾ªå“ªäº›æœ€ä½³å®è·µã€‚æ¥ä¸‹æ¥æ‚¨å¯ä»¥æ·±å…¥åœ°äº†è§£ <a href="#boot-features">Spring Boot åŠŸèƒ½</a>ï¼Œæˆ–è€…æ‚¨ä¹Ÿå¯ä»¥è·³è¿‡ä¸‹ä¸€éƒ¨åˆ†ç›´æ¥é˜…è¯»<a href="h#production-ready">â€œç”Ÿäº§å°±ç»ªåŠŸèƒ½â€</a>æ–¹é¢çš„å†…å®¹ã€‚</p>]]></content>
    
    
    <summary type="html">Spring Bootçš„ç®€å•ä½¿ç”¨å’Œæ¡ˆä¾‹ï¼Œä»¥åŠç›¸å…³ä¾èµ–çš„å®‰è£…ä»¥åŠç³»ç»Ÿæ„å»º</summary>
    
    
    
    <category term="Spring Boot" scheme="https://luoxiaohei520.github.io/categories/Spring-Boot/"/>
    
    
    <category term="Spring Boot" scheme="https://luoxiaohei520.github.io/tags/Spring-Boot/"/>
    
  </entry>
  
  <entry>
    <title>02Spring Bootçš„ç›¸å…³å…¥é—¨</title>
    <link href="https://luoxiaohei520.github.io/posts/6995c9a0.html"/>
    <id>https://luoxiaohei520.github.io/posts/6995c9a0.html</id>
    <published>2023-11-09T02:50:23.330Z</published>
    <updated>2023-11-09T02:50:23.331Z</updated>
    
    <content type="html"><![CDATA[<p><a id="getting-started"></a></p><h1>äºŒã€å…¥é—¨</h1><p>å¦‚æœæ‚¨æ˜¯åˆšå¼€å§‹ä½¿ç”¨ Spring Bootï¼Œæˆ–è€…å¯¹ Spring æœ‰ç‚¹å°è±¡ï¼Œé‚£ä¹ˆè¿™éƒ¨åˆ†å†…å®¹æ˜¯ä¸ºæ‚¨å‡†å¤‡çš„ï¼åœ¨è¿™é‡Œæˆ‘ä»¬å°†ç»™å‡ºåŸºæœ¬çš„â€œæ˜¯ä»€ä¹ˆï¼Ÿâ€ã€â€œæ€ä¹ˆåšï¼Ÿâ€ã€â€œä¸ºä»€ä¹ˆï¼Ÿâ€è¿™ç±»é—®é¢˜çš„ç­”æ¡ˆã€‚è¿™æ˜¯ä¸€ä»½å‹å¥½çš„ Spring Boot ç®€ä»‹å’Œå®‰è£…è¯´æ˜ã€‚å½“æˆ‘ä»¬åœ¨è®¨è®ºä¸€äº›æ ¸å¿ƒåŸç†ä¹‹åï¼Œæˆ‘ä»¬å°†æ„å»ºç¬¬ä¸€ä¸ª Spring Boot åº”ç”¨ã€‚</p><p><a id="getting-started-introducing-spring-boot"></a></p><h2 id="8ã€Spring-Boot-ç®€ä»‹">8ã€Spring Boot ç®€ä»‹</h2><p>ä½¿ç”¨ Spring Boot å¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ›å»ºå‡ºèƒ½ç›´æ¥è¿è¡Œçš„ç‹¬ç«‹çš„ã€ç”Ÿäº§çº§åˆ«çš„åŸºäº Spring çš„åº”ç”¨ã€‚æˆ‘ä»¬å¯¹ Spring å¹³å°å’Œç¬¬ä¸‰æ–¹ç±»åº“æœ‰è‡ªå·±çš„è€ƒè™‘ï¼Œå› æ­¤æ‚¨å¯ä»¥ä»æœ€åŸºæœ¬çš„å¼€å§‹ã€‚å¤§å¤šæ•° Spring Boot åº”ç”¨åªéœ€è¦å¾ˆå°‘çš„ Spring é…ç½®ã€‚</p><p>æ‚¨å¯ä»¥ä½¿ç”¨ Spring Boot æ¥åˆ›å»ºä¸€ä¸ªå¯ä»¥ä½¿ç”¨ <code>java -jar</code> å‘½ä»¤æ¥è¿è¡Œæˆ–è€…åŸºäºä¼ ç»Ÿçš„ war åŒ…éƒ¨ç½²çš„åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬è¿˜æä¾›äº†ä¸€ä¸ªç”¨äºè¿è¡Œ spring scripts çš„å‘½ä»¤è¡Œå·¥å…·ã€‚</p><p>æˆ‘ä»¬çš„ä¸»è¦ç›®æ ‡æ˜¯ï¼š</p><ul><li>ä¸ºæ‰€æœ‰ Spring Boot å¼€å‘æä¾›ä¸€ä¸ªæ›´å¿«ã€æ›´å…¨é¢çš„å…¥é—¨ä½“éªŒã€‚</li><li>åšæŒè‡ªæˆ‘è™½å¥½ï¼Œä½†å½“éœ€æ±‚å‡ºç°åç¦»ï¼Œæ‚¨éœ€è¦èƒ½è¿…é€Ÿæ‘†è„±å‡ºæ¥ã€‚</li><li>æä¾›å¤§é‡éåŠŸèƒ½æ€§ç‰¹æ€§ç›¸å…³é¡¹ç›®ï¼ˆä¾‹å¦‚ï¼šå†…åµŒæœåŠ¡å™¨ã€å®‰å…¨ã€æŒ‡æ ‡ã€å¥åº·æ£€æŸ¥ã€å¤–éƒ¨é…ç½®)ã€‚</li><li>ç»å¯¹æ²¡æœ‰ä»£ç ç”Ÿæˆï¼Œä¹Ÿä¸è¦æ±‚ XML é…ç½®ã€‚</li></ul><p><a id="getting-started-system-requirements"></a></p><h2 id="9ã€ç³»ç»Ÿè¦æ±‚">9ã€ç³»ç»Ÿè¦æ±‚</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Boot 1.5.4.RELEASE éœ€è¦ <a href="https://www.java.com/">Java 7</a> å’Œ Spring Framework 4.3.9.RELEASE æˆ–è€…æ›´é«˜ç‰ˆæœ¬ã€‚æ‚¨å¯ä»¥é€šè¿‡å…¶ä»–é…ç½®ä½¿ Java 6 é…åˆ Spring Bootã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§<a href="howto.md#howto-use-java-6">ç¬¬ 84.11èŠ‚ï¼Œâ€œå¦‚ä½•ä½¿ç”¨ Java 6â€</a>ã€‚Spring Boot ä¸º Mavenï¼ˆ3.2+ï¼‰ï¼Œå’Œ Gradle 2ï¼ˆ2.9 æˆ–è€…æ›´é«˜ç‰ˆæœ¬ï¼‰å’Œ Gradle 3 æä¾›äº†æ˜¾å¼æ„å»ºæ”¯æŒã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>è™½ç„¶æ‚¨å¯ä»¥åœ¨ Java 6 æˆ–è€… Java 7 ä¸Šä½¿ç”¨ Spring Bootï¼Œä½†æˆ‘ä»¬è¿˜æ˜¯å¼ºçƒˆæ¨èæ‚¨ä½¿ç”¨ Java 8ã€‚</p></blockquote><p><a id="_servlet_containers"></a></p><h3 id="9-1ã€Servlet-å®¹å™¨">9.1ã€Servlet å®¹å™¨</h3><p>æ”¯æŒä»¥ä¸‹åµŒå…¥å¼å®¹å™¨å¼€ç®±å³ç”¨ï¼š</p><table><thead><tr><th style="text-align:left">åç§°</th><th style="text-align:left">Servlet ç‰ˆæœ¬</th><th style="text-align:left">Java ç‰ˆæœ¬</th></tr></thead><tbody><tr><td style="text-align:left">Tomcat 8</td><td style="text-align:left">3.1</td><td style="text-align:left">Java 7+</td></tr><tr><td style="text-align:left">Tomcat 7</td><td style="text-align:left">3.0</td><td style="text-align:left">Java 6+</td></tr><tr><td style="text-align:left">Jetty 9.3</td><td style="text-align:left">3.1</td><td style="text-align:left">Java 8+</td></tr><tr><td style="text-align:left">Jetty 9.2</td><td style="text-align:left">3.1</td><td style="text-align:left">Java 7+</td></tr><tr><td style="text-align:left">Jetty 8</td><td style="text-align:left">3.0</td><td style="text-align:left">Java 6+</td></tr><tr><td style="text-align:left">Undertow 1.3</td><td style="text-align:left">3.1</td><td style="text-align:left">Java 7+</td></tr></tbody></table><p>æ‚¨å¯ä»¥å°† Spring Boot åº”ç”¨éƒ¨ç½²åˆ°ä»»ä½•ä¸€ä¸ª Servlet 3.0+ å…¼å®¹å®¹å™¨ä¸­ã€‚</p><p><a id="getting-started-installing-spring-boot"></a></p><h2 id="10ã€å®‰è£…-Spring-Boot">10ã€å®‰è£… Spring Boot</h2><p>Spring Boot å¯ä»¥ä¸<strong>ç»å…¸</strong>çš„ Java å¼€å‘å·¥å…·ä¸€èµ·ä½¿ç”¨æˆ–è€…ä½œä¸ºå‘½ä»¤è¡Œå·¥å…·å®‰è£…ã€‚æ— è®ºå¦‚ä½•ï¼Œæ‚¨å°†éœ€è¦ <a href="https://www.java.com/">Java SDK 1.6</a> æˆ–è€…æ›´é«˜ç‰ˆæœ¬ã€‚åœ¨å¼€å§‹ä¹‹å‰æ‚¨åº”è¯¥æ£€æŸ¥ Java çš„å®‰è£…æƒ…å†µï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -version</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨æ˜¯ Java å¼€å‘æ–°æ‰‹ï¼Œæˆ–è€…æ‚¨åªæƒ³å°è¯•ä½¿ç”¨ Spring Bootï¼Œæ‚¨å¯èƒ½éœ€è¦é¦–å…ˆå°è¯•ä½¿ç”¨ <a href="#getting-started-installing-the-cli">Spring Boot CLI</a>ï¼Œå¦åˆ™è¯·é˜…è¯»ç»å…¸çš„å®‰è£…è¯´æ˜ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>è™½ç„¶ Spring Boot æ”¯æŒ Java 1.6ï¼Œä½†æ˜¯å¦‚æœå¯ä»¥ï¼Œæ‚¨åº”è¯¥è€ƒè™‘ä½¿ç”¨æœ€æ–°çš„ Java ç‰ˆæœ¬ã€‚</p></blockquote><p><a id="getting-started-installation-instructions-for-java"></a></p><h3 id="10-1ã€é’ˆå¯¹-Java-å¼€å‘äººå‘˜çš„å®‰è£…è¯´æ˜">10.1ã€é’ˆå¯¹ Java å¼€å‘äººå‘˜çš„å®‰è£…è¯´æ˜</h3><p>æ‚¨å¯ä»¥è·Ÿä½¿ç”¨ä»»ä½•æ ‡å‡† Java åº“çš„æ–¹å¼ä¸€æ ·ä½¿ç”¨ Spring Bootã€‚åªéœ€è¦åœ¨ classpath ä¸‹åŒ…å«ç›¸åº”çš„ <code>spring-boot-*.jar</code> æ–‡ä»¶å³å¯ã€‚Spring Boot ä¸éœ€è¦ä»»ä½•ä¸“ç”¨çš„å·¥å…·æ¥é›†æˆï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½• IDE æˆ–è€…æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå¹¶ä¸” Spring Boot åº”ç”¨ä¹Ÿæ²¡ä»€ä¹ˆç‰¹æ®Šä¹‹å¤„ï¼Œå› æ­¤å¯ä»¥åƒä»»ä½•å…¶å®ƒ Java ç¨‹åºä¸€æ ·è¿è¡Œå’Œè°ƒè¯•ã€‚</p><p>è™½ç„¶æ‚¨å¯ä»¥å¤åˆ¶ Spring Boot çš„ jar æ–‡ä»¶ï¼Œä½†æˆ‘ä»¬é€šå¸¸å»ºè®®æ‚¨ä½¿ç”¨æ”¯æŒä¾èµ–ç®¡ç†çš„æ„å»ºå·¥å…·ï¼ˆæ¯”å¦‚ Maven æˆ–è€… Gradleï¼‰ã€‚</p><p><a id="getting-started-maven-installation"></a></p><h3 id="10-1-1ã€ä½¿ç”¨-Maven-å®‰è£…">10.1.1ã€ä½¿ç”¨ Maven å®‰è£…</h3><p>Spring Boot å…¼å®¹ Apache Maven 3.2 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰å®‰è£… Mavenï¼Œå¯ä»¥åˆ° <a href="https://maven.apache.org/">maven.apache.org</a> ä¸ŠæŒ‰ç…§è¯´æ˜è¿›è¡Œæ“ä½œã€‚</p><p><strong>æç¤º</strong></p><blockquote><p>åœ¨è®¸å¤šæ“ä½œç³»ç»Ÿä¸Šï¼Œå¯ä»¥é€šè¿‡è½¯ä»¶åŒ…ç®¡ç†å™¨æ¥å®‰è£… Mavenã€‚å¦‚æœæ‚¨æ˜¯ OSX Homebrew ç”¨æˆ·ï¼Œè¯·å°è¯•ä½¿ç”¨ <code>brew install maven</code>ã€‚Ubuntu ç”¨æˆ·å¯ä»¥è¿è¡Œ <code>sudo apt-get install maven</code>ã€‚</p></blockquote><p>Spring Boot ä¾èµ–ä½¿ç”¨åˆ°äº† <code>org.springframework.boot</code> <code>groupId</code>ã€‚é€šå¸¸ï¼Œæ‚¨çš„ Maven POM æ–‡ä»¶å°†ä» <code>spring-boot-starter-parent</code> é¡¹ç›®ç»§æ‰¿ï¼Œå¹¶å£°æ˜ä¸€ä¸ªæˆ–å¤šä¸ª <a href="using-boot-starter.md">Starter</a> ä¾èµ–ã€‚Spring Boot è¿˜æä¾›äº†ä¸€ä¸ªå¯é€‰çš„ <a href="#build-tool-plugins-maven-plugin">Maven æ’ä»¶</a>æ¥åˆ›å»ºå¯æ‰§è¡Œ jarã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ <code>pom.xml</code> æ–‡ä»¶ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>myproject<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Inherit defaults from Spring Boot --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Add typical dependencies for a web application --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Package as an executable jar --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p><code>spring-boot-starter-parent</code> æ˜¯ä¸€ä¸ªä½¿ç”¨ Spring Boot çš„å¥½æ–¹å¼ï¼Œä½†å®ƒå¹¶ä¸æ˜¯ä»»ä½•æ—¶å€™éƒ½é€‚ç”¨ã€‚æœ‰æ—¶æ‚¨å¯èƒ½éœ€è¦ç»§æ‰¿ä¸åŒçš„çˆ¶ POMï¼Œæˆ–è€…æ‚¨ä¸å–œæ¬¢æˆ‘ä»¬çš„é»˜è®¤é…ç½®ã€‚è¯·å‚è§<a href="#using-boot-maven-without-a-parent">ç¬¬ 13.2.2 èŠ‚, â€œä½¿ç”¨ä¸å¸¦çˆ¶ POM çš„ Spring Bootâ€</a> ä½œä¸ºçš„æ›¿ä»£æ–¹æ¡ˆï¼Œå…¶ä½¿ç”¨äº† <code>import</code> Scopeã€‚</p></blockquote><p><a id="getting-started-gradle-installation"></a></p><h3 id="10-1-2ã€ä½¿ç”¨-Gradle-å®‰è£…">10.1.2ã€ä½¿ç”¨ Gradle å®‰è£…</h3><p>Spring Boot å…¼å®¹ Gradle 2 (2.9 æˆ–è€…æ›´é«˜ç‰ˆæœ¬)å’Œ Gradle 3ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰å®‰è£… Gradleï¼Œæ‚¨å¯ä»¥æŒ‰ç…§ <a href="http://www.gradle.org/">www.gradle.org/</a> ä¸Šçš„è¯´æ˜è¿›è¡Œæ“ä½œã€‚</p><p>Spring Boot ä¾èµ– <code>org.springframework.boot</code> <code>group</code>ã€‚é€šå¸¸ï¼Œæ‚¨çš„é¡¹ç›®å°†å£°æ˜ä¸€ä¸ªæˆ–è€…å¤šä¸ª <a href="using-boot-starter.md">Starter</a> çš„ä¾èµ–ã€‚Spring Boot æä¾›äº†ä¸€ä¸ªæœ‰ç”¨çš„ <a href="#build-tool-plugins-gradle-plugin">Gradle æ’ä»¶</a>ï¼Œå¯ç”¨äºç®€åŒ–ä¾èµ–å£°æ˜å’Œåˆ›å»ºå¯æ‰§è¡Œ jar æ–‡ä»¶ã€‚</p><p><strong>Gradle Wrapper</strong></p><blockquote><p>å½“æ‚¨è®¸éœ€è¦æ„å»ºé¡¹ç›®æ—¶ï¼ŒGradle Wrapper æä¾›äº†ä¸€ä¸ªç”¨äºè·å– Gradle çš„å¥½æ–¹æ³•ã€‚å®ƒæ˜¯ç”±å°è„šæœ¬å’Œåº“ç»„æˆï¼Œæ‚¨åœ¨æäº¤çš„åŒæ—¶ï¼Œæ‚¨çš„ä»£ç å°†å¼•å¯¼æ„å»ºæµç¨‹ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://docs.gradle.org/2.14.1/userguide/gradle_wrapper.html">docs.gradle.org/2.14.1/userguide/gradle_wrapper.html</a>ã€‚</p></blockquote><p>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ <code>build.gradle</code> æ–‡ä»¶ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id <span class="string">&#x27;org.springframework.boot&#x27;</span> version <span class="string">&#x27;1.5.4.RELEASE&#x27;</span></span><br><span class="line">    id <span class="string">&#x27;java&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">jar &#123;</span><br><span class="line">    baseName = <span class="string">&#x27;myproject&#x27;</span></span><br><span class="line">    version =  <span class="string">&#x27;0.0.1-SNAPSHOT&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">repositories &#123;</span><br><span class="line">    jcenter()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile(<span class="string">&quot;org.springframework.boot:spring-boot-starter-web&quot;</span>)</span><br><span class="line">    testCompile(<span class="string">&quot;org.springframework.boot:spring-boot-starter-test&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a id="getting-started-installing-the-cli"></a></p><h3 id="10-2ã€å®‰è£…-Spring-Boot-CLI">10.2ã€å®‰è£… Spring Boot CLI</h3><p>Spring Boot CLI æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå¦‚æœæ‚¨æƒ³ä½¿ç”¨ Spring å¿«é€Ÿæ­å»ºåŸå‹ï¼Œå¯ä»¥é€‰æ‹©å®ƒã€‚å®ƒå…è®¸æ‚¨è¿è¡Œ <a href="http://groovy.codehaus.org/">Groovy</a> è„šæœ¬ï¼Œè¿™æ„å‘³ç€æ‚¨æœ‰å¯ä»¥æœ‰ç±» Java è¯­æ³•ä¸”æ²¡æœ‰å¤ªå¤šæ ·æ¿çš„ä»£ç ã€‚</p><p>æ‚¨ä¸éœ€è¦ä½¿ç”¨ CLI æ¥é…åˆ Spring Bootï¼Œä½†å®ƒç¡®å®æ˜¯ä¸€ä¸ªå…¥é—¨ Spring åº”ç”¨çš„æœ€å¿«æ–¹å¼ã€‚</p><p><a id="getting-started-manual-cli-installation"></a></p><h4 id="10-2-1ã€æ‰‹åŠ¨å®‰è£…">10.2.1ã€æ‰‹åŠ¨å®‰è£…</h4><p>æ‚¨å¯ä»¥ä» Spring è½¯ä»¶ä»“åº“ä¸­ä¸‹è½½ Spring CLI å‘è¡Œç‰ˆï¼š</p><ul><li><a href="https://repo.spring.io/release/org/springframework/boot/spring-boot-cli/1.5.9.RELEASE/spring-boot-cli-1.5.9.RELEASE-bin.zip">spring-boot-cli-1.5.9.RELEASE-bin.zip</a></li><li><a href="https://repo.spring.io/release/org/springframework/boot/spring-boot-cli/1.5.9.RELEASE/spring-boot-cli-1.5.9.RELEASE-bin.tar.gz">spring-boot-cli-1.5.9.RELEASE-bin.tar.gz</a></li></ul><p><a href="https://repo.spring.io/snapshot/org/springframework/boot/spring-boot-cli/">æœ€æ–°çš„å¿«ç…§å‘è¡Œç‰ˆ</a>ä¹Ÿæ˜¯å¯ç”¨çš„ã€‚</p><p>ä¸‹è½½ä¹‹åï¼Œè¯·æŒ‰ç…§è§£å‹ç¼©å½’æ¡£æ–‡ä»¶ä¸­çš„ <a href="https://raw.github.com/spring-projects/spring-boot/v1.5.9.RELEASE/spring-boot-cli/src/main/content/INSTALL.txt">INSTALL.txt</a> è¯´æ˜è¿›è¡Œæ“ä½œã€‚æ€»ä¹‹ï¼šåœ¨ <code>.zip</code> æ–‡ä»¶çš„ <code>bin/</code> ç›®å½•ä¸­æœ‰ä¸€ä¸ª spring è„šæœ¬ï¼ˆåœ¨ Windows ä¸‹ä¸º <code>spring.bat</code>ï¼‰ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>java -jar</code> é…åˆ <code>.jar</code> æ–‡ä»¶ï¼ˆè¯¥è„šæœ¬å¯ä»¥å¸®åŠ©æ‚¨ç¡®ä¿ classpath è®¾ç½®æ­£ç¡®ï¼‰ã€‚</p><p><a id="getting-started-sdkman-cli-installation"></a></p><h4 id="10-2-2ã€ä½¿ç”¨-SDKMAN-å®‰è£…">10.2.2ã€ä½¿ç”¨ SDKMAN! å®‰è£…</h4><p>SDKMAN!ï¼ˆè½¯ä»¶å¼€å‘åŒ…ç®¡ç†å™¨ï¼‰ç”¨äºç®¡ç†äºŒè¿›åˆ¶ SDK çš„å¤šä¸ªç‰ˆæœ¬ï¼ŒåŒ…æ‹¬ Groovy å’Œ Spring Boot CLIã€‚ä» <a href="http://sdkman.io/">sdkman.io</a> è·å– SDKMAN! å¹¶å®‰è£… Spring Bootï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sdk install springboot</span><br><span class="line">$ spring --version</span><br><span class="line">Spring Boot v1.5.9.RELEASE</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨æ­£åœ¨ä¸º CLI å¼€å‘åŠŸèƒ½ï¼Œå¹¶å¸Œæœ›å¤Ÿèƒ½è½»æ¾åœ°è®¿é—®åˆšåˆ›å»ºçš„ç‰ˆæœ¬ï¼Œè¯·å‚ç…§ä»¥ä¸‹æŒ‡ä»¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sdk install springboot dev /path/to/spring-boot/spring-boot-cli/target/spring-boot-cli-1.5.9.RELEASE-bin/spring-1.5.9.RELEASE/</span><br><span class="line">$ sdk default springboot dev</span><br><span class="line">$ spring --version</span><br><span class="line">Spring CLI v1.5.9.RELEASE</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæ“ä½œå°†ä¼šå®‰è£…ä¸€ä¸ªåä¸º <code>dev</code> çš„ <code>spring</code> çš„æœ¬åœ°å®ä¾‹ã€‚å®ƒæŒ‡å‘æ‚¨çš„ç›®æ ‡æ„å»ºä½ç½®ï¼Œå› æ­¤æ¯æ¬¡é‡æ–°æ„å»º Spring Boot æ—¶ï¼Œspring éƒ½æ˜¯æœ€æ–°çš„ã€‚</p><p>æ‚¨å¯ä»¥è¿™æ ·åšæ¥ç›¸å…³ä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ sdk <span class="built_in">ls</span> springboot</span><br><span class="line"></span><br><span class="line">================================================================================</span><br><span class="line">Available Springboot Versions</span><br><span class="line">================================================================================</span><br><span class="line">&gt; + dev</span><br><span class="line">* 1.5.9.RELEASE</span><br><span class="line"></span><br><span class="line">================================================================================</span><br><span class="line">+ - <span class="built_in">local</span> version</span><br><span class="line">* - installed</span><br><span class="line">&gt; - currently <span class="keyword">in</span> use</span><br><span class="line">================================================================================</span><br></pre></td></tr></table></figure><p><a id="getting-started-homebrew-cli-installation"></a></p><h4 id="10-2-3ã€ä½¿ç”¨-OSX-Homebrew-å®‰è£…">10.2.3ã€ä½¿ç”¨ OSX Homebrew å®‰è£…</h4><p>å¦‚æœæ‚¨æ˜¯åœ¨ Mac ä¸Šå·¥ä½œå¹¶ä¸”ä½¿ç”¨äº† <a href="http://brew.sh/">Homebrew</a>ï¼Œæ‚¨å®‰è£… Spring Boot CLI éœ€è¦åšçš„:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ brew tap pivotal/tap</span><br><span class="line">$ brew install springboot</span><br></pre></td></tr></table></figure><p>Homebrew å°†ä¼šæŠŠ spring å®‰è£…åœ¨ <code>/usr/local/bin</code>ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœæ‚¨æ²¡æœ‰çœ‹åˆ°æ‰§è¡Œæµç¨‹, æ‚¨å®‰è£…çš„ brew å¯èƒ½å·²ç»è¿‡æœŸäº†ã€‚æ‰§è¡Œ <code>brew update</code> å¹¶é‡æ–°å°è¯•ã€‚</p></blockquote><p><a id="getting-started-macports-cli-installation"></a></p><h4 id="10-2-4ã€ä½¿ç”¨-MacPorts-å®‰è£…">10.2.4ã€ä½¿ç”¨ MacPorts å®‰è£…</h4><p>å¦‚æœæ‚¨æ˜¯åœ¨ Mac ä¸Šå·¥ä½œå¹¶ä¸”ä½¿ç”¨äº† <a href="https://www.macports.org/">MacPorts</a>ï¼Œæ‚¨å®‰è£… Spring Boot CLI æ‰€éœ€è¦åšçš„:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo port install spring-boot-cli</span><br></pre></td></tr></table></figure><p><a id="getting-started-cli-command-line-completion"></a></p><h4 id="10-2-5ã€å‘½ä»¤è¡Œå®Œæˆ">10.2.5ã€å‘½ä»¤è¡Œå®Œæˆ</h4><p>Spring Boot CLI ä¸º <a href="https://en.wikipedia.org/wiki/Bash_%28Unix_shell%29">BASH</a> å’Œ <a href="https://en.wikipedia.org/wiki/Zsh">zsh</a> æä¾›äº†å‘½ä»¤å®Œæˆè„šæœ¬ã€‚æ‚¨å¯ä»¥åœ¨ä»»ä½• shell ä¸­æ‰§è¡Œæ­¤è„šæœ¬ (ä¹Ÿç§°ä¸º <code>spring</code>ï¼‰ï¼Œæˆ–å°†å…¶æ”¾åœ¨æ‚¨ä¸ªäººæˆ–ç³»ç»ŸèŒƒå›´çš„ bash ä¸­å®Œæˆåˆå§‹åŒ–ã€‚åœ¨ Debian ç³»ç»Ÿä¸Šï¼Œç³»ç»ŸèŒƒå›´çš„è„šæœ¬ä½äº <code>/shell-completion/bash</code> ä¸­ï¼Œå½“æ–°çš„ shell å¯åŠ¨æ—¶ï¼Œè¯¥ç›®å½•ä¸­çš„æ‰€æœ‰è„šæœ¬å°†è¢«æ‰§è¡Œã€‚è¦æ‰‹åŠ¨è¿è¡Œè„šæœ¬, ä¾‹å¦‚ï¼šæ‚¨å·²ç»ä½¿ç”¨ SDKMAN! å®‰è£…äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ . ~/.sdkman/candidates/springboot/current/shell-completion/bash/spring</span><br><span class="line">$ spring &lt;HIT TAB HERE&gt;</span><br><span class="line">  grab  <span class="built_in">help</span>  jar  run  <span class="built_in">test</span>  version</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>å¦‚æœæ‚¨ä½¿ç”¨ Homebrew æˆ–è€… MacPorts å®‰è£…äº† Spring Boot CLIï¼Œåˆ™å‘½ä»¤è¡Œå®Œæˆè„šæœ¬å°†è‡ªåŠ¨æ³¨å†Œåˆ°æ‚¨çš„ shell ä¸­ã€‚</p></blockquote><p><a id="getting-started-cli-example"></a></p><h3 id="10-2-6ã€å¿«é€Ÿå…¥é—¨-Spring-CLI-ç¤ºä¾‹">10.2.6ã€å¿«é€Ÿå…¥é—¨ Spring CLI ç¤ºä¾‹</h3><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ web åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ç”¨äºæµ‹è¯•æ‚¨çš„å®‰è£…æƒ…å†µã€‚åˆ›å»ºä¸€ä¸ªåä¸º <code>app.groovy</code> çš„æ–‡ä»¶ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThisWillActuallyRun</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">    String home() &#123;</span><br><span class="line">        <span class="string">&quot;Hello World!&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹ååœ¨ shell ä¸­è¿è¡Œå®ƒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ spring run app.groovy</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p>ç¬¬ä¸€æ¬¡è¿è¡Œåº”ç”¨çš„æ—¶å€™éœ€è¦ä¸€äº›æ—¶é—´ï¼Œå› ä¸ºéœ€è¦ä¸‹è½½ä¾èµ–ã€‚åç»­è¿è¡Œå°†ä¼šæ›´å¿«ã€‚</p></blockquote><p>åœ¨æ‚¨å–œæ¬¢çš„æµè§ˆå™¨ä¸­æ‰“å¼€ localhost:8080ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼š</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello World!</span><br></pre></td></tr></table></figure><p><a id="getting-started-upgrading-from-an-earlier-version"></a></p><h2 id="10-3ã€å‡çº§æ—§ç‰ˆ-Spring-Boot">10.3ã€å‡çº§æ—§ç‰ˆ Spring Boot</h2><p>å¦‚æœæ‚¨æƒ³ä»æ—§ç‰ˆçš„ Spring Boot å‡çº§åˆ°æ­¤ç‰ˆæœ¬ï¼Œè¯·æŸ¥çœ‹<a href="https://github.com/spring-projects/spring-boot/wiki">é¡¹ç›® wiki</a> ä¸Šæ‰˜ç®¡çš„ <strong>release notesï¼ˆå‘è¡Œè¯´æ˜ï¼‰</strong>ã€‚æ‚¨å°†ä¼šæ‰¾åˆ°å‡çº§è¯´æ˜ä»¥åŠæ¯ä¸ªç‰ˆæœ¬çš„<strong>æ–°ç‰¹æ€§å’Œæ³¨æ„äº‹é¡¹</strong>åˆ—è¡¨ã€‚</p><p>è¦å‡çº§ç°æœ‰çš„ CLIï¼Œè¯·ä½¿ç”¨ç›¸åº”çš„åŒ…ç®¡ç†å™¨å‘½ä»¤ï¼ˆä¾‹å¦‚ <code>brew upgrade</code>ï¼‰ æˆ–è€…, å¦‚æœæ‚¨æ‰‹åŠ¨å®‰è£…äº† CLIï¼Œè¯·æŒ‰ç…§<a href="#getting-started-manual-cli-installation">æ ‡å‡†è¯´æ˜</a>ï¼Œè®°å¾—æ›´æ–°æ‚¨çš„ <code>PATH</code> ç¯å¢ƒå˜é‡ä»¥åˆ é™¤ä»»ä½•æ—§çš„å¼•ç”¨ã€‚</p><p><a id="getting-started-first-application"></a></p><h2 id="11ã€å¼€å‘ç¬¬ä¸€ä¸ª-Spring-Boot-åº”ç”¨">11ã€å¼€å‘ç¬¬ä¸€ä¸ª Spring Boot åº”ç”¨</h2><p>è®©æˆ‘ä»¬ä½¿ç”¨ Java å¼€å‘ä¸€ä¸ªç®€å•çš„ <strong>Hello World!</strong> web åº”ç”¨ç¨‹åºï¼Œä»¥ä¾¿ä½“ç° Spring Boot çš„ä¸€äº›å…³é”®ç‰¹æ€§ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ Maven æ„å»ºè¯¥é¡¹ç›®ï¼Œå› ä¸ºå¤§å¤šæ•° IDE éƒ½æ”¯æŒå®ƒã€‚</p><p><strong>æç¤º</strong></p><blockquote><p><a href="https://spring.io/">spring.io</a> ç½‘ç«™ä¸Šæœ‰è®¸å¤šä½¿ç”¨ Spring Boot çš„<strong>å…¥é—¨æŒ‡å—</strong>ï¼Œå¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾å…·ä½“é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼Œå¯å…ˆä»ä¸Šé¢å¯»æ‰¾ã€‚æ‚¨å¯ä»¥åˆ° <a href="https://start.spring.io/">start.spring.io</a> ä½¿ç”¨ä¾èµ–æœç´¢åŠŸèƒ½é€‰æ‹© <code>web</code> starter æ¥å¿«é€Ÿå®Œæˆä»¥ä¸‹æ­¥éª¤ã€‚å®ƒå°†è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ–°çš„é¡¹ç›®ç»“æ„ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥<a href="#getting-started-first-application-code">ç«‹å³å¼€å§‹ç¼–ç </a>ã€‚<a href="https://github.com/spring-io/initializr">æŸ¥çœ‹æ–‡æ¡£äº†è§£æ›´å¤šä¿¡æ¯</a>ã€‚</p></blockquote><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæ‰“å¼€ç»ˆç«¯æ£€æŸ¥æ‚¨æ˜¯å¦å®‰è£…äº†ç¬¦åˆè¦æ±‚çš„ Java ç‰ˆæœ¬å’Œ Maven ç‰ˆæœ¬ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ java -version</span><br><span class="line">java version <span class="string">&quot;1.7.0_51&quot;</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.7.0_51-b13)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 24.51-b03, mixed mode)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mvn -v</span><br><span class="line">Apache Maven 3.2.3 (33f8c3e1027c3ddde99d3cdebad2656a31e8fdf4; 2014-08-11T13:58:10-07:00)</span><br><span class="line">Maven home: /Users/user/tools/apache-maven-3.1.1</span><br><span class="line">Java version: 1.7.0_51, vendor: Oracle Corporation</span><br></pre></td></tr></table></figure><p><strong>æç¤º</strong></p><blockquote><p>æ­¤ç¤ºä¾‹éœ€è¦åœ¨æ‚¨è‡ªå·±çš„æ–‡ä»¶å¤¹ä¸­åˆ›å»ºï¼Œåç»­çš„æ­¥éª¤è¯´æ˜å‡è®¾æ‚¨å·²ç»åˆ›å»ºäº†è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œå®ƒæ˜¯æ‚¨çš„<strong>å½“å‰ç›®å½•</strong>ã€‚</p></blockquote><p><a id="getting-started-first-application-pom"></a></p><h3 id="11-1-åˆ›å»º-POM">11.1 åˆ›å»º POM</h3><p>æˆ‘ä»¬å…ˆè¦åˆ›å»ºä¸€ä¸ª Maven <code>pom.xml</code> æ–‡ä»¶ã€‚<code>pom.xml</code> æ˜¯ç”¨äºæ„å»ºé¡¹ç›®çš„<strong>é…æ–¹</strong>ã€‚æ‰“å¼€æ‚¨æœ€å–œæ¬¢çš„ç¼–è¾‘å™¨å¹¶æ·»åŠ ä¸€ä¸‹å†…å®¹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>myproject<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Additional lines to be added here... --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™åº”è¯¥ä¼šç»™æ‚¨ç”Ÿæˆä¸€ä¸ªå·¥ä½œç‰ˆæœ¬ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œ <code>mvn package</code> æ¥æµ‹è¯•å®ƒï¼ˆæ­¤æ—¶æ‚¨å¯ä»¥å¿½ç•¥ <strong>jar will be empty - no content was marked for inclusion!</strong> è­¦å‘Šä¿¡æ¯)ã€‚</p><p><strong>æ³¨æ„</strong></p><blockquote><p>æ­¤æ—¶ï¼Œæ‚¨å¯ä»¥å°†é¡¹ç›®å¯¼å…¥ IDEï¼ˆå¤§éƒ¨åˆ†çš„ç°ä»£ Java IDE éƒ½å†…ç½® Maven æ”¯æŒï¼‰ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†ç»§ç»­åœ¨è¿™ä¸ªä¾‹å­ä¸­ä½¿ç”¨çº¯æ–‡æœ¬ç¼–è¾‘å™¨ã€‚</p></blockquote><p><a id="getting-started-first-application-dependencies"></a></p><h3 id="11-2ã€æ·»åŠ -Classpath-ä¾èµ–">11.2ã€æ·»åŠ  Classpath ä¾èµ–</h3><p>Spring Boot æä¾›äº†å¤šä¸ª â€œStarterâ€ï¼Œå¯ä»¥è®©æ‚¨æ–¹ä¾¿åœ°å°† jar æ·»åŠ åˆ° classpath ä¸‹ã€‚æˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨å·²ç»åœ¨ POM çš„ <code>parent</code> éƒ¨åˆ†ä½¿ç”¨äº† <code>spring-boot-starter-parent</code>ã€‚<code>spring-boot-starter-parent</code> æ˜¯ä¸€ä¸ªç‰¹æ®Š Starterï¼Œå®ƒæä¾›äº†æœ‰ç”¨çš„ Maven é»˜è®¤é…ç½®ã€‚æ­¤å¤–å®ƒè¿˜æä¾›äº†<a href="#using-boot-dependency-management">ä¾èµ–ç®¡ç†</a>åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥å¿½ç•¥è¿™äº›ä¾èµ–çš„ç‰ˆæœ¬ï¼ˆ<code>version</code>ï¼‰æ ‡ç­¾ã€‚</p><p>å…¶ä»– Starter åªæä¾›åœ¨å¼€å‘ç‰¹å®šåº”ç”¨æ—¶å¯èƒ½éœ€è¦åˆ°çš„ä¾èµ–ã€‚ç”±äºæˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ª web åº”ç”¨ï¼Œå› æ­¤æˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ª <code>spring-boot-starter-web</code> ä¾èµ–â€‰ï¼Œâ€‰ä½†åœ¨æ­¤ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ç›®å‰æ‹¥æœ‰çš„ã€‚</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mvn</span> dependency:tree</span><br><span class="line"></span><br><span class="line">[<span class="meta">INFO</span>] com.example:myproject:jar:<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>-SNAPSHOT</span><br></pre></td></tr></table></figure><p><code>mvn dependency:tree</code> å‘½ä»¤ä»¥æ ‘çš„å½¢å¼æ‰“å°é¡¹ç›®çš„ä¾èµ–ã€‚æ‚¨å¯ä»¥çœ‹åˆ° <code>spring-boot-starter-parent</code> æœ¬èº«ä¸æä¾›ä¾èµ–ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ <code>parent</code> ä¸‹æ–¹ç«‹å³ç¼–è¾‘ <code>pom.xml</code> å¹¶æ·»åŠ  <code>spring-boot-starter-web</code> ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨å†æ¬¡è¿è¡Œ <code>mvn dependency:tree</code>ï¼Œå°†ä¼šçœ‹åˆ°ç°åœ¨æœ‰è®¸å¤šé™„åŠ çš„ä¾èµ–ï¼ŒåŒ…æ‹¬äº† Tomcat web æœåŠ¡å™¨å’Œ Spring Boot æœ¬èº«ã€‚</p><p><a id="getting-started-first-application-code"></a></p><h3 id="11-3ã€ç¼–ç ">11.3ã€ç¼–ç </h3><p>è¦å®Œæˆæˆ‘ä»¬çš„åº”ç”¨ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª Java æ–‡ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒMaven å°†ä» <code>src/main/java</code> ç›®å½•ä¸‹ç¼–è¯‘æºä»£ç ï¼Œå› æ­¤æ‚¨éœ€è¦åˆ›å»ºè¯¥æ–‡ä»¶å¤¹ç»“æ„ï¼Œä¹‹åæ·»åŠ ä¸€ä¸ªåä¸º <code>src/main/java/Example.java</code> çš„æ–‡ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Example</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line">String <span class="title function_">home</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">SpringApplication.run(Example.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶æ²¡æœ‰å¤šå°‘ä»£ç ï¼Œä½†å®ƒä»ç„¶åšäº†å¾ˆå¤šäº‹æƒ…ã€‚è®©æˆ‘ä»¬çœ‹çœ‹é‡Œé¢é‡è¦çš„éƒ¨åˆ†ã€‚</p><p><a id="getting-started-first-application-annotations"></a></p><h4 id="11-3-1ã€-RestController-ä¸-RequestMapping-æ³¨è§£">11.3.1ã€@RestController ä¸ @RequestMapping æ³¨è§£</h4><p><code>Example</code> ç±»ä¸­çš„ç¬¬ä¸€ä¸ªæ³¨è§£æ˜¯ <code>@RestController</code>ï¼Œè¯¥æ³¨è§£è¢«ç§°ä½œ stereotype æ³¨è§£ã€‚å®ƒèƒ½ä¸ºä»£ç é˜…è¯»è€…æä¾›ä¸€äº›æç¤ºï¼Œå¯¹äº Spring è€Œè¨€ï¼Œè¿™ä¸ªç±»å…·æœ‰ç‰¹æ®Šä½œç”¨ã€‚åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬çš„ç±»æ˜¯ä¸€ä¸ª web <code>@Controller</code>ï¼Œå› æ­¤ Spring åœ¨å¤„ç†ä¼ å…¥çš„ web è¯·æ±‚æ—¶ä¼šè€ƒè™‘å®ƒã€‚</p><p><code>@RequestMapping</code> æ³¨è§£æä¾›äº† <strong>routing</strong>ï¼ˆè·¯ç”±ï¼‰ä¿¡æ¯ã€‚å®ƒå‘Šè¯‰ Springï¼Œä»»ä½•å…·æœ‰è·¯å¾„ä¸º <code>/</code> çš„ HTTP è¯·æ±‚éƒ½åº”æ˜ å°„åˆ° <code>home</code> æ–¹æ³•ã€‚<code>@RestController</code> æ³¨è§£å‘ŠçŸ¥ Spring æ¸²æŸ“ç»“æœå­—ç¬¦ä¸²ç›´æ¥è¿”å›ç»™è°ƒç”¨è€…ã€‚</p><p><strong>æç¤º</strong></p><blockquote><p><code>@RestController</code> å’Œ <code>@RequestMapping</code> æ˜¯ Spring MVC æ³¨è§£ï¼ˆå®ƒä»¬ä¸æ˜¯ Spring Boot ç‰¹æœ‰çš„ï¼‰ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… Spring å‚è€ƒæ–‡æ¡£ä¸­çš„ <a href="https://docs.spring.io/spring/docs/5.0.4.RELEASE/spring-framework-reference/web.html#mvc">MVC ç« èŠ‚</a></p></blockquote><p><a id="getting-started-first-application-auto-configuration"></a></p><h4 id="11-3-2ã€-EnableAutoConfiguration-æ³¨è§£">11.3.2ã€@EnableAutoConfiguration æ³¨è§£</h4><p>ç¬¬äºŒä¸ªç±»çº§åˆ«æ³¨è§£æ˜¯ <code>@EnableAutoConfiguration</code>ã€‚æ­¤æ³¨è§£å‘ŠçŸ¥ Spring Boot æ ¹æ®æ‚¨æ·»åŠ çš„ jar ä¾èµ–æ¥â€œçŒœæµ‹â€æ‚¨æƒ³å¦‚ä½•é…ç½® Spring å¹¶è¿›è¡Œè‡ªåŠ¨é…ç½®ï¼Œç”±äº <code>spring-boot-starter-web</code> æ·»åŠ äº† Tomcat å’Œ Spring MVCï¼Œauto-configurationï¼ˆè‡ªåŠ¨é…ç½®ï¼‰å°†å‡å®šæ‚¨è¦å¼€å‘ web åº”ç”¨å¹¶ç›¸åº”è®¾ç½®äº† Springã€‚</p><blockquote><p><strong>Starter ä¸è‡ªåŠ¨é…ç½®</strong> <br/> Auto-configuration è¢«è®¾è®¡ä¸ Starter é…åˆä½¿ç”¨ï¼Œä½†è¿™ä¸¤ä¸ªæ¦‚å¿µå¹¶ä¸æ˜¯ç›´æ¥ç›¸å…³çš„ã€‚æ‚¨å¯ä»¥è‡ªç”±é€‰æ‹© starter ä¹‹å¤–çš„ jar ä¾èµ–ï¼ŒSpring Boot ä»ç„¶ä¼šè‡ªåŠ¨é…ç½®æ‚¨çš„åº”ç”¨ç¨‹åºã€‚</p></blockquote><p><a id="getting-started-first-application-main-method"></a></p><h4 id="11-3-3ã€main-æ–¹æ³•">11.3.3ã€main æ–¹æ³•</h4><p>åº”ç”¨çš„æœ€åä¸€éƒ¨åˆ†æ˜¯ <code>main</code> æ–¹æ³•ã€‚è¿™åªæ˜¯ä¸€ä¸ªæ ‡å‡†æ–¹æ³•ï¼Œå…¶éµå¾ª Java è§„èŒƒä¸­å®šä¹‰çš„åº”ç”¨ç¨‹åºå…¥å£ç‚¹ã€‚æˆ‘ä»¬çš„ main æ–¹æ³•é€šè¿‡è°ƒç”¨ <code>run</code> æ¥å§”æ‰˜ Spring Boot çš„ <code>SpringApplication</code> ç±»ï¼Œ<code>SpringApplication</code> ç±»å°†å¼•å¯¼æˆ‘ä»¬çš„åº”ç”¨ï¼Œå¯åŠ¨ Springï¼Œç„¶åå¯åŠ¨è‡ªåŠ¨é…ç½®çš„ Tomcat web æœåŠ¡å™¨ã€‚æˆ‘ä»¬éœ€è¦å°† <code>Example.class</code>  ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’ç»™ <code>run</code> æ–¹æ³•æ¥å‘ŠçŸ¥ <code>SpringApplication</code>ï¼Œå®ƒæ˜¯ Spring ä¸»ç»„ä»¶ã€‚åŒæ—¶è¿˜ä¼ é€’ <code>args</code> æ•°ç»„ä»¥æš´éœ²æ‰€æœ‰å‘½ä»¤è¡Œå‚æ•°ã€‚</p><p><a id="getting-started-first-application-run"></a></p><h3 id="11-4ã€è¿è¡Œç¤ºä¾‹">11.4ã€è¿è¡Œç¤ºä¾‹</h3><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬çš„åº”ç”¨åº”è¯¥æ˜¯å¯ä»¥å·¥ä½œäº†ã€‚ç”±äºæ‚¨ä½¿ç”¨äº† <code>spring-boot-starter-parent</code> POMï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨ <code>run</code> æ¥å¯åŠ¨åº”ç”¨ç¨‹åºã€‚åœ¨æ ¹ç›®å½•ä¸‹è¾“å…¥ <code>mvn spring-boot:run</code> ä»¥å¯åŠ¨åº”ç”¨ï¼š</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ mvn spring-boot:run</span><br><span class="line"></span><br><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> /\\ / ___&#x27;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ |<span class="string"> &#x27;_ </span>|<span class="string"> &#x27;_</span>|<span class="string"> </span>|<span class="string"> &#x27;_ \/ _` </span>|<span class="string"> \ \ \ \</span></span><br><span class="line"><span class="string"> \\/  ___)</span>|<span class="string"> </span>|<span class="string">_)</span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>||<span class="string"> (_</span>|<span class="string"> </span>|<span class="string">  ) ) ) )</span></span><br><span class="line"><span class="string">  &#x27;  </span>|<span class="string">____</span>|<span class="string"> .__</span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string">_</span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string">_\__, </span>|<span class="string"> / / / /</span></span><br><span class="line"><span class="string"> =========</span>|<span class="string">_</span>|<span class="string">==============</span>|<span class="string">___/=/_/_/_/</span></span><br><span class="line"><span class="string"> :: Spring Boot ::  (v2.0.0.RELEASE)</span></span><br><span class="line"><span class="string">....... . . .</span></span><br><span class="line"><span class="string">....... . . . (log output here)</span></span><br><span class="line"><span class="string">....... . . .</span></span><br><span class="line"><span class="string">........ Started Example in 2.222 seconds (JVM running for 6.514)</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨ç”¨æµè§ˆå™¨æ‰“å¼€äº† <a href="http://localhost:8080/"><code>localhost:8080</code></a>ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼š</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello World!</span><br></pre></td></tr></table></figure><p>è¦å¹³æ»‘é€€å‡ºç¨‹åºï¼Œè¯·æŒ‰ <code>ctrl+c</code>ã€‚</p><p><a id="getting-started-first-application-executable-jar"></a></p><h3 id="11-5ã€åˆ›å»ºå¯æ‰§è¡Œ-jar">11.5ã€åˆ›å»ºå¯æ‰§è¡Œ jar</h3><p>æˆ‘ä»¬é€šè¿‡åˆ›å»ºä¸€ä¸ªå®Œå…¨è‡ªåŒ…å«ï¼ˆself-containedï¼‰çš„å¯æ‰§è¡Œ jar æ–‡ä»¶å®Œæˆäº†ç¤ºä¾‹ã€‚è¯¥ jar æ–‡ä»¶å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œã€‚å¯æ‰§è¡Œ jarï¼ˆæœ‰æ—¶åˆç§°ä¸º <code>fat jars</code>ï¼‰æ˜¯åŒ…å«äº†ç¼–è¯‘åçš„ç±»ä»¥åŠä»£ç è¿è¡Œæ—¶æ‰€éœ€è¦ç›¸å…³çš„ jar ä¾èµ–çš„å½’æ¡£æ–‡ä»¶ã€‚</p><hr><p><strong>å¯æ‰§è¡Œ jar ä¸ Java</strong></p><p>Java ä¸æä¾›ä»»ä½•æ ‡å‡†æ–¹å¼æ¥åŠ è½½åµŒå¥—çš„ jar æ–‡ä»¶ï¼ˆæ¯”å¦‚æœ¬èº«åŒ…å«åœ¨ jar ä¸­çš„ jar æ–‡ä»¶ï¼‰ã€‚å¦‚æœæ‚¨æƒ³åˆ†å‘è‡ªåŒ…å«çš„åº”ç”¨ï¼Œè¿™å¯èƒ½æ˜¯ä¸ªé—®é¢˜ã€‚</p><p>ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼Œè®¸å¤šå¼€å‘äººå‘˜ä½¿ç”¨äº† <strong>uber</strong> jarï¼Œuber jar ä»æ‰€æœ‰åº”ç”¨çš„ä¾èµ–ä¸­æ‰“åŒ…æ‰€æœ‰çš„ç±»åˆ°ä¸€ä¸ªå½’æ¡£ä¸­ã€‚è¿™ç§æ–¹æ³•çš„é—®é¢˜åœ¨äºï¼Œæ‚¨å¾ˆéš¾çœ‹å‡ºåº”ç”¨ç¨‹åºå®é™…ä¸Šä½¿ç”¨åˆ°äº†å“ªäº›åº“ã€‚å¦‚æœåœ¨å¤šä¸ª jar ä¸­ä½¿ç”¨äº†ç›¸åŒçš„æ–‡ä»¶åï¼ˆä½†å†…å®¹ä¸åŒï¼‰ï¼Œè¿™ä¹Ÿå¯èƒ½äº§ç”Ÿé—®é¢˜ã€‚</p><p>Spring Boot é‡‡ç”¨äº†<a href="#executable-jar">ä¸åŒæ–¹æ–¹å¼</a>ï¼Œå¯ä»¥ç›´æ¥å¯¹ jar è¿›è¡ŒåµŒå¥—ã€‚</p><hr><p>è¦åˆ›å»ºå¯æ‰§è¡Œ jarï¼Œæˆ‘ä»¬éœ€è¦å°† <code>spring-boot-maven-plugin</code> æ·»åŠ åˆ° <code>pom.xml</code> æ–‡ä»¶ä¸­ã€‚åœ¨ <code>dependencies</code> ä¸‹æ–¹æ’å…¥ä»¥ä¸‹é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><blockquote><p><code>spring-boot-starter-parent</code> POM åŒ…å«äº† <code>&lt;executions&gt;</code> é…ç½®ï¼Œç”¨äºç»‘å®š <code>repackage</code> ã€‚å¦‚æœæ‚¨æ²¡æœ‰ä½¿ç”¨çˆ¶ POMï¼Œæ‚¨éœ€è¦è‡ªå·±å£°æ˜æ­¤é…ç½®ã€‚æœ‰å…³è¯¦ç»†çš„ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.spring.io/spring-boot/docs/2.0.0.RELEASE/maven-plugin/usage.html">æ’ä»¶æ–‡æ¡£</a>ã€‚</p></blockquote><p>ä¿å­˜ <code>pom.xml</code> å¹¶åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ <code>mvn package</code>ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ mvn package</span><br><span class="line"></span><br><span class="line">[<span class="built_in">INFO</span>] Scanning <span class="keyword">for</span> projects<span class="built_in">..</span>.</span><br><span class="line">[<span class="built_in">INFO</span>]</span><br><span class="line">[<span class="built_in">INFO</span>] ------------------------------------------------------------------------</span><br><span class="line">[<span class="built_in">INFO</span>] Building myproject 0.0.1-SNAPSHOT</span><br><span class="line">[<span class="built_in">INFO</span>] ------------------------------------------------------------------------</span><br><span class="line">[<span class="built_in">INFO</span>] <span class="built_in">..</span><span class="built_in">..</span> <span class="built_in">..</span></span><br><span class="line">[<span class="built_in">INFO</span>] --- maven-jar-plugin:2.4:jar (default-jar) @ myproject ---</span><br><span class="line">[<span class="built_in">INFO</span>] Building jar: /Users/developer/example/spring-boot-example/target/myproject-0.0.1-SNAPSHOT.jar</span><br><span class="line">[<span class="built_in">INFO</span>]</span><br><span class="line">[<span class="built_in">INFO</span>] --- spring-boot-maven-plugin:2.0.0.RELEASE:repackage (default) @ myproject ---</span><br><span class="line">[<span class="built_in">INFO</span>] ------------------------------------------------------------------------</span><br><span class="line">[<span class="built_in">INFO</span>] BUILD SUCCESS</span><br><span class="line">[<span class="built_in">INFO</span>] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚¨æµè§ˆ <code>target</code> ç›®å½•ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ° <code>myproject-0.0.1-SNAPSHOT.jar</code>ã€‚è¯¥æ–‡ä»¶çš„å¤§å°å¤§çº¦ä¸º 10 MBã€‚å¦‚æœæ‚¨æƒ³è¦æŸ¥çœ‹é‡Œé¢çš„å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ <code>jar tvf</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jar tvf target/myproject-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure><p>æ‚¨åº”è¯¥è¿˜ä¼šåœ¨ <code>target</code> ç›®å½•ä¸­çœ‹åˆ°ä¸€ä¸ªåä¸º <code>myproject-0.0.1-SNAPSHOT.jar.original</code> çš„è¾ƒå°æ–‡ä»¶ã€‚è¿™æ˜¯åœ¨ Spring Boot é‡æ–°æ‰“åŒ…ä¹‹å‰ç”± Maven æ‰€åˆ›å»ºçš„åŸå§‹ jar æ–‡ä»¶ã€‚</p><p>ä½¿ç”¨ <code>java -jar</code> å‘½ä»¤è¿è¡Œè¯¥åº”ç”¨ï¼š</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar target/myproject-0.0.1-SNAPSHOT.jar</span><br><span class="line"></span><br><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> /\\ / ___&#x27;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ |<span class="string"> &#x27;_ </span>|<span class="string"> &#x27;_</span>|<span class="string"> </span>|<span class="string"> &#x27;_ \/ _` </span>|<span class="string"> \ \ \ \</span></span><br><span class="line"><span class="string"> \\/  ___)</span>|<span class="string"> </span>|<span class="string">_)</span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>|<span class="string"> </span>||<span class="string"> (_</span>|<span class="string"> </span>|<span class="string">  ) ) ) )</span></span><br><span class="line"><span class="string">  &#x27;  </span>|<span class="string">____</span>|<span class="string"> .__</span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string">_</span>|<span class="string">_</span>|<span class="string"> </span>|<span class="string">_\__, </span>|<span class="string"> / / / /</span></span><br><span class="line"><span class="string"> =========</span>|<span class="string">_</span>|<span class="string">==============</span>|<span class="string">___/=/_/_/_/</span></span><br><span class="line"><span class="string"> :: Spring Boot ::  (v2.0.0.RELEASE)</span></span><br><span class="line"><span class="string">....... . . .</span></span><br><span class="line"><span class="string">....... . . . (log output here)</span></span><br><span class="line"><span class="string">....... . . .</span></span><br><span class="line"><span class="string">........ Started Example in 2.536 seconds (JVM running for 2.864)</span></span><br></pre></td></tr></table></figure><p>è·Ÿä¹‹å‰ä¸€æ ·, è¦å¹³æ»‘é€€å‡ºåº”ç”¨ï¼Œè¯·æŒ‰ <code>ctrl-c</code>ã€‚</p><p><a id="getting-started-whats-next"></a></p><h2 id="12ã€ä¸‹ä¸€æ­¥">12ã€ä¸‹ä¸€æ­¥</h2><p>å¸Œæœ›æ‚¨åœ¨æœ¬ç« èŠ‚å­¦åˆ°äº†ä¸€äº› Spring Boot çš„åŸºç¡€çŸ¥è¯†ï¼Œå¹¶ä¸”å¼€å§‹ç¼–å†™è‡ªå·±çš„åº”ç”¨ã€‚å¦‚æœæ‚¨æ˜¯ä¸€åé¢å‘ä»»åŠ¡ï¼ˆtask-orientedï¼‰çš„å¼€å‘äººå‘˜ï¼Œæ‚¨å¯èƒ½æƒ³è·³è¿‡ <a href="https://spring.io/">spring.io</a> è€Œç›´æ¥é˜…è¯»ä¸€äº›èƒ½è§£å†³<strong>å¦‚ä½•ä½¿ç”¨ Spring æ¥è§£å†³ï¼Ÿ</strong> è¿™ç±»é—®é¢˜çš„<a href="https://spring.io/guides/">å…¥é—¨æŒ‡å—</a>ï¼Œæ­¤å¤–æˆ‘ä»¬è¿˜æœ‰ Spring Boot ä¸“é—¨çš„ <a href="#howto">How-to</a> å‚è€ƒæ–‡æ¡£ã€‚</p><p><a href="https://github.com/spring-projects/spring-boot">Spring Boot ä»“åº“</a>è¿˜æœ‰å¾ˆå¤šæ‚¨å¯ä»¥è¿è¡Œçš„<a href="https://github.com/spring-projects/spring-boot/tree/v2.0.0.RELEASE/spring-boot-samples">ç¤ºä¾‹</a>ã€‚ç¤ºä¾‹ä¸å…¶ä½™éƒ¨åˆ†çš„ä»£ç æ˜¯ç‹¬ç«‹çš„ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæ‚¨ä¸éœ€è¦æ„å»ºå…¶ä»–çš„ä»£ç æ¥è¿è¡Œæˆ–ä½¿ç”¨ç¤ºä¾‹ï¼‰ã€‚</p><p>æ¥ä¸‹æ¥é˜…è¯»çš„æ˜¯ç¬¬ä¸‰éƒ¨ï¼š<a href="#using-boot">ä½¿ç”¨ Spring Boot</a>ã€‚å¦‚æœæ‚¨çœŸçš„æ„Ÿåˆ°åŒå€¦äº†ï¼Œå¯ä»¥è·³è¿‡è¯¥éƒ¨åˆ†ç›´æ¥é˜…è¯» <a href="#boot-features">Spring Boot ç‰¹æ€§</a>ã€‚</p>]]></content>
    
    
    <summary type="html">Spring Bootçš„ç®€å•ä»‹ç»å’Œå…¥é—¨æ¡ˆä¾‹</summary>
    
    
    
    <category term="Spring Boot" scheme="https://luoxiaohei520.github.io/categories/Spring-Boot/"/>
    
    
    <category term="Spring Boot" scheme="https://luoxiaohei520.github.io/tags/Spring-Boot/"/>
    
  </entry>
  
</feed>
